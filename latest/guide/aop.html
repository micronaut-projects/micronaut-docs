<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 Aspect Oriented Programming 1.0.0.M1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/dataAccess.html"><strong>10</strong><span>Configurations for Data Access</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/languageSupport.html"><strong>11</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/management.html"><strong>12</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>13</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cli.html"><strong>14</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/faq.html"><strong>15</strong><span>Frequently Asked Questions (FAQ)</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/config.html">&lt;&lt; <strong>4</strong><span>Application Configuration</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span> >></a></div>
                


                <div class="project">
                    <h1>5 Aspect Oriented Programming</h1>

                    <p><strong>Version:</strong> 1.0.0.M1</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#aroundAdvice"><strong>5.1</strong><span>Around Advice</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#introductionAdvice"><strong>5.2</strong><span>Introduction Advice</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#validation"><strong>5.3</strong><span>Validation Advice</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#caching"><strong>5.4</strong><span>Cache Advice</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#retry"><strong>5.5</strong><span>Retry Advice</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#scheduling"><strong>5.6</strong><span>Scheduled Tasks</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#springAop"><strong>5.7</strong><span>Bridging Spring AOP</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="aop">5 Aspect Oriented Programming</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Aspect-Oriented Programming (AOP) historically has had many incarnations and some very complicated implementations. Generally AOP can be thought of as a way to define cross cutting concerns (logging, transactions, tracing etc.) separate from application code in the form of aspects that define advice.</p>
</div>
<div class="paragraph">
<p>There are typically two forms of advice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Around Advice - decorates a method or class</p>
</li>
<li>
<p>Introduction Advice - introduces new behaviour to a class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In modern Java applications declaring advice typically takes the form of an annotation. The most well-known annotation advice in the Java world is probably <code>@Transactional</code> which is used to demarcate transaction boundries in Spring and Grails applications.</p>
</div>
<div class="paragraph">
<p>The disadvantage of traditional approaches to AOP is the heavy reliance on runtime proxy creation and reflection, which slows application performance, makes debugging harder and increases memory consumption.</p>
</div>
<div class="paragraph">
<p>Micronaut tries to address these concerns by providing a simple compile time AOP API that does not use reflection.</p>
</div>


<h2 id="aroundAdvice">5.1 Around Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/aroundAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The most common type of advice you may want to apply is "Around" advice, which essentially allows you decorate a methods behaviour.</p>
</div>
<div class="sect1">
<h2 id="_writing_around_advice">Writing Around Advice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step to defining Around advice is to implement a <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a>. For example the following interceptor disallows parameters with <code>null</code> values:</p>
</div>
<div class="listingblock">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.aop</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.core.type.MutableArgumentValue</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.util</span>.*;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NotNullInterceptor</span> <span class="directive">implements</span> MethodInterceptor&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> intercept(MethodInvocationContext&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; context) {
        Optional&lt;<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, MutableArgumentValue&lt;?&gt;&gt;&gt; nullParam = context.getParameters()
            .entrySet()
            .stream()
            .filter(entry -&gt; {
                MutableArgumentValue&lt;?&gt; argumentValue = entry.getValue();
                <span class="keyword">return</span> Objects.isNull(argumentValue.getValue());
            })
            .findFirst(); <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">if</span> (nullParam.isPresent()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null parameter [</span><span class="delimiter">&quot;</span></span> + nullParam.get().getKey() + <span class="string"><span class="delimiter">&quot;</span><span class="content">] not allowed</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> context.proceed(); <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An interceptor implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The passed <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> is used to find the first parameter that is <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If a <code>null</code> parameter is found an exception is thrown</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise <a href="../api/io/micronaut/aop/InvocationContext.html#proceed--">proceed()</a> is called to proceed with the method invocation.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut AOP interceptors use no reflection which improves performance and reducing stack trace sizes, thus improving debugging.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To put the new <code>MethodInterceptor</code> to work the next step is to define an annotation that will trigger the <code>MethodInterceptor</code>:</p>
</div>
<div class="listingblock">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Type</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.aop.Around</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation</span>.*;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;

<span class="annotation">@Documented</span>
<span class="annotation">@Retention</span>(RUNTIME) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD}) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Around</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="annotation">@Type</span>(NotNullInterceptor.class) <i class="conum" data-value="4"></i><b>(4)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> NotNull {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The retention policy of the annotation should be <code>RUNTIME</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generally you want to be able to apply advice at the class or method level so the target types are <code>TYPE</code> and <code>METHOD</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/aop/Around.html">Around</a> annotation is added to tell Micronaut that the annotation is Around advice</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Type.html">@Type</a> annotation is used to configure which type implements the advice (in this case the previously defined <code>NotNullInterceptor</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the interceptor and annotation implemented you can then simply apply the annotation to the target classes:</p>
</div>
<div class="listingblock">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NotNullExample</span> {

    <span class="annotation">@NotNull</span>
    <span class="type">void</span> doWork(<span class="predefined-type">String</span> taskName) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Doing job: </span><span class="delimiter">&quot;</span></span> + taskName);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever the type <code>NotNullExample</code> is injected into any class a compile time generated proxy will instead by injected that decorates the appropriate method calls with the <code>@NotNull</code> advice defined earlier. You can verify that the advice works by writing a test. The following test uses a JUnit <code>ExpectedException</code> rule to verify the appropriate exception is thrown when an argument is <code>null</code>:</p>
</div>
<div class="listingblock">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> ExpectedException thrown = ExpectedException.none();

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testNotNull() {
    ApplicationContext applicationContext = ApplicationContext.run();
    NotNullExample exampleBean = applicationContext.getBean(NotNullExample.class);

    thrown.expect(<span class="exception">IllegalArgumentException</span>.class);
    thrown.expectMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null parameter [taskName] not allowed</span><span class="delimiter">&quot;</span></span>);

    exampleBean.doWork(<span class="predefined-constant">null</span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Micronaut is compile time, generally the advice should be packaged in a dependent JAR file that is on the classpath when the above test is compiled and should not be in the same codebase since you don&#8217;t want the test compiling before the advice itself is compiled.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_proxy_generation">Customizing Proxy Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default behaviour of the <a href="../api/io/micronaut/aop/Around.html">Around</a> annotation is to generate a proxy at compile time that is a subclass of the class being proxied. In other words, in the previous example a compile time subclass of the <code>NotNullExample</code> class will be produced where methods that are proxied are decorated with interceptor handling and the original behaviour is invoked via a call to <code>super</code>.</p>
</div>
<div class="paragraph">
<p>This behaviour is more efficient as only one instance of the bean is required, however depending on the use case you are trying to implement you may wish to alter this behaviour and the <code>@Around</code> annotation supports various attributes that allow you to alter this behaviour including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyTarget</code> (defaults to <code>false</code>) - If set to <code>true</code> instead of a subclass that calls <code>super</code>, the proxy will delegate to the original bean instance</p>
</li>
<li>
<p><code>hotswap</code> (defaults to <code>false</code>) - Same as <code>proxyTarget=true</code>, but in addition the proxy will implement <a href="../api/io/micronaut/aop/HotSwappableInterceptedProxy.html">HotSwappableInterceptedProxy</a> which wraps each method call in a <code>ReentrantReadWriteLock</code> and allows swapping the target instance at runtime.</p>
</li>
<li>
<p><code>lazy</code> (defaults to <code>false</code>) - By default Micronaut will eagerly intialize the proxy target when the proxy is created. If set to <code>true</code> the proxy target will instead be resolved lazily for each method call.</p>
</li>
</ul>
</div>
</div>
</div>


<h2 id="introductionAdvice">5.2 Introduction Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/introductionAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Introduction advice is distinct from Around advice in that it involves providing an implementation instead of decorating.</p>
</div>
<div class="paragraph">
<p>Examples of introduction advice include things like <a href="http://gorm.grails.org">GORM</a> or <a href="http://projects.spring.io/spring-data">Spring Data</a> that will both automatically implement persistence logic for you.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation is another example of introduction advice where Micronaut will, at compile time, implement HTTP client interfaces for you.</p>
</div>
<div class="paragraph">
<p>The way you implement Introduction advice is very similar to how you implement Around advice.</p>
</div>
<div class="paragraph">
<p>You start off by defining an annotation that will power the introduction advice. As an example, say you want to implement advice that will return a stubbed value for every method in an interface (a common requirement in testing frameworks). Consider the following <code>@Stub</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.aop.Introduction</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Bean</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Type</span>;

<span class="keyword">import</span> <span class="include">java.lang.annotation.Documented</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.ElementType</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Retention</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Target</span>;

<span class="annotation">@Introduction</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Type</span>(StubIntroduction.class) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Bean</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="annotation">@Documented</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.ANNOTATION_TYPE, <span class="predefined-type">ElementType</span>.METHOD})
<span class="directive">public</span> <span class="annotation">@interface</span> <span class="predefined-type">Stub</span> {
    <span class="predefined-type">String</span> value() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The introduction advice is annotated with <a href="../api/io/micronaut/aop/Introduction.html">Introduction</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Type.html">Type</a> annotation is used to refer to the implementor of the advise. In this case <code>StubIntroduction</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation is added so that all types annotated with <code>@Stub</code> become beans</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>StubIntroduction</code> class referred to in the previous example must then implement the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface, just like around advice.</p>
</div>
<div class="paragraph">
<p>The following is an example implementation:</p>
</div>
<div class="listingblock">
<div class="title">StubIntroduction.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.aop</span>.*;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StubIntroduction</span> <span class="directive">implements</span> MethodInterceptor&lt;<span class="predefined-type">Object</span>,<span class="predefined-type">Object</span>&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> intercept(MethodInvocationContext&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; context) {
        <span class="keyword">return</span> context.getValue( <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="predefined-type">Stub</span>.class,
                context.getReturnType().getType()
        ).orElse(<span class="predefined-constant">null</span>); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is annotated with <code>@Singleton</code> and implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>@Stub</code> annotation is read from the context and an attempt made to convert the value to the return type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Otherwise <code>null</code> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To now use this introduction advice in an application you simply annotate your abstract classes or interfaces with <code>@Stub</code>:</p>
</div>
<div class="listingblock">
<div class="title">StubExample.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stub</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">StubExample</span> {

    <span class="annotation">@Stub</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> getNumber();

    LocalDateTime getDate();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All abstract methods will delegate to the <code>StubIntroduction</code> class to be implemented.</p>
</div>
<div class="paragraph">
<p>The following test demonstrates the behaviour or <code>StubIntroduction</code>:</p>
</div>
<div class="listingblock">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">StubExample stubExample = applicationContext.getBean(StubExample.class);

assertEquals(<span class="integer">10</span>, stubExample.getNumber());
assertNull(stubExample.getDate());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if the introduction advice cannot implement the method the <code>proceed</code> method of the <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> should be called. This gives the opportunity for other introduction advice interceptors to implement the method, otherwise a <code>UnsupportedOperationException</code> will be thrown if no advice can implement the method.</p>
</div>
<div class="paragraph">
<p>In addition, if multiple introduction advice are present you may wish to override the <code>getOrder()</code> method of <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> to control the priority of advise.</p>
</div>
<div class="paragraph">
<p>The following sections cover core advice types that are built into Micronaut and provided by the framework.</p>
</div>


<h2 id="validation">5.3 Validation Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/validation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Validation advice is one of the most common advice types you are likely to want to incorporate into your application.</p>
</div>
<div class="paragraph">
<p>Validation advice is built on <code>javax.validation</code> and the <a href="http://hibernate.org/validator">Hibernate Validator</a> project.</p>
</div>
<div class="paragraph">
<p>To get started first add the Hibernate Validator configuration to your application:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:hibernate-validator</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then simply add the <a href="../api/io/micronaut/validation/Validated.html">Validated</a> annotation to any class that requires validation. For example, consider this trivial service that retrieves books by title:</p>
</div>
<div class="listingblock">
<div class="title">BookService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.validation.Validated</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.validation.constraints.NotBlank</span>;
<span class="keyword">import</span> <span class="include">java.util</span>.*;

<span class="annotation">@Singleton</span>
<span class="annotation">@Validated</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookService</span> {

    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; authorsByTitle = <span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;&gt;();

    <span class="directive">public</span> <span class="predefined-type">String</span> getAuthor(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> title) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> authorsByTitle.get(title);
    }

    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> author, <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> title) {
        authorsByTitle.put(title, author);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/validation/Validated.html">Validated</a> annotation is defined at the class level</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>javax.validation.NotBlank</code> constraint is used to ensure parameters passed cannot be blank</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can verify the behaviour of the class by writing a test. The following test is written in Groovy and Spock:</p>
</div>
<div class="listingblock">
<div class="title">Testing Validation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test validate book service</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    BookService bookService = applicationContext.getBean(BookService)

    <span class="key">when</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">An invalid title is passed</span><span class="delimiter">&quot;</span></span>
    bookService.getAuthor(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)

    <span class="key">then</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">A constraint violation occurred</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> e = thrown(ConstraintViolationException)
    e.message == <span class="string"><span class="delimiter">'</span><span class="content">getAuthor.title: must not be blank</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>


<h2 id="caching">5.4 Cache Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/caching.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Similar to Spring and Grails, Micronaut provides a set of caching annotations within the <a href="../api/io/micronaut/cache/package-summary.html">io.micronaut.cache</a> package.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/cache/CacheManager.html">CacheManager</a> interface allows different cache implementations to be plugged in as necessary.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/cache/SyncCache.html">SyncCache</a> interface provides a synchronous API for caching, whilst the <a href="../api/io/micronaut/cache/AsyncCache.html">AsyncCache</a> API allows non-blocking operation.</p>
</div>
<div class="sect1">
<h2 id="_cache_annotations">Cache Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following cache annotations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/cache/annotation/Cacheable.html">@Cacheable</a> - Indicates a method is cacheable within the given cache name</p>
</li>
<li>
<p><a href="../api/io/micronaut/cache/annotation/CachePut.html">@CachePut</a> - Indicates that the return value of a method invocation should be cached. Unlike <code>@Cacheable</code> the original operation is never skipped.</p>
</li>
<li>
<p><a href="../api/io/micronaut/cache/annotation/CacheInvalidate.html">@CacheInvalidate</a> - Indicates the invocation of a method should cause the invalidation of one or many caches.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By using one of the annotations the <a href="../api/io/micronaut/cache/interceptor/CacheInterceptor.html">CacheInterceptor</a> is activated which in the case of <code>@Cacheable</code> will cache the return result of the method.</p>
</div>
<div class="paragraph">
<p>If the return type of the method is a non-blocking type (either <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> or an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">org.reactivestreams.Publisher</a>) the emitted result will be cached.</p>
</div>
<div class="paragraph">
<p>In addition if the underlying Cache implementation supports non-blocking cache operations then cache values will be read from the cache without blocking, resulting in the ability to implement completely non-blocking cache operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_caches">Configuring Caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default <a href="https://github.com/ben-manes/caffeine">Caffeine</a> is used for cache definitions which can be configured via application configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Cache Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">myCache</span>:
            <span class="key">maximumSize</span>: <span class="string"><span class="content">20</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will configure a cache called "myCache" with a maximum size of 20.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_caching_with_redis">Caching with Redis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to use Redis to cache results then you need to add the Lettuce configuration to your classpath. Lettuce is a non-blocking, reactive Redis client implementation and Micronaut provides an implementation that allows cached results to be read reactively. To configure the Lettuce configuration add the following dependency to your application:</p>
</div>
<div class="listingblock">
<div class="title">Lettuce Configuration build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configurations:redis-lettuce</span><span class="delimiter">&quot;</span></span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then within your application configuration configure the Redis URL and Redis caches:</p>
</div>
<div class="listingblock">
<div class="title">Cache Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">redis</span>:
        <span class="key">uri</span>: <span class="string"><span class="content">redis://localhost</span></span>
        <span class="key">caches</span>:
            <span class="key">myCache</span>:
                <span class="key">expireAfterWrite</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1h</span><span class="delimiter">&quot;</span></span> <span class="comment"># expire one hour after write</span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="retry">5.5 Retry Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/retry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems and Microservice environments, failure is something you have to plan for and it is pretty common to want to attempt to retry an operation if it fails. If first you don&#8217;t succeed try again!</p>
</div>
<div class="paragraph">
<p>With this in mind Micronaut comes with a <a href="../api/io/micronaut/retry/annotation/Retryable.html">Retryable</a> annotation out of the box that is integrated into the container.</p>
</div>
<div class="sect1">
<h2 id="_simple_retry">Simple Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest form of retry is just to add the <code>@Retryable</code> annotation to any type or method. The default behaviour of <code>@Retryable</code> is to retry 3 times with a delay of 1 second between each retry.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Simply Retry Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; listBooks() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above example if the <code>listBooks()</code> method throws an exception it will be retried until the maximum number of attempts is reached.</p>
</div>
<div class="paragraph">
<p>The <code>multiplier</code> value of the <code>@Retryable</code> annotation can be used to configure a multiplier used to calculate the delay between retries, thus allowing exponential retry support.</p>
</div>
<div class="paragraph">
<p>Note also that the <code>@Retryable</code> annotation can be applied on interfaces and the behaviour will be inherited through annotation metadata. The implication of this is that <code>@Retryable</code> can be used in combination with <a href="#introductionAdvice">Introduction Advice</a> such as the HTTP <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>To customize retry behaviour you can set the <code>attempts</code> and <code>delay</code> members, For example to configure 5 attempts with a 2 second delay:</p>
</div>
<div class="listingblock">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>( attempts = <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>,
            delay = <span class="string"><span class="delimiter">&quot;</span><span class="content">2s</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(<span class="predefined-type">String</span> title) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how both <code>attempts</code> and <code>delay</code> are defined as strings. This is to support configurability through annotation metadata. For example you can allow the retry policy to be configured using property placeholder resolution:</p>
</div>
<div class="listingblock">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>( attempts = <span class="string"><span class="delimiter">&quot;</span><span class="content">${book.retry.attempts:3}</span><span class="delimiter">&quot;</span></span>,
            delay = <span class="string"><span class="delimiter">&quot;</span><span class="content">${book.retry.delay:1s}</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="predefined-type">Book</span> getBook(<span class="predefined-type">String</span> title) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above in place if <code>book.retry.attempts</code> is specified in configuration it wil be bound the value of the <code>attempts</code> member of the <code>@Retryable</code> annotation via annotation metadata.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactive_retry">Reactive Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>@Retryable</code> advice can also be applied to methods that return reactive types, such as an RxJava <code>Flowable</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>
<span class="directive">public</span> Flowable&lt;<span class="predefined-type">Book</span>&gt; streamBooks() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>@Retryable</code> advice will apply the retry policy to the reactive type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_circuit_breaker">Circuit Breaker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Microservice environment retry is useful, but in some cases excessive retries can overwhelm the system as clients repeatedly re-attempt failing operations.</p>
</div>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern">Circuit Breaker</a> pattern is designed to resolve this issue by essentially allowing a certain number of failing requests and then opening a circuit that remains open for a period before allowing any additional retry attempts.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">CircuitBreaker</a> annotation is a variation of the <code>@Retryable</code> annotation that supports a <code>reset</code> member that indicates how long the circuit should remain open before it is reset (the default is 20 seconds).</p>
</div>
<div class="listingblock">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CircuitBreaker</span>(reset = <span class="string"><span class="delimiter">&quot;</span><span class="content">30s</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; findBooks() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will retry to <code>findBooks</code> method 3 times and then open the circuit for 30 seconds, rethrowing the original exception and preventing potential downstream traffic such as HTTP requests and I/O operations flooding the system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bean_creation_retry">Bean Creation Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned previously, <code>@Retryable</code> advice is integrated right at the container level. This is useful as it is common problem in Microservices and environments like Docker where there may be a delay in services becoming available.</p>
</div>
<div class="paragraph">
<p>The following snippet is taken from the Neo4j driver support and demonstrates how bean creation can be wrapped in retry support:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Factory</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Neo4jDriverFactory</span> {
    ...
    <span class="annotation">@Retryable</span>(<span class="exception">ServiceUnavailableException</span>.class) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Bean</span>(preDestroy = <span class="string"><span class="delimiter">&quot;</span><span class="content">close</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Driver</span> buildDriver() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A factory bean is created that defines methods that create beans</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Retryable</code> annotation is used to catch <code>ServiceUnavailableException</code> and retry creating the driver before failing startup.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retry_events">Retry Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/retry/event/RetryEventListener.html">RetryEventListener</a> instances as beans in order to listen for <a href="../api/io/micronaut/retry/event/RetryEvent.html">RetryEvent</a> events that are published every time an operation is retried.</p>
</div>
<div class="paragraph">
<p>In addition, you can register event listeners for <a href="../api/io/micronaut/retry/event/CircuitOpenEvent.html">CircuitOpenEvent</a>, when a circuit breaker circuit is opened, or <a href="../api/io/micronaut/retry/event/CircuitClosedEvent.html">CircuitClosedEvent</a> for when a circuit is closed.</p>
</div>
</div>
</div>


<h2 id="scheduling">5.6 Scheduled Tasks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/scheduling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like Spring and Grails, Micronaut features a <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation that can be used for scheduling background tasks.</p>
</div>
<div class="sect1">
<h2 id="_using_the_scheduled_annotation">Using the @Scheduled Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation can be added to any method of a bean and you should set either the <code>fixedRate</code>, <code>fixedDelay</code> or <code>cron</code> members.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that the scope of the bean has an impact on behaviour. a <code>@Singleton</code> bean will share state (the fields of the instance) for each execution, whilst with a <code>@Prototype</code> bean a new instance is created for each execution.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_scheduling_at_a_fixed_rate">Scheduling at a Fixed Rate</h3>
<div class="paragraph">
<p>To schedule a task at a fixed rate, use the <code>fixedRate</code> member. For example:</p>
</div>
<div class="listingblock">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(fixedRate = <span class="string"><span class="delimiter">&quot;</span><span class="content">5m</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> everyFiveMinutes() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing everyFiveMinutes()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task above will execute every 5 minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_with_a_fixed_delay">Scheduling with a Fixed Delay</h3>
<div class="paragraph">
<p>To schedule a task so that is runs 5 minutes after the termination of the previous task use the <code>fixedDelay</code> member. For example:</p>
</div>
<div class="listingblock">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(fixedDelay = <span class="string"><span class="delimiter">&quot;</span><span class="content">5m</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> fiveMinutesAfterLastExecution() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing fiveMinutesAfterLastExecution()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_a_cron_task">Scheduling a Cron Task</h3>
<div class="paragraph">
<p>To schedule a <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> task use the <code>cron</code> member:</p>
</div>
<div class="listingblock">
<div class="title">Cron Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(cron = <span class="string"><span class="delimiter">&quot;</span><span class="content">0 15 10 ? * MON</span><span class="delimiter">&quot;</span></span> )
<span class="type">void</span> everyMondayAtTenFifteenAm() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing everyMondayAtTenFifteenAm()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will run the task every Monday morning at 10:15AM.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programmatically_scheduling_tasks">Programmatically Scheduling Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to programmatically schedule tasks, then you can use the <a href="../api/io/micronaut/scheduling/TaskScheduler.html">TaskScheduler</a> bean which can be injected as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@Named</span>(TaskExecutors.SCHEDULED) TaskScheduler taskScheduler;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_scheduled_tasks_with_annotation_metadata">Configuring Scheduled Tasks with Annotation Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to make your application&#8217;s tasks configurable then you can use annotation metadata and property placeholder configuration to do so. For example:</p>
</div>
<div class="listingblock">
<div class="title">Allowing Tasks to be Configured</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>( fixedRate = <span class="string"><span class="delimiter">&quot;</span><span class="content">${my.task.rate:5m}</span><span class="delimiter">&quot;</span></span>,
            initialDelay = <span class="string"><span class="delimiter">&quot;</span><span class="content">${my.task.delay:1m}</span><span class="delimiter">&quot;</span></span> )
<span class="type">void</span> configuredTask() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing configuredTask()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example allows the task execution frequency to be configured with the property <code>my.task.rate</code> and the initial delay to be configured with the property <code>my.task.delay</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_scheduled_task_thread_pool">Configuring the Scheduled Task Thread Pool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tasks executed by <code>@Scheduled</code> are by default run on a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html">ScheduledExecutorService</a> that is configured to have twice the number of threads as available processors.</p>
</div>
<div class="paragraph">
<p>You can re-configure this thread pool as desired using <code>application.yml</code>, for example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Scheduled Task Thread Pool</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">executors</span>:
        <span class="key">scheduled</span>:
            <span class="key">type</span>: <span class="string"><span class="content">scheduled</span></span>
            <span class="key">core-pool-size</span>: <span class="string"><span class="content">10</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="springAop">5.7 Bridging Spring AOP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/springAop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although Micronaut&#8217;s design is based on a compile time approach and does not rely on Spring dependency injection, there is still a lot of value in the Spring ecosystem that does not depend directly on the Spring container.</p>
</div>
<div class="paragraph">
<p>You may wish to use existing Spring projects within Micronaut and configure beans to be used within Micronaut.</p>
</div>
<div class="paragraph">
<p>You may also wish to leverage existing AOP advice from Spring. One example of this is Spring&#8217;s support for declarative transactions with <code>@Transactional</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut provides support for Spring based transaction management without requiring Spring itself. You simply need to add the <code>spring</code> module to your application dependencies:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:spring</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use Micronaut&#8217;s <a href="#hibernateSupport">Hibernate support</a> you already get this dependency and a <code>HibernateTransactionManager</code> is configured for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is done by defining a Micronaut <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> annotation that uses <a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a> in a manner that every time you set a value with <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> it aliases the value to equivalent value in Spring&#8217;s version of <code>@Transactional</code>.</p>
</div>
<div class="paragraph">
<p>The benefit here is you can use Micronaut&#8217;s compile-time, reflection free AOP to declare programmatic Spring transactions. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @Transactional</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.spring.tx.annotation</span>.*;
...

<span class="annotation">@Transactional</span>
<span class="directive">public</span> <span class="predefined-type">Book</span> saveBook(<span class="predefined-type">String</span> title) {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut&#8217;s version of <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> is also annotated with <a href="../api/io/micronaut/core/annotation/Blocking.html">@Blocking</a> ensuring that all methods annotated with use the I/O thread pool when executing within the HTTP server
</td>
</tr>
</table>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/config.html">&lt;&lt; <strong>4</strong><span>Application Configuration</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>

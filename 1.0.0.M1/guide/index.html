<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script src="https://docs.micronaut.io/docsassets/js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="https://docs.micronaut.io/docsassets/img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>
                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#ioc"><strong>3</strong><span>Inversion of Control</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#config"><strong>4</strong><span>Application Configuration</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#aop"><strong>5</strong><span>Aspect Oriented Programming</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#httpServer"><strong>6</strong><span>The HTTP Server</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#httpClient"><strong>7</strong><span>The HTTP Client</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#cloud"><strong>8</strong><span>Cloud Native Features</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#serverlessFunctions"><strong>9</strong><span>Serverless Functions</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#dataAccess"><strong>10</strong><span>Configurations for Data Access</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#languageSupport"><strong>11</strong><span>Language Support</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#management"><strong>12</strong><span>Management &amp; Monitoring</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#security"><strong>13</strong><span>Security</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#cli"><strong>14</strong><span>Micronaut CLI</span></a></div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="#faq"><strong>15</strong><span>Frequently Asked Questions (FAQ)</span></a></div>
                        
                    </div>
                </div>
            </li>
            <li>
                <a href="../api/index.html" class="button">API Reference</a>
            </li>
        </ul>

    </div>
</div>



<div id="table-of-content" class="desktop">
    <h2><abbr title="Table of Contents">ToC</abbr></h2>
    
    <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#buildCLI"><strong>2.1</strong><span>Build/Install the CLI</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#creatingServer"><strong>2.2</strong><span>Creating a Server Application</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#ideSetup"><strong>2.3</strong><span>Setting up an IDE</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#creatingClient"><strong>2.4</strong><span>Creating a Client</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#deployingApp"><strong>2.5</strong><span>Deploying the Application</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#ioc"><strong>3</strong><span>Inversion of Control</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#beans"><strong>3.1</strong><span>Defining Beans</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#how"><strong>3.2</strong><span>How Does it Work?</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#beanContext"><strong>3.3</strong><span>The BeanContext</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#types"><strong>3.4</strong><span>Injectable Container Types</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#qualifiers"><strong>3.5</strong><span>Bean Qualifiers</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#scopes"><strong>3.6</strong><span>Scopes</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#builtInScopes"><strong>3.6.1</strong><span>Built-In Scopes</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#refreshable"><strong>3.6.2</strong><span>Refreshable Scope</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#metaScopes"><strong>3.6.3</strong><span>Scopes on Meta Annotations</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#factories"><strong>3.7</strong><span>Bean Factories</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#conditionalBeans"><strong>3.8</strong><span>Conditional Beans</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#replaces"><strong>3.9</strong><span>Bean Replacement</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#configurations"><strong>3.10</strong><span>Bean Configurations</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#lifecycle"><strong>3.11</strong><span>Life-Cycle Methods</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#events"><strong>3.12</strong><span>Bean Events</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#annotationMetadata"><strong>3.13</strong><span>Bean Annotation Metadata</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#springBeans"><strong>3.14</strong><span>Micronaut Beans And Spring</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#android"><strong>3.15</strong><span>Android Support</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#config"><strong>4</strong><span>Application Configuration</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#environments"><strong>4.1</strong><span>The Environment</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#propertySource"><strong>4.2</strong><span>PropertySources</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#valueAnnotation"><strong>4.3</strong><span>Configuration Injection</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#configurationProperties"><strong>4.4</strong><span>Configuration Properties</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#customTypeConverter"><strong>4.5</strong><span>Custom Type Converters</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#eachProperty"><strong>4.6</strong><span>Using @EachProperty to Drive Configuration</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#eachBean"><strong>4.7</strong><span>Using @EachBean to Drive Configuration</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#aop"><strong>5</strong><span>Aspect Oriented Programming</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#aroundAdvice"><strong>5.1</strong><span>Around Advice</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#introductionAdvice"><strong>5.2</strong><span>Introduction Advice</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#validation"><strong>5.3</strong><span>Validation Advice</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#caching"><strong>5.4</strong><span>Cache Advice</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#retry"><strong>5.5</strong><span>Retry Advice</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#scheduling"><strong>5.6</strong><span>Scheduled Tasks</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#springAop"><strong>5.7</strong><span>Bridging Spring AOP</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#httpServer"><strong>6</strong><span>The HTTP Server</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#runningServer"><strong>6.1</strong><span>Running the Embedded Server</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#runningSpecificPort"><strong>6.2</strong><span>Running Server on a Specific Port</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#routing"><strong>6.3</strong><span>HTTP Routing</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#binding"><strong>6.4</strong><span>Simple Request Binding</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#requestResponse"><strong>6.5</strong><span>The HttpRequest and HttpResponse</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#producesAnnotation"><strong>6.6</strong><span>Response Content-Type</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#consumesAnnotation"><strong>6.7</strong><span>Accepted Request Content-Type</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#reactiveServer"><strong>6.8</strong><span>Reactive HTTP Request Processing</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#bodyAnnotation"><strong>6.8.1</strong><span>Using the @Body Annotation</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#reactiveResponses"><strong>6.8.2</strong><span>Reactive Responses</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#jsonBinding"><strong>6.8.3</strong><span>JSON Binding with Jackson</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#staticResources"><strong>6.9</strong><span>Serving Static Resources</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#errorHandling"><strong>6.10</strong><span>Error Handling</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#formData"><strong>6.11</strong><span>Handling Form Data</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#uploads"><strong>6.12</strong><span>File Uploads</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#transfers"><strong>6.13</strong><span>File Transfers</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#sse"><strong>6.14</strong><span>Server Sent Events</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#filters"><strong>6.15</strong><span>HTTP Filters</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#sessions"><strong>6.16</strong><span>HTTP Sessions</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#serverEvents"><strong>6.17</strong><span>Server Events</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#serverConfiguration"><strong>6.18</strong><span>Configuring the HTTP Server</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#threadPools"><strong>6.18.1</strong><span>Configuring Server Thread Pools</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#cors"><strong>6.18.2</strong><span>Configuring CORS</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#https"><strong>6.18.3</strong><span>Securing the Server with HTTPS</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#httpClient"><strong>7</strong><span>The HTTP Client</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#lowLevelHttpClient"><strong>7.1</strong><span>Using the Low-Level HTTP Client</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientBasics"><strong>7.1.1</strong><span>Sending your first HTTP request</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientPostRequests"><strong>7.1.2</strong><span>Posting a Request Body</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientUploads"><strong>7.1.3</strong><span>Multipart Client Uploads</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientStreaming"><strong>7.1.4</strong><span>Streaming JSON over HTTP</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientConfiguration"><strong>7.1.5</strong><span>Configuring HTTP clients</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#clientAnnotation"><strong>7.2</strong><span>Declarative HTTP Clients with @Client</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientParameters"><strong>7.2.1</strong><span>Customizing Parameter Binding</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientHeaders"><strong>7.2.2</strong><span>Customizing Request Headers</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientJackson"><strong>7.2.3</strong><span>Customizing Jackson Settings</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientRetry"><strong>7.2.4</strong><span>Retry and Circuit Breaker</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#clientFallback"><strong>7.2.5</strong><span>Client Fallbacks</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#netflixHystrix"><strong>7.2.6</strong><span>Netflix Hystrix Support</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#clientFilter"><strong>7.3</strong><span>HTTP Client Filters</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#cloud"><strong>8</strong><span>Cloud Native Features</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#cloudConfiguration"><strong>8.1</strong><span>Cloud Configuration</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#distributedConfiguration"><strong>8.1.1</strong><span>Distributed Configuration</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#distributedConfigurationConsul"><strong>8.1.2</strong><span>Consul Support</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#serviceDiscovery"><strong>8.2</strong><span>Service Discovery</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#serviceDiscoveryConsul"><strong>8.2.1</strong><span>Consul Support</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#serviceDiscoveryEureka"><strong>8.2.2</strong><span>Eureka Support</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#serviceDiscoveryKubernetes"><strong>8.2.3</strong><span>Kubernetes Support</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#clientSideLoadBalancing"><strong>8.3</strong><span>Client Side Load Balancing</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#netflixRibbon"><strong>8.3.1</strong><span>Netflix Ribbon Support</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#distributedTracing"><strong>8.4</strong><span>Distributed Tracing</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#zipkin"><strong>8.4.1</strong><span>Tracing with Zipkin</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#jaeger"><strong>8.4.2</strong><span>Tracing with Jaeger</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#serverlessFunctions"><strong>9</strong><span>Serverless Functions</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#writingFunctions"><strong>9.1</strong><span>Writing Functions</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#functionApplication"><strong>9.1.1</strong><span>FunctionApplication</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#functionBean"><strong>9.1.2</strong><span>FunctionBean</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#groovyFunctions"><strong>9.1.3</strong><span>Groovy Functions</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#runningFunctions"><strong>9.2</strong><span>Running Functions</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#functionWeb"><strong>9.2.1</strong><span>Functions as Web Applications</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#functionCLI"><strong>9.2.2</strong><span>Functions as CLI Applications</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#lambdaFunctions"><strong>9.3</strong><span>Deploying Functions to AWS Lambda</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#callingFunctions"><strong>9.4</strong><span>Calling Functions with FunctionClient</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#dataAccess"><strong>10</strong><span>Configurations for Data Access</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#sqlSupport"><strong>10.1</strong><span>Configuring a SQL Data Source</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#hibernateSupport"><strong>10.2</strong><span>Configuring Hibernate</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#mongoSupport"><strong>10.3</strong><span>Configuring MongoDB</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#neo4jSupport"><strong>10.4</strong><span>Configuring Neo4j</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#redisSupport"><strong>10.5</strong><span>Configuring Redis</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#cassandraSupport"><strong>10.6</strong><span>Configuring Cassandra</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#languageSupport"><strong>11</strong><span>Language Support</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#java"><strong>11.1</strong><span>Micronaut for Java</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#groovy"><strong>11.2</strong><span>Micronaut for Groovy</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#kotlin"><strong>11.3</strong><span>Micronaut for Kotlin</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#management"><strong>12</strong><span>Management &amp; Monitoring</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#buildingEndpoints"><strong>12.1</strong><span>Creating Endpoints</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#endpointAnnotation"><strong>12.1.1</strong><span>The Endpoint Annotation</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#endpointMethod"><strong>12.1.2</strong><span>Endpoint Methods</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#endpointConfiguration"><strong>12.1.3</strong><span>Endpoint Configuration</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#providedEndpoints"><strong>12.2</strong><span>Built-In Endpoints</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#beansEndpoint"><strong>12.2.1</strong><span>The Beans Endpoint</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#infoEndpoint"><strong>12.2.2</strong><span>The Info Endpoint</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#healthEndpoint"><strong>12.2.3</strong><span>The Health Endpoint</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#refreshEndpoint"><strong>12.2.4</strong><span>The Refresh Endpoint</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#routesEndpoint"><strong>12.2.5</strong><span>The Routes Endpoint</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#stopEndpoint"><strong>12.2.6</strong><span>The Server Stop Endpoint</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#security"><strong>13</strong><span>Security</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#authenticationProviders"><strong>13.1</strong><span>Authentication Providers</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#securityRule"><strong>13.2</strong><span>Security Rules</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#ipPattern"><strong>13.2.1</strong><span>IP Pattern Rule</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#secured"><strong>13.2.2</strong><span>Secured Annotation</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#interceptUrlMap"><strong>13.2.3</strong><span>Intercept URL Map</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#builtInEndpointsAccess"><strong>13.2.4</strong><span>Built-In Endpoints Security</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#authenticationStrategies"><strong>13.3</strong><span>Authentication Strategies</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#basicAuth"><strong>13.3.1</strong><span>Basic Auth</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#session"><strong>13.3.2</strong><span>Session Authentication</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#jwt"><strong>13.3.3</strong><span>JSON Web Token</span></a></div>
    
    <div class="toc-item" style="margin-left:30px"><a href="#reader"><strong>13.3.3.1</strong><span>Reading JWT Token</span></a></div>
    
    <div class="toc-item" style="margin-left:40px"><a href="#bearerToken"><strong>13.3.3.1.1</strong><span>Bearer Token Reader</span></a></div>
    
    <div class="toc-item" style="margin-left:40px"><a href="#cookieToken"><strong>13.3.3.1.2</strong><span>Cookie Token Reader</span></a></div>
    
    <div class="toc-item" style="margin-left:30px"><a href="#jwtGenerator"><strong>13.3.3.2</strong><span>JWT Token Generation</span></a></div>
    
    <div class="toc-item" style="margin-left:40px"><a href="#jwtGeneratorSignature"><strong>13.3.3.2.1</strong><span>JWT Signature</span></a></div>
    
    <div class="toc-item" style="margin-left:40px"><a href="#jwtGeneratorEncryption"><strong>13.3.3.2.2</strong><span>Encrypted JWTs</span></a></div>
    
    <div class="toc-item" style="margin-left:30px"><a href="#jwtValidation"><strong>13.3.3.3</strong><span>JWT Token Validation</span></a></div>
    
    <div class="toc-item" style="margin-left:30px"><a href="#claimsGeneration"><strong>13.3.3.4</strong><span>Claims Generation</span></a></div>
    
    <div class="toc-item" style="margin-left:30px"><a href="#render"><strong>13.3.3.5</strong><span>Token Render</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#endpoints"><strong>13.4</strong><span>Built-In Security Controllers</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#login"><strong>13.4.1</strong><span>Login Controller</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#logout"><strong>13.4.2</strong><span>Logout Controller</span></a></div>
    
    <div class="toc-item" style="margin-left:20px"><a href="#refresh"><strong>13.4.3</strong><span>Refresh Controller</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#securityEvents"><strong>13.5</strong><span>Security Events</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#cli"><strong>14</strong><span>Micronaut CLI</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#createProject"><strong>14.1</strong><span>Creating a Project</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#profiles"><strong>14.2</strong><span>Profiles</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#features"><strong>14.3</strong><span>Features</span></a></div>
    
    <div class="toc-item" style="margin-left:10px"><a href="#commands"><strong>14.4</strong><span>Commands</span></a></div>
    
    <div class="toc-item" style="margin-left:0px"><a href="#faq"><strong>15</strong><span>Frequently Asked Questions (FAQ)</span></a></div>
    
    <div style="clear:both" ></div>
</div>

            <div id="main" class="corner-all">
                <div class="project">
                    <h1>Micronaut</h1>
                    <p></p>
                    <p>Natively Cloud Native</p>
                    <p><strong>Version:</strong> 1.0.0.M1</p>
                </div>
                

<h1 id="introduction">1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is a modern, JVM-based, full stack microservices framework designed for building modular, easily testable microservice applications.</p>
</div>
<div class="paragraph">
<p>Micronaut is developed by the creators of the Grails framework and takes inspiration from lessons learnt over the years building real-world applications from monoliths to microservices using Spring, Spring Boot and Grails.</p>
</div>
<div class="paragraph">
<p>Micronaut aims to provide all the tools necessary to build microservice applications including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency Injection and Inversion of Control (IoC)</p>
</li>
<li>
<p>Sensible Defaults and Auto-Configuration</p>
</li>
<li>
<p>Configuration and Configuration Sharing</p>
</li>
<li>
<p>Service Discovery</p>
</li>
<li>
<p>HTTP Routing</p>
</li>
<li>
<p>HTTP Client with Client-Side Load Balancing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the same time Micronaut aims to avoid the downsides of frameworks like Spring, Spring Boot and Grails by providing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast startup time</p>
</li>
<li>
<p>Reduced memory footprint</p>
</li>
<li>
<p>Minimal use of reflection</p>
</li>
<li>
<p>Minimal use of proxies</p>
</li>
<li>
<p>Easy Unit Testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whilst frameworks like Spring and Grails were never designed to run in scenarios such as as functions on a Server-less platform, or on Android or as a low memory footprint microservice; Micronaut on the other hand is designed to be suitable for all of these scenarios.</p>
</div>
<div class="paragraph">
<p>The way this is achieved is through a series of Java annotation processors, that are usable on any JVM language that supports them, and an HTTP Server and Client built on Netty.</p>
</div>
<div class="paragraph">
<p>The purpose of the annotation processors is to provide a similar programming model to Spring and Grails, but by pre-compiling all the information necessary to perform DI, define AOP proxies and configure your application to run in a microservices environment.</p>
</div>
<div class="paragraph">
<p>Many of the APIs within Micronaut are heavily inspired by Spring and Grails. This is by design, and aids in bringing developers up to speed quickly.</p>
</div>


<h1 id="quickStart">2 Quick Start</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/quickStart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following sections will walk you through a Quick start on how to use Micronaut to setup a basic "Hello World" application.</p>
</div>
<div class="paragraph">
<p>Before getting started ensure you have a Java 8 or above SDK installed and it is recommended having a suitable IDE such as IntelliJ IDEA.</p>
</div>
<div class="paragraph">
<p>To follow the Quick Start it is also recommended that you have the Micronaut CLI installed.</p>
</div>


<h2 id="buildCLI">2.1 Build/Install the CLI</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/quickStart/buildCLI.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you have not installed Micronaut on your local machine, you can build the distribution from source to use the CLI.</p>
</div>
<div class="paragraph">
<p>Clone the repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; git clone git@github.com:micronaut-projects/micronaut-core.git</pre>
</div>
</div>
<div class="paragraph">
<p><code>cd</code> into the <code>micronaut-core</code> directory and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; ./gradlew publishToMavenLocal</pre>
</div>
</div>
<div class="paragraph">
<p>This will publish the CLI and core libraries to your local Maven cache.</p>
</div>
<div class="paragraph">
<p>In your shell profile (<code>~/.bash_profile</code> if you are using the Bash shell), export the <code>MICRONAUT_HOME</code> directory and add the CLI path to your <code>PATH</code>:</p>
</div>
<div class="listingblock">
<div class="title">bash_profile/.bashrc</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">export MICRONAUT_HOME=~/path/to/micronaut-core
export PATH=&quot;$PATH:$MICRONAUT_HOME/cli/build/bin&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reload your terminal or <code>source</code> your shell profile with <code>source</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; source ~/.bash_profile</pre>
</div>
</div>
<div class="paragraph">
<p>You should now be able to run the Micronaut CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;</pre>
</div>
</div>


<h2 id="creatingServer">2.2 Creating a Server Application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/quickStart/creatingServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although not required to use Micronaut, the Micronaut CLI is the quickest way to create a new server application.</p>
</div>
<div class="paragraph">
<p>Using the CLI you can create a new Micronaut application in either Groovy, Java or Kotlin (the default is Java).</p>
</div>
<div class="paragraph">
<p>The following command creates a new "Hello World" server application in Java with a Gradle build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-app hello-world</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can supply <code>--build maven</code> if you wish to create a Maven based build instead
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command will create a new Java application in a directory called <code>hello-world</code> featuring a Gradle a build. The application can be run with <code>./gradlew run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew run
&gt; Task :run
[main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 972ms. Server Running: http://localhost:28933</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the Micronaut HTTP server is configured to run on a random port, but you can alter that by adding the following configuration to <code>src/main/resources/application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">port</span>: <span class="string"><span class="content">8080</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to create a service that responds to "Hello World" you first need a controller. The following is an example of a controller written in Java and located in <code>src/main/java/example/helloworld</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/helloworld/HelloController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloController</span> {
    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> index() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/hello</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation is used to map the <code>index</code> method to all requests that use an HTTP <code>GET</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A String "Hello World" is returned as the result</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you start the application and send a request to the <code>/hello</code> URI then the text "Hello World" is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl http://localhost:8080/hello
Hello World</code></pre>
</div>
</div>


<h2 id="ideSetup">2.3 Setting up an IDE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/quickStart/ideSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The application created in the previous section contains a "main class" located in <code>src/main/java</code> that looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.runtime.Micronaut</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Application</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the class that is run when running the application via Gradle or via deployment. You can also run the main class directly within your IDE if it is configured correctly.</p>
</div>
<div class="sect1">
<h2 id="_configuring_intellij_idea">Configuring IntelliJ IDEA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The recommended IDE to use for Micronaut is Intellij IDEA. To import a Micronaut project into IntelliJ IDEA simply open the <code>build.gradle</code> or <code>pom.xml</code> file and follow the instructions to import the project.</p>
</div>
<div class="paragraph">
<p>For IntelliJ IDEA if you plan to use the IntelliJ compiler then you should enable annotation processing under the "Build, Execution, Deployment &#8594; Compiler &#8594; Annotation Processors" by ticking the "Enable annotation processing" checkbox:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/intellij-annotation-processors.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>Once you have enabled annotation processing in IntelliJ you can run the application and tests directly within the IDE without the need of an external build tool such as Gradle or Maven.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_eclipse_ide">Configuring Eclipse IDE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to use Eclipse IDE, it is recommended you import your Micronaut project into Eclipse using either <a href="https://projects.eclipse.org/projects/tools.buildship">Gradle BuildShip</a> for Gradle or <a href="http://www.eclipse.org/m2e/">M2Eclipse</a> for Maven.</p>
</div>
<div class="paragraph">
<p>As of this writing, Eclipse has <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=534501">incomplete support</a> for Java annotation processors, hence you will have to delegate to BuildShip or M2Eclipse for building and running tests.</p>
</div>
</div>
</div>


<h2 id="creatingClient">2.4 Creating a Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/quickStart/creatingClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Micronaut is both an <a href="#httpServer">HTTP server</a> and an <a href="#httpClient">HTTP client</a>. A <a href="#lowLevelHttpClient">low-level HTTP client</a> is provided out of the box which you can use to test the <code>HelloController</code> created in the previous section.</p>
</div>
<div class="paragraph">
<p>For example, the following test is written using <a href="http://spockframework.org">Spock Framework</a>:</p>
</div>
<div class="listingblock">
<div class="title">Testing Hello World</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.context.ApplicationContext</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.HttpClient</span>
<span class="keyword">import</span> <span class="include">io.micronaut.runtime.server.EmbeddedServer</span>
<span class="keyword">import</span> <span class="include">spock.lang.*</span>

<span class="type">class</span> <span class="class">HelloControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> EmbeddedServer embeddedServer =
            ApplicationContext.run(EmbeddedServer) <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> HttpClient client = HttpClient.create(embeddedServer.URL) <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello world response</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        client.toBlocking() <i class="conum" data-value="3"></i><b>(3)</b>
              .retrieve(HttpRequest.GET(<span class="string"><span class="delimiter">'</span><span class="content">/hello</span><span class="delimiter">'</span></span>)) == <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> is configured as a shared and automatically cleaned up test field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> instance shared field is also defined</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The test using the <code>toBlocking()</code> method to make a blocking call</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>retrieve</code> method returns the response of the controller as a <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to a low-level client, Micronaut features a <a href="#clientAnnotation">declarative, compile-time HTTP client</a>, powered by the <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>To create a client, simply create an interface annotated with <code>@Client</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/hello/world/HelloClient.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.Client</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Single</span>;

<span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">interface</span> HelloClient {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    Single&lt;<span class="predefined-type">String</span>&gt; hello(); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Client</code> annotation is used with value that is a relative path to the current server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The same <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation used on the server is used to define the client mapping</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> is returned with the value read from the server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To test the <code>HelloClient</code> simply retrieve it from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> associated with the server:</p>
</div>
<div class="listingblock">
<div class="title">Testing HelloClient</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.runtime.server.EmbeddedServer</span>
<span class="keyword">import</span> <span class="include">spock.lang.*</span>

<span class="type">class</span> <span class="class">HelloClientSpec</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> EmbeddedServer embeddedServer =
            ApplicationContext.run(EmbeddedServer) <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Shared</span> HelloClient client = embeddedServer
                                        .applicationContext
                                        .getBean(HelloClient) <i class="conum" data-value="2"></i><b>(2)</b>


    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello world response</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        client.hello().blockingGet() == <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> is run</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>HelloClient</code> is retrieved from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The client is invoked using RxJava&#8217;s <code>blockingGet</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation produces an implementation automatically for you at compile time without the need to use proxies or runtime reflection.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation is very flexible. See the section on the <a href="#httpClient">Micronaut HTTP Client</a> for more information.</p>
</div>


<h2 id="deployingApp">2.5 Deploying the Application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/quickStart/deployingApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy a Micronaut application you create a runnable JAR file by running <code>./gradlew assemble</code> or <code>./mvnw package</code>.</p>
</div>
<div class="paragraph">
<p>The constructed JAR file can then be executed with <code>java -jar</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ java -jar build/libs/hello-world-all.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The runnable JAR can also easily be packaged within a Docker container or deployed to any Cloud infrastructure that supports runnable JAR  files.</p>
</div>


<h1 id="ioc">3 Inversion of Control</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When most developers think of Inversion of Control (also known as Dependency Injection and referred to as such from this point onwards) the Spring Framework comes to mind.</p>
</div>
<div class="paragraph">
<p>Micronaut takes heavy inspiration from Spring, and in fact, the core developers of Micronaut are former SpringSource/Pivotal engineers now working for <a href="https://objectcomputing.com">OCI</a>.</p>
</div>
<div class="paragraph">
<p>Unlike Spring which relies exclusively on runtime reflection and proxies, Micronaut, on the other hand, uses compile time data to implement dependency injection.</p>
</div>
<div class="paragraph">
<p>This is a similar approach taken by tools such as Google&#8217;s <a href="https://google.github.io/dagger/">Dagger</a>, which is designed primarily with Android in mind. Micronaut, on the other hand, is designed for building server-side microservices and provides many of the same tools and utilities as Spring does but without using reflection or caching excessive amounts of reflection metadata.</p>
</div>
<div class="paragraph">
<p>The goals of the Micronaut IoC container are summarized as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use reflection as a last resort</p>
</li>
<li>
<p>Avoid proxies</p>
</li>
<li>
<p>Optimize start-up time</p>
</li>
<li>
<p>Reduce memory footprint</p>
</li>
<li>
<p>Provide clear, understandable error handling</p>
</li>
</ul>
</div>


<h2 id="beans">3.1 Defining Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/beans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut implements the <a href="http://javax-inject.github.io/javax-inject/">JSR-330 (javax.inject) - Dependency Injection for Java</a> specification hence to use Micronaut you simply use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/package-summary.html">annotations provided by javax.inject</a>.</p>
</div>
<div class="paragraph">
<p>The following is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">javax.inject.*</span>

<span class="type">interface</span> Engine { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="type">int</span> getCylinders()
    <span class="predefined-type">String</span> start()
}

<span class="annotation">@Singleton</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="type">class</span> <span class="class">V8Engine</span> <span class="directive">implements</span> Engine {
    <span class="type">int</span> cylinders = <span class="integer">8</span>

    <span class="predefined-type">String</span> start() {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting V8</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">Vehicle</span> {
    <span class="directive">final</span> Engine engine

    <span class="annotation">@Inject</span> Vehicle(Engine engine) { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="local-variable">this</span>.engine = engine
    }

    <span class="predefined-type">String</span> start() {
        engine.start()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A common <code>Engine</code> interface is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>V8Engine</code> implementation is defined and marked with <code>Singleton</code> scope</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>Engine</code> is injected via constructor injection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform dependency injection simply run the  <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> using the <code>run()</code> method and lookup a bean using <code>getBean(Class)</code>, as per the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.context.*</span>
...
Vehicle vehicle = <span class="predefined-type">BeanContext</span>.run()
                             .getBean(Vehicle)
println( vehicle.start() )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will automatically discover dependency injection metadata on the classpath and wire the beans together according to injection points you define.</p>
</div>
<div class="paragraph">
<p>Micronaut supports the following types of dependency injection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constructor injection (must be one public constructor or a single contructor annotated with <code>@Inject</code>)</p>
</li>
<li>
<p>Field injection</p>
</li>
<li>
<p>JavaBean property injection</p>
</li>
<li>
<p>Method parameter injection</p>
</li>
</ul>
</div>


<h2 id="how">3.2 How Does it Work?</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/how.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At this point, you may be wondering how Micronaut performs the above dependency injection without requiring reflection.</p>
</div>
<div class="paragraph">
<p>The key is a set of AST transformations (for Groovy) and annotation processors (for Java) that generate classes that implement the <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> interface.</p>
</div>
<div class="paragraph">
<p>The ASM byte-code library is used to generate classes and because Micronaut knows ahead of time the injection points, there is no need to scan all of the methods, fields, constructors, etc. at runtime like other frameworks such as Spring do.</p>
</div>
<div class="paragraph">
<p>Also since reflection is not used in the construction of the bean, the JVM can inline and optimize the code far better resulting in better runtime performance and reduced memory consumption. This is particularly important for non-singleton scopes where the application performance depends on bean creation performance.</p>
</div>
<div class="paragraph">
<p>In addition, with Micronaut your application startup time and memory consumption is not bound to the size of your codebase in the same way as a framework that uses reflection. Reflection based IoC frameworks load and cache reflection data for every single field, method, and constructor in your code. Thus as your code grows in size so do your memory requirements, whilst with Micronaut this is not the case.</p>
</div>


<h2 id="beanContext">3.3 The BeanContext</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/beanContext.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> is a container object for all your bean definitions (it also implements <a href="../api/io/micronaut/context/BeanDefinitionRegistry.html">BeanDefinitionRegistry</a>).</p>
</div>
<div class="paragraph">
<p>It is also the point of initialization for Micronaut. Generally speaking however, you don&#8217;t have to interact directly with the <code>BeanContext</code> API and can simply use <code>javax.inject</code> annotations and the annotations defined within <a href="../api/io/micronaut/context/annotation/package-summary.html">io.micronaut.context.annotation</a> package for your dependency injection needs.</p>
</div>


<h2 id="types">3.4 Injectable Container Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/types.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to being able to inject beans Micronaut natively supports injecting the following types:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Injectable Container Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">java.util.Optional</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Optional</code> of a bean. If the bean doesn&#8217;t exist <code>empty()</code> is injected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html">java.lang.Iterable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Iterable</code> or subtype of <code>Iterable</code> (example <code>List</code>, <code>Collection</code> etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iterable&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">java.util.stream.Stream</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A lazy <code>Stream</code> of beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Array.html">Array</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A native array of beans of a given type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Engine[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Provider.html">Provider</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>javax.inject.Provider</code> if a circular dependency requires it</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Provider&lt;Engine&gt;</code></p></td>
</tr>
</tbody>
</table>


<h2 id="qualifiers">3.5 Bean Qualifiers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/qualifiers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you have multiple possible implementations for a given interface that you want to inject, you need to use a qualifier.</p>
</div>
<div class="paragraph">
<p>Once again Micronaut leverages JSR-303 and the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> and <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotations to support this use case.</p>
</div>
<div class="sect1">
<h2 id="_qualifying_by_name">Qualifying By Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To qualify by name you can use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotation. For example, consider the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">javax.inject.*</span>

<span class="type">interface</span> Engine { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="type">int</span> getCylinders()
    <span class="predefined-type">String</span> start()
}

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">V6Engine</span> <span class="directive">implements</span> Engine { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="type">int</span> cylinders = <span class="integer">6</span>

    <span class="predefined-type">String</span> start() {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting V6</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">V8Engine</span> <span class="directive">implements</span> Engine { <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="type">int</span> cylinders = <span class="integer">8</span>

    <span class="predefined-type">String</span> start() {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting V8</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">Vehicle</span> {
    <span class="directive">final</span> Engine engine

    <span class="annotation">@Inject</span> Vehicle(<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">'</span><span class="content">v8</span><span class="delimiter">'</span></span>) Engine engine) { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="local-variable">this</span>.engine = engine
    }

    <span class="predefined-type">String</span> start() {
        engine.start() <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Engine</code> interface defines the common contract</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>V6Engine</code> class is the first implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>V8Engine</code> class is the second implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotation is used to indicate the <code>V8Engine</code> implementation is required</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Calling the start method prints: <code>"Starting V8"</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also declare <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">@Named</a> at the class level of a bean to explicitly define the name of the bean.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qualifying_by_annotation">Qualifying By Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to being able to qualify by name, you can build your own qualifiers using the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> annotation. For example, consider the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">javax.inject.Qualifier</span>
<span class="keyword">import</span> <span class="include">java.lang.annotation.Retention</span>

<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>

<span class="annotation">@Qualifier</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@interface</span> V8 {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above annotation is itself annotated with the <code>@Qualifier</code> annotation to designate it as a qualifier. You can then use the annotation at any injection point in your code. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Inject</span> Vehicle(<span class="annotation">@V8</span> Engine engine) {
    <span class="local-variable">this</span>.engine = engine
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_primary_and_secondary_beans">Primary and Secondary Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../api/io/micronaut/context/annotation/Primary.html">Primary</a> is a qualifier that indicates that a bean is the primary bean that should be selected in the case of multiple possible interface implementations.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ColorPicker</span> {
    <span class="predefined-type">String</span> color()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given a common interface called <code>ColorPicker</code> that is implemented by multiple classes.</p>
</div>
<div class="listingblock">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Primary</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Requires</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;

<span class="annotation">@Primary</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Green</span> <span class="directive">implements</span> ColorPicker {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> color() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">green</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Green</code> bean is a <code>ColorPicker</code>, but is annotated with <code>@Primary</code>.</p>
</div>
<div class="listingblock">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Requires</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Blue</span> <span class="directive">implements</span> ColorPicker {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> color() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Blue</code> bean is also a <code>ColorPicker</code> and hence you have two possible candidates when injecting the <code>ColorPicker</code> interface. Since <code>Green</code> is the primary it will always be favoured.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestController</span> {

    <span class="directive">protected</span> <span class="directive">final</span> ColorPicker colorPicker;

    <span class="directive">public</span> TestController(ColorPicker colorPicker) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="local-variable">this</span>.colorPicker = colorPicker;
    }

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> index() {
        <span class="keyword">return</span> colorPicker.color();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Although there are two <code>ColorPicker</code> beans, <code>Green</code> gets injected due to the <code>@Primary</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If multiple possible candidates are present and no <code>@Primary</code> is defined then a <a href="../api/io/micronaut/context/exceptions/NonUniqueBeanException.html">NonUniqueBeanException</a> will be thrown.</p>
</div>
<div class="paragraph">
<p>In addition to <code>@Primary</code>, there is also a <a href="../api/io/micronaut/context/annotation/Secondary.html">Secondary</a> annotation which causes the opposite effect and allows de-prioritizing a bean.</p>
</div>
</div>
</div>


<h2 id="scopes">3.6 Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features an extensible bean scoping mechanism based on JSR-303. The following default scopes are supported:</p>
</div>


<h2 id="builtInScopes">3.6.1 Built-In Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes/builtInScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Built-in Scopes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">@Singleton</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Singleton scope indicates only one instance of the bean should exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Context.html">@Context</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context scope indicates that the bean should be created at the same time as the <code>ApplicationContext</code> (eager initialization)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prototype scope indicates that a new instance of the bean is created each time it is injected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Infrastructure.html">@Infrastructure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure is a <code>@Context</code> scope stereotype that indicates the bean cannot be replaced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/ThreadLocal.html">@ThreadLocal</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ThreadLocal</code> scope is a custom scope that associates a bean per thread via a ThreadLocal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Refreshable</code> scope is a custom scope that allows a bean&#8217;s state to be refreshed via the <code>/refresh</code> endpoint.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additional scopes can be added by defining a <code>@Singleton</code> bean that implements the <a href="../api/io/micronaut/context/scope/CustomScope.html">CustomScope</a> interface.</p>
</div>


<h2 id="refreshable">3.6.2 Refreshable Scope</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes/refreshable.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">Refreshable</a> scope is a custom scope that allows a beans state to be refreshed via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/refresh</code> endpoint.</p>
</li>
<li>
<p>Publication of a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example, illustrates the <code>@Refreshable</code> scope behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Refreshable</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">static</span> <span class="type">class</span> <span class="class">WeatherService</span> {

    <span class="predefined-type">String</span> forecast

    <span class="annotation">@PostConstruct</span>
    <span class="type">void</span> init() {
        forecast = <span class="string"><span class="delimiter">&quot;</span><span class="content">Scattered Clouds </span><span class="inline"><span class="inline-delimiter">${</span><span class="keyword">new</span> <span class="predefined-type">Date</span>().format(<span class="string"><span class="delimiter">'</span><span class="content">dd/MMM/yy HH:ss.SSS</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="predefined-type">String</span> latestForecast() {
        <span class="keyword">return</span> forecast
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>WeatherService</code> is annotated with <code>@Refreshable</code> scope which stores an instance until a refresh event is triggered</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>forecast</code> property is set to a fixed value when the bean is created and won&#8217;t change until the bean is refreshed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you invoke the <code>latestForecast()</code> twice, you will see identical responses such as <code>"Scattered Clouds 01/Feb/18 10:29.199"</code>.</p>
</div>
<div class="paragraph">
<p>When the <code>/refresh</code> endpoint is invoked or a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> is published then the instance is invalidated and a new instance is created the next time the object is requested. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">applicationContext.publishEvent(<span class="keyword">new</span> RefreshEvent())</code></pre>
</div>
</div>


<h2 id="metaScopes">3.6.3 Scopes on Meta Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/scopes/metaScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Scopes can be defined on Meta annotations that you can then apply to your classes. Consider the following example meta annotation:</p>
</div>
<div class="listingblock">
<div class="title">Driver.java Annotation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Requires</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Documented</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Retention</span>;

<span class="annotation">@Requires</span>(classes = Car.class ) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Singleton</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Documented</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> <span class="predefined-type">Driver</span> {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The scope declares a requirement on a <code>Car</code> class using <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation is declared as <code>@Singleton</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example above the <code>@Singleton</code> annotation is applied to the <code>@Driver</code> annotation which results in every class that is annotated with <code>@Driver</code> being regarded as singleton.</p>
</div>
<div class="paragraph">
<p>Note that in this case it is not possible to alter the scope when the annotation is applied. For example, the following will not override the scope declared by <code>@Driver</code> and is invalid:</p>
</div>
<div class="listingblock">
<div class="title">Declaring Another Scope</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Driver</span>
<span class="annotation">@Prototype</span>
<span class="type">class</span> <span class="class">Foo</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish for the scope to be overridable you should instead using the <a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> annotation on <code>@Driver</code> which allows a default scope to be specified if none other is present:</p>
</div>
<div class="listingblock">
<div class="title">Using @DefaultScope</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Requires</span>(classes = Car.class )
<span class="annotation">@DefaultScope</span>(Singleton.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Documented</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> <span class="predefined-type">Driver</span> {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> is used to declare which scope to be used if non is present</td>
</tr>
</table>
</div>


<h2 id="factories">3.7 Bean Factories</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/factories.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In many cases, you may want to make available as a bean a class that is not part of your codebase such as those provided by third-party libraries. In this case, you cannot annotate the already compiled class. Instead, you should implement a <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a>.</p>
</div>
<div class="paragraph">
<p>A factory is a class annotated with the <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> annotation that provides 1 or more methods annotated with the <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation.</p>
</div>
<div class="paragraph">
<p>The return types of methods annotated with <code>@Bean</code> are the bean types. This is best illustrated by an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.*</span>
<span class="keyword">import</span> <span class="include">javax.inject.*</span>


<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">CrankShaft</span> {
}

<span class="type">class</span> <span class="class">V8Engine</span> <span class="directive">implements</span> Engine {
    <span class="directive">final</span> <span class="type">int</span> cylinders = <span class="integer">8</span>
    <span class="directive">final</span> CrankShaft crankShaft

    V8Engine(CrankShaft crankShaft) {
        <span class="local-variable">this</span>.crankShaft = crankShaft
    }

    <span class="predefined-type">String</span> start() {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting V8</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="annotation">@Factory</span>
<span class="type">class</span> <span class="class">EngineFactory</span> {

    <span class="annotation">@Bean</span>
    <span class="annotation">@Singleton</span>
    Engine v8Engine(CrankShaft crankShaft) {
        <span class="keyword">new</span> V8Engine(crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>V8Engine</code> is built by the <code>EngineFactory</code> class' <code>v8Engine</code> method. Note that you can inject parameters into the method and these parameters will be resolved as beans.</p>
</div>
<div class="paragraph">
<p>A factory can also have multiple methods annotated with <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> each one returning a distinct bean type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you take this approach, then you should not invoke other methods annotated with <code>@Bean</code> internally within the class. Instead, inject the types via parameters.
</td>
</tr>
</table>
</div>


<h2 id="conditionalBeans">3.8 Conditional Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/conditionalBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At times you may want a bean to load conditionally based on various potential factors including the classpath, the configuration, the presence of other beans etc.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation provides the ability to define one or many conditions on a bean.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@Requires</span>(beans = <span class="predefined-type">DataSource</span>.class)
<span class="annotation">@Requires</span>(property = <span class="string"><span class="delimiter">&quot;</span><span class="content">datasource.url</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JdbcBookService</span> <span class="directive">implements</span> BookService {

    <span class="predefined-type">DataSource</span> dataSource;

    <span class="directive">public</span> JdbcBookService(<span class="predefined-type">DataSource</span> dataSource) {
        <span class="local-variable">this</span>.dataSource = dataSource;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above bean defines two requirements. The first indicates that a <code>DataSource</code> bean must be present for the bean to load. The second requirement ensures that the <code>datasource.url</code> property is set before loading the <code>JdbcBookService</code> bean.</p>
</div>
<div class="paragraph">
<p>If you have multiple requirements that you find you may need to repeat on multiple beans then you can define a meta-annotation with the requirements:</p>
</div>
<div class="listingblock">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Documented</span>
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.PACKAGE, <span class="predefined-type">ElementType</span>.TYPE})
<span class="annotation">@Requires</span>(beans = <span class="predefined-type">DataSource</span>.class)
<span class="annotation">@Requires</span>(property = <span class="string"><span class="delimiter">&quot;</span><span class="content">datasource.url</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="annotation">@interface</span> RequiresJdbc {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example an annotation called <code>RequiresJdbc</code> is defined that can then be used on the <code>JdbcBookService</code> instead:</p>
</div>
<div class="listingblock">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequiresJdbc</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">JdbcBookService</span> <span class="directive">implements</span> BookService {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have multiple beans that need to fulfill a given requirement before loading then you may want to consider a bean configuration group, as explained in the next section.</p>
</div>
<div class="sect1">
<h2 id="_configuration_requirements">Configuration Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> annotation is very flexible and can be used for a variety of use cases. The following table summarizes some of the possibilities:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Using @Requires</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Requirement</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one ore more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(classes=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one ore more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missing=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(beans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingBeans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to not be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(notEnv="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(configuration="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingConfigurations="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require particular SDK version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(sdk=Sdk.JAVA, value="1.8")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires classes annotated with the given annotations to be available to the application via package scanning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(entities=javax.persistence.Entity)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property with an optional value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(property="data-source.url")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property to not be part of the configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingProperty="data-source.url")</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_additional_notes_on_property_requirements">Additional Notes on Property Requirements.</h3>
<div class="paragraph">
<p>Adding a requirement on a property has some additional functionality. You can require the property to be a certain value, not be a certain value, and use a default in those checks if its not set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Requires</span>(property=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Requires</span>(property=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, value=<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Requires</span>(property=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, value=<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>, defaultValue=<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
<span class="annotation">@Requires</span>(property=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, notEquals=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sally</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Requires the property to be "yes", "YES", "true", "TRUE", "y" or "Y"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Requires the property to be "John"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Requires the property to be "John" or not set</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Requires the property to not be "Sally" or not set</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_conditional_beans">Debugging Conditional Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have multiple conditions and complex requirements it may become difficult to understand why a particular bean has not been loaded.</p>
</div>
<div class="paragraph">
<p>To help resolve issues with conditional beans you can enable debug logging for the <code>io.micronaut.context.condition</code> package which will log the reasons why beans were not loaded.</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.context.condition</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DEBUG</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="replaces">3.9 Bean Replacement</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/replaces.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>One significant difference between Micronaut&#8217;s Dependency Injection system and Spring is the way beans can be replaced.</p>
</div>
<div class="paragraph">
<p>With Spring beans have names and you can effectively override another bean just be creating a bean with the same name regardless of the type of the bean. Spring also has the notion of bean registration order, hence in Spring Boot you have <code>@AutoConfigureBefore</code> and <code>@AutoConfigureAfter</code> the control how beans override each other.</p>
</div>
<div class="paragraph">
<p>This strategy leads to difficult to debug problems in cases where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bean loading order changes, leading to unexpected results</p>
</li>
<li>
<p>A bean with the same name overrides another bean with a different type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid these problems, the design of Micronaut DI has no concept of bean names or load order. Beans have a type and a <a href="../api/io/micronaut/context/Qualifier.html">Qualifier</a>. You cannot override a bean of a completely different type with another.</p>
</div>
<div class="paragraph">
<p>However, one feature that the Spring way of doing things enables is that it allows overriding existing beans to customize behaviour.</p>
</div>
<div class="paragraph">
<p>To support this use case Micronaut DI has an explicit <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation, which integrates nicely with support for <a href="#conditionalBeans">Conditional Beans</a> and clearly documents and expresses the purpose and intent.</p>
</div>
<div class="paragraph">
<p>Basically any existing bean can be replaced by another bean that declares <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a>.</p>
</div>
<div class="paragraph">
<p>For example, consider the following class:</p>
</div>
<div class="listingblock">
<div class="title">JdbcBookService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@Requires</span>(beans = <span class="predefined-type">DataSource</span>.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JdbcBookService</span> <span class="directive">implements</span> BookService {

    <span class="predefined-type">DataSource</span> dataSource;

    <span class="directive">public</span> JdbcBookService(<span class="predefined-type">DataSource</span> dataSource) {
        <span class="local-variable">this</span>.dataSource = dataSource;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a class in <code>src/test/java</code> that replaces this class just for your tests:</p>
</div>
<div class="listingblock">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Replaces</span>(JdbcBookService.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Requires</span>(env = Environment.TEST) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MockBookService</span> <span class="directive">implements</span> BookService {

    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Book</span>&gt; bookMap = <span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;&gt;();

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Book</span> findBook(<span class="predefined-type">String</span> title) {
        <span class="keyword">return</span> bookMap.get(title);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>MockBookService</code> declares that it replaces <code>JdbcBookService</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>But only for for the <code>test</code> environment</td>
</tr>
</table>
</div>


<h2 id="configurations">3.10 Bean Configurations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/configurations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A bean <a href="../api/io/micronaut/context/annotation/Configuration.html">@Configuration</a> is a grouping of multiple bean definitions within a package.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is applied at the package level and informs Micronaut that the beans defined with the package form a logical grouping.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is typically applied to <code>package-info</code> class. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Configuration</span>
<span class="keyword">package</span> my.package

<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Configuration</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where this grouping becomes useful is when the bean configuration is made conditional via the <code>@Requires</code> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Configuration</span>
<span class="annotation">@Requires</span>(beans = javax.sql.DataSource)
<span class="keyword">package</span> my.package</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, all bean definitions within the annotated package will only be loaded and made available if a <code>javax.sql.DataSource</code> bean is present. This allows you to implement conditional auto-configuration of bean definitions.</p>
</div>


<h2 id="lifecycle">3.11 Life-Cycle Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/lifecycle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you wish for a particular method to be invoked when a bean is constructed then you can use the <code>javax.annotation.PostConstruct</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">javax.annotation.PostConstruct</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">V8Engine</span> <span class="directive">implements</span> Engine {
    <span class="type">int</span> cylinders = <span class="integer">8</span>
    <span class="type">boolean</span> initialized = <span class="predefined-constant">false</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="predefined-type">String</span> start() {
        <span class="keyword">if</span>(!initialized) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Engine not initialized!</span><span class="delimiter">&quot;</span></span>)

        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting V8</span><span class="delimiter">&quot;</span></span>
    }

    <span class="annotation">@PostConstruct</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="type">void</span> initialize() {
        <span class="local-variable">this</span>.initialized = <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PostConstruct</code> annotation is imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A field is defined that requires initialization</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A method is annotated with <code>@PostConstruct</code> and will be invoked once the object is constructed and fully injected.</td>
</tr>
</table>
</div>


<h2 id="events">3.12 Bean Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/events.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can hook into the creation of beans using one of the following interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/context/event/BeanInitializedEventListener.html">BeanInitializedEventListener</a> - allows modifying or replacing of a bean after the properties have been set but prior to <code>@PostConstruct</code> event hooks.</p>
</li>
<li>
<p><a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> - allows modifying or replacing of a bean after the bean is fully initialized and all <code>@PostConstruct</code> hooks called.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>BeanInitializedEventListener</code> interface is commonly used in combination with <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> beans. Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">javax.inject.*</span>

<span class="type">class</span> <span class="class">V8Engine</span> <span class="directive">implements</span> Engine {
    <span class="directive">final</span> <span class="type">int</span> cylinders = <span class="integer">8</span>
    <span class="type">double</span> rodLength <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="predefined-type">String</span> start() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting V</span><span class="inline"><span class="inline-delimiter">${</span>cylinders<span class="inline-delimiter">}</span></span><span class="content"> [rodLength=</span><span class="inline"><span class="inline-delimiter">$</span>rodLength</span><span class="content">]</span><span class="delimiter">&quot;</span></span>
    }
}

<span class="annotation">@Factory</span>
<span class="type">class</span> <span class="class">EngineFactory</span> {

    <span class="directive">private</span> V8Engine engine
    <span class="type">double</span> rodLength = <span class="float">5.7</span>

    <span class="annotation">@PostConstruct</span>
    <span class="type">void</span> initialize() {
        engine = <span class="keyword">new</span> V8Engine(<span class="key">rodLength</span>: rodLength) <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="annotation">@Bean</span>
    <span class="annotation">@Singleton</span>
    Engine v8Engine() {
        <span class="keyword">return</span> engine <i class="conum" data-value="3"></i><b>(3)</b>
    }
}

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">EngineInitializer</span> <span class="directive">implements</span> BeanInitializedEventListener&lt;EngineFactory&gt; { <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="annotation">@Override</span>
    EngineFactory onInitialized(BeanInitializingEvent&lt;EngineFactory&gt; event) {
        EngineFactory engineFactory = event.bean
        engineFactory.rodLength = <span class="float">6.6</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="keyword">return</span> event.bean
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>V8Engine</code> class defines a <code>rodLength</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EngineFactory</code> initializes the value of <code>rodLength</code> and creates the instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The created instance is returned as a <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>BeanInitializedEventListener</code> interface is implemented to listen for the initialization of the factory</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Within the <code>onInitialized</code> method the <code>rodLength</code> is overridden prior to the engine being created by the factory bean.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> interface is more typically used to decorate or enhance a fully initialized bean by creating a proxy for example.</p>
</div>


<h2 id="annotationMetadata">3.13 Bean Annotation Metadata</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/annotationMetadata.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The methods provided by Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AnnotatedElement.html">AnnotatedElement</a> API in general don&#8217;t provide the ability to introspect annotations without loading the annotations themselves, nor do they provide any ability to introspect annotation stereotypes (Often called meta-annotations, an annotation stereotype is where an annotation is annotated with another annotation, essentially inheriting its behaviour).</p>
</div>
<div class="paragraph">
<p>To solve this problem many frameworks produce runtime metadata or perform expensive reflection to analyze the annotations of a class.</p>
</div>
<div class="paragraph">
<p>Micronaut instead produces this annotation metadata at compile time, avoiding expensive reflection and saving on memory.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> API can be used to obtain a reference to a <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> which implements the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> interface.</p>
</div>
<div class="paragraph">
<p>For example the following code will obtain all bean definitions annotated with a particular stereotype:</p>
</div>
<div class="listingblock">
<div class="title">Lookup Bean Definitions by Stereotype</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">BeanContext</span> beanContext = ... <span class="comment">// obtain the bean context</span>
Collection&lt;BeanDefinition&gt; definitions =
    beanContext.getBeanDefinitions(Qualifiers.byStereotype(Controller.class))

<span class="keyword">for</span>(BeanDefinition definition : definitions) {
    Controller controllerAnn = definition.getAnnotation(Controller.class);
    <span class="comment">// do something with the annotation</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will find all <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> annotated with <code>@Controller</code> regardless whether <code>@Controller</code> is used directly or inherited via an annotation stereotype.</p>
</div>
<div class="paragraph">
<p>Like Spring, Micronaut also supports an <a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a> annotation that allows an annotation member to represent the value of another annotation member.</p>
</div>


<h2 id="springBeans">3.14 Micronaut Beans And Spring</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/springBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/spring/beans/MicronautBeanProcessor.html">MicronautBeanProcessor</a>
class is a <code>BeanFactoryPostProcessor</code> which will add Micronaut beans to a
Spring Application Context.  An instance of <code>MicronautBeanProcessor</code> should
be added to the Spring Application Context.  <code>MicronautBeanProcessor</code> requires
a constructor parameter which represents the stereotype annotation for
the Micronaut beans which should be added the Spring Application Context.  The
processor may be used in any Spring application.  As an example, a Grails 3
application could take advantage of <code>MicronautBeanProcessor</code> to add all of the
Micronaut HTTP Client beans to the Spring Application Context with something
like the folowing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// grails-app/conf/spring/resources.groovy</span>
<span class="keyword">import</span> <span class="include">io.micronaut.spring.beans.MicronautBeanProcessor</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.Client</span>

beans = {
    httpClientBeanProcessor MicronautBeanProcessor, Client
}</code></pre>
</div>
</div>


<h2 id="android">3.15 Android Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/ioc/android.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut dependency injection is based on annotation processors and doesn&#8217;t rely on reflection, it can be used on Android when using the Android plugin 3.0.0 or above.</p>
</div>
<div class="paragraph">
<p>This allows you to use the same application framework for both your Android client and server implementation.</p>
</div>
<div class="sect1">
<h2 id="_configuring_your_android_build">Configuring Your Android Build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started you must add the Micronaut annotation processors to the processor classpath using the <code>annotationProcessor</code> dependency configuration.</p>
</div>
<div class="paragraph">
<p>The Micronaut <code>inject-java</code> dependency should be included in both the <code>annotationProcessor</code> and <code>compileOnly</code> scopes of your Android build configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Android build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    annotationProcessor "io.micronaut:inject-java:1.0.0.M1"
    compileOnly "io.micronaut:inject-java:1.0.0.M1"
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>lint</code> as part of your build you may also need to disable the invalid packages check since Android includes a hard coded check that regards the <code>javax.inject</code> package as invalid unless you are using Dagger:</p>
</div>
<div class="listingblock">
<div class="title">Configure lint within build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">android {
    ...
    lintOptions {
        lintOptions { warning <span class="string"><span class="delimiter">'</span><span class="content">InvalidPackage</span><span class="delimiter">'</span></span> }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information on <a href="https://developer.android.com/studio/build/gradle-plugin-3-0-0-migration.html#annotationProcessor_config">configuring annotations processors</a> in the Android documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut <code>inject-java</code> dependency uses <a href="https://developer.android.com/studio/write/java8-support.html">Android Java 8 support</a> features.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_dependency_injection">Enabling Dependency Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have configured the classpath correctly, the next step is start the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates creating a subclass of <a href="https://developer.android.com/reference/android/app/Application.html">android.app.Application</a> for that purpose:</p>
</div>
<div class="listingblock">
<div class="title">Example Android Application Class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">android.app.Activity</span>;
<span class="keyword">import</span> <span class="include">android.app.Application</span>;
<span class="keyword">import</span> <span class="include">android.os.Bundle</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.context.ApplicationContext</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.env.Environment</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">BaseApplication</span> <span class="directive">extends</span> Application { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">private</span> ApplicationContext ctx;

    <span class="directive">public</span> BaseApplication() {
        <span class="local-variable">super</span>();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onCreate() {
        <span class="local-variable">super</span>.onCreate();
        ctx = ApplicationContext.run(MainActivity.class, Environment.ANDROID); <i class="conum" data-value="2"></i><b>(2)</b>
        registerActivityLifecycleCallbacks(<span class="keyword">new</span> ActivityLifecycleCallbacks() { <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onActivityCreated(Activity activity, Bundle bundle) {
                ctx.inject(activity);
            }
            ... <span class="comment">// shortened for brevity, it is not necessary to implement other methods</span>
        });
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onTerminate() {
        <span class="local-variable">super</span>.onTerminate();
        <span class="keyword">if</span>(ctx != <span class="predefined-constant">null</span> &amp;&amp; ctx.isRunning()) { <i class="conum" data-value="4"></i><b>(4)</b>
            ctx.stop();
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend the <code>android.app.Application</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Run the <code>ApplicationContext</code> with the <code>ANDROID</code> environment</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To allow dependency injection of Android <code>Activity</code> instances register a <code>ActivityLifecycleCallbacks</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Stop the <code>ApplicationContext</code> when the application terminates</td>
</tr>
</table>
</div>
</div>
</div>


<h1 id="config">4 Application Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Configuration in Micronaut takes inspiration from both Spring Boot and Grails and integrates them directly into the core IoC container.</p>
</div>
<div class="paragraph">
<p>Configuration can by default be provided in either Java properties, YAML, JSON or Groovy files. The convention is to search for a file called <code>application.yml</code>, <code>application.properties</code>, <code>application.json</code> or <code>application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>In addition, just like Spring and Grails, Micronaut allows overriding any property via system properties or environment variables.</p>
</div>
<div class="paragraph">
<p>Each source of configuration is modeled with the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> interface and the mechanism is extensible allowing the implementation of additional <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> implementations.</p>
</div>


<h2 id="environments">4.1 The Environment</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/environments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The application environment is modelled by the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface, which allows specifying one or many unique environment names when creating an <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext applicationContext = ApplicationContext.run(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">android</span><span class="delimiter">&quot;</span></span>);
Environment environment = applicationContext.getEnvironment();

assertTrue(environment.getActiveNames().contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>));
assertTrue(environment.getActiveNames().contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">android</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The active environment names serve the purpose of allowing loading different configuration files depending on the environment and also using the <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> annotation to conditionally load beans or bean <a href="../api/io/micronaut/context/annotation/Configuration.html">@Configuration</a> packages.</p>
</div>
<div class="paragraph">
<p>In addition, Micronaut will attempt to detect the current environments. For example within a Spock or JUnit test the <a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a> environment will be automatically active.</p>
</div>
<div class="paragraph">
<p>Additional active environments can be specified using the <code>micronaut.environments</code> system property or the <code>MICRONAUT_ENVIRONMENTS</code> environment variable. These can be specified as a comma separated list. For example:</p>
</div>
<div class="listingblock">
<div class="title">Specifying environments</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ java -Dmicronaut.environments=foo,bar -jar myapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above activates environments called <code>foo</code> and <code>bar</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the Cloud environment names are also detected. See the section on <a href="#cloudConfiguration">Cloud Configuration</a> for more information.</p>
</div>


<h2 id="propertySource">4.2 PropertySources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/propertySource.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Additional <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances can be added to the environment prior to initializing the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext applicationContext = ApplicationContext.run(
        PropertySource.of(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>,
                CollectionUtils.mapOf(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut.server.host</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut.server.port</span><span class="delimiter">&quot;</span></span>, <span class="integer">8080</span>
                )
        ),
        <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">android</span><span class="delimiter">&quot;</span></span>);
Environment environment = applicationContext.getEnvironment();

assertEquals(
        environment.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut.server.host</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class).orElse(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>),
        <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource.of</a> method can be used to create a <code>ProperySource</code> from a map of values.</p>
</div>
<div class="paragraph">
<p>Alternatively one can register a <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> by creating a <code>META-INF/services/io.micronaut.context.env.PropertySourceLoader</code> containg a reference to the class name of the <code>PropertySourceLoader</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut by default contains <code>PropertySourceLoader</code> implementations that load properties from the given locations and priority:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Command line arguments</p>
</li>
<li>
<p>Properties from <code>SPRING_APPLICATION_JSON</code> (for Spring compatibility)</p>
</li>
<li>
<p>Properties from <code>MICRONAUT_APPLICATION_JSON</code></p>
</li>
<li>
<p>Java System Properties</p>
</li>
<li>
<p>OS environment variables</p>
</li>
<li>
<p>Enviroment-specific properties from <code>application-{environment}.{extension}</code> (Either <code>.properties</code>, <code>.json</code>, <code>.yml</code> or <code>.groovy</code> property formats supported)</p>
</li>
<li>
<p>Application-specific properties from <code>application.{extension}</code> (Either <code>.properties</code>, <code>.json</code>, <code>.yml</code> or <code>.groovy</code> property formats supported)</p>
</li>
</ul>
</div>


<h2 id="valueAnnotation">4.3 Configuration Injection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/valueAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like Spring Boot and Grails, you can inject configuration values into beans with Micronaut using the <a href="../api/io/micronaut/context/annotation/Value.html">Value</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">@Value Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Value</span>
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">EngineImpl</span> <span class="directive">implements</span> Engine {

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">'</span><span class="content">${my.engine.cylinders:6}</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">protected</span> <span class="type">int</span> cylinders

    <span class="annotation">@Override</span>
    <span class="type">int</span> getCylinders() {
        <span class="local-variable">this</span>.cylinders
    }

    <span class="predefined-type">String</span> start() { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting V</span><span class="inline"><span class="inline-delimiter">${</span>cylinders<span class="inline-delimiter">}</span></span><span class="content"> Engine</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Value</code> annotation accepts a string that is the name of a property to be used as the source for the value. A default value can be optionally supplied after the colon.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The injected value can then be used within code.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unlike the aforementioned frameworks, Micronaut will use ASM to generate reflection free bytecode to optimize startup time and value injection performance.</p>
</div>
<div class="paragraph">
<p>Note that there is nothing special about <code>@Value</code> itself regarding the resolution of property value placeholders. Due to Micronaut&#8217;s extensive support for annotation metadata you can in fact use property placeholder expressions on any annotation. For example, to make the path of a <code>@Controller</code> configurable you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${hello.controller.path:/hello}</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">HelloController</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case if <code>hello.controller.path</code> is specified in configuration then the controller will be mapped to the path specified otherwise it will be mapped to <code>/hello</code>.</p>
</div>


<h2 id="configurationProperties">4.4 Configuration Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/configurationProperties.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like Spring Boot and Grails, you can create type safe configuration by creating classes that are annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut, however, will produce a reflection free <code>@ConfigurationProperties</code> bean and will also at compile time calculate the property paths to evaluate, greatly improving the speed and efficiency of loading <code>@ConfigurationProperties</code>.</p>
</div>
<div class="paragraph">
<p>An example of a configuration class can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.hibernate.validator.constraints.NotBlank</span>
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.ConfigurationProperties</span>

<span class="keyword">import</span> <span class="include">javax.validation.constraints.Min</span>

<span class="annotation">@ConfigurationProperties</span>(<span class="string"><span class="delimiter">'</span><span class="content">my.engine</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">EngineConfig</span> {

    <span class="annotation">@NotBlank</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">String</span> manufacturer = <span class="string"><span class="delimiter">&quot;</span><span class="content">Ford</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@Min</span>(<span class="integer">1L</span>)
    <span class="type">int</span> cylinders
    CrankShaft crankShaft = <span class="keyword">new</span> CrankShaft()

    <span class="annotation">@ConfigurationProperties</span>(<span class="string"><span class="delimiter">'</span><span class="content">crank-shaft</span><span class="delimiter">'</span></span>)
    <span class="directive">static</span> <span class="type">class</span> <span class="class">CrankShaft</span> { <i class="conum" data-value="4"></i><b>(4)</b>
        Optional&lt;<span class="predefined-type">Double</span>&gt; rodLength = Optional.empty() <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <code>javax.validation</code> to validate the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default values can be assigned to the property</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Static inner classes can provided nested configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional configuration values can be wrapped in a <code>java.util.Optional</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have prepared a type safe configuration it can simply be injected into your objects like any other bean:</p>
</div>
<div class="listingblock">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">EngineImpl</span> <span class="directive">implements</span> Engine {
    <span class="directive">final</span> EngineConfig config

    EngineImpl(EngineConfig config) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="local-variable">this</span>.config = config
    }

    <span class="annotation">@Override</span>
    <span class="type">int</span> getCylinders() {
        <span class="keyword">return</span> config.cylinders
    }

    <span class="predefined-type">String</span> start() { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>config.manufacturer<span class="inline-delimiter">}</span></span><span class="content"> Engine Starting V</span><span class="inline"><span class="inline-delimiter">${</span>config.cylinders<span class="inline-delimiter">}</span></span><span class="content"> [rodLength=</span><span class="inline"><span class="inline-delimiter">${</span>config.crankShaft.rodLength.orElse(<span class="float">6.0d</span>)<span class="inline-delimiter">}</span></span><span class="content">]</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EngineConfig</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the configuration properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration values can then be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext applicationContext = ApplicationContext.run(
        [<span class="string"><span class="delimiter">'</span><span class="content">my.engine.cylinders</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">8</span><span class="delimiter">'</span></span>],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>
)

Vehicle vehicle = applicationContext
        .getBean(Vehicle)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Ford Engine Starting V8 [rodLength=6.0]"</code></p>
</div>
<div class="paragraph">
<p>Note for more complex configurations you can structure <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans through inheritance.</p>
</div>
<div class="paragraph">
<p>For example creating a subclass of <code>EngineConfig</code> with <code>@ConfigurationProperties('bar')</code> will resolve all properties under the path <code>my.engine.bar</code>.</p>
</div>
<div class="sect1">
<h2 id="_configuration_builder">Configuration Builder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many existing frameworks and tools already use builder-style classes to construct configuration.</p>
</div>
<div class="paragraph">
<p>To support the ability for a builder style class to be populated with configuration values, the <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">@ConfigurationBuilder</a> annotation can be used. <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">ConfigurationBuilder</a> can be added to a field or method in a class annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Since there is no consistent way to define builders in the Java world, one or more method prefixes can be specified in the annotation to support builder methods like <code>withXxx</code> or <code>setXxx</code>. If the builder methods have no prefix, assign an empty string to the parameter.</p>
</div>
<div class="paragraph">
<p>A configuration prefix can also be specified to tell Micronaut where to look for configuration values. By default, the builder methods will use the configuration prefix defined at the class level <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">@ConfigurationBuilder Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.ConfigurationBuilder</span>
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.ConfigurationProperties</span>

<span class="annotation">@ConfigurationProperties</span>(<span class="string"><span class="delimiter">'</span><span class="content">my.engine</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">EngineConfig</span> {

    <span class="annotation">@ConfigurationBuilder</span>(prefixes = <span class="string"><span class="delimiter">&quot;</span><span class="content">with</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    EngineImpl.Builder builder = EngineImpl.builder()

    <span class="annotation">@ConfigurationBuilder</span>(prefixes = <span class="string"><span class="delimiter">&quot;</span><span class="content">with</span><span class="delimiter">&quot;</span></span>, configurationPrefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">crankShaft</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    CrankShaft.Builder crankShaft = CrankShaft.builder()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first builder can be configured with the class configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The second builder can be configured with the class configuration prefix + the <code>configurationPrefix</code> value.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, only builder methods that take a single argument are supported. To support methods with no arguments, set the <code>allowZeroArgs</code> parameter of the annotation to true.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just like in the previous example, we can construct an <code>EngineImpl</code>. Since we are using a builder, a factory class can be used to build the engine from the builder.</p>
</div>
<div class="listingblock">
<div class="title">Factory Bean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Bean</span>
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Factory</span>

<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>

<span class="annotation">@Factory</span>
<span class="type">class</span> <span class="class">EngineFactory</span> {

    <span class="annotation">@Bean</span>
    <span class="annotation">@Singleton</span>
    EngineImpl buildEngine(EngineConfig engineConfig) {
        engineConfig.builder.build(engineConfig.crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The engine that was returned can then be injected anywhere an engine is depended on.</p>
</div>
<div class="paragraph">
<p>Configuration values can be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext applicationContext = ApplicationContext.run(
        [<span class="string"><span class="delimiter">'</span><span class="content">my.engine.cylinders</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">4</span><span class="delimiter">'</span></span>,
         <span class="string"><span class="delimiter">'</span><span class="content">my.engine.manufacturer</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">Subaru</span><span class="delimiter">'</span></span>,
         <span class="string"><span class="delimiter">'</span><span class="content">my.engine.crankShaft.rodLength</span><span class="delimiter">'</span></span>: <span class="integer">4</span>],
        <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>
)

Vehicle vehicle = applicationContext
        .getBean(Vehicle)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Subaru Engine Starting V4 [rodLength=4.0]"</code></p>
</div>
</div>
</div>


<h2 id="customTypeConverter">4.5 Custom Type Converters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/customTypeConverter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features a built in type conversion mechanism that is extensible. To add additional type converters you register beans of type <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use one of the built-in converters (Map to an Object) or create your own.</p>
</div>
<div class="paragraph">
<p>Consider the following <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">ConfigurationProperties</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ConfigurationProperties</span>(MyConfigurationProperties.PREFIX)
<span class="type">class</span> <span class="class">MyConfigurationProperties</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PREFIX = <span class="string"><span class="delimiter">&quot;</span><span class="content">myapp</span><span class="delimiter">&quot;</span></span>
    <span class="directive">protected</span> LocalDate updatedAt

    LocalDate getUpdatedAt() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.updatedAt
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type <code>MyConfigurationProperties</code> features a property called <code>updatedAt</code> which is of type <a href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html">LocalDate</a>.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s say you want to allow binding to this property from a map via configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext ctx = ApplicationContext.run(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">myapp.updatedAt</span><span class="delimiter">&quot;</span></span>: [<span class="key">day</span>: <span class="integer">28</span>, <span class="key">month</span>: <span class="integer">10</span>, <span class="key">year</span>: <span class="integer">1982</span>]  <i class="conum" data-value="1"></i><b>(1)</b>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This won&#8217;t work by default, since there is no built in conversion from <code>Map</code> to <code>LocalDate</code>. To resolve this you can define a custom <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.core.convert.*</span>
<span class="keyword">import</span> <span class="include">java.time.*</span>
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">MapToLocalDateConverter</span> <span class="directive">implements</span> TypeConverter&lt;<span class="predefined-type">Map</span>, LocalDate&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Override</span>
    Optional&lt;LocalDate&gt; convert(<span class="predefined-type">Map</span> object, <span class="predefined-type">Class</span>&lt;LocalDate&gt; targetType, ConversionContext context) {
        Optional&lt;<span class="predefined-type">Integer</span>&gt; day = ConversionService.SHARED.convert(object.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">day</span><span class="delimiter">&quot;</span></span>), <span class="predefined-type">Integer</span>.class)
        Optional&lt;<span class="predefined-type">Integer</span>&gt; month = ConversionService.SHARED.convert(object.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">month</span><span class="delimiter">&quot;</span></span>), <span class="predefined-type">Integer</span>.class)
        Optional&lt;<span class="predefined-type">Integer</span>&gt; year = ConversionService.SHARED.convert(object.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">year</span><span class="delimiter">&quot;</span></span>), <span class="predefined-type">Integer</span>.class)
        <span class="keyword">if</span> (day.isPresent() &amp;&amp; month.isPresent() &amp;&amp; year.isPresent()) {
            <span class="keyword">try</span> {
                <span class="keyword">return</span> Optional.of(LocalDate.of(year.get(), month.get(), day.get())) <i class="conum" data-value="2"></i><b>(2)</b>
            } <span class="keyword">catch</span> (DateTimeException e) {
                context.reject(object, e) <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="keyword">return</span> Optional.empty()
            }
        }
        <span class="keyword">return</span> Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class implements <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> which takes two generic arguments. The type you are converting from and the type you are converting to</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The implementation delegate to the default shared conversion service to convert the parts of the map that make the day, month and year into a <code>LocalDate</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If an exception occurs you can call <code>reject(..)</code> which propagates additional information to the container if something goes wrong during binding</td>
</tr>
</table>
</div>


<h2 id="eachProperty">4.6 Using @EachProperty to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/eachProperty.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation is great for a single configuration class, but sometimes you want multiple instances each with their own distinct configuration. That is where <a href="../api/io/micronaut/context/annotation/EachProperty.html">EachProperty</a> comes in.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> annotation will create a <code>ConfigurationProperties</code> bean for each sub-property within the given property. As an example consider the following class:</p>
</div>
<div class="listingblock">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Parameter</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.EachProperty</span>;

<span class="annotation">@EachProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.datasource</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DataSourceConfiguration</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">URI</span> url = <span class="keyword">new</span> <span class="predefined-type">URI</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> DataSourceConfiguration(<span class="annotation">@Parameter</span> <span class="predefined-type">String</span> name) <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="directive">throws</span> <span class="exception">URISyntaxException</span> {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="predefined-type">URI</span> getUrl() { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> url;
    }

    <span class="directive">public</span> <span class="type">void</span> setUrl(<span class="predefined-type">URI</span> url) {
        <span class="local-variable">this</span>.url = url;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EachProperty</code> annotation defines the property name that should be handled.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Parameter</code> annotation can be used to inject the name of the sub-property that defines the name of the bean (which is also the bean qualifier)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each property of the bean is bound to configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above <code>DataSourceConfiguration</code> defines a <code>url</code> property to configure one or many hypothetical data sources of some sort. The URLs themselves can be configured using any of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances evaluated to Micronaut:</p>
</div>
<div class="listingblock">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext applicationContext = ApplicationContext.run(PropertySource.of(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>,
        CollectionUtils.mapOf(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">test.datasource.one.url</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost/one</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">test.datasource.two.url</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost/two</span><span class="delimiter">&quot;</span></span>)
));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example two data sources (called <code>one</code> and <code>two</code>) are defined under the <code>test.datasource</code> prefix defined earlier in the <code>@EachProperty</code> annotation. Each of these configuration entries triggers the creation of a new <code>DataSourceConfiguration</code> bean such that the following test succeeds:</p>
</div>
<div class="listingblock">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Collection</span>&lt;DataSourceConfiguration&gt; beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration.class);
assertEquals(beansOfType.size(), <span class="integer">2</span>); <i class="conum" data-value="1"></i><b>(1)</b>

DataSourceConfiguration firstConfig = applicationContext.getBean(
        DataSourceConfiguration.class,
        Qualifiers.byName(<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
);

assertEquals(
        firstConfig.getUrl(),
        <span class="keyword">new</span> <span class="predefined-type">URI</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost/one</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All beans of type <code>DataSourceConfiguration</code> can be retrieved using <code>getBeansOfType</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Individual beans can be achieved by using the <code>byName</code> qualifier.</td>
</tr>
</table>
</div>


<h2 id="eachBean">4.7 Using @EachBean to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/eachBean.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> is a great way to drive dynamic configuration, but typically you want to inject that configuration into another bean that depends on it. Injecting a single instance with a hard coded qualifier is not a great solution, hence <code>@EachProperty</code> is typically used in combination with <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Factory</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DataSourceFactory</span> {

    <span class="annotation">@EachBean</span>(DataSourceConfiguration.class) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">DataSource</span> dataSource(DataSourceConfiguration configuration) { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="predefined-type">URI</span> url = configuration.getUrl();
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">DataSource</span>(url);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above example defines a bean <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> that will create instances of <code>javax.sql.DataSource</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a> annotation is used to indicate that a new <code>DataSource</code> bean should be created for each <code>DataSourceConfiguration</code> defined in the previous section.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>DataSourceConfiguration</code> instance is injected as a method argument and used to drive the configuration of each <code>javax.sql.DataSource</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>@EachBean</code> requires that the parent bean has a <code>@Named</code> qualifier, since the qualifier is inherited by each bean created by <code>@EachBean</code>.</p>
</div>
<div class="paragraph">
<p>In other words try retrieve the <code>DataSource</code> created by <code>test.datasource.one</code> you can do:</p>
</div>
<div class="listingblock">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">DataSource</span> firstDataSource = applicationContext.getBean(
        <span class="predefined-type">DataSource</span>.class,
        Qualifiers.byName(<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>


<h1 id="aop">5 Aspect Oriented Programming</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Aspect-Oriented Programming (AOP) historically has had many incarnations and some very complicated implementations. Generally AOP can be thought of as a way to define cross cutting concerns (logging, transactions, tracing etc.) separate from application code in the form of aspects that define advice.</p>
</div>
<div class="paragraph">
<p>There are typically two forms of advice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Around Advice - decorates a method or class</p>
</li>
<li>
<p>Introduction Advice - introduces new behaviour to a class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In modern Java applications declaring advice typically takes the form of an annotation. The most well-known annotation advice in the Java world is probably <code>@Transactional</code> which is used to demarcate transaction boundries in Spring and Grails applications.</p>
</div>
<div class="paragraph">
<p>The disadvantage of traditional approaches to AOP is the heavy reliance on runtime proxy creation and reflection, which slows application performance, makes debugging harder and increases memory consumption.</p>
</div>
<div class="paragraph">
<p>Micronaut tries to address these concerns by providing a simple compile time AOP API that does not use reflection.</p>
</div>


<h2 id="aroundAdvice">5.1 Around Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/aroundAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The most common type of advice you may want to apply is "Around" advice, which essentially allows you decorate a methods behaviour.</p>
</div>
<div class="sect1">
<h2 id="_writing_around_advice">Writing Around Advice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step to defining Around advice is to implement a <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a>. For example the following interceptor disallows parameters with <code>null</code> values:</p>
</div>
<div class="listingblock">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.aop</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.core.type.MutableArgumentValue</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.util</span>.*;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NotNullInterceptor</span> <span class="directive">implements</span> MethodInterceptor&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> intercept(MethodInvocationContext&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; context) {
        Optional&lt;<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, MutableArgumentValue&lt;?&gt;&gt;&gt; nullParam = context.getParameters()
            .entrySet()
            .stream()
            .filter(entry -&gt; {
                MutableArgumentValue&lt;?&gt; argumentValue = entry.getValue();
                <span class="keyword">return</span> Objects.isNull(argumentValue.getValue());
            })
            .findFirst(); <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">if</span> (nullParam.isPresent()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null parameter [</span><span class="delimiter">&quot;</span></span> + nullParam.get().getKey() + <span class="string"><span class="delimiter">&quot;</span><span class="content">] not allowed</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> context.proceed(); <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An interceptor implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The passed <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> is used to find the first parameter that is <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If a <code>null</code> parameter is found an exception is thrown</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise <a href="../api/io/micronaut/aop/InvocationContext.html#proceed--">proceed()</a> is called to proceed with the method invocation.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut AOP interceptors use no reflection which improves performance and reducing stack trace sizes, thus improving debugging.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To put the new <code>MethodInterceptor</code> to work the next step is to define an annotation that will trigger the <code>MethodInterceptor</code>:</p>
</div>
<div class="listingblock">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Type</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.aop.Around</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation</span>.*;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;

<span class="annotation">@Documented</span>
<span class="annotation">@Retention</span>(RUNTIME) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD}) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Around</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="annotation">@Type</span>(NotNullInterceptor.class) <i class="conum" data-value="4"></i><b>(4)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> NotNull {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The retention policy of the annotation should be <code>RUNTIME</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generally you want to be able to apply advice at the class or method level so the target types are <code>TYPE</code> and <code>METHOD</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/aop/Around.html">Around</a> annotation is added to tell Micronaut that the annotation is Around advice</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Type.html">@Type</a> annotation is used to configure which type implements the advice (in this case the previously defined <code>NotNullInterceptor</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the interceptor and annotation implemented you can then simply apply the annotation to the target classes:</p>
</div>
<div class="listingblock">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NotNullExample</span> {

    <span class="annotation">@NotNull</span>
    <span class="type">void</span> doWork(<span class="predefined-type">String</span> taskName) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Doing job: </span><span class="delimiter">&quot;</span></span> + taskName);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever the type <code>NotNullExample</code> is injected into any class a compile time generated proxy will instead by injected that decorates the appropriate method calls with the <code>@NotNull</code> advice defined earlier. You can verify that the advice works by writing a test. The following test uses a JUnit <code>ExpectedException</code> rule to verify the appropriate exception is thrown when an argument is <code>null</code>:</p>
</div>
<div class="listingblock">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> ExpectedException thrown = ExpectedException.none();

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testNotNull() {
    ApplicationContext applicationContext = ApplicationContext.run();
    NotNullExample exampleBean = applicationContext.getBean(NotNullExample.class);

    thrown.expect(<span class="exception">IllegalArgumentException</span>.class);
    thrown.expectMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null parameter [taskName] not allowed</span><span class="delimiter">&quot;</span></span>);

    exampleBean.doWork(<span class="predefined-constant">null</span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Micronaut is compile time, generally the advice should be packaged in a dependent JAR file that is on the classpath when the above test is compiled and should not be in the same codebase since you don&#8217;t want the test compiling before the advice itself is compiled.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_proxy_generation">Customizing Proxy Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default behaviour of the <a href="../api/io/micronaut/aop/Around.html">Around</a> annotation is to generate a proxy at compile time that is a subclass of the class being proxied. In other words, in the previous example a compile time subclass of the <code>NotNullExample</code> class will be produced where methods that are proxied are decorated with interceptor handling and the original behaviour is invoked via a call to <code>super</code>.</p>
</div>
<div class="paragraph">
<p>This behaviour is more efficient as only one instance of the bean is required, however depending on the use case you are trying to implement you may wish to alter this behaviour and the <code>@Around</code> annotation supports various attributes that allow you to alter this behaviour including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyTarget</code> (defaults to <code>false</code>) - If set to <code>true</code> instead of a subclass that calls <code>super</code>, the proxy will delegate to the original bean instance</p>
</li>
<li>
<p><code>hotswap</code> (defaults to <code>false</code>) - Same as <code>proxyTarget=true</code>, but in addition the proxy will implement <a href="../api/io/micronaut/aop/HotSwappableInterceptedProxy.html">HotSwappableInterceptedProxy</a> which wraps each method call in a <code>ReentrantReadWriteLock</code> and allows swapping the target instance at runtime.</p>
</li>
<li>
<p><code>lazy</code> (defaults to <code>false</code>) - By default Micronaut will eagerly intialize the proxy target when the proxy is created. If set to <code>true</code> the proxy target will instead be resolved lazily for each method call.</p>
</li>
</ul>
</div>
</div>
</div>


<h2 id="introductionAdvice">5.2 Introduction Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/introductionAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Introduction advice is distinct from Around advice in that it involves providing an implementation instead of decorating.</p>
</div>
<div class="paragraph">
<p>Examples of introduction advice include things like <a href="http://gorm.grails.org">GORM</a> or <a href="http://projects.spring.io/spring-data">Spring Data</a> that will both automatically implement persistence logic for you.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation is another example of introduction advice where Micronaut will, at compile time, implement HTTP client interfaces for you.</p>
</div>
<div class="paragraph">
<p>The way you implement Introduction advice is very similar to how you implement Around advice.</p>
</div>
<div class="paragraph">
<p>You start off by defining an annotation that will power the introduction advice. As an example, say you want to implement advice that will return a stubbed value for every method in an interface (a common requirement in testing frameworks). Consider the following <code>@Stub</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.aop.Introduction</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Bean</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.context.annotation.Type</span>;

<span class="keyword">import</span> <span class="include">java.lang.annotation.Documented</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.ElementType</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Retention</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Target</span>;

<span class="annotation">@Introduction</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Type</span>(StubIntroduction.class) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@Bean</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="annotation">@Documented</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.ANNOTATION_TYPE, <span class="predefined-type">ElementType</span>.METHOD})
<span class="directive">public</span> <span class="annotation">@interface</span> <span class="predefined-type">Stub</span> {
    <span class="predefined-type">String</span> value() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The introduction advice is annotated with <a href="../api/io/micronaut/aop/Introduction.html">Introduction</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Type.html">Type</a> annotation is used to refer to the implementor of the advise. In this case <code>StubIntroduction</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation is added so that all types annotated with <code>@Stub</code> become beans</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>StubIntroduction</code> class referred to in the previous example must then implement the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface, just like around advice.</p>
</div>
<div class="paragraph">
<p>The following is an example implementation:</p>
</div>
<div class="listingblock">
<div class="title">StubIntroduction.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.aop</span>.*;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StubIntroduction</span> <span class="directive">implements</span> MethodInterceptor&lt;<span class="predefined-type">Object</span>,<span class="predefined-type">Object</span>&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> intercept(MethodInvocationContext&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; context) {
        <span class="keyword">return</span> context.getValue( <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="predefined-type">Stub</span>.class,
                context.getReturnType().getType()
        ).orElse(<span class="predefined-constant">null</span>); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is annotated with <code>@Singleton</code> and implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>@Stub</code> annotation is read from the context and an attempt made to convert the value to the return type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Otherwise <code>null</code> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To now use this introduction advice in an application you simply annotate your abstract classes or interfaces with <code>@Stub</code>:</p>
</div>
<div class="listingblock">
<div class="title">StubExample.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stub</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">StubExample</span> {

    <span class="annotation">@Stub</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> getNumber();

    LocalDateTime getDate();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All abstract methods will delegate to the <code>StubIntroduction</code> class to be implemented.</p>
</div>
<div class="paragraph">
<p>The following test demonstrates the behaviour or <code>StubIntroduction</code>:</p>
</div>
<div class="listingblock">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">StubExample stubExample = applicationContext.getBean(StubExample.class);

assertEquals(<span class="integer">10</span>, stubExample.getNumber());
assertNull(stubExample.getDate());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if the introduction advice cannot implement the method the <code>proceed</code> method of the <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> should be called. This gives the opportunity for other introduction advice interceptors to implement the method, otherwise a <code>UnsupportedOperationException</code> will be thrown if no advice can implement the method.</p>
</div>
<div class="paragraph">
<p>In addition, if multiple introduction advice are present you may wish to override the <code>getOrder()</code> method of <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> to control the priority of advise.</p>
</div>
<div class="paragraph">
<p>The following sections cover core advice types that are built into Micronaut and provided by the framework.</p>
</div>


<h2 id="validation">5.3 Validation Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/validation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Validation advice is one of the most common advice types you are likely to want to incorporate into your application.</p>
</div>
<div class="paragraph">
<p>Validation advice is built on <code>javax.validation</code> and the <a href="http://hibernate.org/validator">Hibernate Validator</a> project.</p>
</div>
<div class="paragraph">
<p>To get started first add the Hibernate Validator configuration to your application:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:hibernate-validator</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then simply add the <a href="../api/io/micronaut/validation/Validated.html">Validated</a> annotation to any class that requires validation. For example, consider this trivial service that retrieves books by title:</p>
</div>
<div class="listingblock">
<div class="title">BookService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.validation.Validated</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.validation.constraints.NotBlank</span>;
<span class="keyword">import</span> <span class="include">java.util</span>.*;

<span class="annotation">@Singleton</span>
<span class="annotation">@Validated</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookService</span> {

    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; authorsByTitle = <span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;&gt;();

    <span class="directive">public</span> <span class="predefined-type">String</span> getAuthor(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> title) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> authorsByTitle.get(title);
    }

    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> author, <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> title) {
        authorsByTitle.put(title, author);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/validation/Validated.html">Validated</a> annotation is defined at the class level</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>javax.validation.NotBlank</code> constraint is used to ensure parameters passed cannot be blank</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can verify the behaviour of the class by writing a test. The following test is written in Groovy and Spock:</p>
</div>
<div class="listingblock">
<div class="title">Testing Validation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test validate book service</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    BookService bookService = applicationContext.getBean(BookService)

    <span class="key">when</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">An invalid title is passed</span><span class="delimiter">&quot;</span></span>
    bookService.getAuthor(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)

    <span class="key">then</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">A constraint violation occurred</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> e = thrown(ConstraintViolationException)
    e.message == <span class="string"><span class="delimiter">'</span><span class="content">getAuthor.title: must not be blank</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>


<h2 id="caching">5.4 Cache Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/caching.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Similar to Spring and Grails, Micronaut provides a set of caching annotations within the <a href="../api/io/micronaut/cache/package-summary.html">io.micronaut.cache</a> package.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/cache/CacheManager.html">CacheManager</a> interface allows different cache implementations to be plugged in as necessary.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/cache/SyncCache.html">SyncCache</a> interface provides a synchronous API for caching, whilst the <a href="../api/io/micronaut/cache/AsyncCache.html">AsyncCache</a> API allows non-blocking operation.</p>
</div>
<div class="sect1">
<h2 id="_cache_annotations">Cache Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following cache annotations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/cache/annotation/Cacheable.html">@Cacheable</a> - Indicates a method is cacheable within the given cache name</p>
</li>
<li>
<p><a href="../api/io/micronaut/cache/annotation/CachePut.html">@CachePut</a> - Indicates that the return value of a method invocation should be cached. Unlike <code>@Cacheable</code> the original operation is never skipped.</p>
</li>
<li>
<p><a href="../api/io/micronaut/cache/annotation/CacheInvalidate.html">@CacheInvalidate</a> - Indicates the invocation of a method should cause the invalidation of one or many caches.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By using one of the annotations the <a href="../api/io/micronaut/cache/interceptor/CacheInterceptor.html">CacheInterceptor</a> is activated which in the case of <code>@Cacheable</code> will cache the return result of the method.</p>
</div>
<div class="paragraph">
<p>If the return type of the method is a non-blocking type (either <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> or an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">org.reactivestreams.Publisher</a>) the emitted result will be cached.</p>
</div>
<div class="paragraph">
<p>In addition if the underlying Cache implementation supports non-blocking cache operations then cache values will be read from the cache without blocking, resulting in the ability to implement completely non-blocking cache operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_caches">Configuring Caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default <a href="https://github.com/ben-manes/caffeine">Caffeine</a> is used for cache definitions which can be configured via application configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Cache Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">myCache</span>:
            <span class="key">maximumSize</span>: <span class="string"><span class="content">20</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will configure a cache called "myCache" with a maximum size of 20.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_caching_with_redis">Caching with Redis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to use Redis to cache results then you need to add the Lettuce configuration to your classpath. Lettuce is a non-blocking, reactive Redis client implementation and Micronaut provides an implementation that allows cached results to be read reactively. To configure the Lettuce configuration add the following dependency to your application:</p>
</div>
<div class="listingblock">
<div class="title">Lettuce Configuration build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configurations:redis-lettuce</span><span class="delimiter">&quot;</span></span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then within your application configuration configure the Redis URL and Redis caches:</p>
</div>
<div class="listingblock">
<div class="title">Cache Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">redis</span>:
        <span class="key">uri</span>: <span class="string"><span class="content">redis://localhost</span></span>
        <span class="key">caches</span>:
            <span class="key">myCache</span>:
                <span class="key">expireAfterWrite</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1h</span><span class="delimiter">&quot;</span></span> <span class="comment"># expire one hour after write</span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="retry">5.5 Retry Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/retry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems and Microservice environments, failure is something you have to plan for and it is pretty common to want to attempt to retry an operation if it fails. If first you don&#8217;t succeed try again!</p>
</div>
<div class="paragraph">
<p>With this in mind Micronaut comes with a <a href="../api/io/micronaut/retry/annotation/Retryable.html">Retryable</a> annotation out of the box that is integrated into the container.</p>
</div>
<div class="sect1">
<h2 id="_simple_retry">Simple Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest form of retry is just to add the <code>@Retryable</code> annotation to any type or method. The default behaviour of <code>@Retryable</code> is to retry 3 times with a delay of 1 second between each retry.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Simply Retry Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; listBooks() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above example if the <code>listBooks()</code> method throws an exception it will be retried until the maximum number of attempts is reached.</p>
</div>
<div class="paragraph">
<p>The <code>multiplier</code> value of the <code>@Retryable</code> annotation can be used to configure a multiplier used to calculate the delay between retries, thus allowing exponential retry support.</p>
</div>
<div class="paragraph">
<p>Note also that the <code>@Retryable</code> annotation can be applied on interfaces and the behaviour will be inherited through annotation metadata. The implication of this is that <code>@Retryable</code> can be used in combination with <a href="#introductionAdvice">Introduction Advice</a> such as the HTTP <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>To customize retry behaviour you can set the <code>attempts</code> and <code>delay</code> members, For example to configure 5 attempts with a 2 second delay:</p>
</div>
<div class="listingblock">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>( attempts = <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>,
            delay = <span class="string"><span class="delimiter">&quot;</span><span class="content">2s</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="predefined-type">Book</span> findBook(<span class="predefined-type">String</span> title) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how both <code>attempts</code> and <code>delay</code> are defined as strings. This is to support configurability through annotation metadata. For example you can allow the retry policy to be configured using property placeholder resolution:</p>
</div>
<div class="listingblock">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>( attempts = <span class="string"><span class="delimiter">&quot;</span><span class="content">${book.retry.attempts:3}</span><span class="delimiter">&quot;</span></span>,
            delay = <span class="string"><span class="delimiter">&quot;</span><span class="content">${book.retry.delay:1s}</span><span class="delimiter">&quot;</span></span> )
<span class="directive">public</span> <span class="predefined-type">Book</span> getBook(<span class="predefined-type">String</span> title) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above in place if <code>book.retry.attempts</code> is specified in configuration it wil be bound the value of the <code>attempts</code> member of the <code>@Retryable</code> annotation via annotation metadata.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactive_retry">Reactive Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>@Retryable</code> advice can also be applied to methods that return reactive types, such as an RxJava <code>Flowable</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retryable</span>
<span class="directive">public</span> Flowable&lt;<span class="predefined-type">Book</span>&gt; streamBooks() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>@Retryable</code> advice will apply the retry policy to the reactive type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_circuit_breaker">Circuit Breaker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a Microservice environment retry is useful, but in some cases excessive retries can overwhelm the system as clients repeatedly re-attempt failing operations.</p>
</div>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern">Circuit Breaker</a> pattern is designed to resolve this issue by essentially allowing a certain number of failing requests and then opening a circuit that remains open for a period before allowing any additional retry attempts.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">CircuitBreaker</a> annotation is a variation of the <code>@Retryable</code> annotation that supports a <code>reset</code> member that indicates how long the circuit should remain open before it is reset (the default is 20 seconds).</p>
</div>
<div class="listingblock">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CircuitBreaker</span>(reset = <span class="string"><span class="delimiter">&quot;</span><span class="content">30s</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; findBooks() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will retry to <code>findBooks</code> method 3 times and then open the circuit for 30 seconds, rethrowing the original exception and preventing potential downstream traffic such as HTTP requests and I/O operations flooding the system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bean_creation_retry">Bean Creation Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned previously, <code>@Retryable</code> advice is integrated right at the container level. This is useful as it is common problem in Microservices and environments like Docker where there may be a delay in services becoming available.</p>
</div>
<div class="paragraph">
<p>The following snippet is taken from the Neo4j driver support and demonstrates how bean creation can be wrapped in retry support:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Factory</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Neo4jDriverFactory</span> {
    ...
    <span class="annotation">@Retryable</span>(<span class="exception">ServiceUnavailableException</span>.class) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="annotation">@Bean</span>(preDestroy = <span class="string"><span class="delimiter">&quot;</span><span class="content">close</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Driver</span> buildDriver() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A factory bean is created that defines methods that create beans</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Retryable</code> annotation is used to catch <code>ServiceUnavailableException</code> and retry creating the driver before failing startup.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retry_events">Retry Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/retry/event/RetryEventListener.html">RetryEventListener</a> instances as beans in order to listen for <a href="../api/io/micronaut/retry/event/RetryEvent.html">RetryEvent</a> events that are published every time an operation is retried.</p>
</div>
<div class="paragraph">
<p>In addition, you can register event listeners for <a href="../api/io/micronaut/retry/event/CircuitOpenEvent.html">CircuitOpenEvent</a>, when a circuit breaker circuit is opened, or <a href="../api/io/micronaut/retry/event/CircuitClosedEvent.html">CircuitClosedEvent</a> for when a circuit is closed.</p>
</div>
</div>
</div>


<h2 id="scheduling">5.6 Scheduled Tasks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/scheduling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like Spring and Grails, Micronaut features a <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation that can be used for scheduling background tasks.</p>
</div>
<div class="sect1">
<h2 id="_using_the_scheduled_annotation">Using the @Scheduled Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation can be added to any method of a bean and you should set either the <code>fixedRate</code>, <code>fixedDelay</code> or <code>cron</code> members.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that the scope of the bean has an impact on behaviour. a <code>@Singleton</code> bean will share state (the fields of the instance) for each execution, whilst with a <code>@Prototype</code> bean a new instance is created for each execution.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_scheduling_at_a_fixed_rate">Scheduling at a Fixed Rate</h3>
<div class="paragraph">
<p>To schedule a task at a fixed rate, use the <code>fixedRate</code> member. For example:</p>
</div>
<div class="listingblock">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(fixedRate = <span class="string"><span class="delimiter">&quot;</span><span class="content">5m</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> everyFiveMinutes() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing everyFiveMinutes()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task above will execute every 5 minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_with_a_fixed_delay">Scheduling with a Fixed Delay</h3>
<div class="paragraph">
<p>To schedule a task so that is runs 5 minutes after the termination of the previous task use the <code>fixedDelay</code> member. For example:</p>
</div>
<div class="listingblock">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(fixedDelay = <span class="string"><span class="delimiter">&quot;</span><span class="content">5m</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> fiveMinutesAfterLastExecution() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing fiveMinutesAfterLastExecution()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_a_cron_task">Scheduling a Cron Task</h3>
<div class="paragraph">
<p>To schedule a <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> task use the <code>cron</code> member:</p>
</div>
<div class="listingblock">
<div class="title">Cron Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>(cron = <span class="string"><span class="delimiter">&quot;</span><span class="content">0 15 10 ? * MON</span><span class="delimiter">&quot;</span></span> )
<span class="type">void</span> everyMondayAtTenFifteenAm() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing everyMondayAtTenFifteenAm()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will run the task every Monday morning at 10:15AM.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programmatically_scheduling_tasks">Programmatically Scheduling Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to programmatically schedule tasks, then you can use the <a href="../api/io/micronaut/scheduling/TaskScheduler.html">TaskScheduler</a> bean which can be injected as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@Named</span>(TaskExecutors.SCHEDULED) TaskScheduler taskScheduler;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_scheduled_tasks_with_annotation_metadata">Configuring Scheduled Tasks with Annotation Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to make your application&#8217;s tasks configurable then you can use annotation metadata and property placeholder configuration to do so. For example:</p>
</div>
<div class="listingblock">
<div class="title">Allowing Tasks to be Configured</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Scheduled</span>( fixedRate = <span class="string"><span class="delimiter">&quot;</span><span class="content">${my.task.rate:5m}</span><span class="delimiter">&quot;</span></span>,
            initialDelay = <span class="string"><span class="delimiter">&quot;</span><span class="content">${my.task.delay:1m}</span><span class="delimiter">&quot;</span></span> )
<span class="type">void</span> configuredTask() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing configuredTask()</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example allows the task execution frequency to be configured with the property <code>my.task.rate</code> and the initial delay to be configured with the property <code>my.task.delay</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_scheduled_task_thread_pool">Configuring the Scheduled Task Thread Pool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tasks executed by <code>@Scheduled</code> are by default run on a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html">ScheduledExecutorService</a> that is configured to have twice the number of threads as available processors.</p>
</div>
<div class="paragraph">
<p>You can re-configure this thread pool as desired using <code>application.yml</code>, for example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Scheduled Task Thread Pool</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">executors</span>:
        <span class="key">scheduled</span>:
            <span class="key">type</span>: <span class="string"><span class="content">scheduled</span></span>
            <span class="key">core-pool-size</span>: <span class="string"><span class="content">10</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="springAop">5.7 Bridging Spring AOP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/aop/springAop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although Micronaut&#8217;s design is based on a compile time approach and does not rely on Spring dependency injection, there is still a lot of value in the Spring ecosystem that does not depend directly on the Spring container.</p>
</div>
<div class="paragraph">
<p>You may wish to use existing Spring projects within Micronaut and configure beans to be used within Micronaut.</p>
</div>
<div class="paragraph">
<p>You may also wish to leverage existing AOP advice from Spring. One example of this is Spring&#8217;s support for declarative transactions with <code>@Transactional</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut provides support for Spring based transaction management without requiring Spring itself. You simply need to add the <code>spring</code> module to your application dependencies:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:spring</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use Micronaut&#8217;s <a href="#hibernateSupport">Hibernate support</a> you already get this dependency and a <code>HibernateTransactionManager</code> is configured for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is done by defining a Micronaut <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> annotation that uses <a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a> in a manner that every time you set a value with <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> it aliases the value to equivalent value in Spring&#8217;s version of <code>@Transactional</code>.</p>
</div>
<div class="paragraph">
<p>The benefit here is you can use Micronaut&#8217;s compile-time, reflection free AOP to declare programmatic Spring transactions. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @Transactional</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.spring.tx.annotation</span>.*;
...

<span class="annotation">@Transactional</span>
<span class="directive">public</span> <span class="predefined-type">Book</span> saveBook(<span class="predefined-type">String</span> title) {
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut&#8217;s version of <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> is also annotated with <a href="../api/io/micronaut/core/annotation/Blocking.html">@Blocking</a> ensuring that all methods annotated with use the I/O thread pool when executing within the HTTP server
</td>
</tr>
</table>
</div>


<h1 id="httpServer">6 The HTTP Server</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut includes both non-blocking HTTP server and client APIs based on <a href="https://netty.io">Netty</a>.</p>
</div>
<div class="paragraph">
<p>The design of the HTTP server in Micronaut is optimized for interchanging messages between Microservices, typically in JSON, and is not intended as a full server-side MVC framework. For example, there is currently no support for server-side views or features typical of a traditional server-side MVC framework.</p>
</div>
<div class="paragraph">
<p>The goal of the HTTP server is to make it as easy as possible to expose APIs that can be consumed by HTTP clients, whatever language they may be written in. To use the HTTP server you must have the <code>http-server-netty</code> dependency on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:http-server-netty</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A "Hello World" server application written in Java can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Server Hello World</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloController</span> {
    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> index() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/hello</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The scope of the <code>@Controller</code> is singleton</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>By defining method called <code>index</code>, by convention the method is exposed via the <code>/hello</code> URI</td>
</tr>
</table>
</div>


<h2 id="runningServer">6.1 Running the Embedded Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/runningServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the server simply create an <code>Application</code> class with a <code>static void main</code> method. For example:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Application Class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.runtime.Micronaut</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Application</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the application from a unit test you can use the <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> interface. The following test is written in Groovy with <a href="http://spockframework.org">Spock</a>:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Spock Test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.context.ApplicationContext</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.HttpClient</span>
<span class="keyword">import</span> <span class="include">io.micronaut.runtime.server.EmbeddedServer</span>
<span class="keyword">import</span> <span class="include">spock.lang.*</span>

<span class="type">class</span> <span class="class">HelloControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> EmbeddedServer embeddedServer =
            ApplicationContext.run(EmbeddedServer) <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Shared</span> <span class="annotation">@AutoCleanup</span> HttpClient client = HttpClient.create(embeddedServer.URL) <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello world response</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        client.toBlocking() <i class="conum" data-value="3"></i><b>(3)</b>
              .retrieve(HttpRequest.GET(<span class="string"><span class="delimiter">'</span><span class="content">/hello</span><span class="delimiter">'</span></span>)) == <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>EmbeddedServer</code> is run and Spock&#8217;s <code>@AutoCleanup</code> annotation ensures the server is stopped after the specification completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EmbeddedServer</code> interface provides the <code>URL</code> of the server under test which runs on a random port.</td>
</tr>
</table>
</div>


<h2 id="runningSpecificPort">6.2 Running Server on a Specific Port</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/runningSpecificPort.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The server starts by default on a random port. However, you can set the server to run on a specific port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">server</span>:
    <span class="key">port</span>: <span class="string"><span class="content">8080</span></span></code></pre>
</div>
</div>


<h2 id="routing">6.3 HTTP Routing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/routing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation used in the previous section is one of <a href="../api/io/micronaut/http/annotation/package-summary.html">several annotations</a> that allow you to control the construction of HTTP routes.</p>
</div>
<div class="sect1">
<h2 id="_uri_paths">URI Paths</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous example a value of <code>/hello</code> was specified as the path to the controller. If no value is specified to the <code>@Controller</code> action then the URI is formulated from the class name.</p>
</div>
<div class="paragraph">
<p>The following table summarizes values for the <code>@Controller</code> annotation and the calculated base paths:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class Name</th>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Path</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HelloController</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/hello</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HelloWorldController</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HelloController</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Controller("/somepath")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/somepath</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HelloController</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Controller("/")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The value of the <code>@Controller</code> annotation is a <a href="https://tools.ietf.org/html/rfc6570">RFC-6570 URI template</a> you can therefore embed URI variables within the path using the syntax defined by the URI template specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many other frameworks, including Spring, implement the URI template specification
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uri_variables">URI Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>URI variables can be referenced via method arguments. For example:</p>
</div>
<div class="listingblock">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;

<span class="annotation">@Controller</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">IssuesController</span> {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{number}</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">String</span> issue(<span class="predefined-type">Integer</span> number) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Issue # </span><span class="delimiter">&quot;</span></span> + number + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Controller</code> annotation is specified without an argument resulting in a base URI of <code>/issues</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Get.html">Get</a> annotation is used to map the method to an HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> with a URI variable embedded in the URI called <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The value of the URI variable is referenced in the implementation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut will map the URI <code>/issues/{number}</code> for the above controller. We can assert this is the case by writing a unit test, this time in Java and JUnit:</p>
</div>
<div class="listingblock">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.ApplicationContext</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.HttpClient</span>;
<span class="keyword">import</span> <span class="include">org.junit</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.runtime.server.EmbeddedServer</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assert</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">IssuesControllerTest</span> {
    <span class="directive">private</span> <span class="directive">static</span> EmbeddedServer server;
    <span class="directive">private</span> <span class="directive">static</span> HttpClient client;

    <span class="annotation">@BeforeClass</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> setupServer() {
        server = ApplicationContext.run(EmbeddedServer.class);
        client = server
                    .getApplicationContext()
                    .createBean(HttpClient.class, server.getURL());
    }

    <span class="annotation">@AfterClass</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> stopServer() {
        <span class="keyword">if</span>(server != <span class="predefined-constant">null</span>) {
            server.stop();
        }
        <span class="keyword">if</span>(client != <span class="predefined-constant">null</span>) {
            client.stop();
        }
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testIssue() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> body = client.toBlocking().retrieve(<span class="string"><span class="delimiter">&quot;</span><span class="content">/issues/12</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
        assertNotNull(body);
        assertEquals( <i class="conum" data-value="3"></i><b>(3)</b>
                body,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Issue # 12!</span><span class="delimiter">&quot;</span></span>
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For JUnit you can write methods to start and stop the server for the scope of the test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The tests sends a request to the URI <code>/issues/12</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>And then asserts the response is "Issue # 12"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you invoke the previous endpoint without the required URI variable or with an invalid type, Micronaut responds with the appropriate HTTP failure codes as illustrated in the following Spock tests that use the <a href="#httpClient">HTTP client</a>.</p>
</div>
<div class="listingblock">
<div class="title">Testing for Response Errors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/issues/show/{number} with an invalid Integer number responds 400</span><span class="delimiter">&quot;</span></span>() {
    when:
    client.toBlocking().exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">/issues/hello</span><span class="delimiter">&quot;</span></span>)

    then:
    HttpClientResponseException e = thrown(HttpClientResponseException)
    e.status.code == <span class="integer">400</span>
}

<span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/issues/show/{number} without number responds 404</span><span class="delimiter">&quot;</span></span>() {
    when:
    client.toBlocking().exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">/issues/</span><span class="delimiter">&quot;</span></span>)

    then:
    HttpClientResponseException e = thrown(HttpClientResponseException)
    e.status.code == <span class="integer">404</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the URI template in the previous example requires that the <code>number</code> variable is specified. You can specify optional URI templates with the syntax: <code>/issues{/number}</code> and by annotating the <code>number</code> parameter with <code>@Nullable</code>.</p>
</div>
<div class="paragraph">
<p>The following table provides some examples of URI templates and what they match:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. URI Template Matching</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Matching URI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple match</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id:2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable of 2 characters max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code> or <code>/books</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/book{/id:[a-zA-Z]+}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable with regex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{?max,offset}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional query parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books?max=10&amp;offset=10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/path:.*}{.ext}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regex path match with extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo/bar.xml</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_routing_annotations">Routing Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example used the <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation to add method that accepted HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> requests. The following tables summarizes the available annotations and how they map to the different HTTP methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. HTTP Routing Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">HTTP Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Delete.html">@Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#DELETE">DELETE</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Get.html">@Get</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Head.html">@Head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#HEAD">HEAD</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Options.html">@Options</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#OPTIONS">OPTIONS</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Patch.html">@Patch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PATCH">PATCH</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Put.html">@Put</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PUT">PUT</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Post.html">@Post</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#POST">POST</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Trace.html">@Trace</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#TRACE">TRACE</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If no URI path is specified to any of the annotations then the method name is used as the URI. In other words both of the following methods are essentially equivalent and map to the <code>/hello</code> URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">String</span> hello() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
}

<span class="annotation">@Get</span>
<span class="predefined-type">String</span> hello() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_routes_programmatically">Building Routes Programmatically</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you prefer to not use annotations and declare all of your routes in code then never fear, Micronaut has a flexible <a href="../api/io/micronaut/web/router/RouteBuilder.html">RouteBuilder</a> API that makes it a breeze to define routes programmatically.</p>
</div>
<div class="paragraph">
<p>To start off with you should subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a> and then simply inject the controller you wish to route to into the method and define your routes:</p>
</div>
<div class="listingblock">
<div class="title">RouteBuilder Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.ExecutionHandleLocator</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.web.router.DefaultRouteBuilder</span>;

<span class="keyword">import</span> <span class="include">javax.inject</span>.*;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyRoutes</span> <span class="directive">extends</span> DefaultRouteBuilder { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> MyRoutes(ExecutionHandleLocator executionHandleLocator, UriNamingStrategy uriNamingStrategy) {
        <span class="local-variable">super</span>(executionHandleLocator, uriNamingStrategy);
    }

    <span class="annotation">@Inject</span>
    <span class="type">void</span> issuesRoutes(IssuesController issuesController) { <i class="conum" data-value="2"></i><b>(2)</b>
        GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/show/{name}</span><span class="delimiter">&quot;</span></span>, issuesController, <span class="string"><span class="delimiter">&quot;</span><span class="content">issue</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Route definitions should subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to inject a method with the controllers you want to route to</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use methods such as <a href="../api/io/micronaut/web/router/RouteBuilder.html#GET-java.lang.String-java.lang.Class-java.lang.String-java.lang.Class&#8230;&#8203;-">GET</a> to route to controller methods</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Unfortunately due to type erasure a Java method lambda reference cannot be used with the API. For Groovy there is a <code>GroovyRouteBuilder</code> class which can be subclassed that allows passing Groovy method references.
</td>
</tr>
</table>
</div>
</div>
</div>


<h2 id="binding">6.4 Simple Request Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/binding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The examples in the previous section demonstrates how Micronaut allows you to bind method parameters from URI path variables.</p>
</div>
<div class="sect1">
<h2 id="_binding_annotations">Binding Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize the name of the variable bound with the <a href="../api/io/micronaut/context/annotation/Parameter.html">@Parameter</a> annotation which accepts a value which is the name of the URI variable or request parameter to bind from.</p>
</div>
<div class="paragraph">
<p>In addition, there are other annotations within the <a href="../api/io/micronaut/http/annotation/package-summary.html">io.micronaut.http.annotation</a> package to bind from different sources.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the annotations, their purpose and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to specify the parameter the body of the request should bind to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from a Cookie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from an HTTP header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String contentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Parameter.html">@Parameter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bindings from a request URI variable or request parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Parameter String myParam</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a value is not specified to any binding annotation then the parameter name is used. In other words the following two methods are equivalent and both bind from a cookie called <code>myCookie</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> hello(<span class="annotation">@CookieValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myCookie</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> myCookie) {
    ...
}

<span class="predefined-type">String</span> hello(<span class="annotation">@CookieValue</span> <span class="predefined-type">String</span> myCookie) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Java doesn&#8217;t allow hyphens in variable names in the case of headers the following two definitions are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@Header</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> contentType) {
    ...
}

<span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@Header</span> <span class="predefined-type">String</span> contentType) {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bindable_types">Bindable Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generally any type that can be converted from a String representation to a Java type via the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> API can be bound to.</p>
</div>
<div class="paragraph">
<p>This includes most common Java types, however additional <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> instances can be registered simply be creating <code>@Singleton</code> beans of type <code>TypeConverter</code>.</p>
</div>
<div class="paragraph">
<p>The handling of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a> deserves special mention. Consider for example the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@Header</span> <span class="predefined-type">String</span> contentType) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case if the HTTP header <code>Content-Type</code> is not present in the request the route is considered invalid, since it cannot be satisfied and a HTTP 400 <code>BAD REQUEST</code> is returned.</p>
</div>
<div class="paragraph">
<p>If you wish for the <code>Content-Type</code> header to be optional, you can instead write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@Header</span> Optional&lt;<span class="predefined-type">String</span>&gt; contentType) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An empty <code>Optional</code> will be passed if the header is absent from the request.</p>
</div>
<div class="paragraph">
<p>Additionally, any <code>DateTime</code> that conforms to <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#RFC_1123_DATE_TIME">RFC-1123</a> can be bound to a parameter, alternatively the format can be customized with the <a href="../api/io/micronaut/core/convert/format/Format.html">Format</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@Header</span> ZonedDateTime date) {
    ...
}

<span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@Format</span>(<span class="string"><span class="delimiter">'</span><span class="content">dd/MM/yyy</span><span class="delimiter">'</span></span>) <span class="annotation">@Header</span> ZonedDateTime date) {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_variables_resolution">Variables resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut will try to populate method arguments in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>URI variables like <code>/{id}</code>.</p>
</li>
<li>
<p>If the request is a <code>GET</code> request from query parameters (ie. <code>?foo=bar</code>).</p>
</li>
<li>
<p>If there is a <code>@Body</code> and request allows the body, bind the body to it.</p>
</li>
<li>
<p>if the request can have a body and no <code>@Body</code> is defined then try parse the body (either JSON or form data) and
bind the method arguments from the body.</p>
</li>
<li>
<p>Finally, if the method arguments cannot be populated return <code>400 BAD REQUEST</code>.</p>
</li>
</ol>
</div>
</div>
</div>


<h2 id="requestResponse">6.5 The HttpRequest and HttpResponse</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/requestResponse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you need more control over request processing then you can instead write a method that receives the complete <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a>.</p>
</div>
<div class="paragraph">
<p>In fact, there are several higher level interfaces that can be bound to method parameters of controllers. These include:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Bindable Micronaut Interfaces</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full <code>HttpRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpRequest request)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpHeaders.html">HttpHeaders</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP headers present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpHeaders headers)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpParameters.html">HttpParameters</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP parameters (either from URI variables or request parameters) present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpParameters params)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/Cookies.html">Cookies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the Cookies present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(Cookies cookies)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, for full control over the emitted HTTP response you can use the static factory methods of the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> class which return a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a>.</p>
</div>
<div class="paragraph">
<p>The following example implements the previous <code>MessageController</code> example using the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> objects:</p>
</div>
<div class="listingblock">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">io.micronaut.http.HttpResponse</span>.*; <i class="conum" data-value="1"></i><b>(1)</b>

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/request</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MessageController</span> {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    HttpResponse&lt;<span class="predefined-type">String</span>&gt; hello(HttpRequest&lt;?&gt; request) {
        <span class="predefined-type">String</span> name = request.getParameters()
                             .getFirst(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
                             .orElse(<span class="string"><span class="delimiter">&quot;</span><span class="content">Nobody</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="keyword">return</span> ok(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!!</span><span class="delimiter">&quot;</span></span>)
                 .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-My-Header</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The factory methods of the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> are statically imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method is mapped to the URI <code>/hello</code> and accepts a <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> is used to obtain the value of a query parameter called <code>name</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="../api/io/micronaut/http/HttpResponse.html#ok-T-">HttpResponse.ok(T)</a> method is used to return a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> with a text body. A header called <code>X-My-Header</code> is also added to the response object.</td>
</tr>
</table>
</div>


<h2 id="producesAnnotation">6.6 Response Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/producesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action produces <code>application-json</code> by default.
Nonetheless you can change the <code>Content-Type</code> of the response with the <code>@Produces</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestController</span> {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)
    <span class="directive">public</span> HttpResponse index() {
        <span class="keyword">return</span> HttpResponse.ok().body(<span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">msg</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">This is JSON</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Produces</span>(MediaType.TEXT_HTML) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Get</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> html() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate a controller&#8217;s action with <code>@Produces</code> to change the response content type.</td>
</tr>
</table>
</div>


<h2 id="consumesAnnotation">6.7 Accepted Request Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/consumesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action consumes <code>application-json</code> by default. Nonetheless, you can support other <code>Content-Type</code> with the <code>@Consumes</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestController</span> {

    <span class="annotation">@Consumes</span>([MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON]) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Post</span>
    <span class="directive">public</span> HttpResponse multipleConsumes() {
        <span class="keyword">return</span> HttpResponse.ok();
    }

    <span class="annotation">@Post</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> HttpResponse index() {
        <span class="keyword">return</span> HttpResponse.ok();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Consumes</code> annotation takes a <code>String[]</code> of supported media types for an incoming request.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By default, a controller&#8217;s action consumes request with <code>Content-Type</code> of type <code>application-json</code>.</td>
</tr>
</table>
</div>


<h2 id="reactiveServer">6.8 Reactive HTTP Request Processing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/reactiveServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Micronaut is built on Netty which is designed around an Event loop model and non-blocking I/O.</p>
</div>
<div class="paragraph">
<p>Although it is recommended to following a non-blocking approach, in particular when making remote calls to other microservices, Micronaut acknowledges the fact that in real world scenarios developers encounter situations where the need arises to interface with blocking APIs and in order to facilitate this features blocking operation detection.</p>
</div>
<div class="paragraph">
<p>If your controller method returns a non-blocking type such as an RxJava <code>Observable</code> or a <code>CompletableFuture</code> then Micronaut will use the Event loop thread to subscribe to the result.</p>
</div>
<div class="paragraph">
<p>If however you return any other type then Micronaut will execute your <code>@Controller</code> method in a pre-configured I/O thread pool.</p>
</div>
<div class="paragraph">
<p>This thread pool by default is a caching, unbound thread pool. However, you may wish to configure the nature of the thread pool. For example the following configuration will configure the I/O thread pool as a fixed thread pool with 75 threads (similar to what a traditional blocking server such as Tomcat uses in the thread per connection model):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="error">micronaut.executors.io.type=fixed</span>
<span class="error">micronaut.executors.io.nThreads=75</span></code></pre>
</div>
</div>


<h2 id="bodyAnnotation">6.8.1 Using the @Body Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/reactiveServer/bodyAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To parse the request body, you first need to indicate to Micronaut the parameter which will receive the data. This is done with the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following example implements a simple echo server that echos the body sent in the request:</p>
</div>
<div class="listingblock">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.reactivex.Flowable</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Single</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">javax.validation.constraints.Size</span>;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/receive</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MessageController</span> {

    <span class="annotation">@Post</span>(consumes = MediaType.TEXT_PLAIN) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> echo(<span class="annotation">@Size</span>(max = <span class="integer">1024</span>) <span class="annotation">@Body</span> <span class="predefined-type">String</span> text) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> text; <i class="conum" data-value="3"></i><b>(3)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Post.html">Post</a> annotation is used with a <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> of <code>text/plain</code> (the default is <code>application/json</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation is used with a <code>javax.validation.constraints.Size</code> that limits the size of the body to at most 1MB</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The body is returned as the result of the method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that reading the request body is done in a non-blocking manner in that the request contents are read as the data becomes available and accumulated into the String passed to the method.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>micronaut.server.maxRequestSize</code> setting in <code>application.yml</code> will limit the size of the data (the default maximum request size is 10MB) if no <code>@Size</code> constraint is specified.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regardless of the limit, for a  large amount of data accumulating the data into a String in-memory may lead to memory strain on the server. A better approach is to include a Reactive library in your project (such as <code>RxJava 2.x</code>, <code>Reactor</code> or <code>Akka</code>) that supports the Reactive streams implementation and stream the data it becomes available:</p>
</div>
<div class="listingblock">
<div class="title">Using RxJava 2 to Read the request body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Post</span>(consumes = MediaType.TEXT_PLAIN) <i class="conum" data-value="1"></i><b>(1)</b>
Single&lt;MutableHttpResponse&lt;<span class="predefined-type">String</span>&gt;&gt; echoFlow(<span class="annotation">@Body</span> Flowable&lt;<span class="predefined-type">String</span>&gt; text) { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">return</span> text.collect(<span class="predefined-type">StringBuffer</span>::<span class="keyword">new</span>, <span class="predefined-type">StringBuffer</span>::append) <i class="conum" data-value="3"></i><b>(3)</b>
               .map(buffer -&gt;
                    HttpResponse.ok(buffer.toString())
               );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case the method is altered to receive and return an RxJava 2.x <code>Flowable</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> is returned so that Micronaut will only emit the response once the operation completes without blocking.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>collect</code> method is used to accumulate the data in this simulated example, but it could for example write the data to logging service, database or whatever chunk by chunk</td>
</tr>
</table>
</div>


<h2 id="reactiveResponses">6.8.2 Reactive Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/reactiveServer/reactiveResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous section introduced the notion of Reactive programming using RxJava 2.x and Micronaut.</p>
</div>
<div class="paragraph">
<p>Micronaut supports returning common reactive types such as <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> or <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html">Observable</a> (or the <code>Mono</code> type from Reactor 3.x), an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> from any controller method.</p>
</div>
<div class="paragraph">
<p>The argument that is designated the body of the request using the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation can also be a reactive type or a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut also uses these types to influence which thread pool to execute the method on. If the request is considered non-blocking (because it returns a non-blocking type) then the Netty event loop thread will be used to execute the method.</p>
</div>
<div class="paragraph">
<p>If the method is considered blocking then the method is executed on the I/O thread pool, which Micronaut creates at startup.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the section on <a href="#threadPools">Configuring Thread Pools</a> for information on the thread pools that Micronaut sets up and how to configure them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To summarize, the following table illustrates some common response types and their handling:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpResponse&lt;Flowable&lt;String&gt;&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any implementation of <code>CharSequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When returning a Reactive type, the type of reactive type has an impact on the response returned. For example, when returning a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>, Micronaut can not know the size of the response, so <code>Transfer-Encoding</code> type of <code>Chunked</code> is used. Whilst for types that emit a single result such as <code><a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a></code> the <code>Content-Length</code> header will be populated.
</td>
</tr>
</table>
</div>


<h2 id="jsonBinding">6.8.3 JSON Binding with Jackson</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/reactiveServer/jsonBinding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The examples so far have dealt with simply text based responses, but the most common data interchange format nowadays is JSON.</p>
</div>
<div class="paragraph">
<p>In fact, the defaults in the <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> annotation specify that the controllers in Micronaut consume and produce JSON by default.</p>
</div>
<div class="paragraph">
<p>In order to do so in a non-blocking manner Micronaut builds on the <a href="https://github.com/FasterXML/jackson">Jackson</a> Asynchronous JSON parsing API and Netty such that the reading of incoming JSON is done in a non-blocking manner.</p>
</div>
<div class="sect1">
<h2 id="_binding_using_reactive_frameworks">Binding using Reactive Frameworks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From a developer perspective however, you can generally just work with Plain Old Java Objects (POJOs) and can optionally use a Reactive framework such as RxJava or Reactor. The following is an example of a controller that reads and saves an incoming POJO in a non-blocking way from JSON:</p>
</div>
<div class="listingblock">
<div class="title">Using RxJava 2 to Read the JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/people</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PersonController</span> {

    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Person&gt; inMemoryDatastore = <span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;&gt;();

    <span class="annotation">@Post</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Single&lt;HttpResponse&lt;Person&gt;&gt; save(<span class="annotation">@Body</span> Single&lt;Person&gt; person) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> person.map(p -&gt; {
                    inMemoryDatastore.put(p.getFirstName(), p); <i class="conum" data-value="2"></i><b>(2)</b>
                    <span class="keyword">return</span> HttpResponse.created(p); <i class="conum" data-value="3"></i><b>(3)</b>
                }
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method receives a RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> which emits the POJO once the JSON has been read</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>map</code> method is used to store the instance in <code>Map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using CURL from the command line you can POST JSON to the <code>/people</code> URI for the server to receive it:</p>
</div>
<div class="listingblock">
<div class="title">Using CURL to Post JSON</div>
<div class="content">
<pre>$ curl -X POST localhost:8080/people -d '{"firstName":"Fred","lastName":"Flintstone","age":45}'</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_completablefuture">Binding Using CompletableFuture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The same method as the previous example can also be written with the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> API instead:</p>
</div>
<div class="listingblock">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; save(<span class="annotation">@Body</span> CompletableFuture&lt;Person&gt; person) {
    <span class="keyword">return</span> person.thenApply(p -&gt; {
                inMemoryDatastore.put(p.getFirstName(), p);
                <span class="keyword">return</span> HttpResponse.created(p);
            }
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example uses the <code>thenApply</code> method to achieve the same as the previous example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_pojos">Binding using POJOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note however, that if your method does not do any blocking I/O then you can just as easily write:</p>
</div>
<div class="listingblock">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> HttpResponse&lt;Person&gt; save(<span class="annotation">@Body</span> Person person) {
    inMemoryDatastore.put(person.getFirstName(), person);
    <span class="keyword">return</span> HttpResponse.created(person);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will still using non-blocking I/O to read the JSON and only execute your method once the data has been read.</p>
</div>
<div class="paragraph">
<p>In other words, as a rule reactive types should be used when you plan to do further downstream I/O operations in which case they can greatly simplify composing operations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The output produced by Jackson can be customized in a variety of manners, from defining Jackson modules to using <a href="https://github.com/FasterXML/jackson-annotations/wiki/Jackson-Annotations">Jackson&#8217;s annotations</a>
</td>
</tr>
</table>
</div>
</div>
</div>


<h2 id="staticResources">6.9 Serving Static Resources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/staticResources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Static resource resolution is disabled by default.</p>
</div>
<div class="paragraph">
<p>The following configuration options are available through <a href="../api/io/micronaut/web/router/resource/StaticResourceConfiguration.html">StaticResourceConfiguration</a>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether static resources will be resolved at all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path resources should be served from. Uses ant path matching. Options might be <code>/<strong>*</strong>*</code> or <code>/static/<strong>*</strong>*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">paths</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;String&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of paths either starting with <code>classpath:</code> or <code>file:</code>. You can serve files from anywhere on disk or the classpath. For example to serve static resources from <code>src/main/resources/public</code>, you would use <code>classpath:public</code> as the path.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is what an example YAML configuration might look like (note that the <code>router</code> declaration must be at the top-level of the file and not nested under any other items):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">router</span>:
    <span class="key">static</span>:
        <span class="key">resources</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">mapping</span>: <span class="string"><span class="content">/static/**</span></span>
            <span class="key">paths</span>: <span class="string"><span class="content">classpath:public</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>index.html</code> will be resolved by default. In the above example a request to <code>/static</code> will attempt to retrieve <code>src/main/resources/public/index.html</code>.
</td>
</tr>
</table>
</div>


<h2 id="errorHandling">6.10 Error Handling</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/errorHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Sometimes with distributing applications, bad things happen. Thus having a good way to handle errors is important.</p>
</div>
<div class="paragraph">
<p>To define local error handling simply define a method in a controller where the last argument is the type of the exception you wish to handle. For example the following method will handling JSON parse exceptions from Jackson for the scope of the declaring controller:</p>
</div>
<div class="listingblock">
<div class="title">Handling Controller Exceptions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException jsonParseException) { <i class="conum" data-value="1"></i><b>(1)</b>
    JsonError error = <span class="keyword">new</span> JsonError(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid JSON: </span><span class="delimiter">&quot;</span></span> + jsonParseException.getMessage()) <i class="conum" data-value="2"></i><b>(2)</b>
            .link(Link.SELF, Link.of(request.getUri()));

    <span class="keyword">return</span> HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, <span class="string"><span class="delimiter">&quot;</span><span class="content">Fix Your JSON</span><span class="delimiter">&quot;</span></span>)
            .body(error); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method that explicitly handles <code>JsonParseException</code> is declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An instance of <a href="../api/io/micronaut/http/hateos/JsonError.html">JsonError</a> is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A custom response is returned to handle the error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the previous example will only handle errors thrown from the declaring controller. To handle errors globally you should use the <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> annotation with the <code>global</code> attribute set to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="title">Handling Global Errors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Error</span>(global = <span class="predefined-constant">true</span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> HttpResponse&lt;JsonError&gt; error(HttpRequest request, <span class="predefined-type">Throwable</span> e) {
    JsonError error = <span class="keyword">new</span> JsonError(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bad Things Happened: </span><span class="delimiter">&quot;</span></span> + e.getMessage()) <i class="conum" data-value="2"></i><b>(2)</b>
            .link(Link.SELF, Link.of(request.getUri()));

    <span class="keyword">return</span> HttpResponse.&lt;JsonError&gt;serverError()
            .body(error); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> is used to declare the method a global error handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateos/JsonError.html">JsonError</a> instance is returned for all errors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#INTERNAL_SERVER_ERROR">INTERNAL_SERVER_ERROR</a> response is returned</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also specify an exception type to the <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> to add a more specific exception handler
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, you can also add global handlers for error status responses:</p>
</div>
<div class="listingblock">
<div class="title">Handling Global HTTP Status Errors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Error</span>(status = HttpStatus.NOT_FOUND, global = <span class="predefined-constant">true</span>)
<span class="directive">public</span> HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <i class="conum" data-value="1"></i><b>(1)</b>
    JsonError error = <span class="keyword">new</span> JsonError(<span class="string"><span class="delimiter">&quot;</span><span class="content">Page Not Found</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
            .link(Link.SELF, Link.of(request.getUri()));

    <span class="keyword">return</span> HttpResponse.&lt;JsonError&gt;notFound()
            .body(error); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> declares which <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> error code to handle (in this case 404)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateos/JsonError.html">JsonError</a> instance is returned for all 404 responses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#NOT_FOUND">NOT_FOUND</a> response is returned</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A few things to note about the <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> annotation. Two identical <code>@Error</code> annotations that are
global cannot be declared. Two identical <code>@Error</code> annotations that are non-global cannot be declared in the same controller.
If an <code>@Error</code> annotation with the same parameter exists as global and another as a local, the local one will take precedence.
</td>
</tr>
</table>
</div>


<h2 id="formData">6.11 Handling Form Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/formData.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In order to make data binding model customizations consistent between form data and JSON, Micronaut uses Jackson to implement binding data from form submissions.</p>
</div>
<div class="paragraph">
<p>The advantage of this approach is that the same Jackson annotations used for customizing JSON binding can be used for form submissions too.</p>
</div>
<div class="paragraph">
<p>What this means in practise is that in order to bind regular form data the only change required to the previous JSON binding code is updating the <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> consumed:</p>
</div>
<div class="listingblock">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Post</span>(uri=<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, consumes=MediaType.APPLICATION_FORM_URLENCODED)
<span class="directive">public</span> HttpResponse&lt;Person&gt; save(<span class="annotation">@Body</span> Person person) {
    inMemoryDatastore.put(person.getFirstName(), person);
    <span class="keyword">return</span> HttpResponse.created(person);
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To avoid denial of service attacks, collection types and arrays created during binding are limited by the setting <code>jackson.arraySizeThreshold</code> in <code>application.yml</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, instead of using a POJO you can bind form data directly to method parameters (which works with JSON too!):</p>
</div>
<div class="listingblock">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Post</span>(uri=<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, consumes=MediaType.APPLICATION_FORM_URLENCODED)
<span class="directive">public</span> HttpResponse&lt;Person&gt; save(<span class="predefined-type">String</span> firstName, <span class="predefined-type">String</span> lastName, Optional&lt;<span class="predefined-type">Integer</span>&gt; age) {
    Person p = <span class="keyword">new</span> Person(firstName, lastName);
    age.ifPresent(p::setAge);
    inMemoryDatastore.put(p.getFirstName(), p);
    <span class="keyword">return</span> HttpResponse.created(p);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example above, this approach allows you to use features such as support for <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a> types and restrict the parameters to be bound (When using POJOs you must be careful to use Jackson annotations to exclude properties that should not be bound).</p>
</div>


<h2 id="uploads">6.12 File Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/uploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Handling of file uploads has special treatment in Micronaut. Support is provided for streaming of uploads in a non-blocking manner through streaming uploads or completed uploads.</p>
</div>
<div class="paragraph">
<p>To receive data from a multipart request, set the <code>consumes</code> argument of the method annotation to <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Post</span>(consumes = MediaType.MULTIPART_FORM_DATA)
HttpResponse upload( ... )</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_route_arguments">Route Arguments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How the files are received by your method is determined by the type of the arguments. Data can be received a chunk at a time or when an upload is completed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the route argument name can&#8217;t or shouldn&#8217;t match the name of the part in the request, simply add the <a href="../api/io/micronaut/http/annotation/Part.html">@Part</a> annotation to the argument and specify the name that is expected to be in the request.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_chunk_data_types">Chunk Data Types</h3>
<div class="paragraph">
<p><a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> is the data type used to represent a chunk of data received in a multipart request. There are methods on the <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> interface to convert the data to a <code>byte[]</code>, <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html">InputStream</a>, or a <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html">ByteBuffer</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Data can only be retrieved from a <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> once. The underlying buffer will be released which causes further attempts to fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Route arguments of type <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher&lt;PartData&gt;</a> will be treated as only intended to receive a single file and each chunk of the received file will be sent downstream. If the generic type is something other than <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a>, conversion will be attempted using Micronaut&#8217;s conversion service. Conversions to <code>String</code> and <code>byte[]</code> are supported by default.</p>
</div>
<div class="paragraph">
<p>If requirements dictate you must have knowledge about the metadata of the file being received, a special class called <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a> has been created that is a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher&lt;PartData&gt;</a>, but also has file information like the content type and file name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.multipart.StreamingFileUpload</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Single</span>;
<span class="keyword">import</span> <span class="include">org.reactivestreams.Publisher</span>;

<span class="keyword">import</span> <span class="include">java.io.File</span>;

<span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UploadController</span> {

    <span class="annotation">@Post</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, consumes = MediaType.MULTIPART_FORM_DATA) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> Single&lt;HttpResponse&lt;<span class="predefined-type">String</span>&gt;&gt; upload(StreamingFileUpload file) <span class="directive">throws</span> <span class="exception">IOException</span> { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-type">File</span> tempFile = <span class="predefined-type">File</span>.createTempFile(file.getFilename(), <span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span>);
        Publisher&lt;<span class="predefined-type">Boolean</span>&gt; uploadPublisher = file.transferTo(tempFile); <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> Single.fromPublisher(uploadPublisher)  <i class="conum" data-value="4"></i><b>(4)</b>
            .map(success -&gt; {
                <span class="keyword">if</span> (success) {
                    <span class="keyword">return</span> HttpResponse.ok(<span class="string"><span class="delimiter">&quot;</span><span class="content">Uploaded</span><span class="delimiter">&quot;</span></span>);
                } <span class="keyword">else</span> {
                    <span class="keyword">return</span> HttpResponse.&lt;<span class="predefined-type">String</span>&gt;status(HttpStatus.CONFLICT)
                                       .body(<span class="string"><span class="delimiter">&quot;</span><span class="content">Upload Failed</span><span class="delimiter">&quot;</span></span>);
                }
            });
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is set to consume <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html#transferTo-java.lang.String-">StreamingFileUpload.transferTo(java.lang.String)</a> method is used to transfer the file to the server. The method returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The returned <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> subscribes to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and outputs a response once the upload is complete, without blocking.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_whole_data_types">Whole Data Types</h3>
<div class="paragraph">
<p>Route arguments that are not publishers will cause the route execution to be delayed until the upload has finished. The received data will attempt to be converted to the requested type. Conversions to a <code>String</code> or <code>byte[]</code> are supported by default. In addition, the file can be converted to a POJO if a media type codec has been registered that supports the media type of the file. A media type codec is included by default that allows conversion of JSON files to POJOs.</p>
</div>
<div class="paragraph">
<p>If requirements dictate you must have knowledge about the metadata of the file being received, a special class called <a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a> has been created that has methods to retrieve the data of the file, but also has file information like the content type and file name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.multipart.CompletedFileUpload</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.nio.file</span>.*;

<span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UploadController</span> {

    <span class="annotation">@Post</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/completed</span><span class="delimiter">&quot;</span></span>, consumes = MediaType.MULTIPART_FORM_DATA) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> HttpResponse&lt;<span class="predefined-type">String</span>&gt; uploadCompleted(CompletedFileUpload file) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">try</span> {
            <span class="predefined-type">File</span> tempFile = <span class="predefined-type">File</span>.createTempFile(file.getFilename(), <span class="string"><span class="delimiter">&quot;</span><span class="content">temp</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
            Path path = Paths.get(tempFile.getAbsolutePath());
            Files.write(path, file.getBytes()); <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="keyword">return</span> HttpResponse.ok(<span class="string"><span class="delimiter">&quot;</span><span class="content">Uploaded</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> exception) {
            <span class="keyword">return</span> HttpResponse.badRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Upload Failed</span><span class="delimiter">&quot;</span></span>);
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is set to consume <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>CompletedFileUpload</code> instance gives access to metadata about the upload as well as access to the file&#8217;s contents.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_uploads">Multiple Uploads</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_different_names">Different Names</h3>
<div class="paragraph">
<p>If a multipart request supplies multiple uploads that each have a different part name, simply create an argument to your route that receives each part. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpResponse upload(<span class="predefined-type">String</span> title, <span class="predefined-type">String</span> name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A route method signature like the above will expect 2 different parts with the names "title" and "name".</p>
</div>
</div>
<div class="sect2">
<h3 id="_same_name">Same Name</h3>
<div class="paragraph">
<p>To handle receiving multiple parts with the same part name, the argument must be a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a>. When used in one of the following ways, the publisher will emit one item per file found with the specified name. The publisher must accept one of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a></p>
</li>
<li>
<p>Any POJO assuming a media codec is found that supports the content type</p>
</li>
<li>
<p>Another <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that accepts one of the chunked data types described above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpResponse upload(Publisher&lt;StreamingFileUpload&gt; files)
HttpResponse upload(Publisher&lt;CompletedFileUpload&gt; files)
HttpResponse upload(Publisher&lt;MyObject&gt; files)
HttpResponse upload(Publisher&lt;Publisher&lt;PartData&gt;&gt; files)</code></pre>
</div>
</div>
</div>
</div>
</div>


<h2 id="transfers">6.13 File Transfers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/transfers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports the sending of files to the client in a couple of easy ways.</p>
</div>
<div class="sect1">
<h2 id="_sending_file_objects">Sending File Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to simply return a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a> object from your controller method and the data will be returned to the client.</p>
</div>
<div class="paragraph">
<p>For files that should be downloaded (i.e. using the <code>Content-Disposition</code> header) you should instead construct an <a href="../api/io/micronaut/http/server/types/files/AttachedFile.html">AttachedFile</a> with the file object and the name you would like to be used. For example:</p>
</div>
<div class="listingblock">
<div class="title">Sending an AttachedFile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Get</span>
<span class="directive">public</span> AttachedFile download() {
    <span class="predefined-type">File</span> file = ...
    return <span class="keyword">new</span> AttachedFile(file, <span class="string"><span class="delimiter">&quot;</span><span class="content">myfile.txt</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_an_inputstream">Sending an InputStream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For cases where a reference to a <code>File</code> object is not possible (for example resources contained within JAR files), Micronaut supports transferring of input streams. To return a stream of data from the controller method, construct a <a href="../api/io/micronaut/http/server/types/files/StreamedFile.html">StreamedFile</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The constructor for <code>StreamedFile</code> also accepts a <code>java.net.URL</code> for your convenience.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Sending a StreamedFile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Get</span>
<span class="directive">public</span> StreamedFile download() {
    <span class="predefined-type">InputStream</span> inputStream = ...
    return <span class="keyword">new</span> StreamedFile(inputStream, <span class="string"><span class="delimiter">&quot;</span><span class="content">download.txt</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>Content-Type</code> header of file responses will be calculated based on the name of the file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The server supports returning <code>304</code> (Not Modified) responses if the files being transferred have not changed and the request contains the appropriate header. In addition, if the client accepts encoded responses, Micronaut will encode the file if it is deemed appropriate. Encoding will happen if the file is text based and greater than 1 kilobyte.</p>
</div>
</div>
</div>


<h2 id="sse">6.14 Server Sent Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/sse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports emitting <a href="https://en.wikipedia.org/wiki/Server-sent_events">Server Sent Events (SSE)</a> using the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> API.</p>
</div>
<div class="paragraph">
<p>To emit events from the server you simply return a Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> itself could publish events from a background task, via an event system or whatever.</p>
</div>
<div class="paragraph">
<p>Imagine for an example a event stream of news headlines, you may define a data class as follows:</p>
</div>
<div class="listingblock">
<div class="title">Headline.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Headline</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> title;
    <span class="directive">private</span> <span class="predefined-type">String</span> description;

    <span class="directive">public</span> Headline(<span class="predefined-type">String</span> title, <span class="predefined-type">String</span> description) {
        <span class="local-variable">this</span>.title = title;
        <span class="local-variable">this</span>.description = description;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getTitle() {
        <span class="keyword">return</span> title;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() {
        <span class="keyword">return</span> description;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To emit news headline events you can write a controller that returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a> instances using which ever Reactive library you prefer. The example below uses RxJava 2&#8217;s <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> via the <code>generate</code> method:</p>
</div>
<div class="listingblock">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.sse.Event</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Flowable</span>;
<span class="keyword">import</span> <span class="include">org.reactivestreams.Publisher</span>;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/headlines</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HeadlineController</span> {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Publisher&lt;<span class="predefined-type">Event</span>&lt;Headline&gt;&gt; index() { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="predefined-type">String</span><span class="type">[]</span> versions = <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>}; <i class="conum" data-value="2"></i><b>(2)</b>

        <span class="keyword">return</span> Flowable.generate(() -&gt; <span class="integer">0</span>, (i, emitter) -&gt; { <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="keyword">if</span> (i &lt; versions.length) {
                emitter.onNext( <i class="conum" data-value="4"></i><b>(4)</b>
                    <span class="predefined-type">Event</span>.of(<span class="keyword">new</span> Headline(<span class="string"><span class="delimiter">&quot;</span><span class="content">Micronaut </span><span class="delimiter">&quot;</span></span> + versions[i] + <span class="string"><span class="delimiter">&quot;</span><span class="content"> Released</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Come and get it</span><span class="delimiter">&quot;</span></span>))
                );
            } <span class="keyword">else</span> {
                emitter.onComplete(); <i class="conum" data-value="5"></i><b>(5)</b>
            }
            <span class="keyword">return</span> ++i;
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller method returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>For each version of Micronaut a headline is emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> type&#8217;s <code>generate</code> method is used to generate a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a>. The <code>generate</code> method accepts an initial value and a lambda that accepts the value and a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a>.  Note that this example executes on the same thread as the controller action, but you could use <code>subscribeOn</code> or map and existing "hot" <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface&#8217;s <code>onNext</code> method is used to emit objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>. The <a href="../api/io/micronaut/http/sse/Event.html#of-ET-">Event.of(ET)</a> factory method is used to construct the event.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface&#8217;s <code>onComplete</code> method is used to indicate when to finish sending server sent events.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example will send back a response of type <code>text/event-stream</code> and for each  <a href="../api/io/micronaut/http/sse/Event.html">Event</a> emitted the <code>Headline</code> type previously will be converted to JSON resulting in responses such as:</p>
</div>
<div class="listingblock">
<div class="title">Server Sent Event Response Output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"> <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span>: {<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Micronaut 1.0 Released</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Come and get it</span><span class="delimiter">&quot;</span></span>}
 <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span>: {<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Micronaut 2.0 Released</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Come and get it</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the methods of the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> interface to customize the Server Sent Event data sent back including associating event ids, comments, retry timeouts etc.</p>
</div>


<h2 id="filters">6.15 HTTP Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/filters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports the ability to apply filters to request/response processing in a similar, but reactive, way to Servlet filters in traditional Java applications.</p>
</div>
<div class="paragraph">
<p>Filters provide the ability to support the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decoration of the incoming <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p>
</li>
<li>
<p>Modification of the outgoing <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p>
</li>
<li>
<p>Implementation of cross cutting concerns such as security, tracing etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a server application, the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface&#8217;s <code>doFilter</code> method can be implemented.</p>
</div>
<div class="paragraph">
<p>The <code>doFilter</code> method accepts the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and an instance of <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a>.</p>
</div>
<div class="paragraph">
<p>The <code>ServerFilterChain</code> interface contains a resolved chain of filters with the final entry in the chain being the matched route. The <a href="../api/io/micronaut/http/filter/ServerFilterChain.html#proceed-io.micronaut.http.HttpRequest-">ServerFilterChain.proceed(io.micronaut.http.HttpRequest)</a> method can be used to resume processing of the request.</p>
</div>
<div class="paragraph">
<p>The <code>proceed(..)</code> method returns a Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits the response that will be returned to the client. Implementors of filters can subscribe to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and mutate the emitted <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> object to modify the response prior to returning the response to the client.</p>
</div>
<div class="paragraph">
<p>To put these concepts into practise lets look at an example.</p>
</div>
<div class="sect1">
<h2 id="_writing_a_filter">Writing a Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider a hypothetical use case whereby you wish to trace each request to the Micronaut "Hello World" example using some external system. The external system could be a database, a distributed tracing service and may require I/O operations.</p>
</div>
<div class="paragraph">
<p>What you don&#8217;t want to do is block the underlying Netty event loop within your filter, instead you want to the filter to proceed with execution once any I/O is complete.</p>
</div>
<div class="paragraph">
<p>As an example, consider the following example <code>TraceService</code> that uses RxJava to compose an I/O operation:</p>
</div>
<div class="listingblock">
<div class="title">A TraceService Example using RxJava</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Flowable</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.schedulers.Schedulers</span>;
<span class="keyword">import</span> <span class="include">org.slf4j</span>.*;

<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TraceService</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> LOG = LoggerFactory.getLogger(TraceService.class);

    Flowable&lt;<span class="predefined-type">Boolean</span>&gt; trace(HttpRequest&lt;?&gt; request) {
        <span class="keyword">return</span> Flowable.fromCallable(() -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="keyword">if</span> (LOG.isDebugEnabled()) {
                LOG.debug(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tracing request: </span><span class="delimiter">&quot;</span></span> + request.getUri());
            }
            <span class="comment">// trace logic here, potentially performing I/O </span><i class="conum" data-value="2"></i><b>(2)</b>
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }).subscribeOn(Schedulers.io()); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> type is used to create logic that executes potentially blocking operations to write the trace data from the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since this is just an example the logic does nothing and a place holder comment is used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The RxJava I/O scheduler is used to execute the logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then inject this implementation into your filter definition:</p>
</div>
<div class="listingblock">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Filter</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.filter</span>.*;
<span class="keyword">import</span> <span class="include">org.reactivestreams.Publisher</span>;

<span class="annotation">@Filter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello/**</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TraceFilter</span> <span class="directive">implements</span> HttpServerFilter { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> <span class="directive">final</span> TraceService traceService;

    <span class="directive">public</span> TraceFilter(TraceService traceService) { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="local-variable">this</span>.traceService = traceService;
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Filter.html">Filter</a> annotation is used to define the URI patterns the filter matches</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class implements the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The previously defined <code>TraceService</code> is injected via a constructor argument</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The final step is write the <code>doFilter</code> implementation of the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface.</p>
</div>
<div class="listingblock">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
    <span class="keyword">return</span> traceService.trace(request) <i class="conum" data-value="1"></i><b>(1)</b>
                       .switchMap(aBoolean -&gt; chain.proceed(request)) <i class="conum" data-value="2"></i><b>(2)</b>
                       .doOnNext(res -&gt; <i class="conum" data-value="3"></i><b>(3)</b>
                            res.getHeaders().add(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-Trace-Enabled</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
                       );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The previously defined <code>TraceService</code> is called to trace the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the trace call succeeds then the filter switches back to resuming the request processing using RxJava&#8217;s <code>switchMap</code> method, which invokes the <code>proceed</code> method of the <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finally, RxJava&#8217;s <code>doOnNext</code> method is used to add a header called <code>X-Trace-Enabled</code> to the response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous example demonstrates some key concepts such as executing logic in a non-blocking matter before proceeding with the request and modifying the outgoing response.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The examples use RxJava, however you can use any reactive framework that supports the Reactive streams specifications
</td>
</tr>
</table>
</div>
</div>
</div>


<h2 id="sessions">6.16 HTTP Sessions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/sessions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default Micronaut is a stateless HTTP server, however depending on your application requirements you may need to notion of HTTP sessions.</p>
</div>
<div class="paragraph">
<p>Micronaut comes with a <code>session</code> module inspired by <a href="https://projects.spring.io/spring-session/">Spring Session</a> that enables this that currently features two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In-Memory sessions - which you should combine with an a sticky sessions proxy if you plan to run multiple instances.</p>
</li>
<li>
<p>Redis sessions - In this case <a href="https://redis.io">Redis</a> is used to store sessions and non-blocking I/O is used to read/write sessions to Redis.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_enabling_sessions">Enabling Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable support for in-memory sessions you just need the <code>session</code> dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:session</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable sessions with Redis you must also have the <code>redis-lettuce</code> configuration on your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:session</span><span class="delimiter">&quot;</span></span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:redis-lettuce</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And enable Redis sessions via configuration in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Redis Sessions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">redis</span>:
    <span class="key">uri</span>: <span class="string"><span class="content">redis://localhost:6379</span></span>
<span class="key">micronaut</span>:
    <span class="key">session</span>:
        <span class="key">http</span>:
            <span class="key">redis</span>:
                <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_session_resolution">Configuring Session Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How the <a href="../api/io/micronaut/session/Session.html">Session</a> is resolved can be configured with <a href="../api/io/micronaut/session/http/HttpSessionConfiguration.html">HttpSessionConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>By default sessions are resolved using an <a href="../api/io/micronaut/session/http/HttpSessionFilter.html">HttpSessionFilter</a> that looks up session identifiers via either an HTTP header (using the <code>Authorization-Info</code> or <code>X-Auth-Token</code> header values) or via a Cookie called <code>SESSION</code>.</p>
</div>
<div class="paragraph">
<p>If you wish to disable either header resolution or cookie resolution you can via configuration in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Disabling Cookie Resolution</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">session</span>:
        <span class="key">http</span>:
            <span class="key">cookie</span>: <span class="string"><span class="content">false</span></span>
            <span class="key">header</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration enables header resolution, but disables cookie resolution. You can also configure the header or cookie names as necessary.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_sessions">Working with Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="../api/io/micronaut/session/Session.html">Session</a> object can be retrieved simply by declaring the <a href="../api/io/micronaut/session/Session.html">Session</a> in a controller method signature. For example consider the following controller:</p>
</div>
<div class="listingblock">
<div class="title">ShoppingController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.session.Session</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.session.annotation.SessionValue</span>;

<span class="keyword">import</span> <span class="include">javax.annotation.Nullable</span>;
<span class="keyword">import</span> <span class="include">javax.validation.constraints.NotBlank</span>;

<span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingController</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ATTR_CART = <span class="string"><span class="delimiter">&quot;</span><span class="content">cart</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Post</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cart/{name}</span><span class="delimiter">&quot;</span></span>)
    Cart addItem(Session session, <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> name) { <i class="conum" data-value="2"></i><b>(2)</b>
        Cart cart = session.get(ATTR_CART, Cart.class).orElseGet(() -&gt; { <i class="conum" data-value="3"></i><b>(3)</b>
            Cart newCart = <span class="keyword">new</span> Cart();
            session.put(ATTR_CART, newCart); <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="keyword">return</span> newCart;
        });
        cart.getItems().add(name);
        <span class="keyword">return</span> cart;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ShoppingController</code> declares a <a href="../api/io/micronaut/session/Session.html">Session</a> attribute called <code>cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a parameter to the method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>cart</code> attribute is retrieved</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise a new <code>Cart</code> instance is created and stored in the session</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that because the <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a required parameter to the execute the controller action, the <a href="../api/io/micronaut/session/Session.html">Session</a> will be created and saved to the <a href="../api/io/micronaut/session/SessionStore.html">SessionStore</a>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to create unnecessary sessions then you can declare the <a href="../api/io/micronaut/session/Session.html">Session</a> as <code>@Nullable</code> in which case a session will not be created and saved unnecessarily. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Post</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cart/clear</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> clearCart(<span class="annotation">@Nullable</span> Session session) {
    <span class="keyword">if</span> (session != <span class="predefined-constant">null</span>) {
        session.remove(ATTR_CART);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method will only create and inject a new <a href="../api/io/micronaut/session/Session.html">Session</a> if one already exists.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_clients">Session Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the client is a web browser then sessions should just work if you have cookies is enabled. However for programmatic HTTP clients you need to make sure you propagate the session id between HTTP calls.</p>
</div>
<div class="paragraph">
<p>For example, when invoking the <code>viewCart</code> method of the <code>StoreController</code> in the previous example the HTTP client will receive by default a <code>AUTHORIZATION_INFO</code> header. The following example, using a Spock test, demonstrates this:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">when</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The shopping cart is retrieved</span><span class="delimiter">&quot;</span></span>
HttpResponse&lt;Cart&gt; response = httpClient.exchange(HttpRequest.GET(<span class="string"><span class="delimiter">'</span><span class="content">/shopping/cart</span><span class="delimiter">'</span></span>), Cart) <i class="conum" data-value="1"></i><b>(1)</b>
                                        .blockingFirst()
Cart cart = response.body()

<span class="key">then</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The shopping cart is present as well as a session id header</span><span class="delimiter">&quot;</span></span>
response.header(HttpHeaders.AUTHORIZATION_INFO) != <span class="predefined-constant">null</span> <i class="conum" data-value="2"></i><b>(2)</b>
cart != <span class="predefined-constant">null</span>
cart.items.isEmpty()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A request is made to <code>/shopping/cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>AUTHORIZATION_INFO</code> header is present in the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then pass this <code>AUTHORIZATION_INFO</code> in subsequent requests to re-use the existing <a href="../api/io/micronaut/session/Session.html">Session</a>:</p>
</div>
<div class="listingblock">
<div class="title">Sending the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO) <i class="conum" data-value="1"></i><b>(1)</b>

response = httpClient.exchange(
        HttpRequest.POST(<span class="string"><span class="delimiter">'</span><span class="content">/shopping/cart/Apple</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
                .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart) <i class="conum" data-value="2"></i><b>(2)</b>
        .blockingFirst()
cart = response.body()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>AUTHORIZATION_INFO</code> is retrieved from the response</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And then sent as a header in the subsequent request</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_sessionvalue">Using @SessionValue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rather than explicitly injecting the <a href="../api/io/micronaut/session/Session.html">Session</a> into a controller method you can instead use <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cart</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SessionValue</span>(ATTR_CART) <i class="conum" data-value="1"></i><b>(1)</b>
Cart viewCart(<span class="annotation">@SessionValue</span> <span class="annotation">@Nullable</span> Cart cart) { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">if</span> (cart == <span class="predefined-constant">null</span>) {
        cart = <span class="keyword">new</span> Cart();
    }
    <span class="keyword">return</span> cart;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is declared on the method resulting in the return value being stored in the <a href="../api/io/micronaut/session/Session.html">Session</a>. Note that you must specify the attribute name when used on a return value</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is used on a <code>@Nullable</code> parameter which results in looking up the value from the <a href="../api/io/micronaut/session/Session.html">Session</a> in a non-blocking way and supplying it if present. In the case a value is not specified to <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> resulting in the parameter name being used to lookup the attribute.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_events">Session Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> beans to listen for <a href="../api/io/micronaut/session/Session.html">Session</a> related events located in the <a href="../api/io/micronaut/session/event/package-summary.html">io.micronaut.session.event</a> package.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the events:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Session Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionCreatedEvent.html">SessionCreatedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDeletedEvent.html">SessionDeletedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionExpiredEvent.html">SessionExpiredEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> expires</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDestroyedEvent.html">SessionDestroyedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parent of both <code>SessionDeletedEvent</code> and <code>SessionExpiredEvent</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_redis_sessions">Redis Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Storing <a href="../api/io/micronaut/session/Session.html">Session</a> instances is Redis requires special considerations.</p>
</div>
<div class="paragraph">
<p>You can configure how sessions are stored in Redis using <a href="../api/io/micronaut/configuration/lettuce/session/RedisHttpSessionConfiguration.html">RedisHttpSessionConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>The following represents an example configuration in <code>application.yml</code>.</p>
</div>
<div class="listingblock">
<div class="title">Configuring Redis Sessions</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">session</span>:
        <span class="key">http</span>:
            <span class="key">redis</span>:
                <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
                <span class="comment"># The Redis namespace to write sessions to</span>
                <span class="key">namespace</span>: <span class="string"><span class="content">'myapp:sessions'</span></span>
                <span class="comment"># Write session changes in the background</span>
                <span class="key">write-mode</span>: <span class="string"><span class="content">BACKGROUND</span></span>
                <span class="comment"># Disable programatic activation of keyspace events</span>
                <span class="key">enable-keyspace-events</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/configuration/lettuce/session/RedisSessionStore.html">RedisSessionStore</a> implementation uses <a href="https://redis.io/topics/notifications">keyspace events</a> to cleanup active sessions and fire <a href="../api/io/micronaut/session/event/SessionExpiredEvent.html">SessionExpiredEvent</a> and requires they are active.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default sessions values are serialized using Java serialization and stored in Redis hashes. You can configure serialization to instead use Jackson to serialize to JSON if desired:</p>
</div>
<div class="listingblock">
<div class="title">Using Jackson Serialization</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">session</span>:
        <span class="key">http</span>:
            <span class="key">redis</span>:
                <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">valueSerializer</span>: <span class="string"><span class="content">io.micronaut.jackson.serialize.JacksonObjectSerializer</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="serverEvents">6.17 Server Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server will emit a number of <a href="#events">Bean Events</a>, defined in the <a href="../api/io/micronaut/runtime/server/event/package-summary.html">io.micronaut.runtime.server.event</a> package, that you can write listeners for. The following table summarizes those events:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Server Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server completes startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server shuts down</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceStartedEvent.html">ServiceStartedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> listeners have been executed and exposes the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceShutdownEvent.html">ServiceShutdownEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a> listeners have been executed and exposes the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you do significant work within a listener for a <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> this will slow down you startup time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example defines a <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> that listens for <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a>:</p>
</div>
<div class="listingblock">
<div class="title">Listening for Server Startup Events</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.context.event.ApplicationEventListener</span>;
...
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StartupListener</span> <span class="directive">implements</span> ApplicationEventListener&lt;ServerStartupEvent&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(ServerStartupEvent event) {
        <span class="comment">// logic here</span>
        ...
    }
}</code></pre>
</div>
</div>


<h2 id="serverConfiguration">6.18 Configuring the HTTP Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server features a number of configuration options you may wish to tweak. They are defined in the <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a> configuration class, which extends <a href="../api/io/micronaut/http/server/HttpServerConfiguration.html">HttpServerConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to tweak configuration options for the server via <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring HTTP server settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">maxRequestSize</span>: <span class="string"><span class="content">1MB</span></span>
        <span class="key">netty</span>:
           <span class="key">maxHeaderSize</span>: <span class="string"><span class="content">500KB</span></span> <span class="comment"># maximum size for headers</span>
           <span class="key">worker</span>:
              <span class="key">threads</span>: <span class="string"><span class="content">8</span></span> <span class="comment"># number of netty worker threads</span>
           <span class="key">childOptions</span>:
              <span class="key">autoRead</span>: <span class="string"><span class="content">true</span></span> <span class="comment"># auto read request body</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All the available options are described within the javadoc of <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a>.</p>
</div>


<h2 id="threadPools">6.18.1 Configuring Server Thread Pools</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration/threadPools.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server is built on <a href="http://netty.io">Netty</a> which is designed as a non-blocking I/O toolkit in an event loop model.</p>
</div>
<div class="paragraph">
<p>To configure the number of threads used by the Netty <a href="https://netty.io/4.0/api/io/netty/channel/EventLoop.html">EventLoop</a>, you can use <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Netty Event Loop Threads</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">netty</span>:
           <span class="key">worker</span>:
              <span class="key">threads</span>: <span class="string"><span class="content">8</span></span> <span class="comment"># number of netty worker threads</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value is the value of the system property <code>io.netty.eventLoopThreads</code> or if not specified the available processors x 2
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When dealing with blocking operations, Micronaut will shift the blocking operations to an unbound, caching I/O thread pool by default. You can configure the I/O thread pool using the <a href="../api/io/micronaut/scheduling/executor/ExecutorConfiguration.html">ExecutorConfiguration</a> named <code>io</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Server I/O Thread Pool</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">executors</span>:
        <span class="key">io</span>:
           <span class="key">type</span>: <span class="string"><span class="content">fixed</span></span>
           <span class="key">nThreads</span>: <span class="string"><span class="content">75</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will create a fixed thread pool with 75 threads.</p>
</div>


<h2 id="cors">6.18.2 Configuring CORS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration/cors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports CORS (<a href="https://www.w3.org/TR/cors/">Cross Origin Resource Sharing</a>) out of the box. By default, CORS requests will be rejected. To enable processing of CORS requests, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">CORS Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By only enabling CORS processing, a "wide open" strategy will be adopted that will allow requests from any origin.</p>
</div>
<div class="paragraph">
<p>To change the settings for all origins or a specific origin, change the configuration to provide a set of "configurations". By providing any configuration, the default "wide open" configuration is not configured.</p>
</div>
<div class="listingblock">
<div class="title">CORS Configurations (&#8230;&#8203; is a placeholder)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">configurations</span>:
                <span class="key">all</span>:
                    <span class="error">...</span>
                <span class="key">web</span>:
                    <span class="error">...</span>
                <span class="key">mobile</span>:
                    <span class="error">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, three configurations are being provided. Their names (<code>all</code>, <code>web</code>, <code>mobile</code>) are not important and have no significance inside Micronaut. They are there purely to be able to easily recognize the intended user of the configuration.</p>
</div>
<div class="paragraph">
<p>The same configuration properties can be applied to each configuration. See <a href="../api/io/micronaut/http/server/cors/CorsOriginConfiguration.html">CorsOriginConfiguration</a> for the reference of properties that can be defined. Each configuration supplied will have its values default to the default values of the corresponding fields.</p>
</div>
<div class="paragraph">
<p>When a CORS request is made, configurations are searched for allowed origins that are an exact match or match the request origin through a regular expression.</p>
</div>
<div class="sect1">
<h2 id="_allowed_origins">Allowed Origins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any origin for a given configuration, simply don&#8217;t include the <code>allowedOrigins</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of valid origins, set the <code>allowedOrigins</code> key of the configuration to a list of strings. Each value can either be a static value (<code><a href="http://www.foo.com" class="bare">http://www.foo.com</a></code>) or a regular expression (<code>^http(|s)://www\.google\.com$</code>).</p>
</div>
<div class="paragraph">
<p>Any regular expressions are passed to <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#compile-java.lang.String-">Pattern#compile</a> and compared to the request origin with <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#matches--">Matcher#matches</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">configurations</span>:
                <span class="key">web</span>:
                    <span class="key">allowedOrigins</span>:
                        - <span class="string"><span class="content">http://foo.com</span></span>
                        - <span class="string"><span class="content">^http(|s)://www\.google\.com$</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allowed_methods">Allowed Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any request method for a given configuration, simply don&#8217;t include the <code>allowedHeaders</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of allowed methods, set the <code>allowedMethods</code> key of the configuration to a list of strings.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">configurations</span>:
                <span class="key">web</span>:
                    <span class="key">allowedMethods</span>:
                        - <span class="string"><span class="content">POST</span></span>
                        - <span class="string"><span class="content">PUT</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allowed_headers">Allowed Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any request header for a given configuration, simply don&#8217;t include the <code>allowedHeaders</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of allowed headers, set the <code>allowedHeaders</code> key of the configuration to a list of strings.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">configurations</span>:
                <span class="key">web</span>:
                    <span class="key">allowedHeaders</span>:
                        - <span class="string"><span class="content">Content-Type</span></span>
                        - <span class="string"><span class="content">Authorization</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exposed_headers">Exposed Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the list of headers that are sent in the response to a CORS request through the <code>Access-Control-Expose-Headers</code> header, include a list of strings for the <code>exposedHeaders</code> key in your configuration. By default no headers are exposed.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">configurations</span>:
                <span class="key">web</span>:
                    <span class="key">exposedHeaders</span>:
                        - <span class="string"><span class="content">Content-Type</span></span>
                        - <span class="string"><span class="content">Authorization</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allow_credentials">Allow Credentials</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Credentials are allowed by default for CORS requests. To disallow credentials, simply set the <code>allowCredentials</code> option to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">configurations</span>:
                <span class="key">web</span>:
                    <span class="key">allowCredentials</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_max_age">Max Age</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default maximum age that preflight requests can be cached is 30 minutes. To change that behavior, specify a value in seconds.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">server</span>:
        <span class="key">cors</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
            <span class="key">configurations</span>:
                <span class="key">web</span>:
                    <span class="key">maxAge</span>: <span class="string"><span class="content">3600</span></span> <span class="comment"># 1 hour</span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="https">6.18.3 Securing the Server with HTTPS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration/https.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports HTTPS out of the box. By default HTTPS is disabled and all requests are served using HTTP. To enable
HTTPS support, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">ssl</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">buildSelfSigned</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Micronaut will create a self-signed certificate.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default Micronaut with HTTPS support starts on port <code>8443</code> but you can change the port the property
 <code>micronaut.ssl.port</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Keep in mind that this configuration will generate a warning on the browser.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/https-warning.jpg" alt="https warning">
</div>
</div>
<div class="sect1">
<h2 id="_using_a_valid_x509_certificate">Using a valid x509 certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to configure Micronaut to use an existing valid x509 certificate, for example one created with
<a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a>. You will need the <code>server.crt</code> and <code>server.key</code> files and convert them to a
 PKCS #12 file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ openssl pkcs12 -export \
                 -in server.crt \ <i class="conum" data-value="1"></i><b>(1)</b>
                 -inkey server.key \ <i class="conum" data-value="2"></i><b>(2)</b>
                 -out server.p12 \ <i class="conum" data-value="3"></i><b>(3)</b>
                 -name someAlias \ <i class="conum" data-value="4"></i><b>(4)</b>
                 -CAfile ca.crt -caname root</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The original <code>server.crt</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The original <code>server.key</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>server.p12</code> file that will be created</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias for the certificate</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During the creation of the <code>server.p12</code> file it is necessary to define a password that will be required later when using
the certificate in Micronaut.</p>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">ssl</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">keyStore</span>:
            <span class="key">path</span>: <span class="string"><span class="content">classpath:server.p12 </span></span><i class="conum" data-value="1"></i><b>(1)</b>
            <span class="key">password</span>: <span class="string"><span class="content">mypassword </span></span><i class="conum" data-value="2"></i><b>(2)</b>
            <span class="key">type</span>: <span class="string"><span class="content">PKCS12</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>p12</code> file created. It can also be referenced as <code>file:/path/to/the/file</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The password defined during the export</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this configuration if we start Micronaut and connect to <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> we still see the warning on the
browser but if we inspect the certificate we can check that it&#8217;s the one generated by Let&#8217;s Encrypt.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/https-certificate.jpg" alt="https certificate">
</div>
</div>
<div class="paragraph">
<p>Finally we can test that the certificate is valid for the browser just by adding an alias to the domain in <code>/etc/hosts</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cat /etc/hosts
...
127.0.0.1   my-domain.org
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can connect to <code><a href="https://my-domain.org:8443" class="bare">https://my-domain.org:8443</a></code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/https-valid-certificate.jpg" alt="https valid certificate">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_java_keystore_jks">Using Java Keystore (JKS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is not recommended using this type of certificate because it is a proprietary format and it&#8217;s better to use a PKCS12
format. In any case Micronaut also supports it.</p>
</div>
<div class="paragraph">
<p>Convert the <code>p12</code> certificate to a JKS one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ keytool -importkeystore \
          -deststorepass newPassword -destkeypass newPassword \ <i class="conum" data-value="1"></i><b>(1)</b>
          -destkeystore server.keystore \ <i class="conum" data-value="2"></i><b>(2)</b>
          -srckeystore server.p12 -srcstoretype PKCS12 -srcstorepass mypassword \ <i class="conum" data-value="3"></i><b>(3)</b>
          -alias someAlias <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is necessary to define a the password for the keystore</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The file that will be created</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The PKCS12 file created before and the password defined during the creation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias used before</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If either <code>srcstorepass</code> or <code>alias</code> are not the same as defined in the <code>p12</code> file, the conversion will fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">ssl</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">keyStore</span>:
            <span class="key">path</span>: <span class="string"><span class="content">classpath:server.keystore</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">newPassword</span></span>
            <span class="key">type</span>: <span class="string"><span class="content">JKS</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Start Micronaut and the application is running on <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> using the certificate in the keystore.</p>
</div>
</div>
</div>


<h1 id="httpClient">7 The HTTP Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A critical component of any Microservice architecture is the client communication between Microservices. With that in mind Micronaut features a built in HTTP client that has both a low-level API and a higher level AOP-driven API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Regardless whether you choose to use Micronaut&#8217;s HTTP server, you may wish to use the Micronaut HTTP client in your application since it is a feature-rich client implementation
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the HTTP client you must have the <code>http-client</code> dependency on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:http-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the higher level API is built on the low-level HTTP client, we will first introduce the low-level client.</p>
</div>


<h2 id="lowLevelHttpClient">7.1 Using the Low-Level HTTP Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface forms the basis for the low-level API. This interfaces declares methods to help ease executing HTTP requests and receive responses.</p>
</div>
<div class="paragraph">
<p>The majority of the methods in the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface returns Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances, which is not always the most useful interface to work against, hence a sub-interface called <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> is included that provides a variation of the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface that returns RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> types.</p>
</div>


<h2 id="clientBasics">7.1.1 Sending your first HTTP request</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientBasics.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_obtaining_a_httpclient">Obtaining a HttpClient</h4>
<div class="paragraph">
<p>There are a few ways by which you can obtain a reference to a <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>. The most common way is using the <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.twitter.com/1.1</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@Inject</span> RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will inject a client that targets the Twitter API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@Client(&quot;\${myapp.api.twitter.url}&quot;) @Inject httpClient: RxHttpClient</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above Kotlin example will inject a client that targets the Twitter API using a configuration path. Note the required escaping (backslash) on <code>"\${path.to.config}"</code> which is required due to Kotlin string interpolation.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation is also a custom scope that will manage the creation of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> instances and ensure they are shutdown when the application shuts down.</p>
</div>
<div class="paragraph">
<p>The value you pass to the <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A absolute URI. Example <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the server targeted will be the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another way to create an <code>HttpClient</code> is with the <code>create</code> static method of the <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a>, however this approach is not recommended as you will have to ensure you manually shutdown the client and of course no dependency injection will occur for the created client.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performing_an_http_get">Performing an HTTP GET</h4>
<div class="paragraph">
<p>Generally there are two methods of interest when working with the <code>HttpClient</code>. The first method is called <code>retrieve</code>, which will execute an HTTP request and return the body in whichever type you request (by default a <code>String</code>) as an RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>.</p>
</div>
<div class="paragraph">
<p>The <code>retrieve</code> method accepts an <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> object or a <code>String</code> URI to the endpoint you wish to request.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>retrieve</code> to execute an HTTP <code>GET</code> and receive the response body as a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> result = client.toBlocking().retrieve(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello/John</span><span class="delimiter">&quot;</span></span>);

assertEquals(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello John</span><span class="delimiter">&quot;</span></span>,
        result
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, for illustration purposes we are calling <code>toBlocking()</code> to return a blocking version of the client. However, in production code you should not do this and instead rely on the non-blocking nature of the Micronaut HTTP server.</p>
</div>
<div class="paragraph">
<p>For example the following <code>@Controller</code> method calls another endpoint in a non-blocking manner:</p>
</div>
<div class="listingblock">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">io.micronaut.http.HttpRequest</span>.*;

<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpStatus</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.MediaType</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">io.micronaut.http.client</span>.*;
<span class="keyword">import</span> <span class="include">io.reactivex.Maybe</span>;

<span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello/{name}</span><span class="delimiter">&quot;</span></span>)
Maybe&lt;<span class="predefined-type">String</span>&gt; hello(<span class="predefined-type">String</span> name) { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> httpClient.retrieve( GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/endpoint/hello/</span><span class="delimiter">&quot;</span></span> + name) )
                     .firstElement(); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method <code>hello</code> returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Maybe.html">Maybe</a> which may or may not emit an item. If an item is not emitted a 404 is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>retrieve</code> method is called which returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> which has a <code>firstElement</code> method that returns the first emitted item or nothing</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using RxJava (or Reactor if you prefer) you can easily and efficiently compose multiple HTTP client calls without blocking (which will limit the throughput and scalability of your application).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_tracing_the_http_client">Debugging / Tracing the HTTP Client</h4>
<div class="paragraph">
<p>To debug the requests being sent and received from the HTTP client you can enable tracing logging via your <code>logback.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.http.client</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_http_request">Customizing the HTTP Request</h4>
<div class="paragraph">
<p>The previous example demonstrated using the static methods of the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface to construct a <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> instance. Like the name suggests a <code>MutableHttpRequest</code> can be mutated including the ability to add headers, customize the request body and so on. For example:</p>
</div>
<div class="listingblock">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;<span class="predefined-type">String</span>&gt; response = client.retrieve(
        GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello/John</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-My-Header</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">SomeValue</span><span class="delimiter">&quot;</span></span>)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example adds an additional header called <code>X-My-Header</code> to the request before it is sent. The <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> interface has a bunch more convenience methods that make it easy to modify the request in common ways.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading_json_responses">Reading JSON Responses</h4>
<div class="paragraph">
<p>Typically with Microservices a message encoding format is used such as JSON. Micronaut&#8217;s HTTP client leverages Jackson for JSON parsing hence whatever type Jackson can decode can passed as a second argument to <code>retrieve</code>.</p>
</div>
<div class="paragraph">
<p>For example consider the following <code>@Controller</code> method that returns a JSON response:</p>
</div>
<div class="listingblock">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greet/{name}</span><span class="delimiter">&quot;</span></span>)
Message greet(<span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> <span class="keyword">new</span> Message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method above returns a POJO of type <code>Message</code> which looks like:</p>
</div>
<div class="listingblock">
<div class="title">Message POJO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.fasterxml.jackson.annotation</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Message</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> text;

    <span class="annotation">@JsonCreator</span>
    <span class="directive">public</span> Message(<span class="annotation">@JsonProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> text) {
        <span class="local-variable">this</span>.text = text;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getText() {
        <span class="keyword">return</span> text;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jackson annotations are used to map the constructor
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the client end you can call this endpoint and decode the JSON into a map using the <code>retrieve</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;<span class="predefined-type">Map</span>&gt; response = client.retrieve(
        GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greet/John</span><span class="delimiter">&quot;</span></span>), <span class="predefined-type">Map</span>.class
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above examples decodes the response into a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html">Map</a>, representing the JSON. If you wish to customize the type of the key and string you can use the <code>Argument.of(..)</code> method:</p>
</div>
<div class="listingblock">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">response = client.retrieve(
        GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greet/John</span><span class="delimiter">&quot;</span></span>),
        Argument.of(<span class="predefined-type">Map</span>.class, <span class="predefined-type">String</span>.class, <span class="predefined-type">String</span>.class) <i class="conum" data-value="1"></i><b>(1)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Argument.of</code> method is used to return a <code>Map</code> whether the key and value are typed as <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whilst retrieving JSON as a map can be desirable, more often than not you will want to decode objects into Plain Old Java Objects (POJOs). To do that simply pass the type instead:</p>
</div>
<div class="listingblock">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;Message&gt; response = client.retrieve(
        GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greet/John</span><span class="delimiter">&quot;</span></span>), Message.class
);

assertEquals(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello John</span><span class="delimiter">&quot;</span></span>,
        response.blockingFirst().getText()
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how you can use the same Java type on both the client and the server. The implication of this is that typically you will want to define a common API project where you define the interfaces and types that define your API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_decoding_other_content_types">Decoding Other Content Types</h4>
<div class="paragraph">
<p>If the server you are communicating with uses a custom content type that is not JSON by default Micronaut&#8217;s HTTP client will not know how to decode this type.</p>
</div>
<div class="paragraph">
<p>To resolve this issue you can register <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> as a bean and it will be automatically picked up and used to decode (or encode) messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_receiving_the_full_http_response">Receiving the Full HTTP Response</h4>
<div class="paragraph">
<p>Sometimes, receiving just the object is not enough and you need information about the response. In this case, instead of <code>retrieve</code> you should use the <code>exchange</code> method:</p>
</div>
<div class="listingblock">
<div class="title">Recieving the Full HTTP Response</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
        GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greet/John</span><span class="delimiter">&quot;</span></span>), Message.class <i class="conum" data-value="1"></i><b>(1)</b>
);

HttpResponse&lt;Message&gt; response = call.blockingFirst();
Optional&lt;Message&gt; message = response.getBody(Message.class); <i class="conum" data-value="2"></i><b>(2)</b>
<span class="comment">// check the status</span>
assertEquals(
        HttpStatus.OK,
        response.getStatus() <i class="conum" data-value="3"></i><b>(3)</b>
);
<span class="comment">// check the body</span>
assertTrue(message.isPresent());
assertEquals(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello John</span><span class="delimiter">&quot;</span></span>,
        message.get().getText()
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>exchange</code> method is used to receive the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The body can be retrieved using the <code>getBody(..)</code> method of the response</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Other aspects of the response, such as the <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> can be checked</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example receives the full <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> object from which you can obtain headers and other useful information.</p>
</div>
</div>


<h2 id="clientPostRequests">7.1.2 Posting a Request Body</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientPostRequests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>All the examples up until now have used the same HTTP method i.e <code>GET</code>. The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface has factory methods for all the different HTTP methods. The following table summarizes the available methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. HttpRequest Factory Methods</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Allows Body</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#GET-java.lang.String-">HttpRequest.GET(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>GET</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#OPTIONS-java.lang.String-">HttpRequest.OPTIONS(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>OPTIONS</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#HEAD-java.lang.String-">HttpRequest.HEAD(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>HEAD</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#POST-java.lang.String-T-">HttpRequest.POST(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>POST</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PUT-java.lang.String-T-">HttpRequest.PUT(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PUT</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PATCH-java.lang.String-T-">HttpRequest.PATCH(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PATCH</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#DELETE-java.lang.String-">HttpRequest.DELETE(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>DELETE</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <code>create</code> method also exists to construct a request for any <a href="../api/io/micronaut/http/HttpMethod.html">HttpMethod</a> type. Since the <code>POST</code>, <code>PUT</code> and <code>PATCH</code> methods require a body, a second argument which is the body object is required.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to send a simply <code>String</code> body:</p>
</div>
<div class="listingblock">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;HttpResponse&lt;<span class="predefined-type">String</span>&gt;&gt; call = client.exchange(
        POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello John</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
            .contentType(MediaType.TEXT_PLAIN_TYPE)
            .accept(MediaType.TEXT_PLAIN_TYPE), <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="predefined-type">String</span>.class <i class="conum" data-value="3"></i><b>(3)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>POST</code> method is used with the first argument being the URI and the second argument the body</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The content type and accepted type are set to <code>text/plain</code> (the default content type is <code>application/json</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The expected response type is a <code>String</code></td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_sending_json">Sending JSON</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example sends plain text, if you wish send JSON you can simply pass the object you wish to encode as JSON, whether that be a map or a POJO. As long as Jackson is able to encode it.</p>
</div>
<div class="paragraph">
<p>For example, the <code>Message</code> class from the previous section, you can create an instance and pass it to the <code>POST</code> method:</p>
</div>
<div class="listingblock">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
        POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greet</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello John</span><span class="delimiter">&quot;</span></span>)), <i class="conum" data-value="1"></i><b>(1)</b>
        Message.class <i class="conum" data-value="2"></i><b>(2)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>And instance of <code>Message</code> is created and passed to the <code>POST</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The same class is used to decode the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the above example the following JSON will be sent as the body of the request:</p>
</div>
<div class="listingblock">
<div class="title">Resulting JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello John</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON itself can be customized however you want using <a href="https://github.com/FasterXML/jackson-annotations">Jackson Annotations</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_uri_template">Using a URI Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If some of the properties of the object need to be in the URI being posted to you can use a URI template.</p>
</div>
<div class="paragraph">
<p>For example imagine you have a class <code>Book</code> that has a property called <code>title</code>. You can represent the <code>title</code> property in the URI template and then populate it from an instance of <code>Book</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;HttpResponse&lt;<span class="predefined-type">Book</span>&gt;&gt; call = client.exchange(
        POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/amazon/book/{title}</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>)),
        <span class="predefined-type">Book</span>.class
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case the <code>title</code> property of the passed object will be included in the URI being posted to.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_form_data">Sending Form Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also encode a POJO or a map as regular form data instead of JSON. Just set the content type to <code>application/x-www-form-urlencoded</code> on the post request:</p>
</div>
<div class="listingblock">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;HttpResponse&lt;<span class="predefined-type">Book</span>&gt;&gt; call = client.exchange(
        POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/amazon/book/{title}</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>))
        .contentType(MediaType.APPLICATION_FORM_URLENCODED),
        <span class="predefined-type">Book</span>.class
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Jackson is used to bind form data too, so to customize the binding process you can use <a href="https://github.com/FasterXML/jackson-annotations">Jackson annotations</a>.</p>
</div>
</div>
</div>


<h2 id="clientUploads">7.1.3 Multipart Client Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientUploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP Client supports the ability to create multipart requests. In order to build a multipart request you must set the content type to <code>multipart/form-data</code> and set the body to be an instance of <a href="../api/io/micronaut/http/client/multipart/MultipartBody.html">MultipartBody</a>:</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Creating the body</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.http.client.multipart.MultipartBody</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.MediaType</span>

<span class="predefined-type">File</span> file = ...
MultipartBody requestBody = MultipartBody.builder()     <i class="conum" data-value="1"></i><b>(1)</b>
        .addPart(                                       <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>,
            file.name,
            MediaType.TEXT_PLAIN_TYPE,
            file
        ).build()                                       <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You need to create a MultipartBody builder for adding parts to the body.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method to add a part to the body, in this case a file. There are different variations of this method which you can see in <a href="../api/io/micronaut/http/client/multipart/MultipartBody.Builder.html" target="_blank" rel="noopener">MultipartBody.Builder</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call the build method to assemble all parts from the builder into a MultipartBody. At least one part is required.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Creating a request</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">HttpRequest.POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/multipart/upload</span><span class="delimiter">&quot;</span></span>, requestBody)       <i class="conum" data-value="1"></i><b>(1)</b>
        .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The multipart request body with different sets of data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the content-type header of the request to <code>multipart/form-data</code>.</td>
</tr>
</table>
</div>


<h2 id="clientStreaming">7.1.4 Streaming JSON over HTTP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientStreaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s HTTP client includes support for streaming data over HTTP via the <a href="../api/io/micronaut/http/client/RxStreamingHttpClient.html">RxStreamingHttpClient</a> interface which includes methods specific to HTTP streaming including:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. HTTP Streaming Methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a stream of data as a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exchangeStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> wrapping a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsonStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a non-blocking stream of JSON objects</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In order to do JSON streaming you should on the server side declare a controller method that returns a <code>application/x-json-stream</code> of JSON objects. For example:</p>
</div>
<div class="listingblock">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.MediaType</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation</span>.*;
<span class="keyword">import</span> <span class="include">io.reactivex.Flowable</span>;

<span class="keyword">import</span> <span class="include">java.time.ZonedDateTime</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;

<span class="annotation">@Get</span>(uri = <span class="string"><span class="delimiter">&quot;</span><span class="content">/headlines</span><span class="delimiter">&quot;</span></span>, produces = MediaType.APPLICATION_JSON_STREAM) <i class="conum" data-value="1"></i><b>(1)</b>
Flowable&lt;Headline&gt; streamHeadlines() {
    <span class="keyword">return</span> Flowable.fromCallable(() -&gt; {  <i class="conum" data-value="2"></i><b>(2)</b>
        Headline headline = <span class="keyword">new</span> Headline();
        headline.setText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Latest Headline at </span><span class="delimiter">&quot;</span></span> + ZonedDateTime.now());
        <span class="keyword">return</span> headline;
    }).repeat(<span class="integer">100</span>) <i class="conum" data-value="3"></i><b>(3)</b>
      .delay(<span class="integer">1</span>, <span class="predefined-type">TimeUnit</span>.SECONDS); <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method <code>streamHeadlines</code> is defined that produces <code>application/x-json-stream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is created from a <code>Callable</code> function (note no blocking occurs within the function so this is ok, otherwise you would want to <code>subscribeOn</code> an I/O thread pool).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is set to repeat 100 times</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> will emit items with a delay of 1 second between each item</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The server does not have to be written in Micronaut, any server that supports JSON streaming will do.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then on the client simply subscribe to the stream using <code>jsonStream</code> and every time the server emits a JSON object the client will decode and consume it:</p>
</div>
<div class="listingblock">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flowable&lt;Headline&gt; headlineStream = client.jsonStream(GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/streaming/headlines</span><span class="delimiter">&quot;</span></span>), Headline.class); <i class="conum" data-value="1"></i><b>(1)</b>
CompletableFuture&lt;Headline&gt; future = <span class="keyword">new</span> CompletableFuture&lt;&gt;(); <i class="conum" data-value="2"></i><b>(2)</b>
headlineStream.subscribe(<span class="keyword">new</span> Subscriber&lt;Headline&gt;() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onSubscribe(Subscription s) {
        s.request(<span class="integer">1</span>); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onNext(Headline headline) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received Headline = </span><span class="delimiter">&quot;</span></span> + headline.getText());
        future.complete(headline); <i class="conum" data-value="4"></i><b>(4)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) {
        future.completeExceptionally(t); <i class="conum" data-value="5"></i><b>(5)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onComplete() {
        <span class="comment">// no-op </span><i class="conum" data-value="6"></i><b>(6)</b>
    }
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>jsonStream</code> method is used return a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>CompletableFuture</code> is used in the example to receive a value, but what you do with each emitted item is application specific</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Subscription.html">Subscription</a> is used to request a single item. You can use the <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Subscription.html">Subscription</a> to regulate back pressure and demand.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>onNext</code> method is called when an item is emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>onError</code> method is called when an error occurs</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>onComplete</code> method is called when all <code>Headline</code> instances have been emitted</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note neither the server or the client in the example above perform blocking I/O at any point.</p>
</div>


<h2 id="clientConfiguration">7.1.5 Configuring HTTP clients</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The default HTTP client configuration is a <a href="#configurationProperties">Configuration Properties</a> called <a href="../api/io/micronaut/http/client/DefaultHttpClientConfiguration.html">DefaultHttpClientConfiguration</a> that allows configuring the default behaviour for all HTTP clients. For example, in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Altering default HTTP client configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">http</span>:
        <span class="key">client</span>:
            <span class="key">readTimeout</span>: <span class="string"><span class="content">5s</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example sets of <code>readTimeout</code> property of the <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> class.</p>
</div>
<div class="paragraph">
<p>If you wish to have a separate configuration per client then there are a couple of options. An option that fits nicely with <a href="#serviceDiscovery">Service Discovery</a> is to define a named bean that is a subclass of <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>For example given an injected client for a service called <code>hello</code> using <code>@Client</code>:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@Inject</span> RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure the property of the HTTP client you can define the following bean:</p>
</div>
<div class="listingblock">
<div class="title">Defining an HTTP client configuration bean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">HelloConfiguration</span> <span class="directive">extends</span> HttpClientConfiguration {
   <span class="directive">public</span> HelloConfiguration(ApplicationConfiguration applicationConfiguration) {
        <span class="local-variable">super</span>(applicationConfiguration);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively if you are not using service discovery then you can use the <code>configuration</code> member of <code>@Client</code> to refer to a specific type:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://api.twitter.com/1.1</span><span class="delimiter">&quot;</span></span>,
        configuration=TwitterHttpClientConfiguration.class)
<span class="annotation">@Inject</span>
RxHttpClient httpClient;</code></pre>
</div>
</div>


<h2 id="clientAnnotation">7.2 Declarative HTTP Clients with @Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that you have gathered an understanding of the workings of the lower level HTTP client, it is time to take a look at Micronaut&#8217;s support for declarative clients via the <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>Essentially, the <code>@Client</code> annotation can be declared on any interface or abstract class and through the use of <a href="#introductionAdvice">Introduction Advice</a> the abstract methods will be implemented for you at compile time, greatly simplifying the creation of HTTP clients.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example. Given the following class:</p>
</div>
<div class="listingblock">
<div class="title">Pet.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Pet</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="type">int</span> age;

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="type">int</span> getAge() {
        <span class="keyword">return</span> age;
    }

    <span class="directive">public</span> <span class="type">void</span> setAge(<span class="type">int</span> age) {
        <span class="local-variable">this</span>.age = age;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a common interface for saving new <code>Pet</code> instances:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Post</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.validation.Validated</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Single</span>;

<span class="keyword">import</span> <span class="include">javax.validation.constraints</span>.*;

<span class="annotation">@Validated</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">PetOperations</span> {
    <span class="annotation">@Post</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
    Single&lt;Pet&gt; save(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> name, <span class="annotation">@Min</span>(<span class="integer">1L</span>) <span class="type">int</span> age);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the interface uses Micronaut&#8217;s HTTP annotations which are usable on both the server and client side. Also, as you can see you can use <code>javax.validation</code> constraints to validate arguments.</p>
</div>
<div class="paragraph">
<p>Additionally, to use the <code>javax.validation</code> features you should have the <code>validation</code> and <code>hibernate-validator</code> dependencies on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:validation</span><span class="delimiter">&quot;</span></span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:hibernate-validator</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the server-side of Micronaut you can implement the <code>PetOperations</code> interface:</p>
</div>
<div class="listingblock">
<div class="title">PetController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Controller</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Single</span>;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/pets</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">PetController</span> <span class="directive">implements</span> PetOperations {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Single&lt;Pet&gt; save(<span class="predefined-type">String</span> name, <span class="type">int</span> age) {
        Pet pet = <span class="keyword">new</span> Pet();
        pet.setName(name);
        pet.setAge(age);
        <span class="comment">// save to database or something</span>
        <span class="keyword">return</span> Single.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then define a declarative client in <code>src/test/java</code> that uses <code>@Client</code> to automatically, at compile time, implement a client:</p>
</div>
<div class="listingblock">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.http.client.Client</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Single</span>;

<span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/pets</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">PetClient</span> <span class="directive">extends</span> PetOperations { <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="annotation">@Override</span>
    Single&lt;Pet&gt; save(<span class="predefined-type">String</span> name, <span class="type">int</span> age); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/client/Client.html">Client</a> annotation is used with a value relative to the current server. In this case <code>/pets</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The interface extends from <code>PetOperations</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>save</code> method is overridden. See warning below.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Notice in the above example we override the <code>save</code> method. This is necessary if you compile without the <code>-parameters</code> option since Java does not retain parameters names in the byte code otherwise. If you compile with <code>-parameters</code> then overriding is not necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined a client you can simply <code>@Inject</code> it wherever you may need it.</p>
</div>
<div class="paragraph">
<p>Recall that the value of <code>@Client</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An absolute URI. Example <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the server targeted will be the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a production deployment you would typically use a service ID and <a href="#serviceDiscovery">Service Discovery</a> to discover services automatically.</p>
</div>
<div class="paragraph">
<p>Another important thing to notice regarding the <code>save</code> method in the example above is that is returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> type.</p>
</div>
<div class="paragraph">
<p>This is a non-blocking reactive type and typically you want your HTTP clients not to block. There are cases where you may want to write an HTTP client that does block (such as in unit test cases), but this are rare.</p>
</div>
<div class="paragraph">
<p>The following table illustrates common return types usable with <a href="../api/io/micronaut/http/client/Client.html">@Client</a>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single&lt;HttpResponse&lt;&lt;String&gt;&gt;&gt; hello()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> implementation that emits a POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;Book&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A blocking native type. Such as <code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Generally, any reactive type that can be converted to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface is supported as a return type including (but not limited to) the reactive types defined by RxJava 1.x, RxJava 2.x and Reactor 3.x.</p>
</div>
<div class="paragraph">
<p>Returning <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> instances is also supported. Note that returning any other type <em>will result in a blocking request</em> and is not recommended other than for testing.</p>
</div>


<h2 id="clientParameters">7.2.1 Customizing Parameter Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientParameters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous example presented a trivial example that uses the parameters of a method to represent the body of a <code>POST</code> request:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Post</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
Single&lt;Pet&gt; save(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> name, <span class="annotation">@Min</span>(<span class="integer">1L</span>) <span class="type">int</span> age);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>save</code> method when called will perform an HTTP <code>POST</code> with the following JSON by default:</p>
</div>
<div class="listingblock">
<div class="title">Example Produced JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Dino</span><span class="delimiter">&quot;</span></span>, <span class="error">a</span><span class="error">g</span><span class="error">e</span>:<span class="integer">10</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may however want to customize what is sent as the body, the parameters, URI variables and so on. The <a href="../api/io/micronaut/http/client/Client.html">@Client</a> annotation is very flexible in this regard and supports the same <a href="../api/io/micronaut/http/annotation/package-summary.html">HTTP Annotations</a> as Micronaut&#8217;s HTTP server.</p>
</div>
<div class="paragraph">
<p>For example, the following defines a URI template and the <code>name</code> parameter is used as part of the URI template, whilst <a href="../api/io/micronaut/http/annotation/Body.html">@Body</a> is used declare that the contents to send to the server are represented by the <code>Pet</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Post</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{name}</span><span class="delimiter">&quot;</span></span>)
Single&lt;Pet&gt; save(
    <span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> name, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Body</span> <span class="annotation">@Valid</span> Pet pet) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name parameter, included as part of the URI, and declared <code>@NotBlank</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>pet</code> parameter, used to encode the body and declared <code>@Valid</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table summarizes the parameter annotations, their purpose and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to specify the parameter that is the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be sent as cookies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be sent as HTTP headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String contentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Parameter.html">@Parameter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows customizing the name of the URI parameter to bind from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Parameter('userAge') Integer age</code></p></td>
</tr>
</tbody>
</table>


<h2 id="clientHeaders">7.2.2 Customizing Request Headers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientHeaders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Customizing the request headers deserves special mention as there are several ways that can be accomplished.</p>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_configuration">Populating Headers Using Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation can be declared at the type level and is repeatable such that it is possible to drive the request headers sent via configuration using annotation metadata.</p>
</div>
<div class="paragraph">
<p>The following example serves to illustrate this:</p>
</div>
<div class="listingblock">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/pets</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Header</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-Pet-Client</span><span class="delimiter">&quot;</span></span>, value=<span class="string"><span class="delimiter">&quot;</span><span class="content">${pet.client.id}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">PetClient</span> <span class="directive">extends</span> PetOperations {

    <span class="annotation">@Override</span>
    Single&lt;Pet&gt; save(<span class="predefined-type">String</span> name, <span class="type">int</span> age);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation on the <code>PetClient</code> interface that reads a property using property placeholder configuration called <code>pet.client.id</code>.</p>
</div>
<div class="paragraph">
<p>In your application configuration you then set the following in <code>application.yml</code> to populate the value:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Headers in YAML</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">pet</span>:
    <span class="key">client</span>:
        <span class="key">id</span>: <span class="string"><span class="content">foo</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can supply a <code>PET_CLIENT_ID</code> environment variable and the value will be populated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_an_client_filter">Populating Headers using an Client Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alternatively if you need the ability to dynamically populate headers an alternative is to use a <a href="#clientFilter">Client Filter</a>.</p>
</div>
<div class="paragraph">
<p>For more information on writing client filters see the <a href="#clientFilter">Client Filters</a> section of the guide.</p>
</div>
</div>
</div>


<h2 id="clientJackson">7.2.3 Customizing Jackson Settings</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientJackson.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Jackson is used for message encoding to JSON. A default Jackson <code>ObjectMapper</code> is configured and used by Micronaut HTTP clients.</p>
</div>
<div class="paragraph">
<p>You can override the settings used to construct the <code>ObjectMapper</code> using the properties defined by the <a href="../api/io/micronaut/jackson/JacksonConfiguration.html">JacksonConfiguration</a> class in <code>application.yml</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following configuration enabled indented output for Jackson:</p>
</div>
<div class="listingblock">
<div class="title">Example Jackson Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">jackson</span>:
    <span class="key">serialization</span>:
        <span class="key">indentOutput</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, these settings apply globally and impact both how the HTTP server renders JSON and how JSON is sent from the HTTP client. Given that sometimes it useful to provide client specific Jackson settings which can be done with the <a href="../api/io/micronaut/jackson/annotation/JacksonFeatures.html">@JacksonFeatures</a> annotation on any client:</p>
</div>
<div class="paragraph">
<p>As an example, the following snippet is taken from Micronaut&#8217;s native Eureka client (which, of course, is built using Micronaut&#8217;s HTTP client):</p>
</div>
<div class="listingblock">
<div class="title">Example of JacksonFeatures</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = EurekaClient.SERVICE_ID, path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/eureka</span><span class="delimiter">&quot;</span></span>, configuration = EurekaConfiguration.class)
<span class="annotation">@JacksonFeatures</span>(
    enabledSerializationFeatures = WRAP_ROOT_VALUE,
    disabledSerializationFeatures = WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED,
    enabledDeserializationFeatures = {UNWRAP_ROOT_VALUE, ACCEPT_SINGLE_VALUE_AS_ARRAY}
)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">EurekaClient</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Eureka serialization format for JSON uses the <code>WRAP_ROOT_VALUE</code> serialization feature of Jackson, hence it is enabled just for that client.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the customization offered by <code>JacksonFeatures</code> is not enough, you can also write a <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> for the <code>ObjectMapper</code> and add whatever customizations you need.
</td>
</tr>
</table>
</div>


<h2 id="clientRetry">7.2.4 Retry and Circuit Breaker</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientRetry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Being able to recover from failure is critical for HTTP clients, and that is where the integrated <a href="#retry">Retry Advice</a> included as part of Micronaut comes in really handy.</p>
</div>
<div class="paragraph">
<p>You can declare the <a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a> or <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">@CircuitBreaker</a> annotations on any <a href="../api/io/micronaut/http/client/Client.html">@Client</a> interface and the retry policy will be applied, for example:</p>
</div>
<div class="listingblock">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/pets</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Retryable</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">PetClient</span> <span class="directive">extends</span> PetOperations {

    <span class="annotation">@Override</span>
    Single&lt;Pet&gt; save(<span class="predefined-type">String</span> name, <span class="type">int</span> age);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on customizing retry, see the section on <a href="#retry">Retry Advice</a>.</p>
</div>


<h2 id="clientFallback">7.2.5 Client Fallbacks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientFallback.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems, failure happens and it is best to be prepared for it and handle it in as graceful a manner possible.</p>
</div>
<div class="paragraph">
<p>In addition, when developing Microservices it is quite common to work on a single Microservice without other Microservices the project requires being available.</p>
</div>
<div class="paragraph">
<p>With that in mind Micronaut features a native fallback mechanism that is integrated into <a href="#retry">Retry Advice</a> that allows falling back to another implementation in the case of failure.</p>
</div>
<div class="paragraph">
<p>Using the <a href="../api/io/micronaut/retry/annotation/Fallback.html">@Fallback</a> annotation you can declare a fallback implementation of a client that will be picked up and used once all possible retries have been exhausted.</p>
</div>
<div class="paragraph">
<p>In fact the mechanism is not strictly linked to Retry, you can declare any class as <a href="../api/io/micronaut/retry/annotation/Recoverable.html">@Recoverable</a> and if a method call fails (or, in the case of reactive types, an error is emitted) a class annotated with <code>@Fallback</code> will be searched for.</p>
</div>
<div class="paragraph">
<p>To illustrate this consider again the <code>PetOperations</code> interface declared earlier. You can define a <code>PetFallback</code> class that will be called in the case of failure:</p>
</div>
<div class="listingblock">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Fallback</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PetFallback</span> <span class="directive">implements</span> PetOperations {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> Single&lt;Pet&gt; save(<span class="predefined-type">String</span> name, <span class="type">int</span> age) {
        Pet pet = <span class="keyword">new</span> Pet();
        pet.setAge(age);
        pet.setName(name);
        <span class="keyword">return</span> Single.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you purely want to use fallbacks to help with testing against external Microservices you can define fallbacks in the <code>src/test/java</code> directory so they are not included in production code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see the fallback does not perform any network operations and is quite simple, hence will provide a successful result in the case of an external system being down.</p>
</div>
<div class="paragraph">
<p>Of course, the actual behaviour of the fallback is down to you. You could for example implement a fallback that pulls data from a local cache when the real data is not available, and sends alert emails to operations about downtime or whatever.</p>
</div>


<h2 id="netflixHystrix">7.2.6 Netflix Hystrix Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/netflixHystrix.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/Hystrix">Netflix Hystrix</a> is a fault tolerance library developed by the Netflix team and designed to improve resilience of inter process communication.</p>
</div>
<div class="paragraph">
<p>Micronaut features integration with Hystrix through the <code>netflix-hystrix</code> module, which you can add to your <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:netflix-hystrix</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_hystrixcommand_annotation">Using the @HystrixCommand Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the above dependency declared you can annotate any method (including methods defined on <code>@Client</code> interfaces) with the <a href="../api/io/micronaut/configurations/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a> annotation and it will wrap the methods execution in a Hystrix command. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @HystrixCommand</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@HystrixCommand</span>
<span class="predefined-type">String</span> hello(<span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">$</span>name</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This works for reactive return types such as <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> etc. as well and the reactive type will be wrapped in a <code>HystrixObservableCommand</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/configurations/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a> annotation also integrates with Micronauts support for <a href="#retry">Retry Advice</a> and <a href="#clientFallback">Fallbacks</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For information on how to customize the Hystrix thread pool, group and properties see the javadoc for <a href="../api/io/micronaut/configurations/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_hystrix_stream_dashboard">Enabling Hystrix Stream &amp; Dashboard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can enable a Server Sent Event stream to feed into the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> by setting the <code>hystrix.stream.enabled</code> setting to <code>true</code> in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Hystrix Stream</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">hystrix</span>:
    <span class="key">stream</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This exposes a <code>/hystrix.stream</code> endpoint with the format the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> expects.</p>
</div>
</div>
</div>


<h2 id="clientFilter">7.3 HTTP Client Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientFilter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when calling another Microservice.</p>
</div>
<div class="paragraph">
<p>To simplify this, Micronaut includes the ability to define <a href="../api/io/micronaut/http/filter/HttpClientFilter.html">HttpClientFilter</a> classes that are applied to all matching HTTP clients.</p>
</div>
<div class="paragraph">
<p>As an example say you want to build a client to communicate with the <a href="https://bintray.com/docs/api/">Bintray REST API</a>. It would be terribly tedious to have to specify authentication for every single HTTP call.</p>
</div>
<div class="paragraph">
<p>To resolve this burden you can define a filter. The following is an example <code>BintrayService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BintrayApi</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> <span class="predefined-type">URL</span> = <span class="string"><span class="delimiter">'</span><span class="content">https://api.bintray.com</span><span class="delimiter">'</span></span>
}
<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">BintrayService</span> {
    <span class="directive">final</span> RxHttpClient client
    <span class="directive">final</span> <span class="predefined-type">String</span> org

    BintrayService(
            <span class="annotation">@Client</span>(BintrayApi.URL) RxHttpClient client,           <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">'</span><span class="content">${bintray.organization}</span><span class="delimiter">'</span></span>) <span class="predefined-type">String</span> org ) {
        <span class="local-variable">this</span>.client = client
        <span class="local-variable">this</span>.org = org
    }

    Flowable&lt;HttpResponse&lt;<span class="predefined-type">String</span>&gt;&gt; fetchRepositories() {
        <span class="keyword">return</span> client.exchange(HttpRequest.GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/repos/</span><span class="inline"><span class="inline-delimiter">$</span>org</span><span class="delimiter">&quot;</span></span>), <span class="predefined-type">String</span>) <i class="conum" data-value="2"></i><b>(2)</b>
    }

    Flowable&lt;HttpResponse&lt;<span class="predefined-type">String</span>&gt;&gt; fetchPackages(<span class="predefined-type">String</span> repo) {
        <span class="keyword">return</span> client.exchange(HttpRequest.GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/repos/</span><span class="inline"><span class="inline-delimiter">${</span>org<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>repo<span class="inline-delimiter">}</span></span><span class="content">/packages</span><span class="delimiter">&quot;</span></span>), <span class="predefined-type">String</span>) <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> is injected for the Bintray API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The organization is configurable via configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Bintray API is secured. To authenticate you need to add an <code>Authorization</code> header for every request. You could modify <code>fetchRepositories</code> and <code>fetchPackages</code> methods to include the necessary HTTP Header for each request. Using a filter is much simpler though:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Filter</span>(<span class="string"><span class="delimiter">'</span><span class="content">/repos/**</span><span class="delimiter">'</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">BintrayFilter</span> <span class="directive">implements</span> HttpClientFilter {


    <span class="directive">final</span> <span class="predefined-type">String</span> username
    <span class="directive">final</span> <span class="predefined-type">String</span> token

    BintrayFilter(
            <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">'</span><span class="content">${bintray.username}</span><span class="delimiter">'</span></span>) <span class="predefined-type">String</span> username, <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">'</span><span class="content">${bintray.token}</span><span class="delimiter">'</span></span>) <span class="predefined-type">String</span> token ) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.username = username
        <span class="local-variable">this</span>.token = token
    }

    <span class="annotation">@Override</span>
    Publisher&lt;? <span class="directive">extends</span> HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        <span class="keyword">return</span> chain.proceed(
                request.basicAuth(username, token) <i class="conum" data-value="3"></i><b>(3)</b>
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can match only a subset of paths with a Client filter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>username</code> and <code>token</code> are injected via configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>basicAuth</code> method is used include the HTTP BASIC credentials</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, whenever you invoke the <code>bintrayService.fetchRepositories()</code> method, the <code>Authorization</code> HTTP header is included in the request.</p>
</div>


<h1 id="cloud">8 Cloud Native Features</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The majority of frameworks in use on the JVM were designed at a time when the Cloud and Microservices didn&#8217;t exist and hence are filled with legacy, consume more memory due to being designed to run on traditional Java containers and include Cloud support as an add-on.</p>
</div>
<div class="paragraph">
<p>Micronaut is designed from the ground-up for building Microservices for the Cloud. In other words Micronaut truly embraces the industries current favorite buzzword: Cloud Native.</p>
</div>
<div class="paragraph">
<p>Integrated directly into the runtime is support for features such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed Configuration</p>
</li>
<li>
<p>Service Discovery</p>
</li>
<li>
<p>Client Side Load Balancing</p>
</li>
<li>
<p>Distributed Tracing</p>
</li>
<li>
<p>Serverless Functions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many of the features in Micronaut and heavily inspired by features from Spring and Grails. This is by design and helps developers who are already familiar with systems such as Spring Cloud.</p>
</div>
<div class="paragraph">
<p>The following sections cover these features and how to use them.</p>
</div>


<h2 id="cloudConfiguration">8.1 Cloud Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/cloudConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Applications that are built for the Cloud often need adapt to running in a Cloud environment, read and share configuration in a distributed manner and externalize configuration to the environment where necessary.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="#environments">Environment</a> concept is by default Cloud platform aware and will make a best effort to detect the underlying active environment.</p>
</div>
<div class="paragraph">
<p>You can then use the <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation to <a href="#conditionalBeans">conditionally load bean definitions</a>.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the constants provided by the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Environment Detection</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Constant</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requires Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#ANDROID">ANDROID</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running as an Android application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.ANDROID)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running within a JUnit or Spock test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.TEST)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD">CLOUD</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running in a Cloud environment (present for all other cloud platform types)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AMAZON_EC2">AMAZON_EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://aws.amazon.com/ec2">Amazon EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AMAZON_EC2)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#GOOGLE_COMPUTE">GOOGLE_COMPUTE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://cloud.google.com/compute/">Google Compute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.GOOGLE_COMPUTE)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#KUBERNETES">KUBERNETES</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.kubernetes.io">Kubernetes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.KUBERNETES)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#HEROKU">HEROKU</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://heroku.com">Heroku</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.HEROKU)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD_FOUNDRY">CLOUD_FOUNDRY</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.cloudfoundry.org">Cloud Foundry</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD_FOUNDRY)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AZURE">AZURE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://azure.microsoft.com">Microsoft Azure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AZURE)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#IBM">IBM</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.ibm.com/cloud/">IBM Cloud</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.IBM)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that it may be that case that you have multiple active environment names since you may run Kubernetes on AWS for example.</p>
</div>
<div class="paragraph">
<p>In addition, using the value of the constants defined in the table above you can create environment specific configuration files. For example if you create a <code>src/main/resources/application-gcp.yml</code> file then that configuration will only be loaded when running on Google Compute.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Any configuration property in the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> can also be set via an environment variable. For example, setting the <code>CONSUL_CLIENT_HOST</code> environment variable will override the <code>host</code> property in <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_using_cloud_instance_metadata">Using Cloud Instance Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Micronaut detects it is running on Google Compute or AWS EC2, upon startup Micronaut will populate the interface <a href="../api/io/micronaut/discovery/cloud/ComputeInstanceMetadata.html">ComputeInstanceMetadata</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Depending the environment you are running in the backing implementation will be either <a href="../api/io/micronaut/discovery/cloud/gcp/GoogleComputeInstanceMetadata.html">GoogleComputeInstanceMetadata</a> or <a href="../api/io/micronaut/discovery/cloud/aws/AmazonEC2InstanceMetadata.html">AmazonEC2InstanceMetadata</a> with metadata found from Google or Amazon&#8217;s metadata services.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All of this data is merged together into the <code>metadata</code> property for the running <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>If you need to access the metadata for your application instance you can use the interface <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a>, and call <code>getMetadata()</code> which will get a map of all of the metadata.</p>
</div>
<div class="paragraph">
<p>If you are connecting remotely via client, the instance metadata can be referenced once you have retrieved a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> from either the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> or <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Netflix Ribbon client side load balancer can be configured to use the metadata to do zone aware client side load balancing. See <a href="#clientSideLoadBalancing">Client Side Load Balancing</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To obtain metadata for a service via <a href="#serviceDiscovery">Service Discovery</a> use the <a href="../api/io/micronaut/http/client/LoadBalancerResolver.html">LoadBalancerResolver</a> interface to resolve a <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> and obtain a reference to a service by identifier:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Service instance</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">LoadBalancer loadBalancer = loadBalancerResolver.resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">some-service</span><span class="delimiter">&quot;</span></span>);
Flowable.fromPublisher(
    loadBalancer.select()
).subscribe((instance) -&gt;
    ConvertibleValues&lt;<span class="predefined-type">String</span>&gt; metaData = instance.getMetadata();
    ...
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To obtain metadata for the locally running server use the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a> interface:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Local Server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EmbeddedServerInstance serverInstance = applicationContext.getBean(EmbeddedServerInstance.class);
ConvertibleValues&lt;<span class="predefined-type">String</span>&gt; metaData = serverInstance.getMetadata();</code></pre>
</div>
</div>
</div>
</div>


<h2 id="distributedConfiguration">8.1.1 Distributed Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/cloudConfiguration/distributedConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As you can see, Micronaut features a robust system for externalizing and adapting configuration to the environment inspired by similar approaches found in Grails and Spring Boot.</p>
</div>
<div class="paragraph">
<p>However, what if you want two Microservices to share configuration? Micronaut comes with built in APIs for doing distributed configuration.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> interface has a single method called <code>getPropertySources</code> that can be implemented to read and resolve configuration from distributed sources.</p>
</div>
<div class="paragraph">
<p>The <code>getPropertySources</code> returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits zero or many <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances.</p>
</div>
<div class="paragraph">
<p>The default implementation is <a href="../api/io/micronaut/discovery/config/DefaultCompositeConfigurationClient.html">DefaultCompositeConfigurationClient</a> which merges all registered <code>ConfigurationClient</code> beans into a single bean.</p>
</div>
<div class="paragraph">
<p>You can either implement your own <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> implementation or you can use one of the ones already built into Micronaut. The following sections cover those.</p>
</div>


<h2 id="distributedConfigurationConsul">8.1.2 Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native <a href="../api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install/index.html">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_distributed_configuration_with_consul">Enabling Distributed Configuration with Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable distributed configuration, similar to Spring Boot and Grails, you need to create a <code>src/main/resources/bootstrap.yml</code> configuration file and configure Consul as well as enable the configuration client:</p>
</div>
<div class="listingblock">
<div class="title">bootstrap.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
    <span class="key">config-client</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
<span class="key">consul</span>:
    <span class="key">client</span>:
        <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have enabled distributed configuration you need to store the configuration you wish the share in Consul&#8217;s Key/Value store.</p>
</div>
<div class="paragraph">
<p>There are a number of different ways to do that.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_key_value_pairs">Storing Configuration as Key/Value Pairs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One way is to store each key and value directly in Consul. In this case by default Micronaut will look for configuration in the <code>/config</code> folder of Consul.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can alter the path searched for by setting <code>consul.client.config.path</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Within the <code>/config</code> folder Micronaut will search values within the following folders in order of precedence:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application,prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for the <code>prod</code> <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration, example <code>/config/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME],prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application specific configuration for an active <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The value of <code>APPLICATION_NAME</code> is whatever your have configured <code>micronaut.application.name</code> to be in <code>bootstrap.yml</code>.</p>
</div>
<div class="paragraph">
<p>To see this in action use the following curl command to store a property called <code>foo.bar</code> with a value of <code>myvalue</code> in the folder <code>/config/application</code>.</p>
</div>
<div class="listingblock">
<div class="title">Using curl to Write a Value</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X PUT -d @- localhost:8500/v1/kv/config/application/foo.bar &lt;&lt;&lt; myvalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you know define a <code>@Value("${foo.bar}")</code> or call <code>environment.getProperty(..)</code> the value <code>myvalue</code> will be resolved from Consul.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_in_yaml_json_etc">Storing Configuration in YAML, JSON etc.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some Consul users prefer storing configuration in blobs of a certain format, such as YAML. Micronaut supports this mode and supports storing configuration in either YAML, JSON or Java properties format.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/discovery/config/ConfigDiscoveryConfiguration.html">ConfigDiscoveryConfiguration</a> has a number of configuration options for configuring how distributed configuration is discovered.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can set the <code>consul.client.config.format</code> option to configure the format with which properties are read.</p>
</div>
<div class="paragraph">
<p>For example, to configure JSON:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">consul</span>:
    <span class="key">client</span>:
        <span class="key">config</span>:
            <span class="key">format</span>: <span class="string"><span class="content">JSON</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now write your configuration in JSON format to Consul:</p>
</div>
<div class="listingblock">
<div class="title">Using curl write JSON</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X PUT  localhost:8500/v1/kv/config/application \
-d @- &lt;&lt; EOF
{ &quot;foo&quot;: {  &quot;bar&quot;: &quot;myvalue&quot; } }
EOF</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_file_references">Storing Configuration as File References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another option popular option is <a href="https://github.com/breser/git2consul">git2consul</a> which mirrors the contents of a Git repository to Consul&#8217;s Key/Value store.</p>
</div>
<div class="paragraph">
<p>You can setup a Git repository that contains files like <code>application.yml</code>, <code>hello-world-test.json</code> etc. and the contents of these files are cloned to Consul.</p>
</div>
<div class="paragraph">
<p>In this case each key in consul represents a file with an extension. For example <code>/config/application.yml</code> and you must configure the <code>FILES</code> format:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">consul</span>:
    <span class="key">client</span>:
        <span class="key">config</span>:
            <span class="key">format</span>: <span class="string"><span class="content">FILES</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="serviceDiscovery">8.2 Service Discovery</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Service Discovery enables the ability for Microservices to find each other without necessarily knowing the physical location or IP address of associated services.</p>
</div>
<div class="paragraph">
<p>There are many ways Service Discovery can be implemented, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You could manually implement Service Discovery using DNS without requiring a third party tool or component.</p>
</li>
<li>
<p>You could use a discovery server such as <a href="https://github.com/Netflix/eureka">Eureka</a>, <a href="https://www.consul.io">Consul</a> or <a href="https://zookeeper.apache.org">ZooKeeper</a>.</p>
</li>
<li>
<p>You could delegate the work to a container runtime, such as <a href="https://kubernetes.io">Kubernetes</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With that in mind Micronaut tries to flexible to support all of these approaches. As of this writing Micronaut features integrated support for the popular Service Discovery servers Eureka and Consul.</p>
</div>
<div class="paragraph">
<p>To include Service Discovery in your application simply the first step is to add the <code>discovery-client</code> dependency to your application, for example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:discovery-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>discovery-client</code> dependency provides implementations of the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> interface.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> is fairly simple and provides two main entry points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/discovery/DiscoveryClient.html#getServiceIds--">DiscoveryClient.getServiceIds()</a> - Returns all discovered service IDs</p>
</li>
<li>
<p><a href="../api/io/micronaut/discovery/DiscoveryClient.html#getInstances-java.lang.String-">DiscoveryClient.getInstances(java.lang.String)</a> - Returns all the <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> objects for a given service ID</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both methods return <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances since the operation to retrieve service ID information may result in a blocking network call depending on the underlying implementation.</p>
</div>
<div class="paragraph">
<p>The default implementation of the <code>DiscoveryClient</code> interface is <a href="../api/io/micronaut/discovery/client/CachingCompositeDiscoveryClient.html">CachingCompositeDiscoveryClient</a> which merges all other <code>DiscoveryClient</code> beans into a single bean and provides caching of the results of the methods. The default behaviour is to cache for 30 seconds. This cache can be disabled in application configuration:</p>
</div>
<div class="listingblock">
<div class="title">Disabling the Discovery Client Cache</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">discovery-client</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can alter the cache&#8217;s expiration policy:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Discovery Client Cache</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">caches</span>:
        <span class="key">discovery-client</span>:
            <span class="key">expireAfterAccess</span>: <span class="string"><span class="content">60s</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="../api/io/micronaut/discovery/client/DiscoveryClientCacheConfiguration.html">DiscoveryClientCacheConfiguration</a> class for available configuration options.</p>
</div>


<h2 id="serviceDiscoveryConsul">8.2.1 Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install/index.html">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_consul">Auto Registering with Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register a Micronaut application with Consul simply add the necessary <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Consul (application.yml)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the Micronaut CLI you can quickly create a new service setup with Consul using: <code>mn create-app my-app -features discovery-consul</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>consul.client.defaultZone</code> settings accepts a list of Consul servers to be used by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You could also simply set <code>consul.client.host</code> and <code>consul.client.port</code>, however <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> allows you specify per zone discovery services for the purpose load balancing. A zone maps onto a AWS availability zone or a Google Cloud zone.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default registering with Consul is disabled hence you should set <code>consul.client.registration.enabled</code> to <code>true</code>. Note that you may wish to do this only in your production configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_consul_service_registration">Customizing Consul Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a> class features a range of customization options for altering how an instance registers with Consul. You can customize the tags, the retry attempts, the fail fast behaviour and so on.</p>
</div>
<div class="paragraph">
<p>Notice too that <code>ConsulConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> allowing you to customize the settings for the Consul client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Consul Registration Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="comment"># Alters the tags</span>
      <span class="key">tags</span>:
        - <span class="string"><span class="content">hello</span></span>
        - <span class="string"><span class="content">world</span></span>
      <span class="comment"># Alters the retry count</span>
      <span class="key">retry-count</span>: <span class="string"><span class="content">5</span></span>
      <span class="comment"># Alters fail fast behaviour</span>
      <span class="key">fail-fast</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discovery_services_from_consul">Discovery Services from Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To discovery other services you could manually interact with the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a>, however typically instead you use the <a href="#clientAnnotation">Client Annotation</a> to declare how an HTTP client maps to a service.</p>
</div>
<div class="paragraph">
<p>For example the configuration in the previous section declared a value for <code>micronaut.application.name</code> of <code>hello-world</code>. This is the value that will be used as the service ID when registering with Consul.</p>
</div>
<div class="paragraph">
<p>Other services can discovery instances of the <code>hello-world</code> service simply by declaring a client as follows:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">HelloClient</span>{
        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can also use <a href="../api/io/micronaut/http/client/Client.html">@Client</a> as a qualifier to <code>@Inject</code> an instance of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Inject</span>
RxHttpClient httpClient;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consul_health_checks">Consul Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default when registering with Consul Micronaut will register a <a href="https://www.consul.io/docs/agent/checks.html">TTL check</a>. A TTL check basically means that if the application does not send a heartbeat back to Consul after a period of time the service is put in a failing state.</p>
</div>
<div class="paragraph">
<p>Micronaut applications feature a <a href="../api/io/micronaut/health/HeartbeatConfiguration.html">HeartbeatConfiguration</a> which starts a thread using <a href="../api/io/micronaut/health/HeartbeatTask.html">HeartbeatTask</a> that fires <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/consul/registration/ConsulAutoRegistration.html">ConsulAutoRegistration</a> class listens for these events and sends a callback to the <a href="https://www.consul.io/api/agent/check.html">/agent/check/pass/:check_id</a> endpoint provided by Consul, effectively keeping the service alive.</p>
</div>
<div class="paragraph">
<p>With this arrangement the responsibility is on the Micronaut application to send TTL callbacks to Consul on a regular basis.</p>
</div>
<div class="paragraph">
<p>If you prefer you can push the responsibility for health checks to Consul itself by registering an HTTP check:</p>
</div>
<div class="listingblock">
<div class="title">Consul HTTP Check Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">consul</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
       <span class="key">check</span>:
          <span class="key">http</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration option in place Consul will assume responsibility of invoking the Micronaut applications <a href="#healthEndpoint">Health Endpoint</a>.</p>
</div>
</div>
</div>


<h2 id="serviceDiscoveryEureka">8.2.2 Eureka Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryEureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/eureka">Netflix Eureka</a> is a popular discovery server deployed at scale at organizations like Netflix.</p>
</div>
<div class="paragraph">
<p>Micronaut features a native non-blocking <a href="../api/io/micronaut/discovery/eureka/client/v2/EurekaClient.html">EurekaClient</a> as part of the <code>discovery-client</code> module that does not require any additional third-party dependencies and is built using Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_eureka">Starting Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start a Eureka server is to use to use <a href="https://spring.io/guides/gs/service-registration-and-discovery/#initial">Spring Boot&#8217;s Eureka starters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of this writing the Docker images for Eureka are significantly out-of-date so it is recommended to create a Eureka server following the steps above.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_auto_registering_with_eureka">Auto Registering with Eureka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process to register a Micronaut application with Eureka is very similar to with Consul, as seen in the previous section, simply add the necessary <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. A minimal example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka (application.yml)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">application</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world</span></span>
<span class="key">eureka</span>:
  <span class="key">client</span>:
    <span class="key">registration</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_service_registration">Customizing Service Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize various aspects of registration with Eureka using the <a href="../api/io/micronaut/discovery/eureka/EurekaConfiguration.html">EurekaConfiguration</a>. Notice that <code>EurekaConfiguration</code> extends <a href="../api/io/micronaut/discovery/client/DiscoveryClientConfiguration.html">DiscoveryClientConfiguration</a>  which in turn extends <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> allowing you to customize the settings for the Eureka client, including read timeout, proxy configuration and so on.</p>
</div>
<div class="listingblock">
<div class="title">Example Eureka Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eureka</span>:
  <span class="key">client</span>:
     <span class="key">readTimeout</span>: <span class="string"><span class="content">5s</span></span>
     <span class="key">registration</span>:
         <span class="key">asgName</span>: <span class="string"><span class="content">myAsg</span></span> <span class="comment"># the auto scaling group name</span>
         <span class="key">countryId</span>: <span class="string"><span class="content">10</span></span> <span class="comment"># the country id</span>
         <span class="key">vipAddress</span>: <span class="string"><span class="content">'myapp'</span></span> <span class="comment"># The Eureka VIP address</span>
         <span class="key">leaseInfo</span>:
            <span class="key">durationInSecs</span>: <span class="string"><span class="content">60</span></span> <span class="comment"># The lease information</span>
         <span class="key">metadata</span>: <span class="comment"># arbitrary instance metadata</span>
            <span class="key">foo</span>: <span class="string"><span class="content">bar</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_basic_authentication">Eureka Basic Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize the Eureka credentials in the URI you specify to in <code>defaultZone</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Auto Registering with Eureka</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">eureka</span>:
  <span class="key">client</span>:
    <span class="key">defaultZone</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://${EUREKA_USERNAME}:${EUREKA_PASSWORD}@localhost:8761</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example externalizes configuration of the username and password Eureka to environment variables called <code>EUREKA_USERNAME</code> and <code>EUREKA_PASSWORD</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eureka_health_checks">Eureka Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like Consul, the <a href="../api/io/micronaut/discovery/eureka/registration/EurekaAutoRegistration.html">EurekaAutoRegistration</a> will send <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances with the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> of the Micronaut application to Eureka.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/health/monitor/HealthMonitorTask.html">HealthMonitorTask</a> will by default continuously monitor the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> of the application by running health checks and the <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> will be sent to Eureka.</p>
</div>
</div>
</div>


<h2 id="serviceDiscoveryKubernetes">8.2.3 Kubernetes Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryKubernetes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Kubernetes is a container runtime which has a whole bunch of features including integrated Service Discovery. The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#environment-variables">strategy for Service Discovery in Kubernetes</a> is pretty simple in that for each Pod, Kubernetes will expose environment variables in the format <code>[SERVICE_NAME]_SERVICE_HOST</code> and <code>[SERVICE_NAME]_SERVICE_PORT</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut features a <a href="../api/io/micronaut/discovery/kubernetes/KubernetesDiscoveryClient.html">KubernetesDiscoveryClient</a> that simply looks at the environment variables and translates those into the available services.</p>
</div>
<div class="paragraph">
<p>For example given a service exposed as <code>HELLO_WORLD_SERVICE_HOST</code> to your application, you can declare clients that will be automatically discovered using:</p>
</div>
<div class="listingblock">
<div class="title">Using @Client to Discover Services</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Client</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">HelloClient</span>{
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Kubernetes itself assumes responsibility for tasks such as health checks, load balancing and so on there is no need to send <a href="../api/io/micronaut/health/HeartbeatEvent.html">HeartbeatEvent</a> instances and so on.</p>
</div>


<h2 id="clientSideLoadBalancing">8.3 Client Side Load Balancing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/clientSideLoadBalancing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When <a href="#serviceDiscovery">discovering services</a> from Consul, Eureka or other Service Discovery servers the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> will emits a list of available <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut by default will automatically perform Round Robin client-side load balancing using the servers in this list. This combined with <a href="#retry">Retry Advice</a> adds extra resiliency to your Microservice infrastructure.</p>
</div>
<div class="paragraph">
<p>The load balancing itself is handled by the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface which defines a  <a href="../api/io/micronaut/http/client/LoadBalancer.html#select--">LoadBalancer.select()</a> method that returns a <code>Publisher</code> that emits a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> is returned because the process for selecting a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> may result in a network operation depending on the <a href="#serviceDiscovery">Service Discovery</a> strategy employed.</p>
</div>
<div class="paragraph">
<p>The default implementation of the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface is <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientRoundRobinLoadBalancer.html">DiscoveryClientRoundRobinLoadBalancer</a>. You can replace this strategy for another implementation if you wish to customize how client side load balancing is handled in Micronaut since there are many different ways you may wish to optimize load balancing.</p>
</div>
<div class="paragraph">
<p>For example, you may wish to load balance between services in a particular zone or you may wish to load balance between servers that have the best overall response time.</p>
</div>
<div class="paragraph">
<p>To replace the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> used you should define a bean that <a href="#replaces">replaces</a> the <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientLoadBalancerFactory.html">DiscoveryClientLoadBalancerFactory</a>.</p>
</div>
<div class="paragraph">
<p>In fact that is exactly what the Netflix Ribbon support does, described in the next section.</p>
</div>


<h2 id="netflixRibbon">8.3.1 Netflix Ribbon Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/clientSideLoadBalancing/netflixRibbon.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/Netflix/ribbon">Netflix Ribbon</a> is a inter process communication library used at Netflix that has support for customizable load balancing strategies.</p>
</div>
<div class="paragraph">
<p>If you need more flexibility in how your application performs client-side load balancing then you may wish use Micronaut&#8217;s Netflix Ribbon support.</p>
</div>
<div class="paragraph">
<p>To add Ribbon support to your application add the <code>netflix-ribbon</code> configuration to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:netflix-ribbon</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> implementations will now be <a href="../api/io/micronaut/configurations/ribbon/RibbonLoadBalancer.html">RibbonLoadBalancer</a> instances.</p>
</div>
<div class="paragraph">
<p>Ribbon&#8217;s <a href="http://netflix.github.io/ribbon/ribbon-core-javadoc/com/netflix/client/config/CommonClientConfigKey.html">Configuration options</a> can be set using the <code>ribbon</code> namespace in configuration. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Ribbon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">ribbon</span>:
    <span class="key">VipAddress</span>: <span class="string"><span class="content">test</span></span>
    <span class="key">ServerListRefreshInterval</span>: <span class="string"><span class="content">2000</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each discovered client can also be configured under <code>ribbon.clients</code>. For example given a <code>@Client(id = "hello-world")</code> you can configure Ribbon settings with:</p>
</div>
<div class="listingblock">
<div class="title">Per Client Ribbon Settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">ribbon</span>:
    <span class="key">clients</span>:
        <span class="key">hello-world</span>:
            <span class="key">VipAddress</span>: <span class="string"><span class="content">test</span></span>
            <span class="key">ServerListRefreshInterval</span>: <span class="string"><span class="content">2000</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut registers a <a href="../api/io/micronaut/configurations/ribbon/DiscoveryClientServerList.html">DiscoveryClientServerList</a> for each client that integrates Ribbon with Micronaut&#8217;s <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a>.</p>
</div>


<h2 id="distributedTracing">8.4 Distributed Tracing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/distributedTracing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When operating Microservices in production it can be challenging to troubleshoot interactions between Microservices in a distributed architecture.</p>
</div>
<div class="paragraph">
<p>To solve this problem a way to visualize interactions between Microservices in a distributed manner can be critical. Currently, there are various distributed tracing solutions, the most popular of which are <a href="https://zipkin.io">Zipkin</a> and <a href="https://www.jaegertracing.io/">Jaeger</a> both of which provide different levels of support for the <a href="http://opentracing.io">Open Tracing</a> API.</p>
</div>
<div class="paragraph">
<p>Micronaut features integration with both Zipkin and Jaeger (via the Open Tracing API).</p>
</div>
<div class="paragraph">
<p>To enable tracing you should add the <code>tracing</code> module to your <code>build.gradle</code> or <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:tracing</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_annotations">Tracing Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/tracing/annotation/package-summary.html">io.micronaut.tracing.annotation</a> package contains annotations that can be declared on methods to create new spans or continue existing spans.</p>
</div>
<div class="paragraph">
<p>The available annotations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/NewSpan.html">@NewSpan</a> annotation will create a new span, wrapping the method call or reactive type.</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/ContinueSpan.html">@ContinueSpan</a> annotation will continue an existing span, wrapping the method call or reactive type.</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/tracing/annotation/SpanTag.html">@SpanTag</a> annotation can be used on method arguments to include the value of each argument within a Span&#8217;s tags</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following snippet presents an example of using the annotations:</p>
</div>
<div class="listingblock">
<div class="title">Using Trace Annotations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">HelloService</span> {

    <span class="annotation">@NewSpan</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@SpanTag</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">person.name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> greet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name);
    }

    <span class="annotation">@ContinueSpan</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> greet(<span class="annotation">@SpanTag</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello.greeting</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> greet) {
        <span class="keyword">return</span> greeting;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/tracing/annotation/NewSpan.html">@NewSpan</a> annotation is used to start a new span</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <a href="../api/io/micronaut/tracing/annotation/SpanTag.html">@SpanTag</a> to include arguments of methods as tags for the span</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/tracing/annotation/ContinueSpan.html">@ContinueSpan</a> annotation can be used to continue as existing span and incorporate additional tags using <code>@SpanTag</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_tracing_instrumentation">Tracing Instrumentation</h3>
<div class="paragraph">
<p>In addition to explicit tracing tags, Micronaut includes a number of instrumentations to ensure that the Span context is propagated between threads and across Microservice boundaries.</p>
</div>
<div class="paragraph">
<p>These instrumentations are found in the <a href="../api/io/micronaut/tracing/instrument/package-summary.html">io.micronaut.tracing.instrument</a> package and include HTTP <a href="#clientFilter">Client Filters</a> and <a href="#filters">Server Filters</a> to propagate the necessary headers via HTTP.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_beans">Tracing Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the Tracing annotations and existing instrumentations are not enough, Micronaut&#8217;s tracing integration registers a <code>io.opentracing.Tracer</code> bean that can be injected into any class and exposes the Open Tracing API.</p>
</div>
<div class="paragraph">
<p>Depending on the implementation you choose there are also additional beans. For example for Zipkin <code>brave.Tracing</code> and <code>brave.SpanCustomizer</code> beans are available too.</p>
</div>
</div>
</div>


<h2 id="zipkin">8.4.1 Tracing with Zipkin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/distributedTracing/zipkin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://zipkin.io">Zipkin</a> is a distributed tracing system. It helps gather timing data needed to troubleshoot latency problems in microservice architectures. It manages both the collection and lookup of this data.</p>
</div>
<div class="sect1">
<h2 id="_running_zipkin">Running Zipkin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to get up and started with Zipkin is with Docker:</p>
</div>
<div class="listingblock">
<div class="title">Running Zipkin with Docker</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run -d -p 9411:9411 openzipkin/zipkin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then open a browser tab to the location <code><a href="http://localhost:9411" class="bare">http://localhost:9411</a></code> to view traces.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_traces_to_zipkin">Sending Traces to Zipkin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To send tracing spans to Zipkin the minimal configuration requires you add the following dependencies to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Adding Zipkin Dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">runtime <span class="string"><span class="delimiter">'</span><span class="content">io.zipkin.brave:brave-instrumentation-http:4.19.0</span><span class="delimiter">'</span></span>
runtime <span class="string"><span class="delimiter">'</span><span class="content">io.zipkin.reporter2:zipkin-reporter:2.5.0</span><span class="delimiter">'</span></span>
compile <span class="string"><span class="delimiter">'</span><span class="content">io.opentracing.brave:brave-opentracing:0.30.0</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to enable ZipKin tracing in your configuration (potentially only your production configuration):</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">zipkin</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Or alternatively if you have the Micronaut CLI installed you can configure Zipkin when creating your service with: <code>mn create-app hello-world -features tracing-zipkin</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_zipkin_sender">Customizing the Zipkin Sender</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default an <a href="../api/io/micronaut/tracing/brave/sender/HttpClientSender.html">HttpClientSender</a> that sends Spans asynchronously using Micronaut&#8217;s native HTTP client to <code><a href="http://localhost:9411/api/v2/spans" class="bare">http://localhost:9411/api/v2/spans</a></code> will be configured.</p>
</div>
<div class="paragraph">
<p>It is unlikely that sending spans to localhost will be suitable for production deployment so you generally will want to configure the location of one or many Zipkin servers for production:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Multiple Zipkin Servers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">zipkin</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">urls</span>:
            - <span class="string"><span class="content">http://foo:9411</span></span>
            - <span class="string"><span class="content">http://bar:9411</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In production, setting <code>TRACING_ZIPKIN_URLS</code> environment variable with a comma separated list of URLs will also work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively if you wish to use a different <code>zipkin2.reporter.Sender</code> implementation, you can simply define a bean that is of type <code>zipkin2.reporter.Sender</code> and it will be picked up.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zipkin_configuration">Zipkin Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many configuration options available for the Brave client that sends Spans to Zipkin and they are generally exposed via the <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> class. You can refer to the javadoc for all the available options.</p>
</div>
<div class="paragraph">
<p>Below is an example of customizing Zipkin configuration:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Zipkin Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">zipkin</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">traceId128Bit</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">sampler</span>:
            <span class="key">probability</span>: <span class="string"><span class="content">1</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also optionally dependency inject common configuration classes into <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> such as <code>brave.sampler.Sampler</code> just by defining them as beans. See the API for <a href="../api/io/micronaut/tracing/brave/BraveTracerConfiguration.html">BraveTracerConfiguration</a> for available injection points.</p>
</div>
</div>
</div>


<h2 id="jaeger">8.4.2 Tracing with Jaeger</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cloud/distributedTracing/jaeger.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.jaegertracing.io">Jaeger</a> is another distributed tracing system developed at Uber that is more or less the reference implementation for <a href="http://opentracing.io">Open Tracing</a>.</p>
</div>
<div class="sect1">
<h2 id="_running_jaeger">Running Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to get started with Jaeger is to run Jaeger via Docker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ docker run -d -e \
  COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then navigate to <code><a href="http://localhost:16686" class="bare">http://localhost:16686</a></code> to access the Jaeger UI.</p>
</div>
<div class="paragraph">
<p>See <a href="https://www.jaegertracing.io/docs/getting-started/">Getting Started with Jaeger</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_traces_to_jaeger">Sending Traces to Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To send tracing spans to Jaeger the minimal configuration requires you add the following dependencies to <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Adding Jaeger Dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">io.jaegertracing:jaeger-core:0.27.0</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to enable Jaeger tracing in your configuration (potentially only your production configuration):</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">jaeger</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Jaeger will be configured to send traces to a locally running Jaeger agent.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Or alternatively if you have the Micronaut CLI installed you can configure Zipkin when creating your service with: <code>mn create-app hello-world -features tracing-jaeger</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jaeger_configuration">Jaeger Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many configuration options available for the Jaeger client that sends Spans to Jaeger and they are generally exposed via the <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> class. You can refer to the javadoc for all the available options.</p>
</div>
<div class="paragraph">
<p>Below is an example of customizing JaegerConfiguration configuration:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Zipkin Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tracing</span>:
    <span class="key">jaeger</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">sampler</span>:
            <span class="key">probability</span>: <span class="string"><span class="content">0.5</span></span>
        <span class="key">sender</span>:
            <span class="key">agentHost</span>: <span class="string"><span class="content">foo</span></span>
            <span class="key">agentPort</span>: <span class="string"><span class="content">5775</span></span>
        <span class="key">reporter</span>:
            <span class="key">flushInterval</span>: <span class="string"><span class="content">2000</span></span>
            <span class="key">maxQueueSize</span>: <span class="string"><span class="content">200</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also optionally dependency inject common configuration classes into <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> such as <code>io.jaegertracing.Configuration.SamplerConfiguration</code> just by defining them as beans. See the API for <a href="../api/io/micronaut/tracing/jaeger/JaegerConfiguration.html">JaegerConfiguration</a> for available injection points.</p>
</div>
</div>
</div>


<h1 id="serverlessFunctions">9 Serverless Functions</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Server-less architectures where as a developer you deploy functions that are fully managed by the Cloud environment and are executed in ephemeral processes require a unique approach.</p>
</div>
<div class="paragraph">
<p>Traditional frameworks like Grails and Spring are not really suitable since low memory consumption and fast startup time are critical, since the Function as a Service (FaaS) server will typically spin up your function for a period using a cold start and then keep it warm.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s compile-time approach, fast startup time and low-memory footprint make it a great candidate for using as a framework for developing functions and in fact Micronaut features dedicated support for developing and deploying functions to AWS Lambda (support for other FaaS platforms is planned in the future).</p>
</div>


<h2 id="writingFunctions">9.1 Writing Functions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/writingFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started writing serverless function you must add the appropriate Micronaut <code>function</code> dependency to your classpath. For example, to create functions for AWS Lambda, add the <code>function-aws</code> dependency.  The supported providers are listed in the table below.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Function Providers</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Provider</th>
<th class="tableblock halign-left valign-top">Dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS Lambda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:function-aws</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using Groovy, there is a single compile-time dependency to be added: <code>"io.micronaut:function-groovy"</code> Please see <a href="#groovyFunctions">Groovy Functions</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Add the appropriate dependency to your project, For example, in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:function-aws</span><span class="delimiter">&quot;</span></span>
    ...
}</code></pre>
</div>
</div>


<h2 id="functionApplication">9.1.1 FunctionApplication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/writingFunctions/functionApplication.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section applies to Java &amp; Kotlin functions - for functions written in Groovy, see <a href="#groovyFunctions">Groovy Functions</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to enable Micronaut&#8217;s DI features in a deployed function, your project&#8217;s <strong>main</strong> class must be set to the <a href="../api/io/micronaut/function/executor/FunctionApplication.html">FunctionApplication</a> class. Typically this will be done in your <code>build.gradle</code> or <code>pom.xml</code> files, as seen in the examples below:</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">mainClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.function.executor.FunctionApplication</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;exec.mainClass&gt;</span>io.micronaut.function.executor.FunctionApplication<span class="tag">&lt;/exec.mainClass&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>


<h2 id="functionBean">9.1.2 FunctionBean</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/writingFunctions/functionBean.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section applies to Java &amp; Kotlin functions - for functions written in Groovy, see <a href="#groovyFunctions">Groovy Functions</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To write your function&#8217;s behavior, annotate your class with the <a href="../api/io/micronaut/function/FunctionBean.html">@FunctionBean</a> annotation. Your class must also implement one of the interfaces from the <code>java.util.function</code> package.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you have the Micronaut CLI installed you can quickly create a Java function with <code>mn create-function hello-world</code> or <code>mn create-function hello-world -lang kotlin</code> for Kotlin
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following examples implement Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html">Supplier</a> functional interface.</p>
</div>
<div class="listingblock">
<div class="title">Example Java Function</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.function.FunctionBean</span>;
<span class="keyword">import</span> <span class="include">java.util.function.Supplier</span>;

<span class="annotation">@FunctionBean</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-java</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloJavaFunction</span> <span class="directive">implements</span> Supplier&lt;<span class="predefined-type">String</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> get() { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world!</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override the <code>get</code> method of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html">Supplier</a> to return the response from your function.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Kotlin Function</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example

import io.micronaut.function.FunctionBean
import java.util.function.Supplier

@FunctionBean(&quot;hello-world-kotlin&quot;)
class HelloKotlinFunction : Supplier&lt;String&gt; {

    override fun get(): String { <i class="conum" data-value="1"></i><b>(1)</b>
        return &quot;Hello world!&quot;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override the <code>get</code> method of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html">Supplier</a> to return the response from your function.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table summarizes the supported interfaces:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Functional Interfaces</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html">Supplier</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accepts no arguments and returns a single result</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Consumer.html">Consumer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accepts a single argument and returns no result</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/BiConsumer.html">BiConsumer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accepts two arguments and returns no result</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Function.html">Function</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accepts a single argument and returns a single result</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/BiFunction.html">BiFunction</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accepts two arguments and returns a single result</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, functions have an input and/or an output. The input is represented by the accepted argument and represents the body consumed by the function and the output is represented by the return value of the function. The input and the output should be either a Java primitive or simple type (<code>int</code>, <code>String</code> etc.) or a POJO.</p>
</div>
<div class="paragraph">
<p>A single project can define multiple functions, however only a single function should be configured for execution by the application. This can be configured using the <code>micronaut.function.name</code> property in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Function Name to Execute</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">function</span>:
        <span class="key">name</span>: <span class="string"><span class="content">hello-world-java</span></span></code></pre>
</div>
</div>


<h2 id="groovyFunctions">9.1.3 Groovy Functions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/writingFunctions/groovyFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As is typical in Groovy, writing functions is much simpler than in Java or Kotlin.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you have the Micronaut CLI installed you can quickly create a Groovy function with <code>mn create-function hello-world -lang groovy</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To begin, add the <code>function-groovy</code> dependency (instead of the provider-specific dependency) which provides additional AST transformations that make writing functions simpler. For example, in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:function-groovy</span><span class="delimiter">&quot;</span></span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now create your function as a Groovy script, under <code>src/main/groovy</code>. You will set your project&#8217;s <strong>main</strong> class property to this function (instead of <code>FunctionApplication</code> as in Java/Kotlin). For example:</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">mainClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">example.HelloGroovyFunction</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">HelloGroovyFunction.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> hello(<span class="predefined-type">String</span> name) {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">${</span>name<span class="inline-delimiter">}</span></span><span class="content">!</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function you define should follow the following rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define no more than 2 inputs</p>
</li>
<li>
<p>Use either Java primitive or simple types or POJOs as the arguments and return values</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In order to make use of dependency injection in your Groovy function, use the <code>groovy.transform.Field</code> annotation transform in addition to the <code>@Inject</code> annotation.</p>
</div>
<div class="listingblock">
<div class="title">HelloGroovyFunction.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.transform.Field</span>
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>

<span class="annotation">@Field</span> <span class="annotation">@Inject</span> HelloService helloService

<span class="predefined-type">String</span> hello(<span class="predefined-type">String</span> name) {
    helloService.hello(name)
}</code></pre>
</div>
</div>


<h2 id="runningFunctions">9.2 Running Functions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/runningFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Typically function applications will be run in a cloud-based environment, such as AWS Lambda. However during development and testing it is often desirable to run your functions locally, either as standalone web applications or as executables from the command line. Micronaut provides support for both of these approaches.</p>
</div>


<h2 id="functionWeb">9.2.1 Functions as Web Applications</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/runningFunctions/functionWeb.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run your function as a web application as described in this section, you will need the <code>function-web</code> dependency on your classpath. For example, in <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    runtime <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:function-web</span><span class="delimiter">&quot;</span></span>
    runtime <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:http-server-netty</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In order to run the function as a web application, you will need an HTTP server, such as the <code>http-server-netty</code> dependency</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the dependencies have been added to the project, you can run the function via an <code>Application</code> class.</p>
</div>
<div class="listingblock">
<div class="title">Example Application class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.micronaut.runtime.Micronaut</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Application</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now make requests against the function with a REST client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl -X GET http://localhost:8080/hello</pre>
</div>
</div>
<div class="paragraph">
<p>The URI mapped to is defined by the either the value of the <a href="../api/io/micronaut/function/FunctionBean.html">@FunctionBean</a> annotation for Java or, in the case of Groovy, the name of the function defined in the function script. The following tables summarizes the convention:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Function URI Mapping with @FunctionBean</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@FunctionBean("hello")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/hello</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@FunctionBean("helloWorld")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@FunctionBean("hello-world")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/hello-world</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Function URI Mapping with Groovy Function Script</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method Name</th>
<th class="tableblock halign-left valign-top">Dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hello</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/hello</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>helloWorld</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/hello-world</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Functions that only return a value are mapped to HTTP <code>GET</code> requests, whilst functions that accept an input require an HTTP <code>POST</code>.</p>
</div>
<div class="paragraph">
<p>In addition, the function will be registered by the configured <a href="#serviceDiscovery">Service Discovery</a> provider, and be made accessible to clients via the <a href="../api/io/micronaut/function/client/FunctionClient.html">@FunctionClient</a> annotation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For further information on the use of <code>@FunctionClient</code>, please see <a href="#callingFunctions">Calling Functions</a>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_testing_functions">Testing Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Functions can also be run as part of the Micronaut application context for ease of testing. Similarly to the example above, this approach requires the <code>function-web</code> and an HTTP server dependency on the classpath for tests. For example, in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:function-web</span><span class="delimiter">&quot;</span></span>
    testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:http-server-netty</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In order to run the function as a web application, you will need an HTTP server, such as the <code>http-server-netty</code> dependency</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a <a href="../api/io/micronaut/function/client/FunctionClient.html">@FunctionClient</a> interface as shown below:</p>
</div>
<div class="listingblock">
<div class="title">MathClient.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.function.client.FunctionClient</span>
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>

<span class="annotation">@FunctionClient</span>
<span class="directive">static</span> <span class="type">interface</span> MathClient {

    <span class="predefined-type">Long</span> max() <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">round</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> rnd(<span class="type">float</span> value)
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For further information on the use of <code>@FunctionClient</code>, please see <a href="#callingFunctions">Calling Functions</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can start up the Micronaut application and access your function via the client interface in your test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test invoking a local function</span><span class="delimiter">&quot;</span></span>() {
    given:
    EmbeddedServer server = ApplicationContext.run(EmbeddedServer)
    MathClient mathClient = server.getApplicationContext().getBean(MathClient)

    expect:
    mathClient.max() == <span class="predefined-type">Integer</span>.MAX_VALUE.toLong()
    mathClient.rnd(<span class="float">1.6</span>) == <span class="integer">2</span>
    mathClient.sum(<span class="keyword">new</span> Sum(a:<span class="integer">5</span>,b:<span class="integer">10</span>)) == <span class="integer">15</span>

}</code></pre>
</div>
</div>
</div>
</div>


<h2 id="functionCLI">9.2.2 Functions as CLI Applications</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/runningFunctions/functionCLI.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To execute your function as a CLI application with <code>java -jar</code>, you will need to package your application as an executable JAR file. For example, in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://plugins.gradle.org/m2/</span><span class="delimiter">&quot;</span></span> } <i class="conum" data-value="1"></i><b>(1)</b>
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.jengelman.gradle.plugins:shadow:2.0.4</span><span class="delimiter">&quot;</span></span>
...
    }
}

apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.johnrengelman.shadow</span><span class="delimiter">&quot;</span></span>

shadowJar {
    mergeServiceFiles()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Gradle Shadow plugin is hosted in the <code><a href="http://plugins.gradle.org" class="bare">http://plugins.gradle.org</a></code> repository</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now package your application using the <code>shadowJar</code> task.</p>
</div>
<div class="listingblock">
<div class="title">Packaging a Function as a JAR</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew shadowJar</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, you can execute your function using the <code>java -jar</code> command. To supply input data to the function, use the <code>-d</code> flag (POJO objects can be supplied in JSON format).</p>
</div>
<div class="listingblock">
<div class="title">Executing a function via the CLI</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ java -jar build/libs/math-function-0.1-all.jar -d '{value: 3}'</code></pre>
</div>
</div>


<h2 id="lambdaFunctions">9.3 Deploying Functions to AWS Lambda</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/lambdaFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For Java &amp; Kotlin functions, support for <a href="http://aws.amazon.com">AWS Lambda</a> can be enabled by adding the <code>function-aws</code> dependency to your classpath. For example, in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:function-aws</span><span class="delimiter">&quot;</span></span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Groovy functions, the <code>function-groovy</code> dependency is sufficient for AWS Lambda support.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    ...
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:function-groovy</span><span class="delimiter">&quot;</span></span>
    ...
}</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configuration properties specific to AWS Lambda environments can be supplied in an <code>application-aws</code> configuration file in <code>src/main/resources</code>.</p>
</div>
<div class="listingblock">
<div class="title">application-aws.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">production</span>:
    <span class="key">property</span>: <span class="string"><span class="content">44</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_manual_deployment">Manual Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can deploy your function to AWS Lambda manually by building and uploading an executable JAR file. Various build plugins offer this capability.</p>
</div>
<div class="sect2">
<h3 id="_gradle_shadow_plugin">Gradle Shadow plugin</h3>
<div class="paragraph">
<p>The <a href="https://plugins.gradle.org/plugin/com.github.johnrengelman.shadow">Gradle Shadow</a> plugin provides a <code>shadowJar</code> task to generate a self-contained executable JAR file, which is suitable for AWS Lambda deployments.</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://plugins.gradle.org/m2/</span><span class="delimiter">&quot;</span></span> } <i class="conum" data-value="1"></i><b>(1)</b>
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.jengelman.gradle.plugins:shadow:2.0.4</span><span class="delimiter">&quot;</span></span>
...
    }
}

apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.johnrengelman.shadow</span><span class="delimiter">&quot;</span></span>

shadowJar {
    mergeServiceFiles()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Gradle Shadow plugin is hosted in the <code><a href="http://plugins.gradle.org" class="bare">http://plugins.gradle.org</a></code> repository</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The executable JAR file can now be built using the <code>shadowJar</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew shadowJar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven_shade_plugin">Maven Shade plugin</h3>
<div class="paragraph">
<p>The <a href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven Shade</a> plugin will generate an executable JAR file for Maven projects. For further details, consult the <a href="https://docs.aws.amazon.com/lambda/latest/dg/java-create-jar-pkg-maven-no-ide.html">AWS Lambda Documentation.</a></p>
</div>
<div class="listingblock">
<div class="title">Example pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>

    <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;plugins&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>maven-shade-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>3.1.0<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;phase&gt;</span>package<span class="tag">&lt;/phase&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>shade<span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                        <span class="tag">&lt;configuration&gt;</span>
                            <span class="tag">&lt;transformers&gt;</span>
                                <span class="tag">&lt;transformer</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.maven.plugins.shade.resource.ManifestResourceTransformer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                    <span class="tag">&lt;mainClass&gt;</span>${exec.mainClass}<span class="tag">&lt;/mainClass&gt;</span>
                                <span class="tag">&lt;/transformer&gt;</span>
                                <span class="tag">&lt;transformer</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.maven.plugins.shade.resource.ServicesResourceTransformer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                            <span class="tag">&lt;/transformers&gt;</span>
                        <span class="tag">&lt;/configuration&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
        <span class="tag">&lt;/plugins&gt;</span>
    <span class="tag">&lt;/build&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The executable JAR file can now be built using the <code>package</code> phase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./mvnw package</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_aws_plugin">Gradle AWS Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Gradle projects, deployment can be made even more straightforward using the <a href="https://github.com/classmethod/gradle-aws-plugin">Gradle AWS Plugin</a>. This plugin provides a <code>deploy</code> task which can push your function to AWS Lambda directly, as well as a <code>AWSLambdaInvokeTask</code> which can be used to invoke your function when it is deployed.</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.amazonaws.services.lambda.model.InvocationType</span>
<span class="keyword">import</span> <span class="include">jp.classmethod.aws.gradle.lambda.AWSLambdaInvokeTask</span>
<span class="keyword">import</span> <span class="include">jp.classmethod.aws.gradle.lambda.AWSLambdaMigrateFunctionTask</span>
<span class="keyword">import</span> <span class="include">com.amazonaws.services.lambda.model.Runtime</span>

buildscript {
    repositories {
        ...
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://plugins.gradle.org/m2/</span><span class="delimiter">&quot;</span></span> } <i class="conum" data-value="1"></i><b>(1)</b>
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">jp.classmethod.aws:gradle-aws-plugin:0.22</span><span class="delimiter">&quot;</span></span>
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">jp.classmethod.aws.lambda</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>

...
task deploy(<span class="key">type</span>: AWSLambdaMigrateFunctionTask, <span class="key">dependsOn</span>: shadowJar) {
    functionName = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>
    handler = <span class="string"><span class="delimiter">&quot;</span><span class="content">example.HelloWorldFunction::hello</span><span class="delimiter">&quot;</span></span>
    role = <span class="string"><span class="delimiter">&quot;</span><span class="content">arn:aws:iam::</span><span class="inline"><span class="inline-delimiter">${</span>aws.accountId<span class="inline-delimiter">}</span></span><span class="content">:role/lambda_basic_execution</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
    runtime = <span class="predefined-type">Runtime</span>.Java8
    zipFile = shadowJar.archivePath
    memorySize = <span class="integer">256</span>
    timeout = <span class="integer">60</span>
}

task invoke(<span class="key">type</span>: AWSLambdaInvokeTask) {
    functionName = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>
    invocationType = InvocationType.RequestResponse
    payload = <span class="string"><span class="delimiter">'</span><span class="content">{&quot;name&quot;:&quot;Fred&quot;}</span><span class="delimiter">'</span></span>
    doLast {
        println <span class="string"><span class="delimiter">&quot;</span><span class="content">Lambda function result: </span><span class="delimiter">&quot;</span></span> + <span class="keyword">new</span> <span class="predefined-type">String</span>(invokeResult.payload.array(), <span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The AWS Gradle plugin is hosted from the <code><a href="https://plugins.gradle.org" class="bare">https://plugins.gradle.org</a></code> repository</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Apply the Gradle AWS plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Gradle AWS plugin will resolve your AWS credentials from <code>.aws/credentials</code> file, which is the default location used by the <a href="https://aws.amazon.com/cli/">AWS CLI</a> to set up your environment</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the value of the <code>handler</code> property of the <code>deploy</code> task should be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In this case of Java or Kotlin: <code>io.micronaut.function.aws.MicronautRequestStreamHandler</code></p>
</li>
<li>
<p>In the case of Groovy function definitions: A reference to the function (in the above case <code>example.HelloWorldFunction::hello</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reason for this is the <code>function-groovy</code> dependency applies additional code transformations to make it possible to reference the function directly.</p>
</div>
<div class="paragraph">
<p>With the above build configuration, the function can be deployed to AWS Lambda using the <code>deploy</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The deployed function can then be invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew invoke
Hello, Fred</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the <a href="https://github.com/classmethod/gradle-aws-plugin">Gradle AWS plugin documentation</a> for more details on the use of the plugin.</p>
</div>
</div>
</div>


<h2 id="callingFunctions">9.4 Calling Functions with FunctionClient</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/serverlessFunctions/callingFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut provides support for invoking functions (either locally or deployed to a cloud provider) directly within the application context. To use the features described in this section, you will need to have the <code>function-client</code> dependency on your classpath. For example, in <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:function-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The developer&#8217;s primary use of this feature will be in defining interfaces that are annotated with <a href="../api/io/micronaut/function/client/FunctionClient.html">FunctionClient</a>. When this annotation is applied, methods on the interface will become invokers of respective methods on the remote (or local) function associated with the interface.</p>
</div>
<div class="paragraph">
<p>In addition, the <code>function-client</code> works together with Micronaut&#8217;s <a href="#serviceDiscovery">Service Discovery</a> functionality, identifying any functions that are registered with the current service discovery provider and making them available to the client application.</p>
</div>
<div class="sect1">
<h2 id="_functionclient">FunctionClient</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/function/client/FunctionClient.html">@FunctionClient</a> annotation makes it very straightforward to invoke local or remotely deployed functions. For example, the following Groovy function can be accessed using the <code>MathClient</code> interface listed below it.</p>
</div>
<div class="listingblock">
<div class="title">MaxFunction.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.transform.Field</span>

math.multiplier = <span class="integer">2</span>
<span class="annotation">@Field</span> MathService mathService

<span class="predefined-type">Long</span> max() {
    mathService.max()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using @FunctionClient to Discover Function</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.function.client.FunctionClient</span>
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>

<span class="annotation">@FunctionClient</span>
<span class="directive">static</span> <span class="type">interface</span> MathClient {

    <span class="predefined-type">Long</span> max() <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method names in the interface will be mapped to methods on the target function, in this case <code>Long max()</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you would like the names of the client interface and target function to be different, you can use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotation to specify the target method name.</p>
</div>
<div class="listingblock">
<div class="title">RoundFunction.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.transform.Field</span>

math.multiplier = <span class="integer">2</span>
<span class="annotation">@Field</span> MathService mathService

<span class="type">int</span> round(<span class="type">float</span> value) {
    mathService.round(value)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using @Named to customize target method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.function.client.FunctionClient</span>
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>

<span class="annotation">@FunctionClient</span>
<span class="directive">static</span> <span class="type">interface</span> MathClient {

    <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">round</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> rnd(<span class="type">float</span> value)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactive_functionclients">Reactive FunctionClients</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>@FunctionClient</code> interfaces support RxJava constructs, so the above interfaces could be implemented as shown below:</p>
</div>
<div class="listingblock">
<div class="title">RxMathClient.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.function.client.FunctionClient</span>
<span class="keyword">import</span> <span class="include">javax.inject.Named</span>
<span class="keyword">import</span> <span class="include">io.reactivex.Single</span>

<span class="annotation">@FunctionClient</span>
<span class="directive">static</span> <span class="type">interface</span> RxMathClient {
    Single&lt;<span class="predefined-type">Long</span>&gt; max()

    <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">round</span><span class="delimiter">&quot;</span></span>)
    Single&lt;<span class="predefined-type">Integer</span>&gt; rnd(<span class="type">float</span> value)

    Single&lt;<span class="predefined-type">Long</span>&gt; sum(Sum sum)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remote_functions">Remote Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once functions have been deployed to a cloud provider, you can specify endpoints in your client configuration. Micronaut will then create <code>FunctionDefinitions</code> for these remote functions, allowing you to access them through <code>FunctionClient</code> interfaces just as you would with local functions.</p>
</div>
<div class="sect2">
<h3 id="_aws_lambda">AWS Lambda</h3>
<div class="paragraph">
<p>The configuration key path <code>aws.lambda.functions</code> can be used to specify function endpoints in an AWS Lambda environment.</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">aws</span>:
    <span class="key">lambda</span>:
        <span class="key">functions</span>:
            <span class="key">hello</span>:
                <span class="key">functionName</span>: <span class="string"><span class="content">hello-world</span></span>
                <span class="key">qualifer</span>: <span class="string"><span class="content">foo</span></span>
    <span class="key">region</span>: <span class="string"><span class="content">us-east-1</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case a function named <code>hello</code> is mapped to the remote lambda function called <code>hello-world</code>. You can define multiple named functions under the <code>aws.lambda.functions</code> configuration. Each is configured by <a href="../api/io/micronaut/function/client/aws/AWSInvokeRequestDefinition.html">AWSInvokeRequestDefinition</a> that allows setting any property on the underlying <code>com.amazonaws.services.lambda.model.InvokeRequest</code>.</p>
</div>
<div class="paragraph">
<p>To configure credentials for invoking the function you can either define a <code>~/.aws/credentials</code> file or use <code>application.yml</code>. Micronaut registers a <a href="../api/io/micronaut/configurations/aws/EnvironmentAWSCredentialsProvider.html">EnvironmentAWSCredentialsProvider</a> that resolves AWS credentials from the Micronaut <a href="#environments">Environment</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To invoke a function Micronaut configures a <code>AWSLambdaAsyncClient</code> using <a href="../api/io/micronaut/function/client/aws/AWSLambdaConfiguration.html">AWSLambdaConfiguration</a> that allows configuring any of the properties of the <code>AWSLambdaAsyncClientBuilder</code> class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now write <code>FunctionClient</code> interfaces against the remote function, as shown below.</p>
</div>
<div class="listingblock">
<div class="title">HelloClient.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.reactivex.*</span>;

<span class="annotation">@FunctionClient</span>
<span class="type">interface</span> HelloClient {

    Single&lt;<span class="predefined-type">String</span>&gt; hello(<span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
</div>
</div>
</div>


<h1 id="dataAccess">10 Configurations for Data Access</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/dataAccess.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features the ability to automatically configure access to common databases.</p>
</div>
<div class="paragraph">
<p>The table summarizes the configuration modules and the dependencies you should add to your build to enable them.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Data Access Configuration Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:jdbc-dbcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> instances using <a href="https://commons.apache.org/proper/commons-dbcp/">Commons DBCP</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:jdbc-hikari</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> instances using <a href="https://brettwooldridge.github.io/HikariCP/">Hikari Connection Pool</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:jdbc-tomcat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> instances using <a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html">Tomcat Connection Pool</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:hibernate-jpa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures Hibernate/JPA EntityManagerFactory beans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:hibernate-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/hibernate/manual">GORM for Hibernate</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:mongo-reactive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="http://mongodb.github.io/mongo-java-driver-reactivestreams">MongoDB Reactive Driver</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:mongo-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/mongodb/manual">GORM for MongoDB</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:neo4j-bolt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/neo4j/neo4j-java-driver">Bolt Java Driver</a> for <a href="https://neo4j.com">Neo4j</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:neo4j-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/neo4j/manual">GORM for Neo4j</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:redis-lettuce</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://lettuce.io">Lettuce</a> driver for <a href="https://redis.io">Redis</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:cassandra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/datastax/java-driver">Datastax Java Driver</a> for <a href="http://cassandra.apache.org">Cassandra</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, to add support for MongoDB you define the following dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:mongo-reactive</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For Groovy users, Micronaut provides special support for <a href="http://gorm.grails.org">GORM</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
For GORM for Hibernate you should not have both the <code>hibernate-jpa</code> and <code>hibernate-gorm</code> dependency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections go into more detail about configuration options and the exposed beans for each implementation.</p>
</div>


<h2 id="sqlSupport">10.1 Configuring a SQL Data Source</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/dataAccess/sqlSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Java data sources can be configured for one of three currently provided implementations. Apache DBCP2, Hikari, and Tomcat are supported by default.</p>
</div>
<div class="sect1">
<h2 id="_configuring_a_jdbc_datasource">Configuring a JDBC DataSource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started, simply add a dependency to one of the JDBC configurations that corresponds to the implementation you would like to use.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    <span class="comment">// Choose one of the following</span>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:jdbc-tomcat</span><span class="delimiter">&quot;</span></span>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:jdbc-hikari</span><span class="delimiter">&quot;</span></span>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:jdbc-dbcp</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also need to add a JDBC driver dependency to your classpath. For example to add the <a href="http://www.h2database.com">H2 In-Memory Database</a>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">runtime <span class="string"><span class="delimiter">&quot;</span><span class="content">com.h2database:h2:1.4.196</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_jdbc_connection_pools">Configuring JDBC Connection Pools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All of the implementation specific parameters can be configured. Effort was made to allow basic configuration to be consistent across the implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hikari: The URL is able to be configured through <code>url</code> in addition to <code>jdbcUrl</code>. The JNDI name can be configured through <code>jndiName</code> in addition to <code>dataSourceJNDI</code>.</p>
</li>
<li>
<p>Tomcat: The JNDI name can be configured through <code>jndiName</code> in addition to <code>dataSourceJNDI</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Several configuration options will be calculated if they are not provided.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath will be searched for an embedded database driver. If found, the URL will be set to the default value for that driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Driver Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the URL is configured, the driver class will be derived from the URL, otherwise the classpath will be searched for an embedded database driver. If found, the default class name for that driver will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the configured database driver is embedded, the username will be set to "sa"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the configured database driver is embedded, the password will be set to an empty string.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">application.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">datasources.default</span>: <span class="string"><span class="content">{}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will result in a single <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> bean being registered with the named qualifier of <code>default</code>.</p>
</div>
<div class="paragraph">
<p>If for example, the H2 driver is on the classpath, it is equivalent to the following:</p>
</div>
<div class="listingblock">
<div class="title">application.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">datasources</span>:
    <span class="key">default</span>:
        <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:mem:default;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE</span></span>
        <span class="key">username</span>: <span class="string"><span class="content">sa</span></span>
        <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
        <span class="key">driverClassName</span>: <span class="string"><span class="content">org.h2.Driver</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a list of other properties able to be configured, simply refer to the implementation that is being used. All setter methods are candidates for configuration.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/tomcat/jdbc/pool/PoolProperties.html">PoolProperties</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hikari</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://static.javadoc.io/com.zaxxer/HikariCP/2.7.1/com/zaxxer/hikari/HikariConfig.html">HikariConfig</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache DBCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://commons.apache.org/proper/commons-dbcp/api-2.1.1/org/apache/commons/dbcp2/BasicDataSource.html">BasicDataSource</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_multiple_data_sources">Configuring Multiple Data Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To register more than one data source, simply configure them under different names.</p>
</div>
<div class="listingblock">
<div class="title">application.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">datasources</span>:
    <span class="key">default</span>:
        <span class="error">...</span>
    <span class="key">warehouse</span>:
        <span class="error">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When injecting <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> beans, the one with the name "default" will be injected unless the injection is qualified with the configured name. If no configuration is named "default", none of the beans will be primary and thus all injections must be qualified. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="predefined-type">DataSource</span> dataSource <span class="comment">// &quot;default&quot; will be injected</span>
<span class="annotation">@Inject</span> <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">warehouse</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">DataSource</span> dataSource <span class="comment">// &quot;warehouse&quot; will be injected</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jdbc_health_checks">JDBC Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have configured a JDBC <code>DataSource</code> the <a href="../api/io/micronaut/management/health/indicator/jdbc/JdbcIndicator.html">JdbcIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the JDBC connection.</p>
</div>
<div class="paragraph">
<p>See the section on the <a href="#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>
</div>
</div>


<h2 id="hibernateSupport">10.2 Configuring Hibernate</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/dataAccess/hibernateSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_a_hibernate_jpa_entitymanager">Setting up a Hibernate/JPA EntityManager</h4>
<div class="paragraph">
<p>Micronaut features built in support for configuring a <a href="http://hibernate.org">Hibernate</a> / JPA <code>EntityManager</code> that builds on the <a href="#sqlSupport">SQL DataSource support</a>.</p>
</div>
<div class="paragraph">
<p>Once you have <a href="#sqlSupport">configured one or many DataSources</a> to use Hibernate you need to add the <code>hibernate-jpa</code> dependency to your build configuration:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:hibernate-jpa</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And that is it. For each registered SQL <code>DataSource</code>, Micronaut will configure the following beans using <a href="../api/io/micronaut/configuration/hibernate/jpa/EntityManagerFactoryBean.html">EntityManagerFactoryBean</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/registry/StandardServiceRegistry.html">StandardServiceRegistry</a> - The Hibernate <code>StandardServiceRegistry</code></p>
</li>
<li>
<p><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/MetadataSources.html">MetadataSources</a> - The Hibernate <code>MetadataSources</code></p>
</li>
<li>
<p><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/SessionFactoryBuilder.html">SessionFactoryBuilder</a> - The Hibernate <code>SessionFactoryBuilder</code></p>
</li>
<li>
<p><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/SessionFactory.html">SessionFactory</a> - The Hibernate <code>SessionFactory</code> bean which also implements the JPA <code>EntityManagerFactory</code> interface.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_hibernate_jpa_configuration">Customizing Hibernate / JPA Configuration</h4>
<div class="paragraph">
<p>There are several different ways you can customize and configure how the <code>SessionFactory</code> is built. The easiest way is via configuration in <code>application.yml</code>. The following configuration demonstrates an example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Hibernate Properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">datasources</span>:
    <span class="key">default</span>:
        <span class="key">name</span>: <span class="string"><span class="content">'mydb'</span></span>
<span class="key">jpa</span>:
    <span class="key">default</span>:
        <span class="key">packages-to-scan</span>:
            - <span class="string"><span class="content">'foo.bar'</span></span>
            - <span class="string"><span class="content">'foo.baz'</span></span>
        <span class="key">properties</span>:
            <span class="key">hibernate</span>:
                <span class="key">hbm2ddl</span>:
                    <span class="key">auto</span>: <span class="string"><span class="content">update</span></span>
                <span class="key">show_sql</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example configures the packages to be scanned and sets properties to be passed to Hibernate. As you can see these are done on a per <code>DataSource</code> basis. Refer to the <a href="../api/io/micronaut/configuration/hibernate/jpa/JpaConfiguration.html">JpaConfiguration</a> configuration class for the possible options.</p>
</div>
<div class="paragraph">
<p>If you need even further control over how the <code>SessionFactory</code> is built then you can register <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> beans that listen for the creation of the <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/SessionFactoryBuilder.html">SessionFactoryBuilder</a>, <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/MetadataSources.html">MetadataSources</a> etc. and apply your custom configuration in the listener.</p>
</div>
<div class="paragraph">
<p>You may also optionally create beans of type <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/integrator/spi/Integrator.html">Integrator</a> and <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/Interceptor.html">Interceptor</a> and these will be picked up and injected automatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_spring_transaction_management">Using Spring Transaction Management</h4>
<div class="paragraph">
<p>Micronaut&#8217;s Hibernate integration will also automatically provide a Spring <code>HibernateTransactionManager</code> bean so you can use Spring-based transaction management.</p>
</div>
<div class="paragraph">
<p>You should use Micronaut&#8217;s <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> annotation to ensure low-overhead, compile-time transaction management is applied to your classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_understanding_lazyinitializationexception">Understanding LazyInitializationException</h4>
<div class="paragraph">
<p>Micronaut is built on Netty which is based on a non-blocking, event loop model. JDBC and Hibernate are blocking APIs and hence when they are used in a Micronaut application the work is shifted to a blocking I/O thread pool.</p>
</div>
<div class="paragraph">
<p>When using <a href="../api/io/micronaut/spring/tx/annotation/Transactional.html">@Transactional</a> the Hibernate <code>Session</code> will only be open for the duration of this method execution and then will automatically be closed. This ensures that the blocking operation is kept as short as possible.</p>
</div>
<div class="paragraph">
<p>There is no notion of OpenSessionInView (OSIV) in Micronaut and never will be, since it is <a href="https://vladmihalcea.com/the-open-session-in-view-anti-pattern/">sub-optimal and not recommended</a>. You should optimize the queries that you write to return all the necessary data Micronaut will need to encode your objects into JSON.</p>
</div>
<div class="paragraph">
<p>If you encounter a <code>LazyInitializationException</code> when returning a Hibernate entity from a method it is an indication that your query is suboptimal and you should perform a join.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_gorm_for_hibernate">Using GORM for Hibernate</h4>
<div class="paragraph">
<p>For Groovy users and users familiar with Grails framework special support for <a href="http://gorm.grails.org">GORM for Hibernate</a> is available. To use GORM for Hibernate you should not include the Micronaut&#8217;s built in <a href="#sqlSupport">SQL Support</a> or the <code>hibernate-jpa</code> dependency since GORM itself takes responsibility for creating the <code>DataSource</code>, <code>SessionFactory</code> etc.</p>
</div>
<div class="paragraph">
<p>Instead you should only define the <code>hibernate-gorm</code> dependency, a connection pool implementation and the necessary JDBC driver. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring GORM for Hibernate</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:hibernate-gorm</span><span class="delimiter">&quot;</span></span>
  <span class="comment">// Use Tomcat connection pool</span>
  runtime <span class="string"><span class="delimiter">'</span><span class="content">org.apache.tomcat:tomcat-jdbc:8.0.44</span><span class="delimiter">'</span></span>
  <span class="comment">// Use H2 database driver</span>
  runtime  <span class="string"><span class="delimiter">'</span><span class="content">com.h2database:h2:1.4.196</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you should use the same <a href="http://gorm.grails.org/latest/hibernate/manual/index.html#configuration">configuration properties described in the GORM documentation</a>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring GORM for Hibernate</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dataSource</span>:
    <span class="key">pooled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
    <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:mem:devDb</span></span>
    <span class="key">driverClassName</span>: <span class="string"><span class="content">org.h2.Driver</span></span>
    <span class="key">username</span>: <span class="string"><span class="content">sa</span></span>
    <span class="key">password</span>:
<span class="key">hibernate</span>:
    <span class="key">cache</span>:
        <span class="key">queries</span>: <span class="string"><span class="content">false</span></span>
        <span class="key">use_second_level_cache</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">use_query_cache</span>: <span class="string"><span class="content">false</span></span>
        <span class="key">region.factory_class</span>: <span class="string"><span class="content">org.hibernate.cache.ehcache.EhCacheRegionFactory</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should be noted regarding using GORM for Hibernate in Micronaut:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each class you wish to be a GORM entity should be annotated with the <code>grails.gorm.annotation.Entity</code> annotation.</p>
</li>
<li>
<p>Each method that interacts with GORM should be annotated with GORM&#8217;s <code>grails.gorm.transactions.Transactional</code> to ensure a session is present. You can also add the <code>@Transactional</code> annotation to the class.</p>
</li>
<li>
<p>By default Micronaut will scan for entities relative to your <code>Application</code> class. If you wish to customize this specify additional packages via the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a> when starting your application.</p>
</li>
</ul>
</div>
</div>


<h2 id="mongoSupport">10.3 Configuring MongoDB</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/dataAccess/mongoSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_the_native_mongodb_driver">Setting up the Native MongoDB Driver</h4>
<div class="paragraph">
<p>Micronaut features the ability to automatically configure the native MongoDB Java driver.</p>
</div>
<div class="paragraph">
<p>To enable this you first need to add the <code>mongo-reactive</code> module to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:mongo-reactive</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then configure the URI of the MongoDB server in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring a MongoDB server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">mongodb</span>:
    <span class="key">uri</span>: <span class="string"><span class="content">mongodb://localhost:27017</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>mongodb.uri</code> follows the <a href="https://docs.mongodb.com/manual/reference/connection-string">MongoDB Connection String</a> format.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both a blocking <a href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/async/client/MongoClient.html">MongoClient</a> and a non-blocking Reactive Streams <a href="http://mongodb.github.io/mongo-java-driver-reactivestreams/1.8/javadoc/com/mongodb/reactivestreams/client/MongoClient.html">MongoClient</a> are automatically then available for dependency injection.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_mongodb_driver">Configuring the MongoDB Driver</h4>
<div class="paragraph">
<p>The configuration options for the blocking client and the non-blocking client differ at the driver level.</p>
</div>
<div class="paragraph">
<p>To configure the blocking client options you can use the <code>mongodb.options</code> setting which allows you to configure any property of the <code>MongoClientOptions.Builder</code> class. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Blocking Driver Options</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">mongodb</span>:
    <span class="error">...</span>
    <span class="key">options</span>:
        <span class="key">maxConnectionIdleTime</span>: <span class="string"><span class="content">10000</span></span>
        <span class="key">readConcern</span>: <span class="string"><span class="content">majority</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the API for <a href="../api/io/micronaut/configuration/mongo/reactive/DefaultMongoConfiguration.html">DefaultMongoConfiguration</a> for more information on the available configuration options.</p>
</div>
<div class="paragraph">
<p>For the Reactive driver, the <a href="../api/io/micronaut/configuration/mongo/reactive/ReactiveMongoConfiguration.html">ReactiveMongoConfiguration</a> exposes options to configure the Reactive Streams driver. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Reactive Streams Driver</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">mongodb</span>:
    <span class="error">...</span>
    <span class="key">cluster</span>:
        <span class="key">maxWaitQueueSize</span>: <span class="string"><span class="content">5</span></span>
    <span class="key">connectionPool</span>:
        <span class="key">maxSize</span>: <span class="string"><span class="content">20</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_embedded_mongodb_for_testing">Using Embedded MongoDB for Testing</h4>
<div class="paragraph">
<p>For testing you can add a dependency on <a href="https://github.com/flapdoodle-oss/de.flapdoodle.embed.mongo">Embedded MongoDB</a> and if the MongoDB server is not available on the configured port for the test environment an embedded MongoDB will be bootstrapped and made available for testing:</p>
</div>
<div class="listingblock">
<div class="title">Add Embedded MongoDB</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">de.flapdoodle.embed:de.flapdoodle.embed.mongo:2.0.1</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_mongodb_drivers">Multiple MongoDB Drivers</h4>
<div class="paragraph">
<p>You can create multiple MongoDB connections using the <code>mongodb.servers</code> setting. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Multiple MongoDB Drivers</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">mongodb</span>:
    <span class="key">servers</span>:
        <span class="key">another</span>:
            <span class="key">uri</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mongodb://localhost:27018</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above configuration in place you can inject a <code>MongoClient</code> using the name <code>another</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.mongodb.reactivestreams.client</span>.*;
<span class="keyword">import</span> <span class="include">javax.inject</span>.*;
...
<span class="annotation">@Inject</span> <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">another</span><span class="delimiter">&quot;</span></span>) MongoClient mongoClient;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mongodb_health_checks">MongoDB Health Checks</h4>
<div class="paragraph">
<p>When the <code>mongo-reactive</code> module is activated a <a href="../api/io/micronaut/configuration/mongo/reactive/health/MongoHealthIndicator.html">MongoHealthIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the MongoDB connection.</p>
</div>
<div class="paragraph">
<p>See the section on the <a href="#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_gorm_for_mongodb">Using GORM for MongoDB</h4>
<div class="paragraph">
<p>For Groovy users and users familiar with Grails, special support has been added to Micronaut for using <a href="http://gorm.grails.org/latest/mongodb/manual">GORM for MongoDB</a>.</p>
</div>
<div class="paragraph">
<p>To add support for GORM for MongoDB, first configure the MongoDB connection as per instructions earlier in the guide, then add the following dependency to your application:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:mongo-gorm</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should be noted regarding using GORM for MongoDB in Micronaut:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each class you wish to be a GORM entity should be annotated with the <code>grails.gorm.annotation.Entity</code> annotation.</p>
</li>
<li>
<p>Each method that interacts with GORM should be annotated with GORM&#8217;s <code>grails.gorm.transactions.Transactional</code> to ensure a session is present. You can also add the <code>@Transactional</code> annotation to the class.</p>
</li>
<li>
<p>By default Micronaut will scan for entities relative to your <code>Application</code> class. If you wish to customize this specify additional packages via the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a> when starting your application.</p>
</li>
</ul>
</div>
</div>


<h2 id="neo4jSupport">10.4 Configuring Neo4j</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/dataAccess/neo4jSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features dedicated support for automatically configuring the <a href="https://neo4j.com/docs/developer-manual/current/drivers/">Neo4j Bolt Driver</a> for the popular <a href="https://neo4j.com/">Neo4j</a> Graph Database.</p>
</div>
<div class="sect1">
<h2 id="_configuring_neoj4_bolt">Configuring Neoj4 Bolt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the Neo4j Bolt driver you should first add the <code>neo4j-bolt</code> module to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:neo4j-bolt</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should then configure the URI of the Neo4j server you wish to communicate with in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring <code>neo4j.uri</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">neo4j</span>:
    <span class="key">uri</span>: <span class="string"><span class="content">bolt://localhost</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>neo4j.uri</code> setting should be in the format as described in the <a href="https://neo4j.com/docs/developer-manual/current/drivers/client-applications/#driver-connection-uris">Connection URIs</a> section of the Neo4j documentation
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have the above configuration in place you can inject an instance of the <code>org.neo4j.driver.v1.Driver</code> bean, which features both a synchronous blocking API and a non-blocking API based on <code>CompletableFuture</code>.</p>
</div>
<div class="sect2">
<h3 id="_customizing_neo4j_configuration">Customizing Neo4j Configuration</h3>
<div class="paragraph">
<p>The configuration can be further customized with all the options available using the <a href="../api/io/micronaut/configuration/neo4j/bolt/Neo4jBoltConfiguration.html">Neo4jBoltConfiguration</a> class.</p>
</div>
<div class="paragraph">
<p>The <code>Neo4jBoltConfiguration</code> also exposes all the options for the <code>org.neo4j.driver.v1.Config.ConfigBuilder</code> class.</p>
</div>
<div class="paragraph">
<p>Below represents an example configuration:</p>
</div>
<div class="listingblock">
<div class="title">Customizing the Bolt Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">neo4j</span>:
    <span class="key">uri</span>: <span class="string"><span class="content">bolt://localhost</span></span>
    <span class="key">maxConnectionPoolSize</span>: <span class="string"><span class="content">50</span></span>
    <span class="key">connectionAcquisitionTimeout</span>: <span class="string"><span class="content">30s</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also create a <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> bean and listen for the creation of the <a href="../api/io/micronaut/configuration/neo4j/bolt/Neo4jBoltConfiguration.html">Neo4jBoltConfiguration</a> to further programmatically customize configuration
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_embedding_neo4j_for_testing">Embedding Neo4j for Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can embed Neo4j for testing by including a dependency on the Neo4j test harness:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.test:neo4j-harness:3.3.3</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the Neo4j server is not already running on the configured port an embedded version will be started.</p>
</div>
<div class="paragraph">
<p>You can configure the options for the embedded Neo4j server using the <code>neo4j.embedded</code> settings exposed by <a href="../api/io/micronaut/configuration/neo4j/bolt/Neo4jBoltConfiguration.html">Neo4jBoltConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>One useful option is <code>ephemeral</code> which ensures the data is cleaned up between test runs. For example in <code>application-test.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using ephemeral</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">neo4j</span>:
    <span class="key">embedded</span>:
        <span class="key">ephemeral</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neo4j_health_checks">Neo4j Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the <code>neo4j-bolt</code> module is activated a <a href="../api/io/micronaut/configuration/neo4j/bolt/health/Neo4jHealthIndicator.html">Neo4jHealthIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the Neo4j connection.</p>
</div>
<div class="paragraph">
<p>See the section on the <a href="#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_gorm_for_neo4j">Using GORM for Neo4j</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For Groovy users and users familiar with Grails, special support has been added to Micronaut for using <a href="http://gorm.grails.org/latest/neo4j/manual">GORM for Neo4j</a>.</p>
</div>
<div class="paragraph">
<p>To add support for GORM for Neo4j, first configure the Neo4j connection as per instructions earlier in the guide, then add the following dependency to your application:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:neo4j-gorm</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following should be noted regarding using GORM for Neo4j in Micronaut:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each class you wish to be a GORM entity should be annotated with the <code>grails.gorm.annotation.Entity</code> annotation.</p>
</li>
<li>
<p>Each method that interacts with GORM should be annotated with GORM&#8217;s <code>grails.gorm.transactions.Transactional</code> to ensure a session is present. You can also add the <code>@Transactional</code> annotation to the class.</p>
</li>
<li>
<p>By default Micronaut will scan for entities relative to your <code>Application</code> class. If you wish to customize this specify additional packages via the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a> when starting your application.</p>
</li>
</ul>
</div>
</div>
</div>


<h2 id="redisSupport">10.5 Configuring Redis</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/dataAccess/redisSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features automatic configuration of the <a href="https://lettuce.io">Lettuce</a> driver for <a href="https://redis.io">Redis</a> via the <code>redis-lettuce</code> module.</p>
</div>
<div class="sect1">
<h2 id="_configuring_lettuce">Configuring Lettuce</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the Lettuce driver you should first add the <code>redis-lettuce</code> module to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:redis-lettuce</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should then configure the URI of the Redis server you wish to communicate with in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring <code>redis.uri</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">redis</span>:
    <span class="key">uri</span>: <span class="string"><span class="content">redis://localhost</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>redis.uri</code> setting should be in the format as described in the <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details">Connection URIs</a> section of the Lettuce wiki
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also specify multiple Redis URIs using <code>redis.uris</code> in which case a <code>RedisClusterClient</code> is created instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_available_lettuce_beans">Available Lettuce Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have the above configuration in place you can inject one of the following beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.lettuce.core.RedisClient</code> - The main client interface</p>
</li>
<li>
<p><code>io.lettuce.core.api.StatefulRedisConnection</code> - A connection interface that features synchronous, reactive (based on Reactor) and async APIs that operate on <code>String</code> values</p>
</li>
<li>
<p><code>io.lettuce.core.pubsub.StatefulRedisPubSubConnection</code> - A connection interface for dealing with Redis Pub/Sub</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example demonstrates the use of the <code>StatefulRedisConnection</code> interface&#8217;s synchronous API:</p>
</div>
<div class="listingblock">
<div class="title">Using StatefulRedisConnection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Inject</span> StatefulRedisConnection&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; connection
...
RedisCommands&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; commands = connection.sync()
commands.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)
commands.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) == <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Lettuce driver&#8217;s <code>StatefulRedisConnection</code> interface is designed to be long-lived and there is no need to close the connection. It will be closed automatically when the application shuts down.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_redis_configuration">Customizing The Redis Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can customize the Redis configuration using any properties exposed by the <a href="../api/io/micronaut/configuration/lettuce/DefaultRedisConfiguration.html">DefaultRedisConfiguration</a> class. For example, in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Redis Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">redis</span>:
    <span class="key">uri</span>: <span class="string"><span class="content">redis://localhost</span></span>
    <span class="key">ssl</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">timeout</span>: <span class="string"><span class="content">30s</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_redis_connections">Multiple Redis Connections</h3>
<div class="paragraph">
<p>You can configure multiple Redis connections using the <code>redis.servers</code> setting. For example:</p>
</div>
<div class="listingblock">
<div class="title">Customizing Redis Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">redis</span>:
    <span class="key">servers</span>:
        <span class="key">foo</span>:
            <span class="key">uri</span>: <span class="string"><span class="content">redis://foo</span></span>
        <span class="key">bar</span>:
            <span class="key">uri</span>: <span class="string"><span class="content">redis://bar</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In which case the same beans will be created for each entry under <code>redis.servers</code> but exposed as <code>@Named</code> beans.</p>
</div>
<div class="listingblock">
<div class="title">Using StatefulRedisConnection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Inject</span> <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) StatefulRedisConnection&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; connection;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will inject the connection named <code>foo</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_embedding_redis_for_testing">Embedding Redis for Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can run an embedded version of Redis for testing and CI scenarios by adding a dependency on the Embedded Redis project:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.kstyrc:embedded-redis:0.6</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If Redis is unavailable for the configured Redis URI an embedded instance of Redis will be automatically be started and then shutdown at the end of the test (when <code>stop</code> is called on the <code>ApplicationContext</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_redis_health_checks">Redis Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the <code>redis-lettuce</code> module is activated a <a href="../api/io/micronaut/configuration/lettuce/health/RedisHealthIndicator.html">RedisHealthIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the Redis connection or connections.</p>
</div>
<div class="paragraph">
<p>See the section on the <a href="#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_redis_as_a_cache">Using Redis as a Cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Redis as a cache implementation, see the section on <a href="#caching">Cache Advice</a> for how to configure Redis backed caches.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_redis_for_http_sessions">Using Redis for HTTP Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Redis as a backing implementation for storing HTTP sessions. See the section on <a href="#sessions">HTTP Sessions</a> for more information on how to configure Redis backed sessions.</p>
</div>
</div>
</div>


<h2 id="cassandraSupport">10.6 Configuring Cassandra</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/dataAccess/cassandraSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Add the following to the <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.configuration:cassandra</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut supports Cassandra configuration by using the <a href="https://docs.datastax.com/en/developer/java-driver/">Datastax Java Driver</a>.
Configuration values can be supplied a property source such as below. The property name is derived from the builder methods in
<a href="https://docs.datastax.com/en/drivers/java/3.1/com/datastax/driver/core/Cluster.Builder.html">Cluster.Builder</a> (without the prefix).
Micronaut will create a <a href="https://docs.datastax.com/en/drivers/java/3.1/com/datastax/driver/core/Cluster.html">Cluster</a> bean. This bean
can be then injected into any other Micronaut bean.</p>
</div>
<div class="listingblock">
<div class="title">Supply Single Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext applicationContext = <span class="keyword">new</span> DefaultApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
applicationContext.environment.addPropertySource(MapPropertySource.of(
        <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>,
        [<span class="string"><span class="delimiter">'</span><span class="content">cassandra.default.clusterName</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ociCluster</span><span class="delimiter">&quot;</span></span>,
         <span class="string"><span class="delimiter">'</span><span class="content">cassandra.default.contactPoint</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
         <span class="string"><span class="delimiter">'</span><span class="content">cassandra.default.port</span><span class="delimiter">'</span></span>: <span class="integer">9042</span>,
         <span class="string"><span class="delimiter">'</span><span class="content">cassandra.default.maxSchemaAgreementWaitSeconds</span><span class="delimiter">'</span></span>: <span class="integer">20</span>,
         <span class="string"><span class="delimiter">'</span><span class="content">cassandra.default.ssl</span><span class="delimiter">'</span></span>: <span class="predefined-constant">true</span>]
))
applicationContext.start()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple Cluster instances can be configured as follows:</p>
</div>
<div class="listingblock">
<div class="title">Supply Multiple Configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext applicationContext = <span class="keyword">new</span> DefaultApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
applicationContext.environment.addPropertySource(MapPropertySource.of(
        <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>,
        [<span class="string"><span class="delimiter">'</span><span class="content">cassandra.default.contactPoint</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
         <span class="string"><span class="delimiter">'</span><span class="content">cassandra.default.port</span><span class="delimiter">'</span></span>: <span class="integer">9042</span>,
         <span class="string"><span class="delimiter">'</span><span class="content">cassandra.secondary.contactPoint</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.2</span><span class="delimiter">&quot;</span></span>,
         <span class="string"><span class="delimiter">'</span><span class="content">cassandra.secondary.port</span><span class="delimiter">'</span></span>: <span class="integer">9043</span>]
))
applicationContext.start()</code></pre>
</div>
</div>


<h1 id="languageSupport">11 Language Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/languageSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports any JVM language that implements the <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/package-summary.html">Java Annotation Processor</a> API.</p>
</div>
<div class="paragraph">
<p>Although Groovy, does not in fact support this API, special support has been built via an AST transformation. The current list of supported languages is: Java, Groovy and Kotlin (via the kapt tool).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Theoretically any language that supports a way to analyze the AST at compile time could be supported. The <a href="../api/io/micronaut/inject/writer/package-summary.html">io.micronaut.inject.writer</a> package includes classes that are language neutral and are used to build <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> classes at compile time using the ASM tool.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections cover language specific features and considerations for using Micronaut.</p>
</div>


<h2 id="java">11.1 Micronaut for Java</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/languageSupport/java.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For Java, Micronaut uses a Java <a href="../api/io/micronaut/annotation/processing/BeanDefinitionInjectProcessor.html">BeanDefinitionInjectProcessor</a> annotation processor to process classes at compile time and produce <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> classes.</p>
</div>
<div class="paragraph">
<p>The major advantage here is that you pay a slight cost at compile time, but at runtime Micronaut is largely reflection-free, fast and consumes very little memory.</p>
</div>
<div class="sect1">
<h2 id="_using_micronaut_with_java_9">Using Micronaut with Java 9+</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut is built with Java 8, however works fine with Java 9/10 and above as well. The classes that Micronaut generates sit along side existing classes within the same package, hence do not violate anything regarding the Java module system.</p>
</div>
<div class="paragraph">
<p>There are some considerations to take into account when using Java 9/10 with Micronaut.</p>
</div>
<div class="sect2">
<h3 id="_the_javax_annotation_package">The javax.annotation package</h3>
<div class="paragraph">
<p>The <code>javax.annotation</code>, which includes <code>@PostConstruct</code>, <code>@PreDestroy</code> etc. is no longer part of the core JDK but instead a module. If you run under Java 9+ you will need to import the module or add the dependency to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">Adding the <code>javax.annotation</code> dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">javax.annotation:javax.annotation-api:1.3.2</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ide_considerations">IDE Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use any IDE to develop Micronaut, if you depend on your configured build tool (Gradle or Maven) to build the application.</p>
</div>
<div class="paragraph">
<p>However, if you wish to run tests within the IDE that is currently only possible with <a href="http://jetbrains.com/idea">IntelliJ IDEA</a>.</p>
</div>
<div class="paragraph">
<p>For IntelliJ IDEA if you plan to use the IntelliJ compiler then you should enable annotation processing under the "Build, Execution, Deployment &#8594; Compiler &#8594; Annotation Processors" by ticking the "Enable annotation processing" checkbox:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/intellij-annotation-processors.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>As of this writing, Eclipse has <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=534501">incomplete support</a> for Java annotation processors, hence you will have to delegate to BuildShip or M2Eclipse for building and running tests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retaining_parameter_names">Retaining Parameter Names</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default with Java, the parameter name data for method parameters is not retained at compile time. This can be a problem for Micronaut if you do not define parameter names explicitly and depend on an external JAR that is already compiled.</p>
</div>
<div class="paragraph">
<p>Consider this interface:</p>
</div>
<div class="listingblock">
<div class="title">Client Interface</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">HelloOperations</span> {
    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello/{name}</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> hello(<span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At compile time the parameter name <code>name</code> is lost and becomes simply <code>arg0</code> when compiled against or read via reflection later. To avoid this problem you have two options. You can either declare the parameter name explicitly:</p>
</div>
<div class="listingblock">
<div class="title">Client Interface</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">HelloOperations</span> {
    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello/{name}</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> hello(<span class="annotation">@Parameter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively it is recommended that you compile all byte code with <code>-parameters</code> flag to <code>javac</code>. See <a href="https://docs.oracle.com/javase/tutorial/reflect/member/methodparameterreflection.html">Obtaining Names of Method Parameters</a>. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compileJava.options.compilerArgs += <span class="string"><span class="delimiter">'</span><span class="content">-parameters</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="groovy">11.2 Micronaut for Groovy</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/languageSupport/groovy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="http://groovy-lang.org">Groovy language</a> has first class support in Micronaut.</p>
</div>
<div class="sect1">
<h2 id="_groovy_specific_modules">Groovy Specific Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additional modules exist specific to Groovy that improve the overall experience. These are detailed in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Groovy Specific Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:inject-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes AST transformations to generate bean definitions. Should be <code>compileOnly</code> on your classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:runtime-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds the ability to specify configuration placed in <code>src/main/resources</code> in Groovy format (i.e. <code>application.groovy</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:function-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes AST transforms that make it easier to write <a href="#serverlessFunctions">Functions</a> for AWS Lambda</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The most common module you will need is <code>inject-groovy</code>, which enables DI and AOP for classes written in Groovy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_support_in_the_cli">Groovy Support in the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="#cli">Command Line Interface</a> for Micronaut also includes special support for Groovy. To create Groovy application use the <code>groovy</code> feature. For example:</p>
</div>
<div class="listingblock">
<div class="title">Create a Micronaut Groovy application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-app hello-world --features groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will generate a Groovy project, built with Gradle. You can use the <code>-build maven</code> flag to generate a project built with Maven instead.</p>
</div>
<div class="paragraph">
<p>Once you have created an application with the <code>groovy</code> feature commands like <code>create-controller</code>, <code>create-client</code> etc. will generate Groovy files instead of Java. The following example demonstrates this action when using interactive mode of the CLI:</p>
</div>
<div class="listingblock">
<div class="title">Create a bean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;

create-bean          create-client        create-controller
create-job           help

mn&gt; create-bean helloBean
| Rendered template Bean.groovy to destination src/main/groovy/hello/world/HelloBean.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example demonstrates creating a Groovy bean that looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Bean</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> hello.world

<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>

<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">HelloBean</span> {

}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Groovy automatically imports <code>groovy.lang.Singleton</code> which can be confusing as it conflicts with <code>javax.inject.Singleton</code>. Make sure you include the <code>javax.inject.Singleton</code> import when declaring a singleton bean!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can also create a client - don&#8217;t forget Micronaut can act as a client or a server!</p>
</div>
<div class="listingblock">
<div class="title">Create a client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; create-client helloClient
| Rendered template Client.groovy to destination src/main/groovy/hello/world/HelloClient.groovy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Micronaut Client</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> hello.world

<span class="keyword">import</span> <span class="include">io.micronaut.http.client.Client</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpStatus</span>

<span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> HelloClient {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
    HttpStatus index()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create a controller:</p>
</div>
<div class="listingblock">
<div class="title">Create a controller</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; create-controller helloController
| Rendered template Controller.groovy to destination src/main/groovy/hello/world/HelloController.groovy
| Rendered template ControllerSpec.groovy to destination src/test/groovy/hello/world/HelloControllerSpec.groovy
mn&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Micronaut Controller</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> hello.world

<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Controller</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpStatus</span>


<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">HelloController</span> {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
    HttpStatus index() {
        <span class="keyword">return</span> HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the output from the CLI a <a href="http://spockframework.org">Spock</a> test was also generated for you demonstrating how to test the controller:</p>
</div>
<div class="listingblock">
<div class="title">HelloControllerSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">...
    void <span class="string"><span class="delimiter">&quot;</span><span class="content">test index</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        HttpResponse response = client.toBlocking().exchange(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>)

        <span class="key">expect</span>:
        response.status == HttpStatus.OK
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how you use Micronaut both as client and as a server to test itself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programmatic_routes_with_groovyrouterbuilder">Programmatic Routes with GroovyRouterBuilder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you prefer to build your routes programmatically (similar to Grails <code>UrlMappings</code>) then a special <code>io.micronaut.web.router.GroovyRouteBuilder</code> exists that has some enhancements to make the DSL better.</p>
</div>
<div class="paragraph">
<p>The following example shows <code>GroovyRouteBuilder</code> in act:</p>
</div>
<div class="listingblock">
<div class="title">Using GroovyRouteBuilder</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>
<span class="directive">static</span> <span class="type">class</span> <span class="class">MyRoutes</span> <span class="directive">extends</span> GroovyRouteBuilder {

    MyRoutes(ApplicationContext beanContext) {
        <span class="local-variable">super</span>(beanContext)
    }

    <span class="annotation">@Inject</span>
    <span class="type">void</span> bookResources(BookController bookController, AuthorController authorController) {
        GET(bookController) {
            POST(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello{/message}</span><span class="delimiter">&quot;</span></span>, bookController.&amp;hello) <i class="conum" data-value="1"></i><b>(1)</b>
        }
        GET(bookController, ID) { <i class="conum" data-value="2"></i><b>(2)</b>
            GET(authorController)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can use injected controllers to create routes by convention and Groovy method references to create routes to methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>ID</code> property can be used to reference include an <code>{id}</code> URI variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example results in the following routes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/book</code> - Maps to <code>BookController.index()</code></p>
</li>
<li>
<p><code>/book/hello/{message}</code> - Maps to <code>BookController.hello(String)</code></p>
</li>
<li>
<p><code>/book/{id}</code> - Maps to <code>BookController.show(String id)</code></p>
</li>
<li>
<p><code>/book/{id}/author</code> - Maps to <code>AuthorController.index</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_gorm_in_a_groovy_application">Using GORM in a Groovy application</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://gorm.grails.org">GORM</a> is a data access toolkit originally created as part of Grails framework. It supports multiple database types. The following table summarizes the modules needed to use GORM and links to documentation.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. GORM Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:hibernate-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/hibernate/manual">GORM for Hibernate</a> for Groovy applications. See the <a href="#hibernateSupport">Hibernate Support</a> docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:mongo-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/mongodb/manual">GORM for MongoDB</a> for Groovy applications. See the <a href="#mongoSupport">Mongo Support</a> docs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.configuration:neo4j-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="http://gorm.grails.org/latest/neo4j/manual">GORM for Neo4j</a> for Groovy applications. See the <a href="#neo4jSupport">Neo4j Support</a> docs.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once you have configured a GORM implementation per the instructions linked in the table above you can use all features of GORM.</p>
</div>
<div class="paragraph">
<p><a href="http://gorm.grails.org/latest/hibernate/manual/index.html#dataServices">GORM Data Services</a> can also participate in dependency injection and life cycle methods:</p>
</div>
<div class="listingblock">
<div class="title">GORM Data Service VehicleService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Service</span>(Vehicle)
<span class="directive">abstract</span> <span class="type">class</span> <span class="class">VehicleService</span> {
    <span class="annotation">@PostConstruct</span>
    <span class="type">void</span> init() {
       <span class="comment">// do something on initialization</span>

    }

    <span class="directive">abstract</span> Vehicle findVehicle(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> name)

    <span class="directive">abstract</span> Vehicle saveVehicle(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> name)

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define the service as an interface instead of an abstract class if you want GORM to do all of the work and you don&#8217;t want to add your own behaviors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_functions_with_groovy">Serverless Functions with Groovy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A microservice application is just one way to use Micronaut. You can also use it for serverless functions like on AWS Lambda.</p>
</div>
<div class="paragraph">
<p>With the <code>function-groovy</code> module, Micronaut features enhanced support for functions written in Groovy.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#serverlessFunctions">Serverless Functions</a> for more information.</p>
</div>
</div>
</div>


<h2 id="kotlin">11.3 Micronaut for Kotlin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/languageSupport/kotlin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Support for Kotlin in Micronaut is built upon the <a href="https://kotlinlang.org/docs/reference/kapt.html">Kapt</a> compiler plugin, which includes support for Java annotation processors. To use Kotlin in your Micronaut application, you will simply need to add the proper dependencies to configure and run kapt on your <code>kt</code> source files. Kapt will create Java "stub" classes for each of your Kotlin classes, which can then be processed by Micronaut&#8217;s Java annotation processor. The stubs are not included in the final compiled application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Learn more about kapt and its features from the <a href="https://kotlinlang.org/docs/reference/kapt.html">official documentation.</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Gradle, you can use the <a href="https://docs.gradle.org/current/userguide/application_plugin.html">Application</a> plugin to run your application with the kapt compilation step in your build:</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jetbrains.kotlin:kotlin-gradle-plugin:</span><span class="inline"><span class="inline-delimiter">$</span>kotlinVersion</span><span class="delimiter">&quot;</span></span>
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kotlin</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">kotlin-kapt</span><span class="delimiter">'</span></span>

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application</span><span class="delimiter">&quot;</span></span>
mainClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">example.Application</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>

repositories {
    mavenCentral()
    mavenLocal()
}

dependencies {
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jetbrains.kotlin:kotlin-stdlib-jdk8:</span><span class="inline"><span class="inline-delimiter">$</span>kotlinVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.jetbrains.kotlin:kotlin-reflect:</span><span class="inline"><span class="inline-delimiter">$</span>kotlinVersion</span><span class="delimiter">&quot;</span></span>
    kapt <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:inject-java</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>

    kaptTest <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:inject-java</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
}

test {
    useJUnitPlatform()
}

compileKotlin {
    kotlinOptions.jvmTarget = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.8</span><span class="delimiter">&quot;</span></span>
}

compileTestKotlin {
    kotlinOptions.jvmTarget = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.8</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply the Kotlin and Kapt plugins</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set a <code>mainClassName</code> (required by the Application plugin)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the Kotlin standard libraries</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add the <code>inject-java</code> dependency under the <code>kapt</code> scope, so classes in <code>src/main</code> are processed</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add the <code>inject-java</code> dependency under the <code>kaptTest</code> scope, so classes in <code>src/test</code> are processed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With a <code>build.gradle</code> file similar to the above, you can now run your Micronaut application using the <code>run</code> task (provided by the Application plugin):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now use Kotlin in your Micronaut project:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/HelloController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example

import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller(&quot;/&quot;)
class HelloController {

    @Get(&quot;/hello/{name}&quot;)
    fun hello(name: String): String {
        return &quot;Hello $name&quot;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The IntelliJ IDEA compiler does not support kapt! Classes must be compiled with the Gradle or Maven plugins.
</td>
</tr>
</table>
</div>


<h1 id="management">12 Management & Monitoring</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Inspired by Spring Boot and Grails, the Micronaut <code>management</code> dependency adds support for monitoring of your application via <strong>endpoints</strong>: special URIs that return details about the health and state of your application. The <code>management</code> endpoints are also integrated with Micronaut&#8217;s <code>security</code> dependency, allowing for sensitive data to be restricted to authenticated users in your security system (see <a href="#builtInEndpointsAccess">Built-in Endpoints Access</a> in the Security section).</p>
</div>
<div class="paragraph">
<p>To use the <code>management</code> features described in this section, add the dependency on your classpath. For example, in <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:management</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>


<h2 id="buildingEndpoints">12.1 Creating Endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/buildingEndpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to the <a href="#providedEndpoints">Built-In Endpoints</a>, the <code>management</code> dependency also provides support for creating custom endpoints.  Custom endpoints can be enabled and configured identically to the built-in endpoints, and can be used to retrieve and return any metrics or other application data that you require.</p>
</div>


<h2 id="endpointAnnotation">12.1.1 The Endpoint Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/buildingEndpoints/endpointAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>An Endpoint can be created by annotating a class with the <a href="../api/io/micronaut/management/endpoint/Endpoint.html">Endpoint</a> annotation, and supplying it with (at minimum) an endpoint id.</p>
</div>
<div class="listingblock">
<div class="title">FooEndpoint.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Endpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">FooEndpoint</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a single <code>String</code> argument is supplied to the annotation, it will be used as the endpoint id.</p>
</div>
<div class="paragraph">
<p>It is possible to supply additional (named) arguments to the annotation. Other possible arguments to <code>@Endpoint</code> are described in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Endpoint Arguments</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Endpoint Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint id (or name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(id = "foo")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix used for configuring the endpoint (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(prefix = "foo")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean defaultEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the endpoint is enabled when no configuration is set (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(defaultEnabled = false)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean defaultSensitive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the endpoint is sensitive if no configuration is set (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(defaultSensitive = false)</code></p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_example_of_custom_endpoint">Example of custom Endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following example <code>Endpoint</code> class will create an endpoint accessible at <code>/date</code>:</p>
</div>
<div class="listingblock">
<div class="title">CurrentDateEndpoint.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Endpoint</span>

<span class="annotation">@Endpoint</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>,
        prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">custom</span><span class="delimiter">&quot;</span></span>,
        defaultEnabled = <span class="predefined-constant">true</span>,
        defaultSensitive = <span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">CurrentDateEndpoint</span> {
  <span class="comment">//.. endpoint methods</span>
}</code></pre>
</div>
</div>
</div>
</div>


<h2 id="endpointMethod">12.1.2 Endpoint Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/buildingEndpoints/endpointMethod.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoints respond to <code>GET</code> ("read"), <code>POST</code> ("write") and <code>DELETE</code> ("delete") requests. To return a response from an endpoint, annotate its public method/s with one of following annotations:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Endpoint Method Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/Read.html">Read</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>GET</code> requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/Write.html">Write</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>POST</code> requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/Delete.html">Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>DELETE</code> requests</p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_read_methods">Read Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/Read.html">Read</a> annotation will cause it to respond to <code>GET</code> requests.</p>
</div>
<div class="listingblock">
<div class="title">CurrentDateEndpoint.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Endpoint</span>
<span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Read</span>

<span class="annotation">@Endpoint</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>,
        prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">custom</span><span class="delimiter">&quot;</span></span>,
        defaultEnabled = <span class="predefined-constant">true</span>,
        defaultSensitive = <span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">CurrentDateEndpoint</span> {

    <span class="predefined-type">Date</span> currentDate

    <span class="annotation">@Read</span>
    <span class="predefined-type">Date</span> currentDate() {
        <span class="keyword">return</span> currentDate
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X GET localhost:55838/date

1526085903689</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/Read.html">Read</a> annotation accepts an optional <code>produces</code> argument, which sets the media type returned from the method (default is <code>application/json</code>):</p>
</div>
<div class="listingblock">
<div class="title">CurrentDateEndpoint.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Endpoint</span>
<span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Read</span>

<span class="annotation">@Endpoint</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>,
        prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">custom</span><span class="delimiter">&quot;</span></span>,
        defaultEnabled = <span class="predefined-constant">true</span>,
        defaultSensitive = <span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">CurrentDateEndpoint</span> {

    <span class="predefined-type">Date</span> currentDate

    <span class="annotation">@Read</span>(produces = MediaType.TEXT_PLAIN) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> currentDatePrefix(<span class="predefined-type">String</span> prefix) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>prefix<span class="inline-delimiter">}</span></span><span class="content">: </span><span class="inline"><span class="inline-delimiter">${</span>currentDate<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Supported media types are represented by <a href="../api/io/micronaut/http/MediaType.html">MediaType</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X GET localhost:8080/date/the_date_is

the_date_is: Fri May 11 19:24:21 CDT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_write_methods">Write Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/Write.html">Write</a> annotation will cause it to respond to <code>POST</code> requests.</p>
</div>
<div class="listingblock">
<div class="title">CurrentDateEndpoint.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Endpoint</span>
<span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Write</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.MediaType</span>

<span class="annotation">@Endpoint</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>,
        prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">custom</span><span class="delimiter">&quot;</span></span>,
        defaultEnabled = <span class="predefined-constant">true</span>,
        defaultSensitive = <span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">CurrentDateEndpoint</span> {

    <span class="predefined-type">Date</span> currentDate

    <span class="annotation">@Write</span>
    <span class="predefined-type">String</span> reset() {
        currentDate = <span class="keyword">new</span> <span class="predefined-type">Date</span>()

        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Current date reset</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X POST http://localhost:39357/date

Current date reset</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/Write.html">Write</a> annotation accepts an optional <code>consumes</code> argument, which sets the media type accepted by the method (default is <code>application/json</code>):</p>
</div>
<div class="listingblock">
<div class="title">MessageEndpoint.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Endpoint</span>
<span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Write</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.MediaType</span>

<span class="annotation">@Endpoint</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, defaultSensitive = <span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">MessageEndpoint</span> {

    <span class="predefined-type">String</span> message

    <span class="annotation">@Write</span>(consumes = MediaType.APPLICATION_JSON)
    <span class="predefined-type">String</span> updateMessage(<span class="predefined-type">String</span> newMessage) {  <i class="conum" data-value="1"></i><b>(1)</b>
        message = newMessage

        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Message updated</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X POST http://localhost:65013/message -H 'Content-Type: application/json' -d $'{&quot;newMessage&quot;: &quot;A new message&quot;}'

Message updated</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delete_methods">Delete Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/Delete.html">Delete</a> annotation will cause it to respond to <code>DELETE</code> requests.</p>
</div>
<div class="listingblock">
<div class="title">MessageEndpoint.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Endpoint</span>
<span class="keyword">import</span> <span class="include">io.micronaut.management.endpoint.Delete</span>

<span class="annotation">@Endpoint</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, defaultSensitive = <span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">MessageEndpoint</span> {

    <span class="predefined-type">String</span> message

    <span class="annotation">@Delete</span>
    <span class="predefined-type">String</span> deleteMessage() {
        message = <span class="predefined-constant">null</span>

        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Message deleted</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X DELETE http://localhost:65013/message

Message deleted</code></pre>
</div>
</div>
</div>
</div>


<h2 id="endpointConfiguration">12.1.3 Endpoint Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/buildingEndpoints/endpointConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoints with the <code>endpoints</code> prefix can be configured through their default endpoint id. If an endpoint exists with the id of <code>foo</code>, it can be configured through <code>endpoints.foo</code>. In addition, default values can be provided through the <code>all</code> prefix.</p>
</div>
<div class="paragraph">
<p>For example, consider the following endpoint.</p>
</div>
<div class="listingblock">
<div class="title">FooEndpoint.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Endpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">FooEndpoint</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the endpoint will be enabled. To disable the endpoint, set <code>endpoints.foo.enabled</code> to false. If <code>endpoints.foo.enabled</code> is not set at all and <code>endpoints.all.enabled</code> is set to false, the endpoint will be disabled.</p>
</div>
<div class="paragraph">
<p>The configuration values for the endpoint override the ones for <code>all</code>. If <code>endpoints.foo.enabled</code> is explicitly set to <code>true</code> and <code>endpoints.all.enabled</code> is explicitly set to <code>false</code>, the endpoint will be enabled.</p>
</div>
<div class="paragraph">
<p>For all endpoints, the following configuration values can be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="error">&lt;any endpoint id&gt;:</span>
        <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">sensitive</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">id</span>: <span class="string"><span class="content">String</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the endpoint <code>id</code> is set through configuration, the URL where the endpoint is accessible also changes to reflect the value. For example if the <code>foo</code> endpoint id was changed to <code>bar</code>, the foo endpoint would be executed through <code><a href="http://localhost:&lt;port&gt;/bar" class="bare">http://localhost:&lt;port&gt;/bar</a></code>.</p>
</div>


<h2 id="providedEndpoints">12.2 Built-In Endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/providedEndpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the <code>management</code> dependency is added to your project, the following built-in endpoints are enabled by default:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Default Endpoints</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/beans/BeansEndpoint.html">BeansEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/beans</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the loaded bean definitions in the application (see <a href="#beansEndpoint">BeansEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/info/InfoEndpoint.html">InfoEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns static information from the state of the application (see <a href="#infoEndpoint">InfoEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/health/HealthEndpoint.html">HealthEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the "health" of the application (see <a href="#healthEndpoint">HealthEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/refresh/RefreshEndpoint.html">RefreshEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/refresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refreshes the application state (see <a href="#refreshEndpoint">RefreshEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/routes/RoutesEndpoint.html">RoutesEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/routes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about URIs available to be called for your application (see <a href="#routesEndpoint">RoutesEndpoint</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, the following built-in endpoint(s) are provided by the <code>management</code> dependency but are not enabled by default:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Disabled Endpoints</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/stop/ServerStopEndpoint.html">ServerStopEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shuts down the application server (see <a href="#stopEndpoint">ServerStopEndpoint</a>)</p></td>
</tr>
</tbody>
</table>


<h2 id="beansEndpoint">12.2.1 The Beans Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/providedEndpoints/beansEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The beans endpoint returns information about the loaded bean definitions in the application. The bean data returned by default is an object where the key is the bean definition class name and the value is an object of properties about the bean.</p>
</div>
<div class="paragraph">
<p>To execute the beans endpoint, send a GET request to /beans.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the beans endpoint, supply configuration through <code>endpoints.beans</code>.</p>
</div>
<div class="listingblock">
<div class="title">Beans Endpoint Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">beans</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">sensitive</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">id</span>: <span class="string"><span class="content">String</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The beans endpoint is composed of a bean definition data collector and a bean data implementation. The bean definition data collector (<a href="../api/io/micronaut/management/endpoint/beans/BeanDefinitionDataCollector.html">BeanDefinitionDataCollector</a>) is responsible for returning a publisher that will return the data used in the response. The bean definition data (<a href="../api/io/micronaut/management/endpoint/beans/BeanDefinitionData.html">BeanDefinitionData</a>) is responsible for returning data about an individual bean definition.</p>
</div>
<div class="paragraph">
<p>To override the default behavior for either of the helper classes, either extend the default implementations (<a href="../api/io/micronaut/management/endpoint/beans/impl/RxJavaBeanDefinitionDataCollector.html">RxJavaBeanDefinitionDataCollector</a>, <a href="../api/io/micronaut/management/endpoint/beans/impl/DefaultBeanDefinitionData.html">DefaultBeanDefinitionData</a>), or implement the relevant interface directly. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the default implementation.</p>
</div>
</div>
</div>


<h2 id="infoEndpoint">12.2.2 The Info Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/providedEndpoints/infoEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The info endpoint returns static information from the state of the application. The info exposed can be provided by any number of "info sources".</p>
</div>
<div class="paragraph">
<p>To execute the info endpoint, send a GET request to /info.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the info endpoint, supply configuration through <code>endpoints.info</code>.</p>
</div>
<div class="listingblock">
<div class="title">Info Endpoint Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">info</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">sensitive</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">id</span>: <span class="string"><span class="content">String</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The info endpoint consists of an info aggregator and any number of info sources. To add an info source, simply create a bean class that implements <a href="../api/io/micronaut/management/endpoint/info/InfoSource.html">InfoSource</a>.  If your info source needs to retrieve data from Java properties files, you can extend the <a href="../api/io/micronaut/management/endpoint/info/source/PropertiesInfoSource.html">PropertiesInfoSource</a> interface which provides a helper method for this purpose.</p>
</div>
<div class="paragraph">
<p>All of the info source beans will be collected together with the info aggregator. To provide your own implementation of the info aggregator, create a class that implements <a href="../api/io/micronaut/management/endpoint/info/InfoAggregator.html">InfoAggregator</a> and register it as a bean. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the <a href="../api/io/micronaut/management/endpoint/info/impl/RxInfoAggregator.html">default implementation</a>.</p>
</div>
<div class="paragraph">
<p>The default info aggregator returns map containing the combined properties returned by all the info sources. This map is returned as JSON from the /info endpoint.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provided_info_sources">Provided Info Sources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configuration_info_source">Configuration Info Source</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/info/source/ConfigurationInfoSource.html">ConfigurationInfoSource</a> will return configuration properties under the <code>info</code> key. In addition to string, integer and boolean values, more complex properties can be exposed as maps in the JSON output (if the configuration format supports it).</p>
</div>
<div class="listingblock">
<div class="title">Info Source Example (<code>application.groovy</code>)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">info.demo.string = <span class="string"><span class="delimiter">&quot;</span><span class="content">demo string</span><span class="delimiter">&quot;</span></span>
info.demo.number = <span class="integer">123</span>
info.demo.map = [<span class="key">key</span>: <span class="string"><span class="delimiter">'</span><span class="content">value</span><span class="delimiter">'</span></span>, <span class="key">other_key</span>: <span class="integer">123</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above config will result in the following JSON response from the info endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">demo</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">demo string</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>: <span class="integer">123</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">other_key</span><span class="delimiter">&quot;</span></span>: <span class="integer">123</span>
    }
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2">Configuration</h4>
<div class="paragraph">
<p>The configuration info source can be disabled using the <code>endpoints.info.config.enabled</code> property.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_git_info_source">Git Info Source</h3>
<div class="paragraph">
<p>If a <code>git.properties</code> file is available on the classpath, the <a href="../api/io/micronaut/management/endpoint/info/source/GitInfoSource.html">GitInfoSource</a> will expose the values in that file under the <code>git</code> key. Generating of a <code>git.properties</code> file will need to be configured as part of your build; for example, you may choose to use the Gradle Git Properties plugin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">&quot;</span><span class="content">com.gorylenko.gradle-git-properties</span><span class="delimiter">&quot;</span></span> version <span class="string"><span class="delimiter">&quot;</span><span class="content">1.4.21</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_3">Configuration</h4>
<div class="paragraph">
<p>To specify an alternate path/name of the properties file, you can supply a custom value in the <code>endpoints.info.git.location</code> property.</p>
</div>
<div class="paragraph">
<p>The git info source can be disabled using the <code>endpoints.info.git.enabled</code> property.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_info_source">Build Info Source</h3>
<div class="paragraph">
<p>If a <code>META-INF/build-info.properties</code> file is available on the classpath, the <a href="../api/io/micronaut/management/endpoint/info/source/BuildInfoSource.html">BuildInfoSource</a> will expose the values in that file under the <code>build</code> key. Generating of a <code>build-info.properties</code> file will need to be configured as part of your build.</p>
</div>
<div class="sect3">
<h4 id="_configuration_4">Configuration</h4>
<div class="paragraph">
<p>To specify an alternate path/name of the properties file, you can supply a custom value in the <code>endpoints.info.build.location</code> property.</p>
</div>
<div class="paragraph">
<p>The build info source can be disabled using the <code>endpoints.info.build.enabled</code> property.</p>
</div>
</div>
</div>
</div>
</div>


<h2 id="healthEndpoint">12.2.3 The Health Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/providedEndpoints/healthEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The health endpoint returns information about the "health" of the application. The application health is determined by any number of "health indicators".</p>
</div>
<div class="paragraph">
<p>To execute the health endpoint, send a GET request to /health.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the health endpoint, supply configuration through <code>endpoints.health</code>.</p>
</div>
<div class="listingblock">
<div class="title">Health Endpoint Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">health</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">sensitive</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">id</span>: <span class="string"><span class="content">String</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The health endpoint consists of a health aggregator and any number of health indicators. To add a health indicator, simply create a bean class that implements <a href="../api/io/micronaut/management/health/indicator/HealthIndicator.html">HealthIndicator</a>. A base class <a href="../api/io/micronaut/management/health/indicator/AbstractHealthIndicator.html">AbstractHealthIndicator</a> has been provided for you to extend to make the process easier.</p>
</div>
<div class="paragraph">
<p>All of the health indicator beans will be collected together with the health aggregator. To provide your own implementation of the health aggregator, create a class that implements <a href="../api/io/micronaut/management/health/aggregator/HealthAggregator.html">HealthAggregator</a> and register it as a bean. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the <a href="../api/io/micronaut/management/health/aggregator/RxJavaHealthAggregator.html">default implementation</a>.</p>
</div>
<div class="paragraph">
<p>The default health aggregator returns an overall status that is calculated based on the health statuses of the indicators. A <a href="../api/io/micronaut/health/HealthStatus.html">health status</a> consists of several pieces of information.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the functionality the indicator represents is functional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How severe the status is. A higher number is more severe</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The "worst" status will be returned as the overall status. A non operational status will be selected over an operational status. A higher severity will be selected over a lower severity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provided_indicators">Provided Indicators</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_disk_space">Disk Space</h3>
<div class="paragraph">
<p>A health indicator is provided that determines the health of the application based on the amount of free disk space. Configuration for the disk space health indicator can be provided under the <code>endpoints.health.disk-space</code> key.</p>
</div>
<div class="listingblock">
<div class="title">Disk Space Indicator Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">health</span>:
        <span class="key">disk-space</span>:
            <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
            <span class="key">path</span>: <span class="string"><span class="content">String</span></span> <span class="comment">#The file path used to determine the disk space</span>
            <span class="key">threshold</span>: <span class="string"><span class="content">String | Long</span></span> <span class="comment">#The minimum amount of free space</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The threshold can be provided as a string like "10MB" or "200KB", or the number of bytes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jdbc">JDBC</h3>
<div class="paragraph">
<p>The JDBC health indicator determines the health of your application based on the ability to successfully create connections to datasources in the application context. The only configuration option supported is to enable or disable the indicator by the <code>endpoints.health.jdbc.enabled</code> key.</p>
</div>
</div>
</div>
</div>


<h2 id="refreshEndpoint">12.2.4 The Refresh Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/providedEndpoints/refreshEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The refresh endpoint will refresh the application state, causing all <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">Refreshable</a> beans in the context to be destroyed and reinstantiated upon further requests. This is accomplished by publishing a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> in the Application Context.</p>
</div>
<div class="paragraph">
<p>To execute the refresh endpoint, send a POST request to /refresh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X POST http://localhost:8080/refresh</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executed without a body, the endpoint will first refresh the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> and perform a diff to detect any changes, and will then only perform the refresh if changes are detected. To skip this check and refresh all <code>@Refreshable</code> beans regardless of environment changes (e.g., to force refresh of cached responses from third-party services), you can supply a <code>force</code> parameter in the POST request body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -X POST http://localhost:8080/refresh -H 'Content-Type: application/json' -d '{&quot;force&quot;: true}'</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the refresh endpoint, supply configuration through <code>endpoints.refresh</code>.</p>
</div>
<div class="listingblock">
<div class="title">Beans Endpoint Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">refresh</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">sensitive</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">id</span>: <span class="string"><span class="content">String</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="routesEndpoint">12.2.5 The Routes Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/providedEndpoints/routesEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The routes endpoint returns information about URIs available to be called for your application. By default the data returned includes the URI, allowed method, content types produced, and information about the method that would be executed.</p>
</div>
<div class="paragraph">
<p>To execute the beans endpoint, send a GET request to /routes.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the routes endpoint, supply configuration through <code>endpoints.routes</code>.</p>
</div>
<div class="listingblock">
<div class="title">Routes Endpoint Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">routes</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">sensitive</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">id</span>: <span class="string"><span class="content">String</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The routes endpoint is composed of a route data collector and a route data implementation. The route data collector (<a href="../api/io/micronaut/management/endpoint/routes/RouteDataCollector.html">RouteDataCollector</a>) is responsible for returning a publisher that will return the data used in the response. The route data (<a href="../api/io/micronaut/management/endpoint/routes/RouteData.html">RouteData</a>) is responsible for returning data about an individual route.</p>
</div>
<div class="paragraph">
<p>To override the default behavior for either of the helper classes, either extend the default implementations (<a href="../api/io/micronaut/management/endpoint/routes/impl/RxJavaRouteDataCollector.html">RxJavaRouteDataCollector</a>, <a href="../api/io/micronaut/management/endpoint/routes/impl/DefaultRouteData.html">DefaultRouteData</a>), or implement the relevant interface directly. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the default implementation.</p>
</div>
</div>
</div>


<h2 id="stopEndpoint">12.2.6 The Server Stop Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/management/providedEndpoints/stopEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The stop endpoint shuts down the application server.</p>
</div>
<div class="paragraph">
<p>To execute the stop endpoint, send a POST request to /stop.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the stop endpoint, supply configuration through <code>endpoints.stop</code>.</p>
</div>
<div class="listingblock">
<div class="title">Stop Endpoint Configuration Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">stop</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">sensitive</span>: <span class="string"><span class="content">Boolean</span></span>
        <span class="key">id</span>: <span class="string"><span class="content">String</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the stop endpoint is disabled and needs to be explicitly enabled to be used.
</td>
</tr>
</table>
</div>
</div>
</div>


<h1 id="security">13 Security</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use the Micronaut&#8217;s security capabilities you must have the <code>security</code> dependency on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:security</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable security capabilities enable security:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
    <span class="key">security</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you enable security, Micronaut returns HTTP Status Unauthorized (401) for any endpoint invocation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/secured_by_default.svg" alt="secured by default">
</div>
</div>


<h2 id="authenticationProviders">13.1 Authentication Providers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationProviders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To authenticate users you must provide implementations of <a href="../api/io/micronaut/security/authentication/AuthenticationProvider.html">AuthenticationProvider</a>.</p>
</div>
<div class="paragraph">
<p>The following code snippet illustrates a naive implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AuthenticationProviderUserPassword</span> <span class="directive">implements</span> AuthenticationProvider {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Publisher&lt;AuthenticationResponse&gt; authenticate(AuthenticationRequest authenticationRequest) {
        <span class="keyword">if</span> (authenticationRequest.getIdentity().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>) &amp;&amp; authenticationRequest.getSecret().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">return</span> Flowable.just(<span class="keyword">new</span> UserDetails(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;()));
        }
        <span class="keyword">return</span> Flowable.just(<span class="keyword">new</span> AuthenticationFailed());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The built-in <a href="#login">Login Controller</a> uses every available authentication provider. Authentication strategies, such as basic auth, where the credentials are present in the request use the available authentication providers too.</p>
</div>
<div class="paragraph">
<p>Micronaut ships with <a href="../api/io/micronaut/security/authentication/providers/DelegatingAuthenticationProvider.html">DelegatingAuthenticationProvider</a> which can be typically used
in environments such as the one described in the next diagramm.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/delegating_authentication_provider.svg" alt="delegating authentication provider">
</div>
</div>
<div class="paragraph">
<p><code>DelegatingAuthenticationProvider</code> is not enabled unless you provide implementations for <a href="../api/io/micronaut/security/authentication/providers/UserFetcher.html">UserFetcher</a>,
<a href="../api/io/micronaut/security/authentication/providers/PasswordEncoder.html">PasswordEncoder</a> and  <a href="../api/io/micronaut/security/authentication/providers/AuthoritiesFetcher.html">AuthoritiesFetcher</a></p>
</div>


<h2 id="securityRule">13.2 Security Rules</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/securityRule.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The decision to allow access to a particular endpoint to anonymous or authenticated users is determined by a collection of
Security Rules. Micronaut ships with several built-in security rules. If they don&#8217;t fulfil your needs,
you can implement your own <a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a>.</p>
</div>


<h2 id="ipPattern">13.2.1 IP Pattern Rule</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/securityRule/ipPattern.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you turn on security, traffic coming from any ip address is allowed by default.</p>
</div>
<div class="paragraph">
<p>You can however reject traffic not coming from a white list of IP Patterns as illustrated below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">security</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">ipPatterns</span>:
      - <span class="string"><span class="content">127.0.0.1</span></span>
      - <span class="string"><span class="content">192.168.1.*</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous code, the <a href="../apiio/micronaut/security/rules/IpPatternsRule.html">IpPatternsRule</a> rejects traffic not coming
either <code>127.0.0.1</code> or <code>192.168.1.*</code> range.</p>
</div>


<h2 id="secured">13.2.2 Secured Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/securityRule/secured.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As illustrated below, you can use <a href="../api/io/micronaut/security/Secured.html">Secured</a> annotation to configure
access at <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> or Controller&#8217;s Action level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/example</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Secured</span>(SecurityRule.IS_AUTHENTICATED) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleController</span> {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/admin</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Secured</span>([<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_X</span><span class="delimiter">&quot;</span></span>]) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> withroles() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">You have ROLE_ADMIN or ROLE_X roles</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">'</span><span class="content">/anonymous</span><span class="delimiter">'</span></span>)
    <span class="annotation">@Secured</span>(SecurityRule.IS_ANONYMOUS)  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> anonymous() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">You are anonymous</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/authenticated</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">String</span> authenticated(Authentication authentication) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>authentication.name<span class="inline-delimiter">}</span></span><span class="content"> is authenticated</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Authenticated users are able to access <code>authenticated</code> Controller&#8217;s action.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Users granted role <code>ROLE_ADMIN</code> or <code>ROLE_X</code> roles can access <code>withroles</code> Controller&#8217;s action.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Anonymous users (authenticated and not authenticated users) can access <code>anonymous</code> Controller&#8217;s action.</td>
</tr>
</table>
</div>


<h2 id="interceptUrlMap">13.2.3 Intercept URL Map</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/securityRule/interceptUrlMap.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Moreover, you can configure endpoint authentication and authorization access with an Intercept URL Map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">security</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">interceptUrlMap</span>:
      -
        <span class="key">pattern</span>: <span class="string"><span class="content">/images/*</span></span>
        <span class="key">httpMethod</span>: <span class="string"><span class="content">GET</span></span>
        <span class="key">access</span>:
          - <span class="string"><span class="content">isAnonymous() </span></span><i class="conum" data-value="1"></i><b>(1)</b>
      -
        <span class="key">pattern</span>: <span class="string"><span class="content">/books</span></span>
        <span class="key">access</span>:
          - <span class="string"><span class="content">isAuthenticated() </span></span><i class="conum" data-value="2"></i><b>(2)</b>
      -
        <span class="key">pattern</span>: <span class="string"><span class="content">/books/grails</span></span>
        <span class="key">httpMethod</span>: <span class="string"><span class="content">GET</span></span>
        <span class="key">access</span>:
          - <span class="string"><span class="content">ROLE_GRAILS </span></span><i class="conum" data-value="3"></i><b>(3)</b>
          - <span class="string"><span class="content">ROLE_GROOVY</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable access to authenticated and not authenticated users</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enable access for everyone authenticated</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Enable access for users who are granted any of the specified roles.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you see in the previous code listing, any endpoint is identified by a combination of pattern
and an optional HTTP Method</p>
</div>


<h2 id="builtInEndpointsAccess">13.2.4 Built-In Endpoints Security</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/securityRule/builtInEndpointsAccess.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you turn on security, <a href="#providedEndpoints">Built-in endpoints</a> are secured depending on their sensitive value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
  <span class="key">beans</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">sensitive</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key">info</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">sensitive</span>: <span class="string"><span class="content">false  </span></span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>/beans</code> endpoint is secured</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>/info</code> endpoint is open for unauthenticated access.</td>
</tr>
</table>
</div>


<h2 id="authenticationStrategies">13.3 Authentication Strategies</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="basicAuth">13.3.1 Basic Auth</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/basicAuth.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Out-of-the-box, Micronaut supports <a href="https://tools.ietf.org/html/rfc7617">RFC7617</a> which defines the "Basic" Hypertext Transfer Protocol (HTTP) authentication scheme, which transmits credentials as user-id/password pairs, encoded using Base64.</p>
</div>
<div class="paragraph">
<p>Once you enable Micronaut security, Basic Auth is enabled by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">security</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/basicauth.svg" alt="basicauth">
</div>
</div>
<div class="paragraph">
<p>Below is a sample of a cURL command using basic auth:</p>
</div>
<div class="listingblock">
<div class="title">cURL command using Basic Auth</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl &quot;http://localhost:8080/info&quot; \
     -u 'user:password'</code></pre>
</div>
</div>
<div class="paragraph">
<p>After credentials are read from the HTTP Header, they are feed into an <a href="../api/io/micronaut/security/authentication/Authenticator.html">Authenticator</a>
which attempts to validate them.</p>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize basic authentication behaviour:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.basicAuth.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/basicauth/BasicAuthTokenReader.html">BasicAuthTokenReader</a> is disabled by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.basicAuth.headerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Authorization</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.basicAuth.prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Basic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e.g. <code>Basic dXNlcjp1c2Vy</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the javadoc for <a href="../api/io/micronaut/security/token/basicauth/BasicAuthTokenReaderConfigurationProperties.html">BasicAuthTokenReaderConfigurationProperties</a> for more information.</p>
</div>


<h2 id="session">13.3.2 Session Authentication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/session.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports Session based authentication.</p>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s session based authentication capabilities you must have the <code>security-session</code> dependency on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:security-session</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/sesssion_based_auth.svg" alt="sesssion based auth">
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize session based authentication behaviour:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.session.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session Authentication is disabled by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.session.loginSuccessUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where the user will be redirected ( 303 HTTP Status ) after login.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.session.loginFailureUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where the user will be redirected ( 303 HTTP Status ) after an unsuccessful login attempt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.session.logoutTargetUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where the user will be redirected ( 303 HTTP Status ) after logout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.session.unauthorizedTargetUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where the user will be redirected ( 303 HTTP Status ) after an attempt to a access secured rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.session.forbiddenTargetUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where the user will be redirected ( 303 HTTP Status ) after an attempt to a access secured rule but lacking enough privileges.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="../api/io/micronaut/security/session/SecuritySessionConfigurationProperties.html">SecuritySessionConfigurationProperties</a> javadoc for more information.</p>
</div>
<div class="sect1">
<h2 id="_example_of_session_based_authentication_configuration">Example of Session-Based Authentication configuration</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">security</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">endpoints</span>:
      <span class="key">login</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">logout</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">session</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">loginFailureTargetUrl</span>: <span class="string"><span class="content">/login/authFailed</span></span></code></pre>
</div>
</div>
</div>
</div>


<h2 id="jwt">13.3.3 JSON Web Token</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut ships with security capabilities based on <a href="https://jwt.io/">Json Web Token (JWT)</a>.
JWT is an <a href="https://tools.ietf.org/html/rfc7519">IETF standard</a> which defines a secure way to encapsulate arbitrary data that can be sent over unsecure URLs.</p>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s JWT based authentication capabilities you must have the <code>security-jwt</code> dependency on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:security-jwt</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize JWT based authentication behaviour:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can enable JWT capabilities by enabling this property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.rolesName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default roles claim name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.defaultExpiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access token expiration time in seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.refreshTokenExpiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refresh token expiration time in milliseconds. By default, they don&#8217;t expire.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the javadoc for <a href="../api/io/micronaut/security/token/jwt/config/JwtConfigurationProperties.html">JwtConfigurationProperties</a> and <a href="../api/io/micronaut/security/token/config/TokenConfigurationProperties.html">TokenConfigurationProperties</a> for more information.</p>
</div>
<div class="sect1">
<h2 id="_what_does_a_jwt_look_like">What does a JWT look like?</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/jwt.png" alt="jwt">
</div>
</div>
<div class="sect2">
<h3 id="_header">Header</h3>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">JWT header</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">alg</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">HS256</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">typ</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">JWT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_claims">Claims</h3>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">JWT claims</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">exp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1422990129</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">sub</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jimi</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_ADMIN</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">iat</span><span class="delimiter">&quot;</span></span>: <span class="integer">1422986529</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_signature">Signature</h3>
<div class="paragraph">
<p>Depends on the algorithm specified on the header, it can be a digital signature of the base64-encoded header and claims, or an encryption of them.</p>
</div>
</div>
</div>
</div>


<h2 id="reader">13.3.3.1 Reading JWT Token</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/reader.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="bearerToken">13.3.3.1.1 Bearer Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/reader/bearerToken.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports <a href="https://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> specification out-of-the-box.</p>
</div>
<div class="paragraph">
<p>It is enabled by default but requires JWT Authentication to be enabled.</p>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/jwt-bearer-token.svg" alt="jwt bearer token">
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize Bearer Token read:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.bearer.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/bearer/BearerTokenReader.html">BearerTokenReader</a> is enabled by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.bearer.headerName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Authorization</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.bearer.prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bearer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e.g. <code>Bearer XXXXXXXXXXX</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the javadoc for <a href="../api/io/micronaut/security/token/jwt/bearer/BearerTokenConfigurationProperties.html">BearerTokenConfigurationProperties</a> for more information.</p>
</div>
<div class="sect1">
<h2 id="_sending_tokens_in_the_request">Sending tokens in the request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following code snippet illustrates how to send a JWT token in the <code>Authorization</code> request header:</p>
</div>
<div class="listingblock">
<div class="title">Accessing a protected resource using Authorization request header</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">GET /protectedResource HTTP/1.1
Host: micronaut.example
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o</code></pre>
</div>
</div>
</div>
</div>


<h2 id="cookieToken">13.3.3.1.2 Cookie Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/reader/cookieToken.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can send/read a JWT token from a Cookie too.</p>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/jwt-cookie.svg" alt="jwt cookie">
</div>
</div>
<div class="paragraph">
<p>Reading tokens from Cookies is disabled by default. Note that using JWT tokens from cookies requires JWT Authentication to be enabled.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.cookieName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JWT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cookie name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.logoutTargetUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String to be parsed into a URI which represents where the user is redirected to after logout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.loginSuccessTargetUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String to be parsed into a URI which represents where the user is redirected to after a successful login.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.loginFailureTargetUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String to be parsed into a URI which represents where the user is redirected to after a failed login.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the javadoc for <a href="../api/io/micronaut/security/token/jwt/cookie/JwtCookieConfigurationProperties.html">JwtCookieConfigurationProperties</a> for more information.</p>
</div>


<h2 id="jwtGenerator">13.3.3.2 JWT Token Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/jwtGenerator.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut relies on <a href="https://connect2id.com/products/nimbus-jose-jwt">Nimbus JOSE + JWT</a> library to provide JWT token signature and encryption.</p>
</div>


<h2 id="jwtGeneratorSignature">13.3.3.2.1 JWT Signature</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/jwtGenerator/jwtGeneratorSignature.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut security capabilities use signed JWTs as specified by the
<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature</a> specification.</p>
</div>
<div class="paragraph">
<p>To enable a JWT signature in token generation, you need to have in your app a bean of type <a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureConfiguration.html">RSASignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureConfiguration.html">ECSignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> qualified with name <code>generator</code>.</p>
</div>
<div class="paragraph">
<p>You can setup a <code>SecretSignatureConfiguration</code> named <code>generator</code> easily via configuration properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">security</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">token</span>:
      <span class="key">jwt</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">signatures</span>:
          <span class="key">secret</span>:
            <span class="key">generator</span>:
              <span class="key">secret</span>: <span class="string"><span class="content">pleaseChangeThisSecretForANewOne </span></span><i class="conum" data-value="1"></i><b>(1)</b>
              <span class="key">jwsAlgorithm</span>: <span class="string"><span class="content">HS256 </span></span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>Change this for your own secret and keep it safe</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Json Web Token Signature name. In this example, HMAC using SHA-256 hash algorithm.</td>
</tr>
</table>
</div>


<h2 id="jwtGeneratorEncryption">13.3.3.2.2 Encrypted JWTs</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/jwtGenerator/jwtGeneratorEncryption.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Signed claims prevents an attacker to tamper its contents to introduce malicious data or try a privilege escalation by adding more roles. However, the claims can be decoded just by using Base 64.</p>
</div>
<div class="paragraph">
<p>If the claims contains sensitive information, you can use a JSON Web Encryption algorithm to prevent them to be decoded.</p>
</div>
<div class="paragraph">
<p>To enable a JWT encryption in token generation, you need to have in your app a bean of type  <a href="../api/io/micronaut/security/token/jwt/encryption/rsa/RSAEncryptionConfiguration.html">RSAEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/ec/ECEncryptionConfiguration.html">ECEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/secret/SecretEncryptionConfiguration.html">SecretEncryptionConfiguration</a> qualified with name <code>generator</code>.</p>
</div>
<div class="sect1">
<h2 id="_example_of_jwt_signed_with_secret_and_encrypted_with_rsa">Example of JWT Signed with Secret and Encrypted with RSA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Setup a <a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> through configuration properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">micronaut</span>:
  <span class="key">security</span>:
    <span class="key">enabled</span>: <span class="predefined-constant">true</span>
    <span class="key">token</span>:
      <span class="key">jwt</span>:
        <span class="key">enabled</span>: <span class="predefined-constant">true</span>
        <span class="key">signatures</span>:
          <span class="key">secret</span>:
            <span class="key">generator</span>:
              <span class="key">secret</span>: qrD6h8K6S9503Q06Y6Rfk21TErImPYqa <i class="conum" data-value="1"></i><b>(1)</b>
<span class="key">pem</span>:
  <span class="key">path</span>: <span class="regexp"><span class="delimiter">/</span><span class="content">home</span><span class="delimiter">/</span></span>user/rsa-<span class="integer">2048</span>bit-key-pair.pem <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name the Signature configuration <code>generator</code> to make it participate in JWT token generation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Location of PEM file</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Generate a 2048-bit RSA private + public key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openssl genrsa -out rsa-2048bit-key-pair.pem 2048</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">generator</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Singleton</span>
<span class="type">class</span> <span class="class">RSAOAEPEncryptionConfiguration</span> <span class="directive">implements</span> RSAEncryptionConfiguration {

    <span class="directive">private</span> <span class="predefined-type">RSAPrivateKey</span> rsaPrivateKey
    <span class="directive">private</span> <span class="predefined-type">RSAPublicKey</span> rsaPublicKey
    JWEAlgorithm jweAlgorithm = JWEAlgorithm.RSA_OAEP_256
    EncryptionMethod encryptionMethod = EncryptionMethod.A128GCM

    RSAOAEPEncryptionConfiguration(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">'</span><span class="content">${pem.path}</span><span class="delimiter">'</span></span>) <span class="predefined-type">String</span> pemPath) {
        Optional&lt;<span class="predefined-type">KeyPair</span>&gt; keyPair = KeyPairProvider.keyPair(pemPath)
        <span class="keyword">if</span> (keyPair.isPresent()) {
            <span class="local-variable">this</span>.rsaPublicKey = (<span class="predefined-type">RSAPublicKey</span>) keyPair.get().getPublic()
            <span class="local-variable">this</span>.rsaPrivateKey = (<span class="predefined-type">RSAPrivateKey</span>) keyPair.get().getPrivate()
        }
    }

    <span class="annotation">@Override</span>
    <span class="predefined-type">RSAPublicKey</span> getPublicKey() {
        <span class="keyword">return</span> rsaPublicKey
    }

    <span class="annotation">@Override</span>
    <span class="predefined-type">RSAPrivateKey</span> getPrivateKey() {
        <span class="keyword">return</span> rsaPrivateKey
    }

    <span class="annotation">@Override</span>
    JWEAlgorithm getJweAlgorithm() {
        <span class="keyword">return</span> jweAlgorithm
    }

    <span class="annotation">@Override</span>
    EncryptionMethod getEncryptionMethod() {
        <span class="keyword">return</span> encryptionMethod
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name Bean <code>generator</code> to designate this bean as participant in the JWT Token Generation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To parse the PEM key, use a collaborator as described in <a href="https://connect2id.com/products/nimbus-jose-jwt/openssl-key-generation">OpenSSL key generation</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Slf4j</span>
<span class="type">class</span> <span class="class">KeyPairProvider</span> {
    <span class="comment">/**
     *
     * @param pemPath Full path to PEM file.
     * @return returns KeyPair if successfully for PEM files.
     */</span>
    <span class="directive">static</span> Optional&lt;<span class="predefined-type">KeyPair</span>&gt; keyPair(<span class="predefined-type">String</span> pemPath) {
        <span class="comment">// Load BouncyCastle as JCA provider</span>
        <span class="predefined-type">Security</span>.addProvider(<span class="keyword">new</span> BouncyCastleProvider())

        <span class="comment">// Parse the EC key pair</span>
        PEMParser pemParser
        <span class="keyword">try</span> {
            pemParser = <span class="keyword">new</span> PEMParser(<span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(<span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(pemPath)))
            PEMKeyPair pemKeyPair = (PEMKeyPair) pemParser.readObject()

            <span class="comment">// Convert to Java (JCA) format</span>
            JcaPEMKeyConverter converter = <span class="keyword">new</span> JcaPEMKeyConverter()
            <span class="predefined-type">KeyPair</span> keyPair = converter.getKeyPair(pemKeyPair)
            pemParser.close()

            <span class="keyword">return</span> Optional.of(keyPair)

        } <span class="keyword">catch</span> (<span class="exception">FileNotFoundException</span> e) {
            log.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">file not found: {}</span><span class="delimiter">&quot;</span></span>, pemPath)

        } <span class="keyword">catch</span> (PEMException e) {
            log.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">PEMException {}</span><span class="delimiter">&quot;</span></span>, e.getMessage())

        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            log.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">IOException {}</span><span class="delimiter">&quot;</span></span>, e.getMessage())
        }
        <span class="keyword">return</span> Optional.empty()
    }
}</code></pre>
</div>
</div>
</div>
</div>


<h2 id="jwtValidation">13.3.3.3 JWT Token Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/jwtValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s JWT validation support multiple Signature and Encryption configurations.</p>
</div>
<div class="paragraph">
<p>Any beans of type <a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureConfiguration.html">RSASignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureConfiguration.html">ECSignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a>
participate as signature configurations in the JWT validation.</p>
</div>
<div class="paragraph">
<p>Any beans of type <a href="../api/io/micronaut/security/token/jwt/encryption/rsa/RSAEncryptionConfiguration.html">RSAEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/ec/ECEncryptionConfiguration.html">ECEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/secret/SecretEncryptionConfiguration.html">SecretEncryptionConfiguration</a> participate as encryption configurations in the JWT validation.</p>
</div>


<h2 id="claimsGeneration">13.3.3.4 Claims Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/claimsGeneration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If the built-in
<a href="../api/io/micronaut/security/token/jwt/generator/claims/JWTClaimsSetGenerator.html">JWTClaimsSetGenerator</a>, does not
fulfil your needs you can provide your own <a href="#replaces">replacement</a> of <a href="../api/io/micronaut/security/token/jwt/generator/claims/ClaimsGenerator.html">ClaimsGenerator</a>.</p>
</div>


<h2 id="render">13.3.3.5 Token Render</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/authenticationStrategies/jwt/render.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you use JWT authentication and the built-in <a href="#login">LoginController</a>,
the JWT tokens are returned to the client as part of an OAuth 2.0 <a href="https://tools.ietf.org/html/RFC6749">RFC6749</a> access token response.</p>
</div>
<div class="paragraph">
<p>An example of such a response is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="error">H</span><span class="error">T</span><span class="error">T</span><span class="error">P</span><span class="error">/</span><span class="float">1.1</span> <span class="integer">200</span> <span class="error">O</span><span class="error">K</span>
<span class="error">C</span><span class="error">o</span><span class="error">n</span><span class="error">t</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">-</span><span class="error">T</span><span class="error">y</span><span class="error">p</span><span class="error">e</span>: <span class="error">a</span><span class="error">p</span><span class="error">p</span><span class="error">l</span><span class="error">i</span><span class="error">c</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">/</span><span class="error">j</span><span class="error">s</span><span class="error">o</span><span class="error">n</span><span class="error">;</span><span class="error">c</span><span class="error">h</span><span class="error">a</span><span class="error">r</span><span class="error">s</span><span class="error">e</span><span class="error">t</span><span class="error">=</span><span class="error">U</span><span class="error">T</span><span class="error">F</span><span class="integer">-8</span>
<span class="error">C</span><span class="error">a</span><span class="error">c</span><span class="error">h</span><span class="error">e</span><span class="error">-</span><span class="error">C</span><span class="error">o</span><span class="error">n</span><span class="error">t</span><span class="error">r</span><span class="error">o</span><span class="error">l</span>: <span class="error">n</span><span class="error">o</span><span class="error">-</span><span class="error">s</span><span class="error">t</span><span class="error">o</span><span class="error">r</span><span class="error">e</span>
<span class="error">P</span><span class="error">r</span><span class="error">a</span><span class="error">g</span><span class="error">m</span><span class="error">a</span>: <span class="error">n</span><span class="error">o</span><span class="error">-</span><span class="error">c</span><span class="error">a</span><span class="error">c</span><span class="error">h</span><span class="error">e</span>
{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiJ9...</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">expires_in</span><span class="delimiter">&quot;</span></span>:<span class="integer">3600</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">tGzv3JOkF0XG5Qx2TlKWIA...</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">euler</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_USER</span><span class="delimiter">&quot;</span></span>
    ],
}</code></pre>
</div>
</div>


<h2 id="endpoints">13.4 Built-In Security Controllers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/endpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="login">13.4.1 Login Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/endpoints/login.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can enable <code>LoginController</code> with configuration property:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Possible Values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.login.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.login.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/login</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default path for <code>POST</code> requests.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The response of the Login Endpoint is handled by a bean instance of <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a>.</p>
</div>
<div class="sect1">
<h2 id="_login_endpoint_invocation_example">Login Endpoint invocation example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Login Endpoint invocation example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X &quot;POST&quot; &quot;http://localhost:8080/login&quot; \
     -H 'Content-Type: application/json; charset=utf-8' \
     -d $'{
  &quot;username&quot;: &quot;euler&quot;,
  &quot;password&quot;: &quot;password&quot;
}'</code></pre>
</div>
</div>
</div>
</div>


<h2 id="logout">13.4.2 Logout Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/endpoints/logout.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can enable <code>LogoutController</code> with configuration property:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Possible Values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.logout.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.logout.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/logout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default path for <code>POST</code> requests.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each bean of type <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a> gets invoked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using JWT authentication, you may not need to invoke the <code>/logout</code> endpoint. Since logging out normally means simply deleting access, refresh JWT tokens at the client side.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_logout_endpoint_invocation_example">Logout Endpoint invocation example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Login Endpoint invocation example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X &quot;POST&quot; &quot;http://localhost:8080/logout&quot;</code></pre>
</div>
</div>
</div>
</div>


<h2 id="refresh">13.4.3 Refresh Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/endpoints/refresh.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This controller can only be enabled if you are using JWT authentication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, issued access tokens expire after a period of time, and they are paired with refresh tokens. To
ease the refresh, you can enable <a href="../api/io/micronaut/security/token/jwt/endpoints/OauthController.html">OauthController</a>, with configuration property:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Possible Values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.oauth.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> or <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.oauth.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/oauth/access_token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default path for <code>POST</code> requests.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The controller exposes an endpoint as defined by <a href="https://tools.ietf.org/html/rfc6749#section-6">section 6 of the OAuth 2.0 spec</a> - Refreshing an Access Token.</p>
</div>
<div class="paragraph">
<p>By default, issued Refresh tokens never expire, and can be used to obtain a new access token by sending a POST request to the <code>/oauth/access_token</code> endpoint:</p>
</div>
<div class="listingblock">
<div class="title">Sample HTTP request to obtain an access token</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">POST /myApp/oauth/access_token HTTP/1.1
Host: micronaut.example
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&amp;refresh_token=eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, is a form request with 2 parameters:</p>
</div>
<div class="paragraph">
<p><code>grant_type</code>: must be <code>refresh_token</code> always.</p>
</div>
<div class="paragraph">
<p><code>refresh_token</code>: the refresh token obtained previously.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default refresh tokens never expire, they must be securely stored in your client application.
See <a href="https://tools.ietf.org/html/rfc6749#section-10.4">section 10.4 of the OAuth 2.0 spec</a> for more information.
</td>
</tr>
</table>
</div>


<h2 id="securityEvents">13.5 Security Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/security/securityEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut security classes generate several <a href="../api/io/micronaut/context/event/ApplicationEvent.html">ApplicationEvent</a>s which you can subscribe to.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/LoginFailedEvent.html">LoginFailedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when an unsuccessful login takes place.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/LoginSuccessfulEvent.html">LoginSuccessfulEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a successful login takes place.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/LogoutEvent.html">LogoutEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when the user logs out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/TokenValidatedEvent.html">TokenValidatedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a token is validated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/event/AccessTokenGeneratedEvent.html">AccessTokenGeneratedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a JWT access token is generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/event/RefreshTokenGeneratedEvent.html">RefreshTokenGeneratedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a JWT refresh token is generated.</p></td>
</tr>
</tbody>
</table>


<h1 id="cli">14 Micronaut CLI</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cli.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut CLI is the recommended way to create new Micronaut projects. The CLI includes commands for generating specific categories of projects, allowing you to choose between build tools, test frameworks, and even pick the language you wish to use in your application. The CLI also provides commands for generating artifacts such as controllers, client interfaces, and serverless functions.</p>
</div>
<div class="paragraph">
<p>When Micronaut is installed on your computer, you can call the CLI with the <code>mn</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-app my-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Micronaut CLI project can be identified by the <code>micronaut-cli.yml</code> file, which will be included at the root of the project (if it was generated via the CLI). This file will include the project&#8217;s profile, default package, and other variables. The project&#8217;s default package is evaluated based on the project name, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-app my-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will result in the following <code>micronaut-cli-yml</code>.</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">profile</span>: <span class="string"><span class="content">service</span></span>
<span class="key">defaultPackage</span>: <span class="string"><span class="content">my.demo.app</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">testFramework</span>: <span class="string"><span class="content">junit</span></span>
<span class="key">sourceLanguage</span>: <span class="string"><span class="content">java</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can supply your own default package when creating the application by prefixing the application name with the package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-app example.my-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will result in the following <code>micronaut-cli-yml</code>.</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">profile</span>: <span class="string"><span class="content">service</span></span>
<span class="key">defaultPackage</span>: <span class="string"><span class="content">example</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">testFramework</span>: <span class="string"><span class="content">junit</span></span>
<span class="key">sourceLanguage</span>: <span class="string"><span class="content">java</span></span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Throughout the user guide, references to CLI features/commands have been provided as applicable.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_definitions">Definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Projects created with the CLI are based on one of several <strong>profiles</strong>, which consist of a project template (or <strong>skeleton</strong>), optional features, and profile-specific commands. Commands from a profile typically are specific to the profile application type; for example, the <code>service</code> profile (designed for creation of web service applications) provides the <code>create-controller</code> and <code>create-client</code> commands.</p>
</div>
<div class="paragraph">
<p>CLI commands typically accept at least one <strong>argument</strong>, such as the name of the project or controller to generate.</p>
</div>
<div class="paragraph">
<p>CLI commands can accept optional <strong>flags</strong> to control their behavior. Some flags accept multiple arguments, which are separated by commas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interactive_mode">Interactive Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you run <code>mn</code> without any arguments, the Micronaut CLI will launch in interactive mode. This is a shell-like mode which allows you to run multiple CLI commands without re-initializing the CLI runtime, and is especially suitable when you are making use of code-generation commands (such as <code>create-controller</code>), creating multiple projects, or simply exploring the features included in the CLI. Tab-completion is enabled in the CLI, enabling you to hit the <code>TAB</code> key to see possible options for a given command or flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_help_and_info">Help and Info</h2>
<div class="sectionbody">
<div class="paragraph">
<p>General usage information can be viewed using the <code>help</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; help
Usage (optionals marked with *):'
mn [target] [arguments]*'

| Examples:
$ mn create-app my-app
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details about a specific command, supply the command name after the <code>help</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; help create-app
| Command: create-app
| Description:
Creates an application

| Usage:
create-app [NAME]
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A list of available profiles can be viewed using the <code>list-profiles</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; list-profiles
| Available Profiles
--------------------
* function-aws - The function profile for AWS Lambda
* service-function - The function profile
* function - The function profile
* federation - The federation profile
* service - The service profile
* base - The base profile</code></pre>
</div>
</div>
<div class="paragraph">
<p>To view details on a specific profile, use the <code>profile-info</code> command, followed by the profile name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; profile-info service
Profile: service
--------------------
The service profile

Provided Commands:
--------------------
* help - Prints help information for a specific command
* create-job - Creates a job with scheduled method
* create-bean - Creates a singleton bean
* create-controller - Creates a controller and associated test
* create-client - Creates a client interface

Provided Features:
--------------------
* discovery-consul - Adds support for Service Discovery with Consul (https://www.consul.io)
* hibernate-jpa - Adds support for Hibernate/JPA
* mongo-gorm - Configures GORM for MongoDB for Groovy applications
...</code></pre>
</div>
</div>
</div>
</div>


<h2 id="createProject">14.1 Creating a Project</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cli/createProject.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Creating a project is the primary usage of the CLI. There are two primary commands for creating new projects: <code>create-app</code> and <code>create-function</code>. Both of these commands will generate a project based upon an associated profile (which can be overridden), and will set the <code>micronaut.application.name</code> configuration property in <code>src/main/resources/application.yml</code>.</p>
</div>
<div class="paragraph">
<p>In addition, there are specialty commands for creating a "federation" of multiple Micronaut services (<code>create-federation</code>) and for creating new profiles for the CLI (<code>create-profile</code>).</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut CLI Project Creation Commands</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Arguments</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a basic Micronaut application, using the <code>service</code> profile by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code>, <code>features</code>, <code>build</code>, <code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mn create-app my-project -features mongo-reactive,security-jwt  -build maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-function</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut serverless function, using the <code>function-aws</code> profile by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>provider</code>, <code>lang</code>, <code>test</code>, <code>features</code>, <code>build</code>, <code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mn create-function my-lambda-function -lang groovy -test spock</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-federation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a federation of Micronaut services with shared profile/features.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>services</code>, <code>profile</code>, <code>features</code>, <code>build</code>, <code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mn create-federation my-federation -services users,inventory,billing</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut profile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code>, <code>features</code>, <code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mn create-profile security-service -profile service -features security-jwt</code></p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_create_app">Create-App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-app</code> command will generate a basic Micronaut project, with optional flags to specify features, profile, and build tool. The project will include a default <code>Application</code> class for starting the application.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Create-App Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build tool (one of <code>gradle</code>, <code>maven</code> - default is <code>gradle</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-build maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile to use for the project (default is <code>service</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-profile function-aws</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>features</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features to use for the project, comma-separated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-features security-jwt,mongo-gorm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, generates the project in the current directory (project name is optional if this flag is set)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-inplace</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once created, the application can be started using the <code>Application</code> class, or the appropriate build tool task.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Gradle project</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Starting a Maven project</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./mvnw compile exec:exec</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_language_test_features">Language/Test Features</h3>
<div class="paragraph">
<p>By default, <code>create-app</code> will generate a Java application, with JUnit configured as the test framework. The language and test framework settings for a given project are stored as the <code>testFramework</code> and <code>sourceLanguage</code> properties in the <code>micronaut-cli.yml</code> file, as shown below:</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">profile</span>: <span class="string"><span class="content">service</span></span>
<span class="key">defaultPackage</span>: <span class="string"><span class="content">my.demo.app</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">testFramework</span>: <span class="string"><span class="content">junit</span></span>
<span class="key">sourceLanguage</span>: <span class="string"><span class="content">java</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The values in <code>micronaut-cli.yml</code> are used by the CLI for code generation purposes. After a project has been generated, you can edit these values to change the project defaults, however you will still need to supply the required dependencies and/or configuration in order to use your chosen language/framework. E.g, you could edit the <code>testFramework</code> property to <code>spock</code> to cause the CLI to generate Spock tests when running commands (such as <code>create-controller</code>), but you will still need to add the Spock dependency to your project.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_groovy">Groovy</h4>
<div class="paragraph">
<p>To create an app with Groovy &amp; Spock support, supply the appropriate features via the <code>feature</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; create-app my-groovy-app -features groovy, spock</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will include the Groovy &amp; Spock dependencies in your project, and write the appropriates values in <code>micronaut-cli.yml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kotlin">Kotlin</h4>
<div class="paragraph">
<p>To create an app with Kotlin &amp; Spek support, supply the appropriate features via the <code>feature</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; create-app my-groovy-app -features kotlin, spek</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will include the Kotlin &amp; Spek dependencies in your project, and write the appropriates values in <code>micronaut-cli.yml</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_tool">Build Tool</h3>
<div class="paragraph">
<p>By default <code>create-app</code> will create a Gradle project, with a <code>build.gradle</code> file at the root of the project directory. To create an app using the Maven build tool, supply the appropriate option via the <code>build</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; create-app my-maven-app -build maven</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_function">Create-Function</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-function</code> command will generate a <a href="#serverlessFunctions">Micronaut function</a> project, optimized for serverless environments, with optional flags to specify language, test framework, features and build tool. The project will include a <code>*Function</code> class (based on the project name - e.g., <code>hello-world</code> will generate <code>HelloWorldFunction</code>), and an associated test which will instantiate the function and verify that it can receive requests.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Currently AWS Lambda is the only supported cloud provider for Micronaut functions, so some of the information below will be specific to that platform. Other cloud providers will be added soon and this section will be updated accordingly.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Create-Function Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language to use for the function (one of <code>java</code>, <code>groovy</code>, <code>kotlin</code> - default is <code>java</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test framework to use for the function (one of <code>junit</code>, <code>spock</code> - default is <code>junit</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-test spock</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build tool (one of <code>gradle</code>, <code>maven</code> - default is <code>gradle</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-build maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>features</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features to use for the function, comma-separated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-features security-jwt,mongo-gorm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>provider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provider to use for the function (currently the only supported provider is <code>aws</code> for AWS Lambda - this is the default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-provider aws</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, generates the function in the current directory (function name is optional if this flag is set)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-inplace</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_language">Language</h3>
<div class="paragraph">
<p>Setting the language using the <code>lang</code> flag will generate a <code>*Function</code> file in the appropriate language. For Java/Kotlin, this will generate a class annotated with <a href="../api/io/micronaut/function/FunctionBean.html">@FunctionBean</a>. For Groovy, a Groovy function script will be generated. See <a href="#writingFunctions">Writing Functions</a> for more details on how to write and test Micronaut functions.</p>
</div>
<div class="paragraph">
<p>Depending on language choice, an appropriate test will also be generated. By default, a Java function will include a JUnit test, a Groovy function will include a Spock test, and a Kotlin function will include a Spek test. However, you can override the chosen test framework with the <code>test</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-function hello-world -lang java -test spock</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_tool_2">Build Tool</h3>
<div class="paragraph">
<p>Depending upon the build tool selected, the project will include various tasks for building/deploying the function.</p>
</div>
<div class="sect3">
<h4 id="_gradle">Gradle</h4>
<div class="paragraph">
<p>Functions with a Gradle build are preconfigured with the <a href="https://github.com/classmethod/gradle-aws-plugin">Gradle AWS Plugin</a>. The configuration can be seen in the <code>build.gradle</code> file (see the section on <a href="#lambdaFunctions">Deploying Functions to AWS Lambda</a>). Assuming valid AWS credentials under <code>~/.aws/credentials</code>, the application can be deployed using the <code>deploy</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew deploy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven">Maven</h4>
<div class="paragraph">
<p>Functions with a Maven build are preconfigured with the <a href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven Shade Plugin</a>, which will generate an executable JAR suitable for uploading to AWS Lambda. The JAR file can be built using the <code>package</code> phase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./mvnw package</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further details, consult the <a href="https://docs.aws.amazon.com/lambda/latest/dg/java-create-jar-pkg-maven-no-ide.html">AWS Lambda Documentation.</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_federation">Create-Federation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-federation</code> command accepts the same flags as the <code>create-app</code> command, and follows mostly the same behavior. The key difference is that this command accepts multiple project names following the <code>services</code> flag, and will generate a project (with the specified profile and features) for each name supplied. The <code>[NAME]</code> argument will be used to create the top-level multi-project build for the federation.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Create-Federation Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>services</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of services (applications) to create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-services users,inventory,billing</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build tool (one of <code>gradle</code>, <code>maven</code> - default is <code>gradle</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-build maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile to use for all projects in the federation (default is <code>service</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-profile function-aws</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>features</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features to use for all projects in the federation, comma-separated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-features security-jwt,mongo-gorm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, generates the project in the current directory (project name is optional if this flag is set)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-inplace</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When creating a federation, a top-level project file will be generated (using the chosen build tool), and subprojects/modules will be created for each service in the federation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_profile">Create-Profile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-profile</code> command is used to generate new profiles for the Micronaut CLI.</p>
</div>
</div>
</div>


<h2 id="profiles">14.2 Profiles</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cli/profiles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Profiles are essentially project templates, consisting of a "skeleton" project structure with default configuration, build dependencies and other assets, along with a set of commands for generating appropriate artifacts (such as controllers, client interfaces, etc).</p>
</div>
<div class="paragraph">
<p>Profiles can inherit from other profiles, augmenting/overriding defaults set in their parent. All profiles inherit from the <code>base</code> profile, which provides the bare minimum required to set up a Micronaut application. Most Micronaut apps (including projects generated by the <code>create-app</code> command) will use the <code>service</code> profile, which augments the <code>base</code> profile to add HTTP client/server libraries, <code>create-controller</code> and <code>create-client</code> commands, and other features that are appropriate for web service applications.</p>
</div>
<div class="paragraph">
<p>Profiles can be chosen using the <code>profile</code> flag on the <code>create-app</code> &amp; <code>create-federation</code> commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-app my-project</code></pre>
</div>
</div>


<h2 id="features">14.3 Features</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cli/features.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Features consist of additional dependencies and configuration to enable specific functionality in your application. The Micronaut profiles define a large number of features, including features for many of the configurations provided by Micronaut, such as the <a href="#dataAccess">Data Access Configurations</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-app my-demo-app -features mongo-reactive</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add the necessary dependencies and configuration for the <a href="http://mongodb.github.io/mongo-java-driver-reactivestreams">MongoDB Reactive Driver</a> in your application. You can view all the available features using the <code>profile-info</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn profile-info service
Profile: service
--------------------
The service profile

...

Provided Features:
--------------------
* discovery-consul - Adds support for Service Discovery with Consul (https://www.consul.io)
* hibernate-jpa - Adds support for Hibernate/JPA
* mongo-gorm - Configures GORM for MongoDB for Groovy applications
* mongo-reactive - Adds support for the Mongo Reactive Streams Driver
* neo4j-gorm - Configures GORM for Neo4j for Groovy applications
* config-consul - Adds support for Distributed Configuration with Consul (https://www.consul.io)
* http-server - Adds support for running a Netty server
* neo4j-bolt - Adds support for the Neo4j Bolt Driver
* tracing-jaeger - Adds support for distributed tracing with Jaeger (https://www.jaegertracing.io)
* security-jwt - Adds support for JWT (JSON Web Token) based Authentication
* junit - Adds support for the JUnit testing framework
* hibernate-gorm - Adds support for GORM persistence framework
* java - Adds support for Java in the application
* kotlin - Adds support for Kotlin in the application
* spek - Adds support for the Spek testing framewokr
* redis-lettuce - Configures the Lettuce driver for Redis
* jdbc-hikari - Configures SQL DataSource instances using Hikari Connection Pool
* jdbc-tomcat - Configures SQL DataSource instances using Tomcat Connection Pool
* discovery-eureka - Adds support for Service Discovery with Eureka
* http-client - Adds support for creating HTTP clients
* jdbc-dbcp - Configures SQL DataSource instances using Commons DBCP
* spock - Adds support for the Spock testing framework
* groovy - Adds support for Groovy in the application
* security-session - Adds support for Session based Authentication
* tracing-zipkin - Adds support for distributed tracing with Zipkin (https://zipkin.io)</code></pre>
</div>
</div>


<h2 id="commands">14.4 Commands</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/cli/commands.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Profiles can include commands for generating common code artifacts. Not all commands are supported by all profiles; the available commands for a given profile can be viewed using the <code>profile-info</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn&gt; profile-info service
Profile: service
--------------------
The service profile

Provided Commands:
--------------------
* help - Prints help information for a specific command
* create-job - Creates a job with scheduled method
* create-bean - Creates a singleton bean
* create-controller - Creates a controller and associated test
* create-client - Creates a client interface

Provided Features:
--------------------
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the code-generation commands will honor the values written in <code>micronaut-cli.yml</code>. For example, assume the following <code>micronaut-cli.yml</code> file.</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">profile</span>: <span class="string"><span class="content">service</span></span>
<span class="key">defaultPackage</span>: <span class="string"><span class="content">example</span></span>
<span class="head"><span class="head">---</span></span>
<span class="key">testFramework</span>: <span class="string"><span class="content">java</span></span>
<span class="key">sourceLanguage</span>: <span class="string"><span class="content">spock</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above settings, the <code>create-controller</code> command will (by default) generate Java controllers with an associated Spock test, under the <code>example</code> package. Commands accept arguments and these defaults can be overriden on a per-command basis.</p>
</div>
<div class="sect1">
<h2 id="_base_profile_commands">Base Profile Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Commands in the base profile are inherited by all other profiles and are always available.</p>
</div>
<div class="sect2">
<h3 id="_create_bean">Create-Bean</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Create-Bean Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the bean class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-bean</code> command generates a simple <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">Singleton</a> class. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-bean EmailService
| Rendered template Bean.java to destination src/main/java/example/EmailService.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_job">Create-Job</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Create-Job Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the job class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-job</code> command generates a simple <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> class. It follows a <code>*Job</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-job UpdateFeeds -lang groovy
| Rendered template Job.groovy to destination src/main/groovy/example/UpdateFeedsJob.groovy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_profile_commands">Service Profile Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The service profile includes commands that are dependent upon the HTTP server and client dependencies (which are not included in the base profile).</p>
</div>
<div class="sect2">
<h3 id="_create_controller">Create-Controller</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Create-Controller Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-controller</code> command generates a <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> class. It follows a <code>*Controller</code> convention for generating the class name. It creates an associated test that will run the application and instantiate an HTTP client, which can make requests against the controller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-controller Book
| Rendered template Controller.java to destination src/main/java/example/BookController.java
| Rendered template ControllerTest.java to destination src/test/java/example/BookControllerTest.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_client">Create-Client</h3>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Create-Client Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-client</code> command generates a simple <a href="../api/io/micronaut/http/client/Client.html">Client</a> interface. It follows a <code>*Client</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mn create-client Book
| Rendered template Client.java to destination src/main/java/example/BookClient.java</code></pre>
</div>
</div>
</div>
</div>
</div>


<h1 id="faq">15 Frequently Asked Questions (FAQ)</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/faq.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following section covers frequently asked questions and common problems folks stumble upon when using Micronaut.</p>
</div>
<div class="sect3">
<h4 id="_does_micronaut_modify_my_byte_code">Does Micronaut modify my byte code?</h4>
<div class="paragraph">
<p>No. Your classes are your classes. Micronaut does not transform classes or modify the Java byte code you write. Micronaut at compile will produce an additional set of classes that sit next to your original untouched classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_does_micronaut_support_scala">Does Micronaut support Scala?</h4>
<div class="paragraph">
<p>Micronaut supports any JVM language that supports the Annotation Processor API. Scala currently does not support this API. However, Groovy also doesn&#8217;t support this API and special support has been built that processes the Groovy AST. It may be technically possible to support Scala future if a similar module to <code>inject-groovy</code> is built, but as of this writing Scala is not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_can_micronaut_be_used_for_purposes_other_than_microservices">Can Micronaut be used for purposes other than Microservices?</h4>
<div class="paragraph">
<p>Yes. Micronaut is very modular and you can choose to use just the Dependency Injection and AOP implementation if you want simply by including only the <code>inject-java</code> (or <code>inject-groovy</code> for Groovy) dependency in your application.</p>
</div>
<div class="paragraph">
<p>In fact Micronaut&#8217;s support for <a href="#serverlessFunctions">Serverless Computing</a> uses this exact approach.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_are_the_advantages_of_micronaut_s_dependency_injection_and_aop_implementation">What are the advantages of Micronaut&#8217;s Dependency Injection and AOP implementation?</h4>
<div class="paragraph">
<p>Micronaut processes your classes at compile time and produces all metadata at compile time. This eliminates the need for reflection, cached reflective metadata and the requirement to analyze your classes at runtime all of which leads to slower startup performance and greater memory consumption.</p>
</div>
<div class="paragraph">
<p>In addition, Micronaut will build AOP proxies at compile time that are completely reflection free, which improves performances, reduces stack trace sizes and reduces memory consumption.</p>
</div>
</div>
<div class="sect3">
<h4 id="_i_am_using_micronaut_but_dependency_injection_is_not_working">I am using Micronaut but Dependency Injection is not working</h4>
<div class="paragraph">
<p>The most common reason that Dependency Injection fails to work is when you either don&#8217;t have the appropriate annotation processor configured or your IDE is incorrectly configured. See the section on <a href="#languageSupport">Language Support</a> for how to get setup in your language.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_does_micronaut_have_its_own_consul_and_eureka_client_implementations">Why does Micronaut have its own Consul and Eureka client implementations?</h4>
<div class="paragraph">
<p>The majority of Consul and Eureka clients that exist are blocking and include a mountain of external dependencies that inflate your JAR files.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> uses Micronaut&#8217;s native HTTP client thus greatly reducing the need for external dependencies and providing a reactive API onto both discovery servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_i_am_using_groovy_and_a_nosuchmethoderror_occurs_loading_my_beans">I am using Groovy and a NoSuchMethodError occurs loading my beans</h4>
<div class="paragraph">
<p>Groovy by default imports the <code>groovy.lang</code> package which includes a class called <code>@Singleton</code> that is an AST transformation that makes your class a singleton (adding a private constructor and static retrieval method). This annotation is easily confused with the <code>javax.inject.Singleton</code> annotation used to define singleton beans in Micronaut. Make sure you are using the correct annotation in your Groovy classes.</p>
</div>
</div>

            </div>


<div id="footer">
    
    
</div>


<script type="text/javascript">
    var prevScrollpos = window.pageYOffset;
    window.onscroll = function() {
        var currentScrollPos = window.pageYOffset;
        var show = false;
        if ((prevScrollpos > currentScrollPos) || (currentScrollPos < 5)) {
            show = true;
        }
        if (show) {
            document.getElementById("navigation").style.top = "0";
        } else {
            document.getElementById("navigation").style.top = "-76px";
        }
        prevScrollpos = currentScrollPos;
    }
</script>
</body>
</html>
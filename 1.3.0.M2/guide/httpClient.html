<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>7 The HTTP Client 1.3.0.M2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/messaging.html"><strong>10</strong><span>Message-Driven Microservices</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/commandLineApps.html"><strong>11</strong><span>Standalone Command Line Applications</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configurations.html"><strong>12</strong><span>Configurations</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/languageSupport.html"><strong>13</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/management.html"><strong>14</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>15</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/multitenancy.html"><strong>16</strong><span>Multi-Tenancy</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cli.html"><strong>17</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/appendix.html"><strong>18</strong><span>Appendices</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/httpServer.html">&lt;&lt; <strong>6</strong><span>The HTTP Server</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span> >></a></div>
                


                <div class="project">
                    <h1>7 The HTTP Client</h1>

                    <p><strong>Version:</strong> 1.3.0.M2</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#lowLevelHttpClient"><strong>7.1</strong><span>Using the Low-Level HTTP Client</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientBasics"><strong>7.1.1</strong><span>Sending your first HTTP request</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientPostRequests"><strong>7.1.2</strong><span>Posting a Request Body</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientUploads"><strong>7.1.3</strong><span>Multipart Client Uploads</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientStreaming"><strong>7.1.4</strong><span>Streaming JSON over HTTP</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientConfiguration"><strong>7.1.5</strong><span>Configuring HTTP clients</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#lowLevelClientError"><strong>7.1.6</strong><span>Error Responses</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#bindErrors"><strong>7.1.7</strong><span>Bind Errors</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#clientAnnotation"><strong>7.2</strong><span>Declarative HTTP Clients with @Client</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientParameters"><strong>7.2.1</strong><span>Customizing Parameter Binding</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientAnnotationStreaming"><strong>7.2.2</strong><span>Streaming with @Client</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientError"><strong>7.2.3</strong><span>Error Responses</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientHeaders"><strong>7.2.4</strong><span>Customizing Request Headers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientJackson"><strong>7.2.5</strong><span>Customizing Jackson Settings</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientRetry"><strong>7.2.6</strong><span>Retry and Circuit Breaker</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#clientFallback"><strong>7.2.7</strong><span>Client Fallbacks</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#netflixHystrix"><strong>7.2.8</strong><span>Netflix Hystrix Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#clientFilter"><strong>7.3</strong><span>HTTP Client Filters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#clientSample"><strong>7.4</strong><span>HTTP Client Sample</span></a>
                    </div>
                    
                </div>
                

                
<h1 id="httpClient"><a class="anchor" href="#httpClient"></a>7 The HTTP Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, the <code>http-client</code> dependency is included by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A critical component of any Microservice architecture is the client communication between Microservices. With that in mind Micronaut features a built in HTTP client that has both a low-level API and a higher level AOP-driven API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Regardless whether you choose to use Micronaut&#8217;s HTTP server, you may wish to use the Micronaut HTTP client in your application since it is a feature-rich client implementation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the HTTP client you must have the <code>http-client</code> dependency on your classpath.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut:micronaut-http-client'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Since the higher level API is built on the low-level HTTP client, we will first introduce the low-level client.</p>
</div>

<h2 id="lowLevelHttpClient"><a class="anchor" href="#lowLevelHttpClient"></a>7.1 Using the Low-Level HTTP Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface forms the basis for the low-level API. This interfaces declares methods to help ease executing HTTP requests and receive responses.</p>
</div>
<div class="paragraph">
<p>The majority of the methods in the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface returns Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances, which is not always the most useful interface to work against, hence a sub-interface called <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> is included that provides a variation of the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface that returns RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> types.</p>
</div>

<h2 id="clientBasics"><a class="anchor" href="#clientBasics"></a>7.1.1 Sending your first HTTP request</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientBasics.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_obtaining_a_httpclient"><a class="anchor" href="#_obtaining_a_httpclient"></a>Obtaining a HttpClient</h4>
<div class="paragraph">
<p>There are a few ways by which you can obtain a reference to a <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>. The most common way is using the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("https://api.twitter.com/1.1") @Inject RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will inject a client that targets the Twitter API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@field:Client("\${myapp.api.twitter.url}") @Inject lateinit var httpClient: RxHttpClient</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above Kotlin example will inject a client that targets the Twitter API using a configuration path. Note the required escaping (backslash) on <code>"\${path.to.config}"</code> which is required due to Kotlin string interpolation.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is also a custom scope that will manage the creation of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> instances and ensure they are shutdown when the application shuts down.</p>
</div>
<div class="paragraph">
<p>The value you pass to the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A absolute URI. Example <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the server targeted will be the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another way to create an <code>HttpClient</code> is with the <code>create</code> static method of the <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a>, however this approach is not recommended as you will have to ensure you manually shutdown the client and of course no dependency injection will occur for the created client.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performing_an_http_get"><a class="anchor" href="#_performing_an_http_get"></a>Performing an HTTP GET</h4>
<div class="paragraph">
<p>Generally there are two methods of interest when working with the <code>HttpClient</code>. The first method is called <code>retrieve</code>, which will execute an HTTP request and return the body in whichever type you request (by default a <code>String</code>) as an RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>.</p>
</div>
<div class="paragraph">
<p>The <code>retrieve</code> method accepts an <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> object or a <code>String</code> URI to the endpoint you wish to request.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>retrieve</code> to execute an HTTP <code>GET</code> and receive the response body as a <code>String</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        String uri = UriBuilder.of("/hello/{name}")
                               .expand(Collections.singletonMap("name", "John"))
                               .toString();
        assertEquals("/hello/John", uri);

        String result = client.toBlocking().retrieve(uri);

        assertEquals(
                "Hello John",
                result
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        String uri = UriBuilder.of("/hello/{name}")
                               .expand(Collections.singletonMap("name", "John"))
                               .toString()
        then:
        "/hello/John" == uri

        when:
        String result = client.toBlocking().retrieve(uri)

        then:
        "Hello John" == result</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val uri = UriBuilder.of("/hello/{name}")
                    .expand(Collections.singletonMap("name", "John"))
                    .toString()
            uri shouldBe "/hello/John"

            val result = client.toBlocking().retrieve(uri)

            result shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, for illustration purposes we are calling <code>toBlocking()</code> to return a blocking version of the client. However, in production code you should not do this and instead rely on the non-blocking nature of the Micronaut HTTP server.</p>
</div>
<div class="paragraph">
<p>For example the following <code>@Controller</code> method calls another endpoint in a non-blocking manner:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpStatus;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.*;
import io.micronaut.http.client.RxHttpClient;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Maybe;

import static io.micronaut.http.HttpRequest.GET;

    @Get("/hello/{name}")
    Maybe&lt;String&gt; hello(String name) { <b class="conum">(1)</b>
        return httpClient.retrieve( GET("/hello/" + name) )
                         .firstElement(); <b class="conum">(2)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.*
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.client.annotation.Client
import io.reactivex.Maybe

import static io.micronaut.http.HttpRequest.GET

    @Get("/hello/{name}")
    Maybe&lt;String&gt; hello(String name) { <b class="conum">(1)</b>
        return httpClient.retrieve( GET("/hello/" + name) )
                         .firstElement() <b class="conum">(2)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.*
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.client.annotation.Client
import io.reactivex.Maybe

import io.micronaut.http.HttpRequest.GET

    @Get("/hello/{name}")
    internal fun hello(name: String): Maybe&lt;String&gt; { <b class="conum">(1)</b>
        return httpClient.retrieve(GET&lt;Any&gt;("/hello/$name"))
                .firstElement() <b class="conum">(2)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method <code>hello</code> returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Maybe.html">Maybe</a> which may or may not emit an item. If an item is not emitted a 404 is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>retrieve</code> method is called which returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> which has a <code>firstElement</code> method that returns the first emitted item or nothing</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using RxJava (or Reactor if you prefer) you can easily and efficiently compose multiple HTTP client calls without blocking (which will limit the throughput and scalability of your application).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_tracing_the_http_client"><a class="anchor" href="#_debugging_tracing_the_http_client"></a>Debugging / Tracing the HTTP Client</h4>
<div class="paragraph">
<p>To debug the requests being sent and received from the HTTP client you can enable tracing logging via your <code>logback.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="io.micronaut.http.client" level="TRACE"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client_specific_debugging_tracing"><a class="anchor" href="#_client_specific_debugging_tracing"></a>Client Specific Debugging / Tracing</h4>
<div class="paragraph">
<p>To enable client-specific logging you could configure the default logger for all HTTP clients. And, you could also configure different loggers for different clients using <a href="#_client_specific_configuration">Client Specific Configuration</a>. For example, in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">micronaut:
    http:
        client:
            logger-name: mylogger
        services:
            otherClient:
                logger-name: other.client</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, then enable logging in <code>logback.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="mylogger" level="DEBUG"/&gt;
&lt;logger name="other.client" level="TRACE"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_http_request"><a class="anchor" href="#_customizing_the_http_request"></a>Customizing the HTTP Request</h4>
<div class="paragraph">
<p>The previous example demonstrated using the static methods of the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface to construct a <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> instance. Like the name suggests a <code>MutableHttpRequest</code> can be mutated including the ability to add headers, customize the request body and so on. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;String&gt; response = client.retrieve(
                GET("/hello/John")
                .header("X-My-Header", "SomeValue")
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;String&gt; response = client.retrieve(
                GET("/hello/John")
                .header("X-My-Header", "SomeValue")
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val response = client.retrieve(
                    GET&lt;Any&gt;("/hello/John")
                            .header("X-My-Header", "SomeValue")
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example adds an additional header called <code>X-My-Header</code> to the request before it is sent. The <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> interface has a bunch more convenience methods that make it easy to modify the request in common ways.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading_json_responses"><a class="anchor" href="#_reading_json_responses"></a>Reading JSON Responses</h4>
<div class="paragraph">
<p>Typically with Microservices a message encoding format is used such as JSON. Micronaut&#8217;s HTTP client leverages Jackson for JSON parsing hence whatever type Jackson can decode can passed as a second argument to <code>retrieve</code>.</p>
</div>
<div class="paragraph">
<p>For example consider the following <code>@Controller</code> method that returns a JSON response:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/greet/{name}")
    Message greet(String name) {
        return new Message("Hello " + name);
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/greet/{name}")
    Message greet(String name) {
        return new Message("Hello " + name)
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/greet/{name}")
    internal fun greet(name: String): Message {
        return Message("Hello $name")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method above returns a POJO of type <code>Message</code> which looks like:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonProperty;

public class Message {
    private final String text;

    @JsonCreator
    public Message(@JsonProperty("text") String text) {
        this.text = text;
    }

    public String getText() {
        return text;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import com.fasterxml.jackson.annotation.JsonCreator
import com.fasterxml.jackson.annotation.JsonProperty

class Message {
    private final String text

    @JsonCreator
    Message(@JsonProperty("text") String text) {
        this.text = text
    }

    String getText() {
        return text
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import com.fasterxml.jackson.annotation.JsonCreator
import com.fasterxml.jackson.annotation.JsonProperty


class Message @JsonCreator
constructor(@param:JsonProperty("text") val text: String)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jackson annotations are used to map the constructor
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the client end you can call this endpoint and decode the JSON into a map using the <code>retrieve</code> method as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;Map&gt; response = client.retrieve(
                GET("/greet/John"), Map.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;Map&gt; response = client.retrieve(
                GET("/greet/John"), Map.class
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            var response: Flowable&lt;Map&lt;*, *&gt;&gt; = client.retrieve(
                    GET&lt;Any&gt;("/greet/John"), Map::class.java
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above examples decodes the response into a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html">Map</a>, representing the JSON. If you wish to customize the type of the key and string you can use the <code>Argument.of(..)</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        response = client.retrieve(
                GET("/greet/John"),
                Argument.of(Map.class, String.class, String.class) <b class="conum">(1)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        response = client.retrieve(
                GET("/greet/John"),
                Argument.of(Map.class, String.class, String.class) <b class="conum">(1)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            response = client.retrieve(
                    GET&lt;Any&gt;("/greet/John"),
                    Argument.of(Map::class.java, String::class.java, String::class.java) <b class="conum">(1)</b>
            )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Argument.of</code> method is used to return a <code>Map</code> whether the key and value are typed as <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whilst retrieving JSON as a map can be desirable, more often than not you will want to decode objects into Plain Old Java Objects (POJOs). To do that simply pass the type instead:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;Message&gt; response = client.retrieve(
                GET("/greet/John"), Message.class
        );

        assertEquals(
                "Hello John",
                response.blockingFirst().getText()
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Flowable&lt;Message&gt; response = client.retrieve(
                GET("/greet/John"), Message.class
        )

        then:
        "Hello John" == response.blockingFirst().getText()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val response = client.retrieve(
                    GET&lt;Any&gt;("/greet/John"), Message::class.java
            )

            response.blockingFirst().text shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how you can use the same Java type on both the client and the server. The implication of this is that typically you will want to define a common API project where you define the interfaces and types that define your API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_decoding_other_content_types"><a class="anchor" href="#_decoding_other_content_types"></a>Decoding Other Content Types</h4>
<div class="paragraph">
<p>If the server you are communicating with uses a custom content type that is not JSON by default Micronaut&#8217;s HTTP client will not know how to decode this type.</p>
</div>
<div class="paragraph">
<p>To resolve this issue you can register <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> as a bean and it will be automatically picked up and used to decode (or encode) messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_receiving_the_full_http_response"><a class="anchor" href="#_receiving_the_full_http_response"></a>Receiving the Full HTTP Response</h4>
<div class="paragraph">
<p>Sometimes, receiving just the object is not enough and you need information about the response. In this case, instead of <code>retrieve</code> you should use the <code>exchange</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Recieving the Full HTTP Response</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                GET("/greet/John"), Message.class <b class="conum">(1)</b>
        );

        HttpResponse&lt;Message&gt; response = call.blockingFirst();
        Optional&lt;Message&gt; message = response.getBody(Message.class); <b class="conum">(2)</b>
        // check the status
        assertEquals(
                HttpStatus.OK,
                response.getStatus() <b class="conum">(3)</b>
        );
        // check the body
        assertTrue(message.isPresent());
        assertEquals(
                "Hello John",
                message.get().getText()
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Recieving the Full HTTP Response</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                GET("/greet/John"), Message.class <b class="conum">(1)</b>
        )

        HttpResponse&lt;Message&gt; response = call.blockingFirst();
        Optional&lt;Message&gt; message = response.getBody(Message.class) <b class="conum">(2)</b>
        // check the status
        then:
        HttpStatus.OK == response.getStatus() <b class="conum">(3)</b>
        // check the body
        message.isPresent()
        "Hello John" == message.get().getText()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Recieving the Full HTTP Response</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    GET&lt;Any&gt;("/greet/John"), Message::class.java <b class="conum">(1)</b>
            )

            val response = call.blockingFirst()
            val message = response.getBody(Message::class.java) <b class="conum">(2)</b>
            // check the status
            response.status shouldBe HttpStatus.OK <b class="conum">(3)</b>
            // check the body
            message.isPresent shouldBe true
            message.get().text shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>exchange</code> method is used to receive the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The body can be retrieved using the <code>getBody(..)</code> method of the response</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Other aspects of the response, such as the <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> can be checked</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example receives the full <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> object from which you can obtain headers and other useful information.</p>
</div>
</div>

<h2 id="clientPostRequests"><a class="anchor" href="#clientPostRequests"></a>7.1.2 Posting a Request Body</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientPostRequests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>All the examples up until now have used the same HTTP method i.e <code>GET</code>. The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface has factory methods for all the different HTTP methods. The following table summarizes the available methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. HttpRequest Factory Methods</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Allows Body</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#GET-java.lang.String-">HttpRequest.GET(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>GET</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#OPTIONS-java.lang.String-">HttpRequest.OPTIONS(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>OPTIONS</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#HEAD-java.lang.String-">HttpRequest.HEAD(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>HEAD</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#POST-java.lang.String-T-">HttpRequest.POST(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>POST</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PUT-java.lang.String-T-">HttpRequest.PUT(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PUT</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PATCH-java.lang.String-T-">HttpRequest.PATCH(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PATCH</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#DELETE-java.lang.String-">HttpRequest.DELETE(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>DELETE</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <code>create</code> method also exists to construct a request for any <a href="../api/io/micronaut/http/HttpMethod.html">HttpMethod</a> type. Since the <code>POST</code>, <code>PUT</code> and <code>PATCH</code> methods require a body, a second argument which is the body object is required.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to send a simply <code>String</code> body:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;String&gt;&gt; call = client.exchange(
                POST("/hello", "Hello John") <b class="conum">(1)</b>
                    .contentType(MediaType.TEXT_PLAIN_TYPE)
                    .accept(MediaType.TEXT_PLAIN_TYPE), <b class="conum">(2)</b>
                String.class <b class="conum">(3)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;String&gt;&gt; call = client.exchange(
                POST("/hello", "Hello John") <b class="conum">(1)</b>
                    .contentType(MediaType.TEXT_PLAIN_TYPE)
                    .accept(MediaType.TEXT_PLAIN_TYPE), <b class="conum">(2)</b>
                String.class <b class="conum">(3)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/hello", "Hello John") <b class="conum">(1)</b>
                            .contentType(MediaType.TEXT_PLAIN_TYPE)
                            .accept(MediaType.TEXT_PLAIN_TYPE), String::class.java <b class="conum">(3)</b>
            )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>POST</code> method is used with the first argument being the URI and the second argument the body</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The content type and accepted type are set to <code>text/plain</code> (the default content type is <code>application/json</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The expected response type is a <code>String</code></td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_sending_json"><a class="anchor" href="#_sending_json"></a>Sending JSON</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example sends plain text, if you wish send JSON you can simply pass the object you wish to encode as JSON, whether that be a map or a POJO. As long as Jackson is able to encode it.</p>
</div>
<div class="paragraph">
<p>For example, the <code>Message</code> class from the previous section, you can create an instance and pass it to the <code>POST</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                POST("/greet", new Message("Hello John")), <b class="conum">(1)</b>
                Message.class <b class="conum">(2)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;Message&gt;&gt; call = client.exchange(
                POST("/greet", new Message("Hello John")), <b class="conum">(1)</b>
                Message.class <b class="conum">(2)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/greet", Message("Hello John")), Message::class.java <b class="conum">(2)</b>
            )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>And instance of <code>Message</code> is created and passed to the <code>POST</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The same class is used to decode the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the above example the following JSON will be sent as the body of the request:</p>
</div>
<div class="listingblock">
<div class="title">Resulting JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"text":"Hello John"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON itself can be customized however you want using <a href="https://github.com/FasterXML/jackson-annotations">Jackson Annotations</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_uri_template"><a class="anchor" href="#_using_a_uri_template"></a>Using a URI Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If some of the properties of the object need to be in the URI being posted to you can use a URI template.</p>
</div>
<div class="paragraph">
<p>For example imagine you have a class <code>Book</code> that has a property called <code>title</code>. You can represent the <code>title</code> property in the URI template and then populate it from an instance of <code>Book</code>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand")),
                Book.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand")),
                Book.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/amazon/book/{title}", Book("The Stand")),
                    Book::class.java
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case the <code>title</code> property of the passed object will be included in the URI being posted to.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_form_data"><a class="anchor" href="#_sending_form_data"></a>Sending Form Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also encode a POJO or a map as regular form data instead of JSON. Just set the content type to <code>application/x-www-form-urlencoded</code> on the post request:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand"))
                .contentType(MediaType.APPLICATION_FORM_URLENCODED),
                Book.class
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
                POST("/amazon/book/{title}", new Book("The Stand"))
                .contentType(MediaType.APPLICATION_FORM_URLENCODED),
                Book.class
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val call = client.exchange(
                    POST("/amazon/book/{title}", Book("The Stand"))
                            .contentType(MediaType.APPLICATION_FORM_URLENCODED),
                    Book::class.java
            )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Jackson is used to bind form data too, so to customize the binding process you can use <a href="https://github.com/FasterXML/jackson-annotations">Jackson annotations</a>.</p>
</div>
</div>
</div>

<h2 id="clientUploads"><a class="anchor" href="#clientUploads"></a>7.1.3 Multipart Client Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientUploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP Client supports the ability to create multipart requests. In order to build a multipart request you must set the content type to <code>multipart/form-data</code> and set the body to be an instance of <a href="../api/io/micronaut/http/client/multipart/MultipartBody.html">MultipartBody</a>:</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.client.multipart.MultipartBody;

            String toWrite = "test file";
            File file = File.createTempFile("data", ".txt");
            FileWriter writer = new FileWriter(file);
            writer.write(toWrite);
            writer.close();

            MultipartBody requestBody = MultipartBody.builder()     <b class="conum">(1)</b>
                    .addPart(                                       <b class="conum">(2)</b>
                        "data",
                        file.getName(),
                        MediaType.TEXT_PLAIN_TYPE,
                        file
                    ).build()   ;                                    <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.StreamingFileUpload
import io.micronaut.http.client.multipart.MultipartBody
import org.reactivestreams.Publisher

        File file = new File(uploadDir, "data.txt")
        file.text = "test file"
        file.createNewFile()


        MultipartBody requestBody = MultipartBody.builder()     <b class="conum">(1)</b>
                .addPart(                                       <b class="conum">(2)</b>
                    "data",
                    file.name,
                    MediaType.TEXT_PLAIN_TYPE,
                    file
                ).build()                                       <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.client.multipart.MultipartBody

            val toWrite = "test file"
            val file = File.createTempFile("data", ".txt")
            val writer = FileWriter(file)
            writer.write(toWrite)
            writer.close()

            val requestBody = MultipartBody.builder()     <b class="conum">(1)</b>
                    .addPart(                             <b class="conum">(2)</b>
                            "data",
                            file.name,
                            MediaType.TEXT_PLAIN_TYPE,
                            file
                    ).build()                             <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You need to create a MultipartBody builder for adding parts to the body.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method to add a part to the body, in this case a file. There are different variations of this method which you can see in <a href="../api/io/micronaut/http/client/multipart/MultipartBody.Builder.html" target="_blank" rel="noopener">MultipartBody.Builder</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call the build method to assemble all parts from the builder into a MultipartBody. At least one part is required.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">                    HttpRequest.POST("/multipart/upload", requestBody)       <b class="conum">(1)</b>
                            .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">                HttpRequest.POST("/multipart/upload", requestBody)       <b class="conum">(1)</b>
                        .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">                    HttpRequest.POST("/multipart/upload", requestBody)   <b class="conum">(1)</b>
                            .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The multipart request body with different sets of data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the content-type header of the request to <code>multipart/form-data</code>.</td>
</tr>
</table>
</div>

<h2 id="clientStreaming"><a class="anchor" href="#clientStreaming"></a>7.1.4 Streaming JSON over HTTP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientStreaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s HTTP client includes support for streaming data over HTTP via the <a href="../api/io/micronaut/http/client/RxStreamingHttpClient.html">RxStreamingHttpClient</a> interface which includes methods specific to HTTP streaming including:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. HTTP Streaming Methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a stream of data as a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exchangeStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> wrapping a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsonStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a non-blocking stream of JSON objects</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In order to do JSON streaming you should on the server side declare a controller method that returns a <code>application/x-json-stream</code> of JSON objects. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.reactivex.Flowable;

import java.time.ZonedDateTime;
import java.util.concurrent.TimeUnit;

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines() {
        return Flowable.fromCallable(() -&gt; {  <b class="conum">(2)</b>
            Headline headline = new Headline();
            headline.setText("Latest Headline at " + ZonedDateTime.now());
            return headline;
        }).repeat(100) <b class="conum">(3)</b>
          .delay(1, TimeUnit.SECONDS); <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.reactivex.Flowable

import java.time.ZonedDateTime
import java.util.concurrent.TimeUnit

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines() {
        Flowable.fromCallable({ <b class="conum">(2)</b>
            Headline headline = new Headline()
            headline.setText("Latest Headline at " + ZonedDateTime.now())
            return headline
        }).repeat(100) <b class="conum">(3)</b>
          .delay(1, TimeUnit.SECONDS) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.reactivex.Flowable

import java.time.ZonedDateTime
import java.util.concurrent.TimeUnit


    @Get(value = "/headlines", processes = [MediaType.APPLICATION_JSON_STREAM]) <b class="conum">(1)</b>
    internal fun streamHeadlines(): Flowable&lt;Headline&gt; {
        return Flowable.fromCallable {
            <b class="conum">(2)</b>
            val headline = Headline()
            headline.text = "Latest Headline at " + ZonedDateTime.now()
            headline
        }.repeat(100) <b class="conum">(3)</b>
                .delay(1, TimeUnit.SECONDS) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method <code>streamHeadlines</code> is defined that produces <code>application/x-json-stream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is created from a <code>Callable</code> function (note no blocking occurs within the function so this is ok, otherwise you would want to <code>subscribeOn</code> an I/O thread pool).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is set to repeat 100 times</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> will emit items with a delay of 1 second between each item</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The server does not have to be written in Micronaut, any server that supports JSON streaming will do.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then on the client simply subscribe to the stream using <code>jsonStream</code> and every time the server emits a JSON object the client will decode and consume it:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Flowable&lt;Headline&gt; headlineStream = client.jsonStream(GET("/streaming/headlines"), Headline.class); <b class="conum">(1)</b>
        CompletableFuture&lt;Headline&gt; future = new CompletableFuture&lt;&gt;(); <b class="conum">(2)</b>
        headlineStream.subscribe(new Subscriber&lt;Headline&gt;() {
            @Override
            public void onSubscribe(Subscription s) {
                s.request(1); <b class="conum">(3)</b>
            }

            @Override
            public void onNext(Headline headline) {
                System.out.println("Received Headline = " + headline.getText());
                future.complete(headline); <b class="conum">(4)</b>
            }

            @Override
            public void onError(Throwable t) {
                future.completeExceptionally(t); <b class="conum">(5)</b>
            }

            @Override
            public void onComplete() {
                // no-op <b class="conum">(6)</b>
            }
        });</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        Flowable&lt;Headline&gt; headlineStream = client.jsonStream(GET("/streaming/headlines"), Headline.class) <b class="conum">(1)</b>
        CompletableFuture&lt;Headline&gt; future = new CompletableFuture&lt;&gt;() <b class="conum">(2)</b>
        headlineStream.subscribe(new Subscriber&lt;Headline&gt;() {
            @Override
            void onSubscribe(Subscription s) {
                s.request(1) <b class="conum">(3)</b>
            }

            @Override
            void onNext(Headline headline) {
                System.out.println("Received Headline = " + headline.getText())
                future.complete(headline) <b class="conum">(4)</b>
            }

            @Override
            void onError(Throwable t) {
                future.completeExceptionally(t) <b class="conum">(5)</b>
            }

            @Override
            void onComplete() {
                // no-op <b class="conum">(6)</b>
            }
        })</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val headlineStream = client.jsonStream(GET&lt;Any&gt;("/streaming/headlines"), Headline::class.java) <b class="conum">(1)</b>
            val future = CompletableFuture&lt;Headline&gt;() <b class="conum">(2)</b>
            headlineStream.subscribe(object : Subscriber&lt;Headline&gt; {
                override fun onSubscribe(s: Subscription) {
                    s.request(1) <b class="conum">(3)</b>
                }

                override fun onNext(headline: Headline) {
                    println("Received Headline = " + headline.text!!)
                    future.complete(headline) <b class="conum">(4)</b>
                }

                override fun onError(t: Throwable) {
                    future.completeExceptionally(t) <b class="conum">(5)</b>
                }

                override fun onComplete() {
                    // no-op <b class="conum">(6)</b>
                }
            })</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>jsonStream</code> method is used return a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>CompletableFuture</code> is used in the example to receive a value, but what you do with each emitted item is application specific</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Subscription.html">Subscription</a> is used to request a single item. You can use the <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Subscription.html">Subscription</a> to regulate back pressure and demand.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>onNext</code> method is called when an item is emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>onError</code> method is called when an error occurs</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>onComplete</code> method is called when all <code>Headline</code> instances have been emitted</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note neither the server or the client in the example above perform blocking I/O at any point.</p>
</div>

<h2 id="clientConfiguration"><a class="anchor" href="#clientConfiguration"></a>7.1.5 Configuring HTTP clients</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/clientConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_global_configuration_for_all_clients"><a class="anchor" href="#_global_configuration_for_all_clients"></a>Global Configuration for All Clients</h3>
<div class="paragraph">
<p>The default HTTP client configuration is a <a href="#configurationProperties">Configuration Properties</a> called <a href="../api/io/micronaut/http/client/DefaultHttpClientConfiguration.html">DefaultHttpClientConfiguration</a> that allows configuring the default behaviour for all HTTP clients. For example, in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Altering default HTTP client configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-timeout: 5s</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example sets of <code>readTimeout</code> property of the <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_client_specific_configuration"><a class="anchor" href="#_client_specific_configuration"></a>Client Specific Configuration</h3>
<div class="paragraph">
<p>If you wish to have a separate configuration per client then there a couple of options. You can configure <a href="#serviceDiscoveryManual">Service Discovery</a> manually in <code>application.yml</code> and apply per-client configuration:</p>
</div>
<div class="listingblock">
<div class="title">Manually configuring HTTP services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        services:
            foo:
                urls:
                    - http://foo1
                    - http://foo2
                read-timeout: 5s <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The read timeout is applied to the <code>foo</code> client.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>WARN: This client configuration can be used in conjunction with the <code>@Client</code> annotation, either by injecting an <code>HttpClient</code> directly or use on a client interface. In any case, all other attributes on the annotation <strong>will be ignored</strong> other than the service id.</p>
</div>
<div class="paragraph">
<p>Then simply inject the named client configuration:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("foo") @Inject RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also simply define a bean that extends from <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> and ensuring that the <code>javax.inject.Named</code> annotation is used to name it appropriately:</p>
</div>
<div class="listingblock">
<div class="title">Defining an HTTP client configuration bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("twitter")
@Singleton
class TwitterHttpClientConfiguration extends HttpClientConfiguration {
   public TwitterHttpClientConfiguration(ApplicationConfiguration applicationConfiguration) {
        super(applicationConfiguration);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration will then be picked up if you inject a service called <code>twitter</code> using <code>@Client</code> using <a href="#serviceDiscovery">Service Discovery</a>:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("twitter") @Inject RxHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively if you are not using service discovery then you can use the <code>configuration</code> member of <code>@Client</code> to refer to a specific type:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(value="https://api.twitter.com/1.1",
        configuration=TwitterHttpClientConfiguration.class)
@Inject
RxHttpClient httpClient;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_http_client_connection_pooling"><a class="anchor" href="#_using_http_client_connection_pooling"></a>Using HTTP Client Connection Pooling</h3>
<div class="paragraph">
<p>If you have a client that needs to handle a significant number of requests then you can benefit from enabling HTTP client connection pooling. The following configuration will enable pooling for the <code>foo</code> client:</p>
</div>
<div class="listingblock">
<div class="title">Manually configuring HTTP services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        services:
            foo:
                urls:
                    - http://foo1
                    - http://foo2
                pool:
                    enabled: true <i class="conum" data-value="1"></i><b>(1)</b>
                    max-connections: 50 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables the pool</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the maximum number of connections in the pool</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the API for <a href="../api/io/micronaut/http/client/HttpClientConfiguration.ConnectionPoolConfiguration.html">ConnectionPoolConfiguration</a> for details on available options to configure the pool.</p>
</div>
</div>

<h2 id="lowLevelClientError"><a class="anchor" href="#lowLevelClientError"></a>7.1.6 Error Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/lowLevelClientError.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If an HTTP response is returned with a code of 400 or above, an <a href="../api/io/micronaut/client/response/exceptions/HttpClientResponseException.html">HttpClientResponseException</a> is created. The exception contains the original response. How that exception gets thrown depends on the return type of the method.</p>
</div>
<div class="paragraph">
<p>For blocking clients, the exception is thrown and should be caught and handled by the caller. For reactive clients, the exception is passed through the publisher as an error.</p>
</div>

<h2 id="bindErrors"><a class="anchor" href="#bindErrors"></a>7.1.7 Bind Errors</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/lowLevelHttpClient/bindErrors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often you want to consume an endpoint and bind to a POJO if the request is successful or bind to a different POJO if an error occurs. The following example shows how to invoke <code>exchange</code> with a success and error type.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/books")
public class BooksController {

    @Get("/{isbn}")
    public HttpResponse find(String isbn) {
        if (isbn.equals("1680502395")) {
            Map&lt;String, Object&gt; m = new HashMap&lt;&gt;();
            m.put("status", 401);
            m.put("error", "Unauthorized");
            m.put("message", "No message available");
            m.put("path", "/books/"+isbn);
            return HttpResponse.status(HttpStatus.UNAUTHORIZED).body(m);

        }
        return HttpResponse.ok(new Book("1491950358", "Building Microservices"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/books")
class BooksController {

    @Get("/{isbn}")
    HttpResponse find(String isbn) {
        if (isbn == "1680502395") {
            Map&lt;String, Object&gt; m = new HashMap&lt;&gt;()
            m.put("status", 401)
            m.put("error", "Unauthorized")
            m.put("message", "No message available")
            m.put("path", "/books/"+isbn)
            return HttpResponse.status(HttpStatus.UNAUTHORIZED).body(m)

        }
        return HttpResponse.ok(new Book("1491950358", "Building Microservices"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/books")
class BooksController {

    @Get("/{isbn}")
    fun find(isbn: String): HttpResponse&lt;*&gt; {
        if (isbn == "1680502395") {
            val m = HashMap&lt;String, Any&gt;()
            m["status"] = 401
            m["error"] = "Unauthorized"
            m["message"] = "No message available"
            m["path"] = "/books/$isbn"
            return HttpResponse.status&lt;Any&gt;(HttpStatus.UNAUTHORIZED).body(m)

        }
        return HttpResponse.ok(Book("1491950358", "Building Microservices"))
    }
}</code></pre>
</div>
</div>
<hr>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void afterAnHttpClientExceptionTheResponseBodyCanBeBoundToAPOJO() {
        try {
            client.toBlocking().exchange(HttpRequest.GET("/books/1680502395"),
                    Argument.of(Book.class), <b class="conum">(1)</b>
                    Argument.of(CustomError.class)); <b class="conum">(2)</b>
        } catch (HttpClientResponseException e) {
            assertEquals(HttpStatus.UNAUTHORIZED, e.getResponse().getStatus());
            Optional&lt;CustomError&gt; jsonError = e.getResponse().getBody(CustomError.class);
            assertTrue(jsonError.isPresent());
            assertEquals(401, jsonError.get().status);
            assertEquals("Unauthorized", jsonError.get().error);
            assertEquals("No message available", jsonError.get().message);
            assertEquals("/books/1680502395", jsonError.get().path);
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    def "after an HttpClientException the response body can be bound to a POJO"() {
        when:
        client.toBlocking().exchange(HttpRequest.GET("/books/1680502395"),
                Argument.of(Book), <b class="conum">(1)</b>
                Argument.of(CustomError)) <b class="conum">(2)</b>

        then:
        def e = thrown(HttpClientResponseException)
        e.response.status == HttpStatus.UNAUTHORIZED

        when:
        Optional&lt;CustomError&gt; jsonError = e.response.getBody(CustomError)

        then:
        jsonError.isPresent()
        jsonError.get().status == 401
        jsonError.get().error == 'Unauthorized'
        jsonError.get().message == 'No message available'
        jsonError.get().path == '/books/1680502395'
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "after an httpclient exception the response body can be bound to a POJO" {
            try {
                client.toBlocking().exchange(HttpRequest.GET&lt;Any&gt;("/books/1680502395"),
                        Argument.of(Book::class.java), <b class="conum">(1)</b>
                        Argument.of(CustomError::class.java)) <b class="conum">(2)</b>
            } catch (e: HttpClientResponseException) {
                e.response.status shouldBe HttpStatus.UNAUTHORIZED
            }
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Success Type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Error Type</td>
</tr>
</table>
</div>

<h2 id="clientAnnotation"><a class="anchor" href="#clientAnnotation"></a>7.2 Declarative HTTP Clients with @Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that you have gathered an understanding of the workings of the lower level HTTP client, it is time to take a look at Micronaut&#8217;s support for declarative clients via the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>Essentially, the <code>@Client</code> annotation can be declared on any interface or abstract class and through the use of <a href="#introductionAdvice">Introduction Advice</a> the abstract methods will be implemented for you at compile time, greatly simplifying the creation of HTTP clients.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example. Given the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Pet {
    private String name;
    private int age;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class Pet {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class Pet {
    var name: String? = null
    var age: Int = 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a common interface for saving new <code>Pet</code> instances:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;
import io.reactivex.Single;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@Validated
public interface PetOperations {
    @Post
    Single&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import io.reactivex.Single

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Validated
interface PetOperations {
    @Post
    Single&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import io.reactivex.Single

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank


@Validated
interface PetOperations {
    @Post
    fun save(@NotBlank name: String, @Min(1L) age: Int): Single&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the interface uses Micronaut&#8217;s HTTP annotations which are usable on both the server and client side. Also, as you can see you can use <code>javax.validation</code> constraints to validate arguments.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Be aware that some annotations, such as <a href="../api/io/micronaut/http/client/annotation/Produces.html">Produces</a> and <a href="../api/io/micronaut/http/client/annotation/Consumes.html">Consumes</a>, have different semantics between server and client side usage. For example, <code>@Produces</code> on a controller method (server side) indicates how the method&#8217;s <strong>return value</strong> is formatted, while <code>@Produces</code> on a client indicates how the method&#8217;s <strong>parameters</strong> are formatted when sent to the server. While this may seem a little confusing at first, it is actually logical considering the different semantics between a server producing/consuming vs a client: A server consumes an argument and <strong>returns</strong> a response to the client, whereas a client consumes an argument and <strong>sends</strong> output to a server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, to use the <code>javax.validation</code> features you should have the <code>validation</code> and <code>hibernate-validator</code> dependencies on your classpath. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut:micronaut-validation"
compile "io.micronaut.configuration:micronaut-hibernate-validator"</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the server-side of Micronaut you can implement the <code>PetOperations</code> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.reactivex.Single;

@Controller("/pets")
public class PetController implements PetOperations {

    @Override
    public Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet();
        pet.setName(name);
        pet.setAge(age);
        // save to database or something
        return Single.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.reactivex.Single

@Controller("/pets")
class PetController implements PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet()
        pet.setName(name)
        pet.setAge(age)
        // save to database or something
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.reactivex.Single


@Controller("/pets")
open class PetController : PetOperations {

    override fun save(name: String, age: Int): Single&lt;Pet&gt; {
        val pet = Pet()
        pet.name = name
        pet.age = age
        // save to database or something
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then define a declarative client in <code>src/test/java</code> that uses <code>@Client</code> to automatically, at compile time, implement a client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.client.annotation.Client;
import io.reactivex.Single;

@Client("/pets") <b class="conum">(1)</b>
public interface PetClient extends PetOperations { <b class="conum">(2)</b>

    @Override
    Single&lt;Pet&gt; save(String name, int age); <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.client.annotation.Client
import io.reactivex.Single

@Client("/pets") <b class="conum">(1)</b>
interface PetClient extends PetOperations { <b class="conum">(2)</b>

    @Override
    Single&lt;Pet&gt; save(String name, int age) <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.client.annotation.Client
import io.reactivex.Single


@Client("/pets") <b class="conum">(1)</b>
interface PetClient : PetOperations { <b class="conum">(2)</b>

    override fun save(name: String, age: Int): Single&lt;Pet&gt;  <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is used with a value relative to the current server. In this case <code>/pets</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The interface extends from <code>PetOperations</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>save</code> method is overridden. See warning below.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Notice in the above example we override the <code>save</code> method. This is necessary if you compile without the <code>-parameters</code> option since Java does not retain parameters names in the byte code otherwise. If you compile with <code>-parameters</code> then overriding is not necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined a client you can simply <code>@Inject</code> it wherever you may need it.</p>
</div>
<div class="paragraph">
<p>Recall that the value of <code>@Client</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An absolute URI. Example <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the server targeted will be the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a production deployment you would typically use a service ID and <a href="#serviceDiscovery">Service Discovery</a> to discover services automatically.</p>
</div>
<div class="paragraph">
<p>Another important thing to notice regarding the <code>save</code> method in the example above is that is returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> type.</p>
</div>
<div class="paragraph">
<p>This is a non-blocking reactive type and typically you want your HTTP clients not to block. There are cases where you may want to write an HTTP client that does block (such as in unit test cases), but this are rare.</p>
</div>
<div class="paragraph">
<p>The following table illustrates common return types usable with <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single&lt;HttpResponse&lt;String&gt;&gt; hello()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> implementation that emits a POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;Book&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A blocking native type. Such as <code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Generally, any reactive type that can be converted to the <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> interface is supported as a return type including (but not limited to) the reactive types defined by RxJava 1.x, RxJava 2.x and Reactor 3.x.</p>
</div>
<div class="paragraph">
<p>Returning <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> instances is also supported. Note that returning any other type <em>will result in a blocking request</em> and is not recommended other than for testing.</p>
</div>

<h2 id="clientParameters"><a class="anchor" href="#clientParameters"></a>7.2.1 Customizing Parameter Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientParameters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous example presented a trivial example that uses the parameters of a method to represent the body of a <code>POST</code> request:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post
Single&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>save</code> method when called will perform an HTTP <code>POST</code> with the following JSON by default:</p>
</div>
<div class="listingblock">
<div class="title">Example Produced JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"name":"Dino", "age":10}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may however want to customize what is sent as the body, the parameters, URI variables and so on. The <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation is very flexible in this regard and supports the same <a href="../api/io/micronaut/http/annotation/package-summary.html">HTTP Annotations</a> as Micronaut&#8217;s HTTP server.</p>
</div>
<div class="paragraph">
<p>For example, the following defines a URI template and the <code>name</code> parameter is used as part of the URI template, whilst <a href="../api/io/micronaut/http/annotation/Body.html">@Body</a> is used declare that the contents to send to the server are represented by the <code>Pet</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post("/{name}")
Single&lt;Pet&gt; save(
    @NotBlank String name, <i class="conum" data-value="1"></i><b>(1)</b>
    @Body @Valid Pet pet) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name parameter, included as part of the URI, and declared <code>@NotBlank</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>pet</code> parameter, used to encode the body and declared <code>@Valid</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table summarizes the parameter annotations, their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to specify the parameter that is the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be sent as cookies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be sent as HTTP headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String contentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows customizing the name of the URI parameter to bind from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryValue("userAge") Integer age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/PathVariable.html">@PathVariable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to bind a parameter exclusively from a <a href="#routing">Path Variable</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathVariable Long id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@RequestAttribute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows specifying parameters that should be set as request attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestAttribute Integer locationId</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_type_based_binding_parameters"><a class="anchor" href="#_type_based_binding_parameters"></a>Type Based Binding Parameters</h4>
<div class="paragraph">
<p>Some parameters are recognized by their type instead of their annotation. The following table summarizes the parameter types, their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/BasicAuth.html">BasicAuth</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows binding of basic authorization credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuth basicAuth</code></p></td>
</tr>
</tbody>
</table>
</div>

<h2 id="clientAnnotationStreaming"><a class="anchor" href="#clientAnnotationStreaming"></a>7.2.2 Streaming with @Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientAnnotationStreaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/Client.html">@Client</a> annotation can also handle streaming HTTP responses.</p>
</div>
<div class="sect2">
<h3 id="_streaming_json_with_client"><a class="anchor" href="#_streaming_json_with_client"></a>Streaming JSON with @Client</h3>
<div class="paragraph">
<p>For example to write a client that streams data from the controller defined in the <a href="#clientStreaming">JSON Streaming</a> section of the documentation you can simply define a client that returns an unbound <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> such as a RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> or Reactor <code>Flux</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Flowable;
import reactor.core.publisher.Flux;

@Client("/streaming")
public interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines(); <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Flowable
import reactor.core.publisher.Flux

@Client("/streaming")
interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) <b class="conum">(1)</b>
    Flowable&lt;Headline&gt; streamHeadlines() <b class="conum">(2)</b>

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Flowable
import reactor.core.publisher.Flux


@Client("/streaming")
interface HeadlineClient {

    @Get(value = "/headlines", processes = [MediaType.APPLICATION_JSON_STREAM]) <b class="conum">(1)</b>
    fun streamHeadlines(): Flowable&lt;Headline&gt;  <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Get</code> method is defined as processing responses of type <code>APPLICATION_JSON_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> is used as the return type</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how the previously defined <code>HeadlineClient</code> can be invoked from a JUnit test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void testClientAnnotationStreaming() throws Exception {
        try( EmbeddedServer embeddedServer = ApplicationContext.run(EmbeddedServer.class) ) {
            HeadlineClient headlineClient = embeddedServer
                                                .getApplicationContext()
                                                .getBean(HeadlineClient.class); <b class="conum">(1)</b>

            Maybe&lt;Headline&gt; firstHeadline = headlineClient.streamHeadlines().firstElement(); <b class="conum">(2)</b>

            Headline headline = firstHeadline.blockingGet(); <b class="conum">(3)</b>

            assertNotNull( headline );
            assertTrue( headline.getText().startsWith("Latest Headline") );
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    void "test client annotation streaming"() throws Exception {
        when:
        HeadlineClient headlineClient = embeddedServer.getApplicationContext()
                                            .getBean(HeadlineClient.class) <b class="conum">(1)</b>

        Maybe&lt;Headline&gt; firstHeadline = headlineClient.streamHeadlines().firstElement() <b class="conum">(2)</b>

        Headline headline = firstHeadline.blockingGet() <b class="conum">(3)</b>

        then:
        null != headline
        headline.getText().startsWith("Latest Headline")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "test client annotation streaming" {
            val headlineClient = embeddedServer
                    .applicationContext
                    .getBean(HeadlineClient::class.java) <b class="conum">(1)</b>

            val firstHeadline = headlineClient.streamHeadlines().firstElement() <b class="conum">(2)</b>

            val headline = firstHeadline.blockingGet() <b class="conum">(3)</b>

            headline shouldNotBe null
            headline.text shouldStartWith "Latest Headline"
        }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The client is retrieved from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>firstElement</code> method is used to return the first emitted item from the <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> as a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Maybe.html">Maybe</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>blockingGet()</code> is used in the test to retrieve the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_clients_and_response_types"><a class="anchor" href="#_streaming_clients_and_response_types"></a>Streaming Clients and Response Types</h3>
<div class="paragraph">
<p>The example defined in the previous section expects the server to respond with a stream of JSON objects and the content type to be <code>application/x-json-stream</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">A JSON Stream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"title":"The Stand"}
{"title":"The Shining"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason for this is simple, a sequence of JSON object is not, in fact, valid JSON and hence the response content type cannot be <code>application/json</code>. For the JSON to be valid it would have to return an array:</p>
</div>
<div class="listingblock">
<div class="title">A JSON Array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {"title":"The Stand"},
    {"title":"The Shining"}
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s client does however support streaming of both individual JSON objects via <code>application/x-json-stream</code> and also JSON arrays defined with <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>If the server returns <code>application/json</code> and a non-single <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> is returned (such as an <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> or a Reactor <code>Flux</code>) then the client with stream the array elements as they become available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_clients_and_read_timeout"><a class="anchor" href="#_streaming_clients_and_read_timeout"></a>Streaming Clients and Read Timeout</h3>
<div class="paragraph">
<p>When streaming responses from servers, the underlying HTTP client will not apply the default <code>readTimeout</code> setting (which defaults to 10 seconds) of the <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> since the delay between reads for streaming responses may differ from normal reads.</p>
</div>
<div class="paragraph">
<p>Instead the <code>read-idle-timeout</code> setting (which defaults to 60 seconds) is used to dictate when a connection should be closed after becoming idle.</p>
</div>
<div class="paragraph">
<p>If you are streaming data from a server that defines a longer delay than 60 seconds between items being sent to the client you should adjust the <code>readIdleTimeout</code>. The following configuration in <code>application.yml</code> demonstrates how:</p>
</div>
<div class="listingblock">
<div class="title">Adjusting the readIdleTimeout</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-idle-timeout: 5m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example sets the <code>readIdleTimeout</code> to 5 minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_server_sent_events"><a class="anchor" href="#_streaming_server_sent_events"></a>Streaming Server Sent Events</h3>
<div class="paragraph">
<p>Micronaut features a native client for Server Sent Events (SSE) defined by the interface <a href="../api/io/micronaut/http/client/sse/SseClient.html">SseClient</a>.</p>
</div>
<div class="paragraph">
<p>You can use this client to stream SSE events from any server that emits them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although SSE streams are typically consumed by a browser <code>EventSource</code>, there are a few cases where you may wish to consume a SSE stream via <a href="../api/io/micronaut/http/client/sse/SseClient.html">SseClient</a> such as in unit testing or when a Micronaut service acts as a gateway for another service.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/Client.html">@Client</a> annotation also supports consuming SSE streams. For example, consider the following controller method that produces a stream of SSE events:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM) <b class="conum">(1)</b>
    Flux&lt;Event&lt;Headline&gt;&gt; streamHeadlines() {
        return Flux.&lt;Event&lt;Headline&gt;&gt;create((emitter) -&gt; {  <b class="conum">(2)</b>
            Headline headline = new Headline();
            headline.setText("Latest Headline at " + ZonedDateTime.now());
            emitter.next(Event.of(headline));
            emitter.complete();
        }).repeat(100) <b class="conum">(3)</b>
          .delayElements(Duration.ofSeconds(1)); <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM) <b class="conum">(1)</b>
    Flux&lt;Event&lt;Headline&gt;&gt; streamHeadlines() {
        Flux.&lt;Event&lt;Headline&gt;&gt;create { emitter -&gt; <b class="conum">(2)</b>
            Headline headline = new Headline()
            headline.setText("Latest Headline at " + ZonedDateTime.now())
            emitter.next(Event.of(headline))
            emitter.complete()
        }.repeat(100) <b class="conum">(3)</b>
         .delayElements(Duration.ofSeconds(1)) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get(value = "/headlines", processes = [MediaType.TEXT_EVENT_STREAM]) <b class="conum">(1)</b>
    internal fun streamHeadlines(): Flux&lt;Event&lt;Headline&gt;&gt; {
        return Flux.create&lt;Event&lt;Headline&gt;&gt; {  <b class="conum">(2)</b>
            emitter -&gt;
            val headline = Headline()
            headline.text = "Latest Headline at " + ZonedDateTime.now()
            emitter.next(Event.of(headline))
            emitter.complete()
        }.repeat(100) <b class="conum">(3)</b>
                .delayElements(Duration.ofSeconds(1)) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller defines a <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation that produces a <code>MediaType.TEXT_EVENT_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method itself uses Reactor to emit a hypothetical <code>Headline</code> object</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>repeat</code> method is used to repeat the emission 100 times</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>With a delay of 1 second between each item emitted.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that the return type of the controller is also <a href="../api/io/micronaut/http/sse/Event.html">Event</a> and that the <code>Event.of</code> method is used to create events to stream to the client.</p>
</div>
<div class="paragraph">
<p>To define a client that consumes the events you simply have to define a method that processes <code>MediaType.TEXT_EVENT_STREAM</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/streaming/sse")
public interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM)
    Flux&lt;Event&lt;Headline&gt;&gt; streamHeadlines();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/streaming/sse")
interface HeadlineClient {

    @Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM)
    Flux&lt;Event&lt;Headline&gt;&gt; streamHeadlines()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/streaming/sse")
interface HeadlineClient {

    @Get(value = "/headlines", processes = [MediaType.TEXT_EVENT_STREAM])
    fun streamHeadlines(): Flux&lt;Event&lt;Headline&gt;&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic type of the <code>Flux</code> or <code>Flowable</code> can be either an <a href="../api/io/micronaut/http/sse/Event.html">Event</a>, in which case you will receive the full event object, or a POJO, in which case you will receive only the data contained within the event converted from JSON.</p>
</div>
</div>

<h2 id="clientError"><a class="anchor" href="#clientError"></a>7.2.3 Error Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientError.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If an HTTP response is returned with a code of 400 or above, an <a href="../api/io/micronaut/client/response/exceptions/HttpClientResponseException.html">HttpClientResponseException</a> is created. The exception contains the original response. How that exception gets thrown depends on the return type of the method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For reactive response types, the exception is passed through the publisher as an error.</p>
</li>
<li>
<p>For blocking response types, the exception is thrown and should be caught and handled by the caller.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The one exception to this rule is HTTP Not Found (404) responses. This exception only applies to the declarative client.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HTTP Not Found (404) responses for blocking return types is <strong>not</strong> considered an error condition and the client exception will <strong>not</strong> be thrown. That behavior includes methods that return <code>void</code>.</p>
</div>
<div class="paragraph">
<p>If the method returns an <code>HttpResponse</code>, the original response will be returned. If the return type is <code>Optional</code>, an empty optional will be returned. For all other types, <code>null</code> will be returned.</p>
</div>

<h2 id="clientHeaders"><a class="anchor" href="#clientHeaders"></a>7.2.4 Customizing Request Headers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientHeaders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Customizing the request headers deserves special mention as there are several ways that can be accomplished.</p>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_configuration"><a class="anchor" href="#_populating_headers_using_configuration"></a>Populating Headers Using Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation can be declared at the type level and is repeatable such that it is possible to drive the request headers sent via configuration using annotation metadata.</p>
</div>
<div class="paragraph">
<p>The following example serves to illustrate this:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/pets")
@Header(name="X-Pet-Client", value="${pet.client.id}")
public interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age);

    @Get("/{name}")
    Single&lt;Pet&gt; get(String name);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/pets")
@Header(name="X-Pet-Client", value='${pet.client.id}')
interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age)

    @Get("/{name}")
    Single&lt;Pet&gt; get(String name)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/pets")
@Header(name = "X-Pet-Client", value = "\${pet.client.id}")
interface PetClient : PetOperations {

    override fun save(name: String, age: Int): Single&lt;Pet&gt;

    @Get("/{name}")
    operator fun get(name: String): Single&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation on the <code>PetClient</code> interface that reads a property using property placeholder configuration called <code>pet.client.id</code>.</p>
</div>
<div class="paragraph">
<p>In your application configuration you then set the following in <code>application.yml</code> to populate the value:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Headers in YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">pet:
    client:
        id: foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can supply a <code>PET_CLIENT_ID</code> environment variable and the value will be populated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_an_client_filter"><a class="anchor" href="#_populating_headers_using_an_client_filter"></a>Populating Headers using an Client Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alternatively if you need the ability to dynamically populate headers an alternative is to use a <a href="#clientFilter">Client Filter</a>.</p>
</div>
<div class="paragraph">
<p>For more information on writing client filters see the <a href="#clientFilter">Client Filters</a> section of the guide.</p>
</div>
</div>
</div>

<h2 id="clientJackson"><a class="anchor" href="#clientJackson"></a>7.2.5 Customizing Jackson Settings</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientJackson.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Jackson is used for message encoding to JSON. A default Jackson <code>ObjectMapper</code> is configured and used by Micronaut HTTP clients.</p>
</div>
<div class="paragraph">
<p>You can override the settings used to construct the <code>ObjectMapper</code> using the properties defined by the <a href="../api/io/micronaut/jackson/JacksonConfiguration.html">JacksonConfiguration</a> class in <code>application.yml</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following configuration enabled indented output for Jackson:</p>
</div>
<div class="listingblock">
<div class="title">Example Jackson Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
    serialization:
        indentOutput: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, these settings apply globally and impact both how the HTTP server renders JSON and how JSON is sent from the HTTP client. Given that sometimes it useful to provide client specific Jackson settings which can be done with the <a href="../api/io/micronaut/jackson/annotation/JacksonFeatures.html">@JacksonFeatures</a> annotation on any client:</p>
</div>
<div class="paragraph">
<p>As an example, the following snippet is taken from Micronaut&#8217;s native Eureka client (which, of course, is built using Micronaut&#8217;s HTTP client):</p>
</div>
<div class="listingblock">
<div class="title">Example of JacksonFeatures</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(id = EurekaClient.SERVICE_ID, path = "/eureka", configuration = EurekaConfiguration.class)
@JacksonFeatures(
    enabledSerializationFeatures = WRAP_ROOT_VALUE,
    disabledSerializationFeatures = WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED,
    enabledDeserializationFeatures = {UNWRAP_ROOT_VALUE, ACCEPT_SINGLE_VALUE_AS_ARRAY}
)
public interface EurekaClient {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Eureka serialization format for JSON uses the <code>WRAP_ROOT_VALUE</code> serialization feature of Jackson, hence it is enabled just for that client.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the customization offered by <code>JacksonFeatures</code> is not enough, you can also write a <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> for the <code>ObjectMapper</code> and add whatever customizations you need.
</td>
</tr>
</table>
</div>

<h2 id="clientRetry"><a class="anchor" href="#clientRetry"></a>7.2.6 Retry and Circuit Breaker</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientRetry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Being able to recover from failure is critical for HTTP clients, and that is where the integrated <a href="#retry">Retry Advice</a> included as part of Micronaut comes in really handy.</p>
</div>
<div class="paragraph">
<p>You can declare the <a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a> or <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">@CircuitBreaker</a> annotations on any <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> interface and the retry policy will be applied, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Client("/pets")
@Retryable
public interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Client("/pets")
@Retryable
interface PetClient extends PetOperations {

    @Override
    Single&lt;Pet&gt; save(String name, int age)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Client("/pets")
@Retryable
interface PetClient : PetOperations {

    override fun save(name: String, age: Int): Single&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on customizing retry, see the section on <a href="#retry">Retry Advice</a>.</p>
</div>

<h2 id="clientFallback"><a class="anchor" href="#clientFallback"></a>7.2.7 Client Fallbacks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/clientFallback.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems, failure happens and it is best to be prepared for it and handle it in as graceful a manner possible.</p>
</div>
<div class="paragraph">
<p>In addition, when developing Microservices it is quite common to work on a single Microservice without other Microservices the project requires being available.</p>
</div>
<div class="paragraph">
<p>With that in mind Micronaut features a native fallback mechanism that is integrated into <a href="#retry">Retry Advice</a> that allows falling back to another implementation in the case of failure.</p>
</div>
<div class="paragraph">
<p>Using the <a href="../api/io/micronaut/retry/annotation/Fallback.html">@Fallback</a> annotation you can declare a fallback implementation of a client that will be picked up and used once all possible retries have been exhausted.</p>
</div>
<div class="paragraph">
<p>In fact the mechanism is not strictly linked to Retry, you can declare any class as <a href="../api/io/micronaut/retry/annotation/Recoverable.html">@Recoverable</a> and if a method call fails (or, in the case of reactive types, an error is emitted) a class annotated with <code>@Fallback</code> will be searched for.</p>
</div>
<div class="paragraph">
<p>To illustrate this consider again the <code>PetOperations</code> interface declared earlier. You can define a <code>PetFallback</code> class that will be called in the case of failure:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Fallback
public class PetFallback implements PetOperations {
    @Override
    public Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet();
        pet.setAge(age);
        pet.setName(name);
        return Single.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Fallback
class PetFallback implements PetOperations {
    @Override
    public Single&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet()
        pet.setAge(age)
        pet.setName(name)
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Fallback
open class PetFallback : PetOperations {
    override fun save(name: String, age: Int): Single&lt;Pet&gt; {
        val pet = Pet()
        pet.age = age
        pet.name = name
        return Single.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you purely want to use fallbacks to help with testing against external Microservices you can define fallbacks in the <code>src/test/java</code> directory so they are not included in production code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see the fallback does not perform any network operations and is quite simple, hence will provide a successful result in the case of an external system being down.</p>
</div>
<div class="paragraph">
<p>Of course, the actual behaviour of the fallback is down to you. You could for example implement a fallback that pulls data from a local cache when the real data is not available, and sends alert emails to operations about downtime or whatever.</p>
</div>

<h2 id="netflixHystrix"><a class="anchor" href="#netflixHystrix"></a>7.2.8 Netflix Hystrix Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientAnnotation/netflixHystrix.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>netflix-hystrix</code> feature to configure Hystrix in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features netflix-hystrix</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/Netflix/Hystrix">Netflix Hystrix</a> is a fault tolerance library developed by the Netflix team and designed to improve resilience of inter process communication.</p>
</div>
<div class="paragraph">
<p>Micronaut features integration with Hystrix through the <code>netflix-hystrix</code> module, which you can add to your <code>build.gradle</code> or <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.configuration:micronaut-netflix-hystrix"</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_hystrixcommand_annotation"><a class="anchor" href="#_using_the_hystrixcommand_annotation"></a>Using the @HystrixCommand Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the above dependency declared you can annotate any method (including methods defined on <code>@Client</code> interfaces) with the <a href="../api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a> annotation and it will wrap the methods execution in a Hystrix command. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @HystrixCommand</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@HystrixCommand
String hello(String name) {
    return "Hello $name"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This works for reactive return types such as <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> etc. as well and the reactive type will be wrapped in a <code>HystrixObservableCommand</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a> annotation also integrates with Micronauts support for <a href="#retry">Retry Advice</a> and <a href="#clientFallback">Fallbacks</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For information on how to customize the Hystrix thread pool, group and properties see the javadoc for <a href="../api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">@HystrixCommand</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_hystrix_stream_dashboard"><a class="anchor" href="#_enabling_hystrix_stream_dashboard"></a>Enabling Hystrix Stream &amp; Dashboard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can enable a Server Sent Event stream to feed into the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> by setting the <code>hystrix.stream.enabled</code> setting to <code>true</code> in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Hystrix Stream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hystrix:
    stream:
        enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This exposes a <code>/hystrix.stream</code> endpoint with the format the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> expects.</p>
</div>
</div>
</div>

<h2 id="clientFilter"><a class="anchor" href="#clientFilter"></a>7.3 HTTP Client Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientFilter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when calling another Microservice.</p>
</div>
<div class="paragraph">
<p>To simplify this, Micronaut includes the ability to define <a href="../api/io/micronaut/http/filter/HttpClientFilter.html">HttpClientFilter</a> classes that are applied to all matching HTTP clients.</p>
</div>
<div class="paragraph">
<p>As an example say you want to build a client to communicate with the <a href="https://bintray.com/docs/api/">Bintray REST API</a>. It would be terribly tedious to have to specify authentication for every single HTTP call.</p>
</div>
<div class="paragraph">
<p>To resolve this burden you can define a filter. The following is an example <code>BintrayService</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
class BintrayService {
    final RxHttpClient client;
    final String org;

    BintrayService(
            @Client(BintrayApi.URL) RxHttpClient client,           <b class="conum">(1)</b>
            @Value("${bintray.organization}") String org ) {
        this.client = client;
        this.org = org;
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchRepositories() {
        return client.exchange(HttpRequest.GET("/repos/" + org), String.class); <b class="conum">(2)</b>
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchPackages(String repo) {
        return client.exchange(HttpRequest.GET("/repos/" + org + "/" + repo + "/packages"), String.class); <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
class BintrayService {
    final RxHttpClient client
    final String org

    BintrayService(
            @Client(BintrayApi.URL) RxHttpClient client,           <b class="conum">(1)</b>
            @Value('${bintray.organization}') String org ) {
        this.client = client
        this.org = org
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchRepositories() {
        return client.exchange(HttpRequest.GET("/repos/$org"), String) <b class="conum">(2)</b>
    }

    Flowable&lt;HttpResponse&lt;String&gt;&gt; fetchPackages(String repo) {
        return client.exchange(HttpRequest.GET("/repos/${org}/${repo}/packages"), String) <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
internal class BintrayService(
        @param:Client(BintrayApi.URL) val client: RxHttpClient, <b class="conum">(1)</b>
        @param:Value("\${bintray.organization}") val org: String) {

    fun fetchRepositories(): Flowable&lt;HttpResponse&lt;String&gt;&gt; {
        return client.exchange(HttpRequest.GET&lt;Any&gt;("/repos/$org"), String::class.java) <b class="conum">(2)</b>
    }

    fun fetchPackages(repo: String): Flowable&lt;HttpResponse&lt;String&gt;&gt; {
        return client.exchange(HttpRequest.GET&lt;Any&gt;("/repos/$org/$repo/packages"), String::class.java) <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An <a href="../api/io/micronaut/http/client/RxHttpClient.html">RxHttpClient</a> is injected for the Bintray API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The organization is configurable via configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Bintray API is secured. To authenticate you need to add an <code>Authorization</code> header for every request. You could modify <code>fetchRepositories</code> and <code>fetchPackages</code> methods to include the necessary HTTP Header for each request. Using a filter is much simpler though:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Filter("/repos/**") <b class="conum">(1)</b>
class BintrayFilter implements HttpClientFilter {

    final String username;
    final String token;

    BintrayFilter(
            @Value("${bintray.username}") String username, <b class="conum">(2)</b>
            @Value("${bintray.token}") String token ) { <b class="conum">(2)</b>
        this.username = username;
        this.token = token;
    }

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        return chain.proceed(
                request.basicAuth(username, token) <b class="conum">(3)</b>
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Filter('/repos/**') <b class="conum">(1)</b>
class BintrayFilter implements HttpClientFilter {


    final String username
    final String token

    BintrayFilter(
            @Value('${bintray.username}') String username, <b class="conum">(2)</b>
            @Value('${bintray.token}') String token ) { <b class="conum">(2)</b>
        this.username = username
        this.token = token
    }

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        return chain.proceed(
                request.basicAuth(username, token) <b class="conum">(3)</b>
        )
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Filter("/repos/**") <b class="conum">(1)</b>
internal class BintrayFilter(
        @param:Value("\${bintray.username}") val username: String, <b class="conum">(2)</b>
        @param:Value("\${bintray.token}") val token: String)<b class="conum">(2)</b>
    : HttpClientFilter {

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;&gt; {
        return chain.proceed(
                request.basicAuth(username, token) <b class="conum">(3)</b>
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can match only a subset of paths with a Client filter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>username</code> and <code>token</code> are injected via configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>basicAuth</code> method is used include the HTTP BASIC credentials</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, whenever you invoke the <code>bintrayService.fetchRepositories()</code> method, the <code>Authorization</code> HTTP header is included in the request.</p>
</div>
<div class="sect2">
<h3 id="_filter_matching_by_annotation"><a class="anchor" href="#_filter_matching_by_annotation"></a>Filter Matching By Annotation</h3>
<div class="paragraph">
<p>For cases where a filter should be applied to a client, regardless of the URL, filters can be matched by the presence of an annotation applied to both the filter and the client. Given the following client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;

@BasicAuth <b class="conum">(1)</b>
@Client("/message")
public interface BasicAuthClient {

    @Get
    String getMessage();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client

@BasicAuth <b class="conum">(1)</b>
@Client("/message")
interface BasicAuthClient {

    @Get
    String getMessage()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client

@BasicAuth <b class="conum">(1)</b>
@Client("/message")
interface BasicAuthClient {

    @Get
    fun getMessage(): String
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@BasicAuth</code> annotation is applied to the client</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following filter will filter the client requests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.filter.ClientFilterChain;
import io.micronaut.http.filter.HttpClientFilter;
import org.reactivestreams.Publisher;

import javax.inject.Singleton;

@BasicAuth <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
public class BasicAuthClientFilter implements HttpClientFilter {

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        return chain.proceed(request.basicAuth("user", "pass"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

import javax.inject.Singleton

@BasicAuth <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
class BasicAuthClientFilter implements HttpClientFilter {

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request, ClientFilterChain chain) {
        chain.proceed(request.basicAuth("user", "pass"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

import javax.inject.Singleton

@BasicAuth <b class="conum">(1)</b>
@Singleton <b class="conum">(2)</b>
class BasicAuthClientFilter : HttpClientFilter {

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;&gt; {
        return chain.proceed(request.basicAuth("user", "pass"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The same annotation, <code>@BasicAuth</code>, is applied to the filter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Normally the <code>@Filter</code> annotation makes filters singletons by default. Because the <code>@Filter</code> annotation is not used, the desired scope must be applied</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@BasicAuth</code> annotation is just an example and can be replaced with your own custom annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.FilterMatcher;

import java.lang.annotation.*;

@FilterMatcher <b class="conum">(1)</b>
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.TYPE, ElementType.PARAMETER})
public @interface BasicAuth {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.FilterMatcher

import java.lang.annotation.*

@FilterMatcher <b class="conum">(1)</b>
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.TYPE, ElementType.PARAMETER])
@interface BasicAuth {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.FilterMatcher

@FilterMatcher <b class="conum">(1)</b>
@MustBeDocumented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.CLASS, AnnotationTarget.VALUE_PARAMETER)
annotation class BasicAuth</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The only requirement for custom annotations is that the <a href="../api/io/micronaut/http/annotation/HttpFilterStereotype.html">@HttpFilterStereotype</a> annotation must be present</td>
</tr>
</table>
</div>
</div>

<h2 id="clientSample"><a class="anchor" href="#clientSample"></a>7.4 HTTP Client Sample</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpClient/clientSample.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the HTTP Client Guide (<a href="http://guides.micronaut.io/micronaut-http-client/guide/index.html">Java</a>,
<a href="http://guides.micronaut.io/micronaut-http-client-groovy/guide/index.html">Groovy</a>,
<a href="http://guides.micronaut.io/micronaut-http-client-kotlin/guide/index.html">Kotlin</a>), a step-by-step tutorial, to learn more.
</td>
</tr>
</table>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/httpServer.html">&lt;&lt; <strong>6</strong><span>The HTTP Server</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="https://docs.micronaut.io/docsassets/js/docs.js"></script>

</body>
</html>

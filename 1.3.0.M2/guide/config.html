<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Application Configuration 1.3.0.M2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/messaging.html"><strong>10</strong><span>Message-Driven Microservices</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/commandLineApps.html"><strong>11</strong><span>Standalone Command Line Applications</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configurations.html"><strong>12</strong><span>Configurations</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/languageSupport.html"><strong>13</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/management.html"><strong>14</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>15</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/multitenancy.html"><strong>16</strong><span>Multi-Tenancy</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cli.html"><strong>17</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/appendix.html"><strong>18</strong><span>Appendices</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/ioc.html">&lt;&lt; <strong>3</strong><span>Inversion of Control</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span> >></a></div>
                


                <div class="project">
                    <h1>4 Application Configuration</h1>

                    <p><strong>Version:</strong> 1.3.0.M2</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#environments"><strong>4.1</strong><span>The Environment</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#propertySource"><strong>4.2</strong><span>Externalized Configuration with PropertySources</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#valueAnnotation"><strong>4.3</strong><span>Configuration Injection</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#configurationProperties"><strong>4.4</strong><span>Configuration Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#customTypeConverter"><strong>4.5</strong><span>Custom Type Converters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#eachProperty"><strong>4.6</strong><span>Using @EachProperty to Drive Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#eachBean"><strong>4.7</strong><span>Using @EachBean to Drive Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#immutableConfig"><strong>4.8</strong><span>Immutable Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#jmx"><strong>4.9</strong><span>JMX Support</span></a>
                    </div>
                    
                </div>
                

                
<h1 id="config"><a class="anchor" href="#config"></a>4 Application Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Configuration in Micronaut takes inspiration from both Spring Boot and Grails, integrating configuration properties from multiple sources directly into the core IoC container.</p>
</div>
<div class="paragraph">
<p>Configuration can by default be provided in either Java properties, YAML, JSON or Groovy files. The convention is to search for a file called <code>application.yml</code>, <code>application.properties</code>, <code>application.json</code> or <code>application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>In addition, just like Spring and Grails, Micronaut allows overriding any property via system properties or environment variables.</p>
</div>
<div class="paragraph">
<p>Each source of configuration is modeled with the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> interface and the mechanism is extensible allowing the implementation of additional <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> implementations.</p>
</div>

<h2 id="environments"><a class="anchor" href="#environments"></a>4.1 The Environment</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/environments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The application environment is modelled by the api:context.env.Environment interface, which allows specifying one or many unique environment names when creating an <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run("test", "android");
        Environment environment = applicationContext.getEnvironment();

        assertTrue(environment.getActiveNames().contains("test"));
        assertTrue(environment.getActiveNames().contains("android"));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        ApplicationContext applicationContext = ApplicationContext.run("test", "android")
        Environment environment = applicationContext.getEnvironment()

        then:
        environment.getActiveNames().contains("test")
        environment.getActiveNames().contains("android")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run("test", "android")
        val environment = applicationContext.getEnvironment()

        assertTrue(environment.getActiveNames().contains("test"))
        assertTrue(environment.getActiveNames().contains("android"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The active environment names serve the purpose of allowing loading different configuration files depending on the environment and also using the <a href="../api/io/micronaut//context/annotation/Requires.html">@Requires</a> annotation to conditionally load beans or bean <a href="../api/io/micronaut//context/annotation/Configuration.html">@Configuration</a> packages.</p>
</div>
<div class="paragraph">
<p>In addition, Micronaut will attempt to detect the current environments. For example within a Spock or JUnit test the <a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a> environment will be automatically active.</p>
</div>
<div class="paragraph">
<p>Additional active environments can be specified using the <code>micronaut.environments</code> system property or the <code>MICRONAUT_ENVIRONMENTS</code> environment variable. These can be specified as a comma separated list. For example:</p>
</div>
<div class="listingblock">
<div class="title">Specifying environments</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -Dmicronaut.environments=foo,bar -jar myapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above activates environments called <code>foo</code> and <code>bar</code>.</p>
</div>
<div class="paragraph">
<p>Finally, the Cloud environment names are also detected. See the section on <a href="#cloudConfiguration">Cloud Configuration</a> for more information.</p>
</div>
<div class="sect1">
<h2 id="_disabling_environment_detection"><a class="anchor" href="#_disabling_environment_detection"></a>Disabling Environment Detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The automatic detection of environments can be disabled setting the <code>micronaut.env.deduction</code> system property or the <code>MICRONAUT_ENV_DEDUCTION</code> environment variable to <code>false</code>. This will prevent Micronaut from detecting current environments, while still using any environments that are specifically provided as shown above.</p>
</div>
<div class="listingblock">
<div class="title">Disabling environment detection via system property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$  java -Dmicronaut.env.deduction=false -jar myapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can disable environment deduction using the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a>'s <code>deduceEnvironment</code> method when setting up your application.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void testDisableEnvironmentDeductionViaBuilder() {
        ApplicationContext ctx = ApplicationContext.build().deduceEnvironment(false).start();
        assertFalse(ctx.getEnvironment().getActiveNames().contains(Environment.TEST));
        ctx.close();
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    void "test disable environment deduction via builder"() {
        when:
        ApplicationContext ctx = ApplicationContext.build().deduceEnvironment(false).start()

        then:
        !ctx.environment.activeNames.contains(Environment.TEST)

        cleanup:
        ctx.close()
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    "test disable environment deduction via builder"() {
        val ctx = ApplicationContext.build().deduceEnvironment(false).start()
        assertFalse(ctx.environment.activeNames.contains(Environment.TEST))
        ctx.close()
    }</code></pre>
</div>
</div>
</div>
</div>

<h2 id="propertySource"><a class="anchor" href="#propertySource"></a>4.2 Externalized Configuration with PropertySources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/propertySource.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Additional <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances can be added to the environment prior to initializing the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run(
                PropertySource.of(
                        "test",
                        CollectionUtils.mapOf(
                            "micronaut.server.host", "foo",
                            "micronaut.server.port", 8080
                        )
                ),
                "test", "android");
        Environment environment = applicationContext.getEnvironment();

        assertEquals(
                "foo",
                environment.getProperty("micronaut.server.host", String.class).orElse("localhost")
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        ApplicationContext applicationContext = ApplicationContext.run(
                PropertySource.of(
                        "test",
                        [
                            "micronaut.server.host": "foo",
                            "micronaut.server.port": 8080
                        ]
                ),
                "test", "android")
        Environment environment = applicationContext.getEnvironment()

        then:
        "foo" == environment.getProperty("micronaut.server.host", String.class).orElse("localhost")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run(
                PropertySource.of(
                        "test",
                        mapOf(
                                "micronaut.server.host" to "foo",
                                "micronaut.server.port" to 8080
                        )
                ),
                "test", "android")
        val environment = applicationContext.getEnvironment()

        assertEquals(
                "foo",
                environment.getProperty("micronaut.server.host", String::class.java).orElse("localhost")
        )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource.of</a> method can be used to create a <code>ProperySource</code> from a map of values.</p>
</div>
<div class="paragraph">
<p>Alternatively one can register a <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> by creating a <code>META-INF/services/io.micronaut.context.env.PropertySourceLoader</code> containing a reference to the class name of the <code>PropertySourceLoader</code>.</p>
</div>
<div class="sect2">
<h3 id="_included_propertysource_loaders"><a class="anchor" href="#_included_propertysource_loaders"></a>Included PropertySource Loaders</h3>
<div class="paragraph">
<p>Micronaut by default contains <code>PropertySourceLoader</code> implementations that load properties from the given locations and priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Command line arguments</p>
</li>
<li>
<p>Properties from <code>SPRING_APPLICATION_JSON</code> (for Spring compatibility)</p>
</li>
<li>
<p>Properties from <code>MICRONAUT_APPLICATION_JSON</code></p>
</li>
<li>
<p>Java System Properties</p>
</li>
<li>
<p>OS environment variables</p>
</li>
<li>
<p>Configuration files loaded in order from the system property 'micronaut.config.files' or the environment variable <code>MICRONAUT_CONFIG_FILES</code>. The value can be a comma separated list of paths with the last file have precedence. The files can be referenced from the file system as a path or the classpath with a <code>classpath:</code> prefix.</p>
</li>
<li>
<p>Enviroment-specific properties from <code>application-{environment}.{extension}</code></p>
</li>
<li>
<p>Application-specific properties from <code>application.{extension}</code></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>.properties</code>, <code>.json</code>, <code>.yml</code> are supported out of the box. For Groovy users <code>.groovy</code> is supported as well.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_property_value_placeholders"><a class="anchor" href="#_property_value_placeholders"></a>Property Value Placeholders</h3>
<div class="paragraph">
<p>Micronaut includes a property placeholder syntax which can be used to reference configuration properties both within configuration values and with any Micronaut annotation (see <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> and the section on <a href="#valueAnnotation">Configuration Injection</a>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Programmatic usage is also possible via the <a href="../api/io/micronaut/context/env/PropertyPlaceholderResolver.html">PropertyPlaceholderResolver</a> interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic syntax is to wrap a reference to a property in <code>${&#8230;&#8203;}</code>. For example in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Defining Property Placeholders</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
    endpoint: http://${micronaut.server.host}:${micronaut.server.port}/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example embeds references to the <code>micronaut.server.host</code> and <code>micronaut.server.port</code> properties.</p>
</div>
<div class="paragraph">
<p>You can specify default values by defining a value after the <code>:</code> character. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using Default Values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
    endpoint: http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will default to <code>localhost</code> and port <code>8080</code> if no value is found (rather than throwing an exception). Note that if default value itself contains a <code>:</code> character, you should escape it using back ticks:</p>
</div>
<div class="listingblock">
<div class="title">Using Backticks</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
    endpoint: ${server.address:`http://localhost:8080`}/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example tries to read a <code>server.address</code> property otherwise fallbacks back to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>, since the address has a <code>:</code> character we have to escape it with back ticks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_property_value_binding"><a class="anchor" href="#_property_value_binding"></a>Property Value Binding</h3>
<div class="paragraph">
<p>Note that these property references should always be in kebab case (lowercase and hyphen-separated) when placing references in code or in placeholder values. In other words you should use for example <code>micronaut.server.default-charset</code> and not <code>micronaut.server.defaultCharset</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut still allows specifying the latter in configuration, but normalizes the properties into kebab case form to optimize memory consumption and reduce complexity when resolving properties. The following table summarizes how properties are normalized from different sources:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Property Value Normalization</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Properties</th>
<th class="tableblock halign-left valign-top">Property Source</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myApp.myStuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.myStuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myApp.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MYAPP_MYSTUFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myapp.mystuff</code>, <code>myapp-mystuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment Variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MY_APP_MY_STUFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my.app.my.stuff</code>, <code>my.app.my-stuff</code>, <code>my.app-my.stuff</code>, <code>my.app-my-stuff</code>, <code>my-app.my.stuff</code>, <code>my-app.my-stuff</code>, <code>my-app-my.stuff</code>, <code>my-app-my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment Variable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Environment variables are given special treatment to allow the definition of environment variables to be more flexible.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Because the number of properties generated is exponential based on the number of <code>_</code> characters in the environment variable, it is recommended to refine which, if any, environment variables are included in configuration if the number of environment variables with a large number of underscores is high.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To control how environment properties participate in configuration, call the respective methods on the <code>Micronaut</code> builder.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.build(null)
                .mainClass(Application.class)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String[] args) {
        Micronaut.build()
                .mainClass(Application)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.build(null)
                .mainClass(Application::class.java)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start()
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration above does not have any impact on property placeholders. It is still possible to reference an environment variable in a placeholder regardless of whether environment configuration is disabled, or even if the specific property is explicitly excluded.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_random_properties"><a class="anchor" href="#_using_random_properties"></a>Using Random Properties</h3>
<div class="paragraph">
<p>You can use <code>random</code> values by using the following properties.  These can be used in configuration files as variables like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: myapplication
    instance:
      id: ${random.shortuuid}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Random Values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An available random port number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.shortuuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID of only 10 chars in length (Note: As this isn&#8217;t full UUID, collision COULD occur)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID with dashes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.uuid2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID without dashes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_fail_fast_property_injection"><a class="anchor" href="#_fail_fast_property_injection"></a>Fail Fast Property Injection</h3>
<div class="paragraph">
<p>For beans that inject required properties, the injection and potential failure will not occur until the bean is requested. To verify at startup that the properties exist and can be injected, the bean can be annotated with <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a>. Context scoped beans will be injected at startup time and thus will fail at startup time if any required properties are missing or could not be converted to the required type.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To maintain a fast startup time, it is recommended to use this feature as sparingly as possible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_log_levels_with_properties"><a class="anchor" href="#_controlling_log_levels_with_properties"></a>Controlling Log Levels with Properties</h3>
<div class="paragraph">
<p>Log levels can be configured via properties defined in <code>application.yml</code> (and environment variables) with the <code>log.level</code> prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logger:
    levels:
        foo.bar: ERROR</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the ability to control log levels via config is controlled via the <a href="../api/io/micronaut/logging/LoggingSystem.html">LoggingSystem</a> interface. Currently Micronaut ships with a single implementation that allows setting log levels for the Logback library. If another library is chosen you should provide a bean that implements this interface.</p>
</div>
</div>

<h2 id="valueAnnotation"><a class="anchor" href="#valueAnnotation"></a>4.3 Configuration Injection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/valueAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can inject configuration values into beans with Micronaut using the <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> annotation.</p>
</div>
<div class="sect2">
<h3 id="_using_the_code_value_code_annotation"><a class="anchor" href="#_using_the_code_value_code_annotation"></a>Using the <code>@Value</code> Annotation</h3>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.inject.Singleton;

@Singleton
public class EngineImpl implements Engine {

    @Value("${my.engine.cylinders:6}") <b class="conum">(1)</b>
    protected int cylinders;

    @Override
    public int getCylinders() {
        return this.cylinders;
    }

    public String start() {<b class="conum">(2)</b>
        return "Starting V" + getCylinders() + " Engine";
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import javax.inject.Singleton

@Singleton
class EngineImpl implements Engine {

    @Value('${my.engine.cylinders:6}') <b class="conum">(1)</b>
    protected int cylinders

    @Override
    int getCylinders() {
        this.cylinders
    }

    String start() { <b class="conum">(2)</b>
        "Starting V${cylinders} Engine"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import javax.inject.Singleton

@Singleton
class EngineImpl : Engine {

    @Value("\${my.engine.cylinders:6}") <b class="conum">(1)</b>
    override var cylinders: Int = 0
        protected set

    override fun start(): String {<b class="conum">(2)</b>
        return "Starting V$cylinders Engine"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Value</code> annotation accepts a string that can have embedded placeholder values (the default value can be provided by specifying a value after the colon <code>:</code> character).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The injected value can then be used within code.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>@Value</code> can also be used to inject a static value, for example the following will inject the number 10:</p>
</div>
<div class="listingblock">
<div class="title">Static @Value Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("10")
int number;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However it is definitely more useful when used to compose injected values combining static content and placeholders. For example to setup a URL:</p>
</div>
<div class="listingblock">
<div class="title">Placeholders with @Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("http://${my.host}:${my.port}")
URL url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the URL is constructed from 2 placeholder properties that must be present in configuration: <code>my.host</code> and <code>my.port</code>.</p>
</div>
<div class="paragraph">
<p>Remember that to specify a default value in a placeholder expression, you should use the colon <code>:</code> character, however if the default you are trying to specify has a colon then you should escape the value with back ticks. For example:</p>
</div>
<div class="listingblock">
<div class="title">Placeholders with @Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("${my.url:`http://foo.com`}")
URL url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is nothing special about <code>@Value</code> itself regarding the resolution of property value placeholders.</p>
</div>
<div class="paragraph">
<p>Due to Micronaut&#8217;s extensive support for annotation metadata you can in fact use property placeholder expressions on any annotation. For example, to make the path of a <code>@Controller</code> configurable you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("${hello.controller.path:/hello}")
class HelloController {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case if <code>hello.controller.path</code> is specified in configuration then the controller will be mapped to the path specified otherwise it will be mapped to <code>/hello</code>.</p>
</div>
<div class="paragraph">
<p>You can also make the target server for <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> configurable (although service discovery approaches are often better), for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("${my.server.url:`http://localhost:8080`}")
interface HelloClient {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the property <code>my.server.url</code> can be used to configure the client otherwise the client will fallback to a localhost address.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_code_property_code_annotation"><a class="anchor" href="#_using_the_code_property_code_annotation"></a>Using the <code>@Property</code> Annotation</h3>
<div class="paragraph">
<p>Recall that the <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> annotation receives a String value which is a mix of static content and placeholder expressions. This can lead to confusion if you attempt to do the following:</p>
</div>
<div class="listingblock">
<div class="title">Incorrect usage of <code>@Value</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("my.url")
String url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case the value <code>my.url</code> will be injected and set to the <code>url</code> field and <strong>not</strong> the value of the <code>my.url</code> property from your application configuration, this is because <code>@Value</code> only resolves placeholders within the value specified to it.</p>
</div>
<div class="paragraph">
<p>If you wish to inject a specific property name then you may be better off using <a href="../api/io/micronaut/context/annotation/Property.html">@Property</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Property;

import javax.inject.Inject;
import javax.inject.Singleton;

@Singleton
public class Engine {

    @Property(name = "my.engine.cylinders") <b class="conum">(1)</b>
    protected int cylinders; <b class="conum">(2)</b>

    private String manufacturer;

    public int getCylinders() {
        return cylinders;
    }

    public String getManufacturer() {
        return manufacturer;
    }

    @Inject
    public void setManufacturer(@Property(name = "my.engine.manufacturer") String manufacturer) { <b class="conum">(3)</b>
        this.manufacturer = manufacturer;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Property

import javax.inject.Singleton

@Singleton
class Engine {

    @Property(name = "my.engine.cylinders") <b class="conum">(1)</b>
    protected int cylinders <b class="conum">(2)</b>

    @Property(name = "my.engine.manufacturer") <b class="conum">(3)</b>
    String manufacturer

    int getCylinders() {
        cylinders
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Property

import javax.inject.Inject
import javax.inject.Singleton


@Singleton
class Engine {

    @field:Property(name = "my.engine.cylinders") <b class="conum">(1)</b>
    protected var cylinders: Int = 0 <b class="conum">(2)</b>

    @set:Inject
    @setparam:Property(name = "my.engine.manufacturer") <b class="conum">(3)</b>
    var manufacturer: String? = null

    fun cylinders(): Int {
        return cylinders
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>my.engine.cylinders</code> property will be resolved from configuration and injected directly into the field.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fields subjected to injection should never be private otherwise expensive reflection must be used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@Property</code> annotation is used to inject through the setter</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because it is not possible to define a default value with <code>@Property</code>, if the value doesn&#8217;t exist or cannot be converted to the required type, the bean instantiation will fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above will instead inject the value of the <code>my.url</code> property resolved from application configuration. If the property can not be found in configuration, an exception will be thrown. As with other types of injection, the injection point can also be annotated with <code>@Nullable</code> to make the injection optional.</p>
</div>
<div class="paragraph">
<p>You can also use this feature to resolve sub maps. For example, consider the following configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>application.yml</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
    default:
        name: 'mydb'
jpa:
    default:
        properties:
            hibernate:
                hbm2ddl:
                    auto: update
                show_sql: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to resolve a flattened map containing only the properties starting with <code>hibernate</code> then you can do so with <code>@Property</code>, for example:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@Property</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(name = "jpa.default.properties")
Map&lt;String, String&gt; jpaProperties;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The injected map will contain the keys <code>hibernate.hbm2ddl.auto</code> and <code>hibernate.show_sql</code> and their values.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/core/convert/format/MapFormat.html">@MapFormat</a> annotation can be used to customize the injected map depending whether you want nested keys, flat keys and it allows customization of the key style via the <a href="../api/io/micronaut/core/naming/conventions/StringConvention.html">StringConvention</a> enum.
</td>
</tr>
</table>
</div>
</div>

<h2 id="configurationProperties"><a class="anchor" href="#configurationProperties"></a>4.4 Configuration Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/configurationProperties.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can create type safe configuration by creating classes that are annotated with
 <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut will produce a reflection-free <code>@ConfigurationProperties</code> bean and will also at compile time calculate the property paths to evaluate, greatly improving the speed and efficiency of loading <code>@ConfigurationProperties</code>.</p>
</div>
<div class="paragraph">
<p>An example of a configuration class can be seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
public class EngineConfig {
    public String getManufacturer() {
        return manufacturer;
    }

    public void setManufacturer(String manufacturer) {
        this.manufacturer = manufacturer;
    }

    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    public CrankShaft getCrankShaft() {
        return crankShaft;
    }

    public void setCrankShaft(CrankShaft crankShaft) {
        this.crankShaft = crankShaft;
    }

    @NotBlank <b class="conum">(2)</b>
    private String manufacturer = "Ford"; <b class="conum">(3)</b>
    @Min(1L)
    private int cylinders;
    private CrankShaft crankShaft = new CrankShaft();

    @ConfigurationProperties("crank-shaft")
    public static class CrankShaft { <b class="conum">(4)</b>
        public Optional&lt;Double&gt; getRodLength() {
            return rodLength;
        }

        public void setRodLength(Optional&lt;Double&gt; rodLength) {
            this.rodLength = rodLength;
        }

        private Optional&lt;Double&gt; rodLength = Optional.empty(); <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties('my.engine') <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank <b class="conum">(2)</b>
    String manufacturer = "Ford" <b class="conum">(3)</b>

    @Min(1L)
    int cylinders
    CrankShaft crankShaft = new CrankShaft()

    @ConfigurationProperties('crank-shaft')
    static class CrankShaft { <b class="conum">(4)</b>
        Optional&lt;Double&gt; rodLength = Optional.empty() <b class="conum">(5)</b>
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import java.util.*

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank <b class="conum">(2)</b>
    var manufacturer = "Ford" <b class="conum">(3)</b>
    @Min(1L)
    var cylinders: Int = 0
    var crankShaft = CrankShaft()

    @ConfigurationProperties("crank-shaft")
    class CrankShaft { <b class="conum">(4)</b>
        var rodLength: Optional&lt;Double&gt; = Optional.empty() <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <code>javax.validation</code> to validate the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default values can be assigned to the property</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Static inner classes can provided nested configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional configuration values can be wrapped in a <code>java.util.Optional</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have prepared a type safe configuration it can simply be injected into your objects like any other bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class EngineImpl implements Engine {
    private final EngineConfig config;

    public EngineImpl(EngineConfig config) {<b class="conum">(1)</b>
        this.config = config;
    }

    @Override
    public int getCylinders() {
        return config.getCylinders();
    }

    public String start() {<b class="conum">(2)</b>
        return getConfig().getManufacturer() + " Engine Starting V" + getConfig().getCylinders() +
                " [rodLength=" + getConfig().getCrankShaft().getRodLength().orElse(6.0d) + "]";
    }

    public final EngineConfig getConfig() {
        return config;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class EngineImpl implements Engine {
    final EngineConfig config

    EngineImpl(EngineConfig config) { <b class="conum">(1)</b>
        this.config = config
    }

    @Override
    int getCylinders() {
        config.cylinders
    }

    String start() { <b class="conum">(2)</b>
        "${config.manufacturer} Engine Starting V${config.cylinders} [rodLength=${config.crankShaft.rodLength.orElse(6.0d)}]"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
class EngineImpl(val config: EngineConfig) : Engine {<b class="conum">(1)</b>

    override val cylinders: Int
        get() = config.cylinders

    override fun start(): String {<b class="conum">(2)</b>
        return "${config.manufacturer} Engine Starting V${config.cylinders} [rodLength=${config.crankShaft.rodLength.orElse(6.0)}]"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EngineConfig</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the configuration properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration values can then be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        LinkedHashMap&lt;String, Object&gt; map = new LinkedHashMap(1);
        map.put("my.engine.cylinders", "8");
        ApplicationContext applicationContext = ApplicationContext.run(map, "test");

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                ['my.engine.cylinders': '8'],
                "test"
        )

        Vehicle vehicle = applicationContext
                .getBean(Vehicle)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val map = mapOf( "my.engine.cylinders" to "8")
        val applicationContext = ApplicationContext.run(map, "test")

        val vehicle = applicationContext.getBean(Vehicle::class.java)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Ford Engine Starting V8 [rodLength=6.0]"</code></p>
</div>
<div class="paragraph">
<p>Note for more complex configurations you can structure <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans through inheritance.</p>
</div>
<div class="paragraph">
<p>For example creating a subclass of <code>EngineConfig</code> with <code>@ConfigurationProperties('bar')</code> will resolve all properties under the path <code>my.engine.bar</code>.</p>
</div>
<div class="sect1">
<h2 id="_includes_excludes"><a class="anchor" href="#_includes_excludes"></a>Includes / Excludes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the cases where the configuration properties class is inheriting properties from a parent class, it may be desirable to exclude properties from the parent class. The <code>includes</code> and <code>excludes</code> members of the <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation allow for that functionality. The list applies to both local properties and inherited properties.</p>
</div>
<div class="paragraph">
<p>The names supplied to the includes/excludes list should be the "property" name. For example if a setter method is injected, the property name is the de-capitalized setter name (<code>setConnectionTimeout</code> &#8594; <code>connectionTimeout</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_property_type_conversion"><a class="anchor" href="#_property_type_conversion"></a>Property Type Conversion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When resolving properties Micronaut will use the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> bean to convert properties. You can register additional converters for types not supported by micronaut by defining beans that implement the <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> interface.</p>
</div>
<div class="paragraph">
<p>Micronaut features some built-in conversions that are useful, which are detailed below.</p>
</div>
<div class="sect2">
<h3 id="_duration_conversion"><a class="anchor" href="#_duration_conversion"></a>Duration Conversion</h3>
<div class="paragraph">
<p>Durations can be specified by appending the unit with a number. Supported units are <code>s</code>, <code>ms</code>, <code>m</code> etc. The following table summarizes examples:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Duration Conversion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 milliseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 hours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10ns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 nanoseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PT15M</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration of 15 minutes using ISO-8601 format</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example to configure the default HTTP client read timeout:</p>
</div>
<div class="listingblock">
<div class="title">Using Duration Values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-timeout: 15s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_list_array_conversion"><a class="anchor" href="#_list_array_conversion"></a>List / Array Conversion</h3>
<div class="paragraph">
<p>Lists and arrays can be specified in Java properties files as comma-separated values or in YAML using native YAML lists. The generic types are used to convert the values. For example in YAML:</p>
</div>
<div class="listingblock">
<div class="title">Specifying lists or arrays in YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">my:
    app:
        integers:
            - 1
            - 2
        urls:
            - http://foo.com
            - http://bar.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in Java properties file format:</p>
</div>
<div class="listingblock">
<div class="title">Specifying lists or arrays in Java properties comma-separated</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">my.app.integers=1,2
my.app.urls=http://foo.com,http://bar.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can use an index:</p>
</div>
<div class="listingblock">
<div class="title">Specifying lists or arrays in Java properties using index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">my.app.integers[0]=1
my.app.integers[1]=2</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the above example configurations you can define properties to bind to with the target type supplied via generics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Integer&gt; integers;
List&lt;URL&gt; urls;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_readable_bytes"><a class="anchor" href="#_readable_bytes"></a>Readable Bytes</h3>
<div class="paragraph">
<p>You can annotate any setter parameter with <a href="../api/io/micronaut/core/convert/format/ReadableBytes.html">@ReadableBytes</a> to allow the value to be set using a shorthand syntax for specifying bytes, kilobytes etc. For example the following is taken from <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@ReadableBytes</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setMaxContentLength(@ReadableBytes int maxContentLength) {
    this.maxContentLength = maxContentLength;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above in place you can set <code>micronaut.http.client.max-content-length</code> using the following values:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. @ReadableBytes Conversion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10mb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 megabytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10kb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 kilobytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10gb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 gigabytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A raw byte length</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_formatting_dates"><a class="anchor" href="#_formatting_dates"></a>Formatting Dates</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/convert/format/Format.html">@Format</a> annotation can be used on any setter to allow the date format to be specified when binding <code>javax.time</code> date objects.</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@Format</code> for Dates</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setMyDate(@Format("yyyy-MM-dd") LocalDate date) {
    this.myDate = date;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_builder"><a class="anchor" href="#_configuration_builder"></a>Configuration Builder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many existing frameworks and tools already use builder-style classes to construct configuration.</p>
</div>
<div class="paragraph">
<p>To support the ability for a builder style class to be populated with configuration values, the <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">@ConfigurationBuilder</a> annotation can be used. <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">ConfigurationBuilder</a> can be added to a field or method in a class annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Since there is no consistent way to define builders in the Java world, one or more method prefixes can be specified in the annotation to support builder methods like <code>withXxx</code> or <code>setXxx</code>. If the builder methods have no prefix, assign an empty string to the parameter.</p>
</div>
<div class="paragraph">
<p>A configuration prefix can also be specified to tell Micronaut where to look for configuration values. By default, the builder methods will use the configuration prefix defined at the class level <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationBuilder;
import io.micronaut.context.annotation.ConfigurationProperties;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
class EngineConfig {

    @ConfigurationBuilder(prefixes = "with") <b class="conum">(2)</b>
    EngineImpl.Builder builder = EngineImpl.builder();

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "crank-shaft") <b class="conum">(3)</b>
    CrankShaft.Builder crankShaft = CrankShaft.builder();

    private SparkPlug.Builder sparkPlug = SparkPlug.builder();

    SparkPlug.Builder getSparkPlug() { return this.sparkPlug; }

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "spark-plug") <b class="conum">(4)</b>
    void setSparkPlug(SparkPlug.Builder sparkPlug) {
        this.sparkPlug = sparkPlug;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationBuilder
import io.micronaut.context.annotation.ConfigurationProperties

@ConfigurationProperties('my.engine') <b class="conum">(1)</b>
class EngineConfig {

    @ConfigurationBuilder(prefixes = "with") <b class="conum">(2)</b>
    EngineImpl.Builder builder = EngineImpl.builder()

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "crank-shaft") <b class="conum">(3)</b>
    CrankShaft.Builder crankShaft = CrankShaft.builder()

    SparkPlug.Builder sparkPlug = SparkPlug.builder()

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "spark-plug") <b class="conum">(4)</b>
    void setSparkPlug(SparkPlug.Builder sparkPlug) {
        this.sparkPlug = sparkPlug
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationBuilder
import io.micronaut.context.annotation.ConfigurationProperties

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
internal class EngineConfig {
    @ConfigurationBuilder(prefixes = ["with"])  <b class="conum">(2)</b>
    val builder = EngineImpl.builder()

    @ConfigurationBuilder(prefixes = ["with"], configurationPrefix = "crank-shaft") <b class="conum">(3)</b>
    val crankShaft = CrankShaft.builder()

    @set:ConfigurationBuilder(prefixes = ["with"], configurationPrefix = "spark-plug") <b class="conum">(4)</b>
    var sparkPlug = SparkPlug.builder()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first builder can be configured without the class configuration prefix; it will inherit from the above.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The second builder can be configured with the class configuration prefix + the <code>configurationPrefix</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The third builder demonstrates that the annotation can be applied to a method as well as a property.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, only builder methods that take a single argument are supported. To support methods with no arguments, set the <code>allowZeroArgs</code> parameter of the annotation to true.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just like in the previous example, we can construct an <code>EngineImpl</code>. Since we are using a builder, a factory class can be used to build the engine from the builder.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Factory;

import javax.inject.Singleton;

@Factory
class EngineFactory {

    @Singleton
    EngineImpl buildEngine(EngineConfig engineConfig) {
        return engineConfig.builder.build(engineConfig.crankShaft, engineConfig.getSparkPlug());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Factory

import javax.inject.Singleton

@Factory
class EngineFactory {

    @Singleton
    EngineImpl buildEngine(EngineConfig engineConfig) {
        engineConfig.builder.build(engineConfig.crankShaft, engineConfig.sparkPlug)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import javax.inject.Singleton

@Factory
internal class EngineFactory {

    @Singleton
    fun buildEngine(engineConfig: EngineConfig): EngineImpl {
        return engineConfig.builder.build(engineConfig.crankShaft, engineConfig.sparkPlug)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The engine that was returned can then be injected anywhere an engine is depended on.</p>
</div>
<div class="paragraph">
<p>Configuration values can be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        HashMap&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
        properties.put("my.engine.cylinders"             ,"4");
        properties.put("my.engine.manufacturer"          , "Subaru");
        properties.put("my.engine.crank-shaft.rod-length", 4);
        properties.put("my.engine.spark-plug.name"       , "6619 LFR6AIX");
        properties.put("my.engine.spark-plug.type"       , "Iridium");
        properties.put("my.engine.spark-plug.companyName", "NGK");
        ApplicationContext applicationContext = ApplicationContext.run(properties, "test");

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                ['my.engine.cylinders'             : '4',
                 'my.engine.manufacturer'          : 'Subaru',
                 'my.engine.crank-shaft.rod-length': 4,
                 'my.engine.spark-plug.name'       : '6619 LFR6AIX',
                 'my.engine.spark-plug.type'       : 'Iridium',
                 'my.engine.spark-plug.companyName': 'NGK'
                ],
                "test"
        )

        Vehicle vehicle = applicationContext
                .getBean(Vehicle)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run(
                mapOf(
                        "my.engine.cylinders" to "4",
                        "my.engine.manufacturer" to "Subaru",
                        "my.engine.crank-shaft.rod-length" to 4,
                        "my.engine.spark-plug.name" to "6619 LFR6AIX",
                        "my.engine.spark-plug.type" to "Iridium",
                        "my.engine.spark-plug.company" to "NGK"
                ),
                "test"
        )

        val vehicle = applicationContext.getBean(Vehicle::class.java)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Subaru Engine Starting V4 [rodLength=4.0, sparkPlug=Iridium(NGK 6619 LFR6AIX)]"</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mapformat"><a class="anchor" href="#_mapformat"></a>MapFormat</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For some use cases it may be desirable to accept a map of arbitrary configuration properties that can be supplied to a bean, especially if the bean represents a third-party API where not all of the possible configuration properties are known by the developer. For example, a datasource may accept a map of configuration properties specific to a particular database driver, allowing the user to specify any desired options in the map without coding every single property explicitly.</p>
</div>
<div class="paragraph">
<p>For this purpose, the <a href="../api/io/micronaut/core/convert/format/MapFormat.html">MapFormat</a> annotation allows you to bind a map to a single configuration property, and specify whether to accept a flat map of keys to values, or a nested map (where the values may be additional maps].</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import javax.validation.constraints.Min;
import java.util.Map;
import io.micronaut.core.convert.format.MapFormat;

@ConfigurationProperties("my.engine")
public class EngineConfig {
    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    public Map&lt;Integer, String&gt; getSensors() {
        return sensors;
    }

    public void setSensors(Map&lt;Integer, String&gt; sensors) {
        this.sensors = sensors;
    }

    @Min(1L)
    private int cylinders;
    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) <b class="conum">(1)</b>
    private Map&lt;Integer, String&gt; sensors;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties
import javax.validation.constraints.Min
import io.micronaut.core.convert.format.MapFormat

@ConfigurationProperties('my.engine')
class EngineConfig {

    @Min(1L)
    int cylinders

    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) <b class="conum">(1)</b>
    Map&lt;Integer, String&gt; sensors

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import javax.validation.constraints.Min
import io.micronaut.core.convert.format.MapFormat

@ConfigurationProperties("my.engine")
class EngineConfig {

    @Min(1L)
    var cylinders: Int = 0
    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) <b class="conum">(1)</b>
    var sensors: Map&lt;Int, String&gt;? = null
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the <code>transformation</code> argument to the annotation; possible values are <code>MapTransformation.FLAT</code> (for flat maps) and <code>MapTransformation.NESTED</code> (for nested maps)</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Singleton
public class EngineImpl implements Engine {
    @Override
    public Map getSensors() {
        return config.getSensors();
    }

    public String start() {
        return "Engine Starting V" + getConfig().getCylinders() + " [sensors=" + getSensors().size() + "]";
    }

    public EngineConfig getConfig() {
        return config;
    }

    public void setConfig(EngineConfig config) {
        this.config = config;
    }

    @Inject
    private EngineConfig config;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Singleton
class EngineImpl implements Engine {

    @Inject EngineConfig config

    @Override
    Map getSensors() {
        config.sensors
    }

    String start() {
        "Engine Starting V${config.cylinders} [sensors=${sensors.size()}]"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Singleton
class EngineImpl : Engine {
    override val sensors: Map&lt;*, *&gt;?
        get() = config!!.sensors

    @Inject
    var config: EngineConfig? = null

    override fun start(): String {
        return "Engine Starting V${config!!.cylinders} [sensors=${sensors!!.size}]"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now a map of properties can be supplied to the <code>my.engine.sensors</code> configuration property.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        LinkedHashMap&lt;String, Object&gt; map = new LinkedHashMap(2);
        map.put("my.engine.cylinders", "8");
        LinkedHashMap&lt;Integer, String&gt; map1 = new LinkedHashMap(2);
        map1.put(0, "thermostat");
        map1.put(1, "fuel pressure");
        map.put("my.engine.sensors", map1);
        ApplicationContext applicationContext = ApplicationContext.run(map, "test");

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        DefaultGroovyMethods.println(this, vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                ['my.engine.cylinders': '8', 'my.engine.sensors': [0: 'thermostat', 1: 'fuel pressure']],
                "test"
        )

        Vehicle vehicle = applicationContext
                .getBean(Vehicle)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val subMap = mapOf(
                0 to "thermostat",
                1 to "fuel pressure"
        )
        val map = mapOf(
                "my.engine.cylinders" to "8",
                "my.engine.sensors" to subMap
        )
        val applicationContext = ApplicationContext.run(map, "test")

        val vehicle = applicationContext.getBean(Vehicle::class.java)
        DefaultGroovyMethods.println(this, vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Engine Starting V8 [sensors=2]"</code></p>
</div>
</div>
</div>

<h2 id="customTypeConverter"><a class="anchor" href="#customTypeConverter"></a>4.5 Custom Type Converters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/customTypeConverter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features a built in type conversion mechanism that is extensible. To add additional type converters you register beans of type <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use one of the built-in converters (Map to an Object) or create your own.</p>
</div>
<div class="paragraph">
<p>Consider the following <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">ConfigurationProperties</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
public class MyConfigurationProperties {
    public LocalDate getUpdatedAt() {
        return this.updatedAt;
    }

    public static final String PREFIX = "myapp";
    protected LocalDate updatedAt;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
class MyConfigurationProperties {
    public static final String PREFIX = "myapp"
    protected LocalDate updatedAt

    LocalDate getUpdatedAt() {
        return this.updatedAt
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
class MyConfigurationProperties {
    var updatedAt: LocalDate? = null
        protected set

    companion object {
        const val PREFIX = "myapp"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type <code>MyConfigurationProperties</code> features a property called <code>updatedAt</code> which is of type <a href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html">LocalDate</a>.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s say you want to allow binding to this property from a map via configuration:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    private static ApplicationContext ctx;

    @BeforeClass
    public static void setupCtx() {
        ctx = ApplicationContext.run(
                new LinkedHashMap&lt;String, Object&gt;() {{
                    put("myapp.updatedAt", <b class="conum">(1)</b>
                            new LinkedHashMap&lt;String, Integer&gt;() {{
                                put("day", 28);
                                put("month", 10);
                                put("year", 1982);
                            }}
                    );
                }}
        );
    }

    @AfterClass
    public static void teardownCtx() {
        if(ctx != null) {
            ctx.stop();
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @AutoCleanup
    @Shared
    ApplicationContext ctx = ApplicationContext.run(
            "myapp.updatedAt": [day: 28, month: 10, year: 1982]  <b class="conum">(1)</b>
    )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    lateinit var ctx: ApplicationContext

    @BeforeEach
    fun setup() {
        ctx = ApplicationContext.run(
                mapOf(
                        "myapp.updatedAt" to mapOf( <b class="conum">(1)</b>
                                "day" to 28,
                                "month" to 10,
                                "year" to 1982
                        )
                )
        )
    }

    @AfterEach
    fun teardown() {
        ctx?.close()
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note how we match the <code>myapp</code> prefix and <code>updatedAt</code> property name in our <code>MyConfigurationProperties</code> class above</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This won&#8217;t work by default, since there is no built in conversion from <code>Map</code> to <code>LocalDate</code>. To resolve this you can define a custom <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.convert.ConversionContext;
import io.micronaut.core.convert.ConversionService;
import io.micronaut.core.convert.TypeConverter;

import javax.inject.Singleton;
import java.time.DateTimeException;
import java.time.LocalDate;
import java.util.Map;
import java.util.Optional;

@Singleton
public class MapToLocalDateConverter implements TypeConverter&lt;Map, LocalDate&gt; { <b class="conum">(1)</b>
    @Override
    public Optional&lt;LocalDate&gt; convert(Map propertyMap, Class&lt;LocalDate&gt; targetType, ConversionContext context) {
        Optional&lt;Integer&gt; day = ConversionService.SHARED.convert(propertyMap.get("day"), Integer.class);
        Optional&lt;Integer&gt; month = ConversionService.SHARED.convert(propertyMap.get("month"), Integer.class);
        Optional&lt;Integer&gt; year = ConversionService.SHARED.convert(propertyMap.get("year"), Integer.class);
        if (day.isPresent() &amp;&amp; month.isPresent() &amp;&amp; year.isPresent()) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())); <b class="conum">(2)</b>
            } catch (DateTimeException e) {
                context.reject(propertyMap, e); <b class="conum">(3)</b>
                return Optional.empty();
            }

        }

        return Optional.empty();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.convert.TypeConverter

import javax.inject.Singleton
import java.time.DateTimeException
import java.time.LocalDate

@Singleton
class MapToLocalDateConverter implements TypeConverter&lt;Map, LocalDate&gt; { <b class="conum">(1)</b>
    @Override
    Optional&lt;LocalDate&gt; convert(Map propertyMap, Class&lt;LocalDate&gt; targetType, ConversionContext context) {
        Optional&lt;Integer&gt; day = ConversionService.SHARED.convert(propertyMap.get("day"), Integer.class)
        Optional&lt;Integer&gt; month = ConversionService.SHARED.convert(propertyMap.get("month"), Integer.class)
        Optional&lt;Integer&gt; year = ConversionService.SHARED.convert(propertyMap.get("year"), Integer.class)
        if (day.isPresent() &amp;&amp; month.isPresent() &amp;&amp; year.isPresent()) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())) <b class="conum">(2)</b>
            } catch (DateTimeException e) {
                context.reject(propertyMap, e) <b class="conum">(3)</b>
                return Optional.empty()
            }
        }
        return Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.convert.TypeConverter

import javax.inject.Singleton
import java.time.DateTimeException
import java.time.LocalDate
import java.util.Optional

@Singleton
class MapToLocalDateConverter : TypeConverter&lt;Map&lt;*, *&gt;, LocalDate&gt; { <b class="conum">(1)</b>
    override fun convert(propertyMap: Map&lt;*, *&gt;, targetType: Class&lt;LocalDate&gt;, context: ConversionContext): Optional&lt;LocalDate&gt; {
        val day = ConversionService.SHARED.convert(propertyMap["day"], Int::class.java)
        val month = ConversionService.SHARED.convert(propertyMap["month"], Int::class.java)
        val year = ConversionService.SHARED.convert(propertyMap["year"], Int::class.java)
        if (day.isPresent &amp;&amp; month.isPresent &amp;&amp; year.isPresent) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())) <b class="conum">(2)</b>
            } catch (e: DateTimeException) {
                context.reject(propertyMap, e) <b class="conum">(3)</b>
                return Optional.empty()
            }

        }

        return Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class implements <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> which takes two generic arguments. The type you are converting from and the type you are converting to</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The implementation delegate to the default shared conversion service to convert the parts of the map that make the day, month and year into a <code>LocalDate</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If an exception occurs you can call <code>reject(..)</code> which propagates additional information to the container if something goes wrong during binding</td>
</tr>
</table>
</div>

<h2 id="eachProperty"><a class="anchor" href="#eachProperty"></a>4.6 Using @EachProperty to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/eachProperty.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation is great for a single configuration class, but sometimes you want multiple instances each with their own distinct configuration. That is where <a href="../api/io/micronaut/context/annotation/EachProperty.html">EachProperty</a> comes in.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> annotation will create a <code>ConfigurationProperties</code> bean for each sub-property within the given property. As an example consider the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Parameter;
import io.micronaut.context.annotation.EachProperty;

@EachProperty("test.datasource")  <b class="conum">(1)</b>
public class DataSourceConfiguration {

    private final String name;
    private URI url = new URI("localhost");

    public DataSourceConfiguration(@Parameter String name) <b class="conum">(2)</b>
            throws URISyntaxException {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public URI getUrl() { <b class="conum">(3)</b>
        return url;
    }

    public void setUrl(URI url) {
        this.url = url;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@EachProperty("test.datasource")
<b class="conum">(1)</b>
class DataSourceConfiguration {

    final String name
    URI url = new URI("localhost")

    DataSourceConfiguration(@Parameter String name) <b class="conum">(2)</b>
            throws URISyntaxException {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@EachProperty("test.datasource")  <b class="conum">(1)</b>
class DataSourceConfiguration <b class="conum">(2)</b>
@Throws(URISyntaxException::class)
constructor(@param:Parameter val name: String) {
    <b class="conum">(3)</b>
    var url = URI("localhost")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EachProperty</code> annotation defines the property name that should be handled.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Parameter</code> annotation can be used to inject the name of the sub-property that defines the name of the bean (which is also the bean qualifier)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each property of the bean is bound to configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above <code>DataSourceConfiguration</code> defines a <code>url</code> property to configure one or many hypothetical data sources of some sort. The URLs themselves can be configured using any of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances evaluated to Micronaut:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run(PropertySource.of(
                "test",
                CollectionUtils.mapOf(
                        "test.datasource.one.url", "jdbc:mysql://localhost/one",
                        "test.datasource.two.url", "jdbc:mysql://localhost/two")

        ));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    ApplicationContext applicationContext = ApplicationContext.run(PropertySource.of(
            "test",
            [
                    "test.datasource.one.url": "jdbc:mysql://localhost/one",
                    "test.datasource.two.url": "jdbc:mysql://localhost/two"
            ]
    ))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val applicationContext = ApplicationContext.run(PropertySource.of(
                "test",
                mapOf(
                        "test.datasource.one.url" to "jdbc:mysql://localhost/one",
                        "test.datasource.two.url" to "jdbc:mysql://localhost/two"
                )
        ))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example two data sources (called <code>one</code> and <code>two</code>) are defined under the <code>test.datasource</code> prefix defined earlier in the <code>@EachProperty</code> annotation. Each of these configuration entries triggers the creation of a new <code>DataSourceConfiguration</code> bean such that the following test succeeds:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Collection&lt;DataSourceConfiguration&gt; beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration.class);
        assertEquals(2, beansOfType.size()); <b class="conum">(1)</b>

        DataSourceConfiguration firstConfig = applicationContext.getBean(
                DataSourceConfiguration.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        );

        assertEquals(
                new URI("jdbc:mysql://localhost/one"),
                firstConfig.getUrl()
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Collection&lt;DataSourceConfiguration&gt; beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration.class)
        assertEquals(2, beansOfType.size()) <b class="conum">(1)</b>

        DataSourceConfiguration firstConfig = applicationContext.getBean(
                DataSourceConfiguration.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )

        then:
        new URI("jdbc:mysql://localhost/one") == firstConfig.getUrl()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration::class.java)
        assertEquals(2, beansOfType.size.toLong()) <b class="conum">(1)</b>

        val firstConfig = applicationContext.getBean(
                DataSourceConfiguration::class.java,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )

        assertEquals(
                URI("jdbc:mysql://localhost/one"),
                firstConfig.url
        )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All beans of type <code>DataSourceConfiguration</code> can be retrieved using <code>getBeansOfType</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Individual beans can be achieved by using the <code>byName</code> qualifier.</td>
</tr>
</table>
</div>

<h2 id="eachBean"><a class="anchor" href="#eachBean"></a>4.7 Using @EachBean to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/eachBean.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> is a great way to drive dynamic configuration, but typically you want to inject that configuration into another bean that depends on it. Injecting a single instance with a hard coded qualifier is not a great solution, hence <code>@EachProperty</code> is typically used in combination with <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Factory <b class="conum">(1)</b>
public class DataSourceFactory {

    @EachBean(DataSourceConfiguration.class) <b class="conum">(2)</b>
    DataSource dataSource(DataSourceConfiguration configuration) { <b class="conum">(3)</b>
        URI url = configuration.getUrl();
        return new DataSource(url);
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Factory <b class="conum">(1)</b>
class DataSourceFactory {

    @EachBean(DataSourceConfiguration.class) <b class="conum">(2)</b>
    DataSource dataSource(DataSourceConfiguration configuration) { <b class="conum">(3)</b>
        URI url = configuration.getUrl()
        return new DataSource(url)
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Factory <b class="conum">(1)</b>
class DataSourceFactory {

    @EachBean(DataSourceConfiguration::class) <b class="conum">(2)</b>
    internal fun dataSource(configuration: DataSourceConfiguration): DataSource { <b class="conum">(3)</b>
        val url = configuration.url
        return DataSource(url)
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above example defines a bean <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> that will create instances of <code>javax.sql.DataSource</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a> annotation is used to indicate that a new <code>DataSource</code> bean should be created for each <code>DataSourceConfiguration</code> defined in the previous section.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>DataSourceConfiguration</code> instance is injected as a method argument and used to drive the configuration of each <code>javax.sql.DataSource</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>@EachBean</code> requires that the parent bean has a <code>@Named</code> qualifier, since the qualifier is inherited by each bean created by <code>@EachBean</code>.</p>
</div>
<div class="paragraph">
<p>In other words, to retrieve the <code>DataSource</code> created by <code>test.datasource.one</code> you can do:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        Collection&lt;DataSource&gt; beansOfType = applicationContext.getBeansOfType(DataSource.class);
        assertEquals(2, beansOfType.size()); <b class="conum">(1)</b>

        DataSource firstConfig = applicationContext.getBean(
                DataSource.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        );</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when:
        Collection&lt;DataSource&gt; beansOfType = applicationContext.getBeansOfType(DataSource.class)
        assertEquals(2, beansOfType.size()) <b class="conum">(1)</b>

        DataSource firstConfig = applicationContext.getBean(
                DataSource.class,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val beansOfType = applicationContext.getBeansOfType(DataSource::class.java)
        assertEquals(2, beansOfType.size.toLong()) <b class="conum">(1)</b>

        val firstConfig = applicationContext.getBean(
                DataSource::class.java,
                Qualifiers.byName("one") <b class="conum">(2)</b>
        )</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We demonstrate here that there are indeed two data sources. How can we get one in particular?</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By using <code>Qualifiers.byName("one")</code>, we can select which of the two beans we&#8217;d like to reference.</td>
</tr>
</table>
</div>

<h2 id="immutableConfig"><a class="anchor" href="#immutableConfig"></a>4.8 Immutable Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/immutableConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.3, Micronaut supports the definition of immutable configuration.</p>
</div>
<div class="paragraph">
<p>There are two ways to define immutable configuration. The preferred way is to define an interface that is annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import io.micronaut.core.bind.annotation.Bindable;
import javax.validation.constraints.*;
import java.util.Optional;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
public interface EngineConfig {

    @Bindable(defaultValue = "Ford") <b class="conum">(2)</b>
    @NotBlank <b class="conum">(3)</b>
    String getManufacturer();

    @Min(1L)
    int getCylinders();

    @NotNull
    CrankShaft getCrankShaft(); <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    interface CrankShaft { <b class="conum">(5)</b>
        Optional&lt;Double&gt; getRodLength(); <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable
import javax.validation.constraints.*


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
interface EngineConfig {

    @Bindable(defaultValue = "Ford") <b class="conum">(2)</b>
    @NotBlank <b class="conum">(3)</b>
    String getManufacturer()

    @Min(1L)
    int getCylinders()

    @NotNull
    CrankShaft getCrankShaft() <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    static interface CrankShaft { <b class="conum">(5)</b>
        Optional&lt;Double&gt; getRodLength() <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable
import javax.validation.constraints.*
import java.util.Optional


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
interface EngineConfig {

    @get:Bindable(defaultValue = "Ford") <b class="conum">(2)</b>
    @get:NotBlank <b class="conum">(3)</b>
    val manufacturer: String

    @get:Min(1L)
    val cylinders: Int

    @get:NotNull
    val crankShaft: CrankShaft <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    interface CrankShaft { <b class="conum">(5)</b>
        val rodLength: Double? <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation takes the configuration prefix and is declared on an interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a> to set a default value if you want</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Validation annotations can be used too</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can also specify references to other <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can nest immutable configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional configuration can be indicated by returning an <code>Optional</code> or specifying <code>@Nullable</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case what Micronaut does is provide a compilation time implementation that delegates all getters to call the <code>getProperty(..)</code> method of the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface.</p>
</div>
<div class="paragraph">
<p>This has the advantage that if the application&#8217;s configuration is <a href="#refreshable">refreshed</a> (for example by invoking the <code>/refresh</code> endpoint) then the injected interface will automatically see the new values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you try to specify any other abstract method other than a getter a compilation error will occur (default methods are supported).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative way to implement immutable configuration is to define a class and use the <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a> annotation on a constructor of a <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> or <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> bean.</p>
</div>
<div class="paragraph">
<p>An example of an immutable configuration class can be seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.*;
import io.micronaut.core.bind.annotation.Bindable;
import javax.annotation.Nullable;
import javax.validation.constraints.*;
import java.util.Optional;

@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
public class EngineConfig {

    private final String manufacturer;
    private final int cylinders;
    private final CrankShaft crankShaft;

    @ConfigurationInject <b class="conum">(2)</b>
    public EngineConfig(
            @Bindable(defaultValue = "Ford") @NotBlank String manufacturer, <b class="conum">(3)</b>
            @Min(1L) int cylinders, <b class="conum">(4)</b>
            @NotNull CrankShaft crankShaft) {
        this.manufacturer = manufacturer;
        this.cylinders = cylinders;
        this.crankShaft = crankShaft;
    }

    public String getManufacturer() {
        return manufacturer;
    }

    public int getCylinders() {
        return cylinders;
    }

    public CrankShaft getCrankShaft() {
        return crankShaft;
    }

    @ConfigurationProperties("crank-shaft")
    public static class CrankShaft { <b class="conum">(5)</b>
        private final Double rodLength; <b class="conum">(6)</b>

        @ConfigurationInject
        public CrankShaft(@Nullable Double rodLength) {
            this.rodLength = rodLength;
        }

        public Optional&lt;Double&gt; getRodLength() {
            return Optional.ofNullable(rodLength);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.*
import io.micronaut.core.bind.annotation.Bindable
import javax.annotation.Nullable
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank
import javax.validation.constraints.NotNull


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
class EngineConfig {

    private final String manufacturer
    private final int cylinders
    private final CrankShaft crankShaft

    @ConfigurationInject <b class="conum">(2)</b>
    EngineConfig(
                  @Bindable(defaultValue = "Ford") @NotBlank String manufacturer, <b class="conum">(3)</b>
                  @Min(1L) int cylinders, <b class="conum">(4)</b>
                  @NotNull CrankShaft crankShaft) {
        this.manufacturer = manufacturer
        this.cylinders = cylinders
        this.crankShaft = crankShaft
    }

    String getManufacturer() {
        return manufacturer
    }

    int getCylinders() {
        return cylinders
    }

    CrankShaft getCrankShaft() {
        return crankShaft
    }

    @ConfigurationProperties("crank-shaft")
    static class CrankShaft { <b class="conum">(5)</b>
        private final Double rodLength <b class="conum">(6)</b>

        @ConfigurationInject
        CrankShaft(@Nullable Double rodLength) {
            this.rodLength = rodLength
        }

        Optional&lt;Double&gt; getRodLength() {
            return Optional.ofNullable(rodLength)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.*
import io.micronaut.core.bind.annotation.Bindable
import javax.validation.constraints.*
import java.util.Optional


@ConfigurationProperties("my.engine") <b class="conum">(1)</b>
data class EngineConfig @ConfigurationInject <b class="conum">(2)</b>
    constructor(
        @Bindable(defaultValue = "Ford") @NotBlank <b class="conum">(3)</b>
        val manufacturer: String,
        @Min(1L) <b class="conum">(4)</b>
        val cylinders: Int,
        @NotNull val crankShaft: CrankShaft) {

    @ConfigurationProperties("crank-shaft")
    data class CrankShaft @ConfigurationInject
    constructor(<b class="conum">(5)</b>
            private val rodLength: Double? <b class="conum">(6)</b>
    ) {

        fun getRodLength(): Optional&lt;Double&gt; {
            return Optional.ofNullable(rodLength)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a>  annotation is defined on the constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a> to set a default value if you want</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Validation annotations can be used too</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can nest immutable configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional configuration can be indicated with <code>@Nullable</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a> annotation provides a hint to Micronaut to prioritize binding values from configuration instead of injecting beans.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using this approach if you want the configuration to be refreshable then you must add the <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a> annotation to the class as well. This allows the bean to be re-created in the case of a <a href="#refreshable">runtime configuration refresh event</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are a few exceptions to this rule. Micronaut will not perform configuration binding for a parameter if one of these conditions is met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The parameter is annotated with <code>@Value</code> (explicit binding)</p>
</li>
<li>
<p>The parameter is annotated with <code>@Property</code> (explicit binding)</p>
</li>
<li>
<p>The parameter is annotated with <code>@Parameter</code> (parameterized bean handling)</p>
</li>
<li>
<p>The type of the parameter is annotated with a bean scope (such as <code>@Singleton</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you have prepared a type safe configuration it can simply be injected into your objects like any other bean:</p>
</div>

<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EngineConfig</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the configuration properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration values can then be supplied when running the application. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        ApplicationContext applicationContext = ApplicationContext.run(CollectionUtils.mapOf(
                "my.engine.cylinders", "8",
                "my.engine.crank-shaft.rod-length", "7.0"
        ));

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                "my.engine.cylinders": "8",
                "my.engine.crank-shaft.rod-length": "7.0"
        )

        Vehicle vehicle = applicationContext.getBean(Vehicle.class)
        System.out.println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val map = mapOf(
                "my.engine.cylinders" to "8",
                "my.engine.crank-shaft.rod-length" to "7.0"
        )
        val applicationContext = ApplicationContext.run(map)

        val vehicle = applicationContext.getBean(Vehicle::class.java)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Ford Engine Starting V8 [rodLength=7B.0]"</code></p>
</div>

<h2 id="jmx"><a class="anchor" href="#jmx"></a>4.9 JMX Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/config/jmx.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut provides basic support for JMX.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://micronaut-projects.github.io/micronaut-jmx/latest/guide/">documentation</a> for the micronaut-jmx project.</p>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/ioc.html">&lt;&lt; <strong>3</strong><span>Inversion of Control</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="https://docs.micronaut.io/docsassets/js/docs.js"></script>

</body>
</html>

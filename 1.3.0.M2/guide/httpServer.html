<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>6 The HTTP Server 1.3.0.M2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="https://docs.micronaut.io/docsassets/css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/ioc.html"><strong>3</strong><span>Inversion of Control</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/config.html"><strong>4</strong><span>Application Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/aop.html"><strong>5</strong><span>Aspect Oriented Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpServer.html"><strong>6</strong><span>The HTTP Server</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloud.html"><strong>8</strong><span>Cloud Native Features</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/serverlessFunctions.html"><strong>9</strong><span>Serverless Functions</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/messaging.html"><strong>10</strong><span>Message-Driven Microservices</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/commandLineApps.html"><strong>11</strong><span>Standalone Command Line Applications</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configurations.html"><strong>12</strong><span>Configurations</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/languageSupport.html"><strong>13</strong><span>Language Support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/management.html"><strong>14</strong><span>Management &amp; Monitoring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>15</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/multitenancy.html"><strong>16</strong><span>Multi-Tenancy</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cli.html"><strong>17</strong><span>Micronaut CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/appendix.html"><strong>18</strong><span>Appendices</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/aop.html">&lt;&lt; <strong>5</strong><span>Aspect Oriented Programming</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span> >></a></div>
                


                <div class="project">
                    <h1>6 The HTTP Server</h1>

                    <p><strong>Version:</strong> 1.3.0.M2</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#runningServer"><strong>6.1</strong><span>Running the Embedded Server</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#runningSpecificPort"><strong>6.2</strong><span>Running Server on a Specific Port</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#routing"><strong>6.3</strong><span>HTTP Routing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#binding"><strong>6.4</strong><span>Simple Request Binding</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#hostResolution"><strong>6.5</strong><span>Host Resolution</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#clientIpAddress"><strong>6.6</strong><span>Client IP Address</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#requestResponse"><strong>6.7</strong><span>The HttpRequest and HttpResponse</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#statusAnnotation"><strong>6.8</strong><span>Response Status</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#producesAnnotation"><strong>6.9</strong><span>Response Content-Type</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#consumesAnnotation"><strong>6.10</strong><span>Accepted Request Content-Type</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#reactiveServer"><strong>6.11</strong><span>Reactive HTTP Request Processing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#bodyAnnotation"><strong>6.11.1</strong><span>Using the @Body Annotation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#reactiveResponses"><strong>6.11.2</strong><span>Reactive Responses</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#jsonBinding"><strong>6.12</strong><span>JSON Binding with Jackson</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#datavalidation"><strong>6.13</strong><span>Data Validation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#staticResources"><strong>6.14</strong><span>Serving Static Resources</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#errorHandling"><strong>6.15</strong><span>Error Handling</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#apiVersioning"><strong>6.16</strong><span>API Versioning</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#formData"><strong>6.17</strong><span>Handling Form Data</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#serverIO"><strong>6.18</strong><span>Writing Response Data</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#uploads"><strong>6.19</strong><span>File Uploads</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#transfers"><strong>6.20</strong><span>File Transfers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#filters"><strong>6.21</strong><span>HTTP Filters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#sessions"><strong>6.22</strong><span>HTTP Sessions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#sse"><strong>6.23</strong><span>Server Sent Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#websocket"><strong>6.24</strong><span>WebSocket Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#websocketServer"><strong>6.24.1</strong><span>Using @ServerWebSocket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#websocketClient"><strong>6.24.2</strong><span>Using @ClientWebSocket</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#serverEvents"><strong>6.25</strong><span>Server Events</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#serverConfiguration"><strong>6.26</strong><span>Configuring the HTTP Server</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#threadPools"><strong>6.26.1</strong><span>Configuring Server Thread Pools</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#cors"><strong>6.26.2</strong><span>Configuring CORS</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#https"><strong>6.26.3</strong><span>Securing the Server with HTTPS</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#dualProtocol"><strong>6.26.4</strong><span>Enabling HTTP and HTTPS</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#views"><strong>6.27</strong><span>Server Side View Rendering</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#openapi"><strong>6.28</strong><span>OpenAPI / Swagger Support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#graphql"><strong>6.29</strong><span>GraphQL Support</span></a>
                    </div>
                    
                </div>
                

                
<h1 id="httpServer"><a class="anchor" href="#httpServer"></a>6 The HTTP Server</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI&#8217;s <code>create-app</code> command, the <code>http-server</code> dependency is included by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut includes both non-blocking HTTP server and client APIs based on <a href="https://netty.io">Netty</a>.</p>
</div>
<div class="paragraph">
<p>The design of the HTTP server in Micronaut is optimized for interchanging messages between Microservices, typically in JSON, and is not intended as a full server-side MVC framework. For example, there is currently no support for server-side views or features typical of a traditional server-side MVC framework.</p>
</div>
<div class="paragraph">
<p>The goal of the HTTP server is to make it as easy as possible to expose APIs that can be consumed by HTTP clients, whatever language they may be written in. To use the HTTP server you must have the <code>http-server-netty</code> dependency on your classpath.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut:micronaut-http-server-netty'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-http-server-netty&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>A "Hello World" server application can be seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello") <b class="conum">(1)</b>
public class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    public String index() {
        return "Hello World"; <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller('/hello') <b class="conum">(1)</b>
class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) <b class="conum">(2)</b>
    String index() {
        'Hello World' <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello") <b class="conum">(1)</b>
class HelloController {

    @Get(produces = [MediaType.TEXT_PLAIN]) <b class="conum">(2)</b>
    fun index(): String {
        return "Hello World" <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/hello</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method will respond to a GET request to <code>/hello</code> and returns a response with a <code>text/plain</code> content type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>By defining method called <code>index</code>, by convention the method is exposed via the <code>/hello</code> URI</td>
</tr>
</table>
</div>

<h2 id="runningServer"><a class="anchor" href="#runningServer"></a>6.1 Running the Embedded Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/runningServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the server simply create an <code>Application</code> class with a <code>static void main</code> method. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String... args) {
        Micronaut.run Application.class
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.run(Application.javaClass)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the application from a unit test you can use the <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Property;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import javax.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class HelloControllerSpec {
    @Inject
    EmbeddedServer server; <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client; <b class="conum">(2)</b>

    @Test
    void testHelloWorldResponse() {
        String response = client.toBlocking() <b class="conum">(3)</b>
                .retrieve(HttpRequest.GET("/hello"));
        assertEquals("Hello World", response); //) <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.annotation.MicronautTest
import spock.lang.Specification
import javax.inject.Inject

@MicronautTest
class HelloControllerSpec extends Specification {
    @Inject
    EmbeddedServer embeddedServer <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client <b class="conum">(2)</b>

    void "test hello world response"() {
        expect:
            client.toBlocking() <b class="conum">(3)</b>
                    .retrieve(HttpRequest.GET('/hello')) == "Hello World" <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Property
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import javax.inject.Inject

@MicronautTest
class HelloControllerSpec {

    @Inject
    lateinit var server: EmbeddedServer <b class="conum">(1)</b>

    @Inject
    @field:Client("/")
    lateinit var client: HttpClient <b class="conum">(2)</b>

    @Test
    fun testHelloWorldResponse() {
        val rsp: String = client.toBlocking() <b class="conum">(3)</b>
                .retrieve("/hello")
        assertEquals("Hello World", rsp) <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>EmbeddedServer</code> is run and Spock&#8217;s <code>@AutoCleanup</code> annotation ensures the server is stopped after the specification completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EmbeddedServer</code> interface provides the <code>URL</code> of the server under test which runs on a random port.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The test uses the Micronaut http client to make the call</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>retrieve</code> method returns the response of the controller as a <code>String</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Without explicit port configuration, the port will be 8080, unless the application is run under the <code>test</code> environment. In that case the port will be random. When the application context is started from the context of a test class, the test environment is added automatically.
</td>
</tr>
</table>
</div>

<h2 id="runningSpecificPort"><a class="anchor" href="#runningSpecificPort"></a>6.2 Running Server on a Specific Port</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/runningSpecificPort.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default the server runs on port 8080. However, you can set the server to run on a specific port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    port: 8086</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is also possible to be configured from an environment variable: <code>MICRONAUT_SERVER_PORT=8086</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run on a random port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    port: -1</code></pre>
</div>
</div>

<h2 id="routing"><a class="anchor" href="#routing"></a>6.3 HTTP Routing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/routing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation used in the previous section is one of <a href="../api/io/micronaut/http/annotation/package-summary.html">several annotations</a> that allow you to control the construction of HTTP routes.</p>
</div>
<div class="sect1">
<h2 id="_uri_paths"><a class="anchor" href="#_uri_paths"></a>URI Paths</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The value of the <code>@Controller</code> annotation is a <a href="https://tools.ietf.org/html/rfc6570">RFC-6570 URI template</a> you can therefore embed URI variables within the path using the syntax defined by the URI template specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many other frameworks, including Spring, implement the URI template specification
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The actual implementation is handled by the <a href="../api/io/micronaut/http/uri/UriMatchTemplate.html">UriMatchTemplate</a> class, which extends <a href="../api/io/micronaut/http/uri/UriTemplate.html">UriTemplate</a>.</p>
</div>
<div class="paragraph">
<p>You can use this class explicitly within your application to build URIs. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        UriMatchTemplate template = UriMatchTemplate.of("/hello/{name}");

        assertTrue(template.match("/hello/John").isPresent()); <b class="conum">(1)</b>
        assertEquals("/hello/John", template.expand(  <b class="conum">(2)</b>
                Collections.singletonMap("name", "John")
        ));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        given:
        UriMatchTemplate template = UriMatchTemplate.of("/hello/{name}")

        expect:
        template.match("/hello/John").isPresent() <b class="conum">(1)</b>
        template.expand(["name": "John"]) == "/hello/John" <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        val template = UriMatchTemplate.of("/hello/{name}")

        assertTrue(template.match("/hello/John").isPresent) <b class="conum">(1)</b>
        assertEquals("/hello/John", template.expand(mapOf("name" to "John")))  <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>match</code> method can be used to match a path</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>expand</code> method can be used to expand a template into a URI.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have a requirement to build paths to include in your responses you can use <a href="../api/io/micronaut/http/uri/UriTemplate.html">UriTemplate</a> to do so.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uri_path_variables"><a class="anchor" href="#_uri_path_variables"></a>URI Path Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>URI variables can be referenced via method arguments. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.PathVariable;

@Controller("/issues") <b class="conum">(1)</b>
public class IssuesController {

    @Get("/{number}") <b class="conum">(2)</b>
    public String issue(@PathVariable Integer number) { <b class="conum">(3)</b>
        return "Issue # " + number + "!"; <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.PathVariable

@Controller("/issues") <b class="conum">(1)</b>
class IssuesController {

    @Get("/{number}") <b class="conum">(2)</b>
    String issue(@PathVariable Integer number) { <b class="conum">(3)</b>
        "Issue # " + number + "!" <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.PathVariable

@Controller("/issues") <b class="conum">(1)</b>
class IssuesController {

    @Get("/{number}") <b class="conum">(2)</b>
    fun issue(@PathVariable number: Int): String { <b class="conum">(3)</b>
        return "Issue # $number!" <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Controller</code> annotation is specified with a base URI of <code>/issues</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Get.html">Get</a> annotation is used to map the method to an HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> with a URI variable embedded in the URI called <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The method argument can be optionally annotated with <a href="../api/io/micronaut/http/annotation/PathVariable.html">PathVariable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The value of the URI variable is referenced in the implementation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut will map the URI <code>/issues/{number}</code> for the above controller. We can assert this is the case by writing a set of unit tests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.ApplicationContext;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.exceptions.HttpClientResponseException;
import io.micronaut.runtime.server.EmbeddedServer;
import org.junit.AfterClass;
import org.junit.BeforeClass;
import org.junit.Test;
import org.junit.jupiter.api.Assertions;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

public class IssuesControllerTest {

    private static EmbeddedServer server;
    private static HttpClient client;

    @BeforeClass <b class="conum">(1)</b>
    public static void setupServer() {
        server = ApplicationContext.run(EmbeddedServer.class);
        client = server
                    .getApplicationContext()
                    .createBean(HttpClient.class, server.getURL());
    }

    @AfterClass <b class="conum">(2)</b>
    public static void stopServer() {
        if(server != null) {
            server.stop();
        }
        if(client != null) {
            client.stop();
        }
    }

    @Test
    public void testIssue() throws Exception {
        String body = client.toBlocking().retrieve("/issues/12"); <b class="conum">(3)</b>

        assertNotNull(body);
        assertEquals("Issue # 12!", body); <b class="conum">(4)</b>
    }

    @Test
    public void testShowWithInvalidInteger() {
        HttpClientResponseException e =Assertions.assertThrows(HttpClientResponseException.class, () -&gt;
                client.toBlocking().exchange("/issues/hello"));

        assertEquals(400, e.getStatus().getCode()); <b class="conum">(5)</b>
    }

    @Test
    public void testIssueWithoutNumber() {
        HttpClientResponseException e = Assertions.assertThrows(HttpClientResponseException.class, () -&gt;
                client.toBlocking().exchange("/issues/"));

        assertEquals(404, e.getStatus().getCode()); <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.ApplicationContext
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.exceptions.HttpClientResponseException
import io.micronaut.runtime.server.EmbeddedServer
import spock.lang.AutoCleanup
import spock.lang.Shared
import spock.lang.Specification

class IssuesControllerTest extends Specification {

    @Shared
    @AutoCleanup <b class="conum">(2)</b>
    EmbeddedServer embeddedServer = ApplicationContext.run(EmbeddedServer) <b class="conum">(1)</b>

    @Shared
    @AutoCleanup <b class="conum">(2)</b>
    HttpClient client = HttpClient.create(embeddedServer.URL) <b class="conum">(1)</b>

    void "test issue"() {
        when:
        String body = client.toBlocking().retrieve("/issues/12") <b class="conum">(3)</b>

        then:
        body != null
        body == "Issue # 12!" <b class="conum">(4)</b>
    }

    void "/issues/{number} with an invalid Integer number responds 400"() {
        when:
        client.toBlocking().exchange("/issues/hello")

        then:
        HttpClientResponseException e = thrown(HttpClientResponseException)
        e.status.code == 400 <b class="conum">(5)</b>
    }

    void "/issues/{number} without number responds 404"() {
        when:
        client.toBlocking().exchange("/issues/")

        then:
        HttpClientResponseException e = thrown(HttpClientResponseException)
        e.status.code == 404 <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.ApplicationContext
import io.micronaut.http.client.exceptions.HttpClientResponseException
import io.micronaut.runtime.server.EmbeddedServer
import io.kotlintest.shouldBe
import io.kotlintest.shouldNotBe
import io.kotlintest.shouldThrow
import io.kotlintest.specs.StringSpec
import io.micronaut.http.client.RxHttpClient

class IssuesControllerTest: StringSpec() {

    val embeddedServer = autoClose( <b class="conum">(2)</b>
            ApplicationContext.run(EmbeddedServer::class.java) <b class="conum">(1)</b>
    )

    val client = autoClose( <b class="conum">(2)</b>
            embeddedServer.applicationContext.createBean(RxHttpClient::class.java, embeddedServer.getURL()) <b class="conum">(1)</b>
    )

    init {
        "test issue" {
            val body = client.toBlocking().retrieve("/issues/12") <b class="conum">(3)</b>

            body shouldNotBe null
            body shouldBe "Issue # 12!" <b class="conum">(4)</b>
        }

        "test issue with invalid integer" {
            val e = shouldThrow&lt;HttpClientResponseException&gt; { client.toBlocking().exchange&lt;Any&gt;("/issues/hello") }

            e.status.code shouldBe 400 <b class="conum">(5)</b>
        }

        "test issue without number" {
            val e = shouldThrow&lt;HttpClientResponseException&gt; { client.toBlocking().exchange&lt;Any&gt;("/issues/") }

            e.status.code shouldBe 404 <b class="conum">(6)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The embedded server and http client is being started</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The server and client will be cleaned up after all of the tests have finished</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The tests sends a request to the URI <code>/issues/12</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>And then asserts the response is "Issue # 12"</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Another test asserts a 400 response is returned when an invalid number is sent in the URL</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Another test asserts a 404 response is returned when no number is provided in the URL. The variable being present is required in order for the route to be executed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the URI template in the previous example requires that the <code>number</code> variable is specified. You can specify optional URI templates with the syntax: <code>/issues{/number}</code> and by annotating the <code>number</code> parameter with <code>@Nullable</code>.</p>
</div>
<div class="paragraph">
<p>The following table provides some examples of URI templates and what they match:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. URI Template Matching</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Matching URI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple match</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id:2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable of 2 characters max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code> or <code>/books</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/book{/id:[a-zA-Z]+}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable with regex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{?max,offset}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional query parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books?max=10&amp;offset=10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/path:.*}{.ext}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regex path match with extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo/bar.xml</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_uri_reserved_character_matching"><a class="anchor" href="#_uri_reserved_character_matching"></a>URI Reserved Character Matching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default URI variables as defined by the <a href="https://tools.ietf.org/html/rfc6570">RFC-6570 URI template</a> spec cannot include reserved characters such as <code>/</code>, <code>?</code> etc.</p>
</div>
<div class="paragraph">
<p>If you wish to match or expand entire paths then this can be problematic. As per <a href="https://tools.ietf.org/html/rfc6570#section-3.2.3">section 3.2.3 of the specification</a>, you can use reserved expansion or matching using the <code>+</code> operator.</p>
</div>
<div class="paragraph">
<p>For example the URI <code>/books/{+path}</code> will match both <code>/books/foo</code> and <code>/books/foo/bar</code> since the <code>+</code> indicates that the variable <code>path</code> should include reserved characters (in this case <code>/</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_annotations"><a class="anchor" href="#_routing_annotations"></a>Routing Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example used the <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation to add method that accepted HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> requests. The following tables summarizes the available annotations and how they map to the different HTTP methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. HTTP Routing Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">HTTP Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Delete.html">@Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#DELETE">DELETE</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Get.html">@Get</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Head.html">@Head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#HEAD">HEAD</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Options.html">@Options</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#OPTIONS">OPTIONS</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Patch.html">@Patch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PATCH">PATCH</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Put.html">@Put</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PUT">PUT</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Post.html">@Post</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#POST">POST</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Trace.html">@Trace</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#TRACE">TRACE</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of the method annotations default to <code>/</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_uris"><a class="anchor" href="#_multiple_uris"></a>Multiple URIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each of the routing annotations support multiple URI templates. For each template, a route will be created. This feature is useful for example to change the path of the API and leaving the existing path as is for backwards compatibility. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello")
public class BackwardCompatibleController {

    @Get(uris = {"/{name}", "/person/{name}"}) <b class="conum">(1)</b>
    public String hello(String name) { <b class="conum">(2)</b>
        return "Hello, " + name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello")
class BackwardCompatibleController {

    @Get(uris = ["/{name}", "/person/{name}"]) <b class="conum">(1)</b>
    String hello(String name) { <b class="conum">(2)</b>
        "Hello, " + name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/hello")
class BackwardCompatibleController {

    @Get(uris = ["/{name}", "/person/{name}"]) <b class="conum">(1)</b>
    fun hello(name: String): String { <b class="conum">(2)</b>
        return "Hello, $name"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify multiple templates</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Bind to the template arguments as normal</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Route validation is more complicated with multiple templates. If a variable that would normally be required does not exist in all templates, then that variable is considered optional since it may not exist for every execution of the method.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_routes_programmatically"><a class="anchor" href="#_building_routes_programmatically"></a>Building Routes Programmatically</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you prefer to not use annotations and declare all of your routes in code then never fear, Micronaut has a flexible <a href="../api/io/micronaut/web/router/RouteBuilder.html">RouteBuilder</a> API that makes it a breeze to define routes programmatically.</p>
</div>
<div class="paragraph">
<p>To start off with you should subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a> and then simply inject the controller you wish to route to into the method and define your routes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.ExecutionHandleLocator;
import io.micronaut.web.router.DefaultRouteBuilder;
import javax.inject.Inject;
import javax.inject.Singleton;

@Singleton
public class MyRoutes extends DefaultRouteBuilder { <b class="conum">(1)</b>

    public MyRoutes(ExecutionHandleLocator executionHandleLocator, UriNamingStrategy uriNamingStrategy) {
        super(executionHandleLocator, uriNamingStrategy);
    }

    @Inject
    void issuesRoutes(IssuesController issuesController) { <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController, "issue", Integer.class); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.web.router.GroovyRouteBuilder

import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class MyRoutes extends GroovyRouteBuilder { <b class="conum">(1)</b>

    MyRoutes(ExecutionHandleLocator executionHandleLocator, UriNamingStrategy uriNamingStrategy, ConversionService&lt;?&gt; conversionService) {
        super(executionHandleLocator, uriNamingStrategy, conversionService)
    }

    @Inject
    void issuesRoutes(IssuesController issuesController) { <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController.&amp;issue) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.ExecutionHandleLocator
import io.micronaut.web.router.DefaultRouteBuilder
import io.micronaut.web.router.RouteBuilder

import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class MyRoutes(executionHandleLocator: ExecutionHandleLocator, uriNamingStrategy: RouteBuilder.UriNamingStrategy) :
        DefaultRouteBuilder(executionHandleLocator, uriNamingStrategy) { <b class="conum">(1)</b>

    @Inject
    fun issuesRoutes(issuesController: IssuesController) { <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController, "issue", Int::class.java) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Route definitions should subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to inject a method with the controller you want to route to</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use methods such as <a href="../api/io/micronaut/web/router/RouteBuilder.html#GET-java.lang.String-java.lang.Class-java.lang.String-java.lang.Class&#8230;&#8203;-">GET</a> to route to controller methods. Note that even though the issues controller is being used, the route has no knowledge of its <code>@Controller</code> annotation and thus the full path must be specified.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Unfortunately due to type erasure a Java method lambda reference cannot be used with the API. For Groovy there is a <code>GroovyRouteBuilder</code> class which can be subclassed that allows passing Groovy method references.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_route_compile_time_validation"><a class="anchor" href="#_route_compile_time_validation"></a>Route Compile Time Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut supports validating route arguments at compile time with the validation library. To get started simply add the <code>validation</code> dependency to your build:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">annotationProcessor "io.micronaut:micronaut-validation" // Java only
kapt "io.micronaut:micronaut-validation" // Kotlin only
compile "io.micronaut:micronaut-validation"</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the correct dependency on your classpath, route arguments will automatically be checked at compile time. The compilation will fail if any of the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>
The URI template contains a variable that is optional, but the method parameter is not annotated with <code>@Nullable</code> or is an <code>java.util.Optional</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An optional variable is one that will allow the route to match a URI even if the value is not present. For example <code>/foo{/bar}</code> will match requests to <code>/foo</code> and <code>/foo/abc</code>. The non optional variant would be <code>/foo/{bar}</code>. See the <a href="#_uri_path_variables">URI Path Variables</a> section for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>
The URI template contains a variable that is missing from the method arguments.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To disable route compile time validation, set the system property <code>-Dmicronaut.route.validation=false</code>. For Java and Kotlin users using Gradle, the same effect can be achieved by removing the <code>validation</code> dependency from the <code>annotationProcessor</code>/<code>kapt</code> scope.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_non_standard_http_methods"><a class="anchor" href="#_routing_non_standard_http_methods"></a>Routing non-standard HTTP methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It may be necessary to support a non-standard HTTP method for a client or server. Specifications like <a href="https://tools.ietf.org/html/rfc4918">RFC-4918 Webdav</a> require additional methods like REPORT or LOCK for example. To support that use case the @CustomHttpMethod annotation can be used.</p>
</div>
<div class="listingblock">
<div class="title">RoutingExample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CustomHttpMethod(method = "LOCK", value = "/{name}")
String lock(String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation can be used anywhere any of the standard method annotations can be used, including controllers and declarative http clients.</p>
</div>
</div>
</div>

<h2 id="binding"><a class="anchor" href="#binding"></a>6.4 Simple Request Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/binding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The examples in the previous section demonstrates how Micronaut allows you to bind method parameters from URI path variables. This section will discuss how to bind arguments from other parts of the request.</p>
</div>
<div class="sect1">
<h2 id="_binding_annotations"><a class="anchor" href="#_binding_annotations"></a>Binding Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All of the binding annotations support customization of the name of the variable being bound from with their <code>name</code> member.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the annotations, their purpose and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from a cookie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from an HTTP header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String contentType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from a request query parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryValue String myParam</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Part.html">@Part</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from a part of a multipart request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Part CompletedFileUpload file</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@RequestAttribute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from an attribute of the request. Attributes are typically created in filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestAttribute String myAttribute</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@PathVariable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from the path of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathVariable String id</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a value is not specified to any binding annotation then the parameter name is used. In other words the following two methods are equivalent and both bind from a cookie called <code>myCookie</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/cookieName")
    public String cookieName(@CookieValue("myCookie") String myCookie) {
        // ...
    }

    @Get("/cookieInferred")
    public String cookieInferred(@CookieValue String myCookie) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/cookieName")
    String cookieName(@CookieValue("myCookie") String myCookie) {
        // ...
    }

    @Get("/cookieInferred")
    String cookieInferred(@CookieValue String myCookie) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/cookieName")
    fun cookieName(@CookieValue("myCookie") myCookie: String): String {
        // ...
    }

    @Get("/cookieInferred")
    fun cookieInferred(@CookieValue myCookie: String): String {
        // ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because hyphens are not allowed in variable names it may be necessary to set the name in the annotation. The following two definitions are equivalent:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/headerName")
    public String headerName(@Header("Content-Type") String contentType) {
        // ...
    }

    @Get("/headerInferred")
    public String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/headerName")
    String headerName(@Header("Content-Type") String contentType) {
        // ...
    }

    @Get("/headerInferred")
    String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/headerName")
    fun headerName(@Header("Content-Type") contentType: String): String {
        // ...
    }

    @Get("/headerInferred")
    fun headerInferred(@Header contentType: String): String {
        // ...
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_from_multiple_values"><a class="anchor" href="#_binding_from_multiple_values"></a>Binding from Multiple values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of binding from a single section of the request, it may be desirable to bind all query values for example to a POJO. This can be achieved by using the exploded operator (<code>?pojo*</code>) in the URI template. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpStatus;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

import javax.annotation.Nullable;
import javax.validation.Valid;

@Controller("/api")
public class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    public HttpStatus list(@Valid @Nullable PaginationCommand paginationCommand) {
        return HttpStatus.OK;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpStatus
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

import javax.annotation.Nullable
import javax.validation.Valid

@Controller("/api")
class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    HttpStatus list(@Valid @Nullable PaginationCommand paginationCommand) {
        HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpStatus
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.validation.Validated
import javax.validation.Valid

@Controller("/api")
open class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    open fun list(@Valid paginationCommand: PaginationCommand): HttpStatus {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bindable_types"><a class="anchor" href="#_bindable_types"></a>Bindable Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generally any type that can be converted from a String representation to a Java type via the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> API can be bound to.</p>
</div>
<div class="paragraph">
<p>This includes most common Java types, however additional <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> instances can be registered simply be creating <code>@Singleton</code> beans of type <code>TypeConverter</code>.</p>
</div>
<div class="paragraph">
<p>The handling of nullability deserves special mention. Consider for example the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/headerInferred")
    public String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/headerInferred")
    String headerInferred(@Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/headerInferred")
    fun headerInferred(@Header contentType: String): String {
        // ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case if the HTTP header <code>Content-Type</code> is not present in the request the route is considered invalid, since it cannot be satisfied and a HTTP 400 <code>BAD REQUEST</code> is returned.</p>
</div>
<div class="paragraph">
<p>If you wish for the <code>Content-Type</code> header to be optional, you can instead write:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/headerNullable")
    public String headerNullable(@Nullable @Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/headerNullable")
    String headerNullable(@Nullable @Header String contentType) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/headerNullable")
    fun headerNullable(@Header contentType: String?): String? {
        // ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>An null string will be passed if the header is absent from the request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>java.util.Optional</code> can also be used, however that is discouraged for method parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, any <code>DateTime</code> that conforms to <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#RFC_1123_DATE_TIME">RFC-1123</a> can be bound to a parameter, alternatively the format can be customized with the <a href="../api/io/micronaut/core/convert/format/Format.html">Format</a> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/date")
    public String date(@Header ZonedDateTime date) {
        // ...
    }

    @Get("/dateFormat")
    public String dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header ZonedDateTime date) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/date")
    String date(@Header ZonedDateTime date) {
        // ...
    }

    @Get("/dateFormat")
    String dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header ZonedDateTime date) {
        // ...
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/date")
    fun date(@Header date: ZonedDateTime): String {
        // ...
    }

    @Get("/dateFormat")
    fun dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header date: ZonedDateTime): String {
        // ...
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_type_based_binding_parameters"><a class="anchor" href="#_type_based_binding_parameters"></a>Type Based Binding Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some parameters are recognized by their type instead of their annotation. The following table summarizes the parameter types, their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/BasicAuth.html">BasicAuth</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows binding of basic authorization credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuth basicAuth</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_variables_resolution"><a class="anchor" href="#_variables_resolution"></a>Variables resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut will try to populate method arguments in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>URI variables like <code>/{id}</code>.</p>
</li>
<li>
<p>If the request is a <code>GET</code> request from query parameters (ie. <code>?foo=bar</code>).</p>
</li>
<li>
<p>If there is a <code>@Body</code> and request allows the body, bind the body to it.</p>
</li>
<li>
<p>if the request can have a body and no <code>@Body</code> is defined then try parse the body (either JSON or form data) and
bind the method arguments from the body.</p>
</li>
<li>
<p>Finally, if the method arguments cannot be populated return <code>400 BAD REQUEST</code>.</p>
</li>
</ol>
</div>
</div>
</div>

<h2 id="hostResolution"><a class="anchor" href="#hostResolution"></a>6.5 Host Resolution</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/hostResolution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may need to resolve the host name of the current server. Micronaut ships with an implementation of the <a href="../api/io/micronaut/http/server/util/HttpHostResolver.html">HttpHostResolver</a> interface.</p>
</div>
<div class="paragraph">
<p>The default implementation will look for host information in the following places in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The supplied configuration</p>
</li>
<li>
<p>The <code>Forwarded</code> header</p>
</li>
<li>
<p>The <code>X-Forwarded-</code> headers</p>
</li>
<li>
<p>The <code>Host</code> header</p>
</li>
<li>
<p>The properties on the request URI</p>
</li>
<li>
<p>The properties on the embedded server URI</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The behavior of which headers to pull the relevant data can be changed with the following configuration:</p>
</div>
<a id="io.micronaut.http.server.HttpServerConfiguration$HostResolutionConfiguration" href="#io.micronaut.http.server.HttpServerConfiguration$HostResolutionConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/HttpServerConfiguration.HostResolutionConfiguration.html">HttpServerConfiguration$HostResolutionConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.host-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.protocol-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.port-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.port-in-host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True if the host header supports a port</p></td>
</tr>
</tbody>
</table>

<h2 id="clientIpAddress"><a class="anchor" href="#clientIpAddress"></a>6.6 Client IP Address</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/clientIpAddress.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may need to resolve the originating IP address of an HTTP Request. Micronaut ships with an implementation of <a href="../api/io/micronaut/http/server/util/HttpClientAddressResolver.html">HttpClientAddressResolver</a>.</p>
</div>
<div class="paragraph">
<p>The default implementation will resolve the client address in the following places in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The configured header</p>
</li>
<li>
<p>The <code>Forwarded</code> header</p>
</li>
<li>
<p>The <code>X-Forwarded-For</code> header</p>
</li>
<li>
<p>The remote address on the request</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first priority header name can be configured with <code>micronaut.server.client-address-header</code>.</p>
</div>

<h2 id="requestResponse"><a class="anchor" href="#requestResponse"></a>6.7 The HttpRequest and HttpResponse</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/requestResponse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you need more control over request processing then you can instead write a method that receives the complete <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a>.</p>
</div>
<div class="paragraph">
<p>In fact, there are several higher level interfaces that can be bound to method parameters of controllers. These include:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Bindable Micronaut Interfaces</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full <code>HttpRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpRequest request)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpHeaders.html">HttpHeaders</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP headers present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpHeaders headers)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpParameters.html">HttpParameters</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP parameters (either from URI variables or request parameters) present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpParameters params)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/Cookies.html">Cookies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the Cookies present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(Cookies cookies)</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> should be declared parametrized with a concrete generic type if the request body is needed, e.g. <code>HttpRequest&lt;MyClass&gt; request</code>. The body may not be available from the request otherwise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, for full control over the emitted HTTP response you can use the static factory methods of the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> class which return a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a>.</p>
</div>
<div class="paragraph">
<p>The following example implements the previous <code>MessageController</code> example using the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> objects:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/request")
public class MessageController {

    @Get("/hello") <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; hello(HttpRequest&lt;?&gt; request) {
        String name = request.getParameters()
                             .getFirst("name")
                             .orElse("Nobody"); <b class="conum">(2)</b>

        return HttpResponse.ok("Hello " + name + "!!")
                 .header("X-My-Header", "Foo"); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/request")
class MessageController {

    @Get("/hello") <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; hello(HttpRequest&lt;?&gt; request) {
        String name = request.getParameters()
                             .getFirst("name")
                             .orElse("Nobody") <b class="conum">(2)</b>

        HttpResponse.ok("Hello " + name + "!!")
                 .header("X-My-Header", "Foo") <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/request")
class MessageController {

    @Get("/hello") <b class="conum">(1)</b>
    fun hello(request: HttpRequest&lt;*&gt;): HttpResponse&lt;String&gt; {
        val name = request.parameters
                .getFirst("name")
                .orElse("Nobody") <b class="conum">(2)</b>

        return HttpResponse.ok("Hello $name!!")
                .header("X-My-Header", "Foo") <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is mapped to the URI <code>/hello</code> and accepts a <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> is used to obtain the value of a query parameter called <code>name</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/HttpResponse.html#ok-T-">HttpResponse.ok(T)</a> method is used to return a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> with a text body. A header called <code>X-My-Header</code> is also added to the response object.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> is also available from static context via <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Generally <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a> is available within reactive flow, but the recommended approach is to propagate the necessary state through lambdas.
</td>
</tr>
</table>
</div>

<h2 id="statusAnnotation"><a class="anchor" href="#statusAnnotation"></a>6.8 Response Status</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/statusAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action responds with a 200 HTTP status code by default.</p>
</div>
<div class="paragraph">
<p>If the controller&#8217;s action returns a <code>HttpResponse</code> object, you can configure the status code for the response object with the <code>status</code> method.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get(value = "/http-response", produces = MediaType.TEXT_PLAIN)
    public HttpResponse httpResponse() {
        return HttpResponse.status(HttpStatus.CREATED).body("success");
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get(value = "/http-response", produces = MediaType.TEXT_PLAIN)
    HttpResponse httpResponse() {
        HttpResponse.status(HttpStatus.CREATED).body("success")
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get(value = "/http-response", produces = [MediaType.TEXT_PLAIN])
    fun httpResponse(): HttpResponse&lt;String&gt; {
        return HttpResponse.status&lt;String&gt;(HttpStatus.CREATED).body("success")
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>@Status</code> annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Status(HttpStatus.CREATED)
    @Get(produces = MediaType.TEXT_PLAIN)
    public String index() {
        return "success";
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Status(HttpStatus.CREATED)
    @Get(produces = MediaType.TEXT_PLAIN)
    String index() {
        return "success"
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Status(HttpStatus.CREATED)
    @Get(produces = [MediaType.TEXT_PLAIN])
    fun index(): String {
        return "success"
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or even respond with an <code>HttpStatus</code></p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/http-status")
    public HttpStatus httpStatus() {
        return HttpStatus.CREATED;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/http-status")
    HttpStatus httpStatus() {
        HttpStatus.CREATED
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/http-status")
    fun httpStatus(): HttpStatus {
        return HttpStatus.CREATED
    }</code></pre>
</div>
</div>

<h2 id="producesAnnotation"><a class="anchor" href="#producesAnnotation"></a>6.9 Response Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/producesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action produces <code>application/json</code> by default.
Nonetheless you can change the <code>Content-Type</code> of the response with the <code>@Produces</code> annotation or the <code>produces</code> member of the HTTP method annotations.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Produces;

@Controller("/produces")
public class ProducesController {

    @Get <b class="conum">(1)</b>
    public HttpResponse index() {
        return HttpResponse.ok().body("{\"msg\":\"This is JSON\"}");
    }

    @Produces(MediaType.TEXT_HTML)
    @Get("/html") <b class="conum">(2)</b>
    public String html() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;";
    }

    @Get(value = "/xml", produces = MediaType.TEXT_XML) <b class="conum">(3)</b>
    public String xml() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces

@Controller("/produces")
class ProducesController {

    @Get <b class="conum">(1)</b>
    HttpResponse index() {
        HttpResponse.ok().body("{\"msg\":\"This is JSON\"}")
    }

    @Produces(MediaType.TEXT_HTML) <b class="conum">(2)</b>
    @Get("/html")
    String html() {
        "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }

    @Get(value = "/xml", produces = MediaType.TEXT_XML) <b class="conum">(3)</b>
    String xml() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces

@Controller("/produces")
class ProducesController {

    @Get <b class="conum">(1)</b>
    fun index(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;().body("{\"msg\":\"This is JSON\"}")
    }

    @Produces(MediaType.TEXT_HTML)
    @Get("/html") <b class="conum">(2)</b>
    fun html(): String {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }

    @Get(value = "/xml", produces = [MediaType.TEXT_XML]) <b class="conum">(3)</b>
    fun xml(): String {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default content type is JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate a controller&#8217;s action with <code>@Produces</code> to change the response content type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Setting the <code>produces</code> member of the method annotation also changes the content type.</td>
</tr>
</table>
</div>

<h2 id="consumesAnnotation"><a class="anchor" href="#consumesAnnotation"></a>6.10 Accepted Request Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/consumesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut&#8217;s controller action consumes <code>application/json</code> by default. Consuming other content types is supported with the <code>@Consumes</code> annotation, or the <code>consumes</code> member of any HTTP method annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Consumes;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;

@Controller("/consumes")
public class ConsumesController {

    @Post <b class="conum">(1)</b>
    public HttpResponse index() {
        return HttpResponse.ok();
    }

    @Consumes({MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON}) <b class="conum">(2)</b>
    @Post("/multiple")
    public HttpResponse multipleConsumes() {
        return HttpResponse.ok();
    }

    @Post(value = "/member", consumes = MediaType.TEXT_PLAIN) <b class="conum">(3)</b>
    public HttpResponse consumesMember() {
        return HttpResponse.ok();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Consumes
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

@Controller("/consumes")
class ConsumesController {

    @Post <b class="conum">(1)</b>
    HttpResponse index() {
        HttpResponse.ok()
    }

    @Consumes([MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON]) <b class="conum">(2)</b>
    @Post("/multiple")
    HttpResponse multipleConsumes() {
        HttpResponse.ok()
    }

    @Post(value = "/member", consumes = MediaType.TEXT_PLAIN) <b class="conum">(3)</b>
    HttpResponse consumesMember() {
        HttpResponse.ok()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Consumes
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

@Controller("/consumes")
class ConsumesController {

    @Post <b class="conum">(1)</b>
    fun index(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }

    @Consumes(MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON) <b class="conum">(2)</b>
    @Post("/multiple")
    fun multipleConsumes(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }

    @Post(value = "/member", consumes = [MediaType.TEXT_PLAIN]) <b class="conum">(3)</b>
    fun consumesMember(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default, a controller&#8217;s action consumes request with <code>Content-Type</code> of type <code>application/json</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@Consumes</code> annotation takes a <code>String[]</code> of supported media types for an incoming request.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The consumes can also be specified with the <code>consumes</code> member of the method annotation.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customizing_processed_content_types"><a class="anchor" href="#_customizing_processed_content_types"></a>Customizing Processed Content Types</h3>
<div class="paragraph">
<p>Normally the JSON parsing only happens if the content type is <code>application/json</code>. The other <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> classes behave in a similar manner that they have pre-defined content types they can process. To extend the list of media types that a given codec should process, you can provide configuration that will be stored in <a href="../api/io/micronaut/http/codec/CodecConfiguration.html">CodecConfiguration</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    codec:
        json:
            additionalTypes:
              - text/javascript
              - ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently supported configuration prefixes are <code>json</code>, <code>json-stream</code>, <code>text</code>, and <code>text-stream</code>.</p>
</div>
</div>

<h2 id="reactiveServer"><a class="anchor" href="#reactiveServer"></a>6.11 Reactive HTTP Request Processing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/reactiveServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Micronaut is built on Netty which is designed around an Event loop model and non-blocking I/O.</p>
</div>
<div class="paragraph">
<p>Although it is recommended to follow a non-blocking approach, in particular when making remote calls to other microservices, Micronaut acknowledges the fact that in real world scenarios developers encounter situations where the need arises to interface with blocking APIs and, in order to facilitate this, features blocking operation detection.</p>
</div>
<div class="paragraph">
<p>If your controller method returns a non-blocking type such as an RxJava <code>Observable</code> or a <code>CompletableFuture</code> then Micronaut will use the Event loop thread to subscribe to the result.</p>
</div>
<div class="paragraph">
<p>If however you return any other type then Micronaut will execute your <code>@Controller</code> method in a preconfigured I/O thread pool.</p>
</div>
<div class="paragraph">
<p>This thread pool by default is a caching, unbound thread pool. However, you may wish to configure the nature of the thread pool. For example the following configuration will configure the I/O thread pool as a fixed thread pool with 75 threads (similar to what a traditional blocking server such as Tomcat uses in the thread per connection model):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut.executors.io.type=fixed
micronaut.executors.io.nThreads=75</code></pre>
</div>
</div>

<h2 id="bodyAnnotation"><a class="anchor" href="#bodyAnnotation"></a>6.11.1 Using the @Body Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/reactiveServer/bodyAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To parse the request body, you first need to indicate to Micronaut the parameter which will receive the data. This is done with the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following example implements a simple echo server that echos the body sent in the request:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.MutableHttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.reactivex.Flowable;
import io.reactivex.Single;

import javax.validation.constraints.Size;

    @Post(value = "/echo", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    String echo(@Size(max = 1024) @Body String text) { <b class="conum">(2)</b>
        return text; <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.reactivex.Flowable
import io.reactivex.Single

import javax.validation.constraints.Size

    @Post(value = "/echo", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    String echo(@Size(max = 1024) @Body String text) { <b class="conum">(2)</b>
        text <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.reactivex.Flowable
import io.reactivex.Single

import javax.validation.constraints.Size


@Controller("/receive")
open class MessageController {

    @Post(value = "/echo", consumes = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    open fun echo(@Size(max = 1024) @Body text: String): String { <b class="conum">(2)</b>
        return text <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Post.html">Post</a> annotation is used with a <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> of <code>text/plain</code> (the default is <code>application/json</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation is used with a <code>javax.validation.constraints.Size</code> that limits the size of the body to at most 1MB. This constraint does <strong>not</strong> limit the amount of data read/buffered by the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The body is returned as the result of the method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that reading the request body is done in a non-blocking manner in that the request contents are read as the data becomes available and accumulated into the String passed to the method.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>micronaut.server.maxRequestSize</code> setting in <code>application.yml</code> will limit the size of the data (the default maximum request size is 10MB) read/buffered by the server. <code>@Size</code> is <strong>not</strong> a replacement for this setting.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regardless of the limit, for a large amount of data accumulating the data into a String in-memory may lead to memory strain on the server. A better approach is to include a Reactive library in your project (such as <code>RxJava 2.x</code>, <code>Reactor</code> or <code>Akka</code>) that supports the Reactive streams implementation and stream the data it becomes available:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the request body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Post(value = "/echo-flow", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    Single&lt;MutableHttpResponse&lt;String&gt;&gt; echoFlow(@Body Flowable&lt;String&gt; text) { <b class="conum">(2)</b>
        return text.collect(StringBuffer::new, StringBuffer::append) <b class="conum">(3)</b>
                   .map(buffer -&gt;
                        HttpResponse.ok(buffer.toString())
                   );
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the request body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Post(value = "/echo-flow", consumes = MediaType.TEXT_PLAIN) <b class="conum">(1)</b>
    Single&lt;MutableHttpResponse&lt;String&gt;&gt; echoFlow(@Body Flowable&lt;String&gt; text) { <b class="conum">(2)</b>
        return text.collect({ x -&gt; new StringBuffer()}, { StringBuffer sb, String s -&gt; sb.append(s)}) <b class="conum">(3)</b>
                   .map({ buffer -&gt;
                       HttpResponse.ok(buffer.toString())
                   });
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the request body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Post(value = "/echo-flow", consumes = [MediaType.TEXT_PLAIN]) <b class="conum">(1)</b>
    open fun echoFlow(@Body text: Flowable&lt;String&gt;): Single&lt;MutableHttpResponse&lt;String&gt;&gt; { <b class="conum">(2)</b>
        return text.collect({ StringBuffer() }, { obj, str -&gt; obj.append(str) }) <b class="conum">(3)</b>
                .map { buffer -&gt; HttpResponse.ok(buffer.toString()) }
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case the method is altered to receive and return an RxJava 2.x <code>Flowable</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> is returned so that Micronaut will only emit the response once the operation completes without blocking.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>collect</code> method is used to accumulate the data in this simulated example, but it could for example write the data to logging service, database or whatever chunk by chunk</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Body arguments of types that do not require conversion will cause Micronaut to skip decoding of the request!
</td>
</tr>
</table>
</div>

<h2 id="reactiveResponses"><a class="anchor" href="#reactiveResponses"></a>6.11.2 Reactive Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/reactiveServer/reactiveResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous section introduced the notion of Reactive programming using RxJava 2.x and Micronaut.</p>
</div>
<div class="paragraph">
<p>Micronaut supports returning common reactive types such as <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> or <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html">Observable</a> (or the <code>Mono</code> type from Reactor 3.x), an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> from any controller method.</p>
</div>
<div class="paragraph">
<p>The argument that is designated the body of the request using the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation can also be a reactive type or a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut also uses these types to influence which thread pool to execute the method on. If the request is considered non-blocking (because it returns a non-blocking type) then the Netty event loop thread will be used to execute the method.</p>
</div>
<div class="paragraph">
<p>If the method is considered blocking then the method is executed on the I/O thread pool, which Micronaut creates at startup.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the section on <a href="#threadPools">Configuring Thread Pools</a> for information on the thread pools that Micronaut sets up and how to configure them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To summarize, the following table illustrates some common response types and their handling:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpResponse&lt;Flowable&lt;String&gt;&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any implementation of <code>CharSequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When returning a Reactive type, the type of reactive type has an impact on the response returned. For example, when returning a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>, Micronaut can not know the size of the response, so <code>Transfer-Encoding</code> type of <code>Chunked</code> is used. Whilst for types that emit a single result such as <code><a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a></code> the <code>Content-Length</code> header will be populated.
</td>
</tr>
</table>
</div>

<h2 id="jsonBinding"><a class="anchor" href="#jsonBinding"></a>6.12 JSON Binding with Jackson</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/jsonBinding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The most common data interchange format nowadays is JSON.</p>
</div>
<div class="paragraph">
<p>In fact, the defaults in the <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> annotation specify that the controllers in Micronaut consume and produce JSON by default.</p>
</div>
<div class="paragraph">
<p>In order to do so in a non-blocking manner Micronaut builds on the <a href="https://github.com/FasterXML/jackson">Jackson</a> Asynchronous JSON parsing API and Netty such that the reading of incoming JSON is done in a non-blocking manner.</p>
</div>
<div class="sect1">
<h2 id="_binding_using_reactive_frameworks"><a class="anchor" href="#_binding_using_reactive_frameworks"></a>Binding using Reactive Frameworks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From a developer perspective however, you can generally just work with Plain Old Java Objects (POJOs) and can optionally use a Reactive framework such as RxJava or Reactor. The following is an example of a controller that reads and saves an incoming POJO in a non-blocking way from JSON:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post("/saveReactive")
    public Single&lt;HttpResponse&lt;Person&gt;&gt; save(@Body Single&lt;Person&gt; person) { <b class="conum">(1)</b>
        return person.map(p -&gt; {
                    inMemoryDatastore.put(p.getFirstName(), p); <b class="conum">(2)</b>
                    return HttpResponse.created(p); <b class="conum">(3)</b>
                }
        );
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post("/saveReactive")
    Single&lt;HttpResponse&lt;Person&gt;&gt; save(@Body Single&lt;Person&gt; person) { <b class="conum">(1)</b>
        person.map({ p -&gt;
            inMemoryDatastore.put(p.getFirstName(), p) <b class="conum">(2)</b>
            HttpResponse.created(p) <b class="conum">(3)</b>
        })
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using RxJava 2 to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post("/saveReactive")
    fun save(@Body person: Single&lt;Person&gt;): Single&lt;HttpResponse&lt;Person&gt;&gt; { <b class="conum">(1)</b>
        return person.map { p -&gt;
            inMemoryDatastore[p.firstName] = p <b class="conum">(2)</b>
            HttpResponse.created(p) <b class="conum">(3)</b>
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method receives a RxJava <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> which emits the POJO once the JSON has been read</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>map</code> method is used to store the instance in <code>Map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using CURL from the command line you can POST JSON to the <code>/people</code> URI for the server to receive it:</p>
</div>
<div class="listingblock">
<div class="title">Using CURL to Post JSON</div>
<div class="content">
<pre>$ curl -X POST localhost:8080/people -d '{"firstName":"Fred","lastName":"Flintstone","age":45}'</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_completablefuture"><a class="anchor" href="#_binding_using_completablefuture"></a>Binding Using CompletableFuture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The same method as the previous example can also be written with the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> API instead:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post("/saveFuture")
    public CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; save(@Body CompletableFuture&lt;Person&gt; person) {
        return person.thenApply(p -&gt; {
                    inMemoryDatastore.put(p.getFirstName(), p);
                    return HttpResponse.created(p);
                }
        );
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post("/saveFuture")
    CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; save(@Body CompletableFuture&lt;Person&gt; person) {
        person.thenApply({ p -&gt;
            inMemoryDatastore.put(p.getFirstName(), p)
            HttpResponse.created(p)
        })
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post("/saveFuture")
    fun save(@Body person: CompletableFuture&lt;Person&gt;): CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; {
        return person.thenApply { p -&gt;
            inMemoryDatastore[p.firstName] = p
            HttpResponse.created(p)
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example uses the <code>thenApply</code> method to achieve the same as the previous example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_pojos"><a class="anchor" href="#_binding_using_pojos"></a>Binding using POJOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note however, that if your method does not do any blocking I/O then you can just as easily write:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post
    public HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person);
        return HttpResponse.created(person);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post
    HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person)
        HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post
    fun save(@Body person: Person): HttpResponse&lt;Person&gt; {
        inMemoryDatastore[person.firstName] = person
        return HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will still using non-blocking I/O to read the JSON and only execute your method once the data has been read.</p>
</div>
<div class="paragraph">
<p>In other words, as a rule reactive types should be used when you plan to do further downstream I/O operations in which case they can greatly simplify composing operations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The output produced by Jackson can be customized in a variety of manners, from defining Jackson modules to using <a href="https://github.com/FasterXML/jackson-annotations/wiki/Jackson-Annotations">Jackson&#8217;s annotations</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jackson_configuration"><a class="anchor" href="#_jackson_configuration"></a>Jackson Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Jackson ObjectMapper can be configured through normal configuration with the <a href="../api/io/micronaut/jackson/JacksonConfiguration.html">JacksonConfiguration</a> class.</p>
</div>
<div class="paragraph">
<p>All jackson configuration keys start with <code>jackson</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#forLanguageTag-java.lang.String-">Locale.forLanguageTag</a>. Example: <code>en-US</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeZone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <a href="https://docs.oracle.com/javase/8/docs/api/java/util/TimeZone.html#getTimeZone-java.lang.String-">TimeZone.getTimeZone</a>. Example: <code>PST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializationInclusion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <a href="http://fasterxml.github.io/jackson-annotations/javadoc/2.9/com/fasterxml/jackson/annotation/JsonInclude.Include.html">JsonInclude.Include</a>. Example: <code>ALWAYS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">propertyNamingStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of an instance of <a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/PropertyNamingStrategy.html">PropertyNamingStrategy</a>. Example: <code>SNAKE_CASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultTyping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The global defaultTyping for polymorphic type handling from enum <a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/ObjectMapper.DefaultTyping.html">ObjectMapper.DefaultTyping</a>. Example: <code>NON_FINAL</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
    serializationInclusion: ALWAYS</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_features"><a class="anchor" href="#_features"></a>Features</h3>
<div class="paragraph">
<p>All features can be configured with their name as the key and a boolean to indicate enabled or disabled.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/SerializationFeature.html">SerializationFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deserialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/DeserializationFeature.html">DeserializationFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/MapperFeature.html">MapperFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-core/javadoc/2.9/com/fasterxml/jackson/core/JsonParser.Feature.html">JsonParser.Feature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://fasterxml.github.io/jackson-core/javadoc/2.9/com/fasterxml/jackson/core/JsonGenerator.Feature.html">JsonGenerator.Feature</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
    serialization:
        indentOutput: true
        writeDatesAsTimestamps: false
    deserialization:
        useBigIntegerForInts: true
        failOnUnknownProperties: false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_code_jsonview_code"><a class="anchor" href="#_support_for_code_jsonview_code"></a>Support for <code>@JsonView</code></h3>
<div class="paragraph">
<p>You can use the <code>@JsonView</code> annotation to controller methods if you set <code>jackson.json-view.enabled</code> to <code>true</code> in <code>application.yml</code>.</p>
</div>
<div class="paragraph">
<p>Jackson&#8217;s <code>@JsonView</code> annotation allows you to control which properties are exposes on a per response basis. See <a href="https://www.baeldung.com/jackson-json-view-annotation">Jackson JSON Views</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_beans"><a class="anchor" href="#_beans"></a>Beans</h3>
<div class="paragraph">
<p>In addition to configuration, beans can be registered to customize Jackson. All beans that extend any of the following classes will be registered with the object mapper.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/Module.html">Module</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/JsonDeserializer.html">JsonDeserializer</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/JsonSerializer.html">JsonSerializer</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/KeyDeserializer.html">KeyDeserializer</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/deser/BeanDeserializerModifier.html">BeanDeserializerModifier</a></p>
</li>
<li>
<p><a href="http://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/ser/BeanSerializerModifier.html">BeanSerializerModifier</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_service_loader"><a class="anchor" href="#_service_loader"></a>Service Loader</h3>
<div class="paragraph">
<p>Any modules registered via the service loader will also be added to the default object mapper.</p>
</div>
</div>
</div>
</div>

<h2 id="datavalidation"><a class="anchor" href="#datavalidation"></a>6.13 Data Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/datavalidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is easy to validate incoming data with Micronaut&#8217;s controllers with the
<a href="#validation">Validation Advice</a>.</p>
</div>
<div class="paragraph">
<p>First, add the Hibernate Validator configuration to your application:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut.configuration:micronaut-hibernate-validator'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.configuration&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>We can validate parameters using <code>javax.validation</code> annotations and the <a href="../api/io/micronaut/validation/Validated.html">Validated</a> annotation at the class level.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.validation.Validated;

import javax.validation.constraints.NotBlank;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
public class EmailController {

    @Get("/send")
    public HttpResponse send(@NotBlank String recipient, <b class="conum">(2)</b>
                             @NotBlank String subject) { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.validation.Validated;

import javax.validation.constraints.NotBlank;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
class EmailController {

    @Get("/send")
    HttpResponse send(@NotBlank String recipient, <b class="conum">(2)</b>
                             @NotBlank String subject) { <b class="conum">(2)</b>
        HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.validation.Validated

import javax.validation.constraints.NotBlank
import java.util.Collections


@Validated <b class="conum">(1)</b>
@Controller("/email")
open class EmailController {

    @Get("/send")
    open fun send(@NotBlank recipient: String, <b class="conum">(2)</b>
             @NotBlank subject: String): HttpResponse&lt;*&gt; { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>subject</code> and <code>recipient</code> cannot be blank.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The validation behaviour is shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Test
    public void testParametersAreValidated() {
        HttpClientResponseException e = Assertions.assertThrows(HttpClientResponseException.class, () -&gt;
            client.toBlocking().exchange("/email/send?subject=Hi&amp;recipient="));
        HttpResponse response = e.getResponse();

        assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

        response = client.toBlocking().exchange("/email/send?subject=Hi&amp;recipient=me@micronaut.example");

        assertEquals(HttpStatus.OK, response.getStatus());
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    def "test parameter validation"() {
        when:
        client.toBlocking().exchange('/email/send?subject=Hi&amp;recipient=')

        then:
        def e = thrown(HttpClientResponseException)
        def response = e.response
        response.status == HttpStatus.BAD_REQUEST

        when:
        response = client.toBlocking().exchange('/email/send?subject=Hi&amp;recipient=me@micronaut.example')

        then:
        response.status == HttpStatus.OK
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "test params are validated"() {
            val e = shouldThrow&lt;HttpClientResponseException&gt; {
                client.toBlocking().exchange&lt;Any&gt;("/email/send?subject=Hi&amp;recipient=")
            }
            var response = e.response

            response.status shouldBe HttpStatus.BAD_REQUEST

            response = client.toBlocking().exchange&lt;Any&gt;("/email/send?subject=Hi&amp;recipient=me@micronaut.example")

            response.status shouldBe HttpStatus.OK
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Often, you may want to use POJOs as controller method parameters.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package io.micronaut.docs.datavalidation.pogo;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;

@Introspected
public class Email {

    @NotBlank <b class="conum">(1)</b>
    String subject;

    @NotBlank <b class="conum">(1)</b>
    String recipient;

    public String getSubject() {
        return subject;
    }

    public void setSubject(String subject) {
        this.subject = subject;
    }

    public String getRecipient() {
        return recipient;
    }

    public void setRecipient(String recipient) {
        this.recipient = recipient;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">package io.micronaut.docs.datavalidation.pogo;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;

@Introspected
class Email {

    @NotBlank <b class="conum">(1)</b>
    String subject;

    @NotBlank <b class="conum">(1)</b>
    String recipient;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">package io.micronaut.docs.datavalidation.pogo

import io.micronaut.core.annotation.Introspected

import javax.validation.constraints.NotBlank

@Introspected
open class Email {

    @NotBlank <b class="conum">(1)</b>
    var subject: String? = null

    @NotBlank <b class="conum">(1)</b>
    var recipient: String? = null
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can use <code>javax.validation</code> annotations in your POJOs.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You need to annotate your controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a>. Also, you need to annotate the binding POJO with <code>@Valid</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;

import javax.validation.Valid;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
public class EmailController {

    @Post("/send")
    public HttpResponse send(@Body @Valid Email email) { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;

import javax.validation.Valid;
import java.util.Collections;

@Validated <b class="conum">(1)</b>
@Controller("/email")
class EmailController {

    @Post("/send")
    HttpResponse send(@Body @Valid Email email) { <b class="conum">(2)</b>
        HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated

import javax.validation.Valid
import java.util.Collections


@Validated <b class="conum">(1)</b>
@Controller("/email")
open class EmailController {

    @Post("/send")
    open fun send(@Body @Valid email: Email): HttpResponse&lt;*&gt; { <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the POJO which you wish to validate with <code>@Valid</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The validation of POJOs is shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    public void testPoJoValidation() {
        HttpClientResponseException e = Assertions.assertThrows(HttpClientResponseException.class, () -&gt; {
            Email email = new Email();
            email.subject = "Hi";
            email.recipient = "";
            client.toBlocking().exchange(HttpRequest.POST("/email/send", email));
        });
        HttpResponse response = e.getResponse();

        assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

        Email email = new Email();
        email.subject = "Hi";
        email.recipient = "me@micronaut.example";
        response = client.toBlocking().exchange(HttpRequest.POST("/email/send", email));

        assertEquals(HttpStatus.OK, response.getStatus());
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    def "invoking /email/send parse parameters in a POJO and validates"() {
        when:
        Email email = new Email()
        email.subject = 'Hi'
        email.recipient = ''
        client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

        then:
        def e = thrown(HttpClientResponseException)
        def response = e.response
        response.status == HttpStatus.BAD_REQUEST

        when:
        email = new Email()
        email.subject = 'Hi'
        email.recipient = 'me@micronaut.example'
        response = client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

        then:
        response.status == HttpStatus.OK
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">        "test poko validation"() {
            val e = shouldThrow&lt;HttpClientResponseException&gt; {
                val email = Email()
                email.subject = "Hi"
                email.recipient = ""
                client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))
            }
            var response = e.response

            response.status shouldBe HttpStatus.BAD_REQUEST

            val email = Email()
            email.subject = "Hi"
            email.recipient = "me@micronaut.example"
            response = client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))

            response.status shouldBe HttpStatus.OK
        }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bean injection is supported in custom constraints with the hibernate validator configuration.
</td>
</tr>
</table>
</div>

<h2 id="staticResources"><a class="anchor" href="#staticResources"></a>6.14 Serving Static Resources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/staticResources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Static resource resolution is disabled by default. Micronaut supports resolving resources from the classpath or the file system.</p>
</div>
<div class="paragraph">
<p>See the information below for available configuration options:</p>
</div>
<a id="io.micronaut.web.router.resource.StaticResourceConfiguration" href="#io.micronaut.web.router.resource.StaticResourceConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/web/router/resource/StaticResourceConfiguration.html">StaticResourceConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether this specific mapping is enabled. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.paths</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of paths either starting with <code>classpath:</code> or <code>file:</code>. You can serve files from anywhere on disk or the classpath. For example to serve static resources from <code>src/main/resources/public</code>, you would use <code>classpath:public</code> as the path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.mapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path resources should be served from. Uses ant path matching. Default value ("/**").</p></td>
</tr>
</tbody>
</table>

<h2 id="errorHandling"><a class="anchor" href="#errorHandling"></a>6.15 Error Handling</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/errorHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Sometimes with distributed applications, bad things happen. Having a good way to handle errors is important.</p>
</div>
<div class="sect1">
<h2 id="_status_handlers"><a class="anchor" href="#_status_handlers"></a>Status Handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> annotation supports defining either an exception class or an HTTP status. Methods decorated with the annotation will be invoked as the result of other controller methods. The annotation also supports the notion of global and local, local being the default.</p>
</div>
<div class="paragraph">
<p>Local error handlers will only respond to methods defined in the same controller. Global error handlers can respond to any method in any controller. A local error handler is always searched for first when resolving which handler to execute.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When defining an error handler for an exception, you can specify the exception instance as an argument to the method and omit the exception property of the annotation.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_error_handling"><a class="anchor" href="#_local_error_handling"></a>Local Error Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For example the following method will handling JSON parse exceptions from Jackson for the scope of the declaring controller:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error
    public HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException jsonParseException) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Invalid JSON: " + jsonParseException.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, "Fix Your JSON")
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error
    HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException jsonParseException) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Invalid JSON: " + jsonParseException.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, "Fix Your JSON")
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error
    fun jsonError(request: HttpRequest&lt;*&gt;, jsonParseException: JsonParseException): HttpResponse&lt;JsonError&gt; { <b class="conum">(1)</b>
        val error = JsonError("Invalid JSON: " + jsonParseException.message) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.status&lt;JsonError&gt;(HttpStatus.BAD_REQUEST, "Fix Your JSON")
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method that explicitly handles <code>JsonParseException</code> is declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An instance of <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A custom response is returned to handle the error</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error(status = HttpStatus.NOT_FOUND)
    public HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;notFound()
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error(status = HttpStatus.NOT_FOUND)
    HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;notFound()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error(status = HttpStatus.NOT_FOUND)
    fun notFound(request: HttpRequest&lt;*&gt;): HttpResponse&lt;JsonError&gt; { <b class="conum">(1)</b>
        val error = JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.notFound&lt;JsonError&gt;()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> declares which <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> error code to handle (in this case 404)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all 404 responses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#NOT_FOUND">NOT_FOUND</a> response is returned</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_global_error_handling"><a class="anchor" href="#_global_error_handling"></a>Global Error Handling</h2>
<div class="sectionbody">
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error(global = true) <b class="conum">(1)</b>
    public HttpResponse&lt;JsonError&gt; error(HttpRequest request, Throwable e) {
        JsonError error = new JsonError("Bad Things Happened: " + e.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;serverError()
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error(global = true) <b class="conum">(1)</b>
    HttpResponse&lt;JsonError&gt; error(HttpRequest request, Throwable e) {
        JsonError error = new JsonError("Bad Things Happened: " + e.getMessage()) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;serverError()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error(global = true) <b class="conum">(1)</b>
    fun error(request: HttpRequest&lt;*&gt;, e: Throwable): HttpResponse&lt;JsonError&gt; {
        val error = JsonError("Bad Things Happened: " + e.message) <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.serverError&lt;JsonError&gt;()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> is used to declare the method a global error handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all errors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#INTERNAL_SERVER_ERROR">INTERNAL_SERVER_ERROR</a> response is returned</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Error(status = HttpStatus.NOT_FOUND)
    public HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;notFound()
                .body(error); <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Error(status = HttpStatus.NOT_FOUND)
    HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { <b class="conum">(1)</b>
        JsonError error = new JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.getUri()))

        HttpResponse.&lt;JsonError&gt;notFound()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Error(status = HttpStatus.NOT_FOUND)
    fun notFound(request: HttpRequest&lt;*&gt;): HttpResponse&lt;JsonError&gt; { <b class="conum">(1)</b>
        val error = JsonError("Person Not Found") <b class="conum">(2)</b>
                .link(Link.SELF, Link.of(request.uri))

        return HttpResponse.notFound&lt;JsonError&gt;()
                .body(error) <b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> declares which <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> error code to handle (in this case 404)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all 404 responses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#NOT_FOUND">NOT_FOUND</a> response is returned</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A few things to note about the <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> annotation. Two identical <code>@Error</code> annotations that are
global cannot be declared. Two identical <code>@Error</code> annotations that are non-global cannot be declared in the same controller.
If an <code>@Error</code> annotation with the same parameter exists as global and another as a local, the local one will take precedence.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptionhandler"><a class="anchor" href="#_exceptionhandler"></a>ExceptionHandler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additionally you can implement a <a href="../api/io/micronaut/http/server/exceptions/ExceptionHandler.html">ExceptionHandler</a>; a generic hook for handling exceptions that occurs during the execution of an HTTP request.</p>
</div>
<div class="paragraph">
<p>Imagine your e-commerce app throws an <code>OutOfStockException</code> when a book is out of stock:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class OutOfStockException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class OutOfStockException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class OutOfStockException : RuntimeException()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with <code>BookController</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/books")
public class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    Integer stock(String isbn) {
        throw new OutOfStockException();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/books")
class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    Integer stock(String isbn) {
        throw new OutOfStockException()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/books")
class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    internal fun stock(isbn: String): Int? {
        throw OutOfStockException()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t handle the exception the server returns a 500 (Internal Server Error) status code.</p>
</div>
<div class="paragraph">
<p>If you want to respond 200 OK with 0 (stock level) as the response body when the <code>OutOfStockException</code> is thrown, you could register a <code>ExceptionHandler</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Produces
@Singleton
@Requires(classes = {OutOfStockException.class, ExceptionHandler.class})
public class OutOfStockExceptionHandler implements ExceptionHandler&lt;OutOfStockException, HttpResponse&gt; {

    @Override
    public HttpResponse handle(HttpRequest request, OutOfStockException exception) {
        return HttpResponse.ok(0);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Produces
@Singleton
@Requires(classes = [OutOfStockException.class, ExceptionHandler.class])
class OutOfStockExceptionHandler implements ExceptionHandler&lt;OutOfStockException, HttpResponse&gt; {

    @Override
    HttpResponse handle(HttpRequest request, OutOfStockException exception) {
        HttpResponse.ok(0)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Produces
@Singleton
@Requirements(
        Requires(classes = [OutOfStockException::class, ExceptionHandler::class])
)
class OutOfStockExceptionHandler : ExceptionHandler&lt;OutOfStockException, HttpResponse&lt;*&gt;&gt; {

    override fun handle(request: HttpRequest&lt;*&gt;, exception: OutOfStockException): HttpResponse&lt;*&gt; {
        return HttpResponse.ok(0)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
An <code>@Error</code> annotation capturing an exception has precedence over an implementation of <code>ExceptionHandler</code> capturing the same exception.
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="apiVersioning"><a class="anchor" href="#apiVersioning"></a>6.16 API Versioning</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/apiVersioning.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.1.x, Micronaut supports API versioning via a dedicated <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to version an API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.version.annotation.Version;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/versioned")
class VersionedController {

    @Version("1") <b class="conum">(1)</b>
    @Get("/hello")
    String helloV1() {
        return "helloV1";
    }

    @Version("2") <b class="conum">(2)</b>
    @Get("/hello")
    String helloV2() {
        return "helloV2";
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/versioned")
class VersionedController {

    @Version("1") <b class="conum">(1)</b>
    @Get("/hello")
    String helloV1() {
        "helloV1"
    }

    @Version("2") <b class="conum">(2)</b>
    @Get("/hello")
    String helloV2() {
        "helloV2"
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get


@Controller("/versioned")
internal class VersionedController {

    @Version("1") <b class="conum">(1)</b>
    @Get("/hello")
    fun helloV1(): String {
        return "helloV1"
    }

    @Version("2") <b class="conum">(2)</b>
    @Get("/hello")
    fun helloV2(): String {
        return "helloV2"
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>helloV1</code> method is declared as version <code>1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>helloV2</code> method is declared as version <code>2</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should then enabling versioning by setting <code>micronaut.router.versioning.enabled</code> to <code>true</code> in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    router:
        versioning:
            enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut has 2 out-of-the-box strategies for resolving the version that are based on an HTTP header named <code>X-API-VERSION</code> or a request parameter named <code>api-version</code>, however this is configurable. A full configuration example can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    router:
        versioning:
            enabled: true <i class="conum" data-value="1"></i><b>(1)</b>
            parameter:
                enabled: false <i class="conum" data-value="2"></i><b>(2)</b>
                names: 'v,api-version' <i class="conum" data-value="3"></i><b>(3)</b>
            header:
                enabled: true <i class="conum" data-value="4"></i><b>(4)</b>
                names: <i class="conum" data-value="5"></i><b>(5)</b>
                    - 'X-API-VERSION'
                    - 'Accept-Version'</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables versioning</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enables or disables parameter based versioning</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the parameter names as a comma separated list</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enables or disables header based versioning</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify the header names as a YAML list</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If this is not enough you can also implement the <a href="../api/io/micronaut/web/router/version/resolution/RequestVersionResolver.html">RequestVersionResolver</a> interface which receives the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and can implement any strategy you choose.</p>
</div>
<div class="sect2">
<h3 id="_default_version"><a class="anchor" href="#_default_version"></a>Default Version</h3>
<div class="paragraph">
<p>It is possible to supply a default version through configuration.</p>
</div>
<div class="listingblock">
<div class="title">Configuring Default Version</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    router:
        versioning:
            enabled: true
            default-version: 3 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the default version</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A route will <strong>not</strong> be matched if the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default version is configured</p>
</li>
<li>
<p>No version is found in the request</p>
</li>
<li>
<p>The route defines a version</p>
</li>
<li>
<p>The route version does not match the default version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the incoming request specifies a version then the default version has no effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="_versioning_client_requests"><a class="anchor" href="#_versioning_client_requests"></a>Versioning Client Requests</h3>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="#clientAnnotation">Declarative HTTP client</a> also supports automatic versioning of outgoing requests via the <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> annotation.</p>
</div>
<div class="paragraph">
<p>By default if you annotate a client interface with <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> the value supplied to the annotation will be included using the <code>X-API-VERSION</code> header.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.core.version.annotation.Version;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Single;

@Client("/hello")
@Version("1") <b class="conum">(1)</b>
public interface HelloClient {

    @Get("/greeting/{name}")
    String sayHello(String name);

    @Version("2")
    @Get("/greeting/{name}")
    Single&lt;String&gt; sayHelloTwo(String name); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Single


@Client("/hello")
@Version("1") <b class="conum">(1)</b>
interface HelloClient {

    @Get("/greeting/{name}")
    String sayHello(String name)

    @Version("2")
    @Get("/greeting/{name}")
    Single&lt;String&gt; sayHelloTwo(String name) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.reactivex.Single

@Client("/hello")
@Version("1") <b class="conum">(1)</b>
interface HelloClient {

    @Get("/greeting/{name}")
    fun sayHello(name : String) : String

    @Version("2")
    @Get("/greeting/{name}")
    fun sayHelloTwo(name : String) : Single&lt;String&gt;  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> can be used as the type level to specify the version to use for all methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When defined at the method level it is used only for that method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default behaviour for how the version is sent for each call can be configured with <a href="../api/io/micronaut/http/client/interceptor/configuration/DefaultClientVersioningConfiguration.html">DefaultClientVersioningConfiguration</a>:</p>
</div>
<a id="io.micronaut.http.client.interceptor.configuration.DefaultClientVersioningConfiguration" href="#io.micronaut.http.client.interceptor.configuration.DefaultClientVersioningConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/client/interceptor/configuration/DefaultClientVersioningConfiguration.html">DefaultClientVersioningConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.http.client.versioning.default.headers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of request header names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.http.client.versioning.default.parameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of request query parameter names.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example to use <code>Accept-Version</code> as the header name:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Client Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            versioning:
                default:
                    headers:
                        - 'Accept-Version'
                        - 'X-API-VERSION'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>default</code> key is used to refer to the default configuration. You can specify client specific configuration by using the value passed to <code>@Client</code> (typically the service ID). For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Versioning</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            versioning:
                greeting-service:
                    headers:
                        - 'Accept-Version'
                        - 'X-API-VERSION'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above uses a key called <code>greeting-service</code> which can be used to configure a client annotated with <code>@Client('greeting-service')</code>.</p>
</div>
</div>

<h2 id="formData"><a class="anchor" href="#formData"></a>6.17 Handling Form Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/formData.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In order to make data binding model customizations consistent between form data and JSON, Micronaut uses Jackson to implement binding data from form submissions.</p>
</div>
<div class="paragraph">
<p>The advantage of this approach is that the same Jackson annotations used for customizing JSON binding can be used for form submissions too.</p>
</div>
<div class="paragraph">
<p>What this means in practise is that in order to bind regular form data the only change required to the previous JSON binding code is updating the <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> consumed:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post
    public HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person);
        return HttpResponse.created(person);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post
    HttpResponse&lt;Person&gt; save(@Body Person person) {
        inMemoryDatastore.put(person.getFirstName(), person)
        HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post
    fun save(@Body person: Person): HttpResponse&lt;Person&gt; {
        inMemoryDatastore[person.firstName] = person
        return HttpResponse.created(person)
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To avoid denial of service attacks, collection types and arrays created during binding are limited by the setting <code>jackson.arraySizeThreshold</code> in <code>application.yml</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, instead of using a POJO you can bind form data directly to method parameters (which works with JSON too!):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

    @Post("/saveWithArgs")
    public HttpResponse&lt;Person&gt; save(String firstName, String lastName, Optional&lt;Integer&gt; age) {
        Person p = new Person(firstName, lastName);
        age.ifPresent(p::setAge);
        inMemoryDatastore.put(p.getFirstName(), p);
        return HttpResponse.created(p);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/people")
class PersonController {

    ConcurrentHashMap&lt;String, Person&gt; inMemoryDatastore = [:]

    @Post("/saveWithArgs")
    HttpResponse&lt;Person&gt; save(String firstName, String lastName, Optional&lt;Integer&gt; age) {
        Person p = new Person(firstName, lastName)
        age.ifPresent({ a -&gt; p.setAge(a)})
        inMemoryDatastore.put(p.getFirstName(), p)
        HttpResponse.created(p)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

    @Post("/saveWithArgs")
    fun save(firstName: String, lastName: String, age: Optional&lt;Int&gt;): HttpResponse&lt;Person&gt; {
        val p = Person(firstName, lastName)
        age.ifPresent { p.age = it }
        inMemoryDatastore[p.firstName] = p
        return HttpResponse.created(p)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example above, this approach allows you to use features such as support for <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a> types and restrict the parameters to be bound (When using POJOs you must be careful to use Jackson annotations to exclude properties that should not be bound).</p>
</div>

<h2 id="serverIO"><a class="anchor" href="#serverIO"></a>6.18 Writing Response Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverIO.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_writing_data_without_blocking"><a class="anchor" href="#_writing_data_without_blocking"></a>Writing Data without Blocking</h3>
<div class="paragraph">
<p>Micronaut&#8217;s HTTP server supports writing data without blocking simply by returning a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> the emits objects that can be encoded to the HTTP response.</p>
</div>
<div class="paragraph">
<p>The following table summarizes example return type signatures and the behaviour the server exhibits to handle each of them:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;byte[]&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> that emits each chunk of content as a <code>byte[]</code> without blocking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;ByteBuf&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Reactor <code>Flux</code> that emits each chunk as a Netty <code>ByteBuf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Publisher&lt;String&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits each chunk of content as a String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When emitting a POJO each emitted object is encoded as JSON by default without blocking</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When returning reactive type the server will use a <code>Transfer-Encoding</code> of <code>chunked</code> and keep writing data until the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>'s <code>onComplete</code> method is called.</p>
</div>
<div class="paragraph">
<p>The server will request a single item from the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>, write the item, without blocking, and then request the next item, thus controlling back pressure.</p>
</div>
</div>
<div class="sect2">
<h3 id="_performing_blocking_i_o"><a class="anchor" href="#_performing_blocking_i_o"></a>Performing Blocking I/O</h3>
<div class="paragraph">
<p>In some cases you may wish to integrate with a library that does not support non-blocking I/O.</p>
</div>
<div class="paragraph">
<p>In this you can return a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> object from any controller method. The <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> has various signatures that allowing writing to traditional blocking streams like <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Writer.html">Writer</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html">OutputStream</a>.</p>
</div>
<div class="paragraph">
<p>When returning a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> object the blocking I/O operation will be shifted to the I/O thread pool so that the Netty event loop is not blocked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the section on configuring <a href="#threadPools">Server Thread Pools</a> for details on how to configure the I/O thread pool to meet the requirements of your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example demonstrates how to use this API with Groovy&#8217;s <code>SimpleTemplateEngine</code> to write a server side template:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import groovy.text.SimpleTemplateEngine;
import groovy.text.Template;
import io.micronaut.core.io.Writable;
import io.micronaut.core.util.CollectionUtils;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.server.exceptions.HttpServerException;

@Controller("/template")
public class TemplateController {

    private final SimpleTemplateEngine templateEngine = new SimpleTemplateEngine();
    private final Template template;

    public TemplateController() {
        template = initTemplate(); <b class="conum">(1)</b>
    }

    @Get(value = "/welcome", produces = MediaType.TEXT_PLAIN)
    Writable render() { <b class="conum">(2)</b>
        return writer -&gt; template.make( <b class="conum">(3)</b>
            CollectionUtils.mapOf(
                    "firstName", "Fred",
                    "lastName", "Flintstone"
            )
        ).writeTo(writer);
    }

    private Template initTemplate() {
        Template template;
        try {
            template = templateEngine.createTemplate(
                    "Dear $firstName $lastName. Nice to meet you."
            );
        } catch (Exception e) {
            throw new HttpServerException("Cannot create template");
        }
        return template;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import groovy.text.SimpleTemplateEngine;
import groovy.text.Template;
import io.micronaut.core.io.Writable;
import io.micronaut.core.util.CollectionUtils;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.server.exceptions.HttpServerException;

@Controller("/template")
class TemplateController {

    private final SimpleTemplateEngine templateEngine = new SimpleTemplateEngine()
    private final Template template

    TemplateController() {
        template = initTemplate() <b class="conum">(1)</b>
    }

    @Get(value = "/welcome", produces = MediaType.TEXT_PLAIN)
    Writable render() { <b class="conum">(2)</b>
        { writer -&gt;
            template.make( <b class="conum">(3)</b>
                    CollectionUtils.mapOf(
                            "firstName", "Fred",
                            "lastName", "Flintstone"
                    )
            ).writeTo(writer)
        }
    }

    private Template initTemplate() {
        Template template
        try {
            template = templateEngine.createTemplate(
                    'Dear $firstName $lastName. Nice to meet you.'
            )
        } catch (Exception e) {
            throw new HttpServerException("Cannot create template")
        }
        template
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import groovy.text.SimpleTemplateEngine
import groovy.text.Template
import io.micronaut.core.io.Writable
import io.micronaut.core.util.CollectionUtils
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.server.exceptions.HttpServerException
import java.io.Writer


@Controller("/template")
class TemplateController {

    private val templateEngine = SimpleTemplateEngine()
    private val template: Template

    init {
        template = initTemplate() <b class="conum">(1)</b>
    }

    @Get(value = "/welcome", produces = [MediaType.TEXT_PLAIN])
    internal fun render(): Writable { <b class="conum">(2)</b>
        return { writer: Writer -&gt;
            val writable = template.make( <b class="conum">(3)</b>
                    CollectionUtils.mapOf(
                            "firstName", "Fred",
                            "lastName", "Flintstone"
                    )
            )
            writable.writeTo(writer)
        } as Writable
    }

    private fun initTemplate(): Template {
        val template: Template
        try {
            template = templateEngine.createTemplate(
                    "Dear \$firstName \$lastName. Nice to meet you."
            )
        } catch (e: Exception) {
            throw HttpServerException("Cannot create template")
        }

        return template
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller creates a simple template</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The controller method returns a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The returned function receives a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Writer.html">Writer</a> and calls <code>writeTo</code> on the template.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_404_responses"><a class="anchor" href="#_404_responses"></a>404 Responses</h3>
<div class="paragraph">
<p>Often, you want to respond 404 (Not Found) when you don&#8217;t find an item in your persistence layer or in similar scenarios.</p>
</div>
<div class="paragraph">
<p>See the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Controller("/books")
public class BooksController {

    @Get("/stock/{isbn}")
    public Map stock(String isbn) {
        return null; <b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    public Maybe&lt;Map&gt; maybestock(String isbn) {
        return Maybe.empty(); <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@Controller("/books")
class BooksController {

    @Get("/stock/{isbn}")
    Map stock(String isbn) {
        null <b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    Maybe&lt;Map&gt; maybestock(String isbn) {
        Maybe.empty() <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">@Controller("/books")
class BooksController {

    @Get("/stock/{isbn}")
    fun stock(isbn: String): Map&lt;*, *&gt;? {
        return null <b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    fun maybestock(isbn: String): Maybe&lt;Map&lt;*, *&gt;&gt; {
        return Maybe.empty() <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Returning <code>null</code> triggers a 404 (Not Found) response.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returning an empty <code>Maybe</code> triggers a 404 (Not Found) response.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Responding with an empty <code>Publisher</code> or <code>Flowable</code> will result in an empty array being returned if the content type is JSON.
</td>
</tr>
</table>
</div>
</div>

<h2 id="uploads"><a class="anchor" href="#uploads"></a>6.19 File Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/uploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Handling of file uploads has special treatment in Micronaut. Support is provided for streaming of uploads in a non-blocking manner through streaming uploads or completed uploads.</p>
</div>
<div class="paragraph">
<p>To receive data from a multipart request, set the <code>consumes</code> argument of the method annotation to <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post(consumes = MediaType.MULTIPART_FORM_DATA)
HttpResponse upload( ... )</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_route_arguments"><a class="anchor" href="#_route_arguments"></a>Route Arguments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How the files are received by your method is determined by the type of the arguments. Data can be received a chunk at a time or when an upload is completed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the route argument name can&#8217;t or shouldn&#8217;t match the name of the part in the request, simply add the <a href="../api/io/micronaut/http/annotation/Part.html">@Part</a> annotation to the argument and specify the name that is expected to be in the request.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_chunk_data_types"><a class="anchor" href="#_chunk_data_types"></a>Chunk Data Types</h3>
<div class="paragraph">
<p><a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> is the data type used to represent a chunk of data received in a multipart request. There are methods on the <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> interface to convert the data to a <code>byte[]</code>, <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html">InputStream</a>, or a <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html">ByteBuffer</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Data can only be retrieved from a <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> once. The underlying buffer will be released which causes further attempts to fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Route arguments of type <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher&lt;PartData&gt;</a> will be treated as only intended to receive a single file and each chunk of the received file will be sent downstream. If the generic type is something other than <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a>, conversion will be attempted using Micronaut&#8217;s conversion service. Conversions to <code>String</code> and <code>byte[]</code> are supported by default.</p>
</div>
<div class="paragraph">
<p>If requirements dictate you must have knowledge about the metadata of the file being received, a special class called <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a> has been created that is a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher&lt;PartData&gt;</a>, but also has file information like the content type and file name.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.HttpStatus;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.StreamingFileUpload;
import io.reactivex.Single;
import java.io.File;
import org.reactivestreams.Publisher;
import java.io.IOException;

@Controller("/upload")
public class UploadController {

    @Post(value = "/", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    public Single&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { <b class="conum">(2)</b>
        File tempFile;
        try {
            tempFile = File.createTempFile(file.getFilename(), "temp");
        } catch (IOException e) {
            return Single.error(e);
        }
        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile); <b class="conum">(3)</b>
        return Single.fromPublisher(uploadPublisher)  <b class="conum">(4)</b>
            .map(success -&gt; {
                if (success) {
                    return HttpResponse.ok("Uploaded");
                } else {
                    return HttpResponse.&lt;String&gt;status(HttpStatus.CONFLICT)
                                       .body("Upload Failed");
                }
            });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import io.reactivex.Single
import org.reactivestreams.Publisher

@Controller("/upload")
class UploadController {

    @Post(value = "/", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    Single&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { <b class="conum">(2)</b>
        File tempFile = File.createTempFile(file.filename, "temp")
        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile) <b class="conum">(3)</b>
        Single.fromPublisher(uploadPublisher)  <b class="conum">(4)</b>
            .map({ success -&gt;
                if (success) {
                    HttpResponse.ok("Uploaded")
                } else {
                    HttpResponse.&lt;String&gt;status(HttpStatus.CONFLICT)
                            .body("Upload Failed")
                }
            })
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import io.reactivex.Single
import java.io.File

@Controller("/upload")
class UploadController {

    @Post(value = "/", consumes = [MediaType.MULTIPART_FORM_DATA]) <b class="conum">(1)</b>
    fun upload(file: StreamingFileUpload): Single&lt;HttpResponse&lt;String&gt;&gt; { <b class="conum">(2)</b>
        val tempFile = File.createTempFile(file.filename, "temp")
        val uploadPublisher = file.transferTo(tempFile) <b class="conum">(3)</b>
        return Single.fromPublisher(uploadPublisher)  <b class="conum">(4)</b>
                .map { success -&gt;
                    if (success) {
                        HttpResponse.ok("Uploaded")
                    } else {
                        HttpResponse.status&lt;String&gt;(HttpStatus.CONFLICT)
                                .body("Upload Failed")
                    }
                }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is set to consume <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html#transferTo-java.lang.String-">StreamingFileUpload.transferTo(java.lang.String)</a> method is used to transfer the file to the server. The method returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The returned <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> subscribes to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and outputs a response once the upload is complete, without blocking.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_whole_data_types"><a class="anchor" href="#_whole_data_types"></a>Whole Data Types</h3>
<div class="paragraph">
<p>Route arguments that are not publishers will cause the route execution to be delayed until the upload has finished. The received data will attempt to be converted to the requested type. Conversions to a <code>String</code> or <code>byte[]</code> are supported by default. In addition, the file can be converted to a POJO if a media type codec has been registered that supports the media type of the file. A media type codec is included by default that allows conversion of JSON files to POJOs.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

@Controller("/upload")
public class BytesUploadController {

    @Post(value = "/bytes", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; uploadBytes(byte[] file, String fileName) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(fileName, "temp");
            Path path = Paths.get(tempFile.getAbsolutePath());
            Files.write(path, file); <b class="conum">(3)</b>
            return HttpResponse.ok("Uploaded");
        } catch (IOException exception) {
            return HttpResponse.badRequest("Upload Failed");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class BytesUploadController {

    @Post(value = "/bytes", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; uploadBytes(byte[] file, String fileName) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(fileName, "temp")
            Path path = Paths.get(tempFile.absolutePath)
            Files.write(path, file) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (IOException exception) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

import java.io.File
import java.io.IOException
import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class BytesUploadController {

    @Post(value = "/bytes", consumes = [MediaType.MULTIPART_FORM_DATA]) <b class="conum">(1)</b>
    fun uploadBytes(file: ByteArray, fileName: String): HttpResponse&lt;String&gt; { <b class="conum">(2)</b>
        return try {
            val tempFile = File.createTempFile(fileName, "temp")
            val path = Paths.get(tempFile.absolutePath)
            Files.write(path, file) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (exception: IOException) {
            HttpResponse.badRequest("Upload Failed")
        }

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If requirements dictate you must have knowledge about the metadata of the file being received, a special class called <a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a> has been created that has methods to retrieve the data of the file, but also has file information like the content type and file name.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.CompletedFileUpload;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

@Controller("/upload")
public class CompletedUploadController {

    @Post(value = "/completed", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; uploadCompleted(CompletedFileUpload file) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(file.getFilename(), "temp"); <b class="conum">(3)</b>
            Path path = Paths.get(tempFile.getAbsolutePath());
            Files.write(path, file.getBytes()); <b class="conum">(3)</b>
            return HttpResponse.ok("Uploaded");
        } catch (IOException exception) {
            return HttpResponse.badRequest("Upload Failed");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload

import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class CompletedUploadController {

    @Post(value = "/completed", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; uploadCompleted(CompletedFileUpload file) { <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(file.filename, "temp") <b class="conum">(3)</b>
            Path path = Paths.get(tempFile.absolutePath)
            Files.write(path, file.bytes) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (IOException exception) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload

import java.io.File
import java.io.IOException
import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

@Controller("/upload")
class CompletedUploadController {

    @Post(value = "/completed", consumes = [MediaType.MULTIPART_FORM_DATA]) <b class="conum">(1)</b>
    fun uploadCompleted(file: CompletedFileUpload): HttpResponse&lt;String&gt; { <b class="conum">(2)</b>
        return try {
            val tempFile = File.createTempFile(file.filename, "temp") <b class="conum">(3)</b>
            val path = Paths.get(tempFile.absolutePath)
            Files.write(path, file.bytes) <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (exception: IOException) {
            HttpResponse.badRequest("Upload Failed")
        }

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is set to consume <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>CompletedFileUpload</code> instance gives access to metadata about the upload as well as access to the file&#8217;s contents.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_uploads"><a class="anchor" href="#_multiple_uploads"></a>Multiple Uploads</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_different_names"><a class="anchor" href="#_different_names"></a>Different Names</h3>
<div class="paragraph">
<p>If a multipart request supplies multiple uploads that each have a different part name, simply create an argument to your route that receives each part. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpResponse upload(String title, String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A route method signature like the above will expect 2 different parts with the names "title" and "name".</p>
</div>
</div>
<div class="sect2">
<h3 id="_same_name"><a class="anchor" href="#_same_name"></a>Same Name</h3>
<div class="paragraph">
<p>To handle receiving multiple parts with the same part name, the argument must be a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>. When used in one of the following ways, the publisher will emit one item per file found with the specified name. The publisher must accept one of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a></p>
</li>
<li>
<p>Any POJO assuming a media codec is found that supports the content type</p>
</li>
<li>
<p>Another <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that accepts one of the chunked data types described above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpResponse upload(Publisher&lt;StreamingFileUpload&gt; files)
HttpResponse upload(Publisher&lt;CompletedFileUpload&gt; files)
HttpResponse upload(Publisher&lt;MyObject&gt; files)
HttpResponse upload(Publisher&lt;Publisher&lt;PartData&gt;&gt; files)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whole_body_binding"><a class="anchor" href="#_whole_body_binding"></a>Whole Body Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the cases where the names of the parts of the request cannot be known ahead of time, or the entire body should be read, a special type can be used to indicate the entire body is desired.</p>
</div>
<div class="paragraph">
<p>If a route has an argument of type <a href="../api/io/micronaut/http/server/multipart/MultipartBody.html">MultipartBody</a> (not to be confused with the class for the client) annotated with <a href="../api/io/micronaut/http/annotation/Body.html">@Body</a>, then each part of the request will be emitted through the argument. A <a href="../api/io/micronaut/http/server/multipart/MultipartBody.html">MultipartBody</a> is a publisher of <a href="../api/io/micronaut/http/multipart/CompletedPart.html">CompletedPart</a> instances.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.CompletedFileUpload;
import io.micronaut.http.multipart.CompletedPart;
import io.micronaut.http.server.multipart.MultipartBody;
import io.reactivex.Single;
import org.reactivestreams.Subscriber;
import org.reactivestreams.Subscription;

@Controller("/upload")
public class WholeBodyUploadController {

    @Post(value = "/whole-body", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    public Single&lt;String&gt; uploadBytes(@Body MultipartBody body) { <b class="conum">(2)</b>
        return Single.create(emitter -&gt; {
            body.subscribe(new Subscriber&lt;CompletedPart&gt;() {
                private Subscription s;

                @Override
                public void onSubscribe(Subscription s) {
                    this.s = s;
                    s.request(1);
                }

                @Override
                public void onNext(CompletedPart completedPart) {
                    String partName = completedPart.getName();
                    if (completedPart instanceof CompletedFileUpload) {
                        String originalFileName = ((CompletedFileUpload) completedPart).getFilename();
                    }
                }

                @Override
                public void onError(Throwable t) {
                    emitter.onError(t);
                }

                @Override
                public void onComplete() {
                    emitter.onSuccess("Uploaded");
                }
            });
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.CompletedPart
import io.micronaut.http.server.multipart.MultipartBody
import io.reactivex.Single
import org.reactivestreams.Subscriber
import org.reactivestreams.Subscription

@Controller("/upload")
class WholeBodyUploadController {

    @Post(value = "/whole-body", consumes = MediaType.MULTIPART_FORM_DATA) <b class="conum">(1)</b>
    Single&lt;String&gt; uploadBytes(@Body MultipartBody body) { <b class="conum">(2)</b>
        Single.&lt;String&gt;create({ emitter -&gt;
            body.subscribe(new Subscriber&lt;CompletedPart&gt;() {
                private Subscription s

                @Override
                void onSubscribe(Subscription s) {
                    this.s = s
                    s.request(1)
                }

                @Override
                void onNext(CompletedPart completedPart) {
                    String partName = completedPart.name
                    if (completedPart instanceof CompletedFileUpload) {
                        String originalFileName = ((CompletedFileUpload) completedPart).filename
                    }
                }

                @Override
                void onError(Throwable t) {
                    emitter.onError(t)
                }

                @Override
                void onComplete() {
                    emitter.onSuccess("Uploaded")
                }
            })
        })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.CompletedPart
import io.micronaut.http.server.multipart.MultipartBody
import io.reactivex.Single
import org.reactivestreams.Subscriber
import org.reactivestreams.Subscription

@Controller("/upload")
class WholeBodyUploadController {

    @Post(value = "/whole-body", consumes = [MediaType.MULTIPART_FORM_DATA]) <b class="conum">(1)</b>
    fun uploadBytes(@Body body: MultipartBody): Single&lt;String&gt; { <b class="conum">(2)</b>
        return Single.create { emitter -&gt;
            body.subscribe(object : Subscriber&lt;CompletedPart&gt; {
                private var s: Subscription? = null

                override fun onSubscribe(s: Subscription) {
                    this.s = s
                    s.request(1)
                }

                override fun onNext(completedPart: CompletedPart) {
                    val partName = completedPart.name
                    if (completedPart is CompletedFileUpload) {
                        val originalFileName = completedPart.filename
                    }
                }

                override fun onError(t: Throwable) {
                    emitter.onError(t)
                }

                override fun onComplete() {
                    emitter.onSuccess("Uploaded")
                }
            })
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="transfers"><a class="anchor" href="#transfers"></a>6.20 File Transfers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/transfers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports the sending of files to the client in a couple of easy ways.</p>
</div>
<div class="sect1">
<h2 id="_sending_file_objects"><a class="anchor" href="#_sending_file_objects"></a>Sending File Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to simply return a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a> object from your controller method and the data will be returned to the client. The <code>Content-Type</code> header of file responses will be calculated based on the name of the file.</p>
</div>
<div class="paragraph">
<p>To control either the media type of the file being sent, or to set the file to be downloaded (i.e. using the <code>Content-Disposition</code> header) you should instead construct an <a href="../api/io/micronaut/http/server/types/files/SystemFile.html">SystemFile</a> with the file object you would like to be used. For example:</p>
</div>
<div class="listingblock">
<div class="title">Sending a SystemFile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get
public SystemFile download() {
    File file = ...
    return new SystemFile(file).attach("myfile.txt");
    // or new SystemFile(file, MediaType.TEXT_HTML_TYPE)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_an_inputstream"><a class="anchor" href="#_sending_an_inputstream"></a>Sending an InputStream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For cases where a reference to a <code>File</code> object is not possible (for example resources contained within JAR files), Micronaut supports transferring of input streams. To return a stream of data from the controller method, construct a <a href="../api/io/micronaut/http/server/types/files/StreamedFile.html">StreamedFile</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The constructor for <code>StreamedFile</code> also accepts a <code>java.net.URL</code> for your convenience.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Sending a StreamedFile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get
public StreamedFile download() {
    InputStream inputStream = ...
    return new StreamedFile(inputStream, MediaType.TEXT_PLAIN_TYPE)
    // An attach(String filename) method is also available to set the Content-Disposition
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server supports returning <code>304</code> (Not Modified) responses if the files being transferred have not changed and the request contains the appropriate header. In addition, if the client accepts encoded responses, Micronaut will encode the file if it is deemed appropriate. Encoding will happen if the file is text based and greater than 1KB by default. The threshold at which data will be encoded is configurable. See the server configuration reference for details.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To use a custom data source to send data through an input stream, construct a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/PipedInputStream.html">PipedInputStream</a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/io/PipedOutputStream.html">PipedOutputStream</a> to allow writing data from the output stream to the input. Make sure to do the work on a separate thread so the file can be returned immediately.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cache_configuration"><a class="anchor" href="#_cache_configuration"></a>Cache Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default file responses will include caching headers. The following options determine how the <code>Cache-Control</code> header is built.</p>
</div>
<a id="io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration" href="#io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/types/files/FileTypeHandlerConfiguration.html">FileTypeHandlerConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netty.responses.file.cache-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache Seconds. Default value (60).</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration$CacheControlConfiguration" href="#io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration$CacheControlConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/types/files/FileTypeHandlerConfiguration.CacheControlConfiguration.html">FileTypeHandlerConfiguration$CacheControlConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netty.responses.file.cache-control.public</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the cache control is public. Default value (false)</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<h2 id="filters"><a class="anchor" href="#filters"></a>6.21 HTTP Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/filters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports the ability to apply filters to request/response processing in a similar, but reactive, way to Servlet filters in traditional Java applications.</p>
</div>
<div class="paragraph">
<p>Filters provide the ability to support the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decoration of the incoming <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p>
</li>
<li>
<p>Modification of the outgoing <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p>
</li>
<li>
<p>Implementation of cross cutting concerns such as security, tracing etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a server application, the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface&#8217;s <code>doFilter</code> method can be implemented.</p>
</div>
<div class="paragraph">
<p>The <code>doFilter</code> method accepts the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and an instance of <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a>.</p>
</div>
<div class="paragraph">
<p>The <code>ServerFilterChain</code> interface contains a resolved chain of filters with the final entry in the chain being the matched route. The <a href="../api/io/micronaut/http/filter/ServerFilterChain.html#proceed-io.micronaut.http.HttpRequest-">ServerFilterChain.proceed(io.micronaut.http.HttpRequest)</a> method can be used to resume processing of the request.</p>
</div>
<div class="paragraph">
<p>The <code>proceed(..)</code> method returns a Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits the response that will be returned to the client. Implementors of filters can subscribe to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and mutate the emitted <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> object to modify the response prior to returning the response to the client.</p>
</div>
<div class="paragraph">
<p>To put these concepts into practise lets look at an example.</p>
</div>
<div class="sect1">
<h2 id="_writing_a_filter"><a class="anchor" href="#_writing_a_filter"></a>Writing a Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider a hypothetical use case whereby you wish to trace each request to the Micronaut "Hello World" example using some external system. The external system could be a database, a distributed tracing service and may require I/O operations.</p>
</div>
<div class="paragraph">
<p>What you don&#8217;t want to do is block the underlying Netty event loop within your filter, instead you want the filter to proceed with execution once any I/O is complete.</p>
</div>
<div class="paragraph">
<p>As an example, consider the following example <code>TraceService</code> that uses RxJava to compose an I/O operation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using RxJava</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpRequest;
import io.reactivex.Flowable;
import io.reactivex.schedulers.Schedulers;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.inject.Singleton;

@Singleton
public class TraceService {

    private static final Logger LOG = LoggerFactory.getLogger(TraceService.class);

    Flowable&lt;Boolean&gt; trace(HttpRequest&lt;?&gt; request) {
        return Flowable.fromCallable(() -&gt; { <b class="conum">(1)</b>
            if (LOG.isDebugEnabled()) {
                LOG.debug("Tracing request: " + request.getUri());
            }
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            return true;
        }).subscribeOn(Schedulers.io()); <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using RxJava</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.reactivex.Flowable
import io.reactivex.schedulers.Schedulers
import org.slf4j.Logger
import org.slf4j.LoggerFactory

import javax.inject.Singleton

@Singleton
class TraceService {

    private static final Logger LOG = LoggerFactory.getLogger(TraceService.class)

    Flowable&lt;Boolean&gt; trace(HttpRequest&lt;?&gt; request) {
        Flowable.fromCallable({ -&gt;  <b class="conum">(1)</b>
            if (LOG.isDebugEnabled()) {
                LOG.debug("Tracing request: " + request.getUri())
            }
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            return true
        }).subscribeOn(Schedulers.io()) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using RxJava</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.reactivex.Flowable
import io.reactivex.schedulers.Schedulers
import org.slf4j.LoggerFactory

import javax.inject.Singleton


@Singleton
class TraceService {

    private val LOG = LoggerFactory.getLogger(TraceService::class.java)

    internal fun trace(request: HttpRequest&lt;*&gt;): Flowable&lt;Boolean&gt; {
        return Flowable.fromCallable {
            <b class="conum">(1)</b>
            if (LOG.isDebugEnabled) {
                LOG.debug("Tracing request: " + request.uri)
            }
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            true
        }.subscribeOn(Schedulers.io()) <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> type is used to create logic that executes potentially blocking operations to write the trace data from the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since this is just an example the logic does nothing and a place holder comment is used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The RxJava I/O scheduler is used to execute the logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then inject this implementation into your filter definition:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.*;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.filter.*;
import org.reactivestreams.Publisher;

@Filter("/hello/**") <b class="conum">(1)</b>
public class TraceFilter implements HttpServerFilter { <b class="conum">(2)</b>
    private final TraceService traceService;

    public TraceFilter(TraceService traceService) { <b class="conum">(3)</b>
        this.traceService = traceService;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher

@Filter("/hello/**") <b class="conum">(1)</b>
class TraceFilter implements HttpServerFilter { <b class="conum">(2)</b>
    private final TraceService traceService

    TraceFilter(TraceService traceService) { <b class="conum">(3)</b>
        this.traceService = traceService
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher


@Filter("/hello/**") <b class="conum">(1)</b>
class TraceFilter(<b class="conum">(2)</b>
        private val traceService: TraceService)<b class="conum">(3)</b>
    : HttpServerFilter {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Filter.html">Filter</a> annotation is used to define the URI patterns the filter matches</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class implements the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The previously defined <code>TraceService</code> is injected via a constructor argument</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The final step is write the <code>doFilter</code> implementation of the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Override
    public Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        return traceService.trace(request) <b class="conum">(1)</b>
                           .switchMap(aBoolean -&gt; chain.proceed(request)) <b class="conum">(2)</b>
                           .doOnNext(res -&gt; <b class="conum">(3)</b>
                                res.getHeaders().add("X-Trace-Enabled", "true")
                           );
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Override
    Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        traceService.trace(request) <b class="conum">(1)</b>
                           .switchMap({ aBoolean -&gt; chain.proceed(request) }) <b class="conum">(2)</b>
                           .doOnNext({ res -&gt; <b class="conum">(3)</b>
                               res.getHeaders().add("X-Trace-Enabled", "true")
                           })
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    override fun doFilter(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
        return traceService.trace(request) <b class="conum">(1)</b>
                .switchMap { aBoolean -&gt; chain.proceed(request) } <b class="conum">(2)</b>
                .doOnNext { res -&gt;
                    <b class="conum">(3)</b>
                    res.headers.add("X-Trace-Enabled", "true")
                }
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The previously defined <code>TraceService</code> is called to trace the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the trace call succeeds then the filter switches back to resuming the request processing using RxJava&#8217;s <code>switchMap</code> method, which invokes the <code>proceed</code> method of the <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finally, RxJava&#8217;s <code>doOnNext</code> method is used to add a header called <code>X-Trace-Enabled</code> to the response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous example demonstrates some key concepts such as executing logic in a non-blocking matter before proceeding with the request and modifying the outgoing response.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The examples use RxJava, however you can use any reactive framework that supports the Reactive streams specifications
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="sessions"><a class="anchor" href="#sessions"></a>6.22 HTTP Sessions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/sessions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default Micronaut is a stateless HTTP server, however depending on your application requirements you may need the notion of HTTP sessions.</p>
</div>
<div class="paragraph">
<p>Micronaut comes with a <code>session</code> module inspired by <a href="https://projects.spring.io/spring-session/">Spring Session</a> that enables this that currently features two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In-Memory sessions - which you should combine with an a sticky sessions proxy if you plan to run multiple instances.</p>
</li>
<li>
<p>Redis sessions - In this case <a href="https://redis.io">Redis</a> is used to store sessions and non-blocking I/O is used to read/write sessions to Redis.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_enabling_sessions"><a class="anchor" href="#_enabling_sessions"></a>Enabling Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable support for in-memory sessions you just need the <code>session</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">compile <span class="hljs-string">'io.micronaut:micronaut-session'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-session&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="sect2">
<h3 id="_redis_sessions"><a class="anchor" href="#_redis_sessions"></a>Redis Sessions</h3>
<div class="paragraph">
<p>If you wish to store <a href="../api/io/micronaut/session/Session.html">Session</a> instances in Redis you can do so with the <a href="https://micronaut-projects.github.io/micronaut-redis/latest/guide/#sessions">Micronaut Redis</a> module which includes detailed instructions.</p>
</div>
<div class="paragraph">
<p>To quickly get up and running with Redis sessions you must also have the <code>redis-lettuce</code> configuration on your classpath:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut:micronaut-session"
compile "io.micronaut.configuration:micronaut-redis-lettuce"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And enable Redis sessions via configuration in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Redis Sessions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">redis:
    uri: redis://localhost:6379
micronaut:
    session:
        http:
            redis:
                enabled: true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_session_resolution"><a class="anchor" href="#_configuring_session_resolution"></a>Configuring Session Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How the <a href="../api/io/micronaut/session/Session.html">Session</a> is resolved can be configured with <a href="../api/io/micronaut/session/http/HttpSessionConfiguration.html">HttpSessionConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>By default sessions are resolved using an <a href="../api/io/micronaut/session/http/HttpSessionFilter.html">HttpSessionFilter</a> that looks up session identifiers via either an HTTP header (using the <code>Authorization-Info</code> or <code>X-Auth-Token</code> header values) or via a Cookie called <code>SESSION</code>.</p>
</div>
<div class="paragraph">
<p>If you wish to disable either header resolution or cookie resolution you can via configuration in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Disabling Cookie Resolution</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    session:
        http:
            cookie: false
            header: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration enables header resolution, but disables cookie resolution. You can also configure the header or cookie names as necessary.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_sessions"><a class="anchor" href="#_working_with_sessions"></a>Working with Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="../api/io/micronaut/session/Session.html">Session</a> object can be retrieved simply by declaring the <a href="../api/io/micronaut/session/Session.html">Session</a> in a controller method signature. For example consider the following controller:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.session.Session;
import io.micronaut.session.annotation.SessionValue;

import javax.annotation.Nullable;
import javax.validation.constraints.NotBlank;

@Controller("/shopping")
public class ShoppingController {
    private static final String ATTR_CART = "cart"; <b class="conum">(1)</b>

    @Post("/cart/{name}")
    Cart addItem(Session session, @NotBlank String name) { <b class="conum">(2)</b>
        Cart cart = session.get(ATTR_CART, Cart.class).orElseGet(() -&gt; { <b class="conum">(3)</b>
            Cart newCart = new Cart();
            session.put(ATTR_CART, newCart); <b class="conum">(4)</b>
            return newCart;
        });
        cart.getItems().add(name);
        return cart;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.session.Session
import io.micronaut.session.annotation.SessionValue

import javax.annotation.Nullable
import javax.validation.constraints.NotBlank

@Controller("/shopping")
class ShoppingController {
    static final String ATTR_CART = "cart" <b class="conum">(1)</b>

    @Post("/cart/{name}")
    Cart addItem(Session session, @NotBlank String name) { <b class="conum">(2)</b>
        Cart cart = session.get(ATTR_CART, Cart.class).orElseGet({ -&gt;  <b class="conum">(3)</b>
            Cart newCart = new Cart()
            session.put(ATTR_CART, newCart) <b class="conum">(4)</b>
            newCart
        })
        cart.getItems().add(name)
        cart
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.session.Session
import io.micronaut.session.annotation.SessionValue


@Controller("/shopping")
class ShoppingController {

    @Post("/cart/{name}")
    internal fun addItem(session: Session, name: String): Cart { <b class="conum">(2)</b>
        require(name.isNotBlank()) { "Name cannot be blank" }
        val cart = session.get(ATTR_CART, Cart::class.java).orElseGet({
            <b class="conum">(3)</b>
            val newCart = Cart()
            session.put(ATTR_CART, newCart) <b class="conum">(4)</b>
            newCart
        })
        cart.items.add(name)
        return cart
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ShoppingController</code> declares a <a href="../api/io/micronaut/session/Session.html">Session</a> attribute called <code>cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a parameter to the method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>cart</code> attribute is retrieved</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise a new <code>Cart</code> instance is created and stored in the session</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that because the <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a required parameter to the execute the controller action, the <a href="../api/io/micronaut/session/Session.html">Session</a> will be created and saved to the <a href="../api/io/micronaut/session/SessionStore.html">SessionStore</a>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to create unnecessary sessions then you can declare the <a href="../api/io/micronaut/session/Session.html">Session</a> as <code>@Nullable</code> in which case a session will not be created and saved unnecessarily. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Post("/cart/clear")
    void clearCart(@Nullable Session session) {
        if (session != null) {
            session.remove(ATTR_CART);
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Post("/cart/clear")
    void clearCart(@Nullable Session session) {
        if (session != null) {
            session.remove(ATTR_CART)
        }
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Post("/cart/clear")
    internal fun clearCart(session: Session?) {
        session?.remove(ATTR_CART)
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method will only create and inject a new <a href="../api/io/micronaut/session/Session.html">Session</a> if one already exists.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_clients"><a class="anchor" href="#_session_clients"></a>Session Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the client is a web browser then sessions should just work if you have cookies is enabled. However for programmatic HTTP clients you need to make sure you propagate the session id between HTTP calls.</p>
</div>
<div class="paragraph">
<p>For example, when invoking the <code>viewCart</code> method of the <code>StoreController</code> in the previous example the HTTP client will receive by default a <code>AUTHORIZATION_INFO</code> header. The following example, using a Spock test, demonstrates this:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        HttpResponse&lt;Cart&gt; response = client.exchange(HttpRequest.GET("/shopping/cart"), Cart.class) <b class="conum">(1)</b>
                                                .blockingFirst();
        Cart cart = response.body();

        assertNotNull(response.header(HttpHeaders.AUTHORIZATION_INFO)); <b class="conum">(2)</b>
        assertNotNull(cart);
        assertTrue(cart.getItems().isEmpty());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        when: "The shopping cart is retrieved"
        HttpResponse&lt;Cart&gt; response = httpClient.exchange(HttpRequest.GET('/shopping/cart'), Cart) <b class="conum">(1)</b>
                                                .blockingFirst()
        Cart cart = response.body()

        then: "The shopping cart is present as well as a session id header"
        response.header(HttpHeaders.AUTHORIZATION_INFO) != null <b class="conum">(2)</b>
        cart != null
        cart.items.isEmpty()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            var response = client.exchange(HttpRequest.GET&lt;Cart&gt;("/shopping/cart"), Cart::class.java) <b class="conum">(1)</b>
                    .blockingFirst()
            var cart = response.body()

            assertNotNull(response.header(HttpHeaders.AUTHORIZATION_INFO)) <b class="conum">(2)</b>
            assertNotNull(cart)
            cart.items.isEmpty()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A request is made to <code>/shopping/cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>AUTHORIZATION_INFO</code> header is present in the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then pass this <code>AUTHORIZATION_INFO</code> in subsequent requests to re-use the existing <a href="../api/io/micronaut/session/Session.html">Session</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">        String sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO); <b class="conum">(1)</b>

        response = client.exchange(
                HttpRequest.POST("/shopping/cart/Apple", "")
                        .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart.class) <b class="conum">(2)</b>
                .blockingFirst();
        cart = response.body();</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">        String sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO) <b class="conum">(1)</b>

        response = httpClient.exchange(
                HttpRequest.POST('/shopping/cart/Apple', "")
                        .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart) <b class="conum">(2)</b>
                .blockingFirst()
        cart = response.body()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">            val sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO) <b class="conum">(1)</b>

            response = client.exchange(
                    HttpRequest.POST("/shopping/cart/Apple", "")
                            .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart::class.java) <b class="conum">(2)</b>
                    .blockingFirst()
            cart = response.body()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>AUTHORIZATION_INFO</code> is retrieved from the response</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And then sent as a header in the subsequent request</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_sessionvalue"><a class="anchor" href="#_using_sessionvalue"></a>Using @SessionValue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rather than explicitly injecting the <a href="../api/io/micronaut/session/Session.html">Session</a> into a controller method you can instead use <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Get("/cart")
    @SessionValue(ATTR_CART) <b class="conum">(1)</b>
    Cart viewCart(@SessionValue @Nullable Cart cart) { <b class="conum">(2)</b>
        if (cart == null) {
            cart = new Cart();
        }
        return cart;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @Get("/cart")
    @SessionValue("cart") <b class="conum">(1)</b>
    Cart viewCart(@SessionValue @Nullable Cart cart) { <b class="conum">(2)</b>
        if (cart == null) {
            cart = new Cart()
        }
        cart
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @Get("/cart")
    @SessionValue(ATTR_CART) <b class="conum">(1)</b>
    internal fun viewCart(@SessionValue cart: Cart?): Cart { <b class="conum">(2)</b>
        var cart = cart
        if (cart == null) {
            cart = Cart()
        }
        return cart
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is declared on the method resulting in the return value being stored in the <a href="../api/io/micronaut/session/Session.html">Session</a>. Note that you must specify the attribute name when used on a return value</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is used on a <code>@Nullable</code> parameter which results in looking up the value from the <a href="../api/io/micronaut/session/Session.html">Session</a> in a non-blocking way and supplying it if present. In the case a value is not specified to <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> resulting in the parameter name being used to lookup the attribute.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_events"><a class="anchor" href="#_session_events"></a>Session Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> beans to listen for <a href="../api/io/micronaut/session/Session.html">Session</a> related events located in the <a href="../api/io/micronaut/session/event/package-summary.html">io.micronaut.session.event</a> package.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the events:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Session Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionCreatedEvent.html">SessionCreatedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDeletedEvent.html">SessionDeletedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionExpiredEvent.html">SessionExpiredEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> expires</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDestroyedEvent.html">SessionDestroyedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parent of both <code>SessionDeletedEvent</code> and <code>SessionExpiredEvent</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>

<h2 id="sse"><a class="anchor" href="#sse"></a>6.23 Server Sent Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/sse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports emitting <a href="https://en.wikipedia.org/wiki/Server-sent_events">Server Sent Events (SSE)</a> using the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> API.</p>
</div>
<div class="paragraph">
<p>To emit events from the server you simply return a Reactive Streams <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> that emits objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> itself could publish events from a background task, via an event system or whatever.</p>
</div>
<div class="paragraph">
<p>Imagine for an example a event stream of news headlines, you may define a data class as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class Headline {
    private String title;
    private String description;

    public Headline() { }

    public Headline(String title, String description) {
        this.title = title;
        this.description = description;
    }

    public String getTitle() {
        return title;
    }

    public String getDescription() {
        return description;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public void setDescription(String description) {
        this.description = description;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">class Headline {
    String title;
    String description;

    Headline() {}

    Headline(String title, String description) {
        this.title = title;
        this.description = description;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">class Headline {
    var title: String? = null
    var description: String? = null

    constructor() {}

    constructor(title: String, description: String) {
        this.title = title
        this.description = description
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To emit news headline events you can write a controller that returns a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a> instances using which ever Reactive library you prefer. The example below uses RxJava 2&#8217;s <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> via the <code>generate</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.annotation.*;
import io.micronaut.http.sse.Event;
import io.reactivex.Flowable;
import org.reactivestreams.Publisher;

@Controller("/headlines")
public class HeadlineController {

    @Get
    public Publisher&lt;Event&lt;Headline&gt;&gt; index() { <b class="conum">(1)</b>
        String[] versions = new String[]{"1.0", "2.0"}; <b class="conum">(2)</b>

        return Flowable.generate(() -&gt; 0, (i, emitter) -&gt; { <b class="conum">(3)</b>
            if (i &lt; versions.length) {
                emitter.onNext( <b class="conum">(4)</b>
                    Event.of(new Headline("Micronaut " + versions[i] + " Released", "Come and get it"))
                );
            } else {
                emitter.onComplete(); <b class="conum">(5)</b>
            }
            return ++i;
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.sse.Event
import io.reactivex.Emitter
import io.reactivex.Flowable
import io.reactivex.functions.BiFunction
import org.reactivestreams.Publisher


@Controller("/headlines")
class HeadlineController {

    @Get
    Publisher&lt;Event&lt;Headline&gt;&gt; index() { <b class="conum">(1)</b>
        String[] versions = ["1.0", "2.0"] <b class="conum">(2)</b>

        def initialState = { -&gt; 0 }
        def emitterFunction = { Integer i, Emitter emitter -&gt;  <b class="conum">(3)</b>
            if (i &lt; versions.length) {
                emitter.onNext( <b class="conum">(4)</b>
                        Event.of(new Headline("Micronaut " + versions[i] + " Released", "Come and get it"))
                )
            } else {
                emitter.onComplete() <b class="conum">(5)</b>
            }
            return ++i
        }

        return Flowable.generate(initialState, emitterFunction as BiFunction&lt;Integer,Emitter&lt;Event&lt;Headline&gt;&gt;,Integer&gt;)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.sse.Event
import io.reactivex.Emitter
import io.reactivex.Flowable
import io.reactivex.functions.BiFunction
import org.reactivestreams.Publisher
import java.util.concurrent.Callable


@Controller("/headlines")
class HeadlineController {

    @Get
    fun index(): Publisher&lt;Event&lt;Headline&gt;&gt; { <b class="conum">(1)</b>
        val versions = arrayOf("1.0", "2.0") <b class="conum">(2)</b>

        return Flowable.generate&lt;Event&lt;Headline&gt;, Int&gt;(Callable&lt;Int&gt;{ 0 }, BiFunction { <b class="conum">(3)</b>
            i: Int, emitter: Emitter&lt;Event&lt;Headline&gt;&gt; -&gt;
            var nextInt: Int = i
            if (i &lt; versions.size) {
                emitter.onNext( <b class="conum">(4)</b>
                        Event.of&lt;Headline&gt;(Headline("Micronaut " + versions[i] + " Released", "Come and get it"))
                )
            } else {
                emitter.onComplete() <b class="conum">(5)</b>
            }
            ++nextInt
        })
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller method returns a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>For each version of Micronaut a headline is emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a> type&#8217;s <code>generate</code> method is used to generate a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a>. The <code>generate</code> method accepts an initial value and a lambda that accepts the value and a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a>.  Note that this example executes on the same thread as the controller action, but you could use <code>subscribeOn</code> or map and existing "hot" <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface&#8217;s <code>onNext</code> method is used to emit objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>. The <a href="../api/io/micronaut/http/sse/Event.html#of-ET-">Event.of(ET)</a> factory method is used to construct the event.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface&#8217;s <code>onComplete</code> method is used to indicate when to finish sending server sent events.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example will send back a response of type <code>text/event-stream</code> and for each  <a href="../api/io/micronaut/http/sse/Event.html">Event</a> emitted the <code>Headline</code> type previously will be converted to JSON resulting in responses such as:</p>
</div>
<div class="listingblock">
<div class="title">Server Sent Event Response Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> data: {"title":"Micronaut 1.0 Released","description":"Come and get it"}
 data: {"title":"Micronaut 2.0 Released","description":"Come and get it"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the methods of the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> interface to customize the Server Sent Event data sent back including associating event ids, comments, retry timeouts etc.</p>
</div>

<h2 id="websocket"><a class="anchor" href="#websocket"></a>6.24 WebSocket Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/websocket.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features dedicated support for creating WebSocket clients and servers. The <a href="../api/io/micronaut/websocket/annotation/package-summary.html">io.micronaut.websocket.annotation</a> package includes a set of annotations for defining both clients and servers.</p>
</div>

<h2 id="websocketServer"><a class="anchor" href="#websocketServer"></a>6.24.1 Using @ServerWebSocket</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/websocket/websocketServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">@ServerWebSocket</a> annotation can be applied to any class that should map to a WebSocket URI. The following example is a simple chat WebSocket implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.websocket.WebSocketBroadcaster;
import io.micronaut.websocket.WebSocketSession;
import io.micronaut.websocket.annotation.OnClose;
import io.micronaut.websocket.annotation.OnMessage;
import io.micronaut.websocket.annotation.OnOpen;
import io.micronaut.websocket.annotation.ServerWebSocket;

import java.util.function.Predicate;

@ServerWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
public class ChatServerWebSocket {
    private WebSocketBroadcaster broadcaster;

    public ChatServerWebSocket(WebSocketBroadcaster broadcaster) {
        this.broadcaster = broadcaster;
    }

    @OnOpen <b class="conum">(2)</b>
    public void onOpen(String topic, String username, WebSocketSession session) {
        String msg = "[" + username + "] Joined!";
        broadcaster.broadcastSync(msg, isValid(topic, session));
    }

    @OnMessage <b class="conum">(3)</b>
    public void onMessage(
            String topic,
            String username,
            String message,
            WebSocketSession session) {
        String msg = "[" + username + "] " + message;
        broadcaster.broadcastSync(msg, isValid(topic, session)); <b class="conum">(4)</b>
    }

    @OnClose <b class="conum">(5)</b>
    public void onClose(
            String topic,
            String username,
            WebSocketSession session) {
        String msg = "[" + username + "] Disconnected!";
        broadcaster.broadcastSync(msg, isValid(topic, session));
    }

    private Predicate&lt;WebSocketSession&gt; isValid(String topic, WebSocketSession session) {
        return s -&gt; s != session &amp;&amp; topic.equalsIgnoreCase(s.getUriVariables().get("topic", String.class, null));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.websocket.WebSocketBroadcaster
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.OnClose
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.micronaut.websocket.annotation.ServerWebSocket

import java.util.function.Predicate

@ServerWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
class ChatServerWebSocket {
    private WebSocketBroadcaster broadcaster

    ChatServerWebSocket(WebSocketBroadcaster broadcaster) {
        this.broadcaster = broadcaster
    }

    @OnOpen <b class="conum">(2)</b>
    void onOpen(String topic, String username, WebSocketSession session) {
        String msg = "[" + username + "] Joined!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    @OnMessage <b class="conum">(3)</b>
     void onMessage(
            String topic,
            String username,
            String message,
            WebSocketSession session) {
        String msg = "[" + username + "] " + message
        broadcaster.broadcastSync(msg, isValid(topic, session)) <b class="conum">(4)</b>
    }

    @OnClose <b class="conum">(5)</b>
     void onClose(
            String topic,
            String username,
            WebSocketSession session) {
        String msg = "[" + username + "] Disconnected!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    private Predicate&lt;WebSocketSession&gt; isValid(String topic, WebSocketSession session) {
        return { s -&gt; s != session &amp;&amp; topic.equalsIgnoreCase(s.getUriVariables().get("topic", String.class, null)) }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.websocket.WebSocketBroadcaster
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.OnClose
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.micronaut.websocket.annotation.ServerWebSocket

import java.util.function.Predicate

@ServerWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
class ChatServerWebSocket(private val broadcaster: WebSocketBroadcaster) {

    @OnOpen <b class="conum">(2)</b>
    fun onOpen(topic: String, username: String, session: WebSocketSession) {
        val msg = "[$username] Joined!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    @OnMessage <b class="conum">(3)</b>
    fun onMessage(
            topic: String,
            username: String,
            message: String,
            session: WebSocketSession) {
        val msg = "[$username] $message"
        broadcaster.broadcastSync(msg, isValid(topic, session)) <b class="conum">(4)</b>
    }

    @OnClose <b class="conum">(5)</b>
    fun onClose(
            topic: String,
            username: String,
            session: WebSocketSession) {
        val msg = "[$username] Disconnected!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    private fun isValid(topic: String, session: WebSocketSession): Predicate&lt;WebSocketSession&gt; {
        return Predicate&lt;WebSocketSession&gt;{ s -&gt; (s !== session &amp;&amp; topic.equals(s.getUriVariables().get("topic", String::class.java, null), ignoreCase = true)) }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">@ServerWebSocket</a> annotation is used to define the path the WebSocket is mapped under. The URI can be a URI template.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnOpen.html">@OnOpen</a> annotation is used to declare a method that is invoked when the WebSocket is opened.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a> annotation is used to declare a method that is invoked when a message is received.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can use a <a href="../api/io/micronaut/websocket/WebSocketBroadcaster.html">WebSocketBroadcaster</a> to broadcast messages to every WebSocket session. You can filter which sessions to communicate with a <code>Predicate</code>. Also, you could use the passed <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> instance to send a message to it with <code>WebSocketSession::send</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnClose.html">@OnClose</a> annotation is used to declare a method that is invoked when the WebSocket is closed.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A working example of WebSockets in action can be found in the <a href="https://github.com/micronaut-projects/micronaut-examples/tree/master/websocket-chat">Micronaut Examples</a> GitHub repository.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In terms of binding the method arguments to each WebSocket method can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A variable from the URI template (in the above example <code>topic</code> and <code>username</code> are variables in the URI template)</p>
</li>
<li>
<p>An instance of <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_onclose_method"><a class="anchor" href="#_the_onclose_method"></a>The @OnClose Method</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/OnClose.html">@OnClose</a> method can also optionally receive a <a href="../api/io/micronaut/websocket/CloseReason.html">CloseReason</a>. The <code>@OnClose</code> method is invoked prior to the session closing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_onmessage_method"><a class="anchor" href="#_the_onmessage_method"></a>The @OnMessage Method</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a> method can define a parameter that is the message body. The parameter can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Netty <code>WebSocketFrame</code></p>
</li>
<li>
<p>Any Java primitive or simple type (such as <code>String</code>). In fact any type that can be converted from <code>ByteBuf</code> (you can register additional <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> beans if you wish to support a custom type).</p>
</li>
<li>
<p>A <code>byte[]</code>, a <code>ByteBuf</code> or a Java NIO <code>ByteBuffer</code>.</p>
</li>
<li>
<p>A Plain Old Java Object (POJO). In the case of a POJO the POJO will be decoded by default  as JSON using <a href="../api/io/micronaut/jackson/codec/JsonMediaTypeCodec.html">JsonMediaTypeCodec</a>. You can register a custom codec if necessary and define the content type of the handler using the <a href="../api/io/micronaut/http/annotation/Consumes.html">@Consumes</a> annotation.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_onerror_method"><a class="anchor" href="#_the_onerror_method"></a>The @OnError Method</h3>
<div class="paragraph">
<p>A method annotated with <a href="../api/io/micronaut/websocket/annotation/OnError.html">@OnError</a> can be added to implement custom error handling. The <code>@OnError</code> method can optionally define a parameter that receives the exception type that is to be handled. If no <code>@OnError</code> handling is present and a unrecoverable exception occurs the WebSocket is automatically closed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_blocking_message_handling"><a class="anchor" href="#_non_blocking_message_handling"></a>Non-Blocking Message Handling</h3>
<div class="paragraph">
<p>The previous example uses the <code>broadcastSync</code> method of the <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> interface which blocks until the broadcast is complete. You can however implement non-blocking WebSocket servers by instead returning a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a> or a <code>Future</code> from each WebSocket handler method. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @OnMessage
    public Publisher&lt;Message&gt; onMessage(
            String topic,
            String username,
            Message message,
            WebSocketSession session) {

        String text = "[" + username + "] " + message.getText();
        Message newMessage = new Message(text);
        return broadcaster.broadcast(newMessage, isValid(topic, session));
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">    @OnMessage
     Publisher&lt;Message&gt; onMessage(
            String topic,
            String username,
            Message message,
            WebSocketSession session) {

        String text = "[" + username + "] " + message.getText()
        Message newMessage = new Message(text)
        broadcaster.broadcast(newMessage, isValid(topic, session))
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">    @OnMessage
    fun onMessage(
            topic: String,
            username: String,
            message: Message,
            session: WebSocketSession): Publisher&lt;Message&gt; {

        val text = "[" + username + "] " + message.text
        val newMessage = Message(text)
        return broadcaster.broadcast(newMessage, isValid(topic, session))
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_serverwebsocket_and_scopes"><a class="anchor" href="#_serverwebsocket_and_scopes"></a>@ServerWebSocket and Scopes</h3>
<div class="paragraph">
<p>By default a unique <code>@ServerWebSocket</code> instance is created for each WebSocket connection. This allows you to retrieve the <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> from the <code>@OnOpen</code> handler and assign it to a field of the  <code>@ServerWebSocket</code> instance.</p>
</div>
<div class="paragraph">
<p>If you define the <code>@ServerWebSocket</code> as <code>@Singleton</code> it should be noted that extra care will need to be taken to synchronize local state to avoid thread safety issues.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sharing_sessions_with_the_http_session"><a class="anchor" href="#_sharing_sessions_with_the_http_session"></a>Sharing Sessions with the HTTP Session</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> is by default backed by an in-memory map. If you add the the <code>session</code> module you can however share <a href="#sessions">sessions</a> between the HTTP server and the WebSocket server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When sessions are backed by a persistent store such as Redis then after each message is processed the session is updated to the backing store.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you have created your project using the Micronaut CLI and the default (<code>service</code>) profile, you can use the <code>create-websocket-server</code> command to create a class with <a href="../api/io/micronaut/websocket/WebSocketServer.html">WebSocketServer</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-websocket-server MyChat
| Rendered template WebsocketServer.java to destination src/main/java/example/MyChatServer.java</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_connection_timeouts"><a class="anchor" href="#_connection_timeouts"></a>Connection Timeouts</h3>
<div class="paragraph">
<p>By default Micronaut will timeout idle connections that have no activity after 5 minutes. Normally this is not a problem as browsers will automatically reconnect WebSocket sessions, however you can control this behaviour by setting the <code>micronaut.server.idle-timeout</code> setting (a negative value will result no timeout):</p>
</div>
<div class="listingblock">
<div class="title">Setting the Connection Timeout for the Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        idle-timeout: 30m # 30 minutes</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Micronaut&#8217;s WebSocket client then you may also wish to set the timeout on the client:</p>
</div>
<div class="listingblock">
<div class="title">Setting the Connection Timeout for the Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    http:
        client:
            read-idle-timeout: 30m # 30 minutes</code></pre>
</div>
</div>
</div>

<h2 id="websocketClient"><a class="anchor" href="#websocketClient"></a>6.24.2 Using @ClientWebSocket</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/websocket/websocketClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a> annotation can be used in combination with the <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> interface to define WebSocket clients.</p>
</div>
<div class="paragraph">
<p>You can inject a reference to the a <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> instance using the <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Client("http://localhost:8080")
RxWebSocketClient webSocketClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to use the same service discovery and load balancing features for WebSocket clients.</p>
</div>
<div class="paragraph">
<p>Once you have a reference to the <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> interface you can use the <code>connect</code> method to obtain a connected instance of a bean annotated with <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a>.</p>
</div>
<div class="paragraph">
<p>For example consider the following implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.websocket.WebSocketSession;
import io.micronaut.websocket.annotation.ClientWebSocket;
import io.micronaut.websocket.annotation.OnMessage;
import io.micronaut.websocket.annotation.OnOpen;
import io.reactivex.Single;

import java.util.Collection;
import java.util.concurrent.ConcurrentLinkedQueue;
import java.util.concurrent.Future;


@ClientWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
public abstract class ChatClientWebSocket implements AutoCloseable { <b class="conum">(2)</b>

    private WebSocketSession session;
    private HttpRequest request;
    private String topic;
    private String username;
    private Collection&lt;String&gt; replies = new ConcurrentLinkedQueue&lt;&gt;();

    @OnOpen
    public void onOpen(String topic, String username, WebSocketSession session, HttpRequest request) { <b class="conum">(3)</b>
        this.topic = topic;
        this.username = username;
        this.session = session;
        this.request = request;
    }

    public String getTopic() {
        return topic;
    }

    public String getUsername() {
        return username;
    }

    public Collection&lt;String&gt; getReplies() {
        return replies;
    }

    public WebSocketSession getSession() {
        return session;
    }

    public HttpRequest getRequest() {
        return request;
    }

    @OnMessage
    public void onMessage(
            String message) {
        replies.add(message); <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.ClientWebSocket
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.reactivex.Single

import java.util.concurrent.ConcurrentLinkedQueue
import java.util.concurrent.Future


@ClientWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
abstract class ChatClientWebSocket implements AutoCloseable { <b class="conum">(2)</b>

    private WebSocketSession session
    private HttpRequest request
    private String topic
    private String username
    private Collection&lt;String&gt; replies = new ConcurrentLinkedQueue&lt;&gt;()

    @OnOpen
    void onOpen(String topic, String username, WebSocketSession session, HttpRequest request) { <b class="conum">(3)</b>
        this.topic = topic
        this.username = username
        this.session = session
        this.request = request
    }

    String getTopic() {
        topic
    }

    String getUsername() {
        username
    }

    Collection&lt;String&gt; getReplies() {
        replies
    }

    WebSocketSession getSession() {
        session
    }

    HttpRequest getRequest() {
        request
    }

    @OnMessage
    void onMessage(
            String message) {
        replies.add(message) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.ClientWebSocket
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.reactivex.Single
import java.util.concurrent.ConcurrentLinkedQueue
import java.util.concurrent.Future


@ClientWebSocket("/chat/{topic}/{username}") <b class="conum">(1)</b>
abstract class ChatClientWebSocket : AutoCloseable { <b class="conum">(2)</b>

    var session: WebSocketSession? = null
        private set
    var request: HttpRequest&lt;*&gt;? = null
        private set
    var topic: String? = null
        private set
    var username: String? = null
        private set
    private val replies = ConcurrentLinkedQueue&lt;String&gt;()

    @OnOpen
    fun onOpen(topic: String, username: String, session: WebSocketSession, request: HttpRequest&lt;*&gt;) { <b class="conum">(3)</b>
        this.topic = topic
        this.username = username
        this.session = session
        this.request = request
    }

    fun getReplies(): Collection&lt;String&gt; {
        return replies
    }

    @OnMessage
    fun onMessage(
            message: String) {
        replies.add(message) <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is abstract (more on that later) and is annotated with <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The client must implement <code>AutoCloseable</code> and you should ensure that the connection is closed at some point.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use the same annotations as on the server, in this case <code>@OnOpen</code> to obtain a reference to the underlying session.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@OnMessage</code> annotation can be used to define the method that receives responses from the server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also define abstract methods that start with either <code>send</code> or <code>broadcast</code> and these methods will be implemented for you at compile time. For example:</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract void send(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note by returning <code>void</code> this tells Micronaut that the method is a blocking send. You can instead define methods that return either futures or a <a href="https://docs.oracle.com/javase/8/docs/api/org/reactivestreams/Publisher.html">Publisher</a>:</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract io.reactivex.Single&lt;String&gt; send(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a send method that returns an <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a>.</p>
</div>
<div class="paragraph">
<p>Once you have defined a client class you can connect to the client socket and start sending messages:</p>
</div>
<div class="listingblock">
<div class="title">Connecting a Client WebSocket</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ChatClientWebSocket chatClient = webSocketClient.connect(ChatClientWebSocket.class, "/chat/football/fred").blockingFirst();
chatClient.send("Hello World!");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For illustration purposes we use <code>blockingFirst()</code> to obtain the client, it is however possible to combine <code>connect</code> (which returns an <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>) to perform non-blocking interaction via WebSocket.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you have created your project using the Micronaut CLI and the default (<code>service</code>) profile, you can use the <code>create-websocket-client</code> command to create an abstract class with <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-websocket-client MyChat
| Rendered template WebsocketClient.java to destination src/main/java/example/MyChatClient.java</pre>
</div>
</div>
</td>
</tr>
</table>
</div>

<h2 id="serverEvents"><a class="anchor" href="#serverEvents"></a>6.25 Server Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server will emit a number of <a href="#events">Bean Events</a>, defined in the <a href="../api/io/micronaut/runtime/server/event/package-summary.html">io.micronaut.runtime.server.event</a> package, that you can write listeners for. The following table summarizes those events:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Server Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server completes startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server shuts down</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceStartedEvent.html">ServiceStartedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> listeners have been executed and exposes the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceShutdownEvent.html">ServiceShutdownEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a> listeners have been executed and exposes the <a href="../api/io/micronaut/runtime/server/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you do significant work within a listener for a <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> this will slow down you startup time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example defines a <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> that listens for <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a>:</p>
</div>
<div class="listingblock">
<div class="title">Listening for Server Startup Events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.event.ApplicationEventListener;
...
@Singleton
public class StartupListener implements ApplicationEventListener&lt;ServerStartupEvent&gt; {
    @Override
    public void onApplicationEvent(ServerStartupEvent event) {
        // logic here
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can also use the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation on a method of any existing bean that accepts <code>ServerStartupEvent</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@EventListener</code> with <code>ServerStartupEvent</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.server.event.*;
import io.micronaut.runtime.event.annotation.*;
...
@Singleton
public class MyBean {

    @EventListener
    public void onStartup(ServerStartupEvent event) {
        // logic here
        ...
    }
}</code></pre>
</div>
</div>

<h2 id="serverConfiguration"><a class="anchor" href="#serverConfiguration"></a>6.26 Configuring the HTTP Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server features a number of configuration options you may wish to tweak. They are defined in the <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a> configuration class, which extends <a href="../api/io/micronaut/http/server/HttpServerConfiguration.html">HttpServerConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to tweak configuration options for the server via <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring HTTP server settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        maxRequestSize: 1MB
        host: localhost <i class="conum" data-value="1"></i><b>(1)</b>
        netty:
           maxHeaderSize: 500KB <i class="conum" data-value="2"></i><b>(2)</b>
           worker:
              threads: 8 <i class="conum" data-value="3"></i><b>(3)</b>
           childOptions:
              autoRead: true <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default Micronaut will bind to all the network interfaces. Use <code>localhost</code> to bind only to loopback network interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Maximum size for headers</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Number of netty worker threads</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Auto read request body</td>
</tr>
</table>
</div>
<a id="io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration" href="#io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.child-options</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Netty child worker options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.options</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the channel options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-initial-line-length</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum initial line length for the HTTP request. Default value (4096).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-header-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size of any one header. Default value (8192).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-chunk-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size of any single request chunk. Default value (8192).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.chunked-supported</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether chunked transfer encoding is supported. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.validate-headers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to validate incoming headers. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.initial-buffer-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the initial buffer size. Default value (128).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.log-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.netty.handler.logging.LogLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Netty log level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.compression-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the minimum size of a request body must be in order to be compressed. Default value (1024).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.compression-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the compression level (0-9). Default value (6).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.use-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to use netty&#8217;s native transport (epoll or kqueue) if available . Default value (false).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>use-native-transport</code> option also requires the relevant netty dependency to take effect. The native transports add features specific to a particular platform, generate less garbage, and generally improve performance when compared to the NIO based transport.</p>
</div>
<div class="paragraph">
<p>For macOS:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">runtime <span class="hljs-string">'io.netty:netty-transport-native-kqueue:osx-x86_64'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-kqueue&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;osx-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For Linux:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="gradle">runtime <span class="hljs-string">'io.netty:netty-transport-native-epoll:linux-x86_64'</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-epoll&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;linux-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>

<h2 id="threadPools"><a class="anchor" href="#threadPools"></a>6.26.1 Configuring Server Thread Pools</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration/threadPools.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server is built on <a href="http://netty.io">Netty</a> which is designed as a non-blocking I/O toolkit in an event loop model.</p>
</div>
<div class="paragraph">
<p>To configure the number of threads used by the Netty <a href="https://netty.io/4.0/api/io/netty/channel/EventLoop.html">EventLoop</a>, you can use <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Netty Event Loop Threads</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        netty:
           worker:
              threads: 8 # number of netty worker threads</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value is the value of the system property <code>io.netty.eventLoopThreads</code> or if not specified the available processors x 2
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When dealing with blocking operations, Micronaut will shift the blocking operations to an unbound, caching I/O thread pool by default. You can configure the I/O thread pool using the <a href="../api/io/micronaut/scheduling/executor/ExecutorConfiguration.html">ExecutorConfiguration</a> named <code>io</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the Server I/O Thread Pool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    executors:
        io:
           type: fixed
           nThreads: 75</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration will create a fixed thread pool with 75 threads.</p>
</div>

<h2 id="cors"><a class="anchor" href="#cors"></a>6.26.2 Configuring CORS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration/cors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports CORS (<a href="https://www.w3.org/TR/cors/">Cross Origin Resource Sharing</a>) out of the box. By default, CORS requests will be rejected. To enable processing of CORS requests, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">CORS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By only enabling CORS processing, a "wide open" strategy will be adopted that will allow requests from any origin.</p>
</div>
<div class="paragraph">
<p>To change the settings for all origins or a specific origin, change the configuration to provide a set of "configurations". By providing any configuration, the default "wide open" configuration is not configured.</p>
</div>
<div class="listingblock">
<div class="title">CORS Configurations (&#8230;&#8203; is a placeholder)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                all:
                    ...
                web:
                    ...
                mobile:
                    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, three configurations are being provided. Their names (<code>all</code>, <code>web</code>, <code>mobile</code>) are not important and have no significance inside Micronaut. They are there purely to be able to easily recognize the intended user of the configuration.</p>
</div>
<div class="paragraph">
<p>The same configuration properties can be applied to each configuration. See <a href="../api/io/micronaut/http/server/cors/CorsOriginConfiguration.html">CorsOriginConfiguration</a> for the reference of properties that can be defined. Each configuration supplied will have its values default to the default values of the corresponding fields.</p>
</div>
<div class="paragraph">
<p>When a CORS request is made, configurations are searched for allowed origins that are an exact match or match the request origin through a regular expression.</p>
</div>
<div class="sect1">
<h2 id="_allowed_origins"><a class="anchor" href="#_allowed_origins"></a>Allowed Origins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any origin for a given configuration, simply don&#8217;t include the <code>allowedOrigins</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of valid origins, set the <code>allowedOrigins</code> key of the configuration to a list of strings. Each value can either be a static value (<code><a href="http://www.foo.com" class="bare">http://www.foo.com</a></code>) or a regular expression (<code>^http(|s)://www\.google\.com$</code>).</p>
</div>
<div class="paragraph">
<p>Any regular expressions are passed to <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#compile-java.lang.String-">Pattern#compile</a> and compared to the request origin with <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#matches--">Matcher#matches</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowedOrigins:
                        - http://foo.com
                        - ^http(|s):\/\/www\.google\.com$</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allowed_methods"><a class="anchor" href="#_allowed_methods"></a>Allowed Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any request method for a given configuration, simply don&#8217;t include the <code>allowedMethods</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of allowed methods, set the <code>allowedMethods</code> key of the configuration to a list of strings.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowedMethods:
                        - POST
                        - PUT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allowed_headers"><a class="anchor" href="#_allowed_headers"></a>Allowed Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow any request header for a given configuration, simply don&#8217;t include the <code>allowedHeaders</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>To specify a list of allowed headers, set the <code>allowedHeaders</code> key of the configuration to a list of strings.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowedHeaders:
                        - Content-Type
                        - Authorization</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exposed_headers"><a class="anchor" href="#_exposed_headers"></a>Exposed Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the list of headers that are sent in the response to a CORS request through the <code>Access-Control-Expose-Headers</code> header, include a list of strings for the <code>exposedHeaders</code> key in your configuration. By default no headers are exposed.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    exposedHeaders:
                        - Content-Type
                        - Authorization</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_allow_credentials"><a class="anchor" href="#_allow_credentials"></a>Allow Credentials</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Credentials are allowed by default for CORS requests. To disallow credentials, simply set the <code>allowCredentials</code> option to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    allowCredentials: false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_max_age"><a class="anchor" href="#_max_age"></a>Max Age</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default maximum age that preflight requests can be cached is 30 minutes. To change that behavior, specify a value in seconds.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            enabled: true
            configurations:
                web:
                    maxAge: 3600 # 1 hour</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_header_values"><a class="anchor" href="#_multiple_header_values"></a>Multiple Header Values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default when a header has multiple values, multiple headers will be sent each with a single value. It is possible to change the behavior to send a single header with the list of values comma separated by setting a configuration option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        cors:
            single-header: true</code></pre>
</div>
</div>
</div>
</div>

<h2 id="https"><a class="anchor" href="#https"></a>6.26.3 Securing the Server with HTTPS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration/https.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports HTTPS out of the box. By default HTTPS is disabled and all requests are served using HTTP. To enable
HTTPS support, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        buildSelfSigned: true <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Micronaut will create a self-signed certificate.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default Micronaut with HTTPS support starts on port <code>8443</code> but you can change the port the property
 <code>micronaut.ssl.port</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Keep in mind that this configuration will generate a warning on the browser.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/https-warning.jpg" alt="https warning">
</div>
</div>
<div class="sect1">
<h2 id="_using_a_valid_x509_certificate"><a class="anchor" href="#_using_a_valid_x509_certificate"></a>Using a valid x509 certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to configure Micronaut to use an existing valid x509 certificate, for example one created with
<a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a>. You will need the <code>server.crt</code> and <code>server.key</code> files and convert them to a
 PKCS #12 file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ openssl pkcs12 -export \
                 -in server.crt \ <i class="conum" data-value="1"></i><b>(1)</b>
                 -inkey server.key \ <i class="conum" data-value="2"></i><b>(2)</b>
                 -out server.p12 \ <i class="conum" data-value="3"></i><b>(3)</b>
                 -name someAlias \ <i class="conum" data-value="4"></i><b>(4)</b>
                 -CAfile ca.crt -caname root</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The original <code>server.crt</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The original <code>server.key</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>server.p12</code> file that will be created</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias for the certificate</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During the creation of the <code>server.p12</code> file it is necessary to define a password that will be required later when using
the certificate in Micronaut.</p>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        keyStore:
            path: classpath:server.p12 <i class="conum" data-value="1"></i><b>(1)</b>
            password: mypassword <i class="conum" data-value="2"></i><b>(2)</b>
            type: PKCS12</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>p12</code> file created. It can also be referenced as <code>file:/path/to/the/file</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The password defined during the export</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this configuration if we start Micronaut and connect to <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> we still see the warning on the
browser but if we inspect the certificate we can check that it&#8217;s the one generated by Let&#8217;s Encrypt.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/https-certificate.jpg" alt="https certificate">
</div>
</div>
<div class="paragraph">
<p>Finally we can test that the certificate is valid for the browser just by adding an alias to the domain in <code>/etc/hosts</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cat /etc/hosts
...
127.0.0.1   my-domain.org
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can connect to <code><a href="https://my-domain.org:8443" class="bare">https://my-domain.org:8443</a></code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.micronaut.io/docsassets/img/https-valid-certificate.jpg" alt="https valid certificate">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_java_keystore_jks"><a class="anchor" href="#_using_java_keystore_jks"></a>Using Java Keystore (JKS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is not recommended using this type of certificate because it is a proprietary format and it&#8217;s better to use a PKCS12
format. In any case Micronaut also supports it.</p>
</div>
<div class="paragraph">
<p>Convert the <code>p12</code> certificate to a JKS one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ keytool -importkeystore \
          -deststorepass newPassword -destkeypass newPassword \ <i class="conum" data-value="1"></i><b>(1)</b>
          -destkeystore server.keystore \ <i class="conum" data-value="2"></i><b>(2)</b>
          -srckeystore server.p12 -srcstoretype PKCS12 -srcstorepass mypassword \ <i class="conum" data-value="3"></i><b>(3)</b>
          -alias someAlias <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is necessary to define a the password for the keystore</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The file that will be created</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The PKCS12 file created before and the password defined during the creation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias used before</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If either <code>srcstorepass</code> or <code>alias</code> are not the same as defined in the <code>p12</code> file, the conversion will fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="listingblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        keyStore:
            path: classpath:server.keystore
            password: newPassword
            type: JKS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start Micronaut and the application is running on <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> using the certificate in the keystore.</p>
</div>
</div>
</div>

<h2 id="dualProtocol"><a class="anchor" href="#dualProtocol"></a>6.26.4 Enabling HTTP and HTTPS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/serverConfiguration/dualProtocol.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports binding both HTTP and HTTPS out of the box. To enable
dual protocol support, modify your configuration. For example with <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Dual Protocol Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    ssl:
        enabled: true
        buildSelfSigned: true <i class="conum" data-value="1"></i><b>(1)</b>
    server:
        dualProtocol : true <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You will need to configure ssl for https to work. In this example we are just using self signed but see <a href="#https">Securing the Server with HTTPS</a> for other configurations</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>To enable http &amp; https is an opt-in feature, setting the dualProtocol flag enables that, by default Micronaut will only enable one or the other</td>
</tr>
</table>
</div>

<h2 id="views"><a class="anchor" href="#views"></a>6.27 Server Side View Rendering</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/views.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports Server Side View Rendering.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-views/latest/guide">Micronaut Views</a> for more information.</p>
</div>

<h2 id="openapi"><a class="anchor" href="#openapi"></a>6.28 OpenAPI / Swagger Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/openapi.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure Micronaut integration with <a href="https://swagger.io/docs/specification/about/">OpenAPI/Swagger</a>, please follow
<a href="https://micronaut-projects.github.io/micronaut-openapi/latest/guide/index.html">these instructions</a></p>
</div>

<h2 id="graphql"><a class="anchor" href="#graphql"></a>6.29 GraphQL Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/master/src/main/docs/guide/httpServer/graphql.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://graphql.org/">GraphQL</a> is a query language for building APIs that provides an intuitive and flexible syntax and a system for describing data requirements and interactions.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-graphql/latest/guide">Micronaut GraphQL</a> for more information on how to build GraphQL applications with Micronaut.</p>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/aop.html">&lt;&lt; <strong>5</strong><span>Aspect Oriented Programming</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/httpClient.html"><strong>7</strong><span>The HTTP Client</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="https://docs.micronaut.io/docsassets/js/docs.js"></script>

</body>
</html>

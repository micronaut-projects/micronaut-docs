<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#ioc"><strong>3</strong><span>Inversion of Control</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#config"><strong>4</strong><span>Application Configuration</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#aop"><strong>5</strong><span>Aspect Oriented Programming</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#httpServer"><strong>6</strong><span>The HTTP Server</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#httpClient"><strong>7</strong><span>The HTTP Client</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#cloud"><strong>8</strong><span>Cloud Native Features</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#serverlessFunctions"><strong>9</strong><span>Serverless Functions</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#messaging"><strong>10</strong><span>Message-Driven Microservices</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#commandLineApps"><strong>11</strong><span>Standalone Command Line Applications</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#configurations"><strong>12</strong><span>Configurations</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#logging"><strong>13</strong><span>Logging</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#languageSupport"><strong>14</strong><span>Language Support</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#management"><strong>15</strong><span>Management &amp; Monitoring</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#security"><strong>16</strong><span>Security</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#multitenancy"><strong>17</strong><span>Multi-Tenancy</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#cli"><strong>18</strong><span>Micronaut CLI</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#i18n"><strong>19</strong><span>Internationalization</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#appendix"><strong>20</strong><span>Appendices</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-whatsNew"><a href="#whatsNew"><strong>1.1</strong><span>What's New?</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-upgrading"><a href="#upgrading"><strong>1.2</strong><span>Upgrading to Micronaut 3.x</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-quickStart"><a href="#quickStart"><strong>2</strong><span>Quick Start</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-buildCLI"><a href="#buildCLI"><strong>2.1</strong><span>Install the CLI</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-creatingServer"><a href="#creatingServer"><strong>2.2</strong><span>Creating a Server Application</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-ideSetup"><a href="#ideSetup"><strong>2.3</strong><span>Setting up an IDE</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-ideaSetup"><a href="#ideaSetup"><strong>2.3.1</strong><span>IntelliJ IDEA</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-eclipseSetup"><a href="#eclipseSetup"><strong>2.3.2</strong><span>Eclipse</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-vsCodeSetup"><a href="#vsCodeSetup"><strong>2.3.3</strong><span>Visual Studio Code</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-creatingClient"><a href="#creatingClient"><strong>2.4</strong><span>Creating a Client</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-deployingApp"><a href="#deployingApp"><strong>2.5</strong><span>Deploying the Application</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-ioc"><a href="#ioc"><strong>3</strong><span>Inversion of Control</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beans"><a href="#beans"><strong>3.1</strong><span>Defining Beans</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-how"><a href="#how"><strong>3.2</strong><span>How Does it Work?</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beanContext"><a href="#beanContext"><strong>3.3</strong><span>The BeanContext</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-types"><a href="#types"><strong>3.4</strong><span>Injectable Container Types</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-qualifiers"><a href="#qualifiers"><strong>3.5</strong><span>Bean Qualifiers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-typed"><a href="#typed"><strong>3.6</strong><span>Limiting Injectable Types</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-scopes"><a href="#scopes"><strong>3.7</strong><span>Scopes</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-builtInScopes"><a href="#builtInScopes"><strong>3.7.1</strong><span>Built-In Scopes</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-eagerInit"><a href="#eagerInit"><strong>3.7.1.1</strong><span>Eager Initialization of Singletons</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-refreshable"><a href="#refreshable"><strong>3.7.2</strong><span>Refreshable Scope</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-metaScopes"><a href="#metaScopes"><strong>3.7.3</strong><span>Scopes on Meta Annotations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-factories"><a href="#factories"><strong>3.8</strong><span>Bean Factories</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-conditionalBeans"><a href="#conditionalBeans"><strong>3.9</strong><span>Conditional Beans</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-replaces"><a href="#replaces"><strong>3.10</strong><span>Bean Replacement</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beanConfigurations"><a href="#beanConfigurations"><strong>3.11</strong><span>Bean Configurations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-lifecycle"><a href="#lifecycle"><strong>3.12</strong><span>Life-Cycle Methods</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-contextEvents"><a href="#contextEvents"><strong>3.13</strong><span>Context Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-events"><a href="#events"><strong>3.14</strong><span>Bean Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-introspection"><a href="#introspection"><strong>3.15</strong><span>Bean Introspection</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beanValidation"><a href="#beanValidation"><strong>3.16</strong><span>Bean Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-annotationMetadata"><a href="#annotationMetadata"><strong>3.17</strong><span>Bean Annotation Metadata</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-beanImport"><a href="#beanImport"><strong>3.18</strong><span>Importing Beans from Libraries</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-nullabilityAnnotations"><a href="#nullabilityAnnotations"><strong>3.19</strong><span>Nullability Annotations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-springBeans"><a href="#springBeans"><strong>3.20</strong><span>Micronaut Beans And Spring</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-android"><a href="#android"><strong>3.21</strong><span>Android Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-config"><a href="#config"><strong>4</strong><span>Application Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-environments"><a href="#environments"><strong>4.1</strong><span>The Environment</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-propertySource"><a href="#propertySource"><strong>4.2</strong><span>Externalized Configuration with PropertySources</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-valueAnnotation"><a href="#valueAnnotation"><strong>4.3</strong><span>Configuration Injection</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-configurationProperties"><a href="#configurationProperties"><strong>4.4</strong><span>Configuration Properties</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-customTypeConverter"><a href="#customTypeConverter"><strong>4.5</strong><span>Custom Type Converters</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-eachProperty"><a href="#eachProperty"><strong>4.6</strong><span>Using @EachProperty to Drive Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-eachBean"><a href="#eachBean"><strong>4.7</strong><span>Using @EachBean to Drive Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-immutableConfig"><a href="#immutableConfig"><strong>4.8</strong><span>Immutable Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-bootstrap"><a href="#bootstrap"><strong>4.9</strong><span>Bootstrap Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jmx"><a href="#jmx"><strong>4.10</strong><span>JMX Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-aop"><a href="#aop"><strong>5</strong><span>Aspect Oriented Programming</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-aroundAdvice"><a href="#aroundAdvice"><strong>5.1</strong><span>Around Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-introductionAdvice"><a href="#introductionAdvice"><strong>5.2</strong><span>Introduction Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-adapterAdvice"><a href="#adapterAdvice"><strong>5.3</strong><span>Method Adapter Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-lifecycleAdvice"><a href="#lifecycleAdvice"><strong>5.4</strong><span>Bean Life Cycle Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-validation"><a href="#validation"><strong>5.5</strong><span>Validation Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-caching"><a href="#caching"><strong>5.6</strong><span>Cache Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-retry"><a href="#retry"><strong>5.7</strong><span>Retry Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-scheduling"><a href="#scheduling"><strong>5.8</strong><span>Scheduled Tasks</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-springAop"><a href="#springAop"><strong>5.9</strong><span>Bridging Spring AOP</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-httpServer"><a href="#httpServer"><strong>6</strong><span>The HTTP Server</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-runningServer"><a href="#runningServer"><strong>6.1</strong><span>Running the Embedded Server</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-runningSpecificPort"><a href="#runningSpecificPort"><strong>6.2</strong><span>Running Server on a Specific Port</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-routing"><a href="#routing"><strong>6.3</strong><span>HTTP Routing</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-binding"><a href="#binding"><strong>6.4</strong><span>Simple Request Binding</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-customArgumentBinding"><a href="#customArgumentBinding"><strong>6.5</strong><span>Custom Argument Binding</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hostResolution"><a href="#hostResolution"><strong>6.6</strong><span>Host Resolution</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-localeResolution"><a href="#localeResolution"><strong>6.7</strong><span>Locale Resolution</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientIpAddress"><a href="#clientIpAddress"><strong>6.8</strong><span>Client IP Address</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-requestResponse"><a href="#requestResponse"><strong>6.9</strong><span>The HttpRequest and HttpResponse</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-statusAnnotation"><a href="#statusAnnotation"><strong>6.10</strong><span>Response Status</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-producesAnnotation"><a href="#producesAnnotation"><strong>6.11</strong><span>Response Content-Type</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-consumesAnnotation"><a href="#consumesAnnotation"><strong>6.12</strong><span>Accepted Request Content-Type</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-reactiveServer"><a href="#reactiveServer"><strong>6.13</strong><span>Reactive HTTP Request Processing</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-bodyAnnotation"><a href="#bodyAnnotation"><strong>6.13.1</strong><span>Using the @Body Annotation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-reactiveResponses"><a href="#reactiveResponses"><strong>6.13.2</strong><span>Reactive Responses</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jsonBinding"><a href="#jsonBinding"><strong>6.14</strong><span>JSON Binding with Jackson</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-datavalidation"><a href="#datavalidation"><strong>6.15</strong><span>Data Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-validationGroups"><a href="#validationGroups"><strong>6.15.1</strong><span>Validation Groups</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-staticResources"><a href="#staticResources"><strong>6.16</strong><span>Serving Static Resources</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-errorHandling"><a href="#errorHandling"><strong>6.17</strong><span>Error Handling</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-statusHandlers"><a href="#statusHandlers"><strong>6.17.1</strong><span>Status Handlers</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-localErrorHandling"><a href="#localErrorHandling"><strong>6.17.2</strong><span>Local Error Handling</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-globalErrorHandling"><a href="#globalErrorHandling"><strong>6.17.3</strong><span>Global Error Handling</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-exceptionHandler"><a href="#exceptionHandler"><strong>6.17.4</strong><span>ExceptionHandler</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-builtInExceptionHandlers"><a href="#builtInExceptionHandlers"><strong>6.17.4.1</strong><span>Built-In Exception Handlers</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-customExceptionHandler"><a href="#customExceptionHandler"><strong>6.17.4.2</strong><span>Custom Exception Handler</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-errorFormatting"><a href="#errorFormatting"><strong>6.17.5</strong><span>Error Formatting</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-apiVersioning"><a href="#apiVersioning"><strong>6.18</strong><span>API Versioning</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-formData"><a href="#formData"><strong>6.19</strong><span>Handling Form Data</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serverIO"><a href="#serverIO"><strong>6.20</strong><span>Writing Response Data</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-uploads"><a href="#uploads"><strong>6.21</strong><span>File Uploads</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-transfers"><a href="#transfers"><strong>6.22</strong><span>File Transfers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-filters"><a href="#filters"><strong>6.23</strong><span>HTTP Filters</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-sessions"><a href="#sessions"><strong>6.24</strong><span>HTTP Sessions</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-sse"><a href="#sse"><strong>6.25</strong><span>Server Sent Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-websocket"><a href="#websocket"><strong>6.26</strong><span>WebSocket Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-websocketServer"><a href="#websocketServer"><strong>6.26.1</strong><span>Using @ServerWebSocket</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-websocketClient"><a href="#websocketClient"><strong>6.26.2</strong><span>Using @ClientWebSocket</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-http2Server"><a href="#http2Server"><strong>6.27</strong><span>HTTP/2 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serverEvents"><a href="#serverEvents"><strong>6.28</strong><span>Server Events</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serverConfiguration"><a href="#serverConfiguration"><strong>6.29</strong><span>Configuring the HTTP Server</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-threadPools"><a href="#threadPools"><strong>6.29.1</strong><span>Configuring Server Thread Pools</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-blockingOperations"><a href="#blockingOperations"><strong>6.29.1.1</strong><span>Blocking Operations</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-atBlocking"><a href="#atBlocking"><strong>6.29.1.2</strong><span>@Blocking</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-nettyClientPipeline"><a href="#nettyClientPipeline"><strong>6.29.2</strong><span>Configuring the Netty Client Pipeline</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-nettyServerPipeline"><a href="#nettyServerPipeline"><strong>6.29.3</strong><span>Configuring the Netty Server Pipeline</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-listener"><a href="#listener"><strong>6.29.4</strong><span>Advanced Listener Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-cors"><a href="#cors"><strong>6.29.5</strong><span>Configuring CORS</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-annotationBasedCors"><a href="#annotationBasedCors"><strong>6.29.5.1</strong><span>Annotation-based CORS Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsConfiguration"><a href="#corsConfiguration"><strong>6.29.5.2</strong><span>CORS via Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsAllowedOrigins"><a href="#corsAllowedOrigins"><strong>6.29.5.3</strong><span>Allowed Origins</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsAllowedMethods"><a href="#corsAllowedMethods"><strong>6.29.5.4</strong><span>Allowed Methods</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsAllowedHeaders"><a href="#corsAllowedHeaders"><strong>6.29.5.5</strong><span>Allowed Headers</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsExposedHeaders"><a href="#corsExposedHeaders"><strong>6.29.5.6</strong><span>Exposed Headers</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsAllowCredentials"><a href="#corsAllowCredentials"><strong>6.29.5.7</strong><span>Allow Credentials</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsMaxAge"><a href="#corsMaxAge"><strong>6.29.5.8</strong><span>Max Age</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-corsMultipleHeaderValues"><a href="#corsMultipleHeaderValues"><strong>6.29.5.9</strong><span>Multiple Header Values</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-https"><a href="#https"><strong>6.29.6</strong><span>Securing the Server with HTTPS</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-dualProtocol"><a href="#dualProtocol"><strong>6.29.7</strong><span>Enabling HTTP and HTTPS</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-accessLogger"><a href="#accessLogger"><strong>6.29.8</strong><span>Enabling Access Logger</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-secondaryServers"><a href="#secondaryServers"><strong>6.29.9</strong><span>Starting Secondary Servers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-views"><a href="#views"><strong>6.30</strong><span>Server Side View Rendering</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-openapi"><a href="#openapi"><strong>6.31</strong><span>OpenAPI / Swagger Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-graphql"><a href="#graphql"><strong>6.32</strong><span>GraphQL Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-httpClient"><a href="#httpClient"><strong>7</strong><span>The HTTP Client</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-lowLevelHttpClient"><a href="#lowLevelHttpClient"><strong>7.1</strong><span>Using the Low-Level HTTP Client</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientBasics"><a href="#clientBasics"><strong>7.1.1</strong><span>Sending your first HTTP request</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientPostRequests"><a href="#clientPostRequests"><strong>7.1.2</strong><span>Posting a Request Body</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientUploads"><a href="#clientUploads"><strong>7.1.3</strong><span>Multipart Client Uploads</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientStreaming"><a href="#clientStreaming"><strong>7.1.4</strong><span>Streaming JSON over HTTP</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientConfiguration"><a href="#clientConfiguration"><strong>7.1.5</strong><span>Configuring HTTP clients</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-lowLevelClientError"><a href="#lowLevelClientError"><strong>7.1.6</strong><span>Error Responses</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-bindErrors"><a href="#bindErrors"><strong>7.1.7</strong><span>Bind Errors</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-proxyClient"><a href="#proxyClient"><strong>7.2</strong><span>Proxying Requests with ProxyHttpClient</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientAnnotation"><a href="#clientAnnotation"><strong>7.3</strong><span>Declarative HTTP Clients with @Client</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientParameters"><a href="#clientParameters"><strong>7.3.1</strong><span>Customizing Parameter Binding</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientAnnotationStreaming"><a href="#clientAnnotationStreaming"><strong>7.3.2</strong><span>Streaming with @Client</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientError"><a href="#clientError"><strong>7.3.3</strong><span>Error Responses</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientHeaders"><a href="#clientHeaders"><strong>7.3.4</strong><span>Customizing Request Headers</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientJackson"><a href="#clientJackson"><strong>7.3.5</strong><span>Customizing Jackson Settings</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientRetry"><a href="#clientRetry"><strong>7.3.6</strong><span>Retry and Circuit Breaker</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientFallback"><a href="#clientFallback"><strong>7.3.7</strong><span>Client Fallbacks</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-netflixHystrix"><a href="#netflixHystrix"><strong>7.3.8</strong><span>Netflix Hystrix Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientFilter"><a href="#clientFilter"><strong>7.4</strong><span>HTTP Client Filters</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientHttp2"><a href="#clientHttp2"><strong>7.5</strong><span>HTTP/2 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientSample"><a href="#clientSample"><strong>7.6</strong><span>HTTP Client Sample</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-cloud"><a href="#cloud"><strong>8</strong><span>Cloud Native Features</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-cloudConfiguration"><a href="#cloudConfiguration"><strong>8.1</strong><span>Cloud Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfiguration"><a href="#distributedConfiguration"><strong>8.1.1</strong><span>Distributed Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationConsul"><a href="#distributedConfigurationConsul"><strong>8.1.2</strong><span>HashiCorp Consul Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationVault"><a href="#distributedConfigurationVault"><strong>8.1.3</strong><span>HashiCorp Vault Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationSpringCloud"><a href="#distributedConfigurationSpringCloud"><strong>8.1.4</strong><span>Spring Cloud Config Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationAwsParameterStore"><a href="#distributedConfigurationAwsParameterStore"><strong>8.1.5</strong><span>AWS Parameter Store Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationOracleCloudVault"><a href="#distributedConfigurationOracleCloudVault"><strong>8.1.6</strong><span>Oracle Cloud Vault Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationPubSub"><a href="#distributedConfigurationPubSub"><strong>8.1.7</strong><span>Google Cloud Pub/Sub Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-distributedConfigurationKubernetes"><a href="#distributedConfigurationKubernetes"><strong>8.1.8</strong><span>Kubernetes Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-serviceDiscovery"><a href="#serviceDiscovery"><strong>8.2</strong><span>Service Discovery</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryConsul"><a href="#serviceDiscoveryConsul"><strong>8.2.1</strong><span>Consul Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryEureka"><a href="#serviceDiscoveryEureka"><strong>8.2.2</strong><span>Eureka Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryKubernetes"><a href="#serviceDiscoveryKubernetes"><strong>8.2.3</strong><span>Kubernetes Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryRoute53"><a href="#serviceDiscoveryRoute53"><strong>8.2.4</strong><span>AWS Route 53 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-serviceDiscoveryManual"><a href="#serviceDiscoveryManual"><strong>8.2.5</strong><span>Manual Service Discovery Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-clientSideLoadBalancing"><a href="#clientSideLoadBalancing"><strong>8.3</strong><span>Client Side Load Balancing</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-netflixRibbon"><a href="#netflixRibbon"><strong>8.3.1</strong><span>Netflix Ribbon Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-distributedTracing"><a href="#distributedTracing"><strong>8.4</strong><span>Distributed Tracing</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-serverlessFunctions"><a href="#serverlessFunctions"><strong>9</strong><span>Serverless Functions</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-awsLambda"><a href="#awsLambda"><strong>9.1</strong><span>AWS Lambda</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-gcpFunction"><a href="#gcpFunction"><strong>9.2</strong><span>Google Cloud Function</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-gcpCloudRun"><a href="#gcpCloudRun"><strong>9.3</strong><span>Google Cloud Run</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-azureFunction"><a href="#azureFunction"><strong>9.4</strong><span>Azure Function</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-messaging"><a href="#messaging"><strong>10</strong><span>Message-Driven Microservices</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-kafka"><a href="#kafka"><strong>10.1</strong><span>Kafka Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-rabbitmq"><a href="#rabbitmq"><strong>10.2</strong><span>RabbitMQ Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-nats"><a href="#nats"><strong>10.3</strong><span>Nats.io Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-commandLineApps"><a href="#commandLineApps"><strong>11</strong><span>Standalone Command Line Applications</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-picocli"><a href="#picocli"><strong>11.1</strong><span>Picocli Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-configurations"><a href="#configurations"><strong>12</strong><span>Configurations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-reactiveConfigs"><a href="#reactiveConfigs"><strong>12.1</strong><span>Configurations for Reactive Programming</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-reactor"><a href="#reactor"><strong>12.1.1</strong><span>Reactor Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-rxjava3"><a href="#rxjava3"><strong>12.1.2</strong><span>RxJava 3 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-rxjava2"><a href="#rxjava2"><strong>12.1.3</strong><span>RxJava 2 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-rxjava1"><a href="#rxjava1"><strong>12.1.4</strong><span>RxJava 1 Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-dataAccess"><a href="#dataAccess"><strong>12.2</strong><span>Configurations for Data Access</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-sqlSupport"><a href="#sqlSupport"><strong>12.2.1</strong><span>Configuring a SQL Data Source</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-hibernateSupport"><a href="#hibernateSupport"><strong>12.2.2</strong><span>Configuring Hibernate</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-mongoSupport"><a href="#mongoSupport"><strong>12.2.3</strong><span>Configuring MongoDB</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-neo4jSupport"><a href="#neo4jSupport"><strong>12.2.4</strong><span>Configuring Neo4j</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-postgresSupport"><a href="#postgresSupport"><strong>12.2.5</strong><span>Configuring Postgres</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-redisSupport"><a href="#redisSupport"><strong>12.2.6</strong><span>Configuring Redis</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-cassandraSupport"><a href="#cassandraSupport"><strong>12.2.7</strong><span>Configuring Cassandra</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-liquibaseSupport"><a href="#liquibaseSupport"><strong>12.2.8</strong><span>Configuring Liquibase</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-flywaySupport"><a href="#flywaySupport"><strong>12.2.9</strong><span>Configuring Flyway</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-logging"><a href="#logging"><strong>13</strong><span>Logging</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-loggingMessages"><a href="#loggingMessages"><strong>13.1</strong><span>Logging Messages</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-loggingConfiguration"><a href="#loggingConfiguration"><strong>13.2</strong><span>Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-logback"><a href="#logback"><strong>13.3</strong><span>Logback</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-loggingSystem"><a href="#loggingSystem"><strong>13.4</strong><span>Logging System</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-languageSupport"><a href="#languageSupport"><strong>14</strong><span>Language Support</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-java"><a href="#java"><strong>14.1</strong><span>Micronaut for Java</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-java9"><a href="#java9"><strong>14.1.1</strong><span>Using Micronaut with Java 9+</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-incrementalannotationgradle"><a href="#incrementalannotationgradle"><strong>14.1.2</strong><span>Incremental Annotation Processing with Gradle</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-lombok"><a href="#lombok"><strong>14.1.3</strong><span>Using Project Lombok</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-ide"><a href="#ide"><strong>14.1.4</strong><span>Configuring an IDE</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-retainparameternames"><a href="#retainparameternames"><strong>14.1.5</strong><span>Retaining Parameter Names</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-groovy"><a href="#groovy"><strong>14.2</strong><span>Micronaut for Groovy</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-kotlin"><a href="#kotlin"><strong>14.3</strong><span>Micronaut for Kotlin</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-kaptintellij"><a href="#kaptintellij"><strong>14.3.1</strong><span>Kotlin, Kapt and IntelliJ</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-gradlekapt"><a href="#gradlekapt"><strong>14.3.2</strong><span>Incremental Annotation Processing with Gradle and Kapt</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-openandaop"><a href="#openandaop"><strong>14.3.3</strong><span>Kotlin and AOP Advice</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-kotlinretainparamnames"><a href="#kotlinretainparamnames"><strong>14.3.4</strong><span>Kotlin and Retaining Parameter Names</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-coroutines"><a href="#coroutines"><strong>14.3.5</strong><span>Coroutines Support</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-coroutineTracingContextPropagation"><a href="#coroutineTracingContextPropagation"><strong>14.3.6</strong><span>Coroutine Tracing Context Propagation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-kotlinContextPropagation"><a href="#kotlinContextPropagation"><strong>14.3.7</strong><span>Reactive Context Propagation</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-graal"><a href="#graal"><strong>14.4</strong><span>Micronaut for GraalVM</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-graalServices"><a href="#graalServices"><strong>14.4.1</strong><span>Microservices as GraalVM native images</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-graalFAQ"><a href="#graalFAQ"><strong>14.4.2</strong><span>GraalVM and Micronaut FAQ</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-management"><a href="#management"><strong>15</strong><span>Management &amp; Monitoring</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-buildingEndpoints"><a href="#buildingEndpoints"><strong>15.1</strong><span>Creating Endpoints</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointAnnotation"><a href="#endpointAnnotation"><strong>15.1.1</strong><span>The Endpoint Annotation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointMethod"><a href="#endpointMethod"><strong>15.1.2</strong><span>Endpoint Methods</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointSensitivity"><a href="#endpointSensitivity"><strong>15.1.3</strong><span>Endpoint Sensitivity</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endpointConfiguration"><a href="#endpointConfiguration"><strong>15.1.4</strong><span>Endpoint Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-providedEndpoints"><a href="#providedEndpoints"><strong>15.2</strong><span>Built-In Endpoints</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-beansEndpoint"><a href="#beansEndpoint"><strong>15.2.1</strong><span>The Beans Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-infoEndpoint"><a href="#infoEndpoint"><strong>15.2.2</strong><span>The Info Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-healthEndpoint"><a href="#healthEndpoint"><strong>15.2.3</strong><span>The Health Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-metricsEndpoint"><a href="#metricsEndpoint"><strong>15.2.4</strong><span>The Metrics Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-refreshEndpoint"><a href="#refreshEndpoint"><strong>15.2.5</strong><span>The Refresh Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-routesEndpoint"><a href="#routesEndpoint"><strong>15.2.6</strong><span>The Routes Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-loggersEndpoint"><a href="#loggersEndpoint"><strong>15.2.7</strong><span>The Loggers Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-cachesEndpoint"><a href="#cachesEndpoint"><strong>15.2.8</strong><span>The Caches Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-stopEndpoint"><a href="#stopEndpoint"><strong>15.2.9</strong><span>The Server Stop Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-environmentEndpoint"><a href="#environmentEndpoint"><strong>15.2.10</strong><span>The Environment Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-threadDumpEndpoint"><a href="#threadDumpEndpoint"><strong>15.2.11</strong><span>The ThreadDump Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-security"><a href="#security"><strong>16</strong><span>Security</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-multitenancy"><a href="#multitenancy"><strong>17</strong><span>Multi-Tenancy</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-cli"><a href="#cli"><strong>18</strong><span>Micronaut CLI</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-createProject"><a href="#createProject"><strong>18.1</strong><span>Creating a Project</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-comparingVersions"><a href="#comparingVersions"><strong>18.1.1</strong><span>Comparing Versions</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-features"><a href="#features"><strong>18.2</strong><span>Features</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-commands"><a href="#commands"><strong>18.3</strong><span>Commands</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-reloading"><a href="#reloading"><strong>18.4</strong><span>Reloading</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-automaticRestart"><a href="#automaticRestart"><strong>18.4.1</strong><span>Automatic Restart</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jrebel"><a href="#jrebel"><strong>18.4.2</strong><span>JRebel</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-gradleReload"><a href="#gradleReload"><strong>18.4.3</strong><span>Recompiling with Gradle</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-ideReload"><a href="#ideReload"><strong>18.4.4</strong><span>Recompiling with an IDE</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-proxy"><a href="#proxy"><strong>18.5</strong><span>Proxy Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-i18n"><a href="#i18n"><strong>19</strong><span>Internationalization</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-bundle"><a href="#bundle"><strong>19.1</strong><span>Resource Bundles</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-localizedMessageSource"><a href="#localizedMessageSource"><strong>19.2</strong><span>Localized Message Source</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-appendix"><a href="#appendix"><strong>20</strong><span>Appendices</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-architecture"><a href="#architecture"><strong>20.1</strong><span>Micronaut Architecture</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-compilerArch"><a href="#compilerArch"><strong>20.1.1</strong><span>Compiler</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-annotationArch"><a href="#annotationArch"><strong>20.1.2</strong><span>Annotation Metadata</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-introspectionArch"><a href="#introspectionArch"><strong>20.1.3</strong><span>Bean Introspections</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-iocArch"><a href="#iocArch"><strong>20.1.4</strong><span>Bean Definitions</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-aopArch"><a href="#aopArch"><strong>20.1.5</strong><span>AOP Proxies</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-containerArch"><a href="#containerArch"><strong>20.1.6</strong><span>Application Context</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-httpServerArch"><a href="#httpServerArch"><strong>20.1.7</strong><span>HTTP Server</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-faq"><a href="#faq"><strong>20.2</strong><span>Frequently Asked Questions (FAQ)</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-usingsnapshots"><a href="#usingsnapshots"><strong>20.3</strong><span>Using Snapshots</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-problems"><a href="#problems"><strong>20.4</strong><span>Common Problems</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-breaks"><a href="#breaks"><strong>20.5</strong><span>Breaking Changes</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut</h1>
        <p></p>
        <p>Natively Cloud Native</p>
        <p><strong>Version:</strong> <select style='max-width: 200px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option value='https://docs.micronaut.io/snapshot/guide/index.html'>SNAPSHOT</option><option value='https://docs.micronaut.io/latest/guide/index.html'>LATEST</option><option value='https://docs.micronaut.io/4.1.10/guide/index.html'>4.1.10</option><option value='https://docs.micronaut.io/4.1.9/guide/index.html'>4.1.9</option><option value='https://docs.micronaut.io/4.1.8/guide/index.html'>4.1.8</option><option value='https://docs.micronaut.io/4.1.7/guide/index.html'>4.1.7</option><option value='https://docs.micronaut.io/4.1.6/guide/index.html'>4.1.6</option><option value='https://docs.micronaut.io/4.1.5/guide/index.html'>4.1.5</option><option value='https://docs.micronaut.io/4.1.4/guide/index.html'>4.1.4</option><option value='https://docs.micronaut.io/4.1.3/guide/index.html'>4.1.3</option><option value='https://docs.micronaut.io/4.1.2/guide/index.html'>4.1.2</option><option value='https://docs.micronaut.io/4.1.1/guide/index.html'>4.1.1</option><option value='https://docs.micronaut.io/4.1.0/guide/index.html'>4.1.0</option><option value='https://docs.micronaut.io/4.0.6/guide/index.html'>4.0.6</option><option value='https://docs.micronaut.io/4.0.5/guide/index.html'>4.0.5</option><option value='https://docs.micronaut.io/4.0.4/guide/index.html'>4.0.4</option><option value='https://docs.micronaut.io/4.0.3/guide/index.html'>4.0.3</option><option value='https://docs.micronaut.io/4.0.2/guide/index.html'>4.0.2</option><option value='https://docs.micronaut.io/4.0.1/guide/index.html'>4.0.1</option><option value='https://docs.micronaut.io/4.0.0/guide/index.html'>4.0.0</option><option value='https://docs.micronaut.io/4.0.0-RC5/guide/index.html'>4.0.0-RC5</option><option value='https://docs.micronaut.io/4.0.0-RC4/guide/index.html'>4.0.0-RC4</option><option value='https://docs.micronaut.io/4.0.0-RC3/guide/index.html'>4.0.0-RC3</option><option value='https://docs.micronaut.io/4.0.0-RC2/guide/index.html'>4.0.0-RC2</option><option value='https://docs.micronaut.io/4.0.0-RC1/guide/index.html'>4.0.0-RC1</option><option value='https://docs.micronaut.io/4.0.0-M7/guide/index.html'>4.0.0-M7</option><option value='https://docs.micronaut.io/4.0.0-M6/guide/index.html'>4.0.0-M6</option><option value='https://docs.micronaut.io/4.0.0-M5/guide/index.html'>4.0.0-M5</option><option value='https://docs.micronaut.io/4.0.0-M4/guide/index.html'>4.0.0-M4</option><option value='https://docs.micronaut.io/4.0.0-M3/guide/index.html'>4.0.0-M3</option><option value='https://docs.micronaut.io/4.0.0-M2/guide/index.html'>4.0.0-M2</option><option value='https://docs.micronaut.io/4.0.0-M1/guide/index.html'>4.0.0-M1</option></select> </p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is a modern, JVM-based, full stack Java framework designed for building modular, easily testable JVM applications with support for Java, Kotlin, and Groovy.</p>
</div>
<div class="paragraph">
<p>Micronaut is developed by the creators of the Grails framework and takes inspiration from lessons learnt over the years building real-world applications from monoliths to microservices using Spring, Spring Boot and Grails.</p>
</div>
<div class="paragraph">
<p>Micronaut aims to provide all the tools necessary to build JVM applications including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency Injection and Inversion of Control (IoC)</p>
</li>
<li>
<p>Aspect Oriented Programming (AOP)</p>
</li>
<li>
<p>Sensible Defaults and Auto-Configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With Micronaut you can build Message-Driven Applications, Command Line Applications, HTTP Servers and more whilst for Microservices in particular Micronaut also provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed Configuration</p>
</li>
<li>
<p>Service Discovery</p>
</li>
<li>
<p>HTTP Routing</p>
</li>
<li>
<p>Client-Side Load Balancing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the same time Micronaut aims to avoid the downsides of frameworks like Spring, Spring Boot and Grails by providing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast startup time</p>
</li>
<li>
<p>Reduced memory footprint</p>
</li>
<li>
<p>Minimal use of reflection</p>
</li>
<li>
<p>Minimal use of proxies</p>
</li>
<li>
<p>No runtime bytecode generation</p>
</li>
<li>
<p>Easy Unit Testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Historically, frameworks such as Spring and Grails were not designed to run in scenarios such as serverless functions, Android apps, or low memory footprint microservices. In contrast, Micronaut is designed to be suitable for all of these scenarios.</p>
</div>
<div class="paragraph">
<p>This goal is achieved through the use of Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/Processor.html">annotation processors</a>, which are usable on any JVM language that supports them, as well as an HTTP Server and Client built on <a href="https://netty.io/">Netty</a>. To provide a similar programming model to Spring and Grails, these annotation processors precompile the necessary metadata to perform DI, define AOP proxies and configure your application to run in a low-memory environment.</p>
</div>
<div class="paragraph">
<p>Many APIs in Micronaut are heavily inspired by Spring and Grails. This is by design, and helps bring developers up to speed quickly.</p>
</div>

<h2 id="whatsNew"><a class="anchor" href="#whatsNew"></a>1.1 What's New?</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/introduction/whatsNew.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>==</p>
</div>
<div class="sect1">
<h2 id="_3_9_0">3.9.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_deprecations">Deprecations</h3>
<div class="paragraph">
<p><code>ConversionService.SHARED</code> is deprecated,  and it will be removed in a future version of the Micronaut Framework. Use an injected <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> bean instead, and register new type converters by declaring beans of type <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_8_0">3.8.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Key features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.graalvm.org/release-notes/22_3/">GraalVM 22.3 Support</a></p>
</li>
<li>
<p>With Micronaut <code>3.8.0</code>, you can use <code>@RequestBean</code> annotations with <a href="https://docs.oracle.com/en/java/javase/14/language/records.html">Records</a>. Before <code>3.8.0</code>, you could use a POJO as a controller method parameter and annotate the parameter with <code>@RequestBean</code> to bind any Bindable value (e.g., <code>HttpRequest</code>, <code>@PathVariable</code>, <code>@QueryValue</code> or <code>@Header</code> fields).</p>
</li>
<li>
<p>If you enable CORS from any origin while running your app in localhost (e.g., test or development), since <code>3.8.0</code>, the <code>CorsFilter</code> returns 403 for non-localhost origins to protect you against drive-by localhost attacks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please read the <a href="https://micronaut.io/2022/12/27/micronaut-framework-3-8-0-released/">Micronaut Framework 3.8.0 announcement blog post</a>. You will find a detailed overview of what’s new in Micronaut 3.8.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_7_0">3.7.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want complete control of where your application loads configuration from, for example, due to security restrictions, you can disable the default <a href="#propertySource"><code>PropertySourceLoader</code></a> implementations by calling <code>ApplicationContextBuilder::enableDefaultPropertySources(false)</code> when starting your application.</p>
</li>
<li>
<p>Better <code>java.time</code> conversion for YAML configuration</p>
</li>
<li>
<p>Client SSL inner configuration is <a href="https://docs.micronaut.io/latest/guide/#bootstrap">Bootstrap</a> context compatible.</p>
</li>
<li>
<p><a href="../api/io/micronaut/http/uri/UriBuilder.html">UriBuilder</a> methods <code>queryParam</code> and <code>replaceQueryParam</code> ignore null values.</p>
</li>
<li>
<p>It is possible to stop the Netty server without stopping the Application context.</p>
</li>
<li>
<p>You can declare beans at runtime using interfaces.</p>
</li>
<li>
<p>You can mark static methods as <code>@Executable</code>.</p>
</li>
<li>
<p>A big HTTP client refactor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Spring integration improvements</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-spring/latest/guide/">Micronaut Spring</a> contains improvements for developers who want to use Micronaut modules with a Spring application or consume Spring libraries from a Micronaut application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>New modules</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-object-storage/latest/guide/">Object Storage</a>.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-crac/latest/guide/">Micronaut CRaC</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please read the <a href="https://micronaut.io/2022/09/21/micronaut-framework-3-7-0-released/">Micronaut Framework 3.7.0 announcement blog post</a>. You will find a detailed overview of what’s new in Micronaut 3.7.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_6_0">3.6.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Key features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-test-resources/latest/guide/#introduction">Test Resources</a></p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#hibernate-reactive">Hibernate Reactive</a></p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/guide/#opentelemetry">OpenTelemetry</a></p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-azure/latest/guide/#azureKeyVault">Azure Vault</a></p>
</li>
<li>
<p><a href="https://www.graalvm.org/release-notes/22_2/">GraalVM 22.2 Support</a></p>
</li>
<li>
<p><a href="https://nubesgen.com/">NubesGen integration</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please read the <a href="https://micronaut.io/2022/08/04/micronaut-framework-3-6-0-released/">Micronaut Framework 3.6.0 announcement blog post</a>. You will find a detailed overview of what’s new in Micronaut 3.6.0.</p>
</div>
<div class="paragraph">
<p>Micronaut Core features:</p>
</div>
<div class="sect2">
<h3 id="_dont_apply_a_filter_for_services">Don&#8217;t apply a @Filter for services</h3>
<div class="paragraph">
<p>It is possible to exclude services from an HTTP Client Filter with the member <code>excludeServiceId</code> of <code>@Filter.</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Filter(patterns = '/**', excludeServiceId = 'authClient')
public class AppHttpClientFilter implements HttpClientFilter {</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_netty_runtime">Netty runtime</h3>
<div class="paragraph">
<p>This version upgrades <a href="https://netty.io">Netty</a> from 4.1.77 to 4.1.79. Moreover, it contains improvements to the API to <a href="#nettyClientPipeline">configure the Netty Client Pipeline</a> and to <a href="#nettyServerPipeline">configure the Netty Server Pipeline</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_improvements_to_httpclientexception">Improvements to HttpClientException</h3>
<div class="paragraph">
<p>If present a <code>serviceId</code> field is populated in the <code>HttpClientException</code> and shown in the exception message.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modules_upgrades">Modules Upgrades</h3>
<div class="ulist">
<ul>
<li>
<p>Micronaut AWS 3.5.3 to 3.7.0</p>
</li>
<li>
<p>Micronaut Azure 3.2.3 to 3.3.0</p>
</li>
<li>
<p>Micronaut Cache 3.4.1 to 3.5.0</p>
</li>
<li>
<p>Micronaut Cassandra 4.0.0 to 5.1.1</p>
</li>
<li>
<p>Micronaut Coherence 3.4.1 to 3.5.1</p>
</li>
<li>
<p>Micronaut Data 3.4.3 to 3.7.2</p>
</li>
<li>
<p>Micronaut Elasticsearch 4.2.0 to 4.3.0</p>
</li>
<li>
<p>Micronaut Email 1.2.3 to 1.3.1</p>
</li>
<li>
<p>Micronaut Flyway 5.3.0 to 5.4.0</p>
</li>
<li>
<p>Micronaut GCP 4.2.1 to 4.4.0</p>
</li>
<li>
<p>Micronaut GraphQL 3.0.0 to 3.1.0</p>
</li>
<li>
<p>Micronaut Groovy 3.1.0 to 3.2.0</p>
</li>
<li>
<p>Micronaut JaxRS 3.3.0 to 3.4.0</p>
</li>
<li>
<p>Micronaut JMX 3.0.0 to 3.1.0</p>
</li>
<li>
<p>Micronaut Kafka 4.3.1 to 4.4.0</p>
</li>
<li>
<p>Micronaut Micrometer 4.3.0 to 4.4.0</p>
</li>
<li>
<p>Micronaut Microstream 1.0.0-M1 to 1.0.0</p>
</li>
<li>
<p>Micronaut Liquibase 5.3.0 to 5.4.1</p>
</li>
<li>
<p>Micronaut Mongo 4.2.0 to 4.4.0</p>
</li>
<li>
<p>Micronaut Neo4J 5.0.0 to 5.1.0</p>
</li>
<li>
<p>Micronaut Nats 3.0.0 to 3.1.0</p>
</li>
<li>
<p>Micronaut OpenAPI 4.2.2 to 4.4.3</p>
</li>
<li>
<p>Micronaut Picocli 4.2.1 to 4.3.0</p>
</li>
<li>
<p>Micronaut Problem 2.3.1 to 2.4.0</p>
</li>
<li>
<p>Micronaut RabbitMQ 3.1.0 to 3.3.0</p>
</li>
<li>
<p>Micronaut R2DBC 3.0.0 to 3.0.1</p>
</li>
<li>
<p>Micronaut Reactor 2.2.3 to 2.3.1</p>
</li>
<li>
<p>Micronaut Redis 5.2.0 to 5.3.0</p>
</li>
<li>
<p>Micronaut RxJava3 2.2.1 to 2.3.0</p>
</li>
<li>
<p>Micronaut Serialization 1.1.1 to 1.3.0</p>
</li>
<li>
<p>Micronaut Servlet 3.2.3 to 3.3.0</p>
</li>
<li>
<p>Micronaut Spring 4.1.1 to 4.2.1</p>
</li>
<li>
<p>Micronaut SQL 4.4.1 to 4.6.3</p>
</li>
<li>
<p>Micronaut Test 3.3.1 to 3.4.0</p>
</li>
<li>
<p>Micronaut TOML 1.0.0 to 1.1.1</p>
</li>
<li>
<p>Micronaut Tracing 4.1.1 to 4.2.1</p>
</li>
<li>
<p>Micronaut Views 3.4.0 to 3.5.0</p>
</li>
<li>
<p>Micronaut Jackson XML 3.0.1 to 3.1.0</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_5_0">3.5.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_graalvm_22_1_0">GraalVM 22.1.0</h3>
<div class="paragraph">
<p>Micronaut framework 3.5 supports <a href="https://www.graalvm.org/release-notes/22_1/">GraalVM 22.1.0</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-gradle-plugin/latest/">Micronaut Gradle Plugin v3.4.0</a> and <a href="https://github.com/micronaut-projects/micronaut-maven-plugin/releases/tag/v3.3.0">Micronaut Maven Plugin v3.3.0</a> support GraalVM 22.1.0.</p>
</div>
</div>
<div class="sect2">
<h3 id="_incremental_compilation_for_gradle_builds">Incremental Compilation for Gradle Builds</h3>
<div class="paragraph">
<p>Micronaut framework 3.5 supports fully incremental compilation, including GraalVM metadata for Gradle Builds.</p>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_data">Micronaut Data</h3>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-data/releases/tag/v3.4.0">Micronaut Data 3.4.0</a> supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Postgres enums for JDBC.</p>
</li>
<li>
<p>Pagination for reactive repositories and specifications.</p>
</li>
<li>
<p>Pagination for async, coroutines repositories, and specifications.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_turbo_integration">Turbo Integration</h3>
<div class="paragraph">
<p>Micronaut Views adds <a href="https://micronaut-projects.github.io/micronaut-views/latest/guide/#turbo">integration with Turbo</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_new_module_micronaut_microstream">New Module - Micronaut Microstream</h3>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-microstream/latest/guide/">Micronaut Microstream</a> eases working with <a href="https://microstream.one">MicroStream</a>, a native Java object graph storage engine.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduled_with_time_zones">@Scheduled with Time Zones</h3>
<div class="paragraph">
<p>Optionally, you can specify a time zone when using the <a href="#scheduling"><code>@Scheduled</code> annotation</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Scheduled(cron = '1/33 0/1 * 1/1 * ?', zoneId = "America/Chicago")
void runCron() {
...
..</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_support_validation_groups_with_validated">Support validation groups with <code>@Validated</code></h3>
<div class="paragraph">
<p>You can enforce a subset of constraints using <a href="#validationGroups">validation groups</a> using groups on the <code>@Validated</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_listener_configuration">Advanced Listener Configuration</h3>
<div class="paragraph">
<p>Micronaut framework 3.5.0 offers more flexibility in configuring the HTTP Server. Instead of configuring a single port, you
<a href="#listener">can specify each listener manually</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ephemeral_factories">EPHEMERAL FACTORIES</h3>
<div class="paragraph">
<p>A <a href="#factories">Factory</a> has the default scope <code>@Singleton</code>, and it is destroyed with the context. Since Micronaut framework v3.5.0, you can dispose of the factory after producing a bean by annotating your factory class with <code>@Prototype</code> and <code>@Factory</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_module_upgrades">Module upgrades</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-test/releases/tag/v3.2.0">Micronaut Test 3.2.0</a> adds support for KoTest 5.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-aws/releases/tag/v3.5.0">Micronaut AWS 3.5.0</a> adds a new module <a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#cdk">Micronaut AWS CDK</a>. It also upgrades to the latest versions of the AWS SDKs.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-micrometer/releases/tag/v4.3.0">Micronaut Micrometer 4.3.0</a> updates to Micrometer 1.9.0.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-gcp/releases/tag/v4.2.0">Micronaut GCP 4.2.0</a> updates to <code>grpc-auth</code>
1.45.1 and <code>grpc-netty-shaded</code>. Moreover, we have clarified the documentation to support GraalVM Native Images when using the GCP libraries, and the Micronaut GCP Bom now includes the <code>com.google.cloud:native-image-support</code> dependency.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-aot/releases/tag/v1.1.0">Micronaut AOT 1.1.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-sql/releases/tag/v4.4.0">Micronaut SQL to 4.4.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-problem-json/releases/tag/v2.3.0">Micronaut Problem JSON to 2.3.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-grpc/releases/tag/v3.3.0">Micronaut GRPC to 3.3.0</a> allows exposing a gRPC Health Check for a grpc-server.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-serialization/releases/tag/v1.1.0">Micronaut Serialization to 1.1.0</a>. It allows the serialization and deserialization of object arrays.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-openapi/releases/tag/v4.1.0">Micronaut OpenAPI to 4.1.0</a> updates to Swagger 2.2.0.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-r2dbc/releases/tag/v3.0.0">Micronaut R2DBC to 3.0.0</a> updates to R2DBC <code>1.0.0.RELEASE</code>.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-security/releases/tag/v3.6.0">Micronaut Security to 3.6.0</a>.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-cache/releases/tag/v3.4.1">Micronaut Cache to 3.4.1</a>.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-coherence/releases/tag/v3.4.1">Micronaut Coherence to 3.4.1</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Several modules publish a BOM (Bill of Materials) or use a  Gradle Version Catalogs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-jaxrs/releases/tag/v3.3.0">Micronaut JAX-RS to 3.3.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-picocli/releases/tag/v4.2.1">Micronaut Picocli to 4.2.1</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-acme/releases/tag/v3.2.0">Micronaut ACME to 3.2.0</a>.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-mongodb/releases/tag/v4.2.0">Micronaut MongoDB to 4.2.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-mqtt/releases/tag/v2.2.0">Micronaut MQTT to 2.2.0</a>.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-kafka/releases/tag/v4.3.0">Micronaut Kafka to 4.3.0</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_schema_migration_modules">Schema Migration Modules</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-flyway/releases/tag/v5.3.0">Micronaut Flyway 5.3.0</a> updates Flyway to 8.5.8.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-liquibase/releases/tag/v5.3.0">Micronaut Liquibase 5.3.0</a> updates Liquibase to 4.9.1</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_4_0">3.4.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_localized_message_source">Localized Message Source</h3>
<div class="paragraph">
<p>You can now inject <a href="#localizedMessageSource"><code>LocalizedMessageSource</code></a>, a <code>@RequestScope</code> bean, in your controllers to resolve localized messages for the current HTTP Request. It works in combination with <a href="#localeResolution">Micronaut Locale Resolution</a> capabilities.</p>
</div>
</div>
<div class="sect2">
<h3 id="_referencing_bean_properties_in_requires">Referencing bean properties in @Requires.</h3>
<div class="paragraph">
<p>With 3.4.0, you can <a href="https://docs.micronaut.io/latest/guide/#_referencing_bean_properties_in_requires">reference other beans properties in <code>@Requires</code> to load beans conditionally</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(bean=Config.class, beanProperty="foo", value="John")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_data_mongodb">Micronaut Data MongoDB</h3>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-data/releases/tag/v3.3.0">Micronaut Data 3.3.0</a> includes <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/index.html#mongo">Micronaut Data MongoDB</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_aot_and_maven">Micronaut AOT and Maven</h3>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-aot/latest/guide/">Micronaut AOT</a> is now fully supported for Maven users. Enabling AOT is as simply as passing <code>-Dmicronaut.aot.enabled</code> when running, testing, or packaging your application.</p>
</div>
<div class="paragraph">
<p>For more details, check the <a href="https://micronaut-projects.github.io/micronaut-maven-plugin/latest/examples/aot.html">Micronaut Maven Plugin documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_toml">Micronaut TOML</h3>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-toml/latest/guide/">Micronaut TOML</a> allows you to write your application configuration with <a href="https://toml.io/en/">TOML</a> in addition to <code>Properties</code>, <code>YAML</code>, <code>Groovy</code> or <code>Config4k</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_security">Micronaut Security</h3>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-security/releases/tag/v3.4.0">Micronaut Security 3.4.1</a> responds with an error when an authenticated user visits a sensitive endpoint. This forces the developer to define how they want their application to behave in that scenario. Read the <a href="https://github.com/micronaut-projects/micronaut-security/releases/tag/v3.4.0">release notes</a> and the <a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/#builtInEndpointsAccess">documentation</a> to learn more.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bom_modules">BOM Modules</h3>
<div class="paragraph">
<p>Several projects include a BOM (Bills of Materials) module:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-azure/releases/tag/v3.1.0">Micronaut Azure 3.1.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-gcp/releases/tag/v4.1.0">Micronaut GCP 4.1.0</a>. It includes updates to the latest versions of Google Cloud dependencies.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-kotlin/releases/tag/v3.2.0">Micronaut Kotlin 3.2.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-mongodb/releases/tag/v4.1.0">Micronaut MongoDB 4.1.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-mqtt/releases/tag/v2.1.0">Micronaut MQTT 2.1.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-reactor/releases/tag/v2.2.1">Micronaut Reactor 2.2.1</a>. It includes updates to the Project Reactor dependencies.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-redis/releases/tag/v5.2.0">Micronaut Redis 5.2.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-rxjava2/releases/tag/v1.2.0">Micronaut RxJava2 1.2.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-rxjava3/releases/tag/v2.2.0">Micronaut RxJava3 2.2.0</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-security/releases/tag/v3.4.0">Micronaut Security 3.4.1</a></p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-servlet/releases/tag/v3.2.0">Micronaut Servlet 3.2.0</a>. It includes updates to Tomcat and Undertow dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_other_module_upgrades">Other Module Upgrades</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-aws/releases/tag/v3.2.0">Micronaut AWS 3.2.0</a> updates to the latest version of AWS SDK, ASK SDK and AWS Serverless Java Container.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-email/releases/tag/v1.1.0">Micronaut Email 1.1.0</a> updates to the Sendgrid 4.8.3 and contains improvements for <code>javamail</code> module users.</p>
</li>
<li>
<p><a href="https://github.com/micronaut-projects/micronaut-test/releases/tag/v3.1.0">Micronaut Test 3.1.0</a> updates the underlying testing dependencies.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_3_0">3.3.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_graalvm_22_0_0_2">GraalVM 22.0.0.2</h3>
<div class="paragraph">
<p>Micronaut now supports the latest GraalVM 22.0.0.2 release.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_endpoint">Environment Endpoint</h3>
<div class="paragraph">
<p>A new API <a href="../api/io/micronaut/management/endpoint/env/EnvironmentEndpointFilter.html">EnvironmentEndpointFilter</a> has been created to allow applications to customize which keys should have their values masked and which keys should not have their values masked. See the <a href="#environmentEndpoint">documentation</a> for full details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_aop_interceptor_binding">AOP Interceptor Binding</h3>
<div class="paragraph">
<p>When binding an AOP annotation to an interceptor, only the presence of the annotation is used to determine if the interceptor should be applied. Now it&#8217;s possible to also bind based on the values of the annotation. To enable this feature, set the <code>bindMembers</code> member of the <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> annotation to <code>true</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_netty_buffer_allocation">Netty Buffer Allocation</h3>
<div class="paragraph">
<p>It is now possible to configure the default Netty buffer allocator. See the <a href="https://docs.micronaut.io/3.3.x/guide/configurationreference.html#io.micronaut.buffer.netty.DefaultByteBufAllocatorConfiguration">configuration reference</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_improved_flexibility_in_class_style">Improved Flexibility in Class Style</h3>
<div class="paragraph">
<p>Many features of the Micronaut framework rely on the convention of getters and setters. Due to things like records and builders, the method names we look for are now configurable with the <a href="../api/io/micronaut/core/annotation/AccessorsStyle.html">@AccessorsStyle</a> annotation. For example, the annotation can be placed on <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans to allow for binding configuration to methods that do not begin with <code>set</code>. It can also be used with classes annotated with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_access_log_exclusions">Access Log Exclusions</h3>
<div class="paragraph">
<p>The Netty access logger now supports excluding requests based on a set of regular expression patterns that match against the URI. See the <a href="#accessLogger">AccessLogger documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_serializationdeserialization_module">New Serialization/Deserialization Module</h3>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-serialization/1.0.x/guide/">Micronaut Serialization</a> is a new module created as an alternative to Jackson. It supports serializing and deserializing Java types (including Java 17 records) to and from JSON and other formats.</p>
</div>
<div class="paragraph">
<p>Users now have the choice of an alternative implementation that&#8217;s largely compatible with existing Jackson annotations but contains many benefits, including the elimination of reflection, compile-time validation, greater security because only explicit types are serializable, and reduction of native image build sizes, build times, and memory usage.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_email_module">New Email Module</h3>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-email/latest/guide/">Micronaut Email</a> is a new module to ease sending emails from a Micronaut application. It provides integration with transactional email providers such as Amazon Simple Email Service, Postmark, Mailjet or SendGrid.</p>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_aot">Micronaut AOT</h3>
<div class="paragraph">
<p>During this minor cycle, we released a milestone release of a new module Micronaut AOT. You can use Micronaut AOT and use the build-time optimizations provided by the module to achieve faster startup times via the Micronaut Gradle Plugin. Please, read more about it in the <a href="https://micronaut.io/2021/12/20/micronaut-aot-build-time-optimizations-for-micronaut-applications/">announcement blog post</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_micronaut_kubernetes_3_3_0">Micronaut Kubernetes 3.3.0</h3>
<div class="paragraph">
<p>Micronaut Kubernetes 3.3 adds support to easily create the Kubernetes Operator. The Kubernetes Operator is a known pattern used to extend the capabilities of Kubernetes by creating application specific controllers for both native and custom resources. See more on <a href="https://micronaut-projects.github.io/micronaut-kubernetes/latest/guide/#kubernetes-operator">Kubernetes Operator</a>.</p>
</div>
<div class="paragraph">
<p>The version of Micronaut Kubernetes 3.3.0 also adds new Kubernetes reactive client for RxJava3.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_module_upgrades_2">Other Module Upgrades</h3>
<div class="ulist">
<ul>
<li>
<p>Micronaut Cache 3.1.0</p>
</li>
<li>
<p>Micronaut Discovery Client 3.1.0</p>
</li>
<li>
<p>Micronaut Elasticsearch 4.2.0</p>
</li>
<li>
<p>Micronaut Flyway 5.1.1</p>
</li>
<li>
<p>Micronaut Kafka 4.1.1</p>
</li>
<li>
<p>Micronaut Kotlin 3.1.0</p>
</li>
<li>
<p>Micronaut Liquibase 5.1.1</p>
</li>
<li>
<p>Micronaut Openapi 4.0.0</p>
</li>
<li>
<p>Micronaut Picocli 4.1.0</p>
</li>
<li>
<p>Micronaut Problem 2.2.0</p>
</li>
<li>
<p>Micronaut Security 3.3.0</p>
</li>
<li>
<p>Micronaut Sql 4.1.1</p>
</li>
<li>
<p>Micronaut Toml 1.0.0-M2</p>
</li>
<li>
<p>Micronaut Views 3.1.2</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_other_dependency_upgrades">Other Dependency Upgrades</h3>
<div class="ulist">
<ul>
<li>
<p>Apache Commons DBCP 2.9.0</p>
</li>
<li>
<p>Elasticsearch 7.16.3</p>
</li>
<li>
<p>Flyway 8.4.2</p>
</li>
<li>
<p>Hibernate 5.5.9.Final</p>
</li>
<li>
<p>Kotlin 1.6.10</p>
</li>
<li>
<p>Liquibase 4.7.1</p>
</li>
<li>
<p>Logback 1.2.10</p>
</li>
<li>
<p>Swagger 2.1.12</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_2_0">3.2.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_graalvm_21_3_0">GraalVM 21.3.0</h3>
<div class="paragraph">
<p>Micronaut has been updated to support the latest GraalVM 21.3.0 release. Please keep in mind that starting with 21.3.0 GraalVM doesn&#8217;t release a version based on JDK 8. If you still use Java 8 use the GraalVM JDK 11 distribution.</p>
</div>
<div class="paragraph">
<p>The official GraalVM Maven plugin has new GAV coordinates so if you have declared it in your <code>pom.xml</code> update the coordinates to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.graalvm.buildtools&lt;/groupId&gt;
    &lt;artifactId&gt;native-maven-plugin&lt;/artifactId&gt;
...
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please check <a href="https://graalvm.github.io/native-build-tools/0.9.7.1/maven-plugin.html">the official documentation</a> about how to customize the plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gradle_plugin_3_0_0">Gradle Plugin 3.0.0</h3>
<div class="paragraph">
<p>A new major version of the Gradle plugin has been released, including internal changes to use Gradle&#8217;s lazy configuration APIs.
In the process, <a href="https://micronaut-projects.github.io/micronaut-gradle-plugin/latest/">documentation</a> has been rewritten.</p>
</div>
<div class="paragraph">
<p>Support for GraalVM now delegates to <a href="https://graalvm.github.io/native-build-tools/0.9.7.1/gradle-plugin.html">the official GraalVM plugin</a>.
We recommend to upgrade in order to get the latest bugfixes, but this constitutes a breaking change for some users:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>nativeImage</code> task is now replaced with <code>nativeCompile</code></p>
</li>
<li>
<p>native image configuration happens in the <code>graalvmNative</code> DSL extension instead of the <code>nativeCompile</code> task</p>
</li>
<li>
<p>native image building makes use of Gradle&#8217;s toolchain support. Please refer to the <a href="https://micronaut-projects.github.io/micronaut-gradle-plugin/latest/">documentation</a> for help.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can still build existing applications or libraries using the 2.x version of the Gradle plugin. Documentation for this version can be found <a href="https://github.com/micronaut-projects/micronaut-gradle-plugin/blob/2.0.x/README.md">here</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_kotlin_1_6_0">Kotlin 1.6.0</h3>
<div class="paragraph">
<p>Micronaut 3.2.0 includes support for Kotlin 1.6.0.</p>
</div>
</div>
<div class="sect2">
<h3 id="_http_features">HTTP Features</h3>
<div class="sect3">
<h4 id="_websocket_ping_api">WebSocket Ping API</h4>
<div class="paragraph">
<p>WebSocket <a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a> methods can now accept a <a href="../api/io/micronaut/websocket/WebSocketPongMessage.html">WebSocketPongMessage</a> parameter that will receive a WebSocket pong sent as a response to a ping submitted using the new <code>sendPingAsync</code> method on <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_http2_server_push">HTTP2 Server Push</h4>
<div class="paragraph">
<p>It is now possible to send resources, e.g. stylesheets required by a HTML page, to the client alongside the request for the page using the HTTP2 server push protocol. See the <a href="#http2Server">HTTP/2 documentation</a> for information on how to use this feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jsonview_on_request_bodies">JsonView on request bodies</h4>
<div class="paragraph">
<p>You can now specify the Jackson <code>@JsonView</code> annotation on <code>@Body</code> parameters to controller methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="_websocket_wswss_protocol_support">WebSocket ws/wss protocol support</h4>
<div class="paragraph">
<p>The WebSocket clients now support the ws/wss protocol. To implement this change, the <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> <code>create</code> methods now take a <code>URI</code> instead of a <code>URL</code>. The <code>URL</code> methods have been deprecated.</p>
</div>
<div class="paragraph">
<p>Note: Should you be calling <code>WebSocketClient.create(null)</code>, the method call is now ambiguous. Insert a cast in that case: <code>WebSocketClient.create((URI) null)</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_handshake_timeout_configuration">SSL handshake timeout configuration</h4>
<div class="paragraph">
<p>The SSL handshake timeout can now be configured using the <code>micronaut.ssl.handshakeTimeout</code> and <code>micronaut.http.client.ssl.handshakeTimeout</code> configurations for the server and client respectively.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_upgrades_2">Module Upgrades</h3>
<div class="sect3">
<h4 id="_micronaut_data_3_2_0">Micronaut Data 3.2.0</h4>
<div class="ulist">
<ul>
<li>
<p>Repositories with JPA Criteria API specification for Micronaut JDBC/R2DBC</p>
</li>
<li>
<p>Expandable query parameters optimizations</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reactive_modules">Reactive Modules</h4>
<div class="ulist">
<ul>
<li>
<p>The RxJava2, RxJava3, and Reactor modules have been updated with the equivalent static <code>create</code> methods on their core counterparts.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_micrometer_4_1_0">Micronaut Micrometer 4.1.0</h4>
<div class="ulist">
<ul>
<li>
<p>Adds support for metrics with gRPC</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_security_3_2_0">Micronaut Security 3.2.0</h4>
<div class="ulist">
<ul>
<li>
<p>The way JSON Web Key Sets are being cached has been greatly improved for scenarios where there are multiple key sets.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_other_module_upgrades_3">Other Module Upgrades</h4>
<div class="ulist">
<ul>
<li>
<p>Elasticsearch 7.15.2</p>
</li>
<li>
<p>Flyway 8.0.2</p>
</li>
<li>
<p>gRPC 1.39.0</p>
</li>
<li>
<p>Liquibase 4.6.1</p>
</li>
<li>
<p>Micronaut Elasticsearch 4.0.0</p>
</li>
<li>
<p>Micronaut Flyway 5.0.0</p>
</li>
<li>
<p>Micronaut gRPC 3.1.1</p>
</li>
<li>
<p>Micronaut Liquibase 5.0.0</p>
</li>
<li>
<p>Micronaut OpenAPI 3.2.0</p>
</li>
<li>
<p>Micronaut Redis 5.1.0</p>
</li>
<li>
<p>Testcontainers 1.16.1</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_1_0">3.1.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_core_features">Core Features</h3>
<div class="sect3">
<h4 id="_primitive_beans">Primitive Beans</h4>
<div class="paragraph">
<p><a href="#factories">Factory Beans</a> can now create beans that are primitive types or primitive array types.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#factories">Primitive Beans and Arrays</a> in the documentation for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_repeatable_qualifiers">Repeatable Qualifiers</h4>
<div class="paragraph">
<p><a href="#qualifiers">Qualifiers</a> can now be repeatable (an annotation annotated with <code>java.lang.annotation.Repeatable</code>) allowing narrowing bean resolution by a complete or partial match of the qualifiers declared on the injection point.</p>
</div>
</div>
<div class="sect3">
<h4 id="_injectscope">InjectScope</h4>
<div class="paragraph">
<p>A new <a href="../api/io/micronaut/context/annotation/InjectScope.html">@InjectScope</a> annotation has been added which destroys any beans with no defined scope and injected into a method or constructor annotated with <code>@Inject</code> after the method or constructor completes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_build_time_optimizations">More Build Time Optimizations</h4>
<div class="paragraph">
<p>Further build time metadata optimizations have been added included reducing the number and size of the classes generated to support <a href="#introspection">Bean Introspection</a> and including knowledge of repeatable annotations in generated metadata avoiding further reflective calls and optimizing Micronaut&#8217;s memory usage, in particular with GraalVM.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improvements_to_context_propagation">Improvements to Context Propagation</h4>
<div class="paragraph">
<p>Support for <a href="#context">Reactive context propagation</a> has been further improved by inclusion of request context information in the <a href="https://projectreactor.io/docs/core/release/reference/#context">Reactor context</a> and <a href="#kotlinContextPropagation">documentation on how to effectively propagate the context across reactive flows</a> when using Kotlin coroutines.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improvements_to_the_element_api">Improvements to the Element API</h4>
<div class="paragraph">
<p>The build-time <a href="../api/io/micronaut/inject/ast/Element.html">Element</a> API has been improved in a number of ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New methods were added to the <a href="../api/io/micronaut/inject/ast/MethodElement.html">MethodElement</a> API to resolve the retriever type and throws declaration</p>
</li>
<li>
<p>A new experimental API has been added to the <a href="../api/io/micronaut/inject/ast/ClassElement.html">ClassElement</a> API  to resolve generic placeholders and resolve the generic bound to the element</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_features_2">HTTP Features</h3>
<div class="sect3">
<h4 id="_filter_by_regex">Filter By Regex</h4>
<div class="paragraph">
<p>HTTP filters now support matching URLs by a regular expression. Set the <code>patternStyle</code> member of the annotation to <code>REGEX</code> and the value will be treated as a regular expression.</p>
</div>
</div>
<div class="sect3">
<h4 id="_random_port_binding">Random Port Binding</h4>
<div class="paragraph">
<p>The way the server binds to random ports has improved and should result in fewer port binding exceptions in tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_client_data_formatting">Client Data Formatting</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/convert/format/Format.html">@Format</a> annotation now supports several new values that can be used in conjunction with the declarative HTTP client to support formatting data in several new ways. See the <a href="#clientParameters">client parameters</a> documentation for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_streamingfileupload">StreamingFileUpload</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a> API has been improved to support streaming directly to an output stream. As with the other <code>transferTo</code> methods, the write to the stream is offloaded to the IO pool automatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="_server_ssl_configuration">Server SSL Configuration</h4>
<div class="paragraph">
<p>The SSL configuration for the Netty server now responds to refresh events. This allows for swapping out certificates without having to restart the server. See the <a href="#https">https documentation</a> for information on how to trigger the refresh.</p>
</div>
</div>
<div class="sect3">
<h4 id="_new_netty_server_api">New Netty Server API</h4>
<div class="paragraph">
<p>If you wish to programmatically start additional Netty servers on different ports with potentially different configurations, new APIs have been added to do so including a new <a href="../api/io/micronaut/http/server/netty/NettyEmbeddedServerFactory.html">NettyEmbeddedServerFactory</a> interface.</p>
</div>
<div class="paragraph">
<p>See the documentation on <a href="#secondaryServers">Starting Secondary Servers</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deprecations_2">Deprecations</h3>
<div class="paragraph">
<p>The <code>netty.responses.file.*</code> configuration is deprecated in favor of <code>micronaut.server.netty.responses.file.*</code>. The old configuration key will be removed in the next major version of the framework.</p>
</div>
</div>
<div class="sect2">
<h3 id="_module_upgrades_3">Module Upgrades</h3>
<div class="sect3">
<h4 id="_micronaut_data_3_1_0">Micronaut Data 3.1.0</h4>
<div class="ulist">
<ul>
<li>
<p>Kotlin&#8217;s coroutines support. New repository interface <code>CoroutineCrudRepository</code>.</p>
</li>
<li>
<p>Support for <code>AttributeConverter</code></p>
</li>
<li>
<p>R2DBC upgraded to <code>Arabba-SR11</code></p>
</li>
<li>
<p>JPA Criteria specifications</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_jax_rs_3_1">Micronaut JAX-RS 3.1</h4>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-jaxrs/latest/guide/">JAX-RS module</a> now integrated with Micronaut Security allowing binding of the JAX-RS <code>SecurityContext</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_kubernetes_3_1_0">Micronaut Kubernetes 3.1.0</h4>
<div class="paragraph">
<p>Micronaut Kubernetes 3.1 introduces new annotation <a href="https://micronaut-projects.github.io/micronaut-kubernetes/latest/api/io/micronaut/kubernetes/client/informer/Informer.html">@Informer</a>. By using the annotation on the <a href="https://javadoc.io/doc/io.kubernetes/client-java/latest/io/kubernetes/client/informer/ResourceEventHandler.html">ResourceEventHandler</a> the Micronaut will instantiate the <a href="https://javadoc.io/doc/io.kubernetes/client-java/latest/io/kubernetes/client/informer/SharedIndexInformer.html">SharedInformer</a> from the official <a href="https://github.com/kubernetes-client/java">Kubernetes Java SDK</a>. Then you only need to take care of handling the changes of the watched Kubernetes resource. See more on <a href="https://micronaut-projects.github.io/micronaut-kubernetes/latest/guide/#kubernetes-informer">Kubernetes Informer</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_oracle_coherence_3_0_0">Micronaut Oracle Coherence 3.0.0</h4>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-coherence/latest/guide/">Micronaut Oracle Coherence</a> module is now out of preview status and includes broad integration with Oracle Coherence including support for caching, messaging and Micronaut Data.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_0_0">3.0.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_core_features_2">Core Features</h3>
<div class="sect3">
<h4 id="_optimized_build_time_metadata">Optimized Build-Time Metadata</h4>
<div class="paragraph">
<p>Micronaut 3.0 introduces a new build time metadata format that is more efficient in terms of startup and code size.</p>
</div>
<div class="paragraph">
<p>The result is significant improvements to startup and native image sizes when building native images with GraalVM Native Image.</p>
</div>
<div class="paragraph">
<p>It is recommended that users re-compile their applications and libraries with Micronaut 3.0 to benefit from these changes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_graalvm_21_2">Support for GraalVM 21.2</h4>
<div class="paragraph">
<p>Micronaut has been updated to support the latest GraalVM 21.2 release.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jakarta_inject">Jakarta Inject</h4>
<div class="paragraph">
<p>The <code>jakarta.inject</code> annotations are now the default injection annotations for Micronaut 3</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_jsr_330_bean_import">Support for JSR-330 Bean Import</h4>
<div class="paragraph">
<p>Using the <a href="../api/io/micronaut/context/annotation/Import.html">@Import</a> annotation it is now possible to import bean definitions into your application where JSR-330 (either <code>javax.inject</code> or <code>jakarta.inject</code> annotations) are used in an external library.</p>
</div>
<div class="paragraph">
<p>See the documentation on <a href="#beanImport">Bean Import</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_controlling_annotation_inheritance">Support for Controlling Annotation Inheritance</h4>
<div class="paragraph">
<p><a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> inheritance can now be controlled via Java&#8217;s <code>@Inherited</code> annotation. If an annotation is not explicitly annotated with <code>@Inherited</code> it will not be included in the metadata. See the <a href="#annotationMetadata">Annotation Inheritance</a> section of the documentation for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is an important behavioural change from Micronaut 2.x, see the <a href="#breaks">Breaking Changes</a> section for information on how to upgrade.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_support_narrowing_injection_by_generic_type_arguments">Support Narrowing Injection by Generic Type Arguments</h4>
<div class="paragraph">
<p>Micronaut can now resolve the correct bean to inject based on the generic type arguments specified on the injection point:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
public Vehicle(Engine&lt;V8&gt; engine) {
    this.engine = engine;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject
Vehicle(Engine&lt;V8&gt; engine) {
    this.engine = engine
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class Vehicle(val engine: Engine&lt;V8&gt;) {</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information see the section on <a href="#qualifiers">Qualifying by Generic Type Arguments</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_using_annotation_members_in_qualifiers">Support for using Annotation Members in Qualifiers</h4>
<div class="paragraph">
<p>You can now use annotation members in qualifiers and specify which members should be excluded with the new <a href="../api/io/micronaut/context/annotation/NonBinding.html">@NonBinding</a> annotation.</p>
</div>
<div class="paragraph">
<p>For more information see the section on <a href="#qualifiers">Qualifying By Annotation Members</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_limiting_the_injectable_types">Support for Limiting the Injectable Types</h4>
<div class="paragraph">
<p>You can now limit the exposed types of a bean using the <code>typed</code> member of the <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Bean(typed = Engine.class) // <b class="conum">(1)</b>
public class V8Engine implements Engine {  // <b class="conum">(2)</b>
    @Override
    public String start() {
        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return 8;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
@Bean(typed = Engine) // <b class="conum">(1)</b>
class V8Engine implements Engine {  // <b class="conum">(2)</b>
    @Override
    String start() { "Starting V8" }

    @Override
    int getCylinders() { 8 }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
@Bean(typed = [Engine::class]) // <b class="conum">(1)</b>
class V8Engine : Engine { // <b class="conum">(2)</b>
    override fun start(): String {
        return "Starting V8"
    }

    override val cylinders: Int = 8
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information see the section on <a href="#typed">Limiting Injectable Types</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_factories_can_produce_bean_from_fields">Factories can produce bean from fields</h4>
<div class="paragraph">
<p>Beans defined with the <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> annotation can now produce beans from public or package protected fields, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@MicronautTest
public class VehicleMockSpec {
    @Requires(beans = VehicleMockSpec.class)
    @Bean @Replaces(Engine.class)
    Engine mockEngine = () -&gt; "Mock Started"; // <b class="conum">(1)</b>

    @Inject Vehicle vehicle; // <b class="conum">(2)</b>

    @Test
    void testStartEngine() {
        final String result = vehicle.start();
        assertEquals("Mock Started", result); // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@MicronautTest
class VehicleMockSpec extends Specification {
    @Requires(beans=VehicleMockSpec.class)
    @Bean @Replaces(Engine.class)
    Engine mockEngine = {-&gt; "Mock Started" } as Engine  // <b class="conum">(1)</b>

    @Inject Vehicle vehicle // <b class="conum">(2)</b>

    void "test start engine"() {
        given:
        final String result = vehicle.start()

        expect:
        result == "Mock Started" // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@MicronautTest
class VehicleMockSpec {
    @get:Bean
    @get:Replaces(Engine::class)
    val mockEngine: Engine = object : Engine { // <b class="conum">(1)</b>
        override fun start(): String {
            return "Mock Started"
        }
    }

    @Inject
    lateinit var vehicle : Vehicle // <b class="conum">(2)</b>

    @Test
    fun testStartEngine() {
        val result = vehicle.start()
        Assertions.assertEquals("Mock Started", result) // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information see the <a href="#factories">Bean Factories</a> section of the documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_enhanced_beanprovider_interface">Enhanced <code>BeanProvider</code> Interface</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a> interface has been enhanced with new methods such as <code>iterator()</code> and <code>stream()</code> as well as methods to check for bean existence and uniqueness.</p>
</div>
</div>
<div class="sect3">
<h4 id="_new_any_qualifier_for_use_in_bean_factories">New <code>@Any</code> Qualifier for use in Bean Factories</h4>
<div class="paragraph">
<p>A new <a href="../api/io/micronaut/context/annotation/Any.html">@Any</a> qualifier has been introduced to allow injecting any available instance into an injection point and can be used in combination with the new <code>BeanProvider</code> interface mentioned above to allow more dynamic behaviour.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.BeanProvider;
import io.micronaut.context.annotation.Any;
import jakarta.inject.Singleton;

@Singleton
public class Vehicle {
    final BeanProvider&lt;Engine&gt; engineProvider;

    public Vehicle(@Any BeanProvider&lt;Engine&gt; engineProvider) { // <b class="conum">(1)</b>
        this.engineProvider = engineProvider;
    }
    void start() {
        engineProvider.ifPresent(Engine::start); // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.BeanProvider
import io.micronaut.context.annotation.Any
import jakarta.inject.Singleton

@Singleton
class Vehicle {
    final BeanProvider&lt;Engine&gt; engineProvider

    Vehicle(@Any BeanProvider&lt;Engine&gt; engineProvider) { // <b class="conum">(1)</b>
        this.engineProvider = engineProvider
    }
    void start() {
        engineProvider.ifPresent(Engine::start) // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.BeanProvider
import io.micronaut.context.annotation.Any
import jakarta.inject.Singleton

@Singleton
class Vehicle(@param:Any val engineProvider: BeanProvider&lt;Engine&gt;) { // <b class="conum">(1)</b>
    fun start() {
        engineProvider.ifPresent { it.start() } // <b class="conum">(2)</b>
    }
    fun startAll() {
        if (engineProvider.isPresent) { // <b class="conum">(1)</b>
            engineProvider.forEach { it.start() } // <b class="conum">(2)</b>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation can also be used on <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> methods to allow customization of how objects are injected via the <a href="../api/io/micronaut/inject/InjectionPoint.html">InjectionPoint</a> API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_fields_in_bean_introspections">Support for Fields in Bean Introspections</h4>
<div class="paragraph">
<p>Bean introspections on public or package protected fields are now supported:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected(accessKind = Introspected.AccessKind.FIELD)
public class User {
    public final String name; // <b class="conum">(1)</b>
    public int age = 18; // <b class="conum">(2)</b>

    public User(String name) {
        this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

@Introspected(accessKind = Introspected.AccessKind.FIELD)
class User {
    public final String name // <b class="conum">(1)</b>
    public int age = 18 // <b class="conum">(2)</b>

    User(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information see the "Bean Fields" section of the <a href="#introspection">Bean Introspections</a> documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_applicationeventpublisher_has_now_a_generic_event_type"><code>ApplicationEventPublisher</code> has now a generic event type</h4>
<div class="paragraph">
<p>For the performance reasons it&#8217;s advised to inject an instance of <code>ApplicationEventPublisher</code> with a generic type parameter - <code>ApplicationEventPublisher&lt;MyEvent&gt;</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aop_features">AOP Features</h3>
<div class="sect3">
<h4 id="_support_for_constructor_interception">Support for Constructor Interception</h4>
<div class="paragraph">
<p>It is now possible to intercept bean construction invocations through the <a href="../api/io/micronaut/aop/ConstructorInterceptor.html">ConstructorInterceptor</a> interface and <a href="../api/io/micronaut/aop/AroundConstruct.html">@AroundConstruct</a> annotation.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#lifecycleAdvice">Bean Life Cycle Advice</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_postconstruct_predestroy_interception">Support for <code>@PostConstruct</code> &amp; <code>@PreDestroy</code> Interception</h4>
<div class="paragraph">
<p>It is now possible to intercept <code>@PostConstruct</code> and <code>@PreDestroy</code> method invocations through the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface and <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> annotation.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#lifecycleAdvice">Bean Life Cycle Advice</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_random_configuration_values">Random Configuration Values</h4>
<div class="paragraph">
<p>It is now possible to set a max and a range for random numbers in configuration. For example to set an integer between 0 and 9, <code>${random.int(10)}</code> can be used as the configuration value. See the <a href="#propertySource">documentation</a> under "Using Random Properties" for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_project_reactor_used_internally_instead_of_rxjava2">Project Reactor used internally instead of RxJava2</h4>
<div class="paragraph">
<p>Micronaut 3 uses internally <a href="https://projectreactor.io">Project Reactor</a> instead <a href="https://github.com/ReactiveX/RxJava">RxJava 2</a>. Project Reactor allows
Micronaut 3 to simplify instrumentation, thanks to <a href="https://projectreactor.io/docs/core/release/api/reactor/util/context/Context.html">Reactor&#8217;s Context</a>,  simplifies conversion login and eases the integration with R2DBC drivers. We recommend users to migrate to Reactor. However, it is possible to continue to use RxJava. See <a href="#reactiveConfigs">Reactive Programming section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_upgrades_4">Module Upgrades</h3>
<div class="sect3">
<h4 id="_micronaut_data_3_1_0_2">Micronaut Data 3.1.0</h4>
<div class="ulist">
<ul>
<li>
<p>Kotlin&#8217;s coroutines support. New repository interface <code>CoroutineCrudRepository</code>.</p>
</li>
<li>
<p>Support for <code>AttributeConverter</code></p>
</li>
<li>
<p>R2DBC upgraded to <code>Arabba-SR11</code></p>
</li>
<li>
<p>JPA Criteria specifications</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_micrometer_4_0_0">Micronaut Micrometer 4.0.0</h4>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-micrometer/latest/guide/">Micrometer module</a> has been upgraded and now supports repeated definitions of the <a href="https://micrometer.io/?/docs/concepts#_the_timed_annotation">@Timed</a> annotation as well as also supporting the <code>@Counted</code> annotation for counters when you add the <code>micronaut-micrometer-annotation</code> dependency to your annotation processor classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_oracle_cloud_2_0_0">Micronaut Oracle Cloud 2.0.0</h4>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="https://micronaut-projects.github.io/micronaut-oracle-cloud/latest/guide/">Oracle Cloud Integration</a> has been updated with support for Cloud Monitoring and Tracing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_cassandra_4_0_0">Micronaut Cassandra 4.0.0</h4>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-cassandra/latest/guide/">Micronaut Cassandra</a> integration now includes support for GraalVM out of the box.</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_modules">Other Modules</h4>
<div class="ulist">
<ul>
<li>
<p>Micronaut Acme 3.0.0</p>
</li>
<li>
<p>Micronaut Aws 3.0.0</p>
</li>
<li>
<p>Micronaut Azure 3.0.0</p>
</li>
<li>
<p>Micronaut Cache 3.0.0</p>
</li>
<li>
<p>Micronaut Discovery Client 3.0.0</p>
</li>
<li>
<p>Micronaut ElasticSearch 3.0.0</p>
</li>
<li>
<p>Micronaut Flyway 4.1.0</p>
</li>
<li>
<p>Micronaut GCP 4.0.0</p>
</li>
<li>
<p>Micronaut GraphQL 3.0.0</p>
</li>
<li>
<p>Micronaut Groovy 3.0.0</p>
</li>
<li>
<p>Micronaut Grpc 3.0.0</p>
</li>
<li>
<p>Micronaut Jackson XML 3.0.0</p>
</li>
<li>
<p>Micronaut Jaxrs 3.0.0</p>
</li>
<li>
<p>Micronaut JMX 3.0.0</p>
</li>
<li>
<p>Micronaut Kafka 4.0.0</p>
</li>
<li>
<p>Micronaut Kotlin 3.0.0</p>
</li>
<li>
<p>Micronaut Kubernetes 3.0.0</p>
</li>
<li>
<p>Micronaut Liquibase 4.0.2</p>
</li>
<li>
<p>Micronaut Mongo 4.0.0</p>
</li>
<li>
<p>Micronaut MQTT 2.0.0</p>
</li>
<li>
<p>Micronaut Multitenancy 4.0.0</p>
</li>
<li>
<p>Micronaut Nats Io 3.0.0</p>
</li>
<li>
<p>Micronaut Neo4j 5.0.0</p>
</li>
<li>
<p>Micronaut OpenApi 3.0.1</p>
</li>
<li>
<p>Micronaut Picocli 4.0.0</p>
</li>
<li>
<p>Micronaut Problem Json 2.0.0</p>
</li>
<li>
<p>Micronaut R2DBC 2.0.0</p>
</li>
<li>
<p>Micronaut RabbitMQ 3.0.0</p>
</li>
<li>
<p>Micronaut Reactor 2.0.0</p>
</li>
<li>
<p>Micronaut Redis 5.0.0</p>
</li>
<li>
<p>Micronaut RSS 3.0.0</p>
</li>
<li>
<p>Micronaut RxJava2 1.0.0 (new)</p>
</li>
<li>
<p>Micronaut RxJava3 2.0.0</p>
</li>
<li>
<p>Micronaut Security 3.0.0</p>
</li>
<li>
<p>Micronaut Servlet 3.0.0</p>
</li>
<li>
<p>Micronaut Spring 4.0.0</p>
</li>
<li>
<p>Micronaut SQL 4.0.0</p>
</li>
<li>
<p>Micronaut Test 3.0.0</p>
</li>
<li>
<p>Micronaut Views 3.0.0</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_upgrades">Dependency Upgrades</h3>
<div class="ulist">
<ul>
<li>
<p>Caffeine 2.9.1</p>
</li>
<li>
<p>Cassandra 4.11.1</p>
</li>
<li>
<p>Elasticsearch 7.12.0</p>
</li>
<li>
<p>Flyway 7.12.1</p>
</li>
<li>
<p>GraalVM 21.2.0</p>
</li>
<li>
<p>H2 Database 1.4.200</p>
</li>
<li>
<p>Hazelcast 4.2.1</p>
</li>
<li>
<p>Hibernate 5.5.3.Final</p>
</li>
<li>
<p>Hikari 4.0.3</p>
</li>
<li>
<p>Infinispan 12.1.6.Final</p>
</li>
<li>
<p>Jackson 2.12.4</p>
</li>
<li>
<p>Jaeger 1.6.0</p>
</li>
<li>
<p>Jakarta Annotation API 2.0.0</p>
</li>
<li>
<p>JAsync 1.2.2</p>
</li>
<li>
<p>JDBI 3.20.1</p>
</li>
<li>
<p>JOOQ 3.14.12</p>
</li>
<li>
<p>JUnit 5.7.2</p>
</li>
<li>
<p>Kafka 2.8.0</p>
</li>
<li>
<p>Kotlin 1.5.21</p>
</li>
<li>
<p>Kotlin Coroutines 1.5.1</p>
</li>
<li>
<p>Ktor 1.6.1</p>
</li>
<li>
<p>Liquibase 4.4.3</p>
</li>
<li>
<p>MariaDB Driver 2.7.3</p>
</li>
<li>
<p>Micrometer 1.7.1</p>
</li>
<li>
<p>MongoDB 4.3.0</p>
</li>
<li>
<p>MS SQL Driver 9.2.1.jre8</p>
</li>
<li>
<p>MySQL Driver 8.0.25</p>
</li>
<li>
<p>Neo4j Driver 4.2.7</p>
</li>
<li>
<p>Postgres Driver 42.2.23</p>
</li>
<li>
<p>Reactor 3.4.8</p>
</li>
<li>
<p>RxJava3 3.0.13</p>
</li>
<li>
<p>SLF4J 1.7.29</p>
</li>
<li>
<p>Snake YAML 1.29</p>
</li>
<li>
<p>Spock 2.0-groovy-3.0</p>
</li>
<li>
<p>Spring 5.3.9</p>
</li>
<li>
<p>Spring Boot 2.5.3</p>
</li>
<li>
<p>Testcontainers 1.15.3</p>
</li>
<li>
<p>Tomcat JDBC 10.0.8</p>
</li>
<li>
<p>Vertx SQL Drivers 4.1.1</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<h2 id="upgrading"><a class="anchor" href="#upgrading"></a>1.2 Upgrading to Micronaut 3.x</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/introduction/upgrading.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This section covers the steps required to upgrade a Micronaut 2.x application to Micronaut 3.0.0.</p>
</div>
<div class="paragraph">
<p>The sections below go into more detail, but at a high level the process generally involves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>updating versions</p>
</li>
<li>
<p>updating annotations</p>
</li>
<li>
<p>choosing a Reactive implementation</p>
</li>
<li>
<p>adjusting code affected by breaking changes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typically, upgrading should be straightforward, but it&#8217;s possible to save yourself some work with <a href="https://docs.openrewrite.org/" target="_blank" rel="noopener">OpenRewrite</a>, an automated refactoring tool that you can use to make many of the required upgrade changes.</p>
</div>
<div class="sect2">
<h3 id="_automating_upgrades_with_openrewrite">Automating Upgrades with OpenRewrite</h3>
<div class="paragraph">
<p>OpenRewrite works with Micronaut applications written in Java, but OpenRewrite doesn&#8217;t currently support Kotlin or Groovy.
Like any automated tool it does much of the work for you, but be sure to review the resulting changes and manually make any changes that aren&#8217;t supported by OpenRewrite, for example converting from RxJava2 to Reactor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you will be using OpenRewrite, don&#8217;t make any upgrade changes yet that would cause your application not to compile, for example updating the Micronaut version to 3.x.
This would cause application classes that use <code>javax.inject</code> annotations like <code>@Singleton</code> or RxJava2 classes like <code>io.reactivex.Flowable</code> to not compile since those dependencies are no longer included by default.
Instead, use OpenRewrite to do the initial work and just do the steps yourself that aren&#8217;t possible or practical to automate.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Adding OpenRewrite support to your build is easy, it just requires adding the Gradle or Maven plugin and configuring the plugin to use the Micronaut upgrade recipe.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut.io/launch?features=openrewrite&amp;lang=JAVA&amp;build=GRADLE&amp;activity=diff" target="_blank" rel="noopener">Gradle feature diff</a> or the <a href="https://micronaut.io/launch?features=openrewrite&amp;lang=JAVA&amp;build=MAVEN&amp;activity=diff" target="_blank" rel="noopener">Maven feature diff</a> to see the required build script changes.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve made the build script changes, you can "dry-run" the Micronaut upgrade recipe to see what changes would be made.</p>
</div>
<div class="paragraph">
<p>For Gradle, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew rewriteDryRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>and view the diff report generated in <code>build/reports/rewrite/rewrite.patch</code></p>
</div>
<div class="paragraph">
<p>and for Maven, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw rewrite:dryRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>and view the diff report generated in <code>target/site/rewrite/rewrite.patch</code>.</p>
</div>
<div class="paragraph">
<p>Then you can run the recipe for real, letting OpenRewrite update your code.</p>
</div>
<div class="paragraph">
<p>For Gradle, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew rewriteRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>and for Maven, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw rewrite:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the changes have been made, you could remove the plugin, but it&#8217;s fine to leave it since OpenRewrite doesn&#8217;t run automatically, only when you run one of its commands.
And there are many more recipes available beyond the Micronaut upgrade recipe that you might want to include to automate other code changes.</p>
</div>
<div class="paragraph">
<p>The plugin includes another command to list all recipes currently in the classpath (in this case the core recipes plus those added by the <code>rewrite-micronaut</code> module).</p>
</div>
<div class="paragraph">
<p>For Gradle, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew rewriteDiscover</code></pre>
</div>
</div>
<div class="paragraph">
<p>and for Maven, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw rewrite:discover</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the available recipes and styles will be output to the console. Check out the <a href="https://docs.openrewrite.org/">OpenRewrite documentation</a> for more information and to see the many other available recipes available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_version_update">Version Update</h3>
<div class="paragraph">
<p>If you use Gradle, update the <code>micronautVersion</code> property in <code>gradle.properties</code>, e.g.</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronautVersion=3.9.7</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use Maven, update the parent POM version and <code>micronaut.version</code> property in <code>pom.xml</code>, e.g.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;parent&gt;
  &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
  &lt;artifactId&gt;micronaut-parent&lt;/artifactId&gt;
  &lt;version&gt;3.9.7&lt;/version&gt;
&lt;/parent&gt;

&lt;properties&gt;
  ...
  &lt;micronaut.version&gt;3.9.7&lt;/micronaut.version&gt;
  ...
&lt;/properties&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_plugin_update">Build Plugin Update</h3>
<div class="paragraph">
<p>If you use the <a href="https://micronaut-projects.github.io/micronaut-gradle-plugin/latest/">Micronaut Gradle plugin</a> update to the <a href="https://github.com/micronaut-projects/micronaut-gradle-plugin/releases/latest">latest version</a>.</p>
</div>
<div class="paragraph">
<p>For Maven users the plugin version is updated automatically when you update the Micronaut version.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inject_annotations">Inject Annotations</h3>
<div class="paragraph">
<p>The <code>javax.inject</code> annotations are no longer a transitive dependency. Micronaut now ships with the Jakarta inject annotations. Either replace all <code>javax.inject</code> imports with <code>jakarta.inject</code>, or add a dependency on <code>javax-inject</code> to continue using the older annotations:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"javax.inject:javax.inject:1")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;javax.inject&lt;/groupId&gt;
    &lt;artifactId&gt;javax.inject&lt;/artifactId&gt;
    &lt;version&gt;1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Any code that relied on the <code>javax.inject</code> annotations being present in the annotation metadata will still work as expected, however any code that interacts with them must be changed to no longer reference the annotation classes themselves. Static variables in the <a href="../api/io/micronaut/core/annotation/AnnotationUtil.html">AnnotationUtil</a> class (e.g. <code>AnnotationUtil.INJECT</code>, <code>AnnotationUtil.SINGLETON</code>, etc.) should be used in place of the annotation classes when working with annotation metadata.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nullability_annotations">Nullability Annotations</h3>
<div class="paragraph">
<p>Micronaut now only comes with its own set of annotations to declare nullability. The findbugs, javax, and jetbrains annotations are all still supported, however you must add a dependency to use them. Either switch to the Micronaut <a href="../api/io/micronaut/core/annotation/Nullable.html">@Nullable</a> / <a href="../api/io/micronaut/core/annotation/NonNull.html">@NonNull</a> annotations or add a dependency for the annotation library you wish to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rxjava2">RxJava2</h3>
<div class="paragraph">
<p>Micronaut no longer ships any reactive implementation as a default in any of our modules or core libraries. Upgrading to Micronaut 3 requires choosing which reactive streams implementation to use, and then adding the relevant dependency.</p>
</div>
<div class="paragraph">
<p>For those already using RxJava3 or Project Reactor, there should be no changes required to upgrade to Micronaut 3. If you use RxJava2 and wish to continue using it, you must add a dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava2:micronaut-rxjava2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava2&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava2&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>In addition, if any of the <code>Rx</code> HTTP client interfaces were used, a dependency must be added and the imports must be updated.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava2:micronaut-rxjava2-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava2&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava2-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. RxJava2 HTTP Client Imports</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old</th>
<th class="tableblock halign-left valign-top">New</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.http.client.RxHttpClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.rxjava2.http.client.RxHttpClient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.http.client.RxProxyHttpClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.rxjava2.http.client.proxy.RxProxyHttpClient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.http.client.RxStreamingHttpClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.rxjava2.http.client.RxStreamingHttpClient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.http.client.sse.RxSseClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.rxjava2.http.client.sse.RxSseClient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.websocket.RxWebSocketClient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.rxjava2.http.client.websockets.RxWebSocketClient</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the Netty based server implementation is being used, an additional dependency must be added:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava2:micronaut-rxjava2-http-server-netty")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava2&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava2-http-server-netty&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We recommend switching to Project Reactor as that is the implementation used internally by Micronaut. Adding a dependency to RxJava2 will result in both implementations in the runtime classpath of your application.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_environment_endpoint">Environment endpoint</h3>
<div class="paragraph">
<p>As of 3.3.0, the <a href="#environmentEndpoint">environmental endpoint</a> is now disabled by default, please see the <a href="#breaks">breaking changes</a> for how to restore functionality.</p>
</div>
</div>
<div class="sect2">
<h3 id="_breaking_changes">Breaking Changes</h3>
<div class="paragraph">
<p>Review the section on <a href="#breaks">Breaking Changes</a> and update your affected application code.</p>
</div>
</div>

<h1 id="quickStart"><a class="anchor" href="#quickStart"></a>2 Quick Start</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following sections walk you through a Quick Start on how to use Micronaut to setup a basic "Hello World" application.</p>
</div>
<div class="paragraph">
<p>Before getting started ensure you have a Java 8 or higher JDK installed, and it is recommended that you use a <a href="#ideSetup">suitable IDE</a> such as IntelliJ IDEA.</p>
</div>

<h2 id="buildCLI"><a class="anchor" href="#buildCLI"></a>2.1 Install the CLI</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/buildCLI.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut CLI is an optional but convenient way to create Micronaut applications. The best way to install Micronaut CLI on Unix systems is with <a href="https://sdkman.io/">SDKMAN</a> which greatly simplifies installing and managing multiple Micronaut versions.</p>
</div>
<div class="paragraph">
<p>To see all available installation methods, check the <a href="https://micronaut-projects.github.io/micronaut-starter/latest/guide/#installation">Micronaut Starter documentation</a>.</p>
</div>

<h2 id="creatingServer"><a class="anchor" href="#creatingServer"></a>2.2 Creating a Server Application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/creatingServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Using the Micronaut CLI you can create a new Micronaut application in either Groovy, Java, or Kotlin (the default is Java).</p>
</div>
<div class="paragraph">
<p>The following command creates a new "Hello World" server application in Java with a Gradle build:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Applications generated via our CLI include Gradle or Maven wrappers, so it is not even necessary to have Gradle or Maven installed on your machine to begin running the applications. Simply use the <code>mvnw</code> or <code>gradlew</code> command, as explained further below.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Supply <code>--build maven</code> to create a Maven-based build instead
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you don&#8217;t have the CLI installed then you can also create the same application by visiting <a href="https://launch.micronaut.io">Micronaut Launch</a> and clicking the "Generate Project" button or by using the following <code>curl</code> command on Unix systems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl https://launch.micronaut.io/hello-world.zip -o hello-world.zip
unzip hello-world.zip
cd hello-world</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Add <code>?build=maven</code> to the URL passed to <code>curl</code> to generate a Maven project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous steps created a new Java application in a directory called <code>hello-world</code> featuring a Gradle build. You can run the application with <code>./gradlew run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run
&gt; Task :run
[main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 540ms. Server Running: http://localhost:28933</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have created a Maven-based project, use <code>./mvnw mn:run</code> instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Windows the ./ before commands is not needed
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the Micronaut HTTP server is configured to run on port 8080. See the section <a href="#runningSpecificPort">Running Server on a Specific Port</a> for more options.</p>
</div>
<div class="paragraph">
<p>To create a service that responds to "Hello World" you first need a controller. The following is an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello") // <b class="conum">(1)</b>
public class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    public String index() {
        return "Hello World"; // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller('/hello') // <b class="conum">(1)</b>
class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    String index() {
        'Hello World' // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello") // <b class="conum">(1)</b>
class HelloController {

    @Get(produces = [MediaType.TEXT_PLAIN]) // <b class="conum">(2)</b>
    fun index(): String {
        return "Hello World" // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation defines the class as a controller mapped to the path <code>/hello</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation maps the <code>index</code> method to all requests that use an HTTP <code>GET</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A String "Hello World" is returned as the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you use Java, place the previous file in <code>src/main/java/hello/world</code>.<br>
If you use Groovy, place the previous file in <code>src/main/groovy/hello/world</code>.<br>
If you use Kotlin, place the previous file in <code>src/main/kotlin/hello/world</code>.</p>
</div>
<div class="paragraph">
<p>If you start the application and send a <code>GET</code> request to the <code>/hello</code> URI, the text "Hello World" is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:8080/hello
Hello World</code></pre>
</div>
</div>

<h2 id="ideSetup"><a class="anchor" href="#ideSetup"></a>2.3 Setting up an IDE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/ideSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The application created in the previous section contains a main class located in <code>src/main/java</code> that looks like the following:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String... args) {
        Micronaut.run Application
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.run(Application.javaClass)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the class that is run when starting the application via Gradle/Maven or via deployment. You can also run the main class directly within your IDE.</p>
</div>

<h2 id="ideaSetup"><a class="anchor" href="#ideaSetup"></a>2.3.1 IntelliJ IDEA</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/ideSetup/ideaSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To import a Micronaut project into IntelliJ IDEA, open the <code>build.gradle</code> or <code>pom.xml</code> file and follow the instructions to import the project.</p>
</div>
<div class="paragraph">
<p>For IntelliJ IDEA, if you plan to use the IntelliJ compiler, enable annotation processing under "Build, Execution, Deployment &#8594; Compiler &#8594; Annotation Processors" by ticking the "Enable annotation processing" checkbox:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/intellij-annotation-processors.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>Once you have enabled annotation processing in IntelliJ you can run the application and tests directly within the IDE without the need of an external build tool such as Gradle or Maven.</p>
</div>

<h2 id="eclipseSetup"><a class="anchor" href="#eclipseSetup"></a>2.3.2 Eclipse</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/ideSetup/eclipseSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use Eclipse IDE, it is recommended you import your Micronaut project into Eclipse using either <a href="https://projects.eclipse.org/projects/tools.buildship">Gradle BuildShip</a> for Gradle or <a href="https://www.eclipse.org/m2e/">M2Eclipse</a> for Maven.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut requires Eclipse IDE 4.9 or higher
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_eclipse_and_gradle">Eclipse and Gradle</h3>
<div class="paragraph">
<p>Once you have set up Eclipse 4.9 or higher with <a href="https://projects.eclipse.org/projects/tools.buildship">Gradle BuildShip</a>, first run the <code>gradle eclipse</code> task from the root of your project, then import the project by selecting <code>File &#8594; Import</code> and choosing <code>Gradle &#8594; Existing Gradle Project</code> and navigating to the root directory of your project (where the <code>build.gradle</code> file is located).</p>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse_and_maven">Eclipse and Maven</h3>
<div class="paragraph">
<p>For Eclipse 4.9 and above with Maven you need the following Eclipse plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.eclipse.org/m2e/">M2Eclipse for Maven</a></p>
</li>
<li>
<p><a href="https://github.com/jbosstools/m2e-apt">Maven integration with Eclipse JDT Annotation Processor Toolkit</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once these are installed, import the project by selecting <code>File &#8594; Import</code> and choosing <code>Maven &#8594; Existing Maven Project</code> and navigating to the root directory of your project (where the <code>pom.xml</code> file is located).</p>
</div>
<div class="paragraph">
<p>Then enable annotation processing by opening <code>Eclipse &#8594; Preferences</code> and navigating to <code>Maven &#8594; Annotation Processing</code> and selecting the option <code>Automatically configure JDT APT</code>.</p>
</div>
</div>

<h2 id="vsCodeSetup"><a class="anchor" href="#vsCodeSetup"></a>2.3.3 Visual Studio Code</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/ideSetup/vsCodeSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut can be set up within Visual Studio Code in one of two ways.</p>
</div>
<div class="sect3">
<h4 id="_option_1_graalvm_extension_pack_for_java">Option 1) GraalVM Extension Pack for Java</h4>
<div class="paragraph">
<p>The prefered way is using the <a href="https://marketplace.visualstudio.com/items?itemName=oracle-labs-graalvm.graalvm-pack">GraalVM Extension Pack for Java</a> which ships with an <a href="https://netbeans.apache.org/">Apache NetBeans</a> Language server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is not possible to have both the official <a href="https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack">Java Extension Pack</a> and the GraalVM Extension Pack for Java installed at the same time so if you prefer the former, skip this section and go to Option 2)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://marketplace.visualstudio.com/items?itemName=oracle-labs-graalvm.graalvm">GraalVM Tools for Java</a> are preferred since they delegate to the build system for running applications and tests which means there is no additional setup or differences with regards to how javac is configured for annotation processing when compared to the <a href="https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack">Java Extension Pack</a> which is based on the Eclipse compiler.</p>
</div>
<div class="paragraph">
<p>The GraalVM Extension Pack also includes the <a href="https://marketplace.visualstudio.com/items?itemName=oracle-labs-graalvm.micronaut">GraalVM Tools for Micronaut</a> extension which features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application creation wizard</p>
</li>
<li>
<p>Code completion for YAML configuration</p>
</li>
<li>
<p>Pallet commands to build, deploy, create Native Images etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_option_2_red_hatmicrosoft_java_extension_pack">Option 2) Red Hat/Microsoft Java Extension Pack</h4>
<div class="paragraph">
<p>First install the <a href="https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack">Java Extension Pack</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also optionally install <a href="https://marketplace.visualstudio.com/items?itemName=Pivotal.vscode-spring-boot">STS</a> to enable code completion for <code>application.yml</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you use Gradle, prior to opening the project in VSC run the following command from a terminal window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew eclipse</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t run the above command beforehand then annotation processing will not be configured correctly and the application will not work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the extension pack is installed just type <code>code .</code> in any project directory and the project will be automatically set up.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For macOs, you need to install the <code>code</code> command <a href="https://code.visualstudio.com/docs/setup/mac">by following these instructions</a>.
</td>
</tr>
</table>
</div>
</div>

<h2 id="creatingClient"><a class="anchor" href="#creatingClient"></a>2.4 Creating a Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/creatingClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Micronaut includes both an <a href="#httpServer">HTTP server</a> and an <a href="#httpClient">HTTP client</a>. A <a href="#lowLevelHttpClient">low-level HTTP client</a> is provided which you can use to test the <code>HelloController</code> created in the previous section.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Hello World</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import jakarta.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class HelloControllerSpec {

    @Inject
    EmbeddedServer server; // <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client; // <b class="conum">(2)</b>

    @Test
    void testHelloWorldResponse() {
        String response = client.toBlocking() // <b class="conum">(3)</b>
                .retrieve(HttpRequest.GET("/hello"));
        assertEquals("Hello World", response); // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Hello World</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.extensions.spock.annotation.MicronautTest
import spock.lang.Specification

import jakarta.inject.Inject

@MicronautTest
class HelloControllerSpec extends Specification {

    @Inject
    EmbeddedServer embeddedServer // <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client // <b class="conum">(2)</b>

    void "test hello world response"() {
        expect:
            client.toBlocking() // <b class="conum">(3)</b>
                    .retrieve(HttpRequest.GET('/hello')) == "Hello World" // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Hello World</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import jakarta.inject.Inject

@MicronautTest
class HelloControllerSpec {

    @Inject
    lateinit var server: EmbeddedServer // <b class="conum">(1)</b>

    @Inject
    @field:Client("/")
    lateinit var client: HttpClient // <b class="conum">(2)</b>

    @Test
    fun testHelloWorldResponse() {
        val rsp: String = client.toBlocking() // <b class="conum">(3)</b>
                .retrieve("/hello")
        assertEquals("Hello World", rsp) // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> is configured as a shared test field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> instance shared field is also defined</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The test uses the <code>toBlocking()</code> method to make a blocking call</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>retrieve</code> method returns the controller response as a <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to a low-level client, Micronaut features a <a href="#clientAnnotation">declarative, compile-time HTTP client</a>, powered by the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>To create a client, create an interface annotated with <code>@Client</code>, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">src/main/java/hello/world/HelloClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import org.reactivestreams.Publisher;
import io.micronaut.core.async.annotation.SingleResult;

@Client("/hello") // <b class="conum">(1)</b>
public interface HelloClient {

    @Get(consumes = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    @SingleResult
    Publisher&lt;String&gt; hello(); // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">src/main/java/hello/world/HelloClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher
import io.micronaut.core.async.annotation.SingleResult

@Client("/hello") // <b class="conum">(1)</b>
interface HelloClient {

    @Get(consumes = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    @SingleResult
    Publisher&lt;String&gt; hello() // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">src/main/java/hello/world/HelloClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import io.micronaut.core.async.annotation.SingleResult
import org.reactivestreams.Publisher

@Client("/hello") // <b class="conum">(1)</b>
interface HelloClient {

    @Get(consumes = [MediaType.TEXT_PLAIN]) // <b class="conum">(2)</b>
    @SingleResult
    fun hello(): Publisher&lt;String&gt;  // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Client</code> annotation is used with a value that is a relative path to the current server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The same <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation used on the server is used to define the client mapping</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A <code>Publisher</code> annotated with <code>SingleResult</code> is returned with the value read from the server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To test the <code>HelloClient</code>, retrieve it from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> associated with the server:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing HelloClient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import org.junit.jupiter.api.Test;
import io.micronaut.core.async.annotation.SingleResult;

import jakarta.inject.Inject;
import reactor.core.publisher.Mono;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest // <b class="conum">(1)</b>
public class HelloClientSpec  {

    @Inject
    HelloClient client; // <b class="conum">(2)</b>

    @Test
    public void testHelloWorldResponse(){
        assertEquals("Hello World", Mono.from(client.hello()).block());// <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing HelloClient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.test.extensions.spock.annotation.MicronautTest
import reactor.core.publisher.Mono
import spock.lang.Specification

import jakarta.inject.Inject

@MicronautTest // <b class="conum">(1)</b>
class HelloClientSpec extends Specification {

    @Inject HelloClient client // <b class="conum">(2)</b>

    void "test hello world response"() {
        expect:
        Mono.from(client.hello()).block() == "Hello World" // <b class="conum">(3)</b>
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing HelloClient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Property
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import jakarta.inject.Inject
import reactor.core.publisher.Mono


@MicronautTest // <b class="conum">(1)</b>
class HelloClientSpec {

    @Inject
    lateinit var client: HelloClient // <b class="conum">(2)</b>

    @Test
    fun testHelloWorldResponse() {
        assertEquals("Hello World", Mono.from(client.hello()).block())// <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@MicronautTest</code> annotation defines the test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>HelloClient</code> is injected from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The client is invoked using the <a href="https://projectreactor.io">Project Reactor</a> <code>Mono::block</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation produces an implementation automatically for you at compile time without the using proxies or runtime reflection.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is very flexible. See the section on the <a href="#httpClient">Micronaut HTTP Client</a> for more information.</p>
</div>

<h2 id="deployingApp"><a class="anchor" href="#deployingApp"></a>2.5 Deploying the Application</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/quickStart/deployingApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy a Micronaut application you create an executable JAR file by running <code>./gradlew assemble</code> or <code>./mvnw package</code>.</p>
</div>
<div class="paragraph">
<p>The constructed JAR file can then be executed with <code>java -jar</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -jar build/libs/hello-world-0.1-all.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>if building with Gradle, or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -jar target/hello-world.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>if building with Maven.</p>
</div>
<div class="paragraph">
<p>The executable JAR can be run locally, or deployed to a virtual machine or managed Cloud service that supports executable JARs.</p>
</div>
<div class="paragraph">
<p>To publish a layered application to a Docker container registry, configure your Docker image name in <code>build.gradle</code> for Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dockerBuild {
    images = ["[REPO_URL]/[NAMESPACE]/my-image:$project.version"]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then use <code>dockerPush</code> to push a built image of the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew dockerPush</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Maven, define the following plugin in your POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;
  &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;to&gt;
      &lt;image&gt;docker.io/my-company/my-image:${project.version}&lt;/image&gt;
    &lt;/to&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then invoke the <code>deploy</code> lifecycle phase specifying the packaging type as either <code>docker</code> or <code>docker-native</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw deploy -Dpackaging=docker</code></pre>
</div>
</div>

<h1 id="ioc"><a class="anchor" href="#ioc"></a>3 Inversion of Control</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Unlike other frameworks which rely on runtime reflection and proxies, Micronaut uses compile time data to implement dependency injection.</p>
</div>
<div class="paragraph">
<p>This is a similar approach taken by tools such as Google <a href="https://google.github.io/dagger/">Dagger</a>, which is designed primarily with Android in mind. Micronaut, on the other hand, is designed for building server-side microservices and provides many of the same tools and utilities as other frameworks but without using reflection or caching excessive amounts of reflection metadata.</p>
</div>
<div class="paragraph">
<p>The goals of the Micronaut IoC container are summarized as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use reflection as a last resort</p>
</li>
<li>
<p>Avoid proxies</p>
</li>
<li>
<p>Optimize start-up time</p>
</li>
<li>
<p>Reduce memory footprint</p>
</li>
<li>
<p>Provide clear, understandable error handling</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the IoC part of Micronaut can be used completely independently of Micronaut for whatever application type you wish to build.</p>
</div>
<div class="paragraph">
<p>To do so, configure your build to include the <code>micronaut-inject-java</code> dependency as an annotation processor.</p>
</div>
<div class="paragraph">
<p>The easiest way to do this is with Micronaut&#8217;s Gradle or Maven plugins. For example with Gradle:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">plugins {
    id 'io.micronaut.library' version '1.3.2' <i class="conum" data-value="1"></i><b>(1)</b>
}

version "0.1"
group "com.example"

repositories {
    mavenCentral()
}

micronaut {
    version = "3.9.7" <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the <a href="https://plugins.gradle.org/plugin/io.micronaut.library">Micronaut Library plugin</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the Micronaut version to use</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The entry point for IoC is then the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> interface, which includes a <code>run</code> method. The following example demonstrates using it:</p>
</div>
<div class="listingblock">
<div class="title">Running the <code>ApplicationContext</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">try (ApplicationContext context = ApplicationContext.run()) { <i class="conum" data-value="1"></i><b>(1)</b>
    MyBean myBean = context.getBean(MyBean.class); <i class="conum" data-value="2"></i><b>(2)</b>
    // do something with your bean
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Run the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve a bean from the <code>ApplicationContext</code></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example uses Java <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> syntax to ensure the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is cleanly shutdown when the application exits.
</td>
</tr>
</table>
</div>

<h2 id="beans"><a class="anchor" href="#beans"></a>3.1 Defining Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/beans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A bean is an object whose lifecycle is managed by the Micronaut IoC container. That lifecycle may include creation, execution, and destruction. Micronaut implements the <a href="https://javax-inject.github.io/javax-inject/">JSR-330 (javax.inject) - Dependency Injection for Java</a> specification, hence to use Micronaut you simply use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/package-summary.html">annotations provided by javax.inject</a>.</p>
</div>
<div class="paragraph">
<p>The following is a simple example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Engine { // <b class="conum">(1)</b>
    int getCylinders();
    String start();
}

@Singleton// <b class="conum">(2)</b>
public class V8Engine implements Engine {
    private int cylinders = 8;

    @Override
    public String start() {
        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }
}

@Singleton
public class Vehicle {
    private final Engine engine;

    public Vehicle(Engine engine) {// <b class="conum">(3)</b>
        this.engine = engine;
    }

    public String start() {
        return engine.start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">interface Engine { // <b class="conum">(1)</b>
    int getCylinders()
    String start()
}

@Singleton // <b class="conum">(2)</b>
class V8Engine implements Engine {
    int cylinders = 8

    @Override
    String start() {
        "Starting V8"
    }
}

@Singleton
class Vehicle {
    final Engine engine

    Vehicle(Engine engine) { // <b class="conum">(3)</b>
        this.engine = engine
    }

    String start() {
        engine.start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">interface Engine {
    // <b class="conum">(1)</b>
    val cylinders: Int

    fun start(): String
}

@Singleton// <b class="conum">(2)</b>
class V8Engine : Engine {

    override var cylinders = 8

    override fun start(): String {
        return "Starting V8"
    }
}

@Singleton
class Vehicle(private val engine: Engine) { // <b class="conum">(3)</b>
    fun start(): String {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A common <code>Engine</code> interface is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>V8Engine</code> implementation is defined and marked with <code>Singleton</code> scope</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>Engine</code> is injected via constructor injection</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform dependency injection, run the <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> using the <code>run()</code> method and lookup a bean using <code>getBean(Class)</code>, as per the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final BeanContext context = BeanContext.run();
Vehicle vehicle = context.getBean(Vehicle.class);
System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def context = BeanContext.run()
Vehicle vehicle = context.getBean(Vehicle)
println vehicle.start()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val context = BeanContext.run()
val vehicle = context.getBean(Vehicle::class.java)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut automatically discovers dependency injection metadata on the classpath and wires the beans together according to injection points you define.</p>
</div>
<div class="paragraph">
<p>Micronaut supports the following types of dependency injection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constructor injection (must be one public constructor or a single constructor annotated with <code>@Inject</code>)</p>
</li>
<li>
<p>Field injection</p>
</li>
<li>
<p>JavaBean property injection</p>
</li>
<li>
<p>Method parameter injection</p>
</li>
</ul>
</div>

<h2 id="how"><a class="anchor" href="#how"></a>3.2 How Does it Work?</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/how.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At this point, you may be wondering how Micronaut performs the above dependency injection without requiring reflection.</p>
</div>
<div class="paragraph">
<p>The key is a set of AST transformations (for Groovy) and annotation processors (for Java) that generate classes that implement the <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> interface.</p>
</div>
<div class="paragraph">
<p>Micronaut uses the ASM bytecode library to generate classes, and because Micronaut knows ahead of time the injection points, there is no need to scan all of the methods, fields, constructors, etc. at runtime like other frameworks such as Spring do.</p>
</div>
<div class="paragraph">
<p>Also, since reflection is not used when constructing the bean, the JVM can inline and optimize the code far better, resulting in better runtime performance and reduced memory consumption. This is particularly important for non-singleton scopes where application performance depends on bean creation performance.</p>
</div>
<div class="paragraph">
<p>In addition, with Micronaut your application startup time and memory consumption are not affected by the size of your codebase in the same way as with a framework that uses reflection. Reflection-based IoC frameworks load and cache reflection data for every single field, method, and constructor in your code. Thus as your code grows in size so do your memory requirements, whilst with Micronaut this is not the case.</p>
</div>

<h2 id="beanContext"><a class="anchor" href="#beanContext"></a>3.3 The BeanContext</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/beanContext.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> is a container object for all your bean definitions (it also implements <a href="../api/io/micronaut/context/BeanDefinitionRegistry.html">BeanDefinitionRegistry</a>).</p>
</div>
<div class="paragraph">
<p>It is also the point of initialization for Micronaut. Generally speaking however, you don&#8217;t interact directly with the <code>BeanContext</code> API and can simply use <code>jakarta.inject</code> annotations and the annotations in the <a href="../api/io/micronaut/context/annotation/package-summary.html">io.micronaut.context.annotation</a> package for your dependency injection needs.</p>
</div>

<h2 id="types"><a class="anchor" href="#types"></a>3.4 Injectable Container Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/types.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to being able to inject beans, Micronaut natively supports injecting the following types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Injectable Container Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">java.util.Optional</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Optional</code> of a bean. <code>empty()</code> is injected if the bean doesn&#8217;t exist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Optional&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html">java.lang.Collection</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Collection</code> or subtype of <code>Collection</code> (e.g. <code>List</code>, <code>Set</code>, etc.)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Collection&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">java.util.stream.Stream</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A lazy <code>Stream</code> of beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Array.html">Array</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A native array of beans of a given type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Engine[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Provider.html">Provider</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>javax.inject.Provider</code> if a circular dependency requires it, or to instantiate a prototype for each <code>get</code> call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Provider&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://jakarta.ee/specifications/platform/9/apidocs/jakarta/inject/Provider.html">Provider</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>jakarta.inject.Provider</code> if a circular dependency requires it or to instantiate a prototype for each <code>get</code> call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Provider&lt;Engine&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>io.micronaut.context.BeanProvider</code> if a circular dependency requires it or to instantiate a prototype for each <code>get</code> call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanProvider&lt;Engine&gt;</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are 3 different provider types supported, however the <code>BeanProvider</code> is the one we suggest to use.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When injecting a <code>java.lang.Collection</code>, or <code>java.util.stream.Stream</code>, <code>Array</code> of beans into a bean matching the injection type, then the owning bean will not be a member of the injected collection.  A common pattern demonstrating this is aggregation. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
class AggregateEngine implements Engine {
  @Inject
  List&lt;Engine&gt; engines;

  @Override
  public void start() {
    engines.forEach(Engine::start);
  }

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the injected member variable <code>engines</code> will not contain an instance of <code>AggregateEngine</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A prototype bean will have one instance created per place the bean is injected. When a prototype bean is injected as a provider, each call to <code>get()</code> creates a new instance.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_collection_ordering">Collection Ordering</h3>
<div class="paragraph">
<p>When injecting a collection of beans, they are not ordered by default. Implement the <a href="../api/io/micronaut/core/order/Ordered.html">Ordered</a> interface to inject an ordered collection. If the requested bean type does not implement <a href="../api/io/micronaut/core/order/Ordered.html">Ordered</a>, Micronaut searches for the <a href="../api/io/micronaut/core/annotation/Order.html">@Order</a> annotation on beans.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/Order.html">@Order</a> annotation is especially useful for ordering beans created by factories where the bean type is a class in a third-party library. In this example, both <code>LowRateLimit</code> and <code>HighRateLimit</code> implement the <code>RateLimit</code> interface.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory with @Order</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Factory;
import io.micronaut.core.annotation.Order;

import jakarta.inject.Singleton;
import java.time.Duration;

@Factory
public class RateLimitsFactory {

    @Singleton
    @Order(20)
    LowRateLimit rateLimit2() {
        return new LowRateLimit(Duration.ofMinutes(50), 100);
    }

    @Singleton
    @Order(10)
    HighRateLimit rateLimit1() {
        return new HighRateLimit(Duration.ofMinutes(50), 1000);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory with @Order</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.Order

import jakarta.inject.Singleton
import java.time.Duration

@Factory
class RateLimitsFactory {

    @Singleton
    @Order(20)
    LowRateLimit rateLimit2() {
        new LowRateLimit(Duration.ofMinutes(50), 100);
    }

    @Singleton
    @Order(10)
    HighRateLimit rateLimit1() {
        new HighRateLimit(Duration.ofMinutes(50), 1000);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory with @Order</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.Order
import java.time.Duration
import jakarta.inject.Singleton

@Factory
class RateLimitsFactory {

    @Singleton
    @Order(20)
    fun rateLimit2(): LowRateLimit {
        return LowRateLimit(Duration.ofMinutes(50), 100)
    }

    @Singleton
    @Order(10)
    fun rateLimit1(): HighRateLimit {
        return HighRateLimit(Duration.ofMinutes(50), 1000)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a collection of <code>RateLimit</code> beans are requested from the context, they are returned in ascending order based on the value in the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_injecting_a_bean_by_order">Injecting a Bean by Order</h3>
<div class="paragraph">
<p>When injecting a single instance of a bean the <a href="../api/io/micronaut/core/annotation/Order.html">@Order</a> annotation can also be used to define which bean has the highest precedence and hence should be injected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/core/order/Ordered.html">Ordered</a> interface is not taken into account when selecting a single instance as this would require instantiating the bean to resolve the order.
</td>
</tr>
</table>
</div>
</div>

<h2 id="qualifiers"><a class="anchor" href="#qualifiers"></a>3.5 Bean Qualifiers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/qualifiers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you have multiple possible implementations for a given interface to inject, you need to use a qualifier.</p>
</div>
<div class="paragraph">
<p>Once again Micronaut leverages JSR-330 and the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> and <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotations to support this use case.</p>
</div>
<div class="sect1">
<h2 id="_qualifying_by_name">Qualifying By Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To qualify by name, use the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">Named</a> annotation. For example, consider the following classes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Engine { // <b class="conum">(1)</b>
    int getCylinders();
    String start();
}

@Singleton
public class V6Engine implements Engine {  // <b class="conum">(2)</b>
    @Override
    public String start() {
        return "Starting V6";
    }

    @Override
    public int getCylinders() {
        return 6;
    }
}

@Singleton
public class V8Engine implements Engine {  // <b class="conum">(3)</b>
    @Override
    public String start() {
        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return 8;
    }

}

@Singleton
public class Vehicle {
    private final Engine engine;

    @Inject
    public Vehicle(@Named("v8") Engine engine) {// <b class="conum">(4)</b>
        this.engine = engine;
    }

    public String start() {
        return engine.start();// <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">interface Engine { // <b class="conum">(1)</b>
    int getCylinders()
    String start()
}

@Singleton
class V6Engine implements Engine { // <b class="conum">(2)</b>
    int cylinders = 6

    @Override
    String start() {
        "Starting V6"
    }
}

@Singleton
class V8Engine implements Engine { // <b class="conum">(3)</b>
    int cylinders = 8

    @Override
    String start() {
        "Starting V8"
    }
}

@Singleton
class Vehicle {
    final Engine engine

    @Inject Vehicle(@Named('v8') Engine engine) { // <b class="conum">(4)</b>
        this.engine = engine
    }

    String start() {
        engine.start() // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">interface Engine { // <b class="conum">(1)</b>
    val cylinders: Int
    fun start(): String
}

@Singleton
class V6Engine : Engine {  // <b class="conum">(2)</b>

    override var cylinders: Int = 6

    override fun start(): String {
        return "Starting V6"
    }
}

@Singleton
class V8Engine : Engine {

    override var cylinders: Int = 8

    override fun start(): String {
        return "Starting V8"
    }

}

@Singleton
class Vehicle @Inject
constructor(@param:Named("v8") private val engine: Engine) { // <b class="conum">(4)</b>

    fun start(): String {
        return engine.start() // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Engine</code> interface defines the common contract</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>V6Engine</code> class is the first implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>V8Engine</code> class is the second implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">javax.inject.Named</a> annotation indicates that the <code>V8Engine</code> implementation is required</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Calling the start method prints: <code>"Starting V8"</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut is capable of injecting <code>V8Engine</code> in the previous example, because:</p>
</div>
<div class="paragraph">
<p><code>@Named</code> qualifier value (<code>v8</code>) + type being injected simple name (<code>Engine</code>) == (case-insensitive) == The simple name of a bean of type <code>Engine</code> (<code>V8Engine</code>)</p>
</div>
<div class="paragraph">
<p>You can also declare <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Named.html">@Named</a> at the class level of a bean to explicitly define the name of the bean.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qualifying_by_annotation">Qualifying By Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to being able to qualify by name, you can build your own qualifiers using the <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Qualifier.html">Qualifier</a> annotation. For example, consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Qualifier;
import java.lang.annotation.Retention;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Qualifier
@Retention(RUNTIME)
public @interface V8 {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Qualifier
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Qualifier
@Retention(RUNTIME)
@interface V8 {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Qualifier
import java.lang.annotation.Retention
import java.lang.annotation.RetentionPolicy.RUNTIME

@Qualifier
@Retention(RUNTIME)
annotation class V8</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above annotation is itself annotated with the <code>@Qualifier</code> annotation to designate it as a qualifier. You can then use the annotation at any injection point in your code. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject Vehicle(@V8 Engine engine) {
    this.engine = engine;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject Vehicle(@V8 Engine engine) {
    this.engine = engine
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject constructor(@V8 val engine: Engine) {</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qualifying_by_annotation_members">Qualifying By Annotation Members</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Micronaut 3.0, annotation qualifiers can also use annotation members to resolve the correct bean to inject. For example, consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.NonBinding;
import jakarta.inject.Qualifier;
import java.lang.annotation.Retention;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Qualifier // <b class="conum">(1)</b>
@Retention(RUNTIME)
public @interface Cylinders {
    int value();

    @NonBinding // <b class="conum">(2)</b>
    String description() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.NonBinding
import jakarta.inject.Qualifier
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Qualifier // <b class="conum">(1)</b>
@Retention(RUNTIME)
@interface Cylinders {
    int value();

    @NonBinding // <b class="conum">(2)</b>
    String description() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.NonBinding
import jakarta.inject.Qualifier
import kotlin.annotation.Retention

@Qualifier // <b class="conum">(1)</b>
@Retention(AnnotationRetention.RUNTIME)
annotation class Cylinders(
    val value: Int,
    @get:NonBinding // <b class="conum">(2)</b>
    val description: String = ""
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Cylinders</code> annotation is meta-annotated with <code>@Qualifier</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation has two members. The <a href="../api/io/micronaut/context/annotation/NonBinding.html">@NonBinding</a> annotation is used to exclude the <code>description</code> member from being considered during dependency resolution.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then use the <code>@Cylinders</code> annotation on any bean and the members that are not annotated with <a href="../api/io/micronaut/context/annotation/NonBinding.html">@NonBinding</a> are considered during dependency resolution:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Cylinders(value = 6, description = "6-cylinder V6 engine")  // <b class="conum">(1)</b>
public class V6Engine implements Engine { // <b class="conum">(2)</b>

    @Override
    public int getCylinders() {
        return 6;
    }

    @Override
    public String start() {
        return "Starting V6";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
@Cylinders(value = 6, description = "6-cylinder V6 engine")  // <b class="conum">(1)</b>
class V6Engine implements Engine { // <b class="conum">(2)</b>

    @Override
    int getCylinders() {
        return 6
    }

    @Override
    String start() {
        return "Starting V6"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
@Cylinders(value = 6, description = "6-cylinder V6 engine") // <b class="conum">(1)</b>
class V6Engine : Engine { // <b class="conum">(2)</b>
    // <b class="conum">(2)</b>
    override val cylinders: Int
        get() = 6

    override fun start(): String {
        return "Starting V6"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here the <code>value</code> member is set to 6 for the <code>V6Engine</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class implements an <code>Engine</code> interface</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Cylinders(value = 8, description = "8-cylinder V8 engine") // <b class="conum">(1)</b>
public class V8Engine implements Engine { // <b class="conum">(2)</b>
    @Override
    public int getCylinders() {
        return 8;
    }

    @Override
    public String start() {
        return "Starting V8";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
@Cylinders(value = 8, description = "8-cylinder V8 engine") // <b class="conum">(1)</b>
class V8Engine implements Engine { // <b class="conum">(2)</b>
    @Override
    int getCylinders() {
        return 8
    }

    @Override
    String start() {
        return "Starting V8"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
@Cylinders(value = 8, description = "8-cylinder V8 engine") // <b class="conum">(1)</b>
class V8Engine : Engine { // <b class="conum">(2)</b>
    override val cylinders: Int
        get() = 8

    override fun start(): String {
        return "Starting V8"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here the <code>value</code> member is set to 8 for the <code>V8Engine</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class implements an <code>Engine</code> interface</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then use the <code>@Cylinders</code> qualifier on any injection point to select the correct bean to inject. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject Vehicle(@Cylinders(8) Engine engine) {
    this.engine = engine;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject Vehicle(@Cylinders(8) Engine engine) {
    this.engine = engine
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class Vehicle(@param:Cylinders(8) val engine: Engine) {
    fun start(): String {
        return engine.start()
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qualifying_by_generic_type_arguments">Qualifying by Generic Type Arguments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Micronaut 3.0, it is possible to select which bean to inject based on the generic type arguments of the class or interface. Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface CylinderProvider {
    int getCylinders();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">interface CylinderProvider {
    int getCylinders()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">interface CylinderProvider {
    val cylinders: Int
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CylinderProvider</code> interface provides the number of cylinders.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Engine&lt;T extends CylinderProvider&gt; { // <b class="conum">(1)</b>
    default int getCylinders() {
        return getCylinderProvider().getCylinders();
    }

    default String start() {
        return "Starting " + getCylinderProvider().getClass().getSimpleName();
    }

    T getCylinderProvider();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">interface Engine&lt;T extends CylinderProvider&gt; { // <b class="conum">(1)</b>
    default int getCylinders() { cylinderProvider.cylinders }

    default String start() { "Starting ${cylinderProvider.class.simpleName}" }

    T getCylinderProvider()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">interface Engine&lt;T : CylinderProvider&gt; { // <b class="conum">(1)</b>
    val cylinders: Int
        get() = cylinderProvider.cylinders

    fun start(): String {
        return "Starting ${cylinderProvider.javaClass.simpleName}"
    }

    val cylinderProvider: T
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The engine class defines a generic type argument <code>&lt;T&gt;</code> that must be an instance of <code>CylinderProvider</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can define implementations of the <code>Engine</code> interface with different generic type arguments. For example for a V6 engine:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class V6 implements CylinderProvider {
    @Override
    public int getCylinders() {
        return 6;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class V6 implements CylinderProvider {
    @Override
    int getCylinders() { 6 }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class V6 : CylinderProvider {
    override val cylinders: Int = 6
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above defines a <code>V6</code> class that implements the <code>CylinderProvider</code> interface.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class V6Engine implements Engine&lt;V6&gt; {  // <b class="conum">(1)</b>
    @Override
    public V6 getCylinderProvider() {
        return new V6();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class V6Engine implements Engine&lt;V6&gt; {  // <b class="conum">(1)</b>
    @Override
    V6 getCylinderProvider() { new V6() }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class V6Engine : Engine&lt;V6&gt; { // <b class="conum">(1)</b>
    override val cylinderProvider: V6
        get() = V6()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>V6Engine</code> implements <code>Engine</code> providing <code>V6</code> as a generic type parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And a V8 engine:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class V8 implements CylinderProvider {
    @Override
    public int getCylinders() {
        return 8;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class V8 implements CylinderProvider {
    @Override
    int getCylinders() { 8 }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class V8 : CylinderProvider {
    override val cylinders: Int = 8
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above defines a <code>V8</code> class that implements the <code>CylinderProvider</code> interface.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class V8Engine implements Engine&lt;V8&gt; {  // <b class="conum">(1)</b>
    @Override
    public V8 getCylinderProvider() {
        return new V8();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class V8Engine implements Engine&lt;V8&gt; {  // <b class="conum">(1)</b>
    @Override
    V8 getCylinderProvider() { new V8() }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class V8Engine : Engine&lt;V8&gt; { // <b class="conum">(1)</b>
    override val cylinderProvider: V8
        get() = V8()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>V8Engine</code> implements <code>Engine</code> providing <code>V8</code> as a generic type parameter</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then use the generic arguments when defining the injection point and Micronaut will pick the correct bean
to inject based on the specific generic type arguments:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
public Vehicle(Engine&lt;V8&gt; engine) {
    this.engine = engine;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject
Vehicle(Engine&lt;V8&gt; engine) {
    this.engine = engine
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class Vehicle(val engine: Engine&lt;V8&gt;) {</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the <code>V8Engine</code> bean is injected.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_primary_and_secondary_beans">Primary and Secondary Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../api/io/micronaut/context/annotation/Primary.html">Primary</a> is a qualifier that indicates that a bean is the primary bean to be selected in the case of multiple interface implementations.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ColorPicker {
    String color();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">interface ColorPicker {
    String color()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">interface ColorPicker {
    fun color(): String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ColorPicker</code> is implemented by these classes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Primary;
import jakarta.inject.Singleton;

@Primary
@Singleton
class Green implements ColorPicker {

    @Override
    public String color() {
        return "green";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Primary
import jakarta.inject.Singleton

@Primary
@Singleton
class Green implements ColorPicker {

    @Override
    String color() {
        return "green"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The Primary Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Primary
import jakarta.inject.Singleton

@Primary
@Singleton
class Green: ColorPicker {
    override fun color(): String {
        return "green"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Green</code> bean class implements <code>ColorPicker</code> and is annotated with <code>@Primary</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Singleton;

@Singleton
public class Blue implements ColorPicker {

    @Override
    public String color() {
        return "blue";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Singleton

@Singleton
class Blue implements ColorPicker {

    @Override
    String color() {
        return "blue"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Another Bean of the Same Type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Singleton

@Singleton
class Blue: ColorPicker {
    override fun color(): String {
        return "blue"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Blue</code> bean class also implements <code>ColorPicker</code> and hence you have two possible candidates when injecting the <code>ColorPicker</code> interface. Since <code>Green</code> is the primary, it will always be favoured.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/testPrimary")
public class TestController {

    protected final ColorPicker colorPicker;

    public TestController(ColorPicker colorPicker) { // <b class="conum">(1)</b>
        this.colorPicker = colorPicker;
    }

    @Get
    public String index() {
        return colorPicker.color();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/test")
class TestController {

    protected final ColorPicker colorPicker

    TestController(ColorPicker colorPicker) { // <b class="conum">(1)</b>
        this.colorPicker = colorPicker
    }

    @Get
    String index() {
        colorPicker.color()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/test")
class TestController(val colorPicker: ColorPicker) { // <b class="conum">(1)</b>

    @Get
    fun index(): String {
        return colorPicker.color()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Although there are two <code>ColorPicker</code> beans, <code>Green</code> gets injected due to the <code>@Primary</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If multiple possible candidates are present and no <code>@Primary</code> is defined a <a href="../api/io/micronaut/context/exceptions/NonUniqueBeanException.html">NonUniqueBeanException</a> is thrown.</p>
</div>
<div class="paragraph">
<p>In addition to <code>@Primary</code>, there is also a <a href="../api/io/micronaut/context/annotation/Secondary.html">Secondary</a> annotation which causes the opposite effect and allows de-prioritizing a bean.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_injecting_any_bean">Injecting Any Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are not particular about which bean gets injected then you can use the <a href="../api/io/micronaut/context/annotation/Any.html">@Any</a> qualifier which will inject the first available bean, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Injecting Any Instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject @Any
Engine engine;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Injecting Any Instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject @Any
Engine engine</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Injecting Any Instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
@field:Any
lateinit var engine: Engine</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Any.html">@Any</a> qualifier is typically used in conjunction with the <a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a> interface to allow more dynamic use cases. For example the following <code>Vehicle</code> implementation will start the <code>Engine</code> if the bean is present:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.BeanProvider;
import io.micronaut.context.annotation.Any;
import jakarta.inject.Singleton;

@Singleton
public class Vehicle {
    final BeanProvider&lt;Engine&gt; engineProvider;

    public Vehicle(@Any BeanProvider&lt;Engine&gt; engineProvider) { // <b class="conum">(1)</b>
        this.engineProvider = engineProvider;
    }
    void start() {
        engineProvider.ifPresent(Engine::start); // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.BeanProvider
import io.micronaut.context.annotation.Any
import jakarta.inject.Singleton

@Singleton
class Vehicle {
    final BeanProvider&lt;Engine&gt; engineProvider

    Vehicle(@Any BeanProvider&lt;Engine&gt; engineProvider) { // <b class="conum">(1)</b>
        this.engineProvider = engineProvider
    }
    void start() {
        engineProvider.ifPresent(Engine::start) // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.BeanProvider
import io.micronaut.context.annotation.Any
import jakarta.inject.Singleton

@Singleton
class Vehicle(@param:Any val engineProvider: BeanProvider&lt;Engine&gt;) { // <b class="conum">(1)</b>
    fun start() {
        engineProvider.ifPresent { it.start() } // <b class="conum">(2)</b>
    }
    fun startAll() {
        if (engineProvider.isPresent) { // <b class="conum">(1)</b>
            engineProvider.forEach { it.start() } // <b class="conum">(2)</b>
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>@Any</code> to inject the <a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Call the <code>start</code> method if the underlying bean is present using the <code>ifPresent</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If there are multiple beans you can also adapt the behaviour. The following example starts all the engines installed in the <code>Vehicle</code> if any are present:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">void startAll() {
    if (engineProvider.isPresent()) { // <b class="conum">(1)</b>
        engineProvider.stream().forEach(Engine::start); // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">void startAll() {
    if (engineProvider.isPresent()) { // <b class="conum">(1)</b>
        engineProvider.each {it.start() } // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using BeanProvider with Any</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">fun startAll() {
    if (engineProvider.isPresent) { // <b class="conum">(1)</b>
        engineProvider.forEach { it.start() } // <b class="conum">(2)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Check if any beans present</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If so iterate over each one via the <code>stream().forEach(..)</code> method, starting the engines</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="typed"><a class="anchor" href="#typed"></a>3.6 Limiting Injectable Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/typed.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default when you annotate a bean with a scope such as <code>@Singleton</code> the bean class and all interfaces it implements and super classes it extends from become injectable via <code>@Inject</code>.</p>
</div>
<div class="paragraph">
<p>Consider the following example from the previous section on defining beans:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class V8Engine implements Engine {  // <b class="conum">(3)</b>
    @Override
    public String start() {
        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return 8;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class V8Engine implements Engine { // <b class="conum">(3)</b>
    int cylinders = 8

    @Override
    String start() {
        "Starting V8"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class V8Engine : Engine {

    override var cylinders: Int = 8

    override fun start(): String {
        return "Starting V8"
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case other classes in your application can choose to either inject the interface <code>Engine</code> or the concrete implementation <code>V8Engine</code>.</p>
</div>
<div class="paragraph">
<p>If this is undesirable you can use the <code>typed</code> member of the <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> annotation to limit the exposed types. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Bean(typed = Engine.class) // <b class="conum">(1)</b>
public class V8Engine implements Engine {  // <b class="conum">(2)</b>
    @Override
    public String start() {
        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return 8;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
@Bean(typed = Engine) // <b class="conum">(1)</b>
class V8Engine implements Engine {  // <b class="conum">(2)</b>
    @Override
    String start() { "Starting V8" }

    @Override
    int getCylinders() { 8 }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
@Bean(typed = [Engine::class]) // <b class="conum">(1)</b>
class V8Engine : Engine { // <b class="conum">(2)</b>
    override fun start(): String {
        return "Starting V8"
    }

    override val cylinders: Int = 8
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Bean(typed=..)</code> is used to only allow injection the interface <code>Engine</code> and not the concrete type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class must implement the class or interface defined by <code>typed</code> otherwise a compilation error will occur</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following test demonstrates the behaviour of <code>typed</code> using programmatic lookup and the <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@MicronautTest
public class EngineSpec {
    @Inject
    BeanContext beanContext;

    @Test
    public void testEngine() {
        assertThrows(NoSuchBeanException.class, () -&gt;
                beanContext.getBean(V8Engine.class) // <b class="conum">(1)</b>
        );
        final Engine engine = beanContext.getBean(Engine.class); // <b class="conum">(2)</b>
        assertTrue(engine instanceof V8Engine);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class EngineSpec extends Specification {
    @Shared @AutoCleanup
    ApplicationContext beanContext = ApplicationContext.run()

    void 'test engine'() {
        when:'the class is looked up'
        beanContext.getBean(V8Engine) // <b class="conum">(1)</b>

        then:'a no such bean exception is thrown'
        thrown(NoSuchBeanException)

        and:'it is possible to lookup by the typed interface'
        beanContext.getBean(Engine) instanceof V8Engine // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@MicronautTest
class EngineSpec {
    @Inject
    lateinit var beanContext: BeanContext

    @Test
    fun testEngine() {
        assertThrows(NoSuchBeanException::class.java) {
            beanContext.getBean(V8Engine::class.java) // <b class="conum">(1)</b>
        }

        val engine = beanContext.getBean(Engine::class.java) // <b class="conum">(2)</b>
        assertTrue(engine is V8Engine)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Trying to lookup <code>V8Engine</code> throws a <a href="../api/io/micronaut/context/exceptions/NoSuchBeanException.html">NoSuchBeanException</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Whilst looking up the <code>Engine</code> interface succeeds</td>
</tr>
</table>
</div>

<h2 id="scopes"><a class="anchor" href="#scopes"></a>3.7 Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/scopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features an extensible bean scoping mechanism based on JSR-330. The following default scopes are supported:</p>
</div>

<h2 id="builtInScopes"><a class="anchor" href="#builtInScopes"></a>3.7.1 Built-In Scopes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/scopes/builtInScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Micronaut Built-in Scopes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">@Singleton</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Singleton scope indicates only one instance of the bean will exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Context.html">@Context</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context scope indicates that the bean will be created at the same time as the <code>ApplicationContext</code> (eager initialization)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prototype scope indicates that a new instance of the bean is created each time it is injected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Infrastructure.html">@Infrastructure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infrastructure scope represents a bean that cannot be overridden or replaced using <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> because it is critical to the functioning of the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/ThreadLocal.html">@ThreadLocal</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ThreadLocal</code> scope is a custom scope that associates a bean per thread via a ThreadLocal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Refreshable</code> scope is a custom scope that allows a bean&#8217;s state to be refreshed via the <code>/refresh</code> endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/http/scope/RequestScope.html">@RequestScope</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestScope</code> scope is a custom scope that indicates a new instance of the bean is created and associated with each HTTP request</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a> annotation is a synonym for <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> because the default scope is prototype.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additional scopes can be added by defining a <code>@Singleton</code> bean that implements the <a href="../api/io/micronaut/context/scope/CustomScope.html">CustomScope</a> interface.</p>
</div>
<div class="paragraph">
<p>Note that when starting an <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>, by default <code>@Singleton</code>-scoped beans are created lazily and on-demand. This is by design to optimize startup time.</p>
</div>
<div class="paragraph">
<p>If this presents a problem for your use case you have the option of using the <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> annotation which binds the lifecycle of your object to the lifecycle of the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>. In other words when the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is started your bean will be created.</p>
</div>
<div class="paragraph">
<p>Alternatively, annotate any <code>@Singleton</code>-scoped bean with <a href="../api/io/micronaut/context/annotation/Parallel.html">@Parallel</a> which allows parallel initialization of your bean without impacting overall startup time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your bean fails to initialize in parallel, the application will be automatically shut down.
</td>
</tr>
</table>
</div>

<h2 id="eagerInit"><a class="anchor" href="#eagerInit"></a>3.7.1.1 Eager Initialization of Singletons</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/scopes/builtInScopes/eagerInit.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Eager initialization of <code>@Singleton</code> beans maybe desirable in certain scenarios, such as on AWS Lambda where more CPU resources are assigned to Lambda construction than execution.</p>
</div>
<div class="paragraph">
<p>You can specify whether to eagerly initialize <code>@Singleton</code>-scoped beans using the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a> interface:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Eager Initialization of Singletons</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Application {

    public static void main(String[] args) {
        Micronaut.build(args)
            .eagerInitSingletons(true) <i class="conum" data-value="1"></i><b>(1)</b>
            .mainClass(Application.class)
            .start();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting eager init to <code>true</code> initializes all singletons</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you use Micronaut in environments such as <a href="#serverlessFunctions">Serverless Functions</a>, you will not have an Application class and instead you extend a Micronaut-provided class. In those cases, Micronaut provides methods which you can override to enhance the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a></p>
</div>
<div class="listingblock">
<div class="title">Override of newApplicationContextBuilder()</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyFunctionHandler extends MicronautRequestHandler&lt;APIGatewayProxyRequestEvent, APIGatewayProxyResponseEvent&gt; {
...
    @Nonnull
    @Override
    protected ApplicationContextBuilder newApplicationContextBuilder() {
        ApplicationContextBuilder builder = super.newApplicationContextBuilder();
        builder.eagerInitSingletons(true);
        return builder;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="../api/io/micronaut/context/annotation/ConfigurationReader.html">@ConfigurationReader</a> beans such as <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a>  or <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> are singleton beans. To eagerly init configuration but keep other <code>@Singleton</code>-scoped bean creation lazy, use <code>eagerInitConfiguration</code>:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Eager Initialization of Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Application {

    public static void main(String[] args) {
        Micronaut.build(args)
            .eagerInitConfiguration(true) <i class="conum" data-value="1"></i><b>(1)</b>
            .mainClass(Application.class)
            .start();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Setting eager init to true initializes all configuration reader beans.</td>
</tr>
</table>
</div>

<h2 id="refreshable"><a class="anchor" href="#refreshable"></a>3.7.2 Refreshable Scope</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/scopes/refreshable.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">Refreshable</a> scope is a custom scope that allows a bean’s state to be refreshed via:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/refresh</code> endpoint.</p>
</li>
<li>
<p>Publication of a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example illustrates <code>@Refreshable</code> scope behavior.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Refreshable // <b class="conum">(1)</b>
public static class WeatherService {
    private String forecast;

    @PostConstruct
    public void init() {
        forecast = "Scattered Clouds " + new SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(new Date());// <b class="conum">(2)</b>
    }

    public String latestForecast() {
        return forecast;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Refreshable // <b class="conum">(1)</b>
static class WeatherService {

    String forecast

    @PostConstruct
    void init() {
        forecast = "Scattered Clouds ${new SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(new Date())}" // <b class="conum">(2)</b>
    }

    String latestForecast() {
        return forecast
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Refreshable // <b class="conum">(1)</b>
open class WeatherService {
    private var forecast: String? = null

    @PostConstruct
    open fun init() {
        forecast = "Scattered Clouds " + SimpleDateFormat("dd/MMM/yy HH:mm:ss.SSS").format(Date())// <b class="conum">(2)</b>
    }

    open fun latestForecast(): String? {
        return forecast
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>WeatherService</code> is annotated with <code>@Refreshable</code> scope which stores an instance until a refresh event is triggered</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The value of the <code>forecast</code> property is set to a fixed value when the bean is created and won&#8217;t change until the bean is refreshed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you invoke <code>latestForecast()</code> twice, you will see identical responses such as <code>"Scattered Clouds 01/Feb/18 10:29.199"</code>.</p>
</div>
<div class="paragraph">
<p>When the <code>/refresh</code> endpoint is invoked or a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> is published, the instance is invalidated and a new instance is created the next time the object is requested. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">applicationContext.publishEvent(new RefreshEvent());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">applicationContext.publishEvent(new RefreshEvent())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">applicationContext.publishEvent(RefreshEvent())</code></pre>
</div>
</div>

<h2 id="metaScopes"><a class="anchor" href="#metaScopes"></a>3.7.3 Scopes on Meta Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/scopes/metaScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Scopes can be defined on meta annotations that you can then apply to your classes. Consider the following example meta annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Driver.java Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;

import jakarta.inject.Singleton;
import java.lang.annotation.Documented;
import java.lang.annotation.Retention;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Requires(classes = Car.class) // <b class="conum">(1)</b>
@Singleton // <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
public @interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Driver.java Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Requires

import jakarta.inject.Singleton
import java.lang.annotation.Documented
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Requires(classes = Car.class) // <b class="conum">(1)</b>
@Singleton // <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
@interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Driver.java Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import jakarta.inject.Singleton
import kotlin.annotation.AnnotationRetention.RUNTIME

@Requires(classes = [Car::class]) // <b class="conum">(1)</b>
@Singleton // <b class="conum">(2)</b>
@MustBeDocumented
@Retention(RUNTIME)
annotation class Driver</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The scope declares a requirement on a <code>Car</code> class using <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation is declared as <code>@Singleton</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the example above the <code>@Singleton</code> annotation is applied to the <code>@Driver</code> annotation which results in every class that is annotated with <code>@Driver</code> being regarded as singleton.</p>
</div>
<div class="paragraph">
<p>Note that in this case it is not possible to alter the scope when the annotation is applied. For example, the following will not override the scope declared by <code>@Driver</code> and is invalid:</p>
</div>
<div class="listingblock">
<div class="title">Declaring Another Scope</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Driver
@Prototype
class Foo {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the scope to be overridable, instead use the <a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> annotation on <code>@Driver</code> which allows a default scope to be specified if none other is present:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @DefaultScope</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(classes = Car.class)
@DefaultScope(Singleton.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
public @interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Requires(classes = Car.class)
@DefaultScope(Singleton.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
@interface Driver {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Requires(classes = [Car::class])
@DefaultScope(Singleton::class) <i class="conum" data-value="1"></i><b>(1)</b>
@Documented
@Retention(RUNTIME)
annotation class Driver</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/context/annotation/DefaultScope.html">DefaultScope</a> declares the scope to use if none is specified</td>
</tr>
</table>
</div>

<h2 id="factories"><a class="anchor" href="#factories"></a>3.8 Bean Factories</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/factories.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In many cases, you may want to make available as a bean a class that is not part of your codebase such as those provided by third-party libraries. In this case, you cannot annotate the compiled class. Instead, implement a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a>.</p>
</div>
<div class="paragraph">
<p>A factory is a class annotated with the <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> annotation that provides one or more methods annotated with a bean scope annotation. Which annotation you use depends on what scope you want the bean to be in. See the section on <a href="#scopes">bean scopes</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The factory has the default scope singleton and will be destroyed with the context. If you want to dispose the factory after it produces a bean, use @Prototype scope.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The return types of methods annotated with a bean scope annotation are the bean types. This is best illustrated by an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
class CrankShaft {
}

class V8Engine implements Engine {
    private final int cylinders = 8;
    private final CrankShaft crankShaft;

    public V8Engine(CrankShaft crankShaft) {
        this.crankShaft = crankShaft;
    }

    @Override
    public String start() {
        return "Starting V8";
    }
}

@Factory
class EngineFactory {

    @Singleton
    Engine v8Engine(CrankShaft crankShaft) {
        return new V8Engine(crankShaft);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class CrankShaft {
}

class V8Engine implements Engine {
    final int cylinders = 8
    final CrankShaft crankShaft

    V8Engine(CrankShaft crankShaft) {
        this.crankShaft = crankShaft
    }

    @Override
    String start() {
        "Starting V8"
    }
}

@Factory
class EngineFactory {

    @Singleton
    Engine v8Engine(CrankShaft crankShaft) {
        new V8Engine(crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
internal class CrankShaft

internal class V8Engine(private val crankShaft: CrankShaft) : Engine {
    private val cylinders = 8

    override fun start(): String {
        return "Starting V8"
    }
}

@Factory
internal class EngineFactory {

    @Singleton
    fun v8Engine(crankShaft: CrankShaft): Engine {
        return V8Engine(crankShaft)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, a <code>V8Engine</code> is created by the <code>EngineFactory</code> class' <code>v8Engine</code> method. Note that you can inject parameters into the method and they will be resolved as beans. The resulting <code>V8Engine</code> bean will be a singleton.</p>
</div>
<div class="paragraph">
<p>A factory can have multiple methods annotated with bean scope annotations, each one returning a distinct bean type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you take this approach you should not invoke other bean methods internally within the class. Instead, inject the types via parameters.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To allow the resulting bean to participate in the application context shutdown process, annotate the method with <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> and set the <code>preDestroy</code> argument to the name of the method to be called to close the bean.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_beans_from_fields">Beans from Fields</h3>
<div class="paragraph">
<p>With Micronaut 3.0 or above it is also possible to produce beans from fields by declaring the <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> annotation on a field.</p>
</div>
<div class="paragraph">
<p>Whilst generally this approach should be discouraged in favour for factory methods, which provide more flexibility it does simplify testing code. For example with bean fields you can easily produce mocks in your test code:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.*;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import org.junit.jupiter.api.Test;
import jakarta.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class VehicleMockSpec {
    @Requires(beans = VehicleMockSpec.class)
    @Bean @Replaces(Engine.class)
    Engine mockEngine = () -&gt; "Mock Started"; // <b class="conum">(1)</b>

    @Inject Vehicle vehicle; // <b class="conum">(2)</b>

    @Test
    void testStartEngine() {
        final String result = vehicle.start();
        assertEquals("Mock Started", result); // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.*
import io.micronaut.test.extensions.spock.annotation.MicronautTest
import spock.lang.Specification
import jakarta.inject.Inject

@MicronautTest
class VehicleMockSpec extends Specification {
    @Requires(beans=VehicleMockSpec.class)
    @Bean @Replaces(Engine.class)
    Engine mockEngine = {-&gt; "Mock Started" } as Engine  // <b class="conum">(1)</b>

    @Inject Vehicle vehicle // <b class="conum">(2)</b>

    void "test start engine"() {
        given:
        final String result = vehicle.start()

        expect:
        result == "Mock Started" // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Replaces
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions
import org.junit.jupiter.api.Test
import jakarta.inject.Inject

@MicronautTest
class VehicleMockSpec {
    @get:Bean
    @get:Replaces(Engine::class)
    val mockEngine: Engine = object : Engine { // <b class="conum">(1)</b>
        override fun start(): String {
            return "Mock Started"
        }
    }

    @Inject
    lateinit var vehicle : Vehicle // <b class="conum">(2)</b>

    @Test
    fun testStartEngine() {
        val result = vehicle.start()
        Assertions.assertEquals("Mock Started", result) // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A bean is defined from a field that replaces the existing <code>Engine</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>Vehicle</code> is injected.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The code asserts that the mock implementation is called.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that only public or package protected fields are supported on non-primitive types. If the field is <code>static</code>, <code>private</code>, or <code>protected</code> a compilation error will occur.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the bean method/field includes a scope or a qualifier any scope or qualifiers from the type will be omitted.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Qualifiers from the factory instance aren&#8217;t inherited to the beans.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_primitive_beans_and_arrays">Primitive Beans and Arrays</h4>
<div class="paragraph">
<p>Since Micronaut 3.1 it is possible to define and inject primitive types and array types from factories.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Bean;
import io.micronaut.context.annotation.Factory;
import jakarta.inject.Named;

@Factory
class CylinderFactory {
    @Bean
    @Named("V8") // <b class="conum">(1)</b>
    final int v8 = 8;

    @Bean
    @Named("V6") // <b class="conum">(1)</b>
    final int v6 = 6;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Factory
import jakarta.inject.Named

@Factory
class CylinderFactory {
    @Bean
    @Named("V8") // <b class="conum">(1)</b>
    final int v8 = 8

    @Bean
    @Named("V6") // <b class="conum">(1)</b>
    final int v6 = 6
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Factory
import jakarta.inject.Named

@Factory
class CylinderFactory {
    @get:Bean
    @get:Named("V8") // <b class="conum">(1)</b>
    val v8 = 8

    @get:Bean
    @get:Named("V6") // <b class="conum">(1)</b>
    val v6 = 6
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Two primitive integer beans are defined with different names</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Primitive beans can be injected like any other bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Named;
import jakarta.inject.Singleton;

@Singleton
public class V8Engine {
    private final int cylinders;

    public V8Engine(@Named("V8") int cylinders) { // <b class="conum">(1)</b>
        this.cylinders = cylinders;
    }

    public int getCylinders() {
        return cylinders;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Named
import jakarta.inject.Singleton

@Singleton
class V8Engine {
    private final int cylinders

    V8Engine(@Named("V8") int cylinders) { // <b class="conum">(1)</b>
        this.cylinders = cylinders
    }

    int getCylinders() {
        return cylinders
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Named
import jakarta.inject.Singleton

@Singleton
class V8Engine(
    @param:Named("V8") val cylinders: Int // <b class="conum">(1)</b>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that primitive beans and primitive array beans have the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#aop">AOP advice</a> cannot be applied to primitives or wrapper types</p>
</li>
<li>
<p>Due to the above custom scopes that proxy are not supported</p>
</li>
<li>
<p>The <code>@Bean(preDestroy=..)</code> member is not supported</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_programmatically_disabling_beans">Programmatically Disabling Beans</h3>
<div class="paragraph">
<p>Factory methods can throw <a href="../api/io/micronaut/context/exceptions/DisabledBeanException.html">DisabledBeanException</a> to conditionally disable beans. Using <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> should always be the preferred method to conditionally create beans; throwing an exception in a factory method should only be done if using <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> is not possible.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Engine {
    Integer getCylinders();
}

@EachProperty("engines")
public class EngineConfiguration implements Toggleable {

    private boolean enabled = true;
    private Integer cylinders;

    @NotNull
    public Integer getCylinders() {
        return cylinders;
    }

    public void setCylinders(Integer cylinders) {
        this.cylinders = cylinders;
    }

    @Override
    public boolean isEnabled() {
        return enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }

}

@Factory
public class EngineFactory {

    @EachBean(EngineConfiguration.class)
    public Engine buildEngine(EngineConfiguration engineConfiguration) {
        if (engineConfiguration.isEnabled()) {
            return engineConfiguration::getCylinders;
        } else {
            throw new DisabledBeanException("Engine configuration disabled");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">interface Engine {
    Integer getCylinders()
}

@EachProperty("engines")
class EngineConfiguration implements Toggleable {
    boolean enabled = true
    @NotNull
    Integer cylinders
}

@Factory
class EngineFactory {

    @EachBean(EngineConfiguration)
    Engine buildEngine(EngineConfiguration engineConfiguration) {
        if (engineConfiguration.enabled) {
            (Engine){ -&gt; engineConfiguration.cylinders }
        } else {
            throw new DisabledBeanException("Engine configuration disabled")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">interface Engine {
    fun getCylinders(): Int
}

@EachProperty("engines")
class EngineConfiguration : Toggleable {

    var enabled = true

    @NotNull
    val cylinders: Int? = null

    override fun isEnabled(): Boolean {
        return enabled
    }
}

@Factory
class EngineFactory {

    @EachBean(EngineConfiguration::class)
    fun buildEngine(engineConfiguration: EngineConfiguration): Engine? {
        return if (engineConfiguration.isEnabled) {
            object : Engine {
                override fun getCylinders(): Int {
                    return engineConfiguration.cylinders!!
                }
            }
        } else {
            throw DisabledBeanException("Engine configuration disabled")
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_injection_point">Injection Point</h3>
<div class="paragraph">
<p>A common use case with factories is to take advantage of annotation metadata from the point at which an object is injected such that behaviour can be modified based on said metadata.</p>
</div>
<div class="paragraph">
<p>Consider an annotation such as the following:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Documented
@Retention(RUNTIME)
@Target(ElementType.PARAMETER)
public @interface Cylinders {
    int value() default 8;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Documented
@Retention(RUNTIME)
@Target(ElementType.PARAMETER)
@interface Cylinders {
    int value() default 8
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@MustBeDocumented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.VALUE_PARAMETER)
annotation class Cylinders(val value: Int = 8)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above annotation could be used to customize the type of engine we want to inject into a vehicle at the point at which the injection point is defined:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
class Vehicle {

    private final Engine engine;

    Vehicle(@Cylinders(6) Engine engine) {
        this.engine = engine;
    }

    String start() {
        return engine.start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class Vehicle {

    private final Engine engine

    Vehicle(@Cylinders(6) Engine engine) {
        this.engine = engine
    }

    String start() {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
internal class Vehicle(@param:Cylinders(6) private val engine: Engine) {
    fun start(): String {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>Vehicle</code> class specifies an annotation value of <code>@Cylinders(6)</code> indicating an <code>Engine</code> of six cylinders is required.</p>
</div>
<div class="paragraph">
<p>To implement this use case, define a factory that accepts the <a href="../api/io/micronaut/inject/InjectionPoint.html">InjectionPoint</a> instance to analyze the defined annotation values:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory
class EngineFactory {

    @Prototype
    Engine v8Engine(InjectionPoint&lt;?&gt; injectionPoint, CrankShaft crankShaft) { // <b class="conum">(1)</b>
        final int cylinders = injectionPoint
                .getAnnotationMetadata()
                .intValue(Cylinders.class).orElse(8); // <b class="conum">(2)</b>
        switch (cylinders) { // <b class="conum">(3)</b>
            case 6:
                return new V6Engine(crankShaft);
            case 8:
                return new V8Engine(crankShaft);
            default:
                throw new IllegalArgumentException("Unsupported number of cylinders specified: " + cylinders);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Factory
class EngineFactory {

    @Prototype
    Engine v8Engine(InjectionPoint&lt;?&gt; injectionPoint, CrankShaft crankShaft) { // <b class="conum">(1)</b>
        final int cylinders = injectionPoint
                .getAnnotationMetadata()
                .intValue(Cylinders.class).orElse(8) // <b class="conum">(2)</b>
        switch (cylinders) { // <b class="conum">(3)</b>
            case 6:
                return new V6Engine(crankShaft)
            case 8:
                return new V8Engine(crankShaft)
            default:
                throw new IllegalArgumentException("Unsupported number of cylinders specified: $cylinders")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Factory
internal class EngineFactory {

    @Prototype
    fun v8Engine(injectionPoint: InjectionPoint&lt;*&gt;, crankShaft: CrankShaft): Engine { // <b class="conum">(1)</b>
        val cylinders = injectionPoint
                .annotationMetadata
                .intValue(Cylinders::class.java).orElse(8) // <b class="conum">(2)</b>
        return when (cylinders) { // <b class="conum">(3)</b>
            6 -&gt; V6Engine(crankShaft)
            8 -&gt; V8Engine(crankShaft)
            else -&gt; throw IllegalArgumentException("Unsupported number of cylinders specified: $cylinders")
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The factory method defines a parameter of type <a href="../api/io/micronaut/inject/InjectionPoint.html">InjectionPoint</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation metadata is used to obtain the value of the <code>@Cylinder</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The value is used to construct an engine, throwing an exception if an engine cannot be constructed.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to note that the factory is declared as <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a> scope so the method is invoked for each injection point. If the <code>V8Engine</code> and <code>V6Engine</code> types are required to be singletons, the factory should use a Map to ensure the objects are only constructed once.
</td>
</tr>
</table>
</div>
</div>

<h2 id="conditionalBeans"><a class="anchor" href="#conditionalBeans"></a>3.9 Conditional Beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/conditionalBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>At times you may want a bean to load conditionally based on various potential factors including the classpath, the configuration, the presence of other beans, etc.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation provides the ability to define one or many conditions on a bean.</p>
</div>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public class JdbcBookService implements BookService {

    DataSource dataSource;

    public JdbcBookService(DataSource dataSource) {
        this.dataSource = dataSource;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
@Requires(beans = DataSource)
@Requires(property = "datasource.url")
class JdbcBookService implements BookService {

    DataSource dataSource</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Requires</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
class JdbcBookService(internal var dataSource: DataSource) : BookService {</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above bean defines two requirements. The first indicates that a <code>DataSource</code> bean must be present for the bean to load. The second requirement ensures that the <code>datasource.url</code> property is set before loading the <code>JdbcBookService</code> bean.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Kotlin currently does not support repeatable annotations. Use the <code>@Requirements</code> annotation when multiple requires are needed. For example, <code>@Requirements(Requires(&#8230;&#8203;), Requires(&#8230;&#8203;))</code>. See <a href="https://youtrack.jetbrains.com/issue/KT-12794" class="bare">https://youtrack.jetbrains.com/issue/KT-12794</a> to track this feature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If multiple beans require the same combination of requirements, you can define a meta-annotation with the requirements:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.PACKAGE, ElementType.TYPE})
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public @interface RequiresJdbc {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.PACKAGE, ElementType.TYPE])
@Requires(beans = DataSource)
@Requires(property = "datasource.url")
@interface RequiresJdbc {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a @Requires meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Documented
@Retention(AnnotationRetention.RUNTIME)
@Target(AnnotationTarget.CLASS, AnnotationTarget.FILE)
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
annotation class RequiresJdbc</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the <code>RequiresJdbc</code> annotation can be used on the <code>JdbcBookService</code> instead:</p>
</div>
<div class="listingblock">
<div class="title">Using a meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequiresJdbc
public class JdbcBookService implements BookService {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have multiple beans that need to fulfill a given requirement before loading, you may want to consider a bean configuration group, as explained in the next section.</p>
</div>
<div class="sect1">
<h2 id="_configuration_requirements">Configuration Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> annotation is very flexible and can be used for a variety of use cases. The following table summarizes some possibilities:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Using @Requires</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Requirement</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one or more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(classes=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one or more classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missing=javax.servlet.Servlet)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(beans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of one or more beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingBeans=javax.sql.DataSource)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the environment to not be applied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(notEnv="test")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(configuration="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the absence of another configuration package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingConfigurations="foo.bar")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require particular SDK version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(sdk=Sdk.JAVA, value="1.8")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires classes annotated with the given annotations to be available to the application via package scanning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(entities=javax.persistence.Entity)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property with an optional value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(property="data-source.url")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require a property to not be part of the configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(missingProperty="data-source.url")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one or more files in the file system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(resources="file:/path/to/file")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the presence of one or more classpath resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(resources="classpath:myFile.properties")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the current operating system to be in the list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(os={Requires.Family.WINDOWS})</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require the current operating system to <strong>not</strong> be in the list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(notOs={Requires.Family.WINDOWS})</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires bean to be present in case no beanProperty specified</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(bean=Config.class)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Requires the specified property of bean to be present</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(bean=Config.class, beanProperty="enabled")</code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_additional_notes_on_property_requirements">Additional Notes on Property Requirements.</h3>
<div class="paragraph">
<p>Adding a requirement on a property has some additional functionality. You can require the property to be a certain value, not be a certain value, and use a default in those checks if it is not set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(property="foo") <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(property="foo", value="John") <i class="conum" data-value="2"></i><b>(2)</b>
@Requires(property="foo", value="John", defaultValue="John") <i class="conum" data-value="3"></i><b>(3)</b>
@Requires(property="foo", notEquals="Sally") <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Requires the property to be set</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Requires the property to be "John"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Requires the property to be "John" or not set</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Requires the property to not be "Sally" or not set</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_referencing_bean_properties_in_requires">Referencing bean properties in @Requires.</h3>
<div class="paragraph">
<p>You can also reference other beans properties in <code>@Requires</code> to conditionally load beans. Similar to <code>property</code> requirements, you can specify required <code>value</code> or set the value bean property should no be equal to using <code>notEquals</code> annotation member. For the bean property to be checked, the bean of type specified in <code>bean</code> annotation member should be present within context, otherwise conditional bean will not be loaded.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Requires(bean=Config.class, beanProperty="foo") <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(bean=Config.class, beanProperty="foo", value="John") <i class="conum" data-value="2"></i><b>(2)</b>
@Requires(bean=Config.class, beanProperty="foo", notEquals="Sally") <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Requires the "foo" property on <code>Config</code> bean to be set</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Requires the "foo" property on <code>Config</code> bean to be "John"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Requires the "foo" property on <code>Config</code> bean to not be "Sally" or not set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Specified bean property is accessed through respective getter method whose presence and availability will be checked at compilation time.</p>
</div>
<div class="paragraph">
<p>Note that bean property is considered to be present in case it&#8217;s value is not null. Keep in mind that primitive properties are initialized with default values such as <code>false</code> for boolean and <code>0</code> for int, so they are considered to be set even if no value is explicitly specified for them.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_conditional_beans">Debugging Conditional Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have multiple conditions and complex requirements it may become difficult to understand why a particular bean has not been loaded.</p>
</div>
<div class="paragraph">
<p>To help resolve issues with conditional beans you can enable debug logging for the <code>io.micronaut.context.condition</code> package which will log the reasons why beans were not loaded.</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="io.micronaut.context.condition" level="DEBUG"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the logging chapter for details <a href="#logging">howto setup logging</a>.</p>
</div>
</div>
</div>

<h2 id="replaces"><a class="anchor" href="#replaces"></a>3.10 Bean Replacement</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/replaces.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>One significant difference between Micronaut&#8217;s Dependency Injection system and Spring&#8217;s is the way beans are replaced.</p>
</div>
<div class="paragraph">
<p>In a Spring application, beans have names and are overridden by creating a bean with the same name, regardless of the type of the bean. Spring also has the notion of bean registration order, hence in Spring Boot you have <code>@AutoConfigureBefore</code> and <code>@AutoConfigureAfter</code> annotations that control how beans override each other.</p>
</div>
<div class="paragraph">
<p>This strategy leads to problems that are difficult to debug, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bean loading order changes, leading to unexpected results</p>
</li>
<li>
<p>A bean with the same name overrides another bean with a different type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid these problems, Micronaut&#8217;s DI has no concept of bean names or load order. Beans have a type and a <a href="../api/io/micronaut/context/Qualifier.html">Qualifier</a>. You cannot override a bean of a completely different type with another.</p>
</div>
<div class="paragraph">
<p>A useful benefit of Spring&#8217;s approach is that it allows overriding existing beans to customize behaviour. To support the same ability, Micronaut&#8217;s DI provides an explicit <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation, which integrates nicely with support for <a href="#conditionalBeans">Conditional Beans</a> and clearly documents and expresses the intention of the developer.</p>
</div>
<div class="paragraph">
<p>Any existing bean can be replaced by another bean that declares <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a>. For example, consider the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Requires(beans = DataSource.class)
@Requires(property = "datasource.url")
public class JdbcBookService implements BookService {

    DataSource dataSource;

    public JdbcBookService(DataSource dataSource) {
        this.dataSource = dataSource;
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
@Requires(beans = DataSource)
@Requires(property = "datasource.url")
class JdbcBookService implements BookService {

    DataSource dataSource</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">JdbcBookService</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
@Requirements(Requires(beans = [DataSource::class]), Requires(property = "datasource.url"))
class JdbcBookService(internal var dataSource: DataSource) : BookService {</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a class in <code>src/test/java</code> that replaces this class just for your tests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Replaces(JdbcBookService.class) // <b class="conum">(1)</b>
@Singleton
public class MockBookService implements BookService {

    Map&lt;String, Book&gt; bookMap = new LinkedHashMap&lt;&gt;();

    @Override
    public Book findBook(String title) {
        return bookMap.get(title);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Replaces(JdbcBookService.class) // <b class="conum">(1)</b>
@Singleton
class MockBookService implements BookService {

    Map&lt;String, Book&gt; bookMap = [:]

    @Override
    Book findBook(String title) {
        bookMap.get(title)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Replaces</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Replaces(JdbcBookService::class) // <b class="conum">(1)</b>
@Singleton
class MockBookService : BookService {

    var bookMap: Map&lt;String, Book&gt; = LinkedHashMap()

    override fun findBook(title: String): Book? {
        return bookMap[title]
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>MockBookService</code> declares that it replaces <code>JdbcBookService</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_factory_replacement">Factory Replacement</h3>
<div class="paragraph">
<p>The <code>@Replaces</code> annotation also supports a <code>factory</code> argument. That argument allows the replacement of factory beans in their entirety or specific types created by the factory.</p>
</div>
<div class="paragraph">
<p>For example, it may be desired to replace all or part of the given factory class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory
public class BookFactory {

    @Singleton
    Book novel() {
        return new Book("A Great Novel");
    }

    @Singleton
    TextBook textBook() {
        return new TextBook("Learning 101");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Factory
class BookFactory {

    @Singleton
    Book novel() {
        new Book('A Great Novel')
    }

    @Singleton
    TextBook textBook() {
        new TextBook('Learning 101')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">BookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Factory
class BookFactory {

    @Singleton
    internal fun novel(): Book {
        return Book("A Great Novel")
    }

    @Singleton
    internal fun textBook(): TextBook {
        return TextBook("Learning 101")
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
To replace a factory entirely, your factory methods must match the return types of all methods in the replaced factory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, <code>BookFactory#textBook()</code> is <strong>not</strong> replaced because this factory does not have a factory method that returns a <code>TextBook</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory
@Replaces(factory = BookFactory.class)
public class CustomBookFactory {

    @Singleton
    Book otherNovel() {
        return new Book("An OK Novel");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Factory
@Replaces(factory = BookFactory)
class CustomBookFactory {

    @Singleton
    Book otherNovel() {
        new Book('An OK Novel')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CustomBookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Factory
@Replaces(factory = BookFactory::class)
class CustomBookFactory {

    @Singleton
    internal fun otherNovel(): Book {
        return Book("An OK Novel")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To replace one or more factory methods but retain the rest, apply the <code>@Replaces</code> annotation on the method(s) and denote the factory to apply to.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory
public class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook.class, factory = BookFactory.class)
    TextBook textBook() {
        return new TextBook("Learning 305");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Factory
class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook, factory = BookFactory)
    TextBook textBook() {
        new TextBook('Learning 305')
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">TextBookFactory</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Factory
class TextBookFactory {

    @Singleton
    @Replaces(value = TextBook::class, factory = BookFactory::class)
    internal fun textBook(): TextBook {
        return TextBook("Learning 305")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BookFactory#novel()</code> method will not be replaced because the TextBook class is defined in the annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_implementation">Default Implementation</h3>
<div class="paragraph">
<p>When exposing an API, it may be desirable to not expose the default implementation of an interface as part of the public API. Doing so prevents users from being able to replace the implementation because they will not be able to reference the class. The solution is to annotate the interface with <a href="../api/io/micronaut/context/annotation/DefaultImplementation.html">DefaultImplementation</a> to indicate which implementation to replace if a user creates a bean that <code>@Replaces(YourInterface.class)</code>.</p>
</div>
<div class="paragraph">
<p>For example consider:</p>
</div>
<div class="paragraph">
<p>A public API contract</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.DefaultImplementation;

@DefaultImplementation(DefaultResponseStrategy.class)
public interface ResponseStrategy {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.DefaultImplementation

@DefaultImplementation(DefaultResponseStrategy)
interface ResponseStrategy {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.DefaultImplementation

@DefaultImplementation(DefaultResponseStrategy::class)
interface ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default implementation</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Singleton;

@Singleton
class DefaultResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Singleton

@Singleton
class DefaultResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Singleton

@Singleton
internal class DefaultResponseStrategy : ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom implementation</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Replaces;
import jakarta.inject.Singleton;

@Singleton
@Replaces(ResponseStrategy.class)
public class CustomResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Replaces
import jakarta.inject.Singleton

@Singleton
@Replaces(ResponseStrategy)
class CustomResponseStrategy implements ResponseStrategy {

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Replaces
import jakarta.inject.Singleton

@Singleton
@Replaces(ResponseStrategy::class)
class CustomResponseStrategy : ResponseStrategy</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the <code>CustomResponseStrategy</code> replaces the <code>DefaultResponseStrategy</code> because the <a href="../api/io/micronaut/context/annotation/DefaultImplementation.html">DefaultImplementation</a> annotation points to the <code>DefaultResponseStrategy</code>.</p>
</div>
</div>

<h2 id="beanConfigurations"><a class="anchor" href="#beanConfigurations"></a>3.11 Bean Configurations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/beanConfigurations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A bean <a href="../api/io/micronaut/context/annotation/Configuration.html">@Configuration</a> is a grouping of multiple bean definitions within a package.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is applied at the package level and informs Micronaut that the beans defined with the package form a logical grouping.</p>
</div>
<div class="paragraph">
<p>The <code>@Configuration</code> annotation is typically applied to <code>package-info</code> classes. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Configuration
package my.package

import io.micronaut.context.annotation.Configuration</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where this grouping becomes useful is when the bean configuration is made conditional via the <code>@Requires</code> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">package-info.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Configuration
@Requires(beans = javax.sql.DataSource)
package my.package</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, all bean definitions within the annotated package are only loaded and made available if a <code>javax.sql.DataSource</code> bean is present. This lets you implement conditional auto-configuration of bean definitions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java and Kotlin also support this functionality via <code>package-info.java</code>. Kotlin does not support a <code>package-info.kt</code> as of version 1.3.
</td>
</tr>
</table>
</div>

<h2 id="lifecycle"><a class="anchor" href="#lifecycle"></a>3.12 Life-Cycle Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/lifecycle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_when_the_bean_is_constructed">When The Bean Is Constructed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To invoke a method when the bean is constructed, use the <code>jakarta.annotation.PostConstruct</code> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.annotation.PostConstruct; // <b class="conum">(1)</b>
import jakarta.inject.Singleton;

@Singleton
public class V8Engine implements Engine {

    private int cylinders = 8;
    private boolean initialized = false; // <b class="conum">(2)</b>

    @Override
    public String start() {
        if (!initialized) {
            throw new IllegalStateException("Engine not initialized!");
        }

        return "Starting V8";
    }

    @Override
    public int getCylinders() {
        return cylinders;
    }

    public boolean isInitialized() {
        return initialized;
    }

    @PostConstruct // <b class="conum">(3)</b>
    public void initialize() {
        initialized = true;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.annotation.PostConstruct // <b class="conum">(1)</b>
import jakarta.inject.Singleton

@Singleton
class V8Engine implements Engine {

    int cylinders = 8
    boolean initialized = false // <b class="conum">(2)</b>

    @Override
    String start() {
        if (!initialized) {
            throw new IllegalStateException("Engine not initialized!")
        }

        return "Starting V8"
    }

    @PostConstruct // <b class="conum">(3)</b>
    void initialize() {
        initialized = true
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.annotation.PostConstruct
import jakarta.inject.Singleton

@Singleton
class V8Engine : Engine {

    override val cylinders = 8

    var initialized = false
        private set // <b class="conum">(2)</b>

    override fun start(): String {
        check(initialized) { "Engine not initialized!" }

        return "Starting V8"
    }

    @PostConstruct // <b class="conum">(3)</b>
    fun initialize() {
        initialized = true
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PostConstruct</code> annotation is imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A field is defined that requires initialization</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A method is annotated with <code>@PostConstruct</code> and will be invoked once the object is constructed and fully injected.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To manage when a bean is constructed, see the section on <a href="#scopes">bean scopes</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_when_the_bean_is_destroyed">When The Bean Is Destroyed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To invoke a method when the bean is destroyed, use the <code>jakarta.annotation.PreDestroy</code> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.annotation.PreDestroy; // <b class="conum">(1)</b>
import jakarta.inject.Singleton;
import java.util.concurrent.atomic.AtomicBoolean;

@Singleton
public class PreDestroyBean implements AutoCloseable {

    AtomicBoolean stopped = new AtomicBoolean(false);

    @PreDestroy // <b class="conum">(2)</b>
    @Override
    public void close() throws Exception {
        stopped.compareAndSet(false, true);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.annotation.PreDestroy // <b class="conum">(1)</b>
import jakarta.inject.Singleton
import java.util.concurrent.atomic.AtomicBoolean

@Singleton
class PreDestroyBean implements AutoCloseable {

    AtomicBoolean stopped = new AtomicBoolean(false)

    @PreDestroy // <b class="conum">(2)</b>
    @Override
    void close() throws Exception {
        stopped.compareAndSet(false, true)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.annotation.PreDestroy // <b class="conum">(1)</b>
import jakarta.inject.Singleton
import java.util.concurrent.atomic.AtomicBoolean

@Singleton
class PreDestroyBean : AutoCloseable {

    internal var stopped = AtomicBoolean(false)

    @PreDestroy // <b class="conum">(2)</b>
    @Throws(Exception::class)
    override fun close() {
        stopped.compareAndSet(false, true)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>PreDestroy</code> annotation is imported</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A method is annotated with <code>@PreDestroy</code> and will be invoked when the context is closed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For factory beans, the <code>preDestroy</code> value in the <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation tells Micronaut which method to invoke.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Bean;
import io.micronaut.context.annotation.Factory;

import jakarta.inject.Singleton;

@Factory
public class ConnectionFactory {

    @Bean(preDestroy = "stop") // <b class="conum">(1)</b>
    @Singleton
    public Connection connection() {
        return new Connection();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Factory

import jakarta.inject.Singleton

@Factory
class ConnectionFactory {

    @Bean(preDestroy = "stop") // <b class="conum">(1)</b>
    @Singleton
    Connection connection() {
        new Connection()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Factory

import jakarta.inject.Singleton

@Factory
class ConnectionFactory {

    @Bean(preDestroy = "stop") // <b class="conum">(1)</b>
    @Singleton
    fun connection(): Connection {
        return Connection()
    }
}</code></pre>
</div>
</div>
<hr>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.concurrent.atomic.AtomicBoolean;

public class Connection {

    AtomicBoolean stopped = new AtomicBoolean(false);

    public void stop() { // <b class="conum">(2)</b>
        stopped.compareAndSet(false, true);
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import java.util.concurrent.atomic.AtomicBoolean

class Connection {

    AtomicBoolean stopped = new AtomicBoolean(false)

    void stop() { // <b class="conum">(2)</b>
        stopped.compareAndSet(false, true)
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import java.util.concurrent.atomic.AtomicBoolean

class Connection {

    internal var stopped = AtomicBoolean(false)

    fun stop() { // <b class="conum">(2)</b>
        stopped.compareAndSet(false, true)
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>preDestroy</code> value is set on the annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The annotation value matches the method name</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Simply implementing the <code>Closeable</code> or <code>AutoCloseable</code> interface is not enough for a bean to be closed with the context. One of the above methods must be used.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependent_beans">Dependent Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dependent beans are the beans used in the construction of your bean.
If the dependent bean&#8217;s scope is <code>@Prototype</code> or unknown, it will be destroyed along with your instance.</p>
</div>
</div>
</div>

<h2 id="contextEvents"><a class="anchor" href="#contextEvents"></a>3.13 Context Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/contextEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports a general event system through the context. The <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> API publishes events and the <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> API is used to listen to events. The event system is not limited to events that Micronaut publishes and supports custom events created by users.</p>
</div>
<div class="sect2">
<h3 id="_publishing_events">Publishing Events</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> API supports events of any type, although all events that Micronaut publishes extend <a href="../api/io/micronaut/context/event/ApplicationEvent.html">ApplicationEvent</a>.</p>
</div>
<div class="paragraph">
<p>To publish an event, use dependency injection to obtain an instance of <a href="../api/io/micronaut/context/event/ApplicationEventPublisher.html">ApplicationEventPublisher</a> where the generic type is the type of event and invoke the <code>publishEvent</code> method with your event object.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">"Publishing an Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SampleEvent {
    private String message = "Something happened";

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }
}

import io.micronaut.context.event.ApplicationEventPublisher;
import jakarta.inject.Inject;
import jakarta.inject.Singleton;

@Singleton
public class SampleEventEmitterBean {

    @Inject
    ApplicationEventPublisher&lt;SampleEvent&gt; eventPublisher;

    public void publishSampleEvent() {
        eventPublisher.publishEvent(new SampleEvent());
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">"Publishing an Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class SampleEvent {
    String message = "Something happened"
}

import io.micronaut.context.event.ApplicationEventPublisher
import jakarta.inject.Inject
import jakarta.inject.Singleton

@Singleton
class SampleEventEmitterBean {

    @Inject
    ApplicationEventPublisher&lt;SampleEvent&gt; eventPublisher

    void publishSampleEvent() {
        eventPublisher.publishEvent(new SampleEvent())
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">"Publishing an Event</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">data class SampleEvent(val message: String = "Something happened")

import io.micronaut.context.event.ApplicationEventPublisher
import jakarta.inject.Inject
import jakarta.inject.Singleton

@Singleton
class SampleEventEmitterBean {

    @Inject
    internal var eventPublisher: ApplicationEventPublisher&lt;SampleEvent&gt;? = null

    fun publishSampleEvent() {
        eventPublisher!!.publishEvent(SampleEvent())
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Publishing an event is <strong>synchronous</strong> by default! The <code>publishEvent</code> method will not return until all listeners have been executed. Move this work off to a thread pool if it is time-intensive.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_listening_for_events">Listening for Events</h3>
<div class="paragraph">
<p>To listen to an event, register a bean that implements <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> where the generic type is the type of event.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.event.ApplicationEventListener;
import io.micronaut.docs.context.events.SampleEvent;
import jakarta.inject.Singleton;

@Singleton
public class SampleEventListener implements ApplicationEventListener&lt;SampleEvent&gt; {
    private int invocationCounter = 0;

    @Override
    public void onApplicationEvent(SampleEvent event) {
        invocationCounter++;
    }

    public int getInvocationCounter() {
        return invocationCounter;
    }
}

import io.micronaut.context.ApplicationContext;
import io.micronaut.docs.context.events.SampleEventEmitterBean;
import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class SampleEventListenerSpec {

    @Test
    public void testEventListenerIsNotified() {
        try (ApplicationContext context = ApplicationContext.run()) {
            SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean.class);
            SampleEventListener listener = context.getBean(SampleEventListener.class);
            assertEquals(0, listener.getInvocationCounter());
            emitter.publishSampleEvent();
            assertEquals(1, listener.getInvocationCounter());
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.event.ApplicationEventListener
import io.micronaut.docs.context.events.SampleEvent
import jakarta.inject.Singleton

@Singleton
class SampleEventListener implements ApplicationEventListener&lt;SampleEvent&gt; {
    int invocationCounter = 0

    @Override
    void onApplicationEvent(SampleEvent event) {
        invocationCounter++
    }
}

import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import spock.lang.Specification

class SampleEventListenerSpec extends Specification {

    void "test event listener is notified"() {
        given:
        ApplicationContext context = ApplicationContext.run()
        SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean)
        SampleEventListener listener = context.getBean(SampleEventListener)

        expect:
        listener.invocationCounter == 0

        when:
        emitter.publishSampleEvent()

        then:
        listener.invocationCounter == 1

        cleanup:
        context.close()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>ApplicationEventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.event.ApplicationEventListener
import io.micronaut.docs.context.events.SampleEvent
import jakarta.inject.Singleton

@Singleton
class SampleEventListener : ApplicationEventListener&lt;SampleEvent&gt; {
    var invocationCounter = 0

    override fun onApplicationEvent(event: SampleEvent) {
        invocationCounter++
    }
}

import io.kotest.matchers.shouldBe
import io.kotest.core.spec.style.AnnotationSpec
import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean

class SampleEventListenerSpec : AnnotationSpec() {

    @Test
    fun testEventListenerWasNotified() {
        val context = ApplicationContext.run()
        val emitter = context.getBean(SampleEventEmitterBean::class.java)
        val listener = context.getBean(SampleEventListener::class.java)
        listener.invocationCounter.shouldBe(0)
        emitter.publishSampleEvent()
        listener.invocationCounter.shouldBe(1)

        context.close()
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/context/event/ApplicationEventListener.html#supports-E-">supports</a> method can be overridden to further clarify events to be processed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, use the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation if you do not wish to implement an interface or utilize one of the built-in events like <a href="../api/io/micronaut/context/event/StartupEvent.html">StartupEvent</a> and <a href="../api/io/micronaut/context/event/ShutdownEvent.html">ShutdownEvent</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.docs.context.events.SampleEvent;
import io.micronaut.context.event.StartupEvent;
import io.micronaut.context.event.ShutdownEvent;
import io.micronaut.runtime.event.annotation.EventListener;

@Singleton
public class SampleEventListener {
    private int invocationCounter = 0;

    @EventListener
    public void onSampleEvent(SampleEvent event) {
        invocationCounter++;
    }

    @EventListener
    public void onStartupEvent(StartupEvent event) {
        // startup logic here
    }

    @EventListener
    public void onShutdownEvent(ShutdownEvent event) {
        // shutdown logic here
    }

    public int getInvocationCounter() {
        return invocationCounter;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.context.event.StartupEvent
import io.micronaut.context.event.ShutdownEvent
import io.micronaut.runtime.event.annotation.EventListener

@Singleton
class SampleEventListener {
    int invocationCounter = 0

    @EventListener
    void onSampleEvent(SampleEvent event) {
        invocationCounter++
    }

    @EventListener
    void onStartupEvent(StartupEvent event) {
        // startup logic here
    }

    @EventListener
    void onShutdownEvent(ShutdownEvent event) {
        // shutdown logic here
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.context.event.StartupEvent
import io.micronaut.context.event.ShutdownEvent
import io.micronaut.runtime.event.annotation.EventListener

@Singleton
class SampleEventListener {
    var invocationCounter = 0

    @EventListener
    internal fun onSampleEvent(event: SampleEvent) {
        invocationCounter++
    }

    @EventListener
    internal fun onStartupEvent(event: StartupEvent) {
        // startup logic here
    }

    @EventListener
    internal fun onShutdownEvent(event: ShutdownEvent) {
        // shutdown logic here
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your listener performs work that might take a while, use the <a href="../api/io/micronaut/scheduling/annotation/Async.html">@Async</a> annotation to run the operation on a separate thread:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.docs.context.events.SampleEvent;
import io.micronaut.runtime.event.annotation.EventListener;
import io.micronaut.scheduling.annotation.Async;

@Singleton
public class SampleEventListener {
    private AtomicInteger invocationCounter = new AtomicInteger(0);

    @EventListener
    @Async
    public void onSampleEvent(SampleEvent event) {
        invocationCounter.getAndIncrement();
    }

    public int getInvocationCounter() {
        return invocationCounter.get();
    }
}

import io.micronaut.context.ApplicationContext;
import io.micronaut.docs.context.events.SampleEventEmitterBean;
import org.junit.Test;

import static java.util.concurrent.TimeUnit.SECONDS;
import static org.awaitility.Awaitility.await;
import static org.hamcrest.Matchers.equalTo;
import static org.junit.Assert.assertEquals;

public class SampleEventListenerSpec {

    @Test
    public void testEventListenerIsNotified() {
        try (ApplicationContext context = ApplicationContext.run()) {
            SampleEventEmitterBean emitter = context.getBean(SampleEventEmitterBean.class);
            SampleEventListener listener = context.getBean(SampleEventListener.class);
            assertEquals(0, listener.getInvocationCounter());
            emitter.publishSampleEvent();
            await().atMost(5, SECONDS).until(listener::getInvocationCounter, equalTo(1));
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener
import io.micronaut.scheduling.annotation.Async

@Singleton
class SampleEventListener {
    AtomicInteger invocationCounter = new AtomicInteger(0)

    @EventListener
    @Async
    void onSampleEvent(SampleEvent event) {
        invocationCounter.getAndIncrement()
    }
}

import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import spock.lang.Specification
import spock.util.concurrent.PollingConditions

class SampleEventListenerSpec extends Specification {

    void "test event listener is notified"() {
        given:
        def context = ApplicationContext.run()
        def emitter = context.getBean(SampleEventEmitterBean)
        def listener = context.getBean(SampleEventListener)

        expect:
        listener.invocationCounter.get() == 0

        when:
        emitter.publishSampleEvent()

        then:
        new PollingConditions(timeout: 5).eventually {
            listener.invocationCounter.get() == 1
        }

        cleanup:
        context.close()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Asynchronously listening for Events with <code>@EventListener</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.docs.context.events.SampleEvent
import io.micronaut.runtime.event.annotation.EventListener
import io.micronaut.scheduling.annotation.Async
import java.util.concurrent.atomic.AtomicInteger

@Singleton
open class SampleEventListener {

    var invocationCounter = AtomicInteger(0)

    @EventListener
    @Async
    open fun onSampleEvent(event: SampleEvent) {
        println("Incrementing invocation counter...")
        invocationCounter.getAndIncrement()
    }
}

import io.kotest.assertions.timing.eventually
import io.kotest.matchers.shouldBe
import io.kotest.core.spec.style.AnnotationSpec
import io.micronaut.context.ApplicationContext
import io.micronaut.docs.context.events.SampleEventEmitterBean
import org.opentest4j.AssertionFailedError
import kotlin.time.DurationUnit
import kotlin.time.ExperimentalTime
import kotlin.time.toDuration

@ExperimentalTime
class SampleEventListenerSpec : AnnotationSpec() {

    @Test
    suspend fun testEventListenerWasNotified() {
        val context = ApplicationContext.run()
        val emitter = context.getBean(SampleEventEmitterBean::class.java)
        val listener = context.getBean(SampleEventListener::class.java)
        listener.invocationCounter.get().shouldBe(0)
        emitter.publishSampleEvent()

        eventually(5.toDuration(DurationUnit.SECONDS), AssertionFailedError::class) {
            println("Current value of counter: " + listener.invocationCounter.get())
            listener.invocationCounter.get().shouldBe(1)
        }

        context.close()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event listener by default runs on the <code>scheduled</code> executor. You can configure this thread pool as required in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Configuring Scheduled Task Thread Pool</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.executors.scheduled.type=scheduled
micronaut.executors.scheduled.core-pool-size=30</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  executors:
    scheduled:
      type: scheduled
      core-pool-size: 30</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.executors]
    [micronaut.executors.scheduled]
      type="scheduled"
      core-pool-size=30</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  executors {
    scheduled {
      type = "scheduled"
      corePoolSize = 30
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    executors {
      scheduled {
        type = "scheduled"
        core-pool-size = 30
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "executors": {
      "scheduled": {
        "type": "scheduled",
        "core-pool-size": 30
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>

<h2 id="events"><a class="anchor" href="#events"></a>3.14 Bean Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/events.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can hook into the creation of beans using one of the following interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/context/event/BeanInitializedEventListener.html">BeanInitializedEventListener</a> - allows modifying or replacing a bean after properties have been set but prior to <code>@PostConstruct</code> event hooks.</p>
</li>
<li>
<p><a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> - allows modifying or replacing a bean after the bean is fully initialized and all <code>@PostConstruct</code> hooks called.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>BeanInitializedEventListener</code> interface is commonly used in combination with <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> beans. Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class V8Engine implements Engine {
    private final int cylinders = 8;
    private double rodLength; // <b class="conum">(1)</b>

    public V8Engine(double rodLength) {
        this.rodLength = rodLength;
    }

    @Override
    public String start() {
        return "Starting V" + getCylinders() + " [rodLength=" + getRodLength() + ']';
    }

    @Override
    public final int getCylinders() {
        return cylinders;
    }

    public double getRodLength() {
        return rodLength;
    }

    public void setRodLength(double rodLength) {
        this.rodLength = rodLength;
    }
}

@Factory
public class EngineFactory {

    private V8Engine engine;
    private double rodLength = 5.7;

    @PostConstruct
    public void initialize() {
        engine = new V8Engine(rodLength); // <b class="conum">(2)</b>
    }

    @Singleton
    public Engine v8Engine() {
        return engine;// <b class="conum">(3)</b>
    }

    public void setRodLength(double rodLength) {
        this.rodLength = rodLength;
    }
}

@Singleton
public class EngineInitializer implements BeanInitializedEventListener&lt;EngineFactory&gt; { // <b class="conum">(4)</b>
    @Override
    public EngineFactory onInitialized(BeanInitializingEvent&lt;EngineFactory&gt; event) {
        EngineFactory engineFactory = event.getBean();
        engineFactory.setRodLength(6.6);// <b class="conum">(5)</b>
        return engineFactory;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class V8Engine implements Engine {
    final int cylinders = 8
    double rodLength // <b class="conum">(1)</b>

    @Override
    String start() {
        return "Starting V$cylinders [rodLength=$rodLength]"
    }
}

@Factory
class EngineFactory {
    private V8Engine engine
    double rodLength = 5.7

    @PostConstruct
    void initialize() {
        engine = new V8Engine(rodLength: rodLength) // <b class="conum">(2)</b>
    }

    @Singleton
    Engine v8Engine() {
        return engine // <b class="conum">(3)</b>
    }
}

@Singleton
class EngineInitializer implements BeanInitializedEventListener&lt;EngineFactory&gt; { // <b class="conum">(4)</b>
    @Override
    EngineFactory onInitialized(BeanInitializingEvent&lt;EngineFactory&gt; event) {
        EngineFactory engineFactory = event.bean
        engineFactory.rodLength = 6.6 // <b class="conum">(5)</b>
        return engineFactory
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class V8Engine(var rodLength: Double) : Engine {  // <b class="conum">(1)</b>

    override val cylinders = 8

    override fun start(): String {
        return "Starting V$cylinders [rodLength=$rodLength]"
    }
}

@Factory
class EngineFactory {

    private var engine: V8Engine? = null
    private var rodLength = 5.7

    @PostConstruct
    fun initialize() {
        engine = V8Engine(rodLength) // <b class="conum">(2)</b>
    }

    @Singleton
    fun v8Engine(): Engine? {
        return engine// <b class="conum">(3)</b>
    }

    fun setRodLength(rodLength: Double) {
        this.rodLength = rodLength
    }
}

@Singleton
class EngineInitializer : BeanInitializedEventListener&lt;EngineFactory&gt; { // <b class="conum">(4)</b>
    override fun onInitialized(event: BeanInitializingEvent&lt;EngineFactory&gt;): EngineFactory {
        val engineFactory = event.bean
        engineFactory.setRodLength(6.6) // <b class="conum">(5)</b>
        return engineFactory
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>V8Engine</code> class defines a <code>rodLength</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EngineFactory</code> initializes the value of <code>rodLength</code> and creates the instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The created instance is returned as a <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>BeanInitializedEventListener</code> interface is implemented to listen for the initialization of the factory</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Within the <code>onInitialized</code> method the <code>rodLength</code> is overridden prior to the engine being created by the factory bean.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> interface is more typically used to decorate or enhance a fully initialized bean, for example by creating a proxy.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Bean event listeners are initialized <strong>before</strong> type converters. If your event listener relies on type conversion either by relying on a configuration properties bean or by any other mechanism, you may see errors related to type conversion.
</td>
</tr>
</table>
</div>

<h2 id="introspection"><a class="anchor" href="#introspection"></a>3.15 Bean Introspection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/introspection.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 1.1, a compile-time replacement for the JDK&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html">Introspector</a> class has been included.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/beans/BeanIntrospector.html">BeanIntrospector</a> and <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> interfaces allow looking up bean introspections to instantiate and read/write bean properties without using reflection or caching reflective metadata, which consume excessive memory for large beans.</p>
</div>
<div class="sect2">
<h3 id="_making_a_bean_available_for_introspection">Making a Bean Available for Introspection</h3>
<div class="paragraph">
<p>Unlike the JDK&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/Introspector.html">Introspector</a>, every class is not automatically available for introspection. To make a class available for introspection you must at a minimum enable Micronaut&#8217;s annotation processor (<code>micronaut-inject-java</code> for Java and Kotlin and <code>micronaut-inject-groovy</code> for Groovy) in your build and ensure you have a runtime time dependency on <code>micronaut-core</code>.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-inject-java:3.9.7")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-inject-java&lt;/artifactId&gt;
        &lt;version&gt;3.9.7&lt;/version&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Kotlin, add the <code>micronaut-inject-java</code> dependency in <code>kapt</code> scope, and for Groovy add <code>micronaut-inject-groovy</code> in <code>compileOnly</code> scope.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut:micronaut-core:3.9.7")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-core&lt;/artifactId&gt;
    &lt;version&gt;3.9.7&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Once your build is configured you have a few ways to generate introspection data.</p>
</div>
<div class="sect3">
<h4 id="_use_the_introspected_annotation">Use the <code>@Introspected</code> Annotation</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation can be used on any class to make it available for introspection. Simply annotate the class with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected
public class Person {

    private String name;
    private int age = 18;

    public Person(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.Canonical
import io.micronaut.core.annotation.Introspected

@Introspected
@Canonical
class Person {

    String name
    int age = 18

    Person(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Introspected

@Introspected
data class Person(var name : String) {
    var age : Int = 18
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once introspection data has been produced at compile time, retrieve it via the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final BeanIntrospection&lt;Person&gt; introspection = BeanIntrospection.getIntrospection(Person.class); // <b class="conum">(1)</b>
Person person = introspection.instantiate("John"); // <b class="conum">(2)</b>
System.out.println("Hello " + person.getName());

final BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String.class); // <b class="conum">(3)</b>
property.set(person, "Fred"); // <b class="conum">(4)</b>
String name = property.get(person); // <b class="conum">(5)</b>
System.out.println("Hello " + person.getName());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def introspection = BeanIntrospection.getIntrospection(Person) // <b class="conum">(1)</b>
Person person = introspection.instantiate("John") // <b class="conum">(2)</b>
println("Hello $person.name")

BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String) // <b class="conum">(3)</b>
property.set(person, "Fred") // <b class="conum">(4)</b>
String name = property.get(person) // <b class="conum">(5)</b>
println("Hello $person.name")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val introspection = BeanIntrospection.getIntrospection(Person::class.java) // <b class="conum">(1)</b>
val person : Person = introspection.instantiate("John") // <b class="conum">(2)</b>
print("Hello ${person.name}")

val property : BeanProperty&lt;Person, String&gt; = introspection.getRequiredProperty("name", String::class.java) // <b class="conum">(3)</b>
property.set(person, "Fred") // <b class="conum">(4)</b>
val name = property.get(person) // <b class="conum">(5)</b>
print("Hello ${person.name}")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can retrieve a <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> with the static <code>getIntrospection</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Once you have a <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> you can instantiate a bean with the <code>instantiate</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A <a href="../api/io/micronaut/core/beans/BeanProperty.html">BeanProperty</a> can be retrieved from the introspection</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the <code>set</code> method to set the property value</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use the <code>get</code> method to retrieve the property value</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_use_introspected_with_accessorsstyle">Use <code>@Introspected</code> with <code>@AccessorsStyle</code></h5>
<div class="paragraph">
<p>It is possible to use <a href="#configurationPropertiesAccessorsStyle">the <code>@AccessorsStyle</code> annotation</a> with <code>@Introspected</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.AccessorsStyle;
import io.micronaut.core.annotation.Introspected;

@Introspected
@AccessorsStyle(readPrefixes = "", writePrefixes = "") <i class="conum" data-value="1"></i><b>(1)</b>
public class Person {

    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String name() { <i class="conum" data-value="2"></i><b>(2)</b>
        return name;
    }

    public void name(String name) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.name = name;
    }

    public int age() { <i class="conum" data-value="2"></i><b>(2)</b>
        return age;
    }

    public void age(int age) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@AccessorsStyle</code> to define empty read and write prefixes for getters and setters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the getters and setters without a prefix.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now it is possible to retrieve the compile time generated introspection using the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BeanIntrospection&lt;Person&gt; introspection = BeanIntrospection.getIntrospection(Person.class);
Person person = introspection.instantiate("John", 42);

Assertions.assertEquals("John", person.name());
Assertions.assertEquals(42, person.age());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bean_fields">Bean Fields</h4>
<div class="paragraph">
<p>By default Java introspections treat only JavaBean getters/setters or Java 16 record components as bean properties. You can however define classes with public or package protected fields in Java using the <code>accessKind</code> member of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected(accessKind = Introspected.AccessKind.FIELD)
public class User {
    public final String name; // <b class="conum">(1)</b>
    public int age = 18; // <b class="conum">(2)</b>

    public User(String name) {
        this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

@Introspected(accessKind = Introspected.AccessKind.FIELD)
class User {
    public final String name // <b class="conum">(1)</b>
    public int age = 18 // <b class="conum">(2)</b>

    User(String name) {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Final fields are treated like read-only properties</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mutable fields are treated like read-write properties</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>accessKind</code> accepts an array so it is possible to allow for both types of accessors but prefer one or the other depending on the order they appear in the annotation. The first one in the list has priority.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Introspections on fields are not possible in Kotlin because it is not possible to declare fields directly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_constructor_methods">Constructor Methods</h4>
<div class="paragraph">
<p>For classes with multiple constructors, apply the <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation to the constructor to use.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Creator;
import io.micronaut.core.annotation.Introspected;

import javax.annotation.concurrent.Immutable;

@Introspected
@Immutable
public class Vehicle {

    private final String make;
    private final String model;
    private final int axles;

    public Vehicle(String make, String model) {
        this(make, model, 2);
    }

    @Creator // <b class="conum">(1)</b>
    public Vehicle(String make, String model, int axles) {
        this.make = make;
        this.model = model;
        this.axles = axles;
    }

    public String getMake() {
        return make;
    }

    public String getModel() {
        return model;
    }

    public int getAxles() {
        return axles;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Vehicle {

    final String make
    final String model
    final int axles

    Vehicle(String make, String model) {
        this(make, model, 2)
    }

    @Creator // <b class="conum">(1)</b>
    Vehicle(String make, String model, int axles) {
        this.make = make
        this.model = model
        this.axles = axles
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Vehicle @Creator constructor(val make: String, val model: String, val axles: Int) { // <b class="conum">(1)</b>

    constructor(make: String, model: String) : this(make, model, 2) {}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation denotes which constructor to use</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This class has no default constructor, so calls to instantiate without arguments throw an <a href="../api/io/micronaut/core/reflect/exception/InstantiationException.html">InstantiationException</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_static_creator_methods">Static Creator Methods</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation can be applied to static methods that create class instances.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Creator;
import io.micronaut.core.annotation.Introspected;

import javax.annotation.concurrent.Immutable;

@Introspected
@Immutable
public class Business {

    private final String name;

    private Business(String name) {
        this.name = name;
    }

    @Creator // <b class="conum">(1)</b>
    public static Business forName(String name) {
        return new Business(name);
    }

    public String getName() {
        return name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Business {

    final String name

    private Business(String name) {
        this.name = name
    }

    @Creator // <b class="conum">(1)</b>
    static Business forName(String name) {
        new Business(name)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Creator
import io.micronaut.core.annotation.Introspected

import javax.annotation.concurrent.Immutable

@Introspected
@Immutable
class Business private constructor(val name: String) {
    companion object {

        @Creator // <b class="conum">(1)</b>
        fun forName(name: String): Business {
            return Business(name)
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a> annotation is applied to the static method which instantiates the class</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There can be multiple "creator" methods annotated. If there is one without arguments, it will be the default construction method. The first method with arguments will be used as the primary construction method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_enums">Enums</h4>
<div class="paragraph">
<p>It is possible to introspect enums as well. Add the annotation to the enum and it can be constructed through the standard <code>valueOf</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_the_introspected_annotation_on_a_configuration_class">Use the <code>@Introspected</code> Annotation on a Configuration Class</h4>
<div class="paragraph">
<p>If the class to introspect is already compiled and not under your control, an alternative option is to define a configuration class with the <code>classes</code> member of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation set.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected(classes = Person.class)
public class PersonConfiguration {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

@Introspected(classes = Person)
class PersonConfiguration {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Introspected

@Introspected(classes = [Person::class])
class PersonConfiguration</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the <code>PersonConfiguration</code> class generates introspections for the <code>Person</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use the <code>packages</code> member of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> which package scans at compile time and generates introspections for all classes within a package. Note however this feature is currently regarded as experimental.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_write_an_annotationmapper_to_introspect_existing_annotations">Write an <code>AnnotationMapper</code> to Introspect Existing Annotations</h4>
<div class="paragraph">
<p>If there is an existing annotation that you wish to introspect by default you can write an <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a>.</p>
</div>
<div class="paragraph">
<p>An example of this is <a href="https://github.com/micronaut-projects/micronaut-core/blob/master/inject/src/main/java/io/micronaut/inject/beans/visitor/EntityIntrospectedAnnotationMapper.java">EntityIntrospectedAnnotationMapper</a> which ensures all beans annotated with <code>javax.persistence.Entity</code> are introspectable by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>AnnotationMapper</code> must be on the annotation processor classpath.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_beanwrapper_api">The BeanWrapper API</h3>
<div class="paragraph">
<p>A <a href="../api/io/micronaut/core/beans/BeanProperty.html">BeanProperty</a> provides raw access to read and write a property value for a given class and does not provide any automatic type conversion.</p>
</div>
<div class="paragraph">
<p>It is expected that the values you pass to the <code>set</code> and <code>get</code> methods match the underlying property type, otherwise an exception will occur.</p>
</div>
<div class="paragraph">
<p>To provide additional type conversion smarts the <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> interface allows wrapping an existing bean instance and setting and getting properties from the bean, plus performing type conversion as necessary.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final BeanWrapper&lt;Person&gt; wrapper = BeanWrapper.getWrapper(new Person("Fred")); // <b class="conum">(1)</b>

wrapper.setProperty("age", "20"); // <b class="conum">(2)</b>
int newAge = wrapper.getRequiredProperty("age", int.class); // <b class="conum">(3)</b>

System.out.println("Person's age now " + newAge);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final BeanWrapper&lt;Person&gt; wrapper = BeanWrapper.getWrapper(new Person("Fred")) // <b class="conum">(1)</b>

wrapper.setProperty("age", "20") // <b class="conum">(2)</b>
int newAge = wrapper.getRequiredProperty("age", Integer) // <b class="conum">(3)</b>

println("Person's age now $newAge")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val wrapper = BeanWrapper.getWrapper(Person("Fred")) // <b class="conum">(1)</b>

wrapper.setProperty("age", "20") // <b class="conum">(2)</b>
val newAge = wrapper.getRequiredProperty("age", Int::class.java) // <b class="conum">(3)</b>

println("Person's age now $newAge")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the static <code>getWrapper</code> method to obtain a <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> for a bean instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can set properties, and the <a href="../api/io/micronaut/core/beans/BeanWrapper.html">BeanWrapper</a> will perform type conversion, or throw <a href="../api/io/micronaut/core/convert/exceptions/ConversionErrorException.html">ConversionErrorException</a> if conversion is not possible.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can retrieve a property using <code>getRequiredProperty</code> and request the appropriate type. If the property doesn&#8217;t exist a <a href="../api/io/micronaut/core/beans/exceptions/IntrospectionException.html">IntrospectionException</a> is thrown, and if it cannot be converted a <a href="../api/io/micronaut/core/convert/exceptions/ConversionErrorException.html">ConversionErrorException</a> is thrown.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jackson_and_bean_introspection">Jackson and Bean Introspection</h3>
<div class="paragraph">
<p>Jackson is configured to use the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API to read and write property values and construct objects, resulting in reflection-free serialization/deserialization. This is beneficial from a performance perspective and requires less configuration to operate correctly with runtimes such as GraalVM native.</p>
</div>
<div class="paragraph">
<p>This feature is enabled by default; disable it by setting the <code>jackson.bean-introspection-module</code> configuration to <code>false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently only bean properties (private field with public getter/setter) are supported and usage of public fields is not supported.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is currently experimental and may be subject to change in the future.
</td>
</tr>
</table>
</div>
</div>

<h2 id="beanValidation"><a class="anchor" href="#beanValidation"></a>3.16 Bean Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/beanValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 1.2, Micronaut has built-in support for validating beans annotated with <code>javax.validation</code> annotations. At a minimum include the <code>micronaut-validation</code> module as a compile dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Note that Micronaut&#8217;s implementation is not currently fully compliant with the <a href="https://beanvalidation.org/2.0/spec/">Bean Validator specification</a> as the specification heavily relies on reflection-based APIs.</p>
</div>
<div class="paragraph">
<p>The following features are unsupported at this time:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotations on generic argument types, since only the Java language supports this feature.</p>
</li>
<li>
<p>Any interaction with the <a href="https://beanvalidation.org/2.0/spec/#constraintmetadata">constraint metadata API</a>, since Micronaut uses compile-time generated metadata.</p>
</li>
<li>
<p>XML-based configuration</p>
</li>
<li>
<p>Instead of using <code>javax.validation.ConstraintValidator</code>, use <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> (io.micronaut.validation.validator.constraints.ConstraintValidator) to define custom constraints, which supports validating annotations at compile time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s implementation includes the following benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reflection and Runtime Proxy free validation, resulting in reduced memory consumption</p>
</li>
<li>
<p>Smaller JAR size since Hibernate Validator adds another 1.4MB</p>
</li>
<li>
<p>Faster startup since Hibernate Validator adds 200ms+ startup overhead</p>
</li>
<li>
<p>Configurability via Annotation Metadata</p>
</li>
<li>
<p>Support for Reactive Bean Validation</p>
</li>
<li>
<p>Support for validating the source AST at compile time</p>
</li>
<li>
<p>Automatic compatibility with GraalVM native without additional configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you require full Bean Validator 2.0 compliance, add the <code>micronaut-hibernate-validator</code> module to your build, which replaces Micronaut&#8217;s implementation.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.beanvalidation:micronaut-hibernate-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.beanvalidation&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="sect2">
<h3 id="_validating_bean_methods">Validating Bean Methods</h3>
<div class="paragraph">
<p>You can validate methods of any class declared as a Micronaut bean by applying <code>javax.validation</code> annotations to arguments:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Validating Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Singleton;
import javax.validation.constraints.NotBlank;

@Singleton
public class PersonService {
    public void sayHello(@NotBlank String name) {
        System.out.println("Hello " + name);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Validating Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Singleton
import javax.validation.constraints.NotBlank

@Singleton
class PersonService {
    void sayHello(@NotBlank String name) {
        println "Hello $name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Validating Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Singleton
import javax.validation.constraints.NotBlank

@Singleton
open class PersonService {
    open fun sayHello(@NotBlank name: String) {
        println("Hello $name")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example declares that the <code>@NotBlank</code> annotation will be validated when invoking the <code>sayHello</code> method.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you use Kotlin, the class and method must be declared <code>open</code> so Micronaut can create a compile-time subclass. Alternatively you can annotate the class with <a href="../api/io/micronaut/validation/Validated.html">@Validated</a> and configure the Kotlin <code>all-open</code> plugin to open classes annotated with this type. See the <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html">Compiler plugins</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <code>javax.validation.ConstraintViolationException</code> is thrown if a validation error occurs. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import jakarta.inject.Inject;
import javax.validation.ConstraintViolationException;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;

@MicronautTest
class PersonServiceSpec {

    @Inject PersonService personService;

    @Test
    void testThatNameIsValidated() {
        final ConstraintViolationException exception =
                assertThrows(ConstraintViolationException.class, () -&gt;
                personService.sayHello("") // <b class="conum">(1)</b>
        );

        assertEquals("sayHello.name: must not be blank", exception.getMessage()); // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.test.extensions.spock.annotation.MicronautTest
import spock.lang.Specification

import jakarta.inject.Inject
import javax.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec extends Specification {

    @Inject PersonService personService

    void "test person name is validated"() {
        when:"The sayHello method is called with a blank string"
        personService.sayHello("") // <b class="conum">(1)</b>

        then:"A validation error occurs"
        def e = thrown(ConstraintViolationException)
        e.message == "sayHello.name: must not be blank" //  <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Assertions.assertThrows
import org.junit.jupiter.api.Test
import jakarta.inject.Inject
import javax.validation.ConstraintViolationException

@MicronautTest
class PersonServiceSpec {

    @Inject
    lateinit var personService: PersonService

    @Test
    fun testThatNameIsValidated() {
        val exception = assertThrows(ConstraintViolationException::class.java) {
            personService.sayHello("") // <b class="conum">(1)</b>
        }

        assertEquals("sayHello.name: must not be blank", exception.message) // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is called with a blank string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An exception occurs</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_data_classes">Validating Data Classes</h3>
<div class="paragraph">
<p>To validate data classes, e.g. POJOs (typically used in JSON interchange), the class must be annotated with <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> (see the previous section on <a href="#introspection">Bean Introspection</a>) or, if the class is external, be imported by the <code>@Introspected</code> annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">POJO Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@Introspected
public class Person {

    private String name;

    @Min(18)
    private int age;

    @NotBlank
    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">POJO Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Introspected
class Person {

    @NotBlank
    String name

    @Min(18L)
    int age
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">POJO Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Introspected
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Introspected
data class Person(
    @field:NotBlank var name: String,
    @field:Min(18) var age: Int
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation can be used as a meta-annotation; common annotations like <code>@javax.persistence.Entity</code> are treated as <code>@Introspected</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example defines a <code>Person</code> class that has two properties (<code>name</code> and <code>age</code>) that have constraints applied. Note that in Java the annotations can be on the field or the getter, and with Kotlin data classes, the annotation should target the field.</p>
</div>
<div class="paragraph">
<p>To validate the class manually, inject an instance of <a href="../api/io/micronaut/validation/validator/Validator.html">Validator</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
Validator validator;

@Test
void testThatPersonIsValidWithValidator() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final Set&lt;ConstraintViolation&lt;Person&gt;&gt; constraintViolations = validator.validate(person);  // <b class="conum">(1)</b>

    assertEquals(2, constraintViolations.size()); // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject Validator validator

void "test person is validated with validator"() {
    when:"The person is validated"
    def constraintViolations = validator.validate(new Person(name: "", age: 10)) // <b class="conum">(1)</b>

    then:"A validation error occurs"
    constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
lateinit var validator: Validator

@Test
fun testThatPersonIsValidWithValidator() {
    val person = Person("", 10)
    val constraintViolations = validator.validate(person) // <b class="conum">(1)</b>

    assertEquals(2, constraintViolations.size) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The validator validates the person</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively on Bean methods you can use <code>javax.validation.Valid</code> to trigger cascading validation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class PersonService {
    public void sayHello(@Valid Person person) {
        System.out.println("Hello " + person.getName());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class PersonService {
    void sayHello(@Valid Person person) {
        println "Hello $person.name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ConstraintViolationException Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
open class PersonService {
    open fun sayHello(@Valid person: Person) {
        println("Hello ${person.name}")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonService</code> now validates the <code>Person</code> class when invoked:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
PersonService personService;

@Test
void testThatPersonIsValid() {
    Person person = new Person();
    person.setName("");
    person.setAge(10);

    final ConstraintViolationException exception =
        assertThrows(ConstraintViolationException.class, () -&gt;
            personService.sayHello(person) // <b class="conum">(1)</b>
        );

    assertEquals(2, exception.getConstraintViolations().size()); // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject PersonService personService

void "test person name is validated"() {
    when:"The sayHello method is called with an invalid person"
    personService.sayHello(new Person(name: "", age: 10)) // <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.constraintViolations.size() == 2 //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Manual Validation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
lateinit var personService: PersonService

@Test
fun testThatPersonIsValid() {
    val person = Person("", 10)
    val exception = assertThrows(ConstraintViolationException::class.java) {
        personService.sayHello(person) // <b class="conum">(1)</b>
    }

    assertEquals(2, exception.constraintViolations.size) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A validated method is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constraint violations are verified</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_configuration_properties">Validating Configuration Properties</h3>
<div class="paragraph">
<p>You can also validate the properties of classes that are annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> to ensure configuration is correct.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended that you annotate <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> that features validation with <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> to ensure that the validation occurs at startup.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_defining_additional_constraints">Defining Additional Constraints</h3>
<div class="paragraph">
<p>To define additional constraints, create a new annotation, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.validation.Constraint;
import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.CONSTRUCTOR;
import static java.lang.annotation.ElementType.FIELD;
import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.ElementType.PARAMETER;
import static java.lang.annotation.ElementType.TYPE_USE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Retention(RUNTIME)
@Constraint(validatedBy = { }) // <b class="conum">(1)</b>
public @interface DurationPattern {

    String message() default "invalid duration ({validatedValue})"; // <b class="conum">(2)</b>

    /**
     * Defines several constraints on the same element.
     */
    @Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
    @Retention(RUNTIME)
    @Documented
    @interface List {
        DurationPattern[] value(); // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import javax.validation.Constraint
import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Retention(RUNTIME)
@Constraint(validatedBy = []) // <b class="conum">(1)</b>
@interface DurationPattern {
    String message() default "invalid duration ({validatedValue})" // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import javax.validation.Constraint
import kotlin.annotation.AnnotationRetention.RUNTIME

@Retention(RUNTIME)
@Constraint(validatedBy = []) // <b class="conum">(1)</b>
annotation class DurationPattern(
    val message: String = "invalid duration ({validatedValue})" // <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation should be annotated with <code>javax.validation.Constraint</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>message</code> template can be provided in a hard-coded manner as above. If none is specified, Micronaut tries to find a message using <code>ClassName.message</code> using the <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> interface (optional)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>To support repeated annotations you can define an inner annotation (optional)</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add messages and message bundles using the <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> and <a href="../api/io/micronaut/context/i18n/ResourceBundleMessageSource.html">ResourceBundleMessageSource</a> classes. See <a href="#bundle">Resource Bundles</a> documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined the annotation, implement a <a href="../api/io/micronaut/validation/validator/constraints/ConstraintValidator.html">ConstraintValidator</a> that validates the annotation. You can either create a bean class that implements the interface directly or define a factory that returns one or more validators.</p>
</div>
<div class="paragraph">
<p>The latter approach is recommended if you plan to define multiple validators:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Factory;
import io.micronaut.validation.validator.constraints.ConstraintValidator;

import jakarta.inject.Singleton;

@Factory
public class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, CharSequence&gt; durationPatternValidator() {
        return (value, annotationMetadata, context) -&gt; {
            context.messageTemplate("invalid duration ({validatedValue}), additional custom message"); // <b class="conum">(1)</b>
            return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
        };
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Factory
import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext

import jakarta.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    ConstraintValidator&lt;DurationPattern, CharSequence&gt; durationPatternValidator() {
        return { CharSequence value,
                 AnnotationValue&lt;DurationPattern&gt; annotation,
                 ConstraintValidatorContext context -&gt;
            context.messageTemplate("invalid duration ({validatedValue}), additional custom message") // <b class="conum">(1)</b>
            return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
        } as ConstraintValidator&lt;DurationPattern, CharSequence&gt;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import io.micronaut.validation.validator.constraints.ConstraintValidator
import jakarta.inject.Singleton

@Factory
class MyValidatorFactory {

    @Singleton
    fun durationPatternValidator() : ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
        return ConstraintValidator { value, annotation, context -&gt;
            context.messageTemplate("invalid duration ({validatedValue}), additional custom message") // <b class="conum">(1)</b>
            value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override the default message template with an inline call for more control over the validation error message. (Since <code>2.5.0</code>)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example implements a validator that validates any field, parameter etc. that is annotated with <code>DurationPattern</code>, ensuring that the string can be parsed with <code>java.time.Duration.parse</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generally <code>null</code> is regarded as valid and <code>@NotNull</code> is used to constrain a value as not being <code>null</code>. The example above regards <code>null</code> as a valid value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class HolidayService {

    public String startHoliday(@NotBlank String person,
                               @DurationPattern String duration) {
        final Duration d = Duration.parse(duration);
        return "Person " + person + " is off on holiday for " + d.toMinutes() + " minutes";
    }

    public String startHoliday(@DurationPattern String fromDuration, @DurationPattern String toDuration, @NotBlank String person
    ) {
        final Duration d = Duration.parse(fromDuration);
        final Duration e = Duration.parse(toDuration);
        return "Person " + person + " is off on holiday from " + d + " to " + e;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class HolidayService {

    String startHoliday(@NotBlank String person,
                        @DurationPattern String duration) {
        final Duration d = Duration.parse(duration)
        return "Person $person is off on holiday for ${d.toMinutes()} minutes"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
open class HolidayService {

    open fun startHoliday(@NotBlank person: String,
                          @DurationPattern duration: String): String {
        val d = Duration.parse(duration)
        return "Person $person is off on holiday for ${d.toMinutes()} minutes"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify the above examples validates the <code>duration</code> parameter, define a test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject HolidayService holidayService;

@Test
void testCustomValidator() {
    final ConstraintViolationException exception =
        assertThrows(ConstraintViolationException.class, () -&gt;
            holidayService.startHoliday("Fred", "junk") // <b class="conum">(1)</b>
        );

    assertEquals("startHoliday.duration: invalid duration (junk), additional custom message", exception.getMessage()); // <b class="conum">(2)</b>
}

// Issue:: micronaut-core/issues/6519
@Test
void testCustomAndDefaultValidator() {
    final ConstraintViolationException exception =
            assertThrows(ConstraintViolationException.class, () -&gt;
                    holidayService.startHoliday( "fromDurationJunk", "toDurationJunk", "")
            );

    String notBlankValidated = exception.getConstraintViolations().stream().filter(constraintViolation -&gt; Objects.equals(constraintViolation.getPropertyPath().toString(), "startHoliday.person")).map(ConstraintViolation::getMessage).findFirst().get();
    String fromDurationPatternValidated = exception.getConstraintViolations().stream().filter(constraintViolation -&gt; Objects.equals(constraintViolation.getPropertyPath().toString(), "startHoliday.fromDuration")).map(ConstraintViolation::getMessage).findFirst().get();
    String toDurationPatternValidated = exception.getConstraintViolations().stream().filter(constraintViolation -&gt; Objects.equals(constraintViolation.getPropertyPath().toString(), "startHoliday.toDuration")).map(ConstraintViolation::getMessage).findFirst().get();
    assertEquals("must not be blank", notBlankValidated);
    assertEquals("invalid duration (fromDurationJunk), additional custom message", fromDurationPatternValidated);
    assertEquals("invalid duration (toDurationJunk), additional custom message", toDurationPatternValidated);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">void "test test custom validator"() {
    when:"A custom validator is used"
    holidayService.startHoliday("Fred", "junk") // <b class="conum">(1)</b>

    then:"A validation error occurs"
    def e = thrown(ConstraintViolationException)
    e.message == "startHoliday.duration: invalid duration (junk), additional custom message" //  <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Example Custom Constraint Usage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
lateinit var holidayService: HolidayService

@Test
fun testCustomValidator() {
    val exception = assertThrows(ConstraintViolationException::class.java) {
        holidayService.startHoliday("Fred", "junk") // <b class="conum">(1)</b>
    }

    assertEquals("startHoliday.duration: invalid duration (junk), additional custom message", exception.message) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A validated method is invoked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>THe constraint violations are verified</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_annotations_at_compile_time">Validating Annotations at Compile Time</h3>
<div class="paragraph">
<p>You can use Micronaut&#8217;s validator to validate annotation elements at compile time by including <code>micronaut-validation</code> in the annotation processor classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Then Micronaut will at compile time validate annotation values that are themselves annotated with <code>javax.validation</code>. For example consider the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Validation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.lang.annotation.Retention;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Retention(RUNTIME)
public @interface TimeOff {
    @DurationPattern
    String duration();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Validation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import java.lang.annotation.Retention

import static java.lang.annotation.RetentionPolicy.RUNTIME

@Retention(RUNTIME)
@interface TimeOff {
    @DurationPattern
    String duration()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Validation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import kotlin.annotation.AnnotationRetention.RUNTIME

@Retention(RUNTIME)
annotation class TimeOff(
    @DurationPattern val duration: String
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you attempt to use <code>@TimeOff(duration="junk")</code> in your source, Micronaut will fail compilation due to the <code>duration</code> value violating the <code>DurationPattern</code> constraint.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>duration</code> is a property placeholder such as <code>@TimeOff(duration="${my.value}")</code>, validation is deferred until runtime.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that to use a custom <code>ConstraintValidator</code> at compile time you must instead define the validator as a class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.NonNull;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.core.annotation.AnnotationValue;
import io.micronaut.validation.validator.constraints.ConstraintValidator;
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext;

public class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    public boolean isValid(
            @Nullable CharSequence value,
            @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @NonNull ConstraintValidatorContext context) {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.NonNull
import io.micronaut.core.annotation.Nullable
import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext

class DurationPatternValidator implements ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    @Override
    boolean isValid(
            @Nullable CharSequence value,
            @NonNull AnnotationValue&lt;DurationPattern&gt; annotationMetadata,
            @NonNull ConstraintValidatorContext context) {
        return value == null || value.toString() ==~ /^PT?[\d]+[SMHD]{1}$/
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Constraint Validator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.AnnotationValue
import io.micronaut.validation.validator.constraints.ConstraintValidator
import io.micronaut.validation.validator.constraints.ConstraintValidatorContext

class DurationPatternValidator : ConstraintValidator&lt;DurationPattern, CharSequence&gt; {
    override fun isValid(
            value: CharSequence?,
            annotationMetadata: AnnotationValue&lt;DurationPattern&gt;,
            context: ConstraintValidatorContext): Boolean {
        return value == null || value.toString().matches("^PT?[\\d]+[SMHD]{1}$".toRegex())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a <code>META-INF/services/io.micronaut.validation.validator.constraints.ConstraintValidator</code> file that references the class.</p>
</li>
<li>
<p>The class must be public and have a public no-argument constructor</p>
</li>
<li>
<p>The class must be on the annotation processor classpath of the project to be validated.</p>
</li>
</ul>
</div>
</div>

<h2 id="annotationMetadata"><a class="anchor" href="#annotationMetadata"></a>3.17 Bean Annotation Metadata</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/annotationMetadata.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The methods provided by Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AnnotatedElement.html">AnnotatedElement</a> API in general don&#8217;t provide the ability to introspect annotations without loading the annotations themselves. Nor do they provide any ability to introspect annotation stereotypes (often called meta-annotations; an annotation stereotype is where an annotation is annotated with another annotation, essentially inheriting its behaviour).</p>
</div>
<div class="paragraph">
<p>To solve this problem many frameworks produce runtime metadata or perform expensive reflection to analyze the annotations of a class.</p>
</div>
<div class="paragraph">
<p>Micronaut instead produces this annotation metadata at compile time, avoiding expensive reflection and saving memory.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> API can be used to obtain a reference to a <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> which implements the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> interface.</p>
</div>
<div class="paragraph">
<p>For example the following code obtains all bean definitions annotated with a particular stereotype:</p>
</div>
<div class="listingblock">
<div class="title">Lookup Bean Definitions by Stereotype</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BeanContext beanContext = ... // obtain the bean context
Collection&lt;BeanDefinition&gt; definitions =
    beanContext.getBeanDefinitions(Qualifiers.byStereotype(Controller.class))

for (BeanDefinition definition : definitions) {
    AnnotationValue&lt;Controller&gt; controllerAnn = definition.getAnnotation(Controller.class);
    // do something with the annotation
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example finds all <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> instances annotated with <code>@Controller</code> whether <code>@Controller</code> is used directly or inherited via an annotation stereotype.</p>
</div>
<div class="paragraph">
<p>Note that the <code>getAnnotation</code> method and the variations of the method return an <a href="../api/io/micronaut/core/annotation/AnnotationValue.html">AnnotationValue</a> type and not a Java annotation. This is by design, and you should generally try to work with this API when reading annotation values, since synthesizing a proxy implementation is worse from a performance and memory consumption perspective.</p>
</div>
<div class="paragraph">
<p>If you require a reference to an annotation instance you can use the <code>synthesize</code> method, which creates a runtime proxy that implements the annotation interface:</p>
</div>
<div class="listingblock">
<div class="title">Synthesizing Annotation Instances</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Controller controllerAnn = definition.synthesize(Controller.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is not recommended however, as it requires reflection and increases memory consumption due to the use of runtime generated proxies, and should be used as a last resort, for example if you need an instance of the annotation to integrate with a third-party library.</p>
</div>
<div class="sect2">
<h3 id="_annotation_inheritance">Annotation Inheritance</h3>
<div class="paragraph">
<p>Micronaut will respect the rules defined in Java&#8217;s <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AnnotatedElement.html">AnnotatedElement</a> API with regards to annotation inheritance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotations meta-annotated with <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a> will be available via the <code>getAnnotation*</code> methods of the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> API whilst those directly declared are available via the <code>getDeclaredAnnotation*</code> methods.</p>
</li>
<li>
<p>Annotations not meta-annotated with <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a> will not be included in the metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut differs from the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AnnotatedElement.html">AnnotatedElement</a> API in that it extends these rules to methods and method parameters such that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any annotations annotated with <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a> and present on a method of interface or super class <code>A</code> that is overridden by child interface or class <code>B</code> will be inherited into the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> retrievable via the <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a> API from a <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> or an <a href="#aop">AOP interceptor</a>.</p>
</li>
<li>
<p>Any annotations annotated with <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a> and present on a method parameter of interface or super class <code>A</code> that is overridden by child interface or class <code>B</code> will be inherited into the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> retrievable via the <a href="../api/io/micronaut/core/type/Argument.html">Argument</a> interface from the <code>getArguments</code> method of the <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a> API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general behaviour which you may wish to override is not inherited by default including <a href="#scopes">Bean Scopes</a>, <a href="#qualifiers">Bean Qualifiers</a>, <a href="#conditionalBeans">Bean Conditions</a>, <a href="#validation">Validation Rules</a> and so on.</p>
</div>
<div class="paragraph">
<p>If you wish a particular scope, qualifier, or set of requirements to be inherited when subclassing then you can define a meta-annotation that is annotated with <code>@Inherited</code>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Inherited Meta Annotations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.AliasFor;
import io.micronaut.context.annotation.Requires;
import io.micronaut.core.annotation.AnnotationMetadata;
import jakarta.inject.Named;
import jakarta.inject.Singleton;

import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;

@Inherited // <b class="conum">(1)</b>
@Retention(RetentionPolicy.RUNTIME)
@Requires(property = "datasource.url") // <b class="conum">(2)</b>
@Named // <b class="conum">(3)</b>
@Singleton // <b class="conum">(4)</b>
public @interface SqlRepository {
    @AliasFor(annotation = Named.class, member = AnnotationMetadata.VALUE_MEMBER) // <b class="conum">(5)</b>
    String value() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Inherited Meta Annotations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.AliasFor
import io.micronaut.context.annotation.Requires
import io.micronaut.core.annotation.AnnotationMetadata
import jakarta.inject.Named
import jakarta.inject.Singleton

import java.lang.annotation.Inherited
import java.lang.annotation.Retention
import java.lang.annotation.RetentionPolicy

@Inherited // <b class="conum">(1)</b>
@Retention(RetentionPolicy.RUNTIME)
@Requires(property = "datasource.url") // <b class="conum">(2)</b>
@Named // <b class="conum">(3)</b>
@Singleton // <b class="conum">(4)</b>
@interface SqlRepository {
    @AliasFor(annotation = Named.class, member = AnnotationMetadata.VALUE_MEMBER) // <b class="conum">(5)</b>
    String value() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Inherited Meta Annotations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import jakarta.inject.Named
import jakarta.inject.Singleton
import java.lang.annotation.Inherited

@Inherited // <b class="conum">(1)</b>
@kotlin.annotation.Retention(AnnotationRetention.RUNTIME)
@Requires(property = "datasource.url") // <b class="conum">(2)</b>
@Named // <b class="conum">(3)</b>
@Singleton // <b class="conum">(4)</b>
annotation class SqlRepository(
    val value: String = ""
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The annotation is declared as <code>@Inherited</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#conditionalBeans">Bean Conditions</a> will be inherited by child classes</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="#qualifiers">Bean Qualifiers</a> will be inherited by child classes</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="#scopes">Bean Scopes</a> will be inherited by child classes</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can also alias annotations and they will be inherited</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this meta-annotation in place you can add the annotation to a super class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Inherited Meta Annotations on a Super Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SqlRepository
public abstract class BaseSqlRepository {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Inherited Meta Annotations on a Super Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@SqlRepository
abstract class BaseSqlRepository {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Inherited Meta Annotations on a Super Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@SqlRepository
abstract class BaseSqlRepository</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then a subclass will inherit all the annotations:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Inherting Annotations in a Child Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Named;
import javax.sql.DataSource;

@Named("bookRepository")
public class BookRepository extends BaseSqlRepository {
    private final DataSource dataSource;

    public BookRepository(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Inherting Annotations in a Child Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Named
import javax.sql.DataSource

@Named("bookRepository")
class BookRepository extends BaseSqlRepository {
    private final DataSource dataSource

    BookRepository(DataSource dataSource) {
        this.dataSource = dataSource
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Inherting Annotations in a Child Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Named
import javax.sql.DataSource

@Named("bookRepository")
class BookRepository(private val dataSource: DataSource) : BaseSqlRepository()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A child class must at least have one bean definition annotation such as a scope or qualifier.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_aliasing_mapping_annotations">Aliasing / Mapping Annotations</h3>
<div class="paragraph">
<p>There are times when you may want to alias the value of an annotation member to the value of another annotation member. To do this, use the <a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a> annotation.</p>
</div>
<div class="paragraph">
<p>A common use case is for example when an annotation defines the <code>value()</code> member, but also supports other members. for example the <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation:</p>
</div>
<div class="listingblock">
<div class="title">The @Client Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public @interface Client {

    /**
     * @return The URL or service ID of the remote service
     */
    @AliasFor(member = "id") <i class="conum" data-value="1"></i><b>(1)</b>
    String value() default "";

    /**
     * @return The ID of the client
     */
    @AliasFor(member = "value") <i class="conum" data-value="2"></i><b>(2)</b>
    String id() default "";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>value</code> member also sets the <code>id</code> member</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>id</code> member also sets the <code>value</code> member</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With these aliases in place, whether you define <code>@Client("foo")</code> or <code>@Client(id="foo")</code>, both the <code>value</code> and <code>id</code> members will be set, making it easier to parse and work with the annotation.</p>
</div>
<div class="paragraph">
<p>If you do not have control over the annotation, another approach is to use an <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a>. To create an <code>AnnotationMapper</code>, do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the <a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a> interface</p>
</li>
<li>
<p>Define a <code>META-INF/services/io.micronaut.inject.annotation.AnnotationMapper</code> file referencing the implementation class</p>
</li>
<li>
<p>Add the JAR file containing the implementation to the <code>annotationProcessor</code> classpath (<code>kapt</code> for Kotlin)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because <code>AnnotationMapper</code> implementations must be on the annotation processor classpath, they should generally be in a project that includes few external dependencies to avoid polluting the annotation processor classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example <code>AnnotationMapper</code> that improves the introspection capabilities of JPA entities.</p>
</div>
<div class="listingblock">
<div class="title">EntityIntrospectedAnnotationMapper Mapper Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class EntityIntrospectedAnnotationMapper implements NamedAnnotationMapper {
    @NonNull
    @Override
    public String getName() {
        return "javax.persistence.Entity";
    }

    @Override
    public List&lt;AnnotationValue&lt;?&gt;&gt; map(AnnotationValue&lt;Annotation&gt; annotation, VisitorContext visitorContext) { <i class="conum" data-value="1"></i><b>(1)</b>
        final AnnotationValueBuilder&lt;Introspected&gt; builder = AnnotationValue.builder(Introspected.class)
                // don't bother with transients properties
                .member("excludedAnnotations", "javax.persistence.Transient"); <i class="conum" data-value="2"></i><b>(2)</b>
        return Arrays.asList(
                builder.build(),
                AnnotationValue.builder(ReflectiveAccess.class).build()
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>map</code> method receives a <a href="../api/io/micronaut/core/annotation/AnnotationValue.html">AnnotationValue</a> with the values for the annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>One or more annotations can be returned, in this case <code>@Transient</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example above implements the <a href="../api/io/micronaut/inject/annotation/NamedAnnotationMapper.html">NamedAnnotationMapper</a> interface which allows for annotations to be mixed with runtime code. To operate against a concrete annotation type, use <a href="../api/io/micronaut/inject/annotation/TypedAnnotationMapper.html">TypedAnnotationMapper</a> instead, although note it requires the annotation class itself to be on the annotation processor classpath.
</td>
</tr>
</table>
</div>
</div>

<h2 id="beanImport"><a class="anchor" href="#beanImport"></a>3.18 Importing Beans from Libraries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/beanImport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can use the <a href="../api/io/micronaut/context/annotation/Import.html">@Import</a> annotation to import beans from external, already compiled libraries that use JSR-330 annotations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bean import is currently only supported in the Java language as other languages have limitations on classpath scanning during source code processing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, to import the JSR-330 TCK into an application, add a dependency on the TCK:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:jakarta.inject")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;jakarta.inject&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Then define the <code>@Import</code> annotation on your <code>Application</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;

import io.micronaut.context.annotation.Import;

@Import( <i class="conum" data-value="1"></i><b>(1)</b>
        packages = { <i class="conum" data-value="2"></i><b>(2)</b>
                "org.atinject.tck.auto",
                "org.atinject.tck.auto.accessories"},
        annotated = "*") <i class="conum" data-value="3"></i><b>(3)</b>
public class Application {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Import.html">@Import</a> is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>packages</code> to import are defined. Note that Micronaut will not recurse through sub-packages so sub-packages need to be listed explicitly</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>By default Micronaut will only import classes that feature a scope or a qualifier. By using <code>*</code> you can make every type a bean.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In general <code>@Import</code> should be used in applications rather than libraries since if two libraries import the same beans the result will likely be a <a href="../api/io/micronaut/context/exceptions/NonUniqueBeanException.html">NonUniqueBeanException</a>
</td>
</tr>
</table>
</div>

<h2 id="nullabilityAnnotations"><a class="anchor" href="#nullabilityAnnotations"></a>3.19 Nullability Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/nullabilityAnnotations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In Java, you can use annotations showing whether a variable can or cannot be null. Such annotations aren&#8217;t part of the standard library, but you can add them separately.</p>
</div>
<div class="paragraph">
<p>Micronaut framework comes with its own set of annotations to declare nullability; <a href="../api/io/micronaut/core/annotation/Nullable.html">@Nullable</a> and <a href="../api/io/micronaut/core/annotation/NonNull.html">@NonNull</a>.</p>
</div>
<div class="paragraph">
<p><strong>Why does the Micronaut framework add its own set of nullability annotations instead of using one of the existing nullability annotations libraries?</strong></p>
</div>
<div class="paragraph">
<p>Throughout the history of the framework, we used other nullability annotation libraries. However, licensing issues made us change nullability annotations several times. To avoid having to change nullability annotations in the future,  we added our own set of nullability annotations in Micronaut Framework 2.4</p>
</div>
<div class="paragraph">
<p><strong>Are Micronaut Nullability annotations recognized by Kotlin?</strong></p>
</div>
<div class="paragraph">
<p>Yes, Micronaut nullability annotations are mapped at compilation time to <code>javax.annotation.Nullable</code> and <code>javax.annotation.Nonnull</code>.</p>
</div>
<div class="paragraph">
<p><strong>Why should you use nullability annotations in your code?</strong></p>
</div>
<div class="paragraph">
<p>It makes your code easier to consume from Kotlin. <a href="https://kotlinlang.org/docs/java-interop.html#nullability-annotations">Kotlin recognizes nullability annotations when you&#8217;re calling Java code from Kotlin code and will treat types according to their annotations</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, you can use <a href="../api/io/micronaut/core/annotation/Nullable.html">@Nullable</a> annotation to mark:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="#routing">Controller</a> method parameter as optional.</p>
</li>
<li>
<p>An injection point as optional. For example, when using constructor injection you can annotate one a constructor parameter as optional by adding the <a href="../api/io/micronaut/core/annotation/Nullable.html">@Nullable</a> annotation.</p>
</li>
</ul>
</div>

<h2 id="springBeans"><a class="anchor" href="#springBeans"></a>3.20 Micronaut Beans And Spring</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/springBeans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut has integrations with Spring in several forms. See the <a href="https://micronaut-projects.github.io/micronaut-spring/latest/guide">Micronaut Spring Documentation</a> for more information.</p>
</div>

<h2 id="android"><a class="anchor" href="#android"></a>3.21 Android Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/ioc/android.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut dependency injection is based on annotation processors and doesn&#8217;t rely on reflection, it can be used on Android when using the Android plugin 3.0.0 or higher.</p>
</div>
<div class="paragraph">
<p>This lets you use the same application framework for both your Android client and server implementation.</p>
</div>
<div class="sect1">
<h2 id="_configuring_your_android_build">Configuring Your Android Build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started, add the Micronaut annotation processors to the processor classpath using the <code>annotationProcessor</code> dependency configuration.</p>
</div>
<div class="paragraph">
<p>Include the Micronaut <code>micronaut-inject-java</code> dependency in both the <code>annotationProcessor</code> and <code>compileOnly</code> scopes of your Android build configuration:</p>
</div>
<div class="listingblock">
<div class="title">Example Android build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    ...
    annotationProcessor "io.micronaut:micronaut-inject-java:3.9.7"
    compileOnly "io.micronaut:micronaut-inject-java:3.9.7"
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>lint</code> as part of your build you may also need to disable the invalid packages check since Android includes a hard-coded check that regards the <code>javax.inject</code> package as invalid unless you use Dagger:</p>
</div>
<div class="listingblock">
<div class="title">Configure lint within build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">android {
    ...
    lintOptions {
        lintOptions { warning 'InvalidPackage' }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information on <a href="https://developer.android.com/studio/build/gradle-plugin-3-0-0-migration.html#annotationProcessor_config">configuring annotations processors</a> in the Android documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut <code>inject-java</code> dependency uses <a href="https://developer.android.com/studio/write/java8-support.html">Android Java 8 support</a> features.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_dependency_injection">Enabling Dependency Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have configured the classpath correctly, the next step is start the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates creating a subclass of <a href="https://developer.android.com/reference/android/app/Application.html">android.app.Application</a> for that purpose:</p>
</div>
<div class="listingblock">
<div class="title">Example Android Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import android.app.Activity;
import android.app.Application;
import android.os.Bundle;

import io.micronaut.context.ApplicationContext;
import io.micronaut.context.env.Environment;

public class BaseApplication extends Application { <i class="conum" data-value="1"></i><b>(1)</b>

    private ApplicationContext ctx;

    @Override
    public void onCreate() {
        super.onCreate();
        ctx = ApplicationContext.run(MainActivity.class, Environment.ANDROID); <i class="conum" data-value="2"></i><b>(2)</b>
        registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() { <i class="conum" data-value="3"></i><b>(3)</b>
            @Override
            public void onActivityCreated(Activity activity, Bundle bundle) {
                ctx.inject(activity);
            }
            ... // shortened for brevity; it is not necessary to implement other methods
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend the <code>android.app.Application</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Run the <code>ApplicationContext</code> with the <code>ANDROID</code> environment</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register an <code>ActivityLifecycleCallbacks</code> instance to allow dependency injection of Android <code>Activity</code> instances</td>
</tr>
</table>
</div>
</div>
</div>

<h1 id="config"><a class="anchor" href="#config"></a>4 Application Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Configuration in Micronaut takes inspiration from both Spring Boot and Grails, integrating configuration properties from multiple sources directly into the core IoC container.</p>
</div>
<div class="paragraph">
<p>Configuration can by default be provided in Java properties, YAML, JSON, or Groovy files. The convention is to search for a file named <code>application.yml</code>, <code>application.properties</code>, <code>application.json</code> or <code>application.groovy</code>.</p>
</div>
<div class="paragraph">
<p>In addition, like Spring and Grails, Micronaut allows overriding any property via system properties or environment variables.</p>
</div>
<div class="paragraph">
<p>Each source of configuration is modeled with the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> interface and the mechanism is extensible, allowing the implementation of additional <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> implementations.</p>
</div>

<h2 id="environments"><a class="anchor" href="#environments"></a>4.1 The Environment</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/environments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The application environment is modelled by the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface, which allows specifying one or many unique environment names when creating an <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ApplicationContext applicationContext = ApplicationContext.run("test", "android");
Environment environment = applicationContext.getEnvironment();

assertTrue(environment.getActiveNames().contains("test"));
assertTrue(environment.getActiveNames().contains("android"));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
ApplicationContext applicationContext = ApplicationContext.run("test", "android")
Environment environment = applicationContext.getEnvironment()

then:
environment.activeNames.contains("test")
environment.activeNames.contains("android")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val applicationContext = ApplicationContext.run("test", "android")
val environment = applicationContext.environment

assertTrue(environment.activeNames.contains("test"))
assertTrue(environment.activeNames.contains("android"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The active environment names allow loading different configuration files depending on the environment, and also using the <a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a> annotation to conditionally load beans or bean <a href="../api/io/micronaut/context/annotation/Configuration.html">@Configuration</a> packages.</p>
</div>
<div class="paragraph">
<p>In addition, Micronaut attempts to detect the current environments. For example within a Spock or JUnit test the <a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a> environment is automatically active.</p>
</div>
<div class="paragraph">
<p>Additional active environments can be specified using the <code>micronaut.environments</code> system property or the <code>MICRONAUT_ENVIRONMENTS</code> environment variable. These are specified as a comma-separated list. For example:</p>
</div>
<div class="listingblock">
<div class="title">Specifying environments</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -Dmicronaut.environments=foo,bar -jar myapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above activates environments called <code>foo</code> and <code>bar</code>.</p>
</div>
<div class="paragraph">
<p>Finally, Cloud environment names are also detected. See the section on <a href="#cloudConfiguration">Cloud Configuration</a> for more information.</p>
</div>
<div class="sect1">
<h2 id="_environment_priority">Environment Priority</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut loads property sources based on the environments specified, and if the same property key exists in multiple property sources specific to an environment, the environment order determines which value to use.</p>
</div>
<div class="paragraph">
<p>Micronaut uses the following hierarchy for environment processing (lowest to highest priority):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deduced environments</p>
</li>
<li>
<p>Environments from the <code>micronaut.environments</code> system property</p>
</li>
<li>
<p>Environments from the <code>MICRONAUT_ENVIRONMENTS</code> environment variable</p>
</li>
<li>
<p>Environments specified explicitly through the application context builder</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This also applies to <code>@MicronautTest(environments = &#8230;&#8203;)</code>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_disabling_environment_detection">Disabling Environment Detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Automatic detection of environments can be disabled by setting the <code>micronaut.env.deduction</code> system property or the <code>MICRONAUT_ENV_DEDUCTION</code> environment variable to <code>false</code>. This prevents Micronaut from detecting current environments, while still using any environments that are specifically provided as shown above.</p>
</div>
<div class="listingblock">
<div class="title">Disabling environment detection via system property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$  java -Dmicronaut.env.deduction=false -jar myapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can disable environment deduction using the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a> <code>deduceEnvironment</code> method when setting up your application.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testDisableEnvironmentDeductionViaBuilder() {
    ApplicationContext ctx = ApplicationContext.builder()
            .deduceEnvironment(false)
            .properties(Collections.singletonMap("micronaut.server.port", -1))
            .start();
    assertFalse(ctx.getEnvironment().getActiveNames().contains(Environment.TEST));
    ctx.close();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">void "test disable environment deduction via builder"() {
    when:
    ApplicationContext ctx = ApplicationContext.builder().deduceEnvironment(false).start()

    then:
    !ctx.environment.activeNames.contains(Environment.TEST)

    cleanup:
    ctx.close()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using ApplicationContextBuilder to disable environment deduction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">"test disable environment deduction via builder"() {
    val ctx = ApplicationContext.builder().deduceEnvironment(false).start()
    assertFalse(ctx.environment.activeNames.contains(Environment.TEST))
    ctx.close()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_default_environment">Default Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut supports the concept of one or many default environments.
A default environment is one that is only applied if no other environments are explicitly specified or deduced.
Environments can be explicitly specified either through the application context builder <code>Micronaut.build().environments(&#8230;&#8203;)</code>, through the <code>micronaut.environments</code> system property, or the <code>MICRONAUT_ENVIRONMENTS</code> environment variable.
Environments can be deduced to automatically apply the environment appropriate for cloud deployments.
If an environment is found through any of the above means, the default environment will <strong>not</strong> be applied.</p>
</div>
<div class="paragraph">
<p>To set the default environments, include a public static class that implements <a href="../api/io/micronaut/context/ApplicationContextConfigurer.html">ApplicationContextConfigurer</a> and is annotated with <a href="../api/io/micronaut/context/annotation/ContextConfigurer.html">ContextConfigurer</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Application {

    @ContextConfigurer
    public static class DefaultEnvironmentConfigurer implements ApplicationContextConfigurer {
        @Override
        public void configure(@NonNull ApplicationContextBuilder builder) {
            builder.defaultEnvironments(defaultEnvironment);
        }
    }

    public static void main(String[] args) {
        Micronaut.run(Application.class, args);
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Previously, we recommended using <code>Micronaut.defaultEnvironments("dev")</code> however this does not allow the Ahead of Time (AOT) compiler to detect the default environments.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_micronaut_banner">Micronaut Banner</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Micronaut 2.3 a banner is shown when the application starts. It is enabled by default and it also shows the Micronaut version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ ./gradlew run
 __  __ _                                  _
|  \/  (_) ___ _ __ ___  _ __   __ _ _   _| |_
| |\/| | |/ __| '__/ _ \| '_ \ / _` | | | | __|
| |  | | | (__| | | (_) | | | | (_| | |_| | |_
|_|  |_|_|\___|_|  \___/|_| |_|\__,_|\__,_|\__|
  Micronaut (3.9.7)

17:07:22.997 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 611ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>To customize the banner with your own ASCII Art (just plain ASCII at this moment), create the file <code>src/main/resources/micronaut-banner.txt</code> and it will be used instead.</p>
</div>
<div class="paragraph">
<p>To disable it, modify your <code>Application</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Application {

    public static void main(String[] args) {
        Micronaut.build(args)
                 .banner(false) <i class="conum" data-value="1"></i><b>(1)</b>
                 .start();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disable the banner</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="propertySource"><a class="anchor" href="#propertySource"></a>4.2 Externalized Configuration with PropertySources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/propertySource.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Additional <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances can be added to the environment prior to initializing the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ApplicationContext applicationContext = ApplicationContext.run(
        PropertySource.of(
                "test",
                CollectionUtils.mapOf(
                    "micronaut.server.host", "foo",
                    "micronaut.server.port", 8080
                )
        ),
        "test", "android");
Environment environment = applicationContext.getEnvironment();

assertEquals(
        "foo",
        environment.getProperty("micronaut.server.host", String.class).orElse("localhost")
);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
ApplicationContext applicationContext = ApplicationContext.run(
        PropertySource.of(
                "test",
                [
                    "micronaut.server.host": "foo",
                    "micronaut.server.port": 8080
                ]
        ),
        "test", "android")
Environment environment = applicationContext.getEnvironment()

then:
"foo" == environment.getProperty("micronaut.server.host", String.class).orElse("localhost")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initializing the Environment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val applicationContext = ApplicationContext.run(
    PropertySource.of(
        "test",
        mapOf(
            "micronaut.server.host" to "foo",
            "micronaut.server.port" to 8080
        )
    ),
    "test", "android"
)
val environment = applicationContext.environment

assertEquals(
    "foo",
    environment.getProperty("micronaut.server.host", String::class.java).orElse("localhost")
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource.of</a> method can be used to create a <code>PropertySource</code> from a map of values.</p>
</div>
<div class="paragraph">
<p>Alternatively one can register a <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a> by creating a <code>META-INF/services/io.micronaut.context.env.PropertySourceLoader</code> file containing a reference to the class name of the <code>PropertySourceLoader</code>.</p>
</div>
<div class="sect2">
<h3 id="_included_propertysource_loaders">Included PropertySource Loaders</h3>
<div class="paragraph">
<p>Micronaut by default contains <code>PropertySourceLoader</code> implementations that load properties from the given locations and priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Command line arguments</p>
</li>
<li>
<p>Properties from <code>SPRING_APPLICATION_JSON</code> (for Spring compatibility)</p>
</li>
<li>
<p>Properties from <code>MICRONAUT_APPLICATION_JSON</code></p>
</li>
<li>
<p>Java System Properties</p>
</li>
<li>
<p>OS environment variables</p>
</li>
<li>
<p>Configuration files loaded in order from the system property 'micronaut.config.files' or the environment variable <code>MICRONAUT_CONFIG_FILES</code>. The value can be a comma-separated list of paths with the last file having precedence. The files can be referenced from the file system as a path, or the classpath with a <code>classpath:</code> prefix.</p>
</li>
<li>
<p>Environment-specific properties from <code>application-{environment}.{extension}</code></p>
</li>
<li>
<p>Application-specific properties from <code>application.{extension}</code></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>.properties</code>, <code>.json</code>, <code>.yml</code> are supported out of the box. For Groovy users <code>.groovy</code> is supported as well.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that if you want full control of where your application loads configuration from you can disable the default <code>PropertySourceLoader</code> implementations listed above by calling the <code>enableDefaultPropertySources(false)</code> method of the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a> interface when starting your application.</p>
</div>
<div class="paragraph">
<p>In this case only explicit <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances that you add via the <code>propertySources(..)</code> method of the <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a> interface will be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_supplying_configuration_via_command_line">Supplying Configuration via Command Line</h3>
<div class="paragraph">
<p>Configuration can be supplied at the command line using Gradle or our Maven plugin. For example:</p>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run --args="-endpoints.health.enabled=true -config.property=test"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run -Dmn.appArgs="-endpoints.health.enabled=true -config.property=test"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the configuration to be a part of the context, the args from the main method must be passed to the context builder. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class, args); // passing args
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_secrets_and_sensitive_configuration">Secrets and Sensitive Configuration</h3>
<div class="paragraph">
<p>It is important to note that it is not recommended to store sensitive configuration such as passwords and tokens within configuration files that can potentially be checked into source control systems.</p>
</div>
<div class="paragraph">
<p>It is good practise to instead externalize sensitive configuration completely from the application code using preferably a external secret manager system (there are many options here, many provided by Cloud providers) or environment variables that are set during the deployment of the application. You can also use property placeholders (see the following section), to customize names of the environment variables to use and supply default values:</p>
</div>
<div class="openblock">
<div class="title">Using Property Value Placeholders to Define Secure Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">datasources.default.url=${JDBC_URL:`jdbc:mysql://localhost:3306/db`}
datasources.default.username=${JDBC_USER:root}
datasources.default.password=${JDBC_PASSWORD:}
datasources.default.dialect=MYSQL
datasources.default.driverClassName=${JDBC_DRIVER:com.mysql.cj.jdbc.Driver}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
  default:
    url: ${JDBC_URL:`jdbc:mysql://localhost:3306/db`}
    username: ${JDBC_USER:root}
    password: ${JDBC_PASSWORD:}
    dialect: MYSQL
    driverClassName: ${JDBC_DRIVER:com.mysql.cj.jdbc.Driver}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[datasources]
  [datasources.default]
    url="${JDBC_URL:`jdbc:mysql://localhost:3306/db`}"
    username="${JDBC_USER:root}"
    password="${JDBC_PASSWORD:}"
    dialect="MYSQL"
    driverClassName="${JDBC_DRIVER:com.mysql.cj.jdbc.Driver}"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">datasources {
  'default' {
    url = "${JDBC_URL:`jdbc:mysql://localhost:3306/db`}"
    username = "${JDBC_USER:root}"
    password = "${JDBC_PASSWORD:}"
    dialect = "MYSQL"
    driverClassName = "${JDBC_DRIVER:com.mysql.cj.jdbc.Driver}"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  datasources {
    default {
      url = "${JDBC_URL:`jdbc:mysql://localhost:3306/db`}"
      username = "${JDBC_USER:root}"
      password = "${JDBC_PASSWORD:}"
      dialect = "MYSQL"
      driverClassName = "${JDBC_DRIVER:com.mysql.cj.jdbc.Driver}"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "datasources": {
    "default": {
      "url": "${JDBC_URL:`jdbc:mysql://localhost:3306/db`}",
      "username": "${JDBC_USER:root}",
      "password": "${JDBC_PASSWORD:}",
      "dialect": "MYSQL",
      "driverClassName": "${JDBC_DRIVER:com.mysql.cj.jdbc.Driver}"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To securely externalize configuration consider using a secrets manager system supported by Micronaut such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#secretsmanager">AWS Secrets Manager</a>.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#secretManager">Google Cloud Secrets Manager</a>.</p>
</li>
<li>
<p><a href="https://docs.micronaut.io/latest/guide/#distributedConfigurationVault">HashiCorp Vault</a>.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-kubernetes/latest/guide/index.html#config-client">Kubernetes Secrets</a>.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-oracle-cloud/latest/guide/#vault">Oracle Cloud Vault</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_property_value_placeholders">Property Value Placeholders</h3>
<div class="paragraph">
<p>As mentioned in the previous section, Micronaut includes a property placeholder syntax to reference configuration properties both within configuration values and with any Micronaut annotation. See <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> and the section on <a href="#valueAnnotation">Configuration Injection</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Programmatic usage is also possible via the <a href="../api/io/micronaut/context/env/PropertyPlaceholderResolver.html">PropertyPlaceholderResolver</a> interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic syntax is to wrap a reference to a property in <code>${&#8230;&#8203;}</code>. For example:</p>
</div>
<div class="openblock">
<div class="title">Defining Property Placeholders</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">myapp.endpoint=http://${micronaut.server.host}:${micronaut.server.port}/foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
  endpoint: http://${micronaut.server.host}:${micronaut.server.port}/foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[myapp]
  endpoint="http://${micronaut.server.host}:${micronaut.server.port}/foo"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">myapp {
  endpoint = "http://${micronaut.server.host}:${micronaut.server.port}/foo"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  myapp {
    endpoint = "http://${micronaut.server.host}:${micronaut.server.port}/foo"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "myapp": {
    "endpoint": "http://${micronaut.server.host}:${micronaut.server.port}/foo"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example embeds references to the <code>micronaut.server.host</code> and <code>micronaut.server.port</code> properties.</p>
</div>
<div class="paragraph">
<p>You can specify default values by defining a value after the <code>:</code> character. For example:</p>
</div>
<div class="openblock">
<div class="title">Using Default Values</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">myapp.endpoint=http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
  endpoint: http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[myapp]
  endpoint="http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">myapp {
  endpoint = "http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  myapp {
    endpoint = "http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "myapp": {
    "endpoint": "http://${micronaut.server.host:localhost}:${micronaut.server.port:8080}/foo"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example defaults to <code>localhost</code> and port <code>8080</code> if no value is found (rather than throwing an exception). Note that if the default value contains a <code>:</code> character, you must escape it using backticks:</p>
</div>
<div class="openblock">
<div class="title">Using Backticks</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">myapp.endpoint=${server.address:`http://localhost:8080`}/foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">myapp:
  endpoint: ${server.address:`http://localhost:8080`}/foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[myapp]
  endpoint="${server.address:`http://localhost:8080`}/foo"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">myapp {
  endpoint = "${server.address:`http://localhost:8080`}/foo"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  myapp {
    endpoint = "${server.address:`http://localhost:8080`}/foo"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "myapp": {
    "endpoint": "${server.address:`http://localhost:8080`}/foo"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example looks for a <code>server.address</code> property and defaults to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>. This default value is escaped with backticks since it has a <code>:</code> character.</p>
</div>
</div>
<div class="sect2">
<h3 id="_property_value_binding">Property Value Binding</h3>
<div class="paragraph">
<p>Note that these property references should be in kebab case (lowercase and hyphen-separated) when placing references in code or in placeholder values. For example, use <code>micronaut.server.default-charset</code> and not <code>micronaut.server.defaultCharset</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut still allows specifying the latter in configuration, but normalizes the properties into kebab case form to optimize memory consumption and reduce complexity when resolving properties. The following table summarizes how properties are normalized from different sources:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Property Value Normalization</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Properties</th>
<th class="tableblock halign-left valign-top">Property Source</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myApp.myStuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.myStuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myApp.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my-app.my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties, YAML etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MYAPP_MYSTUFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myapp.mystuff</code>, <code>myapp-mystuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment Variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MY_APP_MY_STUFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>my.app.my.stuff</code>, <code>my.app.my-stuff</code>, <code>my.app-my.stuff</code>, <code>my.app-my-stuff</code>, <code>my-app.my.stuff</code>, <code>my-app.my-stuff</code>, <code>my-app-my.stuff</code>, <code>my-app-my-stuff</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Environment Variable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Environment variables are treated specially to allow more flexibility. Note that there is no way to reference an environment variable with camel-case.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Because the number of properties generated is exponential based on the number of <code>_</code> characters in an environment variable, it is recommended to refine which, if any, environment variables are included in configuration if the number of environment variables with multiple underscores is high.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To control how environment properties participate in configuration, call the respective methods on the <code>Micronaut</code> builder.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.build(args)
                .mainClass(Application.class)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String[] args) {
        Micronaut.build()
                .mainClass(Application)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Application class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.build(null)
                .mainClass(Application::class.java)
                .environmentPropertySource(false)
                //or
                .environmentVariableIncludes("THIS_ENV_ONLY")
                //or
                .environmentVariableExcludes("EXCLUDED_ENV")
                .start()
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration above does not have any impact on property placeholders. It is still possible to reference an environment variable in a placeholder regardless of whether environment configuration is disabled, or even if the specific property is explicitly excluded.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_random_properties">Using Random Properties</h3>
<div class="paragraph">
<p>You can use <code>random</code> values by using the following properties. These can be used in configuration files as variables like the following.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.application.name=myapplication
micronaut.application.instance.id=${random.shortuuid}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: myapplication
    instance:
      id: ${random.shortuuid}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.application]
    name="myapplication"
    [micronaut.application.instance]
      id="${random.shortuuid}"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  application {
    name = "myapplication"
    instance {
      id = "${random.shortuuid}"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    application {
      name = "myapplication"
      instance {
        id = "${random.shortuuid}"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "application": {
      "name": "myapplication",
      "instance": {
        "id": "${random.shortuuid}"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Random Values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An available random port number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.shortuuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID of only 10 chars in length (Note: As this isn&#8217;t full UUID, collision COULD occur)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID with dashes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">random.uuid2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random UUID without dashes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>random.int</code>, <code>random.integer</code>, <code>random.long</code> and <code>random.float</code> properties supports a range suffix whose syntax is one of as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>(max)</code> where max is an exclusive value</p>
</li>
<li>
<p><code>[min,max]</code> where min being inclusive and max being exclusive values.</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">instance.id=${random.int[5,10]}
instance.count=${random.int(5)}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">instance:
  id: ${random.int[5,10]}
  count: ${random.int(5)}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[instance]
  id="${random.int[5,10]}"
  count="${random.int(5)}"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">instance {
  id = "${random.int[5,10]}"
  count = "${random.int(5)}"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  instance {
    id = "${random.int[5,10]}"
    count = "${random.int(5)}"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "instance": {
    "id": "${random.int[5,10]}",
    "count": "${random.int(5)}"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The range could vary from negative to positive as well.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_fail_fast_property_injection">Fail Fast Property Injection</h3>
<div class="paragraph">
<p>For beans that inject required properties, the injection and potential failure will not occur until the bean is requested. To verify at startup that the properties exist and can be injected, the bean can be annotated with <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a>. Context-scoped beans are injected at startup, and startup fails if any required properties are missing or cannot be converted to the required type.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is recommended to use this feature sparingly to ensure fast startup.
</td>
</tr>
</table>
</div>
</div>

<h2 id="valueAnnotation"><a class="anchor" href="#valueAnnotation"></a>4.3 Configuration Injection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/valueAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can inject configuration values into beans using the <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> annotation.</p>
</div>
<div class="sect2">
<h3 id="_using_the_value_annotation">Using the <code>@Value</code> Annotation</h3>
<div class="paragraph">
<p>Consider the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Value;

import jakarta.inject.Singleton;

@Singleton
public class EngineImpl implements Engine {

    @Value("${my.engine.cylinders:6}") // <b class="conum">(1)</b>
    protected int cylinders;

    @Override
    public int getCylinders() {
        return cylinders;
    }

    @Override
    public String start() {// <b class="conum">(2)</b>
        return "Starting V" + getCylinders() + " Engine";
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Value

import jakarta.inject.Singleton

@Singleton
class EngineImpl implements Engine {

    @Value('${my.engine.cylinders:6}') // <b class="conum">(1)</b>
    protected int cylinders

    @Override
    int getCylinders() {
        cylinders
    }

    @Override
    String start() { // <b class="conum">(2)</b>
        "Starting V$cylinders Engine"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Value Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Value

import jakarta.inject.Singleton

@Singleton
class EngineImpl : Engine {

    @Value("\${my.engine.cylinders:6}") // <b class="conum">(1)</b>
    override var cylinders: Int = 0
        protected set

    override fun start(): String { // <b class="conum">(2)</b>
        return "Starting V$cylinders Engine"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Value</code> annotation accepts a string that can have embedded placeholder values (the default value can be provided by specifying a value after the colon <code>:</code> character). Also try to avoid setting the member visibility to <code>private</code>, since this requires Micronaut Framework to use reflection. Prefer to use <code>protected</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The injected value can then be used within code.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>@Value</code> can also be used to inject a static value. For example the following injects the number 10:</p>
</div>
<div class="listingblock">
<div class="title">Static @Value Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("10")
int number;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is even more useful when used to compose injected values combining static content and placeholders. For example to set up a URL:</p>
</div>
<div class="listingblock">
<div class="title">Placeholders with @Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("http://${my.host}:${my.port}")
URL url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the URL is constructed from two placeholder properties that must be present in configuration: <code>my.host</code> and <code>my.port</code>.</p>
</div>
<div class="paragraph">
<p>Remember that to specify a default value in a placeholder expression, you use the colon <code>:</code> character. However, if the default you specify includes a colon, you must escape the value with backticks. For example:</p>
</div>
<div class="listingblock">
<div class="title">Placeholders with @Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("${my.url:`http://foo.com`}")
URL url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is nothing special about <code>@Value</code> itself regarding the resolution of property value placeholders.</p>
</div>
<div class="paragraph">
<p>Due to Micronaut&#8217;s extensive support for annotation metadata you can use property placeholder expressions on any annotation. For example, to make the path of a <code>@Controller</code> configurable you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("${hello.controller.path:/hello}")
class HelloController {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case, if <code>hello.controller.path</code> is specified in configuration the controller will be mapped to the specified path, otherwise it will be mapped to <code>/hello</code>.</p>
</div>
<div class="paragraph">
<p>You can also make the target server for <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> configurable (although service discovery approaches are often better), for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("${my.server.url:`http://localhost:8080`}")
interface HelloClient {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the property <code>my.server.url</code> can be used to configure the client, otherwise the client falls back to a localhost address.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_property_annotation">Using the <code>@Property</code> Annotation</h3>
<div class="paragraph">
<p>Recall that the <a href="../api/io/micronaut/context/annotation/Value.html">@Value</a> annotation receives a String value which can be a mix of static content and placeholder expressions. This can lead to confusion if you attempt to do the following:</p>
</div>
<div class="listingblock">
<div class="title">Incorrect usage of <code>@Value</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Value("my.url")
String url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case the literal string value <code>my.url</code> is injected and set to the <code>url</code> field and <strong>not</strong> the value of the <code>my.url</code> property from your application configuration. This is because <code>@Value</code> only resolves placeholders within the value specified to it.</p>
</div>
<div class="paragraph">
<p>To inject a specific property name, you may be better off using <a href="../api/io/micronaut/context/annotation/Property.html">@Property</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Property;

import jakarta.inject.Inject;
import jakarta.inject.Singleton;

@Singleton
public class Engine {

    @Property(name = "my.engine.cylinders") // <b class="conum">(1)</b>
    protected int cylinders; // <b class="conum">(2)</b>

    private String manufacturer;

    public int getCylinders() {
        return cylinders;
    }

    public String getManufacturer() {
        return manufacturer;
    }

    @Inject
    public void setManufacturer(@Property(name = "my.engine.manufacturer") String manufacturer) { // <b class="conum">(3)</b>
        this.manufacturer = manufacturer;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Property

import jakarta.inject.Singleton

@Singleton
class Engine {

    @Property(name = "my.engine.cylinders") // <b class="conum">(1)</b>
    protected int cylinders // <b class="conum">(2)</b>

    @Property(name = "my.engine.manufacturer") //<b class="conum">(3)</b>
    String manufacturer

    int getCylinders() {
        cylinders
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Property</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Property

import jakarta.inject.Inject
import jakarta.inject.Singleton


@Singleton
class Engine {

    @field:Property(name = "my.engine.cylinders") // <b class="conum">(1)</b>
    protected var cylinders: Int = 0 // <b class="conum">(2)</b>

    @set:Inject
    @setparam:Property(name = "my.engine.manufacturer") // <b class="conum">(3)</b>
    var manufacturer: String? = null

    fun cylinders(): Int {
        return cylinders
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>my.engine.cylinders</code> property is resolved from configuration and injected into the field.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Fields subject to injection should not be private because expensive reflection must be used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@Property</code> annotation is used to inject through the setter</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because it is not possible to define a default value with <code>@Property</code>, if the value doesn&#8217;t exist or cannot be converted to the required type, bean instantiation will fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above instead injects the value of the <code>my.url</code> property resolved from application configuration. If the property cannot be found in configuration, an exception is thrown. As with other types of injection, the injection point can also be annotated with <code>@Nullable</code> to make the injection optional.</p>
</div>
<div class="paragraph">
<p>You can also use this feature to resolve sub maps. For example, consider the following configuration:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">datasources.default.name=mydb
jpa.default.properties.hibernate.hbm2ddl.auto=update
jpa.default.properties.hibernate.show_sql=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
  default:
    name: 'mydb'
jpa:
  default:
    properties:
      hibernate:
        hbm2ddl:
          auto: update
        show_sql: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[datasources]
  [datasources.default]
    name="mydb"
[jpa]
  [jpa.default]
    [jpa.default.properties]
      [jpa.default.properties.hibernate]
        [jpa.default.properties.hibernate.hbm2ddl]
          auto="update"
        show_sql=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">datasources {
  'default' {
    name = "mydb"
  }
}
jpa {
  'default' {
    properties {
      hibernate {
        hbm2ddl {
          auto = "update"
        }
        show_sql = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  datasources {
    default {
      name = "mydb"
    }
  }
  jpa {
    default {
      properties {
        hibernate {
          hbm2ddl {
            auto = "update"
          }
          show_sql = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "datasources": {
    "default": {
      "name": "mydb"
    }
  },
  "jpa": {
    "default": {
      "properties": {
        "hibernate": {
          "hbm2ddl": {
            "auto": "update"
          },
          "show_sql": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To resolve a flattened map containing only the properties starting with <code>hibernate</code>, use <code>@Property</code>, for example:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@Property</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(name = "jpa.default.properties")
Map&lt;String, String&gt; jpaProperties;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The injected map will contain the keys <code>hibernate.hbm2ddl.auto</code> and <code>hibernate.show_sql</code> and their values.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/core/convert/format/MapFormat.html">@MapFormat</a> annotation can be used to customize the injected map depending on whether you want nested keys or flat keys, and it allows customization of the key style via the <a href="../api/io/micronaut/core/naming/conventions/StringConvention.html">StringConvention</a> enum.
</td>
</tr>
</table>
</div>
</div>

<h2 id="configurationProperties"><a class="anchor" href="#configurationProperties"></a>4.4 Configuration Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/configurationProperties.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can create type-safe configuration by creating classes that are annotated with
 <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut will produce a reflection-free <code>@ConfigurationProperties</code> bean and will also at compile time calculate the property paths to evaluate, greatly improving the speed and efficiency of loading <code>@ConfigurationProperties</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import java.util.Optional;

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
public class EngineConfig {

    public String getManufacturer() {
        return manufacturer;
    }

    public void setManufacturer(String manufacturer) {
        this.manufacturer = manufacturer;
    }

    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    public CrankShaft getCrankShaft() {
        return crankShaft;
    }

    public void setCrankShaft(CrankShaft crankShaft) {
        this.crankShaft = crankShaft;
    }

    @NotBlank // <b class="conum">(2)</b>
    private String manufacturer = "Ford"; // <b class="conum">(3)</b>

    @Min(1L)
    private int cylinders;

    private CrankShaft crankShaft = new CrankShaft();

    @ConfigurationProperties("crank-shaft")
    public static class CrankShaft { // <b class="conum">(4)</b>

        private Optional&lt;Double&gt; rodLength = Optional.empty(); // <b class="conum">(5)</b>

        public Optional&lt;Double&gt; getRodLength() {
            return rodLength;
        }

        public void setRodLength(Optional&lt;Double&gt; rodLength) {
            this.rodLength = rodLength;
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties('my.engine') // <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank // <b class="conum">(2)</b>
    String manufacturer = "Ford" // <b class="conum">(3)</b>

    @Min(1L)
    int cylinders

    CrankShaft crankShaft = new CrankShaft()

    @ConfigurationProperties('crank-shaft')
    static class CrankShaft { // <b class="conum">(4)</b>
        Optional&lt;Double&gt; rodLength = Optional.empty() // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import java.util.Optional
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank // <b class="conum">(2)</b>
    var manufacturer = "Ford" // <b class="conum">(3)</b>

    @Min(1L)
    var cylinders: Int = 0

    var crankShaft = CrankShaft()

    @ConfigurationProperties("crank-shaft")
    class CrankShaft { // <b class="conum">(4)</b>
        var rodLength: Optional&lt;Double&gt; = Optional.empty() // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <code>javax.validation</code> annotations to validate the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default values can be assigned to the property</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Static inner classes can provide nested configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional configuration values can be wrapped in <code>java.util.Optional</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have prepared a type-safe configuration it can be injected into your beans like any other bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class EngineImpl implements Engine {
    private final EngineConfig config;

    public EngineImpl(EngineConfig config) { // <b class="conum">(1)</b>
        this.config = config;
    }

    @Override
    public int getCylinders() {
        return config.getCylinders();
    }

    @Override
    public String start() {// <b class="conum">(2)</b>
        return getConfig().getManufacturer() + " Engine Starting V" + getConfig().getCylinders() +
                " [rodLength=" + getConfig().getCrankShaft().getRodLength().orElse(6d) + "]";
    }

    public final EngineConfig getConfig() {
        return config;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class EngineImpl implements Engine {
    final EngineConfig config

    EngineImpl(EngineConfig config) { // <b class="conum">(1)</b>
        this.config = config
    }

    @Override
    int getCylinders() {
        config.cylinders
    }

    @Override
    String start() { // <b class="conum">(2)</b>
        "$config.manufacturer Engine Starting V$config.cylinders [rodLength=${config.crankShaft.rodLength.orElse(6.0d)}]"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class EngineImpl(val config: EngineConfig) : Engine {// <b class="conum">(1)</b>

    override val cylinders: Int
        get() = config.cylinders

    override fun start(): String {// <b class="conum">(2)</b>
        return "${config.manufacturer} Engine Starting V${config.cylinders} [rodLength=${config.crankShaft.rodLength.orElse(6.0)}]"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EngineConfig</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the configuration properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration values can then be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(1);
map.put("my.engine.cylinders", "8");
ApplicationContext applicationContext = ApplicationContext.run(map, "test");

Vehicle vehicle = applicationContext.getBean(Vehicle.class);
System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ApplicationContext applicationContext = ApplicationContext.run(
        ['my.engine.cylinders': '8'],
        "test"
)

def vehicle = applicationContext.getBean(Vehicle)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val map = mapOf( "my.engine.cylinders" to "8")
val applicationContext = ApplicationContext.run(map, "test")

val vehicle = applicationContext.getBean(Vehicle::class.java)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Ford Engine Starting V8 [rodLength=6.0]"</code></p>
</div>
<div class="paragraph">
<p>You can directly reference configuration properties in <code>@Requires</code> annotation to conditionally load beans using the following syntax: <code>@Requires(bean=Config.class, beanProperty="property", value="true")</code></p>
</div>
<div class="paragraph">
<p>Note for more complex configurations you can structure <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans through inheritance.</p>
</div>
<div class="paragraph">
<p>For example creating a subclass of <code>EngineConfig</code> with <code>@ConfigurationProperties('bar')</code> will resolve all properties under the path <code>my.engine.bar</code>.</p>
</div>
<div class="sect1">
<h2 id="_includes_excludes">Includes / Excludes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the cases where the configuration properties class inherits properties from a parent class, it may be desirable to exclude properties from the parent class. The <code>includes</code> and <code>excludes</code> members of the <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation allow for that functionality. The list applies to both local properties and inherited properties.</p>
</div>
<div class="paragraph">
<p>The names supplied to the includes/excludes list must be the "property" name. For example if a setter method is injected, the property name is the de-capitalized setter name (<code>setConnectionTimeout</code> &#8594; <code>connectionTimeout</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configurationPropertiesAccessorsStyle">Change accessors style</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since 3.3, Micronaut supports defining different accessors prefixes for getters and setter other than the default <code>get</code> and <code>set</code> defined for Java Beans. Annotate your POJO or <code>@ConfigurationProperties</code> class with the <a href="../api/io/micronaut/core/annotation/AccessorsStyle.html">@AccessorsStyle</a> annotation.</p>
</div>
<div class="paragraph">
<p>This is useful when you write the getters and setters in a fluent way. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@AccessorsStyle</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import io.micronaut.core.annotation.AccessorsStyle;

@AccessorsStyle(readPrefixes = "", writePrefixes = "") <i class="conum" data-value="1"></i><b>(1)</b>
@ConfigurationProperties("my.engine")
public class EngineConfig {

    private String manufacturer;
    private int cylinders;

    public EngineConfig(String manufacturer, int cylinders) {
        this.manufacturer = manufacturer;
        this.cylinders = cylinders;
    }

    public String manufacturer() { <i class="conum" data-value="2"></i><b>(2)</b>
        return manufacturer;
    }

    public void manufacturer(String manufacturer) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.manufacturer = manufacturer;
    }

    public int cylinders() { <i class="conum" data-value="2"></i><b>(2)</b>
        return cylinders;
    }

    public void cylinders(int cylinders) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.cylinders = cylinders;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Micronaut will use an empty prefix for getters and setters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the getters and setters with an empty prefix.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can inject <code>EngineConfig</code> and use it with <code>engineConfig.manufacturer()</code> and <code>engineConfig.cylinders()</code> to retrieve the values from configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_property_type_conversion">Property Type Conversion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut uses the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> bean to convert values when resolving properties. You can register additional converters for types not supported by Micronaut by defining beans that implement the <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> interface.</p>
</div>
<div class="paragraph">
<p>Micronaut features some built-in conversions that are useful, which are detailed below.</p>
</div>
<div class="sect2">
<h3 id="_duration_conversion">Duration Conversion</h3>
<div class="paragraph">
<p>Durations can be specified by appending the unit with a number. Supported units are <code>s</code>, <code>ms</code>, <code>m</code> etc. The following table summarizes examples:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Duration Conversion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 milliseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 hours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10ns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 10 nanoseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PT15M</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code> of 15 minutes using ISO-8601 format</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example to configure the default HTTP client read timeout:</p>
</div>
<div class="openblock">
<div class="title">Using Duration Values</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.read-timeout=15s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      read-timeout: 15s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      read-timeout="15s"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      readTimeout = "15s"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        read-timeout = "15s"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "read-timeout": "15s"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_list_array_conversion">List / Array Conversion</h3>
<div class="paragraph">
<p>Lists and arrays can be specified in Java properties files as comma-separated values, or in YAML using native YAML lists. The generic types are used to convert the values. For example in YAML:</p>
</div>
<div class="openblock">
<div class="title">Specifying lists or arrays in YAML</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">my.app.integers[0]=1
my.app.integers[1]=2
my.app.urls[0]=http://foo.com
my.app.urls[1]=http://bar.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">my:
  app:
    integers:
      - 1
      - 2
    urls:
      - http://foo.com
      - http://bar.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[my]
  [my.app]
    integers=[
      1,
      2
    ]
    urls=[
      "http://foo.com",
      "http://bar.com"
    ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">my {
  app {
    integers = [1, 2]
    urls = ["http://foo.com", "http://bar.com"]
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  my {
    app {
      integers = [1, 2]
      urls = ["http://foo.com", "http://bar.com"]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "my": {
    "app": {
      "integers": [1, 2],
      "urls": ["http://foo.com", "http://bar.com"]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For the above example configurations you can define properties to bind to with the target type supplied via generics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Integer&gt; integers;
List&lt;URL&gt; urls;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_readable_bytes">Readable Bytes</h3>
<div class="paragraph">
<p>You can annotate any setter parameter with <a href="../api/io/micronaut/core/convert/format/ReadableBytes.html">@ReadableBytes</a> to allow the value to be set using a shorthand syntax for specifying bytes, kilobytes etc. For example the following is taken from <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a>:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@ReadableBytes</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setMaxContentLength(@ReadableBytes int maxContentLength) {
    this.maxContentLength = maxContentLength;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above in place you can set <code>micronaut.http.client.max-content-length</code> using the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. @ReadableBytes Conversion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Value</th>
<th class="tableblock halign-left valign-top">Resulting Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10mb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 megabytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10kb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 kilobytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10gb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 gigabytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1024</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A raw byte length</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_formatting_dates">Formatting Dates</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/convert/format/Format.html">@Format</a> annotation can be used on setters to specify the date format to use when binding <code>java.time</code> date objects.</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@Format</code> for Dates</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setMyDate(@Format("yyyy-MM-dd") LocalDate date) {
    this.myDate = date;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_builder">Configuration Builder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many frameworks and tools already use builder-style classes to construct configuration.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">@ConfigurationBuilder</a> annotation to populate a builder-style class with configuration values. <a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">ConfigurationBuilder</a> can be applied to fields or methods in a class annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</p>
</div>
<div class="paragraph">
<p>Since there is no consistent way to define builders in the Java world, one or more method prefixes can be specified in the annotation to support builder methods like <code>withXxx</code> or <code>setXxx</code>. If the builder methods have no prefix, assign an empty string to the parameter.</p>
</div>
<div class="paragraph">
<p>A configuration prefix can also be specified to tell Micronaut where to look for configuration values. By default, builder methods use the configuration prefix specified in a class-level <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationBuilder Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.ConfigurationBuilder;
import io.micronaut.context.annotation.ConfigurationProperties;

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
class EngineConfig {

    @ConfigurationBuilder(prefixes = "with") // <b class="conum">(2)</b>
    EngineImpl.Builder builder = EngineImpl.builder();

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "crank-shaft") // <b class="conum">(3)</b>
    CrankShaft.Builder crankShaft = CrankShaft.builder();

    private SparkPlug.Builder sparkPlug = SparkPlug.builder();

    SparkPlug.Builder getSparkPlug() {
        return sparkPlug;
    }

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "spark-plug") // <b class="conum">(4)</b>
    void setSparkPlug(SparkPlug.Builder sparkPlug) {
        this.sparkPlug = sparkPlug;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationBuilder Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationBuilder
import io.micronaut.context.annotation.ConfigurationProperties

@ConfigurationProperties('my.engine') // <b class="conum">(1)</b>
class EngineConfig {

    @ConfigurationBuilder(prefixes = "with") // <b class="conum">(2)</b>
    EngineImpl.Builder builder = EngineImpl.builder()

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "crank-shaft") // <b class="conum">(3)</b>
    CrankShaft.Builder crankShaft = CrankShaft.builder()

    SparkPlug.Builder sparkPlug = SparkPlug.builder()

    @ConfigurationBuilder(prefixes = "with", configurationPrefix = "spark-plug") // <b class="conum">(4)</b>
    void setSparkPlug(SparkPlug.Builder sparkPlug) {
        this.sparkPlug = sparkPlug
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationBuilder Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationBuilder
import io.micronaut.context.annotation.ConfigurationProperties

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
internal class EngineConfig {

    @ConfigurationBuilder(prefixes = ["with"])  // <b class="conum">(2)</b>
    val builder = EngineImpl.builder()

    @ConfigurationBuilder(prefixes = ["with"], configurationPrefix = "crank-shaft") // <b class="conum">(3)</b>
    val crankShaft = CrankShaft.builder()

    @set:ConfigurationBuilder(prefixes = ["with"], configurationPrefix = "spark-plug") // <b class="conum">(4)</b>
    var sparkPlug = SparkPlug.builder()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ConfigurationProperties</code> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first builder can be configured without the class configuration prefix; it inherits from the above.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The second builder can be configured with the class configuration prefix + the <code>configurationPrefix</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The third builder demonstrates that the annotation can be applied to a method as well as a property.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, only single-argument builder methods are supported. For methods with no arguments, set the <code>allowZeroArgs</code> parameter of the annotation to <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like in the previous example, we can construct an <code>EngineImpl</code>. Since we are using a builder, we can use a factory class to build the engine from the builder.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Factory;

import jakarta.inject.Singleton;

@Factory
class EngineFactory {

    @Singleton
    EngineImpl buildEngine(EngineConfig engineConfig) {
        return engineConfig.builder.build(engineConfig.crankShaft, engineConfig.getSparkPlug());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Factory

import jakarta.inject.Singleton

@Factory
class EngineFactory {

    @Singleton
    EngineImpl buildEngine(EngineConfig engineConfig) {
        engineConfig.builder.build(engineConfig.crankShaft, engineConfig.sparkPlug)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Factory Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Factory
import jakarta.inject.Singleton

@Factory
internal class EngineFactory {

    @Singleton
    fun buildEngine(engineConfig: EngineConfig): EngineImpl {
        return engineConfig.builder.build(engineConfig.crankShaft, engineConfig.sparkPlug)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The engine that was returned can then be injected anywhere an engine is required.</p>
</div>
<div class="paragraph">
<p>Configuration values can be supplied from one of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
        properties.put("my.engine.cylinders"             ,"4");
        properties.put("my.engine.manufacturer"          , "Subaru");
        properties.put("my.engine.crank-shaft.rod-length", 4);
        properties.put("my.engine.spark-plug.name"       , "6619 LFR6AIX");
        properties.put("my.engine.spark-plug.type"       , "Iridium");
        properties.put("my.engine.spark-plug.companyName", "NGK");
        ApplicationContext applicationContext = ApplicationContext.run(properties, "test");

        Vehicle vehicle = applicationContext.getBean(Vehicle.class);
        System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">        ApplicationContext applicationContext = ApplicationContext.run(
                ['my.engine.cylinders'             : '4',
                 'my.engine.manufacturer'          : 'Subaru',
                 'my.engine.crank-shaft.rod-length': 4,
                 'my.engine.spark-plug.name'       : '6619 LFR6AIX',
                 'my.engine.spark-plug.type'       : 'Iridium',
                 'my.engine.spark-plug.companyName': 'NGK'
                ],
                "test"
        )

        Vehicle vehicle = applicationContext.getBean(Vehicle)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">        val applicationContext = ApplicationContext.run(
                mapOf(
                        "my.engine.cylinders" to "4",
                        "my.engine.manufacturer" to "Subaru",
                        "my.engine.crank-shaft.rod-length" to 4,
                        "my.engine.spark-plug.name" to "6619 LFR6AIX",
                        "my.engine.spark-plug.type" to "Iridium",
                        "my.engine.spark-plug.company" to "NGK"
                ),
                "test"
        )

        val vehicle = applicationContext.getBean(Vehicle::class.java)
        println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Subaru Engine Starting V4 [rodLength=4.0, sparkPlug=Iridium(NGK 6619 LFR6AIX)]"</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mapformat">MapFormat</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For some use cases it may be desirable to accept a map of arbitrary configuration properties that can be supplied to a bean, especially if the bean represents a third-party API where not all the possible configuration properties are known. For example, a datasource may accept a map of configuration properties specific to a particular database driver, allowing the user to specify any desired options in the map without coding each property explicitly.</p>
</div>
<div class="paragraph">
<p>For this purpose, the <a href="../api/io/micronaut/core/convert/format/MapFormat.html">MapFormat</a> annotation lets you bind a map to a single configuration property, and specify whether to accept a flat map of keys to values, or a nested map (where the values may be additional maps).</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import io.micronaut.core.convert.format.MapFormat;

import javax.validation.constraints.Min;
import java.util.Map;

@ConfigurationProperties("my.engine")
public class EngineConfig {

    @Min(1L)
    private int cylinders;

    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) //<b class="conum">(1)</b>
    private Map&lt;Integer, String&gt; sensors;

    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    public Map&lt;Integer, String&gt; getSensors() {
        return sensors;
    }

    public void setSensors(Map&lt;Integer, String&gt; sensors) {
        this.sensors = sensors;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.convert.format.MapFormat

import javax.validation.constraints.Min

@ConfigurationProperties('my.engine')
class EngineConfig {

    @Min(1L)
    int cylinders

    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) //<b class="conum">(1)</b>
    Map&lt;Integer, String&gt; sensors
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@MapFormat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.convert.format.MapFormat
import javax.validation.constraints.Min

@ConfigurationProperties("my.engine")
class EngineConfig {

    @Min(1L)
    var cylinders: Int = 0

    @MapFormat(transformation = MapFormat.MapTransformation.FLAT) //<b class="conum">(1)</b>
    var sensors: Map&lt;Int, String&gt;? = null
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the <code>transformation</code> argument to the annotation; possible values are <code>MapTransformation.FLAT</code> (for flat maps) and <code>MapTransformation.NESTED</code> (for nested maps)</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class EngineImpl implements Engine {

    @Inject
    EngineConfig config;

    @Override
    public Map getSensors() {
        return config.getSensors();
    }

    @Override
    public String start() {
        return "Engine Starting V" + getConfig().getCylinders() +
               " [sensors=" + getSensors().size() + "]";
    }

    public EngineConfig getConfig() {
        return config;
    }

    public void setConfig(EngineConfig config) {
        this.config = config;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class EngineImpl implements Engine {

    @Inject EngineConfig config

    @Override
    Map getSensors() {
        config.sensors
    }

    @Override
    String start() {
        "Engine Starting V$config.cylinders [sensors=${sensors.size()}]"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">EngineImpl</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class EngineImpl : Engine {

    override val sensors: Map&lt;*, *&gt;?
        get() = config!!.sensors

    @Inject
    var config: EngineConfig? = null

    override fun start(): String {
        return "Engine Starting V${config!!.cylinders} [sensors=${sensors!!.size}]"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now a map of properties can be supplied to the <code>my.engine.sensors</code> configuration property.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(2);
map.put("my.engine.cylinders", "8");

Map&lt;Integer, String&gt; map1 = new LinkedHashMap&lt;&gt;(2);
map1.put(0, "thermostat");
map1.put(1, "fuel pressure");

map.put("my.engine.sensors", map1);

ApplicationContext applicationContext = ApplicationContext.run(map, "test");

Vehicle vehicle = applicationContext.getBean(Vehicle.class);
System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ApplicationContext applicationContext = ApplicationContext.run(
        ['my.engine.cylinders': '8',
         'my.engine.sensors'  : [0: 'thermostat',
                                 1: 'fuel pressure']],
        "test"
)

def vehicle = applicationContext.getBean(Vehicle)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Use Map Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val subMap = mapOf(
    0 to "thermostat",
    1 to "fuel pressure"
)
val map = mapOf(
    "my.engine.cylinders" to "8",
    "my.engine.sensors" to subMap
)

val applicationContext = ApplicationContext.run(map, "test")

val vehicle = applicationContext.getBean(Vehicle::class.java)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Engine Starting V8 [sensors=2]"</code></p>
</div>
</div>
</div>

<h2 id="customTypeConverter"><a class="anchor" href="#customTypeConverter"></a>4.5 Custom Type Converters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/customTypeConverter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut includes an extensible type conversion mechanism. To add additional type converters you register beans of type <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use one of the built-in converters (Map to an Object) or create your own.</p>
</div>
<div class="paragraph">
<p>Consider the following <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">ConfigurationProperties</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
public class MyConfigurationProperties {

    public static final String PREFIX = "myapp";

    protected LocalDate updatedAt;

    public LocalDate getUpdatedAt() {
        return updatedAt;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
class MyConfigurationProperties {

    public static final String PREFIX = "myapp"

    protected LocalDate updatedAt

    LocalDate getUpdatedAt() {
        updatedAt
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@ConfigurationProperties(MyConfigurationProperties.PREFIX)
class MyConfigurationProperties {

    var updatedAt: LocalDate? = null
        protected set

    companion object {
        const val PREFIX = "myapp"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type <code>MyConfigurationProperties</code> has a property named <code>updatedAt</code> of type <a href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html">LocalDate</a>.</p>
</div>
<div class="paragraph">
<p>To bind this property from a map via configuration:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static ApplicationContext ctx;

@BeforeClass
public static void setupCtx() {
    ctx = ApplicationContext.run(
            new LinkedHashMap&lt;String, Object&gt;() {{
                put("myapp.updatedAt", // <b class="conum">(1)</b>
                        new LinkedHashMap&lt;String, Integer&gt;() {{
                            put("day", 28);
                            put("month", 10);
                            put("year", 1982);
                        }}
                );
            }}
    );
}

@AfterClass
public static void teardownCtx() {
    if(ctx != null) {
        ctx.stop();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@AutoCleanup
@Shared
ApplicationContext ctx = ApplicationContext.run(
        "myapp.updatedAt": [day: 28, month: 10, year: 1982]  // <b class="conum">(1)</b>
)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">lateinit var ctx: ApplicationContext

@BeforeEach
fun setup() {
    ctx = ApplicationContext.run(
        mapOf(
            "myapp.updatedAt" to mapOf( // <b class="conum">(1)</b>
                "day" to 28,
                "month" to 10,
                "year" to 1982
            )
        )
    )
}

@AfterEach
fun teardown() {
    ctx?.close()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note how we match the <code>myapp</code> prefix and <code>updatedAt</code> property name in our <code>MyConfigurationProperties</code> class above</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This won&#8217;t work by default, since there is no built-in conversion from <code>Map</code> to <code>LocalDate</code>. To resolve this, define a custom <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.convert.ConversionContext;
import io.micronaut.core.convert.ConversionService;
import io.micronaut.core.convert.TypeConverter;

import jakarta.inject.Singleton;
import java.time.DateTimeException;
import java.time.LocalDate;
import java.util.Map;
import java.util.Optional;

@Singleton
public class MapToLocalDateConverter implements TypeConverter&lt;Map, LocalDate&gt; { // <b class="conum">(1)</b>

    private final ConversionService&lt;?&gt;  conversionService;

    public MapToLocalDateConverter(ConversionService&lt;?&gt; conversionService) { // <b class="conum">(2)</b>
        this.conversionService = conversionService;
    }

    @Override
    public Optional&lt;LocalDate&gt; convert(Map propertyMap, Class&lt;LocalDate&gt; targetType, ConversionContext context) {
        Optional&lt;Integer&gt; day = conversionService.convert(propertyMap.get("day"), Integer.class);
        Optional&lt;Integer&gt; month = conversionService.convert(propertyMap.get("month"), Integer.class);
        Optional&lt;Integer&gt; year = conversionService.convert(propertyMap.get("year"), Integer.class);
        if (day.isPresent() &amp;&amp; month.isPresent() &amp;&amp; year.isPresent()) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())); // <b class="conum">(3)</b>
            } catch (DateTimeException e) {
                context.reject(propertyMap, e); // <b class="conum">(4)</b>
                return Optional.empty();
            }
        }

        return Optional.empty();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.convert.TypeConverter

import jakarta.inject.Singleton
import java.time.DateTimeException
import java.time.LocalDate

@Singleton
class MapToLocalDateConverter implements TypeConverter&lt;Map, LocalDate&gt; { // <b class="conum">(1)</b>

    final ConversionService&lt;?&gt;  conversionService

    MapToLocalDateConverter(ConversionService&lt;?&gt; conversionService) { // <b class="conum">(2)</b>
        this.conversionService = conversionService;
    }

    @Override
    Optional&lt;LocalDate&gt; convert(Map propertyMap, Class&lt;LocalDate&gt; targetType, ConversionContext context) {
        Optional&lt;Integer&gt; day = conversionService.convert(propertyMap.day, Integer)
        Optional&lt;Integer&gt; month = conversionService.convert(propertyMap.month, Integer)
        Optional&lt;Integer&gt; year = conversionService.convert(propertyMap.year, Integer)
        if (day.present &amp;&amp; month.present &amp;&amp; year.present) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())) // <b class="conum">(3)</b>
            } catch (DateTimeException e) {
                context.reject(propertyMap, e) // <b class="conum">(4)</b>
                return Optional.empty()
            }
        }
        return Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.convert.TypeConverter
import jakarta.inject.Singleton
import java.time.DateTimeException
import java.time.LocalDate
import java.util.Optional

@Singleton
class MapToLocalDateConverter(
    private val conversionService: ConversionService&lt;*&gt; // <b class="conum">(2)</b>
)
    : TypeConverter&lt;Map&lt;*, *&gt;, LocalDate&gt; { // <b class="conum">(1)</b>

    override fun convert(propertyMap: Map&lt;*, *&gt;, targetType: Class&lt;LocalDate&gt;, context: ConversionContext): Optional&lt;LocalDate&gt; {
        val day = conversionService.convert(propertyMap["day"], Int::class.java)
        val month = conversionService.convert(propertyMap["month"], Int::class.java)
        val year = conversionService.convert(propertyMap["year"], Int::class.java)
        if (day.isPresent &amp;&amp; month.isPresent &amp;&amp; year.isPresent) {
            try {
                return Optional.of(LocalDate.of(year.get(), month.get(), day.get())) // <b class="conum">(3)</b>
            } catch (e: DateTimeException) {
                context.reject(propertyMap, e) // <b class="conum">(4)</b>
                return Optional.empty()
            }
        }

        return Optional.empty()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class implements <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> which has two generic arguments, the type you are converting from, and the type you are converting to</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constructor injects a bean of type <code>ConversionService</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The implementation delegates to the injected conversion service to convert the values from the Map used to create a <code>LocalDate</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If an exception occurs during binding, call <code>reject(..)</code> which propagates additional information to the container</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Register new type converters by declaring a bean of type <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a>. <code>ConversionService.SHARED</code> is deprecated,  and it will be removed in a future version of the Micronaut Framework.
</td>
</tr>
</table>
</div>

<h2 id="eachProperty"><a class="anchor" href="#eachProperty"></a>4.6 Using @EachProperty to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/eachProperty.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation is great for a single configuration class, but sometimes you want multiple instances, each with its own distinct configuration. That is where <a href="../api/io/micronaut/context/annotation/EachProperty.html">EachProperty</a> comes in.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> annotation creates a <code>ConfigurationProperties</code> bean for each sub-property within the given name. As an example consider the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.net.URI;
import java.net.URISyntaxException;

import io.micronaut.context.annotation.Parameter;
import io.micronaut.context.annotation.EachProperty;

@EachProperty("test.datasource")  // <b class="conum">(1)</b>
public class DataSourceConfiguration {

    private final String name;
    private URI url = new URI("localhost");

    public DataSourceConfiguration(@Parameter String name) // <b class="conum">(2)</b>
            throws URISyntaxException {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public URI getUrl() { // <b class="conum">(3)</b>
        return url;
    }

    public void setUrl(URI url) {
        this.url = url;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.EachProperty
import io.micronaut.context.annotation.Parameter

@EachProperty("test.datasource") // <b class="conum">(1)</b>
class DataSourceConfiguration {

    final String name
    URI url = new URI("localhost") // <b class="conum">(3)</b>

    DataSourceConfiguration(@Parameter String name) // <b class="conum">(2)</b>
            throws URISyntaxException {
        this.name = name
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.EachProperty
import io.micronaut.context.annotation.Parameter
import java.net.URI
import java.net.URISyntaxException

@EachProperty("test.datasource")  // <b class="conum">(1)</b>
class DataSourceConfiguration
@Throws(URISyntaxException::class)
constructor(@param:Parameter val name: String) { // <b class="conum">(2)</b>
    var url = URI("localhost") // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@EachProperty</code> annotation defines the property name to be handled.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Parameter</code> annotation can be used to inject the name of the sub-property that defines the name of the bean (which is also the bean qualifier)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each property of the bean is bound to configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above <code>DataSourceConfiguration</code> defines a <code>url</code> property to configure one or more data sources. The URLs themselves can be configured using any of the <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances evaluated to Micronaut:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ApplicationContext applicationContext = ApplicationContext.run(PropertySource.of(
        "test",
        CollectionUtils.mapOf(
                "test.datasource.one.url", "jdbc:mysql://localhost/one",
                "test.datasource.two.url", "jdbc:mysql://localhost/two")
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ApplicationContext applicationContext = ApplicationContext.run(PropertySource.of(
        "test",
        [
                "test.datasource.one.url": "jdbc:mysql://localhost/one",
                "test.datasource.two.url": "jdbc:mysql://localhost/two"
        ]
))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Providing Configuration to @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val applicationContext = ApplicationContext.run(PropertySource.of(
        "test",
        mapOf(
                "test.datasource.one.url" to "jdbc:mysql://localhost/one",
                "test.datasource.two.url" to "jdbc:mysql://localhost/two"
        )
))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example two data sources (called <code>one</code> and <code>two</code>) are defined under the <code>test.datasource</code> prefix defined earlier in the <code>@EachProperty</code> annotation. Each of these configuration entries triggers the creation of a new <code>DataSourceConfiguration</code> bean such that the following test succeeds:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Collection&lt;DataSourceConfiguration&gt; beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration.class);
assertEquals(2, beansOfType.size()); // <b class="conum">(1)</b>

DataSourceConfiguration firstConfig = applicationContext.getBean(
        DataSourceConfiguration.class,
        Qualifiers.byName("one") // <b class="conum">(2)</b>
);

assertEquals(
        new URI("jdbc:mysql://localhost/one"),
        firstConfig.getUrl()
);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
Collection&lt;DataSourceConfiguration&gt; beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration.class)
assertEquals(2, beansOfType.size()) // <b class="conum">(1)</b>

DataSourceConfiguration firstConfig = applicationContext.getBean(
        DataSourceConfiguration.class,
        Qualifiers.byName("one") // <b class="conum">(2)</b>
)

then:
new URI("jdbc:mysql://localhost/one") == firstConfig.getUrl()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Evaluating Beans Built by @EachProperty</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val beansOfType = applicationContext.getBeansOfType(DataSourceConfiguration::class.java)
assertEquals(2, beansOfType.size) // <b class="conum">(1)</b>

val firstConfig = applicationContext.getBean(
        DataSourceConfiguration::class.java,
        Qualifiers.byName("one") // <b class="conum">(2)</b>
)

assertEquals(
        URI("jdbc:mysql://localhost/one"),
        firstConfig.url
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All beans of type <code>DataSourceConfiguration</code> can be retrieved using <code>getBeansOfType</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Individual beans can be retrieved by using the <code>byName</code> qualifier.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_list_based_binding">List-Based Binding</h3>
<div class="paragraph">
<p>The default behavior of <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> is to bind from a map style of configuration, where the key is the named qualifier of the bean and the value is the data to bind from. For cases where map style configuration doesn&#8217;t make sense, it is possible to inform Micronaut that the class is bound from a list. Simply set the <code>list</code> member on the annotation to true.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@EachProperty List Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.EachProperty;
import io.micronaut.context.annotation.Parameter;
import io.micronaut.core.order.Ordered;

import java.time.Duration;

@EachProperty(value = "ratelimits", list = true) // <b class="conum">(1)</b>
public class RateLimitsConfiguration implements Ordered { // <b class="conum">(2)</b>

    private final Integer index;
    private Duration period;
    private Integer limit;

    RateLimitsConfiguration(@Parameter Integer index) { // <b class="conum">(3)</b>
        this.index = index;
    }

    @Override
    public int getOrder() {
        return index;
    }

    public Duration getPeriod() {
        return period;
    }

    public void setPeriod(Duration period) {
        this.period = period;
    }

    public Integer getLimit() {
        return limit;
    }

    public void setLimit(Integer limit) {
        this.limit = limit;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@EachProperty List Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.EachProperty
import io.micronaut.context.annotation.Parameter
import io.micronaut.core.order.Ordered

import java.time.Duration

@EachProperty(value = "ratelimits", list = true) // <b class="conum">(1)</b>
class RateLimitsConfiguration implements Ordered { // <b class="conum">(2)</b>

    private final Integer index
    Duration period
    Integer limit

    RateLimitsConfiguration(@Parameter Integer index) { // <b class="conum">(3)</b>
        this.index = index
    }

    @Override
    int getOrder() {
        index
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@EachProperty List Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.EachProperty
import io.micronaut.context.annotation.Parameter
import io.micronaut.core.order.Ordered
import java.time.Duration

@EachProperty(value = "ratelimits", list = true) // <b class="conum">(1)</b>
class RateLimitsConfiguration
    constructor(@param:Parameter private val index: Int) // <b class="conum">(3)</b>
    : Ordered { // <b class="conum">(2)</b>

    var period: Duration? = null
    var limit: Int? = null

    override fun getOrder(): Int {
        return index
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>list</code> member of the annotation is set to <code>true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implement <code>Ordered</code> if order matters when retrieving the beans</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The index is injected into the constructor</td>
</tr>
</table>
</div>
</div>

<h2 id="eachBean"><a class="anchor" href="#eachBean"></a>4.7 Using @EachBean to Drive Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/eachBean.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> annotation is a great way to drive dynamic configuration, but typically you want to inject that configuration into another bean that depends on it. Injecting a single instance with a hard-coded qualifier is not a great solution, hence <code>@EachProperty</code> is typically used in combination with <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory // <b class="conum">(1)</b>
public class DataSourceFactory {

    @EachBean(DataSourceConfiguration.class) // <b class="conum">(2)</b>
    DataSource dataSource(DataSourceConfiguration configuration) { // <b class="conum">(3)</b>
        URI url = configuration.getUrl();
        return new DataSource(url);
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Factory // <b class="conum">(1)</b>
class DataSourceFactory {

    @EachBean(DataSourceConfiguration) // <b class="conum">(2)</b>
    DataSource dataSource(DataSourceConfiguration configuration) { // <b class="conum">(3)</b>
        URI url = configuration.url
        return new DataSource(url)
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @EachBean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Factory // <b class="conum">(1)</b>
class DataSourceFactory {

    @EachBean(DataSourceConfiguration::class) // <b class="conum">(2)</b>
    internal fun dataSource(configuration: DataSourceConfiguration): DataSource { // <b class="conum">(3)</b>
        val url = configuration.url
        return DataSource(url)
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The above example defines a bean <a href="../api/io/micronaut/context/annotation/Factory.html">Factory</a> that creates instances of <code>javax.sql.DataSource</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a> annotation indicates that a new <code>DataSource</code> bean will be created for each <code>DataSourceConfiguration</code> defined in the previous section.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>DataSourceConfiguration</code> instance is injected as a method argument and used to drive the configuration of each <code>javax.sql.DataSource</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>@EachBean</code> requires that the parent bean has a <code>@Named</code> qualifier, since the qualifier is inherited by each bean created by <code>@EachBean</code>.</p>
</div>
<div class="paragraph">
<p>In other words, to retrieve the <code>DataSource</code> created by <code>test.datasource.one</code> you can do:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Collection&lt;DataSource&gt; beansOfType = applicationContext.getBeansOfType(DataSource.class);
assertEquals(2, beansOfType.size()); // <b class="conum">(1)</b>

DataSource firstConfig = applicationContext.getBean(
        DataSource.class,
        Qualifiers.byName("one") // <b class="conum">(2)</b>
);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
Collection&lt;DataSource&gt; beansOfType = applicationContext.getBeansOfType(DataSource)
assertEquals(2, beansOfType.size()) // <b class="conum">(1)</b>

DataSource firstConfig = applicationContext.getBean(
        DataSource,
        Qualifiers.byName("one") // <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a Qualifier</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val beansOfType = applicationContext.getBeansOfType(DataSource::class.java)
assertEquals(2, beansOfType.size) // <b class="conum">(1)</b>

val firstConfig = applicationContext.getBean(
        DataSource::class.java,
        Qualifiers.byName("one") // <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We demonstrate here that there are indeed two data sources. How can we get one in particular?</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By using <code>Qualifiers.byName("one")</code>, we can select which of the two beans we&#8217;d like to reference.</td>
</tr>
</table>
</div>

<h2 id="immutableConfig"><a class="anchor" href="#immutableConfig"></a>4.8 Immutable Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/immutableConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.3, Micronaut supports the definition of immutable configuration.</p>
</div>
<div class="paragraph">
<p>There are two ways to define immutable configuration. The preferred way is to define an interface annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import io.micronaut.core.bind.annotation.Bindable;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import java.util.Optional;

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
public interface EngineConfig {

    @Bindable(defaultValue = "Ford") // <b class="conum">(2)</b>
    @NotBlank // <b class="conum">(3)</b>
    String getManufacturer();

    @Min(1L)
    int getCylinders();

    @NotNull
    CrankShaft getCrankShaft(); // <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    interface CrankShaft { // <b class="conum">(5)</b>
        Optional&lt;Double&gt; getRodLength(); // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank
import javax.validation.constraints.NotNull

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
interface EngineConfig {

    @Bindable(defaultValue = "Ford") // <b class="conum">(2)</b>
    @NotBlank // <b class="conum">(3)</b>
    String getManufacturer()

    @Min(1L)
    int getCylinders()

    @NotNull
    CrankShaft getCrankShaft() // <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    static interface CrankShaft { // <b class="conum">(5)</b>
        Optional&lt;Double&gt; getRodLength() // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank
import javax.validation.constraints.NotNull

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
interface EngineConfig {

    @get:Bindable(defaultValue = "Ford") // <b class="conum">(2)</b>
    @get:NotBlank // <b class="conum">(3)</b>
    val manufacturer: String

    @get:Min(1L)
    val cylinders: Int

    @get:NotNull
    val crankShaft: CrankShaft // <b class="conum">(4)</b>

    @ConfigurationProperties("crank-shaft")
    interface CrankShaft { // <b class="conum">(5)</b>
        val rodLength: Double? // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation takes the configuration prefix and is declared on an interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a> to set a default value</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Validation annotations can also be used</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can also specify references to other <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> beans.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can nest immutable configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional configuration can be indicated by returning an <code>Optional</code> or specifying <code>@Nullable</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case Micronaut provides a compile-time implementation that delegates all getters to call the <code>getProperty(..)</code> method of the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface.</p>
</div>
<div class="paragraph">
<p>This has the advantage that if the application configuration is <a href="#refreshable">refreshed</a> (for example by invoking the <code>/refresh</code> endpoint), the injected interface automatically sees the new values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you try to specify any other abstract method other than a getter, a compilation error occurs (default methods are supported).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another way to implement immutable configuration is to define a class and use the <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a> annotation on a constructor of a <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> or <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> bean.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.bind.annotation.Bindable;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.context.annotation.ConfigurationInject;
import io.micronaut.context.annotation.ConfigurationProperties;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import java.util.Optional;

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
public class EngineConfig {

    private final String manufacturer;
    private final int cylinders;
    private final CrankShaft crankShaft;

    @ConfigurationInject // <b class="conum">(2)</b>
    public EngineConfig(
            @Bindable(defaultValue = "Ford") @NotBlank String manufacturer, // <b class="conum">(3)</b>
            @Min(1L) int cylinders, // <b class="conum">(4)</b>
            @NotNull CrankShaft crankShaft) {
        this.manufacturer = manufacturer;
        this.cylinders = cylinders;
        this.crankShaft = crankShaft;
    }

    public String getManufacturer() {
        return manufacturer;
    }

    public int getCylinders() {
        return cylinders;
    }

    public CrankShaft getCrankShaft() {
        return crankShaft;
    }

    @ConfigurationProperties("crank-shaft")
    public static class CrankShaft { // <b class="conum">(5)</b>
        private final Double rodLength; // <b class="conum">(6)</b>

        @ConfigurationInject
        public CrankShaft(@Nullable Double rodLength) {
            this.rodLength = rodLength;
        }

        public Optional&lt;Double&gt; getRodLength() {
            return Optional.ofNullable(rodLength);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationInject
import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable

import javax.annotation.Nullable
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank
import javax.validation.constraints.NotNull

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
class EngineConfig {

    final String manufacturer
    final int cylinders
    final CrankShaft crankShaft

    @ConfigurationInject // <b class="conum">(2)</b>
    EngineConfig(
            @Bindable(defaultValue = "Ford") @NotBlank String manufacturer, // <b class="conum">(3)</b>
            @Min(1L) int cylinders, // <b class="conum">(4)</b>
            @NotNull CrankShaft crankShaft) {
        this.manufacturer = manufacturer
        this.cylinders = cylinders
        this.crankShaft = crankShaft
    }

    @ConfigurationProperties("crank-shaft")
    static class CrankShaft { // <b class="conum">(5)</b>
        private final Double rodLength // <b class="conum">(6)</b>

        @ConfigurationInject
        CrankShaft(@Nullable Double rodLength) {
            this.rodLength = rodLength
        }

        Optional&lt;Double&gt; getRodLength() {
            Optional.ofNullable(rodLength)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationInject
import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.core.bind.annotation.Bindable
import java.util.Optional
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank
import javax.validation.constraints.NotNull

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
data class EngineConfig @ConfigurationInject // <b class="conum">(2)</b>
    constructor(
        @Bindable(defaultValue = "Ford") @NotBlank val manufacturer: String, // <b class="conum">(3)</b>
        @Min(1) val cylinders: Int, // <b class="conum">(4)</b>
        @NotNull val crankShaft: CrankShaft) {

    @ConfigurationProperties("crank-shaft")
    data class CrankShaft @ConfigurationInject
    constructor(// <b class="conum">(5)</b>
            private val rodLength: Double? // <b class="conum">(6)</b>
    ) {

        fun getRodLength(): Optional&lt;Double&gt; {
            return Optional.ofNullable(rodLength)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation takes the configuration prefix</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a> annotation is defined on the constructor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a> to set a default value</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Validation annotations can be used too</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can nest immutable configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional configuration can be indicated with <code>@Nullable</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a> annotation provides a hint to Micronaut to prioritize binding values from configuration instead of injecting beans.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using this approach, to make the configuration refreshable, add the <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a> annotation to the class as well. This allows the bean to be re-created in the case of a <a href="#refreshable">runtime configuration refresh event</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are a few exceptions to this rule. Micronaut will not perform configuration binding for a parameter if any of these conditions is met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The parameter is annotated with <code>@Value</code> (explicit binding)</p>
</li>
<li>
<p>The parameter is annotated with <code>@Property</code> (explicit binding)</p>
</li>
<li>
<p>The parameter is annotated with <code>@Parameter</code> (parameterized bean handling)</p>
</li>
<li>
<p>The parameter is annotated with <code>@Inject</code> (generic bean injection)</p>
</li>
<li>
<p>The type of the parameter is annotated with a bean scope (such as <code>@Singleton</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you have prepared a type-safe configuration it can be injected into your beans like any other bean:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class Engine {
    private final EngineConfig config;

    public Engine(EngineConfig config) {// <b class="conum">(1)</b>
        this.config = config;
    }

    public int getCylinders() {
        return config.getCylinders();
    }

    public String start() {// <b class="conum">(2)</b>
        return getConfig().getManufacturer() + " Engine Starting V" + getConfig().getCylinders() +
                " [rodLength=" + getConfig().getCrankShaft().getRodLength().orElse(6.0d) + "]";
    }

    public final EngineConfig getConfig() {
        return config;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class Engine {
    private final EngineConfig config

    Engine(EngineConfig config) {// <b class="conum">(1)</b>
        this.config = config
    }

    int getCylinders() {
        return config.cylinders
    }

    String start() {// <b class="conum">(2)</b>
        return "$config.manufacturer Engine Starting V$config.cylinders [rodLength=${config.crankShaft.rodLength.orElse(6.0d)}]"
    }

    final EngineConfig getConfig() {
        return config
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Dependency Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class Engine(val config: EngineConfig)// <b class="conum">(1)</b>
{
    val cylinders: Int
        get() = config.cylinders

    fun start(): String {// <b class="conum">(2)</b>
        return  "${config.manufacturer} Engine Starting V${config.cylinders} [rodLength=${config.crankShaft.getRodLength().orElse(6.0)}]"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>EngineConfig</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the configuration properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuration values can then be supplied when running the application. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ApplicationContext applicationContext = ApplicationContext.run(CollectionUtils.mapOf(
        "my.engine.cylinders", "8",
        "my.engine.crank-shaft.rod-length", "7.0"
));

Vehicle vehicle = applicationContext.getBean(Vehicle.class);
System.out.println(vehicle.start());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ApplicationContext applicationContext = ApplicationContext.run(
        "my.engine.cylinders": "8",
        "my.engine.crank-shaft.rod-length": "7.0"
)

Vehicle vehicle = applicationContext.getBean(Vehicle)
System.out.println(vehicle.start())</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Supply Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val map = mapOf(
        "my.engine.cylinders" to "8",
        "my.engine.crank-shaft.rod-length" to "7.0"
)
val applicationContext = ApplicationContext.run(map)

val vehicle = applicationContext.getBean(Vehicle::class.java)
println(vehicle.start())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example prints: <code>"Ford Engine Starting V8 [rodLength=7B.0]"</code></p>
</div>
<div class="sect1">
<h2 id="_customizing_accessors">Customizing accessors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As already explained in <a href="#configurationPropertiesAccessorsStyle">Change accessors style</a>, it is also possible to customize the accessors when creating immutable configuration properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;
import io.micronaut.core.annotation.AccessorsStyle;
import io.micronaut.core.bind.annotation.Bindable;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import java.util.Optional;

@ConfigurationProperties("my.engine") <i class="conum" data-value="1"></i><b>(1)</b>
@AccessorsStyle(readPrefixes = "read") <i class="conum" data-value="2"></i><b>(2)</b>
public interface EngineConfigAccessors {

    @Bindable(defaultValue = "Ford")
    @NotBlank
    String readManufacturer(); <i class="conum" data-value="3"></i><b>(3)</b>

    @Min(1L)
    int readCylinders(); <i class="conum" data-value="3"></i><b>(3)</b>

    @NotNull
    CrankShaft readCrankShaft(); <i class="conum" data-value="3"></i><b>(3)</b>

    @ConfigurationProperties("crank-shaft")
    @AccessorsStyle(readPrefixes = "read") <i class="conum" data-value="4"></i><b>(4)</b>
    interface CrankShaft {
        Optional&lt;Double&gt; readRodLength(); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation takes the configuration prefix and is declared on an interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/core/annotation/AccessorsStyle.html">@AccessorsStyle</a> annotation defines the <code>readPrefixes</code> as <code>read</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The getters are all prefixed with <code>read</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Nested immutable configuration can also be annotated with <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The getter is prefixed with <code>read</code>.</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="bootstrap"><a class="anchor" href="#bootstrap"></a>4.9 Bootstrap Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/bootstrap.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Most application configuration is stored in your configuration file (e.g <code>application.yml</code>), environment-specific files like <code>application-{environment}.{extension}</code>, environment and system properties, etc.
These configure the application context.
But during application startup, before the application context is created, a "bootstrap" context can be created to store configuration necessary to retrieve additional configuration for the main context. Typically that additional configuration is in some remote source.</p>
</div>
<div class="paragraph">
<p>The bootstrap context is enabled depending on the following conditions. The conditions are checked in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If The <a href="../api/io/micronaut/context/env/Environment.html#BOOTSTRAP_CONTEXT_PROPERTY">BOOTSTRAP_CONTEXT_PROPERTY</a> system property is set, that value determines if the bootstrap context is enabled.</p>
</li>
<li>
<p>If The application context builder option <a href="../api/io/micronaut/context/ApplicationContextBuilder.html#bootstrapEnvironment">bootstrapEnvironment</a> is set, that value determines if the bootstrap context is enabled.</p>
</li>
<li>
<p>If a <a href="../api/io/micronaut/context/env/BootstrapPropertySourceLocator.html">BootstrapPropertySourceLocator</a> bean is present the bootstrap context is enabled. Normally this comes from the <code>micronaut-discovery-client</code> dependency.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration properties that must be present before application context configuration properties are resolved, for example when using distributed configuration, are stored in a bootstrap configuration file. Once it is determined the bootstrap context is enabled (as described above), the bootstrap configuration files are read using the same rules as regular application configuration.
See the <a href="#propertySource">property source</a> documentation for the details. The only difference is the prefix (<code>bootstrap</code> instead of <code>application</code>).</p>
</div>
<div class="paragraph">
<p>The file name prefix <code>bootstrap</code> is configurable with a system property <a href="../api/io/micronaut/context/env/Environment.html#BOOTSTRAP_NAME_PROPERTY">micronaut.bootstrap.name</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The bootstrap context configuration is carried over to the main context automatically, so it is not necessary for configuration properties to be duplicated in the main context. In addition, the bootstrap context configuration has a higher precedence than the main context, meaning if a configuration property appears in both contexts, then the value will be taken from the bootstrap context first.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That means if a configuration property is needed in both places, it should go into the bootstrap context configuration.</p>
</div>
<div class="paragraph">
<p>See the <a href="#distributedConfiguration">distributed configuration</a> section of the documentation for the list of integrations with common distributed configuration solutions.</p>
</div>
<div class="sect2">
<h3 id="_bootstrap_context_beans">Bootstrap Context Beans</h3>
<div class="paragraph">
<p>In order for a bean to be resolvable in the bootstrap context it must be annotated with <a href="../api/io/micronaut/context/annotation/BootstrapContextCompatible.html">@BootstrapContextCompatible</a>. If any given bean is not annotated then it will not be able to be resolved in the bootstrap context. Typically any bean that is participating in the process of retrieving distributed configuration needs to be annotated.</p>
</div>
</div>

<h2 id="jmx"><a class="anchor" href="#jmx"></a>4.10 JMX Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/config/jmx.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut provides basic support for JMX.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://micronaut-projects.github.io/micronaut-jmx/latest/guide/">documentation</a> for the micronaut-jmx project.</p>
</div>

<h1 id="aop"><a class="anchor" href="#aop"></a>5 Aspect Oriented Programming</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Aspect-Oriented Programming (AOP) has historically had many incarnations and some very complicated implementations. Generally AOP can be thought of as a way to define cross-cutting concerns (logging, transactions, tracing, etc.) separate from application code in the form of aspects that define advice.</p>
</div>
<div class="paragraph">
<p>There are typically two forms of advice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Around Advice - decorates a method or class</p>
</li>
<li>
<p>Introduction Advice - introduces new behaviour to a class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In modern Java applications, declaring advice typically takes the form of an annotation. The most well-known annotation advice in the Java world is probably <code>@Transactional</code>, which demarcates transaction boundaries in Spring and Grails applications.</p>
</div>
<div class="paragraph">
<p>The disadvantage of traditional approaches to AOP is the heavy reliance on runtime proxy creation and reflection, which slows application performance, makes debugging harder and increases memory consumption.</p>
</div>
<div class="paragraph">
<p>Micronaut tries to address these concerns by providing a simple compile-time AOP API that does not use reflection.</p>
</div>

<h2 id="aroundAdvice"><a class="anchor" href="#aroundAdvice"></a>5.1 Around Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/aroundAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The most common type of advice you may want to apply is "Around" advice, which lets you decorate a method&#8217;s behaviour.</p>
</div>
<div class="sect1">
<h2 id="_writing_around_advice">Writing Around Advice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step is to define an annotation that will trigger a <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.Around;
import java.lang.annotation.*;
import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Retention(RUNTIME) // <b class="conum">(1)</b>
@Target({TYPE, METHOD}) // <b class="conum">(2)</b>
@Around // <b class="conum">(3)</b>
public @interface NotNull {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.aop.Around
import java.lang.annotation.*
import static java.lang.annotation.ElementType.*
import static java.lang.annotation.RetentionPolicy.RUNTIME

@Documented
@Retention(RUNTIME) // <b class="conum">(1)</b>
@Target([TYPE, METHOD]) // <b class="conum">(2)</b>
@Around // <b class="conum">(3)</b>
@interface NotNull {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.aop.Around
import kotlin.annotation.AnnotationRetention.RUNTIME
import kotlin.annotation.AnnotationTarget.CLASS
import kotlin.annotation.AnnotationTarget.FILE
import kotlin.annotation.AnnotationTarget.FUNCTION
import kotlin.annotation.AnnotationTarget.PROPERTY_GETTER
import kotlin.annotation.AnnotationTarget.PROPERTY_SETTER

@MustBeDocumented
@Retention(RUNTIME) // <b class="conum">(1)</b>
@Target(CLASS, FILE, FUNCTION, PROPERTY_GETTER, PROPERTY_SETTER) // <b class="conum">(2)</b>
@Around // <b class="conum">(3)</b>
annotation class NotNull</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The retention policy of the annotation should be <code>RUNTIME</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generally you want to be able to apply advice at the class or method level so the target types are <code>TYPE</code> and <code>METHOD</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/aop/Around.html">@Around</a> annotation is added to tell Micronaut that the annotation is Around advice</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next step to defining Around advice is to implement a <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a>. For example the following interceptor disallows parameters with <code>null</code> values:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.InterceptorBean;
import io.micronaut.aop.MethodInterceptor;
import io.micronaut.aop.MethodInvocationContext;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.core.type.MutableArgumentValue;

import jakarta.inject.Singleton;
import java.util.Map;
import java.util.Objects;
import java.util.Optional;

@Singleton
@InterceptorBean(NotNull.class) // <b class="conum">(1)</b>
public class NotNullInterceptor implements MethodInterceptor&lt;Object, Object&gt; { // <b class="conum">(2)</b>
    @Nullable
    @Override
    public Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        Optional&lt;Map.Entry&lt;String, MutableArgumentValue&lt;?&gt;&gt;&gt; nullParam = context.getParameters()
            .entrySet()
            .stream()
            .filter(entry -&gt; {
                MutableArgumentValue&lt;?&gt; argumentValue = entry.getValue();
                return Objects.isNull(argumentValue.getValue());
            })
            .findFirst(); // <b class="conum">(3)</b>
        if (nullParam.isPresent()) {
            throw new IllegalArgumentException("Null parameter [" + nullParam.get().getKey() + "] not allowed"); // <b class="conum">(4)</b>
        }
        return context.proceed(); // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.aop.InterceptorBean
import io.micronaut.aop.MethodInterceptor
import io.micronaut.aop.MethodInvocationContext
import io.micronaut.core.annotation.Nullable
import io.micronaut.core.type.MutableArgumentValue

import jakarta.inject.Singleton

@Singleton
@InterceptorBean(NotNull) // <b class="conum">(1)</b>
class NotNullInterceptor implements MethodInterceptor&lt;Object, Object&gt; { // <b class="conum">(2)</b>
    @Nullable
    @Override
    Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        Optional&lt;Map.Entry&lt;String, MutableArgumentValue&lt;?&gt;&gt;&gt; nullParam = context.parameters
            .entrySet()
            .stream()
            .filter({entry -&gt;
                MutableArgumentValue&lt;?&gt; argumentValue = entry.value
                return Objects.isNull(argumentValue.value)
            })
            .findFirst() // <b class="conum">(3)</b>
        if (nullParam.present) {
            throw new IllegalArgumentException("Null parameter [${nullParam.get().key}] not allowed") // <b class="conum">(4)</b>
        }
        return context.proceed() // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MethodInterceptor Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.aop.InterceptorBean
import io.micronaut.aop.MethodInterceptor
import io.micronaut.aop.MethodInvocationContext
import java.util.Objects
import jakarta.inject.Singleton

@Singleton
@InterceptorBean(NotNull::class) // <b class="conum">(1)</b>
class NotNullInterceptor : MethodInterceptor&lt;Any, Any&gt; { // <b class="conum">(2)</b>
    override fun intercept(context: MethodInvocationContext&lt;Any, Any&gt;): Any? {
        val nullParam = context.parameters
                .entries
                .stream()
                .filter { entry -&gt;
                    val argumentValue = entry.value
                    Objects.isNull(argumentValue.value)
                }
                .findFirst() // <b class="conum">(3)</b>
        return if (nullParam.isPresent) {
            throw IllegalArgumentException("Null parameter [${nullParam.get().key}] not allowed") // <b class="conum">(4)</b>
        } else {
            context.proceed() // <b class="conum">(5)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/aop/InterceptorBean.html">@InterceptorBean</a> annotation is used to indicate what annotation the interceptor is associated with. Note that <a href="../api/io/micronaut/aop/InterceptorBean.html">@InterceptorBean</a> is meta-annotated with a default scope of <code>@Singleton</code> therefore if you want a new interceptor created and associated with each intercepted bean you should annotate the interceptor with <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An interceptor implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The passed <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> is used to find the first parameter that is <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If a <code>null</code> parameter is found an exception is thrown</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Otherwise <a href="../api/io/micronaut/aop/InvocationContext.html#proceed--">proceed()</a> is called to proceed with the method invocation.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut AOP interceptors use no reflection which improves performance and reducing stack trace sizes, thus improving debugging.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apply the annotation to target classes to put the new <code>MethodInterceptor</code> to work:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Singleton;

@Singleton
public class NotNullExample {

    @NotNull
    void doWork(String taskName) {
        System.out.println("Doing job: " + taskName);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Singleton

@Singleton
class NotNullExample {

    @NotNull
    void doWork(String taskName) {
        println "Doing job: $taskName"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Singleton

@Singleton
open class NotNullExample {

    @NotNull
    open fun doWork(taskName: String?) {
        println("Doing job: $taskName")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever the type <code>NotNullExample</code> is injected into a class, a compile-time-generated proxy is injected that decorates method calls with the <code>@NotNull</code> advice defined earlier. You can verify that the advice works by writing a test. The following test verifies that the expected exception is thrown when the argument is <code>null</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Rule
public ExpectedException thrown = ExpectedException.none();

@Test
public void testNotNull() {
    try (ApplicationContext applicationContext = ApplicationContext.run()) {
        NotNullExample exampleBean = applicationContext.getBean(NotNullExample.class);

        thrown.expect(IllegalArgumentException.class);
        thrown.expectMessage("Null parameter [taskName] not allowed");

        exampleBean.doWork(null);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">void "test not null"() {
    when:
    def applicationContext = ApplicationContext.run()
    def exampleBean = applicationContext.getBean(NotNullExample)

    exampleBean.doWork(null)

    then:
    IllegalArgumentException e = thrown()
    e.message == 'Null parameter [taskName] not allowed'

    cleanup:
    applicationContext.close()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Test
fun testNotNull() {
    val applicationContext = ApplicationContext.run()
    val exampleBean = applicationContext.getBean(NotNullExample::class.java)

    val exception = shouldThrow&lt;IllegalArgumentException&gt; {
        exampleBean.doWork(null)
    }
    exception.message shouldBe "Null parameter [taskName] not allowed"
    applicationContext.close()
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Micronaut injection happens at compile time, generally the advice should be packaged in a dependent JAR file that is on the classpath when the above test is compiled. It should not be in the same codebase since you don&#8217;t want the test to be compiled before the advice itself is compiled.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_proxy_generation">Customizing Proxy Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default behaviour of the <a href="../api/io/micronaut/aop/Around.html">Around</a> annotation is to generate a proxy at compile time that is a subclass of the proxied class. In other words, in the previous example a compile-time subclass of the <code>NotNullExample</code> class will be produced where proxied methods are decorated with interceptor handling, and the original behaviour is invoked via a call to <code>super</code>.</p>
</div>
<div class="paragraph">
<p>This behaviour is more efficient as only one instance of the bean is required, however depending on the use case you may wish to alter this behaviour. The <code>@Around</code> annotation supports various attributes that allow you to alter this behaviour, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>proxyTarget</code> (defaults to <code>false</code>) - If set to <code>true</code>, instead of a subclass that calls <code>super</code>, the proxy delegates to the original bean instance</p>
</li>
<li>
<p><code>hotswap</code> (defaults to <code>false</code>) - Same as <code>proxyTarget=true</code>, but in addition the proxy implements <a href="../api/io/micronaut/aop/HotSwappableInterceptedProxy.html">HotSwappableInterceptedProxy</a> which wraps each method call in a <code>ReentrantReadWriteLock</code> and allows swapping the target instance at runtime.</p>
</li>
<li>
<p><code>lazy</code> (defaults to <code>false</code>) - By default Micronaut eagerly initializes the proxy target when the proxy is created. If set to <code>true</code> the proxy target is instead resolved lazily for each method call.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aop_advice_on_factory_beans">AOP Advice on @Factory Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The semantics of AOP advice when applied to <a href="#factories">Bean Factories</a> differs from regular beans, with the following rules applying:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>AOP advice applied at the class level of a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> bean applies the advice to the factory itself and not to any beans defined with the <a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a> annotation.</p>
</li>
<li>
<p>AOP advice applied on a method annotated with a bean scope applies the AOP advice to the bean that the factory produces.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Consider the following two examples:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the type level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Timed
@Factory
public class MyFactory {

    @Prototype
    public MyBean myBean() {
        return new MyBean();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the type level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Timed
@Factory
class MyFactory {

    @Prototype
    MyBean myBean() {
        new MyBean()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the type level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Timed
@Factory
open class MyFactory {

    @Prototype
    open fun myBean(): MyBean {
        return MyBean()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example logs the time it takes to create the <code>MyBean</code> bean.</p>
</div>
<div class="paragraph">
<p>Now consider this example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the method level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory
public class MyFactory {

    @Prototype
    @Timed
    public MyBean myBean() {
        return new MyBean();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the method level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Factory
class MyFactory {

    @Prototype
    @Timed
    MyBean myBean() {
        new MyBean()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AOP Advice at the method level of a <code>@Factory</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Factory
open class MyFactory {

    @Prototype
    @Timed
    open fun myBean(): MyBean {
        return MyBean()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example logs the time it takes to execute the public methods of the <code>MyBean</code> bean, but not the bean creation.</p>
</div>
<div class="paragraph">
<p>The rationale for this behaviour is that you may at times wish to apply advice to a factory and at other times apply advice to the bean produced by the factory.</p>
</div>
<div class="paragraph">
<p>Note that there is currently no way to apply advice at the method level to a <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> bean, and all advice for factories must be applied at the type level. You can control which methods have advice applied by defining methods as non-public which do not have advice applied.</p>
</div>
</div>
</div>

<h2 id="introductionAdvice"><a class="anchor" href="#introductionAdvice"></a>5.2 Introduction Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/introductionAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Introduction advice is distinct from Around advice in that it involves providing an implementation instead of decorating.</p>
</div>
<div class="paragraph">
<p>Examples of introduction advice include <a href="https://gorm.grails.org">GORM</a> and <a href="https://projects.spring.io/spring-data">Spring Data</a> which implement persistence logic for you.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is another example of introduction advice where Micronaut implements HTTP client interfaces for you at compile time.</p>
</div>
<div class="paragraph">
<p>The way you implement Introduction advice is very similar to how you implement Around advice.</p>
</div>
<div class="paragraph">
<p>You start by defining an annotation that powers the introduction advice. As an example, say you want to implement advice to return a stubbed value for every method in an interface (a common requirement in testing frameworks). Consider the following <code>@Stub</code> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.Introduction;
import io.micronaut.context.annotation.Bean;

import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Introduction // <b class="conum">(1)</b>
@Bean // <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
@Target({TYPE, ANNOTATION_TYPE, METHOD})
public @interface Stub {
    String value() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.aop.Introduction
import io.micronaut.context.annotation.Bean

import java.lang.annotation.Documented
import java.lang.annotation.Retention
import java.lang.annotation.Target

import static java.lang.annotation.ElementType.ANNOTATION_TYPE
import static java.lang.annotation.ElementType.METHOD
import static java.lang.annotation.ElementType.TYPE
import static java.lang.annotation.RetentionPolicy.RUNTIME

@Introduction // <b class="conum">(1)</b>
@Bean // <b class="conum">(2)</b>
@Documented
@Retention(RUNTIME)
@Target([TYPE, ANNOTATION_TYPE, METHOD])
@interface Stub {
    String value() default ""
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Introduction Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.aop.Introduction
import io.micronaut.context.annotation.Bean
import kotlin.annotation.AnnotationRetention.RUNTIME
import kotlin.annotation.AnnotationTarget.ANNOTATION_CLASS
import kotlin.annotation.AnnotationTarget.CLASS
import kotlin.annotation.AnnotationTarget.FILE
import kotlin.annotation.AnnotationTarget.FUNCTION
import kotlin.annotation.AnnotationTarget.PROPERTY_GETTER
import kotlin.annotation.AnnotationTarget.PROPERTY_SETTER

@Introduction // <b class="conum">(1)</b>
@Bean // <b class="conum">(2)</b>
@MustBeDocumented
@Retention(RUNTIME)
@Target(CLASS, FILE, ANNOTATION_CLASS, FUNCTION, PROPERTY_GETTER, PROPERTY_SETTER)
annotation class Stub(val value: String = "")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The introduction advice is annotated with <a href="../api/io/micronaut/aop/Introduction.html">Introduction</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Bean.html">Bean</a> annotation is added so that all types annotated with <code>@Stub</code> become beans</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>StubIntroduction</code> class referred to in the previous example must then implement the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface, just like around advice.</p>
</div>
<div class="paragraph">
<p>The following is an example implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubIntroduction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.*;
import io.micronaut.core.annotation.Nullable;
import jakarta.inject.Singleton;

@Singleton
@InterceptorBean(Stub.class) // <b class="conum">(1)</b>
public class StubIntroduction implements MethodInterceptor&lt;Object, Object&gt; { // <b class="conum">(2)</b>

    @Nullable
    @Override
    public Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        return context.getValue( // <b class="conum">(3)</b>
                Stub.class,
                context.getReturnType().getType()
        ).orElse(null); // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubIntroduction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.aop.MethodInterceptor
import io.micronaut.aop.MethodInvocationContext
import io.micronaut.aop.InterceptorBean
import io.micronaut.core.annotation.Nullable
import jakarta.inject.Singleton

@Singleton
@InterceptorBean(Stub) // <b class="conum">(1)</b>
class StubIntroduction implements MethodInterceptor&lt;Object,Object&gt; { // <b class="conum">(2)</b>

    @Nullable
    @Override
    Object intercept(MethodInvocationContext&lt;Object, Object&gt; context) {
        context.getValue( // <b class="conum">(3)</b>
                Stub,
                context.returnType.type
        ).orElse(null) // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubIntroduction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.aop.*
import jakarta.inject.Singleton

@Singleton
@InterceptorBean(Stub::class) // <b class="conum">(1)</b>
class StubIntroduction : MethodInterceptor&lt;Any, Any&gt; { // <b class="conum">(2)</b>

    override fun intercept(context: MethodInvocationContext&lt;Any, Any&gt;): Any? {
        return context.getValue&lt;Any&gt;( // <b class="conum">(3)</b>
                Stub::class.java,
                context.returnType.type
        ).orElse(null) // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/aop/InterceptorBean.html">InterceptorBean</a> annotation is used to associate the interceptor with the <code>@Stub</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class is annotated with <code>@Singleton</code> and implements the <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The value of the <code>@Stub</code> annotation is read from the context and an attempt made to convert the value to the return type</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise <code>null</code> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To now use this introduction advice in an application, annotate your abstract classes or interfaces with <code>@Stub</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubExample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Stub
public interface StubExample {

    @Stub("10")
    int getNumber();

    LocalDateTime getDate();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubExample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Stub
interface StubExample {

    @Stub("10")
    int getNumber()

    LocalDateTime getDate()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">StubExample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Stub
interface StubExample {

    @get:Stub("10")
    val number: Int

    val date: LocalDateTime?
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All abstract methods delegate to the <code>StubIntroduction</code> class to be implemented.</p>
</div>
<div class="paragraph">
<p>The following test demonstrates the behaviour or <code>StubIntroduction</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StubExample stubExample = applicationContext.getBean(StubExample.class);

assertEquals(10, stubExample.getNumber());
assertNull(stubExample.getDate());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
def stubExample = applicationContext.getBean(StubExample)

then:
stubExample.number == 10
stubExample.date == null</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing Introduction Advice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val stubExample = applicationContext.getBean(StubExample::class.java)

stubExample.number.shouldBe(10)
stubExample.date.shouldBe(null)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if the introduction advice cannot implement the method, call the <code>proceed</code> method of the <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a>. This lets other introduction advice interceptors implement the method, and an <code>UnsupportedOperationException</code> will be thrown if no advice can implement the method.</p>
</div>
<div class="paragraph">
<p>In addition, if multiple introduction advice are present you may wish to override the <code>getOrder()</code> method of <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> to control the priority of advice.</p>
</div>
<div class="paragraph">
<p>The following sections cover core advice types provided by Micronaut.</p>
</div>

<h2 id="adapterAdvice"><a class="anchor" href="#adapterAdvice"></a>5.3 Method Adapter Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/adapterAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are cases where you want to introduce a new bean based on the presence of an annotation on a method. An example of this is the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation which produces an implementation of <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> for each annotated method that invokes the annotated method.</p>
</div>
<div class="paragraph">
<p>For example the following snippet runs the logic contained within the method when the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> starts up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.event.StartupEvent;
import io.micronaut.runtime.event.annotation.EventListener;
...

@EventListener
void onStartup(StartupEvent event) {
    // startup logic here
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The presence of the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation causes Micronaut to create a new class that implements <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> and invokes the <code>onStartup</code> method defined in the bean above.</p>
</div>
<div class="paragraph">
<p>The actual implementation of the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> is trivial; it simply uses the <a href="../api/io/micronaut/aop/Adapter.html">@Adapter</a> annotation to specify which SAM (single abstract method) type it adapts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.Adapter;
import io.micronaut.context.event.ApplicationEventListener;
import io.micronaut.core.annotation.Indexed;

import java.lang.annotation.*;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Retention(RUNTIME)
@Target({ElementType.ANNOTATION_TYPE, ElementType.METHOD})
@Adapter(ApplicationEventListener.class) <i class="conum" data-value="1"></i><b>(1)</b>
@Indexed(ApplicationEventListener.class)
@Inherited
public @interface EventListener {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/aop/Adapter.html">@Adapter</a> annotation indicates which SAM type to adapt, in this case <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut also automatically aligns the generic types for the SAM interface if they are specified.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using this mechanism you can define custom annotations that use the <a href="../api/io/micronaut/aop/Adapter.html">@Adapter</a> annotation and a SAM interface to automatically implement beans for you at compile time.</p>
</div>

<h2 id="lifecycleAdvice"><a class="anchor" href="#lifecycleAdvice"></a>5.4 Bean Life Cycle Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/lifecycleAdvice.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Sometimes you may need to apply advice to a bean&#8217;s lifecycle. There are 3 types of advice that are applicable in this case:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interception of the construction of the bean</p>
</li>
<li>
<p>Interception of the bean&#8217;s <code>@PostConstruct</code> invocation</p>
</li>
<li>
<p>Interception of a bean&#8217;s <code>@PreDestroy</code> invocation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut supports these 3 use cases by allowing the definition of additional <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> meta-annotations.</p>
</div>
<div class="paragraph">
<p>Consider the following annotation definition:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AroundConstruct example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.*;
import io.micronaut.context.annotation.Prototype;
import java.lang.annotation.*;

@Retention(RetentionPolicy.RUNTIME)
@AroundConstruct // <b class="conum">(1)</b>
@InterceptorBinding(kind = InterceptorKind.POST_CONSTRUCT) // <b class="conum">(2)</b>
@InterceptorBinding(kind = InterceptorKind.PRE_DESTROY) // <b class="conum">(3)</b>
@Prototype // <b class="conum">(4)</b>
public @interface ProductBean {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AroundConstruct example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.aop.*
import io.micronaut.context.annotation.Prototype
import java.lang.annotation.*

@Retention(RetentionPolicy.RUNTIME)
@AroundConstruct // <b class="conum">(1)</b>
@InterceptorBinding(kind = InterceptorKind.POST_CONSTRUCT) // <b class="conum">(2)</b>
@InterceptorBinding(kind = InterceptorKind.PRE_DESTROY) // <b class="conum">(3)</b>
@Prototype // <b class="conum">(4)</b>
@interface ProductBean {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AroundConstruct example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.aop.AroundConstruct
import io.micronaut.aop.InterceptorBinding
import io.micronaut.aop.InterceptorBindingDefinitions
import io.micronaut.aop.InterceptorKind
import io.micronaut.context.annotation.Prototype

@Retention(AnnotationRetention.RUNTIME)
@AroundConstruct // <b class="conum">(1)</b>
@InterceptorBindingDefinitions(
    InterceptorBinding(kind = InterceptorKind.POST_CONSTRUCT), // <b class="conum">(2)</b>
    InterceptorBinding(kind = InterceptorKind.PRE_DESTROY) // <b class="conum">(3)</b>
)
@Prototype // <b class="conum">(4)</b>
annotation class ProductBean</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/aop/AroundConstruct.html">@AroundConstruct</a> annotation is added to indicate that interception of the constructor should occur</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> definition is used to indicate that <code>@PostConstruct</code> interception should occur</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> definition is used to indicate that <code>@PreDestroy</code> interception should occur</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The bean is defined as <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a> so a new instance is required for each injection point</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that if you do not need <code>@PostConstruct</code> and <code>@PreDestroy</code> interception you can simply remove those bindings.</p>
</div>
<div class="paragraph">
<p>The <code>@ProductBean</code> annotation can then be used on the target class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using an AroundConstruct meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Parameter;

import jakarta.annotation.PreDestroy;

@ProductBean // <b class="conum">(1)</b>
public class Product {
    private final String productName;
    private boolean active = false;

    public Product(@Parameter String productName) { // <b class="conum">(2)</b>
        this.productName = productName;
    }

    public String getProductName() {
        return productName;
    }

    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }

    @PreDestroy // <b class="conum">(3)</b>
    void disable() {
        active = false;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using an AroundConstruct meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Parameter
import jakarta.annotation.PreDestroy

@ProductBean // <b class="conum">(1)</b>
class Product {
    final String productName
    boolean active = false

    Product(@Parameter String productName) { // <b class="conum">(2)</b>
        this.productName = productName
    }

    @PreDestroy // <b class="conum">(3)</b>
    void disable() {
        active = false
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using an AroundConstruct meta-annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Parameter
import jakarta.annotation.PreDestroy

@ProductBean // <b class="conum">(1)</b>
class Product(@param:Parameter val productName: String ) { // <b class="conum">(2)</b>

    var active: Boolean = false
    @PreDestroy
    fun disable() { // <b class="conum">(3)</b>
        active = false
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@ProductBean</code> annotation is defined on a class of type <code>Product</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/context/annotation/Parameter.html">@Parameter</a> annotation indicates that this bean requires an argument to complete constructions</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Any <code>@PreDestroy</code> or <code>@PostConstruct</code> methods are executed last in the interceptor chain</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can define <a href="../api/io/micronaut/aop/ConstructorInterceptor.html">ConstructorInterceptor</a> beans for constructor interception and <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> beans for <code>@PostConstruct</code> or <code>@PreDestroy</code> interception.</p>
</div>
<div class="paragraph">
<p>The following factory defines a <a href="../api/io/micronaut/aop/ConstructorInterceptor.html">ConstructorInterceptor</a> that intercepts construction of <code>Product</code> instances and registers them with a hypothetical <code>ProductService</code> validating the product name first:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a constructor interceptor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.*;
import io.micronaut.context.annotation.Factory;

@Factory
public class ProductInterceptors {
    private final ProductService productService;

    public ProductInterceptors(ProductService productService) {
        this.productService = productService;
    }
}

@InterceptorBean(ProductBean.class)
ConstructorInterceptor&lt;Product&gt; aroundConstruct() { // <b class="conum">(1)</b>
    return context -&gt; {
        final Object[] parameterValues = context.getParameterValues(); // <b class="conum">(2)</b>
        final Object parameterValue = parameterValues[0];
        if (parameterValue == null || parameterValues[0].toString().isEmpty()) {
            throw new IllegalArgumentException("Invalid product name");
        }
        String productName = parameterValues[0].toString().toUpperCase();
        parameterValues[0] = productName;
        final Product product = context.proceed(); // <b class="conum">(3)</b>
        productService.addProduct(product);
        return product;
    };
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a constructor interceptor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.aop.*
import io.micronaut.context.annotation.Factory


@Factory
class ProductInterceptors {
    private final ProductService productService

    ProductInterceptors(ProductService productService) {
        this.productService = productService
    }
}

@InterceptorBean(ProductBean.class)
ConstructorInterceptor&lt;Product&gt; aroundConstruct() { // <b class="conum">(1)</b>
    return  { context -&gt;
        final Object[] parameterValues = context.parameterValues // <b class="conum">(2)</b>
        final Object parameterValue = parameterValues[0]
        if (parameterValue == null || parameterValues[0].toString().isEmpty()) {
            throw new IllegalArgumentException("Invalid product name")
        }
        String productName = parameterValues[0].toString().toUpperCase()
        parameterValues[0] = productName
        final Product product = context.proceed() // <b class="conum">(3)</b>
        productService.addProduct(product)
        return product
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a constructor interceptor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.aop.*
import io.micronaut.context.annotation.Factory

@Factory
class ProductInterceptors(private val productService: ProductService) {
}

@InterceptorBean(ProductBean::class)
fun aroundConstruct(): ConstructorInterceptor&lt;Product&gt; { // <b class="conum">(1)</b>
    return ConstructorInterceptor { context: ConstructorInvocationContext&lt;Product&gt; -&gt;
        val parameterValues = context.parameterValues // <b class="conum">(2)</b>
        val parameterValue = parameterValues[0]
        require(!(parameterValue == null || parameterValues[0].toString().isEmpty())) { "Invalid product name" }
        val productName = parameterValues[0].toString().uppercase()
        parameterValues[0] = productName
        val product = context.proceed() // <b class="conum">(3)</b>
        productService.addProduct(product)
        product
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A new <a href="../api/io/micronaut/aop/InterceptorBean.html">@InterceptorBean</a> is defined that is a <a href="../api/io/micronaut/aop/ConstructorInterceptor.html">ConstructorInterceptor</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The constructor parameter values can be retrieved and modified as needed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The constructor can be invoked with the <code>proceed()</code> method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Defining <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> instances that interceptor the <code>@PostConstruct</code> and <code>@PreDestroy</code> methods is no different from defining interceptors for regular methods. Note however that you can use the passed <a href="../api/io/micronaut/aop/MethodInvocationContext.html">MethodInvocationContext</a> to identify what kind of interception is occurring and adapt the code accordingly like in the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a constructor interceptor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@InterceptorBean(ProductBean.class) // <b class="conum">(1)</b>
MethodInterceptor&lt;Product, Object&gt; aroundInvoke() {
    return context -&gt; {
        final Product product = context.getTarget();
        switch (context.getKind()) {
            case POST_CONSTRUCT: // <b class="conum">(2)</b>
                product.setActive(true);
                return context.proceed();
            case PRE_DESTROY: // <b class="conum">(3)</b>
                productService.removeProduct(product);
                return context.proceed();
            default:
                return context.proceed();
        }
    };
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a constructor interceptor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@InterceptorBean(ProductBean.class) // <b class="conum">(1)</b>
MethodInterceptor&lt;Product, Object&gt; aroundInvoke() {
    return { context -&gt;
        final Product product = context.getTarget()
        switch (context.kind) {
            case InterceptorKind.POST_CONSTRUCT: // <b class="conum">(2)</b>
                product.setActive(true)
                return context.proceed()
            case InterceptorKind.PRE_DESTROY: // <b class="conum">(3)</b>
                productService.removeProduct(product)
                return context.proceed()
            default:
                return context.proceed()
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a constructor interceptor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@InterceptorBean(ProductBean::class)
fun  aroundInvoke(): MethodInterceptor&lt;Product, Any&gt; { // <b class="conum">(1)</b>
    return MethodInterceptor { context: MethodInvocationContext&lt;Product, Any&gt; -&gt;
        val product = context.target
        return@MethodInterceptor when (context.kind) {
            InterceptorKind.POST_CONSTRUCT -&gt; { // <b class="conum">(2)</b>
                product.active = true
                context.proceed()
            }
            InterceptorKind.PRE_DESTROY -&gt; { // <b class="conum">(3)</b>
                productService.removeProduct(product)
                context.proceed()
            }
            else -&gt; context.proceed()
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A new <a href="../api/io/micronaut/aop/InterceptorBean.html">@InterceptorBean</a> is defined that is a <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@PostConstruct</code> interception is handled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@PreDestroy</code> interception is handled</td>
</tr>
</table>
</div>

<h2 id="validation"><a class="anchor" href="#validation"></a>5.5 Validation Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/validation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Validation advice is one of the most common advice types you are likely to want to use in your application.</p>
</div>
<div class="paragraph">
<p>Validation advice is built on <a href="https://beanvalidation.org/2.0/spec/">Bean Validation JSR 380</a>, a specification of the Java API for bean validation which ensures that the properties of a bean meet specific criteria, using <code>javax.validation</code> annotations such as <code>@NotNull</code>, <code>@Min</code>, and <code>@Max</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut provides native support for the <code>javax.validation</code> annotations with the <code>micronaut-validation</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Or full JSR 380 compliance with the <code>micronaut-hibernate-validator</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-hibernate-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>See the section on <a href="#beanValidation">Bean Validation</a> for more information on how to apply validation rules to your bean classes.</p>
</div>

<h2 id="caching"><a class="anchor" href="#caching"></a>5.6 Cache Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/caching.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like Spring and Grails, Micronaut provides caching annotations in the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/package-summary.html">io.micronaut.cache</a> package.</p>
</div>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/CacheManager.html">CacheManager</a> interface allows different cache implementations to be plugged in as necessary.</p>
</div>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/SyncCache.html">SyncCache</a> interface provides a synchronous API for caching, whilst the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/AsyncCache.html">AsyncCache</a> API allows non-blocking operation.</p>
</div>
<div class="sect1">
<h2 id="_cache_annotations">Cache Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following cache annotations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/annotation/Cacheable.html">@Cacheable</a> - Indicates a method is cacheable in the specified cache</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/annotation/CachePut.html">@CachePut</a> - Indicates that the return value of a method invocation should be cached. Unlike <code>@Cacheable</code> the original operation is never skipped.</p>
</li>
<li>
<p><a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/annotation/CacheInvalidate.html">@CacheInvalidate</a> - Indicates the invocation of a method should cause the invalidation of one or more caches.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using one of these annotations activates the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/interceptor/CacheInterceptor">CacheInterceptor</a>, which in the case of <code>@Cacheable</code> caches the return value of the method.</p>
</div>
<div class="paragraph">
<p>The emitted result is cached if the method return type is a non-blocking type (either <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> or an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>) .</p>
</div>
<div class="paragraph">
<p>In addition, if the underlying Cache implementation supports non-blocking cache operations, cache values are read without blocking, resulting in non-blocking cache operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_caches">Configuring Caches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, <a href="https://github.com/ben-manes/caffeine">Caffeine</a> is used to create caches from application configuration. For example:</p>
</div>
<div class="openblock">
<div class="title">Cache Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.caches.my-cache.maximum-size=20</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  caches:
    my-cache:
      maximum-size: 20</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.caches]
    [micronaut.caches.my-cache]
      maximum-size=20</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  caches {
    myCache {
      maximumSize = 20
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    caches {
      my-cache {
        maximum-size = 20
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "caches": {
      "my-cache": {
        "maximum-size": 20
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example configures a cache called "my-cache" with a maximum size of 20.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Naming Caches</div>
<div class="paragraph">
<p>Define names of caches under <code>micronaut.caches</code> in kebab case (lowercase and hyphen separated); if you use camel case, the names are normalized to kebab case. For example <code>myCache</code> becomes <code>my-cache</code>. The kebab-case form must be used when referencing caches in the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/annotation/Cacheable.html">@Cacheable</a> annotation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure a weigher to be used with the <code>maximumWeight</code> configuration, create a bean that implements <code>io.micronaut.caffeine.cache.Weigher</code>. To associate a given weigher with only a specific cache, annotate the bean with <code>@Named(&lt;cache name&gt;)</code>. Weighers without a named qualifier apply to all caches that don&#8217;t have a named weigher. If no beans are found, a default implementation is used.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/guide/configurationreference.html#io.micronaut.cache.caffeine.DefaultCacheConfiguration">configuration reference</a> for all available configuration options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_cache_creation">Dynamic Cache Creation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/DynamicCacheManager.html">DynamicCacheManager</a> bean can be registered for use cases where caches cannot be configured ahead of time. When a cache is attempted to be retrieved that was not predefined, the dynamic cache manager is invoked to create and return a cache.</p>
</div>
<div class="paragraph">
<p>By default, if there is no other dynamic cache manager defined in the application, Micronaut registers an instance of <a href="https://micronaut-projects.github.io/micronaut-cache/latest/api/io/micronaut/cache/caffeine/DefaultDynamicCacheManager.html">DefaultDynamicCacheManager</a> that creates Caffeine caches with default values.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_cache_implementations">Other Cache Implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Check the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/guide/index.html">Micronaut Cache</a> project for more information.</p>
</div>
</div>
</div>

<h2 id="retry"><a class="anchor" href="#retry"></a>5.7 Retry Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/retry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems and microservice environments, failure is something you have to plan for, and it is common to want to attempt to retry an operation if it fails. If first you don&#8217;t succeed try again!</p>
</div>
<div class="paragraph">
<p>With this in mind, Micronaut includes a <a href="../api/io/micronaut/retry/annotation/Retryable.html">Retryable</a> annotation.</p>
</div>
<div class="sect1">
<h2 id="_simple_retry">Simple Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest form of retry is just to add the <code>@Retryable</code> annotation to a type or method. The default behaviour of <code>@Retryable</code> is to retry three times with a linear delay of one second between each retry. (first attempt with 1s delay, second attempt with 2s delay, third attempt with 3s delay).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Simple Retry Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Retryable
public List&lt;Book&gt; listBooks() {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Simple Retry Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Retryable
List&lt;Book&gt; listBooks() {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Simple Retry Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Retryable
open fun listBooks(): List&lt;Book&gt; {
    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above example if the <code>listBooks()</code> method throws a RuntimeException, it is retried until the maximum number of attempts is reached.</p>
</div>
<div class="paragraph">
<p>The <code>multiplier</code> value of the <code>@Retryable</code> annotation can be used to configure a multiplier used to calculate the delay between retries, allowing exponential retry support.</p>
</div>
<div class="paragraph">
<p>To customize retry behaviour, set the <code>attempts</code> and <code>delay</code> members, For example to configure five attempts with a two second delay:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Retryable(attempts = "5",
           delay = "2s")
public Book findBook(String title) {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Retryable(attempts = "5",
           delay = "2s")
Book findBook(String title) {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry Attempts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Retryable(attempts = "5",
           delay = "2s")
open fun findBook(title: String): Book {
    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how both <code>attempts</code> and <code>delay</code> are defined as strings. This is to support configurability through annotation metadata. For example, you can allow the retry policy to be configured using property placeholder resolution:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Retryable(attempts = "${book.retry.attempts:3}",
           delay = "${book.retry.delay:1s}")
public Book getBook(String title) {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Retryable(attempts = '${book.retry.attempts:3}',
           delay = '${book.retry.delay:1s}')
Book getBook(String title) {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Setting Retry via Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Retryable(attempts = "\${book.retry.attempts:3}",
           delay = "\${book.retry.delay:1s}")
open fun getBook(title: String): Book {
    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above in place, if <code>book.retry.attempts</code> is specified in configuration it is bound to the value of the <code>attempts</code> member of the <code>@Retryable</code> annotation via annotation metadata.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reactive_retry">Reactive Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>@Retryable</code> advice can also be applied to methods that return reactive types, such as <code>Publisher</code> (<a href="https://projectreactor.io">Project Reactor</a>'s <code>Flux</code> or <a href="https://github.com/ReactiveX/RxJava">RxJava</a>'s <code>Flowable</code>). For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Retryable
public Publisher&lt;Book&gt; streamBooks() {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Retryable
Flux&lt;Book&gt; streamBooks() {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying Retry Policy to Reactive Types</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Retryable
open fun streamBooks(): Flux&lt;Book&gt; {
    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>@Retryable</code> advice applies the retry policy to the reactive type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_circuit_breaker">Circuit Breaker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Retry is useful in a microservice environment, but in some cases excessive retries can overwhelm the system as clients repeatedly re-attempt failing operations.</p>
</div>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern">Circuit Breaker</a> pattern is designed to resolve this issue by allowing a certain number of failing requests and then opening a circuit that remains open for a period before allowing additional retry attempts.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">CircuitBreaker</a> annotation is a variation of the <code>@Retryable</code> annotation that supports a <code>reset</code> member which indicates how long the circuit should remain open before it is reset (the default is 20 seconds).</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CircuitBreaker(reset = "30s")
public List&lt;Book&gt; findBooks() {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@CircuitBreaker(reset = "30s")
List&lt;Book&gt; findBooks() {
    // ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Applying CircuitBreaker Advice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@CircuitBreaker(reset = "30s")
open fun findBooks(): List&lt;Book&gt; {
    // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example retries the <code>findBooks</code> method three times and then opens the circuit for 30 seconds, rethrowing the original exception and preventing potential downstream traffic such as HTTP requests and I/O operations flooding the system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_factory_bean_retry">Factory Bean Retry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a> is applied to bean factory methods, it behaves as if the annotation was placed on the type being returned. The retry behavior applies when the methods on the returned object are invoked. Note that the bean factory method itself is <strong>not</strong> retried. If you want the functionality of creating the bean to be retried, it should be delegated to another singleton that has the <a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a> annotation applied.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory <i class="conum" data-value="1"></i><b>(1)</b>
public class Neo4jDriverFactory {
    ...
    @Retryable(ServiceUnavailableException.class) <i class="conum" data-value="2"></i><b>(2)</b>
    @Bean(preDestroy = "close")
    public Driver buildDriver() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A factory bean is created that defines methods that create beans</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a> annotation is used to catch exceptions thrown from methods executed on the <code>Driver</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retry_events">Retry Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/retry/event/RetryEventListener.html">RetryEventListener</a> instances as beans to listen for <a href="../api/io/micronaut/retry/event/RetryEvent.html">RetryEvent</a> events that are published every time an operation is retried.</p>
</div>
<div class="paragraph">
<p>In addition, you can register event listeners for <a href="../api/io/micronaut/retry/event/CircuitOpenEvent.html">CircuitOpenEvent</a> to be notified when a circuit breaker circuit is opened, or <a href="../api/io/micronaut/retry/event/CircuitClosedEvent.html">CircuitClosedEvent</a> for when a circuit is closed.</p>
</div>
</div>
</div>

<h2 id="scheduling"><a class="anchor" href="#scheduling"></a>5.8 Scheduled Tasks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/scheduling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like Spring and Grails, Micronaut features a <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation for scheduling background tasks.</p>
</div>
<div class="sect1">
<h2 id="_using_the_scheduled_annotation">Using the @Scheduled Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> annotation can be added to any method of a bean, and you should set one of the <code>fixedRate</code>, <code>fixedDelay</code>, or <code>cron</code> members.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that the scope of a bean impacts behaviour. A <code>@Singleton</code> bean shares state (the fields of the instance) each time the scheduled method is executed, while for a <code>@Prototype</code> bean a new instance is created for each execution.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_scheduling_at_a_fixed_rate">Scheduling at a Fixed Rate</h3>
<div class="paragraph">
<p>To schedule a task at a fixed rate, use the <code>fixedRate</code> member. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Scheduled(fixedRate = "5m")
void everyFiveMinutes() {
    System.out.println("Executing everyFiveMinutes()");
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Scheduled(fixedRate = "5m")
void everyFiveMinutes() {
    println "Executing everyFiveMinutes()"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Rate Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Scheduled(fixedRate = "5m")
internal fun everyFiveMinutes() {
    println("Executing everyFiveMinutes()")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task above executes every five minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_with_a_fixed_delay">Scheduling with a Fixed Delay</h3>
<div class="paragraph">
<p>To schedule a task so it runs five minutes after the termination of the previous task use the <code>fixedDelay</code> member. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Scheduled(fixedDelay = "5m")
void fiveMinutesAfterLastExecution() {
    System.out.println("Executing fiveMinutesAfterLastExecution()");
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Scheduled(fixedDelay = "5m")
void fiveMinutesAfterLastExecution() {
    println "Executing fiveMinutesAfterLastExecution()"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Fixed Delay Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Scheduled(fixedDelay = "5m")
internal fun fiveMinutesAfterLastExecution() {
    println("Executing fiveMinutesAfterLastExecution()")
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_a_cron_task">Scheduling a Cron Task</h3>
<div class="paragraph">
<p>To schedule a <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> task use the <code>cron</code> member:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Cron Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Scheduled(cron = "0 15 10 ? * MON")
void everyMondayAtTenFifteenAm() {
    System.out.println("Executing everyMondayAtTenFifteenAm()");
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Cron Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Scheduled(cron = "0 15 10 ? * MON")
void everyMondayAtTenFifteenAm() {
    println "Executing everyMondayAtTenFifteenAm()"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Cron Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Scheduled(cron = "0 15 10 ? * MON")
internal fun everyMondayAtTenFifteenAm() {
    println("Executing everyMondayAtTenFifteenAm()")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example runs the task every Monday morning at 10:15AM in the time zone of the server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduling_with_only_an_initial_delay">Scheduling with only an Initial Delay</h3>
<div class="paragraph">
<p>To schedule a task so it runs once after the server starts, use the <code>initialDelay</code> member:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initial Delay Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Scheduled(initialDelay = "1m")
void onceOneMinuteAfterStartup() {
    System.out.println("Executing onceOneMinuteAfterStartup()");
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initial Delay Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Scheduled(initialDelay = "1m")
void onceOneMinuteAfterStartup() {
    println "Executing onceOneMinuteAfterStartup()"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Initial Delay Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Scheduled(initialDelay = "1m")
internal fun onceOneMinuteAfterStartup() {
    println("Executing onceOneMinuteAfterStartup()")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example only runs once, one minute after the server starts.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programmatically_scheduling_tasks">Programmatically Scheduling Tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To programmatically schedule tasks, use the <a href="../api/io/micronaut/scheduling/TaskScheduler.html">TaskScheduler</a> bean which can be injected as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Named(TaskExecutors.SCHEDULED)
TaskScheduler taskScheduler;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Inject
@Named(TaskExecutors.SCHEDULED)
TaskScheduler taskScheduler</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
@Named(TaskExecutors.SCHEDULED)
lateinit var taskScheduler: TaskScheduler</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_scheduled_tasks_with_annotation_metadata">Configuring Scheduled Tasks with Annotation Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To make your application&#8217;s tasks configurable, you can use annotation metadata and property placeholder configuration. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Allow tasks to be configured</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Scheduled(fixedRate = "${my.task.rate:5m}",
        initialDelay = "${my.task.delay:1m}")
void configuredTask() {
    System.out.println("Executing configuredTask()");
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Allow tasks to be configured</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Scheduled(fixedRate = '${my.task.rate:5m}',
        initialDelay = '${my.task.delay:1m}')
void configuredTask() {
    println "Executing configuredTask()"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Allow tasks to be configured</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Scheduled(fixedRate = "\${my.task.rate:5m}",
        initialDelay = "\${my.task.delay:1m}")
internal fun configuredTask() {
    println("Executing configuredTask()")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example allows the task execution frequency to be configured with the property <code>my.task.rate</code>, and the initial delay to be configured with the property <code>my.task.delay</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_scheduled_task_thread_pool">Configuring the Scheduled Task Thread Pool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tasks executed by <code>@Scheduled</code> are run by default on a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html">ScheduledExecutorService</a> configured to have twice the number of threads as available processors.</p>
</div>
<div class="paragraph">
<p>You can configure this thread pool in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Configuring Scheduled Task Thread Pool</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.executors.scheduled.type=scheduled
micronaut.executors.scheduled.core-pool-size=30</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  executors:
    scheduled:
      type: scheduled
      core-pool-size: 30</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.executors]
    [micronaut.executors.scheduled]
      type="scheduled"
      core-pool-size=30</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  executors {
    scheduled {
      type = "scheduled"
      corePoolSize = 30
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    executors {
      scheduled {
        type = "scheduled"
        core-pool-size = 30
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "executors": {
      "scheduled": {
        "type": "scheduled",
        "core-pool-size": 30
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<a id="io.micronaut.scheduling.executor.UserExecutorConfiguration" href="#io.micronaut.scheduling.executor.UserExecutorConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/scheduling/executor/UserExecutorConfiguration.html">UserExecutorConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.n-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/scheduling/executor/ExecutorType.html">ExecutorType</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.parallelism</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.core-pool-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.thread-factory-class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Class</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the executor name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.executors.*.number-of-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of threads for <a href="../api/io/micronaut/scheduling/executor/ExecutorType.html#FIXED">FIXED</a>. Default value (2 * Number of processors available to the Java virtual machine).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_handling_exceptions">Handling Exceptions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Micronaut includes a <a href="../api/io/micronaut/scheduling/DefaultTaskExceptionHandler.html">DefaultTaskExceptionHandler</a> bean that implements the <a href="../api/io/micronaut/scheduling/TaskExceptionHandler.html">TaskExceptionHandler</a> interface and simply logs the exception if an error occurs invoking a scheduled task.</p>
</div>
<div class="paragraph">
<p>If you have custom requirements you can replace this bean with your own implementation (for example to send an email or shutdown the context to fail fast). To do so, write your own <a href="../api/io/micronaut/scheduling/TaskExceptionHandler.html">TaskExceptionHandler</a> and annotate it with <code>@Replaces(DefaultTaskExceptionHandler.class)</code>.</p>
</div>
</div>
</div>

<h2 id="springAop"><a class="anchor" href="#springAop"></a>5.9 Bridging Spring AOP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/aop/springAop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although Micronaut&#8217;s design is based on a compile-time approach and does not rely on Spring dependency injection, there is still a lot of value in the Spring ecosystem that does not depend directly on the Spring container.</p>
</div>
<div class="paragraph">
<p>You may wish to use existing Spring projects within Micronaut and configure beans to be used within Micronaut.</p>
</div>
<div class="paragraph">
<p>You may also wish to leverage existing AOP advice from Spring. One example of this is Spring&#8217;s support for declarative transactions with <code>@Transactional</code>.</p>
</div>
<div class="paragraph">
<p>Micronaut provides support for Spring-based transaction management without requiring Spring itself. Simply add the <code>spring</code> module to your application dependencies:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.spring:micronaut-spring")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.spring&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-spring&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>This also requires adding the <code>spring-annotation</code> module dependency as an annotation processor:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.spring:micronaut-spring-annotation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.spring&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-spring-annotation&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use Micronaut&#8217;s <a href="#hibernateSupport">Hibernate support</a> you already get this dependency and a <code>HibernateTransactionManager</code> is configured for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is done by intercepting method calls annotated with Spring&#8217;s <code>@Transactional</code> with <a href="https://micronaut-projects.github.io/micronaut-spring/latest/api/io/micronaut/spring/tx/annotation/TransactionInterceptor.html">TransactionInterceptor</a>.</p>
</div>
<div class="paragraph">
<p>The benefit here is you can use Micronaut&#8217;s compile-time, reflection-free AOP to declare programmatic Spring transactions. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @Transactional</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.springframework.transaction.annotation.Transactional;
...

@Transactional
public Book saveBook(String title) {
    ...
}</code></pre>
</div>
</div>

<h1 id="httpServer"><a class="anchor" href="#httpServer"></a>6 The HTTP Server</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI <code>create-app</code> command, the <code>http-server</code> dependency is included by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut includes both non-blocking HTTP server and client APIs based on <a href="https://netty.io">Netty</a>.</p>
</div>
<div class="paragraph">
<p>The design of the HTTP server in Micronaut is optimized for interchanging messages between Microservices, typically in JSON, and is not intended as a full server-side MVC framework. For example, there is currently no support for server-side views or features typical of a traditional server-side MVC framework.</p>
</div>
<div class="paragraph">
<p>The goal of the HTTP server is to make it as easy as possible to expose APIs to be consumed by HTTP clients, regardless of the language they are written in. To use the HTTP server you need the <code>http-server-netty</code> dependency in your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-http-server-netty")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-http-server-netty&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>A "Hello World" server application can be seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello") // <b class="conum">(1)</b>
public class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    public String index() {
        return "Hello World"; // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller('/hello') // <b class="conum">(1)</b>
class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    String index() {
        'Hello World' // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello") // <b class="conum">(1)</b>
class HelloController {

    @Get(produces = [MediaType.TEXT_PLAIN]) // <b class="conum">(2)</b>
    fun index(): String {
        return "Hello World" // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/hello</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method responds to a GET requests to <code>/hello</code> and returns a response with a <code>text/plain</code> content type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>By defining a method named <code>index</code>, by convention the method is exposed via the <code>/hello</code> URI</td>
</tr>
</table>
</div>

<h2 id="runningServer"><a class="anchor" href="#runningServer"></a>6.1 Running the Embedded Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/runningServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the server, create an <code>Application</code> class with a <code>static void main</code> method, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Micronaut Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.Micronaut;

public class Application {

    public static void main(String[] args) {
        Micronaut.run(Application.class);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Micronaut Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.runtime.Micronaut

class Application {

    static void main(String... args) {
        Micronaut.run Application
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Micronaut Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.runtime.Micronaut

object Application {

    @JvmStatic
    fun main(args: Array&lt;String&gt;) {
        Micronaut.run(Application.javaClass)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the application from a unit test, use the <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Micronaut Test Case</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import jakarta.inject.Inject;

import static org.junit.jupiter.api.Assertions.assertEquals;

@MicronautTest
public class HelloControllerSpec {

    @Inject
    EmbeddedServer server; // <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client; // <b class="conum">(2)</b>

    @Test
    void testHelloWorldResponse() {
        String response = client.toBlocking() // <b class="conum">(3)</b>
                .retrieve(HttpRequest.GET("/hello"));
        assertEquals("Hello World", response); // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Micronaut Test Case</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.extensions.spock.annotation.MicronautTest
import spock.lang.Specification

import jakarta.inject.Inject

@MicronautTest
class HelloControllerSpec extends Specification {

    @Inject
    EmbeddedServer embeddedServer // <b class="conum">(1)</b>

    @Inject
    @Client("/")
    HttpClient client // <b class="conum">(2)</b>

    void "test hello world response"() {
        expect:
            client.toBlocking() // <b class="conum">(3)</b>
                    .retrieve(HttpRequest.GET('/hello')) == "Hello World" // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Micronaut Test Case</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.runtime.server.EmbeddedServer
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import jakarta.inject.Inject

@MicronautTest
class HelloControllerSpec {

    @Inject
    lateinit var server: EmbeddedServer // <b class="conum">(1)</b>

    @Inject
    @field:Client("/")
    lateinit var client: HttpClient // <b class="conum">(2)</b>

    @Test
    fun testHelloWorldResponse() {
        val rsp: String = client.toBlocking() // <b class="conum">(3)</b>
                .retrieve("/hello")
        assertEquals("Hello World", rsp) // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>EmbeddedServer</code> is run and the Spock <code>@AutoCleanup</code> annotation ensures the server is stopped after the specification completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>EmbeddedServer</code> interface provides the <code>URL</code> of the server under test which runs on a random port.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The test uses the Micronaut HTTP client to make the call</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>retrieve</code> method returns the response of the controller as a <code>String</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Without explicit port configuration, the port will be 8080, unless the application is run under the <code>test</code> environment where the port is random. When the application context starts from the context of a test class, the test environment is added automatically.
</td>
</tr>
</table>
</div>

<h2 id="runningSpecificPort"><a class="anchor" href="#runningSpecificPort"></a>6.2 Running Server on a Specific Port</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/runningSpecificPort.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default the server runs on port 8080. However, you can set the server to run on a specific port:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.port=8086</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    port: 8086</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    port=8086</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    port = 8086
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      port = 8086
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "port": 8086
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is also configurable from an environment variable, e.g. <code>MICRONAUT_SERVER_PORT=8086</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run on a random port:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.port=-1</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    port: -1</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    port=-1</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    port = -1
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      port = -1
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "port": -1
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Setting an explicit port may cause tests to fail if multiple servers start simultaneously on the same port. To prevent that, specify a random port in the test environment configuration.
</td>
</tr>
</table>
</div>

<h2 id="routing"><a class="anchor" href="#routing"></a>6.3 HTTP Routing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/routing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation used in the previous section is one of <a href="../api/io/micronaut/http/annotation/package-summary.html">several annotations</a> that allow you to control the construction of HTTP routes.</p>
</div>
<div class="sect1">
<h2 id="_uri_paths">URI Paths</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The value of the <code>@Controller</code> annotation is a <a href="https://tools.ietf.org/html/rfc6570">RFC-6570 URI template</a>, so you can embed URI variables within the path using the syntax defined by the URI template specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many other frameworks, including Spring, implement the URI template specification
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The actual implementation is handled by the <a href="../api/io/micronaut/http/uri/UriMatchTemplate.html">UriMatchTemplate</a> class, which extends <a href="../api/io/micronaut/http/uri/UriTemplate.html">UriTemplate</a>.</p>
</div>
<div class="paragraph">
<p>You can use this class in your applications to build URIs, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">UriMatchTemplate template = UriMatchTemplate.of("/hello/{name}");

assertTrue(template.match("/hello/John").isPresent()); // <b class="conum">(1)</b>
assertEquals("/hello/John", template.expand( // <b class="conum">(2)</b>
        Collections.singletonMap("name", "John")
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">given:
UriMatchTemplate template = UriMatchTemplate.of("/hello/{name}")

expect:
template.match("/hello/John").isPresent() // <b class="conum">(1)</b>
template.expand(["name": "John"]) == "/hello/John" // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using a UriTemplate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val template = UriMatchTemplate.of("/hello/{name}")

assertTrue(template.match("/hello/John").isPresent) // <b class="conum">(1)</b>
assertEquals("/hello/John", template.expand(mapOf("name" to "John")))  // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the <code>match</code> method to match a path</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>expand</code> method to expand a template into a URI</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use <a href="../api/io/micronaut/http/uri/UriTemplate.html">UriTemplate</a> to build paths to include in your responses.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uri_path_variables">URI Path Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>URI variables can be referenced via method arguments. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.PathVariable;

@Controller("/issues") // <b class="conum">(1)</b>
public class IssuesController {

    @Get("/{number}") // <b class="conum">(2)</b>
    public String issue(@PathVariable Integer number) { // <b class="conum">(3)</b>
        return "Issue # " + number + "!"; // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.PathVariable

@Controller("/issues") // <b class="conum">(1)</b>
class IssuesController {

    @Get("/{number}") // <b class="conum">(2)</b>
    String issue(@PathVariable Integer number) { // <b class="conum">(3)</b>
        "Issue # " + number + "!" // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.PathVariable

@Controller("/issues") // <b class="conum">(1)</b>
class IssuesController {

    @Get("/{number}") // <b class="conum">(2)</b>
    fun issue(@PathVariable number: Int): String { // <b class="conum">(3)</b>
        return "Issue # $number!" // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Controller</code> annotation is specified with a base URI of <code>/issues</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Get.html">Get</a> annotation maps the method to an HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> with a URI variable embedded in the URI named <code>number</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The method argument can optionally be annotated with <a href="../api/io/micronaut/http/annotation/PathVariable.html">PathVariable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The value of the URI variable is referenced in the implementation</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut maps the URI <code>/issues/{number}</code> for the above controller. We can assert this is the case by writing unit tests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.ApplicationContext;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.exceptions.HttpClientResponseException;
import io.micronaut.runtime.server.EmbeddedServer;
import org.junit.AfterClass;
import org.junit.BeforeClass;
import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;

public class IssuesControllerTest {

    private static EmbeddedServer server;
    private static HttpClient client;

    @BeforeClass // <b class="conum">(1)</b>
    public static void setupServer() {
        server = ApplicationContext.run(EmbeddedServer.class);
        client = server
                    .getApplicationContext()
                    .createBean(HttpClient.class, server.getURL());
    }

    @AfterClass // <b class="conum">(2)</b>
    public static void stopServer() {
        if (server != null) {
            server.stop();
        }
        if (client != null) {
            client.stop();
        }
    }

    @Test
    public void testIssue() {
        String body = client.toBlocking().retrieve("/issues/12"); // <b class="conum">(3)</b>

        assertNotNull(body);
        assertEquals("Issue # 12!", body); // <b class="conum">(4)</b>
    }

    @Test
    public void testShowWithInvalidInteger() {
        HttpClientResponseException e = assertThrows(HttpClientResponseException.class, () -&gt;
                client.toBlocking().exchange("/issues/hello"));

        assertEquals(400, e.getStatus().getCode()); // <b class="conum">(5)</b>
    }

    @Test
    public void testIssueWithoutNumber() {
        HttpClientResponseException e = assertThrows(HttpClientResponseException.class, () -&gt;
                client.toBlocking().exchange("/issues/"));

        assertEquals(404, e.getStatus().getCode()); // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.ApplicationContext
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.exceptions.HttpClientResponseException
import io.micronaut.runtime.server.EmbeddedServer
import spock.lang.AutoCleanup
import spock.lang.Shared
import spock.lang.Specification

class IssuesControllerTest extends Specification {

    @Shared
    @AutoCleanup // <b class="conum">(2)</b>
    EmbeddedServer embeddedServer = ApplicationContext.run(EmbeddedServer) // <b class="conum">(1)</b>

    @Shared
    @AutoCleanup // <b class="conum">(2)</b>
    HttpClient client = HttpClient.create(embeddedServer.URL) // <b class="conum">(1)</b>

    void "test issue"() {
        when:
        String body = client.toBlocking().retrieve("/issues/12") // <b class="conum">(3)</b>

        then:
        body != null
        body == "Issue # 12!" // <b class="conum">(4)</b>
    }

    void "/issues/{number} with an invalid Integer number responds 400"() {
        when:
        client.toBlocking().exchange("/issues/hello")

        then:
        def e = thrown(HttpClientResponseException)
        e.status.code == 400 // <b class="conum">(5)</b>
    }

    void "/issues/{number} without number responds 404"() {
        when:
        client.toBlocking().exchange("/issues/")

        then:
        def e = thrown(HttpClientResponseException)
        e.status.code == 404 // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Testing URI Variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.kotest.matchers.shouldBe
import io.kotest.matchers.shouldNotBe
import io.kotest.assertions.throwables.shouldThrow
import io.kotest.core.spec.style.StringSpec
import io.micronaut.context.ApplicationContext
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.exceptions.HttpClientResponseException
import io.micronaut.runtime.server.EmbeddedServer

class IssuesControllerTest: StringSpec() {

    val embeddedServer = autoClose( // <b class="conum">(2)</b>
        ApplicationContext.run(EmbeddedServer::class.java) // <b class="conum">(1)</b>
    )

    val client = autoClose( // <b class="conum">(2)</b>
        embeddedServer.applicationContext.createBean(
            HttpClient::class.java,
            embeddedServer.url) // <b class="conum">(1)</b>
    )

    init {
        "test issue" {
            val body = client.toBlocking().retrieve("/issues/12") // <b class="conum">(3)</b>

            body shouldNotBe null
            body shouldBe "Issue # 12!" // <b class="conum">(4)</b>
        }

        "test issue with invalid integer" {
            val e = shouldThrow&lt;HttpClientResponseException&gt; {
                client.toBlocking().exchange&lt;Any&gt;("/issues/hello")
            }

            e.status.code shouldBe 400 // <b class="conum">(5)</b>
        }

        "test issue without number" {
            val e = shouldThrow&lt;HttpClientResponseException&gt; {
                client.toBlocking().exchange&lt;Any&gt;("/issues/")
            }

            e.status.code shouldBe 404 // <b class="conum">(6)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The embedded server and HTTP client are started</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The server and client are cleaned up after the tests finish</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The tests send a request to the URI <code>/issues/12</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>And then asserts the response is "Issue # 12"</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Another test asserts a 400 response is returned when an invalid number is sent in the URL</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Another test asserts a 404 response is returned when no number is provided in the URL. The variable being present is required for the route to be executed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the URI template in the previous example requires that the <code>number</code> variable is specified. You can specify optional URI templates with the syntax: <code>/issues{/number}</code> and by annotating the <code>number</code> parameter with <code>@Nullable</code>.</p>
</div>
<div class="paragraph">
<p>The following table provides examples of URI templates and what they match:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. URI Template Matching</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Template</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Matching URI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple match</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/{id:2}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable of two characters max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/10</code> or <code>/books</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/book{/id:[a-zA-Z]+}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional URI variable with regex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{?max,offset}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional query parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books?max=10&amp;offset=10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books{/path:.*}{.ext}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regex path match with extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/books/foo/bar.xml</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_uri_reserved_character_matching">URI Reserved Character Matching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, URI variables as defined by the <a href="https://tools.ietf.org/html/rfc6570">RFC-6570 URI template</a> spec cannot include reserved characters such as <code>/</code>, <code>?</code> etc.</p>
</div>
<div class="paragraph">
<p>This can be problematic if you wish to match or expand entire paths. As per <a href="https://tools.ietf.org/html/rfc6570#section-3.2.3">section 3.2.3 of the specification</a>, you can use reserved expansion or matching using the <code>+</code> operator.</p>
</div>
<div class="paragraph">
<p>For example the URI <code>/books/{+path}</code> matches both <code>/books/foo</code> and <code>/books/foo/bar</code> since the <code>+</code> indicates that the variable <code>path</code> should include reserved characters (in this case <code>/</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_annotations">Routing Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example uses the <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation to add a method that accepts HTTP <a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a> requests. The following table summarizes the available annotations and how they map to HTTP methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. HTTP Routing Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">HTTP Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Delete.html">@Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#DELETE">DELETE</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Get.html">@Get</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#GET">GET</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Head.html">@Head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#HEAD">HEAD</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Options.html">@Options</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#OPTIONS">OPTIONS</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Patch.html">@Patch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PATCH">PATCH</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Put.html">@Put</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#PUT">PUT</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Post.html">@Post</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#POST">POST</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Trace.html">@Trace</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpMethod.html#TRACE">TRACE</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All the method annotations default to <code>/</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_uris">Multiple URIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each of the routing annotations supports multiple URI templates. For each template, a route is created. This feature is useful for example to change the path of the API and leave the existing path as is for backwards compatibility. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello")
public class BackwardCompatibleController {

    @Get(uris = {"/{name}", "/person/{name}"}) // <b class="conum">(1)</b>
    public String hello(String name) { // <b class="conum">(2)</b>
        return "Hello, " + name;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello")
class BackwardCompatibleController {

    @Get(uris = ["/{name}", "/person/{name}"]) // <b class="conum">(1)</b>
    String hello(String name) { // <b class="conum">(2)</b>
        "Hello, $name"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Multiple URIs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello")
class BackwardCompatibleController {

    @Get(uris = ["/{name}", "/person/{name}"]) // <b class="conum">(1)</b>
    fun hello(name: String): String { // <b class="conum">(2)</b>
        return "Hello, $name"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify multiple templates</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Bind to the template arguments as normal</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Route validation is more complicated with multiple templates. If a variable that would normally be required does not exist in all templates, that variable is considered optional since it may not exist for every execution of the method.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_routes_programmatically">Building Routes Programmatically</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you prefer to not use annotations and instead declare all routes in code then never fear, Micronaut has a flexible <a href="../api/io/micronaut/web/router/RouteBuilder.html">RouteBuilder</a> API that makes it a breeze to define routes programmatically.</p>
</div>
<div class="paragraph">
<p>To start, subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a> and inject the controller to route to into the method, and define your routes:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.ExecutionHandleLocator;
import io.micronaut.web.router.DefaultRouteBuilder;

import jakarta.inject.Inject;
import jakarta.inject.Singleton;

@Singleton
public class MyRoutes extends DefaultRouteBuilder { // <b class="conum">(1)</b>

    public MyRoutes(ExecutionHandleLocator executionHandleLocator,
                    UriNamingStrategy uriNamingStrategy) {
        super(executionHandleLocator, uriNamingStrategy);
    }

    @Inject
    void issuesRoutes(IssuesController issuesController) { // <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController, "issue", Integer.class); // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.ExecutionHandleLocator
import io.micronaut.core.convert.ConversionService
import io.micronaut.web.router.GroovyRouteBuilder

import jakarta.inject.Inject
import jakarta.inject.Singleton

@Singleton
class MyRoutes extends GroovyRouteBuilder { // <b class="conum">(1)</b>

    MyRoutes(ExecutionHandleLocator executionHandleLocator,
             UriNamingStrategy uriNamingStrategy,
             ConversionService conversionService) {
        super(executionHandleLocator, uriNamingStrategy, conversionService)
    }

    @Inject
    void issuesRoutes(IssuesController issuesController) { // <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController.&amp;issue) // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">URI Variables Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.ExecutionHandleLocator
import io.micronaut.web.router.DefaultRouteBuilder
import io.micronaut.web.router.RouteBuilder
import jakarta.inject.Inject
import jakarta.inject.Singleton

@Singleton
class MyRoutes(executionHandleLocator: ExecutionHandleLocator,
               uriNamingStrategy: RouteBuilder.UriNamingStrategy) :
        DefaultRouteBuilder(executionHandleLocator, uriNamingStrategy) { // <b class="conum">(1)</b>

    @Inject
    fun issuesRoutes(issuesController: IssuesController) { // <b class="conum">(2)</b>
        GET("/issues/show/{number}", issuesController, "issue", Int::class.java) // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Route definitions should subclass <a href="../api/io/micronaut/web/router/DefaultRouteBuilder.html">DefaultRouteBuilder</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@Inject</code> to inject a method with the controller to route to</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use methods such as <a href="../api/io/micronaut/web/router/RouteBuilder.html"><code>RouteBuilder::GET(String,Class,String,Class&#8230;&#8203;)</code></a> to route to controller methods. Note that even though the issues controller is used, the route has no knowledge of its <code>@Controller</code> annotation and thus the full path must be specified.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Unfortunately due to type erasure, a Java method lambda reference cannot be used with the API. For Groovy there is a <code>GroovyRouteBuilder</code> class which can be subclassed that allows passing Groovy method references.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_route_compile_time_validation">Route Compile-Time Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut supports validating route arguments at compile time with the validation library. To get started, add the <code>micronaut-http-validation</code> dependency to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-http-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-http-validation&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>With the correct dependency on your classpath, route arguments will automatically be checked at compile time. Compilation will fail if any of the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>
The URI template contains a variable that is optional, but the method parameter is not annotated with <code>@Nullable</code> or is an <code>java.util.Optional</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An optional variable is one that allows the route to match a URI even if the value is not present. For example <code>/foo{/bar}</code> matches requests to <code>/foo</code> and <code>/foo/abc</code>. The non-optional variant would be <code>/foo/{bar}</code>. See the <a href="#_uri_path_variables">URI Path Variables</a> section for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>
The URI template contains a variable that is missing from the method arguments.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To disable route compile-time validation, set the system property <code>-Dmicronaut.route.validation=false</code>. For Java and Kotlin users using Gradle, the same effect can be achieved by removing the <code>micronaut-http-validation</code> dependency from the <code>annotationProcessor</code>/<code>kapt</code> scope.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_routing_non_standard_http_methods">Routing non-standard HTTP methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>@CustomHttpMethod</code> annotation supports non-standard HTTP methods for a client or server. Specifications like <a href="https://tools.ietf.org/html/rfc4918">RFC-4918 Webdav</a> require additional methods like REPORT or LOCK for example.</p>
</div>
<div class="listingblock">
<div class="title">RoutingExample</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CustomHttpMethod(method = "LOCK", value = "/{name}")
String lock(String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation can be used anywhere the standard method annotations can be used, including controllers and declarative HTTP clients.</p>
</div>
</div>
</div>

<h2 id="binding"><a class="anchor" href="#binding"></a>6.4 Simple Request Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/binding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The examples in the previous section demonstrate how Micronaut lets you bind method parameters from URI path variables. This section shows how to bind arguments from other parts of the request.</p>
</div>
<div class="sect1">
<h2 id="_binding_annotations">Binding Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All binding annotations support customization of the name of the variable being bound from with their <code>name</code> member.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the annotations and their purpose, and provides examples:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from a cookie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter from an HTTP header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String requestId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from a request query parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryValue String myParam</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Part.html">@Part</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from a part of a multipart request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Part CompletedFileUpload file</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@RequestAttribute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from an attribute of the request. Attributes are typically created in filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestAttribute String myAttribute</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/PathVariable.html">@PathVariable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds from the path of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathVariable String id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestBean.html">@RequestBean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds any Bindable value to single Bean object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestBean MyBean bean</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The method parameter name is used when a value is not specified in a binding annotation. In other words the following two methods are equivalent and both bind from a cookie named <code>myCookie</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/cookieName")
public String cookieName(@CookieValue("myCookie") String myCookie) {
    // ...
}

@Get("/cookieInferred")
public String cookieInferred(@CookieValue String myCookie) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/cookieName")
String cookieName(@CookieValue("myCookie") String myCookie) {
    // ...
}

@Get("/cookieInferred")
String cookieInferred(@CookieValue String myCookie) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/cookieName")
fun cookieName(@CookieValue("myCookie") myCookie: String): String {
    // ...
}

@Get("/cookieInferred")
fun cookieInferred(@CookieValue myCookie: String): String {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because hyphens are not allowed in variable names, it may be necessary to set the name in the annotation. The following definitions are equivalent:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/headerName")
public String headerName(@Header("Content-Type") String contentType) {
    // ...
}

@Get("/headerInferred")
public String headerInferred(@Header String contentType) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/headerName")
String headerName(@Header("Content-Type") String contentType) {
    // ...
}

@Get("/headerInferred")
String headerInferred(@Header String contentType) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/headerName")
fun headerName(@Header("Content-Type") contentType: String): String {
    // ...
}

@Get("/headerInferred")
fun headerInferred(@Header contentType: String): String {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stream_support">Stream Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut also supports binding the body to an <code>InputStream</code>. If the method is reading the stream, the method execution must be offloaded to another thread pool to avoid blocking the event loop.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With InputStream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post(value = "/read", processes = MediaType.TEXT_PLAIN)
@ExecuteOn(TaskExecutors.IO) // <b class="conum">(1)</b>
String read(@Body InputStream inputStream) throws IOException { // <b class="conum">(2)</b>
    return IOUtils.readText(new BufferedReader(new InputStreamReader(inputStream))); // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With InputStream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Post(value = "/read", processes = MediaType.TEXT_PLAIN)
@ExecuteOn(TaskExecutors.IO) // <b class="conum">(1)</b>
String read(@Body InputStream inputStream) throws IOException { // <b class="conum">(2)</b>
    IOUtils.readText(new BufferedReader(new InputStreamReader(inputStream))) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With InputStream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Post(value = "/read", processes = [MediaType.TEXT_PLAIN])
@ExecuteOn(TaskExecutors.IO) // <b class="conum">(1)</b>
fun read(@Body inputStream: InputStream): String { // <b class="conum">(2)</b>
    return IOUtils.readText(BufferedReader(InputStreamReader(inputStream))) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller method is executed on the IO thread pool</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The body is passed to the method as an input stream</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The stream is read</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_from_multiple_query_values">Binding from Multiple Query values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of binding from a single section of the request, it may be desirable to bind all query values for example to a POJO. This can be achieved by using the exploded operator (<code>?pojo*</code>) in the URI template. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpStatus;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.core.annotation.Nullable;

import javax.validation.Valid;

@Controller("/api")
public class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    public HttpStatus list(@Valid @Nullable PaginationCommand paginationCommand) {
        return HttpStatus.OK;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpStatus
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

import javax.annotation.Nullable
import javax.validation.Valid

@Controller("/api")
class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    HttpStatus list(@Valid @Nullable PaginationCommand paginationCommand) {
        HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Request parameters to POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpStatus
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import javax.validation.Valid

@Controller("/api")
open class BookmarkController {

    @Get("/bookmarks/list{?paginationCommand*}")
    open fun list(@Valid paginationCommand: PaginationCommand): HttpStatus {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_from_multiple_bindable_values">Binding from Multiple Bindable values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of binding just query values, it is also possible to bind any Bindable value to a POJO (e.g. to bind <code>HttpRequest</code>, <code>@PathVariable</code>, <code>@QueryValue</code> and <code>@Header</code> to a single POJO). This can be achieved with the <code>@RequestBean</code> annotation and a custom Bean class with fields with Bindable annotations, or fields that can be bound by type (e.g. <code>HttpRequest</code>, <code>BasicAuth</code>, <code>Authentication</code>, etc.).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Bindable values to POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/api")
public class MovieTicketController {

    // You can also omit query parameters like:
    // @Get("/movie/ticket/{movieId}
    @Get("/movie/ticket/{movieId}{?minPrice,maxPrice}")
    public HttpStatus list(@Valid @RequestBean MovieTicketBean bean) {
        return HttpStatus.OK;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Bindable values to POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/api")
class MovieTicketController {

    // You can also omit query parameters like:
    // @Get("/movie/ticket/{movieId}
    @Get("/movie/ticket/{movieId}{?minPrice,maxPrice}")
    HttpStatus list(@Valid @RequestBean MovieTicketBean bean) {
        HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Bindable values to POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/api")
open class MovieTicketController {

    // You can also omit query parameters like:
    // @Get("/movie/ticket/{movieId}
    @Get("/movie/ticket/{movieId}{?minPrice,maxPrice}")
    open fun list(@Valid @RequestBean bean: MovieTicketBean): HttpStatus {
        return HttpStatus.OK
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which uses this bean class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Bean definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Introspected
public class MovieTicketBean {

    private HttpRequest&lt;?&gt; httpRequest;

    @PathVariable
    private String movieId;

    @Nullable
    @QueryValue
    @PositiveOrZero
    private Double minPrice;

    @Nullable
    @QueryValue
    @PositiveOrZero
    private Double maxPrice;

    public MovieTicketBean(HttpRequest&lt;?&gt; httpRequest,
                           String movieId,
                           Double minPrice,
                           Double maxPrice) {
        this.httpRequest = httpRequest;
        this.movieId = movieId;
        this.minPrice = minPrice;
        this.maxPrice = maxPrice;
    }

    public HttpRequest&lt;?&gt; getHttpRequest() {
        return httpRequest;
    }

    public String getMovieId() {
        return movieId;
    }

    @Nullable
    public Double getMaxPrice() {
        return maxPrice;
    }

    @Nullable
    public Double getMinPrice() {
        return minPrice;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Bean definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Introspected
class MovieTicketBean {

    private HttpRequest&lt;?&gt; httpRequest

    @PathVariable
    String movieId

    @Nullable
    @QueryValue
    @PositiveOrZero
    Double minPrice

    @Nullable
    @QueryValue
    @PositiveOrZero
    Double maxPrice
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Bean definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Introspected
data class MovieTicketBean(
    val httpRequest: HttpRequest&lt;Any&gt;,
    @field:PathVariable val movieId: String,
    @field:QueryValue @field:PositiveOrZero @field:Nullable val minPrice: Double,
    @field:QueryValue @field:PositiveOrZero @field:Nullable val maxPrice: Double
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean class has to be introspected with <code>@Introspected</code>. It can be one of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mutable Bean class with setters and getters</p>
</li>
<li>
<p>Immutable Bean class with getters and an all-argument constructor (or <code>@Creator</code> annotation on a constructor or static method). Arguments of the constructor must match field names so the object can be instantiated without reflection.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Since Java does not retain argument names in bytecode, you must compile code with <code>-parameters</code> to use an immutable bean class from another jar. Another option is to extend Bean class in your source.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bindable_types">Bindable Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generally any type that can be converted from a String representation to a Java type via the <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> API can be bound to.</p>
</div>
<div class="paragraph">
<p>This includes most common Java types, however additional <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> instances can be registered by creating <code>@Singleton</code> beans of type <code>TypeConverter</code>.</p>
</div>
<div class="paragraph">
<p>The handling of nullability deserves special mention. Consider for example the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/headerInferred")
public String headerInferred(@Header String contentType) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/headerInferred")
String headerInferred(@Header String contentType) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/headerInferred")
fun headerInferred(@Header contentType: String): String {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, if the HTTP header <code>Content-Type</code> is not present in the request, the route is considered invalid, since it cannot be satisfied, and a HTTP 400 <code>BAD REQUEST</code> is returned.</p>
</div>
<div class="paragraph">
<p>To make the <code>Content-Type</code> header optional, you can instead write:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/headerNullable")
public String headerNullable(@Nullable @Header String contentType) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/headerNullable")
String headerNullable(@Nullable @Header String contentType) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/headerNullable")
fun headerNullable(@Header contentType: String?): String? {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>null</code> string is passed if the header is absent from the request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>java.util.Optional</code> can also be used, but that is discouraged for method parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, any <code>DateTime</code> that conforms to <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html#RFC_1123_DATE_TIME">RFC-1123</a> can be bound to a parameter. Alternatively the format can be customized with the <a href="../api/io/micronaut/core/convert/format/Format.html">Format</a> annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/date")
public String date(@Header ZonedDateTime date) {
    // ...
}

@Get("/dateFormat")
public String dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header ZonedDateTime date) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/date")
String date(@Header ZonedDateTime date) {
    // ...
}

@Get("/dateFormat")
String dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header ZonedDateTime date) {
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/date")
fun date(@Header date: ZonedDateTime): String {
    // ...
}

@Get("/dateFormat")
fun dateFormat(@Format("dd/MM/yyyy hh:mm:ss a z") @Header date: ZonedDateTime): String {
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_type_based_binding_parameters">Type-Based Binding Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some parameters are recognized by their type instead of their annotation. The following table summarizes the parameter types, their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/BasicAuth.html">BasicAuth</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows binding of basic authorization credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuth basicAuth</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_variable_resolution">Variable resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut tries to populate method arguments in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>URI variables like <code>/{id}</code>.</p>
</li>
<li>
<p>From query parameters if the request is a <code>GET</code> request (e.g. <code>?foo=bar</code>).</p>
</li>
<li>
<p>If there is a <code>@Body</code> and request allows the body, bind the body to it.</p>
</li>
<li>
<p>If the request can have a body and no <code>@Body</code> is defined then try to parse the body (either JSON or form data) and bind the method arguments from the body.</p>
</li>
<li>
<p>Finally, if the method arguments cannot be populated return <code>400 BAD REQUEST</code>.</p>
</li>
</ol>
</div>
</div>
</div>

<h2 id="customArgumentBinding"><a class="anchor" href="#customArgumentBinding"></a>6.5 Custom Argument Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/customArgumentBinding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut uses an <a href="../api/io/micronaut/core/bind/ArgumentBinderRegistry.html">ArgumentBinderRegistry</a> to look up <a href="../api/io/micronaut/core/bind/ArgumentBinder.html">ArgumentBinder</a> beans
capable of binding to the arguments in controller methods. The default implementation looks for an annotation on the argument that is meta-annotated with <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a>. If one exists the argument binder registry searches for an argument binder that supports that annotation.</p>
</div>
<div class="paragraph">
<p>If no fitting annotation is found Micronaut tries to find an argument binder that supports the argument type.</p>
</div>
<div class="paragraph">
<p>An argument binder returns a <a href="../api/io/micronaut/core/bind/ArgumentBinder.BindingResult.html">ArgumentBinder.BindingResult</a>. The binding result gives Micronaut more information than just the value. Binding results are either satisfied or unsatisfied, and either empty or not empty. If an argument binder returns an unsatisfied result, the binder may be called again at different times in request processing. Argument binders are initially called before the body is read and before any filters are executed. If a binder relies on any of that data and it is not present, return a <a href="../api/io/micronaut/core/bind/ArgumentBinder.BindingResult.html#UNSATISFIED">ArgumentBinder.BindingResult#UNSATISFIED</a> result. Returning an <a href="../api/io/micronaut/core/bind/ArgumentBinder.BindingResult.html#EMPTY">ArgumentBinder.BindingResult#EMPTY</a> or satisfied result will be the final result and the binder will not be called again for that request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the end of processing if the result is still <a href="../api/io/micronaut/core/bind/ArgumentBinder.BindingResult.html#UNSATISFIED">ArgumentBinder.BindingResult#UNSATISFIED</a>, it is considered <a href="../api/io/micronaut/core/bind/ArgumentBinder.BindingResult.html#EMPTY">ArgumentBinder.BindingResult#EMPTY</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Key interfaces are:</p>
</div>
<div class="sect2">
<h3 id="_annotatedrequestargumentbinder">AnnotatedRequestArgumentBinder</h3>
<div class="paragraph">
<p>Argument binders that bind based on the presence of an annotation must implement <a href="../api/io/micronaut/http/bind/binders/AnnotatedRequestArgumentBinder.html">AnnotatedRequestArgumentBinder</a>, and can be used by creating an annotation that is annotated with <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">Bindable</a>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An example of a binding annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.AliasFor;
import io.micronaut.core.bind.annotation.Bindable;

import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.FIELD;
import static java.lang.annotation.ElementType.PARAMETER;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Target({FIELD, PARAMETER, ANNOTATION_TYPE})
@Retention(RUNTIME)
@Bindable //<b class="conum">(1)</b>
public @interface ShoppingCart {

    @AliasFor(annotation = Bindable.class, member = "value")
    String value() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An example of a binding annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStatic
import io.micronaut.context.annotation.AliasFor
import io.micronaut.core.bind.annotation.Bindable

import java.lang.annotation.Retention
import java.lang.annotation.Target

import static java.lang.annotation.ElementType.ANNOTATION_TYPE
import static java.lang.annotation.ElementType.FIELD
import static java.lang.annotation.ElementType.PARAMETER
import static java.lang.annotation.RetentionPolicy.RUNTIME

@CompileStatic
@Target([FIELD, PARAMETER, ANNOTATION_TYPE])
@Retention(RUNTIME)
@Bindable //<b class="conum">(1)</b>
@interface ShoppingCart {
    @AliasFor(annotation = Bindable, member = "value")
    String value() default ""
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An example of a binding annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.bind.annotation.Bindable
import kotlin.annotation.AnnotationRetention.RUNTIME
import kotlin.annotation.AnnotationTarget.ANNOTATION_CLASS
import kotlin.annotation.AnnotationTarget.FIELD
import kotlin.annotation.AnnotationTarget.VALUE_PARAMETER

@Target(FIELD, VALUE_PARAMETER, ANNOTATION_CLASS)
@Retention(RUNTIME)
@Bindable //<b class="conum">(1)</b>
annotation class ShoppingCart(val value: String = "")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The binding annotation must itself be annotated as <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">Bindable</a></td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of annotated data binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.convert.ArgumentConversionContext;
import io.micronaut.core.convert.ConversionService;
import io.micronaut.core.type.Argument;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.bind.binders.AnnotatedRequestArgumentBinder;
import io.micronaut.http.cookie.Cookie;
import io.micronaut.jackson.serialize.JacksonObjectSerializer;

import jakarta.inject.Singleton;
import java.util.Map;
import java.util.Optional;

@Singleton
public class ShoppingCartRequestArgumentBinder
        implements AnnotatedRequestArgumentBinder&lt;ShoppingCart, Object&gt; { //<b class="conum">(1)</b>

    private final ConversionService&lt;?&gt; conversionService;
    private final JacksonObjectSerializer objectSerializer;

    public ShoppingCartRequestArgumentBinder(ConversionService&lt;?&gt; conversionService,
                                             JacksonObjectSerializer objectSerializer) {
        this.conversionService = conversionService;
        this.objectSerializer = objectSerializer;
    }

    @Override
    public Class&lt;ShoppingCart&gt; getAnnotationType() {
        return ShoppingCart.class;
    }

    @Override
    public BindingResult&lt;Object&gt; bind(
            ArgumentConversionContext&lt;Object&gt; context,
            HttpRequest&lt;?&gt; source) { //<b class="conum">(2)</b>

        String parameterName = context.getAnnotationMetadata()
                .stringValue(ShoppingCart.class)
                .orElse(context.getArgument().getName());

        Cookie cookie = source.getCookies().get("shoppingCart");
        if (cookie == null) {
            return BindingResult.EMPTY;
        }

        Optional&lt;Map&lt;String, Object&gt;&gt; cookieValue = objectSerializer.deserialize(
                cookie.getValue().getBytes(),
                Argument.mapOf(String.class, Object.class));

        return () -&gt; cookieValue.flatMap(map -&gt; {
            Object obj = map.get(parameterName);
            return conversionService.convert(obj, context);
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of annotated data binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStatic
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.bind.binders.AnnotatedRequestArgumentBinder
import io.micronaut.http.cookie.Cookie
import io.micronaut.jackson.serialize.JacksonObjectSerializer

import jakarta.inject.Singleton

@CompileStatic
@Singleton
class ShoppingCartRequestArgumentBinder
        implements AnnotatedRequestArgumentBinder&lt;ShoppingCart, Object&gt; { //<b class="conum">(1)</b>

    private final ConversionService&lt;?&gt; conversionService
    private final JacksonObjectSerializer objectSerializer

    ShoppingCartRequestArgumentBinder(
            ConversionService&lt;?&gt; conversionService,
            JacksonObjectSerializer objectSerializer) {
        this.conversionService = conversionService
        this.objectSerializer = objectSerializer
    }

    @Override
    Class&lt;ShoppingCart&gt; getAnnotationType() {
        ShoppingCart
    }

    @Override
    BindingResult&lt;Object&gt; bind(
            ArgumentConversionContext&lt;Object&gt; context,
            HttpRequest&lt;?&gt; source) { //<b class="conum">(2)</b>

        String parameterName = context.annotationMetadata
                .stringValue(ShoppingCart)
                .orElse(context.argument.name)

        Cookie cookie = source.cookies.get("shoppingCart")
        if (!cookie) {
            return BindingResult.EMPTY
        }

        Optional&lt;Map&lt;String, Object&gt;&gt; cookieValue = objectSerializer.deserialize(
                cookie.value.bytes,
                Argument.mapOf(String, Object))

        return (BindingResult) { -&gt;
            cookieValue.flatMap({value -&gt;
                conversionService.convert(value.get(parameterName), context)
            })
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of annotated data binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.bind.ArgumentBinder.BindingResult
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.convert.ConversionService
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.bind.binders.AnnotatedRequestArgumentBinder
import io.micronaut.jackson.serialize.JacksonObjectSerializer
import java.util.Optional
import jakarta.inject.Singleton

@Singleton
class ShoppingCartRequestArgumentBinder(
        private val conversionService: ConversionService&lt;*&gt;,
        private val objectSerializer: JacksonObjectSerializer
) : AnnotatedRequestArgumentBinder&lt;ShoppingCart, Any&gt; { //<b class="conum">(1)</b>

    override fun getAnnotationType(): Class&lt;ShoppingCart&gt; {
        return ShoppingCart::class.java
    }

    override fun bind(context: ArgumentConversionContext&lt;Any&gt;,
                      source: HttpRequest&lt;*&gt;): BindingResult&lt;Any&gt; { //<b class="conum">(2)</b>

        val parameterName = context.annotationMetadata
            .stringValue(ShoppingCart::class.java)
            .orElse(context.argument.name)

        val cookie = source.cookies.get("shoppingCart") ?: return BindingResult.EMPTY

        val cookieValue: Optional&lt;Map&lt;String, Any&gt;&gt; = objectSerializer.deserialize(
                cookie.value.toByteArray(),
                Argument.mapOf(String::class.java, Any::class.java))

        return BindingResult {
            cookieValue.flatMap { map: Map&lt;String, Any&gt; -&gt;
                conversionService.convert(map[parameterName], context)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The custom argument binder must implement <a href="../api/io/micronaut/http/bind/binders/AnnotatedRequestArgumentBinder.html">AnnotatedRequestArgumentBinder</a>, including both the annotation type to trigger the binder (in this case, <code>MyBindingAnnotation</code>) and the type of the argument expected (in this case, <code>Object</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Override the <code>bind</code> method with the custom argument binding logic - in this case, we resolve the name of the annotated argument, extract a value from a cookie with that same name, and convert that value to the argument type</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is common to use <a href="../api/io/micronaut/core/convert/ConversionService.html">ConversionService</a> to convert the data to the type of the argument.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the binder is created, we can annotate an argument in our controller method which will be bound using the custom logic we&#8217;ve specified.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A controller operation with this annotated binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Get("/annotated")
    HttpResponse&lt;String&gt; checkSession(@ShoppingCart Long sessionId) { //<b class="conum">(1)</b>
        return HttpResponse.ok("Session:" + sessionId);
    }
    // end::method
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A controller operation with this annotated binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">    @Get("/annotated")
    HttpResponse&lt;String&gt; checkSession(@ShoppingCart Long sessionId) { //<b class="conum">(1)</b>
        HttpResponse.ok("Session:" + sessionId)
    }
    // end::method
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A controller operation with this annotated binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/annotated")
fun checkSession(@ShoppingCart sessionId: Long): HttpResponse&lt;String&gt; { //<b class="conum">(1)</b>
    return HttpResponse.ok("Session:$sessionId")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The parameter is bound with the binder associated with <code>MyBindingAnnotation</code>. This takes precedence over a type-based binder, if applicable.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_typedrequestargumentbinder">TypedRequestArgumentBinder</h3>
<div class="paragraph">
<p>Argument binders that bind based on the type of the argument must implement <a href="../api/io/micronaut/http/bind/binders/TypedRequestArgumentBinder.html">TypedRequestArgumentBinder</a>. For example, given this class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

@Introspected
public class ShoppingCart {

    private String sessionId;
    private Integer total;

    public String getSessionId() {
        return sessionId;
    }

    public void setSessionId(String sessionId) {
        this.sessionId = sessionId;
    }

    public Integer getTotal() {
        return total;
    }

    public void setTotal(Integer total) {
        this.total = total;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

@Introspected
class ShoppingCart {
    String sessionId
    Integer total
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Introspected

@Introspected
class ShoppingCart {
    var sessionId: String? = null
    var total: Int? = null
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can define a <code>TypedRequestArgumentBinder</code> for this class, as seen below:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of typed data binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.convert.ArgumentConversionContext;
import io.micronaut.core.type.Argument;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.bind.binders.TypedRequestArgumentBinder;
import io.micronaut.http.cookie.Cookie;
import io.micronaut.jackson.serialize.JacksonObjectSerializer;

import jakarta.inject.Singleton;
import java.util.Optional;

@Singleton
public class ShoppingCartRequestArgumentBinder
        implements TypedRequestArgumentBinder&lt;ShoppingCart&gt; {

    private final JacksonObjectSerializer objectSerializer;

    public ShoppingCartRequestArgumentBinder(JacksonObjectSerializer objectSerializer) {
        this.objectSerializer = objectSerializer;
    }

    @Override
    public BindingResult&lt;ShoppingCart&gt; bind(ArgumentConversionContext&lt;ShoppingCart&gt; context,
                                            HttpRequest&lt;?&gt; source) { //<b class="conum">(1)</b>

        Cookie cookie = source.getCookies().get("shoppingCart");
        if (cookie == null) {
            return Optional::empty;
        }

        return () -&gt; objectSerializer.deserialize( //<b class="conum">(2)</b>
                cookie.getValue().getBytes(),
                ShoppingCart.class);
    }

    @Override
    public Argument&lt;ShoppingCart&gt; argumentType() {
        return Argument.of(ShoppingCart.class); //<b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of typed data binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.bind.binders.TypedRequestArgumentBinder
import io.micronaut.http.cookie.Cookie
import io.micronaut.jackson.serialize.JacksonObjectSerializer

import jakarta.inject.Singleton

@Singleton
class ShoppingCartRequestArgumentBinder
        implements TypedRequestArgumentBinder&lt;ShoppingCart&gt; {

    private final JacksonObjectSerializer objectSerializer

    ShoppingCartRequestArgumentBinder(JacksonObjectSerializer objectSerializer) {
        this.objectSerializer = objectSerializer
    }

    @Override
    BindingResult&lt;ShoppingCart&gt; bind(ArgumentConversionContext&lt;ShoppingCart&gt; context,
                                     HttpRequest&lt;?&gt; source) { //<b class="conum">(1)</b>

        Cookie cookie = source.cookies.get("shoppingCart")
        if (!cookie) {
            return BindingResult.EMPTY
        }

        return () -&gt; objectSerializer.deserialize( //<b class="conum">(2)</b>
                cookie.value.bytes,
                ShoppingCart)
    }

    @Override
    Argument&lt;ShoppingCart&gt; argumentType() {
        Argument.of(ShoppingCart) //<b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example of typed data binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.bind.ArgumentBinder
import io.micronaut.core.bind.ArgumentBinder.BindingResult
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.bind.binders.TypedRequestArgumentBinder
import io.micronaut.jackson.serialize.JacksonObjectSerializer
import java.util.Optional
import jakarta.inject.Singleton

@Singleton
class ShoppingCartRequestArgumentBinder(private val objectSerializer: JacksonObjectSerializer) :
    TypedRequestArgumentBinder&lt;ShoppingCart&gt; {

    override fun bind(
        context: ArgumentConversionContext&lt;ShoppingCart&gt;,
        source: HttpRequest&lt;*&gt;
    ): BindingResult&lt;ShoppingCart&gt; { //<b class="conum">(1)</b>

        val cookie = source.cookies["shoppingCart"]

        return if (cookie == null)
            BindingResult {
                Optional.empty()
            }
        else {
            BindingResult {
                objectSerializer.deserialize( // <b class="conum">(2)</b>
                    cookie.value.toByteArray(),
                    ShoppingCart::class.java
                )
            }
        }
    }

    override fun argumentType(): Argument&lt;ShoppingCart&gt; {
        return Argument.of(ShoppingCart::class.java) //<b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override the <code>bind</code> method with the data type to bind, in this example the <code>ShoppingCart</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>After retrieving the data (in this case, by deserializing JSON text from a cookie), return as a <a href="../api/io/micronaut/core/bind/ArgumentBinder.BindingResult.html">ArgumentBinder.BindingResult</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Also override the <code>argumentType</code> method, which is used by the ArgumentBinderRegistry.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the binder is created, it is used for any controller argument of the associated type:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A controller operation with this typed binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/typed")
public HttpResponse&lt;?&gt; loadCart(ShoppingCart shoppingCart) { //<b class="conum">(1)</b>
    Map&lt;String, Object&gt; responseMap = new HashMap&lt;&gt;();
    responseMap.put("sessionId", shoppingCart.getSessionId());
    responseMap.put("total", shoppingCart.getTotal());

    return HttpResponse.ok(responseMap);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A controller operation with this typed binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/typed")
HttpResponse&lt;Map&lt;String, Object&gt;&gt; loadCart(ShoppingCart shoppingCart) { //<b class="conum">(1)</b>
    HttpResponse.ok(
            sessionId: shoppingCart.sessionId,
            total: shoppingCart.total)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A controller operation with this typed binding</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/typed")
fun loadCart(shoppingCart: ShoppingCart): HttpResponse&lt;*&gt; { //<b class="conum">(1)</b>
    return HttpResponse.ok(mapOf(
        "sessionId" to shoppingCart.sessionId,
        "total" to shoppingCart.total))
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The parameter is bound using the custom logic defined for this type in our <code>TypedRequestArgumentBinder</code></td>
</tr>
</table>
</div>
</div>

<h2 id="hostResolution"><a class="anchor" href="#hostResolution"></a>6.6 Host Resolution</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/hostResolution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may need to resolve the host name of the current server. Micronaut includes an implementation of the <a href="../api/io/micronaut/http/server/util/HttpHostResolver.html">HttpHostResolver</a> interface.</p>
</div>
<div class="paragraph">
<p>The default implementation looks for host information in the following places in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The supplied configuration</p>
</li>
<li>
<p>The <code>Forwarded</code> header</p>
</li>
<li>
<p><code>X-Forwarded-</code> headers. If the <code>X-Forwarded-Host</code> header is not present, the other <code>X-Forwarded</code> headers are ignored.</p>
</li>
<li>
<p>The <code>Host</code> header</p>
</li>
<li>
<p>The properties on the request URI</p>
</li>
<li>
<p>The properties on the embedded server URI</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The behavior of which headers to pull the relevant data can be changed with the following configuration:</p>
</div>
<a id="io.micronaut.http.server.HttpServerConfiguration.HostResolutionConfiguration" href="#io.micronaut.http.server.HttpServerConfiguration.HostResolutionConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/HttpServerConfiguration.HostResolutionConfiguration.html">HostResolutionConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/HttpServerConfiguration.HostResolutionConfiguration.html">HttpServerConfiguration$HostResolutionConfiguration</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host resolution configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.host-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.protocol-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.port-header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The header name that stores the port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.port-in-host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True if the host header supports a port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.host-resolution.allowed-hosts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of allowed host regex patterns. Any resolved</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The above configuration also supports an allowed host list. Configuring this list ensures any resolved host matches one of the supplied regular expression patterns. That is useful to prevent host cache poisoning attacks and is recommended to be configured.</p>
</div>

<h2 id="localeResolution"><a class="anchor" href="#localeResolution"></a>6.7 Locale Resolution</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/localeResolution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports several strategies for resolving locales for a given request. The <a href="../api/io/micronaut/http/HttpRequest.html#getLocale--">getLocale--</a> method is available on the request, however it only supports parsing the <code>Accept-Language</code> header. For other use cases where the locale can be in a cookie, the user&#8217;s session, or should be set to a fixed value, <a href="../api/io/micronaut/http/server/util/locale/HttpLocaleResolver.html">HttpLocaleResolver</a> can be used to determine the current locale.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/util/LocaleResolver.html">LocaleResolver</a> API does not need to be used directly. Simply define a parameter to a controller method of type <code>java.util.Locale</code> and the locale will be resolved and injected automatically.</p>
</div>
<div class="paragraph">
<p>There are several configuration options to control how to resolve the locale:</p>
</div>
<a id="io.micronaut.http.server.HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties" href="#io.micronaut.http.server.HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.html">HttpLocaleResolutionConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.locale-resolution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/HttpServerConfiguration.HttpLocaleResolutionConfigurationProperties.html">HttpServerConfiguration$HttpLocaleResolutionConfigurationProperties</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The locale resolution configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.locale-resolution.fixed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the language tag for the locale. Supports BCP 47 language
 tags (e.g. "en-US") and ISO standard (e.g "en_US").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.locale-resolution.session-attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the key in the session to look for the locale.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.locale-resolution.cookie-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the cookie that is used to store the locale.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.locale-resolution.header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true if the locale should be resolved from the <code>Accept-Language</code> header.
 Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.locale-resolution.default-locale</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the locale that will be used if the locale cannot be
 resolved through any means. Defaults to the system default.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Locales can be configured in the "en_GB" format, or in the BCP 47 (Language tag) format. If multiple methods are configured, the fixed locale takes precedence, followed by session/cookie, then header.</p>
</div>
<div class="paragraph">
<p>If any of the built-in methods do not meet your use case, create a bean of type <a href="../api/io/micronaut/http/server/util/locale/HttpLocaleResolver.html">HttpLocaleResolver</a> and set its order (through the <code>getOrder</code> method) relative to the existing resolvers.</p>
</div>

<h2 id="clientIpAddress"><a class="anchor" href="#clientIpAddress"></a>6.8 Client IP Address</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/clientIpAddress.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may need to resolve the originating IP address of an HTTP Request. Micronaut includes an implementation of <a href="../api/io/micronaut/http/server/util/HttpClientAddressResolver.html">HttpClientAddressResolver</a>.</p>
</div>
<div class="paragraph">
<p>The default implementation resolves the client address in the following places in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The configured header</p>
</li>
<li>
<p>The <code>Forwarded</code> header</p>
</li>
<li>
<p>The <code>X-Forwarded-For</code> header</p>
</li>
<li>
<p>The remote address on the request</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first priority header name can be configured with <code>micronaut.server.client-address-header</code>.</p>
</div>

<h2 id="requestResponse"><a class="anchor" href="#requestResponse"></a>6.9 The HttpRequest and HttpResponse</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/requestResponse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you need more control over request processing you can write a method that receives the complete <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a>.</p>
</div>
<div class="paragraph">
<p>In fact, there are several higher-level interfaces that can be bound to controller method parameters. These include:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Bindable Micronaut Interfaces</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full <code>HttpRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpRequest request)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpHeaders.html">HttpHeaders</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP headers present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpHeaders headers)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpParameters.html">HttpParameters</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All HTTP parameters (either from URI variables or request parameters) present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(HttpParameters params)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/Cookies.html">Cookies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Cookies present in the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello(Cookies cookies)</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> should be declared parametrized with a concrete generic type if the request body is needed, e.g. <code>HttpRequest&lt;MyClass&gt; request</code>. The body may not be available from the request otherwise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, for full control over the emitted HTTP response you can use the static factory methods of the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> class which return a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a>.</p>
</div>
<div class="paragraph">
<p>The following example implements the previous <code>MessageController</code> example using the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> objects:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.context.ServerRequestContext;
import reactor.core.publisher.Mono;

@Controller("/request")
public class MessageController {

@Get("/hello") // <b class="conum">(1)</b>
public HttpResponse&lt;String&gt; hello(HttpRequest&lt;?&gt; request) {
    String name = request.getParameters()
                         .getFirst("name")
                         .orElse("Nobody"); // <b class="conum">(2)</b>

    return HttpResponse.ok("Hello " + name + "!!")
             .header("X-My-Header", "Foo"); // <b class="conum">(3)</b>
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.context.ServerRequestContext
import reactor.core.publisher.Mono


@Controller("/request")
class MessageController {

@Get("/hello") // <b class="conum">(1)</b>
HttpResponse&lt;String&gt; hello(HttpRequest&lt;?&gt; request) {
    String name = request.parameters
                         .getFirst("name")
                         .orElse("Nobody") // <b class="conum">(2)</b>

    HttpResponse.ok("Hello " + name + "!!")
             .header("X-My-Header", "Foo") // <b class="conum">(3)</b>
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Request and Response Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.context.ServerRequestContext
import reactor.core.publisher.Mono
import reactor.util.context.ContextView


@Controller("/request")
class MessageController {

@Get("/hello") // <b class="conum">(1)</b>
fun hello(request: HttpRequest&lt;*&gt;): HttpResponse&lt;String&gt; {
    val name = request.parameters
                      .getFirst("name")
                      .orElse("Nobody") // <b class="conum">(2)</b>

    return HttpResponse.ok("Hello $name!!")
            .header("X-My-Header", "Foo") // <b class="conum">(3)</b>
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method is mapped to the URI <code>/hello</code> and accepts a <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> is used to obtain the value of a query parameter named <code>name</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/HttpResponse.html#ok-T-">HttpResponse.ok(T)</a> method returns a <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> with a text body. A header named <code>X-My-Header</code> is also added to the response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> is also available from a static context via <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the ServerRequestContext</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.context.ServerRequestContext;
import reactor.core.publisher.Mono;

@Controller("/request")
public class MessageController {

@Get("/hello-static") // <b class="conum">(1)</b>
public HttpResponse&lt;String&gt; helloStatic() {
    HttpRequest&lt;?&gt; request = ServerRequestContext.currentRequest() // <b class="conum">(1)</b>
            .orElseThrow(() -&gt; new RuntimeException("No request present"));
    String name = request.getParameters()
            .getFirst("name")
            .orElse("Nobody");

    return HttpResponse.ok("Hello " + name + "!!")
            .header("X-My-Header", "Foo");
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the ServerRequestContext</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.context.ServerRequestContext
import reactor.core.publisher.Mono


@Controller("/request")
class MessageController {

@Get("/hello-static") // <b class="conum">(1)</b>
HttpResponse&lt;String&gt; helloStatic() {
    HttpRequest&lt;?&gt; request = ServerRequestContext.currentRequest() // <b class="conum">(1)</b>
            .orElseThrow(() -&gt; new RuntimeException("No request present"))
    String name = request.parameters
            .getFirst("name")
            .orElse("Nobody")

    HttpResponse.ok("Hello " + name + "!!")
            .header("X-My-Header", "Foo")
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the ServerRequestContext</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.context.ServerRequestContext
import reactor.core.publisher.Mono
import reactor.util.context.ContextView


@Controller("/request")
class MessageController {

@Get("/hello-static") // <b class="conum">(1)</b>
fun helloStatic(): HttpResponse&lt;String&gt; {
    val request: HttpRequest&lt;*&gt; = ServerRequestContext.currentRequest&lt;Any&gt;() // <b class="conum">(1)</b>
        .orElseThrow { RuntimeException("No request present") }
    val name = request.parameters
        .getFirst("name")
        .orElse("Nobody")
    return HttpResponse.ok("Hello $name!!")
        .header("X-My-Header", "Foo")
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a> is used to retrieve the request.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Generally <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a> is available within reactive flow, but the recommended approach is consume the request as an argument as shown in the previous example. If the request is needed in downstream methods it should be passed as an argument to those methods. There are cases where the context is not propagated because other threads are used to emit the data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative for users of Project Reactor to using the ServerRequestContext is to use the contextual features of Project Reactor to retrieve the request. Because the Micronaut Framework uses Project Reactor as it&#8217;s default reactive streams implementation, users of Project Reactor can benefit by being able to access the request in the context. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the Project Reactor context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.context.ServerRequestContext;
import reactor.core.publisher.Mono;

@Controller("/request")
public class MessageController {

@Get("/hello-reactor")
public Mono&lt;HttpResponse&lt;String&gt;&gt; helloReactor() {
    return Mono.deferContextual(ctx -&gt; { // <b class="conum">(1)</b>
        HttpRequest&lt;?&gt; request = ctx.get(ServerRequestContext.KEY); // <b class="conum">(2)</b>
        String name = request.getParameters()
                .getFirst("name")
                .orElse("Nobody");

        return Mono.just(HttpResponse.ok("Hello " + name + "!!")
                .header("X-My-Header", "Foo"));
    });
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the Project Reactor context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.context.ServerRequestContext
import reactor.core.publisher.Mono


@Controller("/request")
class MessageController {

@Get("/hello-reactor")
Mono&lt;HttpResponse&lt;String&gt;&gt; helloReactor() {
    Mono.deferContextual(ctx -&gt; { // <b class="conum">(1)</b>
        HttpRequest&lt;?&gt; request = ctx.get(ServerRequestContext.KEY) // <b class="conum">(2)</b>
        String name = request.parameters
                .getFirst("name")
                .orElse("Nobody")

        Mono.just(HttpResponse.ok("Hello " + name + "!!")
                .header("X-My-Header", "Foo"))
    })
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the Project Reactor context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.context.ServerRequestContext
import reactor.core.publisher.Mono
import reactor.util.context.ContextView


@Controller("/request")
class MessageController {

@Get("/hello-reactor")
fun helloReactor(): Mono&lt;HttpResponse&lt;String&gt;?&gt;? {
    return Mono.deferContextual { ctx: ContextView -&gt;  // <b class="conum">(1)</b>
        val request = ctx.get&lt;HttpRequest&lt;*&gt;&gt;(ServerRequestContext.KEY) // <b class="conum">(2)</b>
        val name = request.parameters
            .getFirst("name")
            .orElse("Nobody")
        Mono.just(HttpResponse.ok("Hello $name!!")
                .header("X-My-Header", "Foo"))
    }
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Mono is created with a reference to the context</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The request is retrieved from the context</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the context to retrieve the request is the best approach for reactive flows because Project Reactor propagates the context and it does not rely on a thread local like <a href="../api/io/micronaut/http/context/ServerRequestContext.html">ServerRequestContext</a>.</p>
</div>

<h2 id="statusAnnotation"><a class="anchor" href="#statusAnnotation"></a>6.10 Response Status</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/statusAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut controller action responds with a 200 HTTP status code by default.</p>
</div>
<div class="paragraph">
<p>If the action returns an <code>HttpResponse</code>, configure the status code for the response with the <code>status</code> method.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get(value = "/http-response", produces = MediaType.TEXT_PLAIN)
public HttpResponse httpResponse() {
    return HttpResponse.status(HttpStatus.CREATED).body("success");
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get(value = "/http-response", produces = MediaType.TEXT_PLAIN)
HttpResponse httpResponse() {
    HttpResponse.status(HttpStatus.CREATED).body("success")
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get(value = "/http-response", produces = [MediaType.TEXT_PLAIN])
fun httpResponse(): HttpResponse&lt;String&gt; {
    return HttpResponse.status&lt;String&gt;(HttpStatus.CREATED).body("success")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>@Status</code> annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Status(HttpStatus.CREATED)
@Get(produces = MediaType.TEXT_PLAIN)
public String index() {
    return "success";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Status(HttpStatus.CREATED)
@Get(produces = MediaType.TEXT_PLAIN)
String index() {
    "success"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Status(HttpStatus.CREATED)
@Get(produces = [MediaType.TEXT_PLAIN])
fun index(): String {
    return "success"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or even respond with an <code>HttpStatus</code></p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/http-status")
public HttpStatus httpStatus() {
    return HttpStatus.CREATED;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/http-status")
HttpStatus httpStatus() {
    HttpStatus.CREATED
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/http-status")
fun httpStatus(): HttpStatus {
    return HttpStatus.CREATED
}</code></pre>
</div>
</div>

<h2 id="producesAnnotation"><a class="anchor" href="#producesAnnotation"></a>6.11 Response Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/producesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut controller action produces <code>application/json</code> by default. However you can change the <code>Content-Type</code> of the response with the <code>@Produces</code> annotation or the <code>produces</code> member of the HTTP method annotations.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Produces;

@Controller("/produces")
public class ProducesController {

    @Get // <b class="conum">(1)</b>
    public HttpResponse index() {
        return HttpResponse.ok().body("{\"msg\":\"This is JSON\"}");
    }

    @Produces(MediaType.TEXT_HTML)
    @Get("/html") // <b class="conum">(2)</b>
    public String html() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;";
    }

    @Get(value = "/xml", produces = MediaType.TEXT_XML) // <b class="conum">(3)</b>
    public String xml() {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces

@Controller("/produces")
class ProducesController {

    @Get // <b class="conum">(1)</b>
    HttpResponse index() {
        HttpResponse.ok().body('{"msg":"This is JSON"}')
    }

    @Produces(MediaType.TEXT_HTML) // <b class="conum">(2)</b>
    @Get("/html")
    String html() {
        "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }

    @Get(value = "/xml", produces = MediaType.TEXT_XML) // <b class="conum">(3)</b>
    String xml() {
        "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces

@Controller("/produces")
class ProducesController {

    @Get // <b class="conum">(1)</b>
    fun index(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;().body("{\"msg\":\"This is JSON\"}")
    }

    @Produces(MediaType.TEXT_HTML)
    @Get("/html") // <b class="conum">(2)</b>
    fun html(): String {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;HTML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }

    @Get(value = "/xml", produces = [MediaType.TEXT_XML]) // <b class="conum">(3)</b>
    fun xml(): String {
        return "&lt;html&gt;&lt;title&gt;&lt;h1&gt;XML&lt;/h1&gt;&lt;/title&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default content type is JSON</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate a controller action with <code>@Produces</code> to change the response content type.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Setting the <code>produces</code> member of the method annotation also changes the content type.</td>
</tr>
</table>
</div>

<h2 id="consumesAnnotation"><a class="anchor" href="#consumesAnnotation"></a>6.12 Accepted Request Content-Type</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/consumesAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A Micronaut controller action consumes <code>application/json</code> by default. Consuming other content types is supported with the <code>@Consumes</code> annotation, or the <code>consumes</code> member of any HTTP method annotation.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Consumes;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;

@Controller("/consumes")
public class ConsumesController {

    @Post // <b class="conum">(1)</b>
    public HttpResponse index() {
        return HttpResponse.ok();
    }

    @Consumes({MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON}) // <b class="conum">(2)</b>
    @Post("/multiple")
    public HttpResponse multipleConsumes() {
        return HttpResponse.ok();
    }

    @Post(value = "/member", consumes = MediaType.TEXT_PLAIN) // <b class="conum">(3)</b>
    public HttpResponse consumesMember() {
        return HttpResponse.ok();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Consumes
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

@Controller("/consumes")
class ConsumesController {

    @Post // <b class="conum">(1)</b>
    HttpResponse index() {
        HttpResponse.ok()
    }

    @Consumes([MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON]) // <b class="conum">(2)</b>
    @Post("/multiple")
    HttpResponse multipleConsumes() {
        HttpResponse.ok()
    }

    @Post(value = "/member", consumes = MediaType.TEXT_PLAIN) // <b class="conum">(3)</b>
    HttpResponse consumesMember() {
        HttpResponse.ok()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Consumes
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

@Controller("/consumes")
class ConsumesController {

    @Post // <b class="conum">(1)</b>
    fun index(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }

    @Consumes(MediaType.APPLICATION_FORM_URLENCODED, MediaType.APPLICATION_JSON) // <b class="conum">(2)</b>
    @Post("/multiple")
    fun multipleConsumes(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }

    @Post(value = "/member", consumes = [MediaType.TEXT_PLAIN]) // <b class="conum">(3)</b>
    fun consumesMember(): HttpResponse&lt;*&gt; {
        return HttpResponse.ok&lt;Any&gt;()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default, a controller action consumes request with <code>Content-Type</code> of type <code>application/json</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Consumes</code> annotation takes a <code>String[]</code> of supported media types for an incoming request.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Content types can also be specified with the <code>consumes</code> member of the method annotation.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customizing_processed_content_types">Customizing Processed Content Types</h3>
<div class="paragraph">
<p>Normally JSON parsing only happens if the content type is <code>application/json</code>. The other <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> classes behave similarly in that they have predefined content types they can process. To extend the list of media types that a given codec processes, provide configuration that will be stored in <a href="../api/io/micronaut/http/codec/CodecConfiguration.html">CodecConfiguration</a>:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.codec.json.additional-types[0]=text/javascript
micronaut.codec.json.additional-types[1]=...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  codec:
    json:
      additional-types:
        - text/javascript
        - ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.codec]
    [micronaut.codec.json]
      additional-types=[
        "text/javascript",
        "..."
      ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  codec {
    json {
      additionalTypes = ["text/javascript", "..."]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    codec {
      json {
        additional-types = ["text/javascript", "..."]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "codec": {
      "json": {
        "additional-types": ["text/javascript", "..."]
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The currently supported configuration prefixes are <code>json</code>, <code>json-stream</code>, <code>text</code>, and <code>text-stream</code>.</p>
</div>
</div>

<h2 id="reactiveServer"><a class="anchor" href="#reactiveServer"></a>6.13 Reactive HTTP Request Processing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/reactiveServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Micronaut is built on Netty which is designed around an Event loop model and non-blocking I/O. Micronaut executes code defined in <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> beans in the same thread as the request thread (an Event Loop thread).</p>
</div>
<div class="paragraph">
<p>This makes it critical that if you do any blocking I/O operations (for example interactions with Hibernate/JPA or JDBC) that you offload those tasks to a separate thread pool that does not block the Event loop.</p>
</div>
<div class="paragraph">
<p>For example the following configuration configures the I/O thread pool as a fixed thread pool with 75 threads (similar to what a traditional blocking server such as Tomcat uses in the thread-per-request model):</p>
</div>
<div class="openblock">
<div class="title">Configuring the IO thread pool</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.executors.io.type=fixed
micronaut.executors.io.nThreads=75</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  executors:
    io:
      type: fixed
      nThreads: 75</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.executors]
    [micronaut.executors.io]
      type="fixed"
      nThreads=75</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  executors {
    io {
      type = "fixed"
      nThreads = 75
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    executors {
      io {
        type = "fixed"
        nThreads = 75
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "executors": {
      "io": {
        "type": "fixed",
        "nThreads": 75
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use this thread pool in a <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> bean you have a number of options. The simplest is to use the <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation, which can be declared at the type or method level to indicate which configured thread pool to run the method(s) of the controller on:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.docs.http.server.reactive.PersonService;
import io.micronaut.docs.ioc.beans.Person;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;

@Controller("/executeOn/people")
public class PersonController {

    private final PersonService personService;

    PersonController(PersonService personService) {
        this.personService = personService;
    }

    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) // <b class="conum">(1)</b>
    Person byName(String name) {
        return personService.findByName(name);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.docs.http.server.reactive.PersonService
import io.micronaut.docs.ioc.beans.Person
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn

@Controller("/executeOn/people")
class PersonController {

    private final PersonService personService

    PersonController(PersonService personService) {
        this.personService = personService
    }

    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) // <b class="conum">(1)</b>
    Person byName(String name) {
        personService.findByName(name)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @ExecuteOn</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.docs.http.server.reactive.PersonService
import io.micronaut.docs.ioc.beans.Person
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn

@Controller("/executeOn/people")
class PersonController (private val personService: PersonService) {

    @Get("/{name}")
    @ExecuteOn(TaskExecutors.IO) // <b class="conum">(1)</b>
    fun byName(name: String): Person {
        return personService.findByName(name)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation is used to execute the operation on the I/O thread pool</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value of the <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation can be any named executor defined under <code>micronaut.executors</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Generally speaking for database operations you want a thread pool configured that matches the maximum number of connections specified in the database connection pool.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative to the <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation is to use the facility provided by the reactive library you have chosen. Reactive implementations such as <a href="https://projectreactor.io">Project Reactor</a> or <a href="https://github.com/ReactiveX/RxJava">RxJava</a> feature a <code>subscribeOn</code> method which lets you alter which thread executes user code. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Reactive subscribeOn Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.docs.ioc.beans.Person;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.scheduling.TaskExecutors;
import jakarta.inject.Named;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;
import reactor.core.scheduler.Scheduler;
import reactor.core.scheduler.Schedulers;
import io.micronaut.core.async.annotation.SingleResult;
import java.util.concurrent.ExecutorService;

@Controller("/subscribeOn/people")
public class PersonController {

    private final Scheduler scheduler;
    private final PersonService personService;

    PersonController(
            @Named(TaskExecutors.IO) ExecutorService executorService, // <b class="conum">(1)</b>
            PersonService personService) {
        this.scheduler = Schedulers.fromExecutorService(executorService);
        this.personService = personService;
    }

    @Get("/{name}")
    @SingleResult
    Publisher&lt;Person&gt; byName(String name) {
        return Mono
                .fromCallable(() -&gt; personService.findByName(name)) // <b class="conum">(2)</b>
                .subscribeOn(scheduler); // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Reactive subscribeOn Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.docs.ioc.beans.Person
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.scheduling.TaskExecutors
import jakarta.inject.Named
import reactor.core.publisher.Mono
import reactor.core.scheduler.Scheduler
import reactor.core.scheduler.Schedulers
import java.util.concurrent.ExecutorService

@Controller("/subscribeOn/people")
class PersonController {

    private final Scheduler scheduler
    private final PersonService personService

    PersonController(
            @Named(TaskExecutors.IO) ExecutorService executorService, // <b class="conum">(1)</b>
            PersonService personService) {
        this.scheduler = Schedulers.fromExecutorService(executorService)
        this.personService = personService
    }

    @Get("/{name}")
    Mono&lt;Person&gt; byName(String name) {
        return Mono
                .fromCallable({ -&gt; personService.findByName(name) }) // <b class="conum">(2)</b>
                .subscribeOn(scheduler) // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Reactive subscribeOn Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.docs.ioc.beans.Person
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.scheduling.TaskExecutors
import java.util.concurrent.ExecutorService
import jakarta.inject.Named
import reactor.core.publisher.Mono
import reactor.core.scheduler.Scheduler
import reactor.core.scheduler.Schedulers


@Controller("/subscribeOn/people")
class PersonController internal constructor(
    @Named(TaskExecutors.IO) executorService: ExecutorService, // <b class="conum">(1)</b>
    private val personService: PersonService) {

    private val scheduler: Scheduler = Schedulers.fromExecutorService(executorService)

    @Get("/{name}")
    fun byName(name: String): Mono&lt;Person&gt; {
        return Mono
            .fromCallable { personService.findByName(name) } // <b class="conum">(2)</b>
            .subscribeOn(scheduler) // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The configured I/O executor service is injected</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>Mono::fromCallable</code> method wraps the blocking operation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://projectreactor.io">Project Reactor</a> <code>subscribeOn</code> method schedules the operation on the I/O thread pool</td>
</tr>
</table>
</div>

<h2 id="bodyAnnotation"><a class="anchor" href="#bodyAnnotation"></a>6.13.1 Using the @Body Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/reactiveServer/bodyAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To parse the request body, you first indicate to Micronaut which parameter receives the data with the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following example implements a simple echo server that echoes the body sent in the request:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import javax.validation.constraints.Size;

@Controller("/receive")
public class MessageController {

@Post(value = "/echo", consumes = MediaType.TEXT_PLAIN) // <b class="conum">(1)</b>
String echo(@Size(max = 1024) @Body String text) { // <b class="conum">(2)</b>
    return text; // <b class="conum">(3)</b>
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import javax.validation.constraints.Size

@Controller("/receive")
class MessageController {

@Post(value = "/echo", consumes = MediaType.TEXT_PLAIN) // <b class="conum">(1)</b>
String echo(@Size(max = 1024) @Body String text) { // <b class="conum">(2)</b>
    text // <b class="conum">(3)</b>
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the @Body annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import javax.validation.constraints.Size

@Controller("/receive")
open class MessageController {

@Post(value = "/echo", consumes = [MediaType.TEXT_PLAIN]) // <b class="conum">(1)</b>
open fun echo(@Size(max = 1024) @Body text: String): String { // <b class="conum">(2)</b>
    return text // <b class="conum">(3)</b>
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Post.html">Post</a> annotation is used with a <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> of <code>text/plain</code> (the default is <code>application/json</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation is used with a <code>javax.validation.constraints.Size</code> that limits the size of the body to at most 1KB. This constraint does <strong>not</strong> limit the amount of data read/buffered by the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The body is returned as the result of the method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that reading the request body is done in a non-blocking manner in that the request contents are read as the data becomes available and accumulated into the String passed to the method.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>micronaut.server.maxRequestSize</code> setting in your configuration file (e.g <code>application.yml</code>) limits the size of the data (the default maximum request size is 10MB) read/buffered by the server. <code>@Size</code> is <strong>not</strong> a replacement for this setting.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regardless of the limit, for a large amount of data accumulating the data into a String in-memory may lead to memory strain on the server. A better approach is to include a Reactive library in your project (such as <code>Reactor</code>, <code>RxJava</code>,or <code>Akka</code>) that supports the Reactive streams implementation and stream the data it becomes available:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Reactive Streams to Read the request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import javax.validation.constraints.Size;

import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;
import io.micronaut.core.async.annotation.SingleResult;

@Controller("/receive")
public class MessageController {

@Post(value = "/echo-publisher", consumes = MediaType.TEXT_PLAIN) // <b class="conum">(1)</b>
@SingleResult
Publisher&lt;HttpResponse&lt;String&gt;&gt; echoFlow(@Body Publisher&lt;String&gt; text) { //<b class="conum">(2)</b>
    return Flux.from(text)
            .collect(StringBuffer::new, StringBuffer::append) // <b class="conum">(3)</b>
            .map(buffer -&gt; HttpResponse.ok(buffer.toString()));
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Reactive Streams to Read the request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import javax.validation.constraints.Size

import org.reactivestreams.Publisher
import io.micronaut.core.async.annotation.SingleResult
import reactor.core.publisher.Flux

@Controller("/receive")
class MessageController {

@Post(value = "/echo-publisher", consumes = MediaType.TEXT_PLAIN) // <b class="conum">(1)</b>
@SingleResult
Publisher&lt;HttpResponse&lt;String&gt;&gt; echoFlow(@Body Publisher&lt;String&gt; text) { // <b class="conum">(2)</b>
    return Flux.from(text)
            .collect({ x -&gt; new StringBuffer() }, { StringBuffer sb, String s -&gt; sb.append(s) }) // <b class="conum">(3)</b>
            .map({ buffer -&gt; HttpResponse.ok(buffer.toString()) });
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Reactive Streams to Read the request body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import javax.validation.constraints.Size

import org.reactivestreams.Publisher
import io.micronaut.core.async.annotation.SingleResult
import reactor.core.publisher.Flux

@Controller("/receive")
open class MessageController {

@Post(value = "/echo-publisher", consumes = [MediaType.TEXT_PLAIN]) // <b class="conum">(1)</b>
@SingleResult
open fun echoFlow(@Body text: Publisher&lt;String&gt;): Publisher&lt;HttpResponse&lt;String&gt;&gt; { //<b class="conum">(2)</b>
    return Flux.from(text)
        .collect({ StringBuffer() }, { obj, str -&gt; obj.append(str) }) // <b class="conum">(3)</b>
        .map { buffer -&gt; HttpResponse.ok(buffer.toString()) }
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case the method is altered to receive and return an <code>Publisher</code> type.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This example uses <a href="https://projectreactor.io">Project Reactor</a> and returns a single item. Because of that the response type is annotated also with <a href="../api/io/micronaut/core/async/annotation/SingleResult.html">SingleResult</a>. Micronaut only emits the response once the operation completes without blocking.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>collect</code> method is used to accumulate the data in this simulated example, but it could for example write the data to a logging service, database, etc. chunk by chunk</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Body arguments of types that do not require conversion cause Micronaut to skip decoding of the request!
</td>
</tr>
</table>
</div>

<h2 id="reactiveResponses"><a class="anchor" href="#reactiveResponses"></a>6.13.2 Reactive Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/reactiveServer/reactiveResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous section introduced the notion of Reactive programming using <a href="https://projectreactor.io">Project Reactor</a> and Micronaut.</p>
</div>
<div class="paragraph">
<p>Micronaut supports returning common reactive types such as <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> (or <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Maybe.html">Maybe</a> <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Observable.html">Observable</a> types from RxJava), an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> from any controller method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use <a href="https://projectreactor.io">Project Reactor</a>'s <code>Flux</code> or <code>Mono</code> you need to add the Micronaut Reactor dependency to your project to include the necessary converters.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use <a href="https://github.com/ReactiveX/RxJava">RxJava</a>'s <code>Flowable</code>, <code>Single</code> or <code>Maybe</code> you need to add the Micronaut RxJava dependency to your project to include the necessary converters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The argument designated as the body of the request using the <a href="../api/io/micronaut/http/annotation/Body.html">Body</a> annotation can also be a reactive type or a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a>.</p>
</div>
<div class="paragraph">
<p>When returning a reactive type, Micronaut subscribes to the returned reactive type on the same thread as the request (a Netty Event Loop thread). It is therefore important that if you perform any blocking operations, you offload those operations to an appropriately configured thread pool, for example using the <a href="https://projectreactor.io">Project Reactor</a> or <a href="https://github.com/ReactiveX/RxJava">RxJava</a> <code>subscribeOn(..)</code> facility or <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the section on <a href="#threadPools">Configuring Thread Pools</a> for information on the thread pools that Micronaut sets up and how to configure them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To summarize, the following table illustrates some common response types and their handling:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Publisher&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpResponse&lt;Publisher&lt;String&gt;&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any implementation of <code>CharSequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When returning a Reactive type, its type affects the returned response. For example, when returning a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a>, Micronaut cannot know the size of the response, so <code>Transfer-Encoding</code> type of <code>Chunked</code> is used. Whilst for types that emit a single result such as <code><a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a></code> the <code>Content-Length</code> header is populated.
</td>
</tr>
</table>
</div>

<h2 id="jsonBinding"><a class="anchor" href="#jsonBinding"></a>6.14 JSON Binding with Jackson</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/jsonBinding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The most common data interchange format nowadays is JSON.</p>
</div>
<div class="paragraph">
<p>In fact, the defaults in the <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> annotation specify that the controllers in Micronaut consume and produce JSON by default.</p>
</div>
<div class="paragraph">
<p>To do so in a non-blocking manner, Micronaut builds on the <a href="https://github.com/FasterXML/jackson">Jackson</a> Asynchronous JSON parsing API and Netty, such that the reading of incoming JSON is done in a non-blocking manner.</p>
</div>
<div class="sect1">
<h2 id="_binding_using_reactive_frameworks">Binding using Reactive Frameworks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From a developer perspective however, you can generally just work with Plain Old Java Objects (POJOs) and can optionally use a Reactive framework such as <a href="https://github.com/ReactiveX/RxJava">RxJava</a> or <a href="https://projectreactor.io">Project Reactor</a>. The following is an example of a controller that reads and saves an incoming POJO in a non-blocking way from JSON:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Reactive Streams to Read the JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

@Post("/saveReactive")
@SingleResult
public Publisher&lt;HttpResponse&lt;Person&gt;&gt; save(@Body Publisher&lt;Person&gt; person) { // <b class="conum">(1)</b>
    return Mono.from(person).map(p -&gt; {
                inMemoryDatastore.put(p.getFirstName(), p); // <b class="conum">(2)</b>
                return HttpResponse.created(p); // <b class="conum">(3)</b>
            }
    );
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Reactive Streams to Read the JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/people")
class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;()

@Post("/saveReactive")
@SingleResult
Publisher&lt;HttpResponse&lt;Person&gt;&gt; save(@Body Publisher&lt;Person&gt; person) { // <b class="conum">(1)</b>
    Mono.from(person).map({ p -&gt;
        inMemoryDatastore.put(p.getFirstName(), p) // <b class="conum">(2)</b>
        HttpResponse.created(p) // <b class="conum">(3)</b>
    })
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using Reactive Streams to Read the JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

@Post("/saveReactive")
@SingleResult
fun save(@Body person: Publisher&lt;Person&gt;): Publisher&lt;HttpResponse&lt;Person&gt;&gt; { // <b class="conum">(1)</b>
    return Mono.from(person).map { p -&gt;
        inMemoryDatastore[p.firstName] = p // <b class="conum">(2)</b>
        HttpResponse.created(p) // <b class="conum">(3)</b>
    }
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method receives a <code>Publisher</code> which emits the POJO once the JSON has been read</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>map</code> method stores the instance in a <code>Map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> is returned</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using cURL from the command line, you can POST JSON to the <code>/people</code> URI:</p>
</div>
<div class="listingblock">
<div class="title">Using cURL to Post JSON</div>
<div class="content">
<pre>$ curl -X POST localhost:8080/people -d '{"firstName":"Fred","lastName":"Flintstone","age":45}'</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_completablefuture">Binding Using CompletableFuture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The same method as the previous example can also be written with the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> API instead:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

@Post("/saveFuture")
public CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; save(@Body CompletableFuture&lt;Person&gt; person) {
    return person.thenApply(p -&gt; {
                inMemoryDatastore.put(p.getFirstName(), p);
                return HttpResponse.created(p);
            }
    );
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/people")
class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;()

@Post("/saveFuture")
CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; save(@Body CompletableFuture&lt;Person&gt; person) {
    person.thenApply({ p -&gt;
        inMemoryDatastore.put(p.getFirstName(), p)
        HttpResponse.created(p)
    })
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using CompletableFuture to Read the JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

@Post("/saveFuture")
fun save(@Body person: CompletableFuture&lt;Person&gt;): CompletableFuture&lt;HttpResponse&lt;Person&gt;&gt; {
    return person.thenApply { p -&gt;
        inMemoryDatastore[p.firstName] = p
        HttpResponse.created(p)
    }
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example uses the <code>thenApply</code> method to achieve the same as the previous example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binding_using_pojos">Binding using POJOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note however you can just as easily write:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

@Post
public HttpResponse&lt;Person&gt; save(@Body Person person) {
    inMemoryDatastore.put(person.getFirstName(), person);
    return HttpResponse.created(person);
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/people")
class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;()

@Post
HttpResponse&lt;Person&gt; save(@Body Person person) {
    inMemoryDatastore.put(person.getFirstName(), person)
    HttpResponse.created(person)
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding JSON POJOs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

@Post
fun save(@Body person: Person): HttpResponse&lt;Person&gt; {
    inMemoryDatastore[person.firstName] = person
    return HttpResponse.created(person)
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut only executes your method once the data has been read in a non-blocking manner.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The output produced by Jackson can be customized in a variety of ways, from defining Jackson modules to using <a href="https://github.com/FasterXML/jackson-annotations/wiki/Jackson-Annotations">Jackson annotations</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jackson_configuration">Jackson Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Jackson <code>ObjectMapper</code> can be configured through configuration with the <a href="../api/io/micronaut/jackson/JacksonConfiguration.html">JacksonConfiguration</a> class.</p>
</div>
<div class="paragraph">
<p>All Jackson configuration keys start with <code>jackson</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#forLanguageTag-java.lang.String-">Locale.forLanguageTag</a>. Example: <code>en-US</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeZone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <a href="https://docs.oracle.com/javase/8/docs/api/java/util/TimeZone.html#getTimeZone-java.lang.String-">TimeZone.getTimeZone</a>. Example: <code>PST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializationInclusion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <a href="https://fasterxml.github.io/jackson-annotations/javadoc/2.9/com/fasterxml/jackson/annotation/JsonInclude.Include.html">JsonInclude.Include</a>. Example: <code>ALWAYS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">propertyNamingStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of an instance of <a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/PropertyNamingStrategy.html">PropertyNamingStrategy</a>. Example: <code>SNAKE_CASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultTyping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The global defaultTyping for polymorphic type handling from enum <a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/ObjectMapper.DefaultTyping.html">ObjectMapper.DefaultTyping</a>. Example: <code>NON_FINAL</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jackson.serializationInclusion=ALWAYS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
  serializationInclusion: ALWAYS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jackson]
  serializationInclusion="ALWAYS"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jackson {
  serializationInclusion = "ALWAYS"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jackson {
    serializationInclusion = "ALWAYS"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jackson": {
    "serializationInclusion": "ALWAYS"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_features">Features</h3>
<div class="paragraph">
<p>All features can be configured with their name as the key and a boolean to indicate enabled or disabled.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/SerializationFeature.html">SerializationFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deserialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/DeserializationFeature.html">DeserializationFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/MapperFeature.html">MapperFeature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://fasterxml.github.io/jackson-core/javadoc/2.9/com/fasterxml/jackson/core/JsonParser.Feature.html">JsonParser.Feature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://fasterxml.github.io/jackson-core/javadoc/2.9/com/fasterxml/jackson/core/JsonGenerator.Feature.html">JsonGenerator.Feature</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://fasterxml.github.io/jackson-core/javadoc/2.9/com/fasterxml/jackson/core/JsonFactory.Feature.html">JsonFactory.Feature</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jackson.serialization.indentOutput=true
jackson.serialization.writeDatesAsTimestamps=false
jackson.deserialization.useBigIntegerForInts=true
jackson.deserialization.failOnUnknownProperties=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
  serialization:
    indentOutput: true
    writeDatesAsTimestamps: false
  deserialization:
    useBigIntegerForInts: true
    failOnUnknownProperties: false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jackson]
  [jackson.serialization]
    indentOutput=true
    writeDatesAsTimestamps=false
  [jackson.deserialization]
    useBigIntegerForInts=true
    failOnUnknownProperties=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jackson {
  serialization {
    indentOutput = true
    writeDatesAsTimestamps = false
  }
  deserialization {
    useBigIntegerForInts = true
    failOnUnknownProperties = false
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jackson {
    serialization {
      indentOutput = true
      writeDatesAsTimestamps = false
    }
    deserialization {
      useBigIntegerForInts = true
      failOnUnknownProperties = false
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jackson": {
    "serialization": {
      "indentOutput": true,
      "writeDatesAsTimestamps": false
    },
    "deserialization": {
      "useBigIntegerForInts": true,
      "failOnUnknownProperties": false
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_customising_jsonfactory">Further customising <code>JsonFactory</code></h3>
<div class="paragraph">
<p>There may be situations where you wish to customise the <code>JsonFactory</code> used by the <code>ObjectMapper</code> beyond the configuration of features (for example to allow custom character escaping).
This can be achieved by providing your own <code>JsonFactory</code> bean, or by providing a <code>BeanCreatedEventListener&lt;JsonFactory&gt;</code> which configures the default bean on startup.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_jsonview">Support for <code>@JsonView</code></h3>
<div class="paragraph">
<p>You can use the <code>@JsonView</code> annotation on controller methods if you set <code>jackson.json-view.enabled</code> to <code>true</code> in your configuration file (e.g <code>application.yml</code>).</p>
</div>
<div class="paragraph">
<p>Jackson&#8217;s <code>@JsonView</code> annotation lets you control which properties are exposed on a per-response basis. See <a href="https://www.baeldung.com/jackson-json-view-annotation">Jackson JSON Views</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_beans">Beans</h3>
<div class="paragraph">
<p>In addition to configuration, beans can be registered to customize Jackson. All beans that extend any of the following classes are registered with the object mapper:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/Module.html">Module</a></p>
</li>
<li>
<p><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/JsonDeserializer.html">JsonDeserializer</a></p>
</li>
<li>
<p><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/JsonSerializer.html">JsonSerializer</a></p>
</li>
<li>
<p><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/KeyDeserializer.html">KeyDeserializer</a></p>
</li>
<li>
<p><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/deser/BeanDeserializerModifier.html">BeanDeserializerModifier</a></p>
</li>
<li>
<p><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/ser/BeanSerializerModifier.html">BeanSerializerModifier</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_service_loader">Service Loader</h3>
<div class="paragraph">
<p>Any modules registered via the service loader are also added to the default object mapper.</p>
</div>
</div>
<div class="sect2">
<h3 id="_number_precision">Number Precision</h3>
<div class="paragraph">
<p>During JSON parsing, the framework may convert any incoming data to an intermediate object model. By default, this model uses <code>BigInteger</code>, <code>long</code> and <code>double</code> for numeric values. This means some information that could be represented by <code>BigDecimal</code> may be lost. For example, numbers with many decimal places that cannot be represented by <code>double</code> may be truncated, even if the target type for deserialization uses <code>BigDecimal</code>. Metadata on the number of trailing zeroes (<code>BigDecimal.precision()</code>), e.g. the difference between <code>0.12</code> and <code>0.120</code>, is also discarded.</p>
</div>
<div class="paragraph">
<p>If you need full accuracy for number types, use the following configuration:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jackson.deserialization.useBigIntegerForInts=true
jackson.deserialization.useBigDecimalForFloats=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
  deserialization:
    useBigIntegerForInts: true
    useBigDecimalForFloats: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jackson]
  [jackson.deserialization]
    useBigIntegerForInts=true
    useBigDecimalForFloats=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jackson {
  deserialization {
    useBigIntegerForInts = true
    useBigDecimalForFloats = true
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jackson {
    deserialization {
      useBigIntegerForInts = true
      useBigDecimalForFloats = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jackson": {
    "deserialization": {
      "useBigIntegerForInts": true,
      "useBigDecimalForFloats": true
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<h2 id="datavalidation"><a class="anchor" href="#datavalidation"></a>6.15 Data Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/datavalidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is easy to validate incoming data with Micronaut controllers using <a href="#validation">Validation Advice</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut provides native support for the <code>javax.validation</code> annotations with the <code>micronaut-validation</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Or full JSR 380 compliance with the <code>micronaut-hibernate-validator</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.beanvalidation:micronaut-hibernate-validator")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.beanvalidation&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-validator&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>We can validate parameters using <code>javax.validation</code> annotations and the <a href="../api/io/micronaut/validation/Validated.html">Validated</a> annotation at the class level.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.validation.Validated;

import javax.validation.constraints.NotBlank;
import java.util.Collections;

@Validated // <b class="conum">(1)</b>
@Controller("/email")
public class EmailController {

    @Get("/send")
    public HttpResponse send(@NotBlank String recipient, // <b class="conum">(2)</b>
                             @NotBlank String subject) { // <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.validation.Validated

import javax.validation.constraints.NotBlank

@Validated // <b class="conum">(1)</b>
@Controller("/email")
class EmailController {

    @Get("/send")
    HttpResponse send(@NotBlank String recipient, // <b class="conum">(2)</b>
                      @NotBlank String subject) { // <b class="conum">(2)</b>
        HttpResponse.ok(msg: "OK")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.validation.Validated
import javax.validation.constraints.NotBlank

@Validated // <b class="conum">(1)</b>
@Controller("/email")
open class EmailController {

    @Get("/send")
    open fun send(@NotBlank recipient: String, // <b class="conum">(2)</b>
                  @NotBlank subject: String): HttpResponse&lt;*&gt; { // <b class="conum">(2)</b>
        return HttpResponse.ok(mapOf("msg" to "OK"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>subject</code> and <code>recipient</code> cannot be blank.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a validation error occurs a <code>javax.validation.ConstraintViolationException</code> is thrown. By default, the integrated <code>io.micronaut.validation.exception.ConstraintExceptionHandler</code> handles the exception, leading to a behaviour as shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testParametersAreValidated() {
    HttpClientResponseException e = Assertions.assertThrows(HttpClientResponseException.class, () -&gt;
        client.toBlocking().exchange("/email/send?subject=Hi&amp;recipient="));
    HttpResponse&lt;?&gt; response = e.getResponse();

    assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

    response = client.toBlocking().exchange("/email/send?subject=Hi&amp;recipient=me@micronaut.example");

    assertEquals(HttpStatus.OK, response.getStatus());
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def "test parameter validation"() {
    when:
    client.toBlocking().exchange('/email/send?subject=Hi&amp;recipient=')

    then:
    def e = thrown(HttpClientResponseException)
    def response = e.response
    response.status == HttpStatus.BAD_REQUEST

    when:
    response = client.toBlocking().exchange('/email/send?subject=Hi&amp;recipient=me@micronaut.example')

    then:
    response.status == HttpStatus.OK
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example Test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">"test params are validated"() {
    val e = shouldThrow&lt;HttpClientResponseException&gt; {
        client.toBlocking().exchange&lt;Any&gt;("/email/send?subject=Hi&amp;recipient=")
    }
    var response = e.response

    response.status shouldBe HttpStatus.BAD_REQUEST

    response = client.toBlocking().exchange&lt;Any&gt;("/email/send?subject=Hi&amp;recipient=me@micronaut.example")

    response.status shouldBe HttpStatus.OK
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use your own <code>ExceptionHandler</code> to handle the constraint exceptions, annotate it with <code>@Replaces(ConstraintExceptionHandler.class)</code></p>
</div>
<div class="paragraph">
<p>Often you may want to use POJOs as controller method parameters.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;

@Introspected
public class Email {

    @NotBlank // <b class="conum">(1)</b>
    String subject;

    @NotBlank // <b class="conum">(1)</b>
    String recipient;

    public String getSubject() {
        return subject;
    }

    public void setSubject(String subject) {
        this.subject = subject;
    }

    public String getRecipient() {
        return recipient;
    }

    public void setRecipient(String recipient) {
        this.recipient = recipient;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

import javax.validation.constraints.NotBlank

@Introspected
class Email {

    @NotBlank // <b class="conum">(1)</b>
    String subject

    @NotBlank // <b class="conum">(1)</b>
    String recipient
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Introspected
import javax.validation.constraints.NotBlank

@Introspected
open class Email {

    @NotBlank // <b class="conum">(1)</b>
    var subject: String? = null

    @NotBlank // <b class="conum">(1)</b>
    var recipient: String? = null
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can use <code>javax.validation</code> annotations in your POJOs.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Annotate your controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a>, and annotate the binding POJO with <code>@Valid</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;

import javax.validation.Valid;
import java.util.Collections;

@Validated // <b class="conum">(1)</b>
@Controller("/email")
public class EmailController {

    @Post("/send")
    public HttpResponse send(@Body @Valid Email email) { // <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated

import javax.validation.Valid

@Validated // <b class="conum">(1)</b>
@Controller("/email")
class EmailController {

    @Post("/send")
    HttpResponse send(@Body @Valid Email email) { // <b class="conum">(2)</b>
        HttpResponse.ok(msg: "OK")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import javax.validation.Valid

@Validated // <b class="conum">(1)</b>
@Controller("/email")
open class EmailController {

    @Post("/send")
    open fun send(@Body @Valid email: Email): HttpResponse&lt;*&gt; { // <b class="conum">(2)</b>
        return HttpResponse.ok(mapOf("msg" to "OK"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the POJO to validate with <code>@Valid</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Validation of POJOs is shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testPojoValidation() {
    HttpClientResponseException e = assertThrows(HttpClientResponseException.class, () -&gt; {
        Email email = new Email();
        email.subject = "Hi";
        email.recipient = "";
        client.toBlocking().exchange(HttpRequest.POST("/email/send", email));
    });
    HttpResponse&lt;?&gt; response = e.getResponse();

    assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

    Email email = new Email();
    email.subject = "Hi";
    email.recipient = "me@micronaut.example";
    response = client.toBlocking().exchange(HttpRequest.POST("/email/send", email));

    assertEquals(HttpStatus.OK, response.getStatus());
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def "invoking /email/send parse parameters in a POJO and validates"() {
    when:
    Email email = new Email(subject: 'Hi', recipient: '')
    client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

    then:
    def e = thrown(HttpClientResponseException)
    def response = e.response
    response.status == HttpStatus.BAD_REQUEST

    when:
    email = new Email(subject: 'Hi', recipient: 'me@micronaut.example')
    response = client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

    then:
    response.status == HttpStatus.OK
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">"test pojo validation" {
    val e = shouldThrow&lt;HttpClientResponseException&gt; {
        val email = Email()
        email.subject = "Hi"
        email.recipient = ""
        client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))
    }
    var response = e.response

    response.status shouldBe HttpStatus.BAD_REQUEST

    val email = Email()
    email.subject = "Hi"
    email.recipient = "me@micronaut.example"
    response = client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))

    response.status shouldBe HttpStatus.OK
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bean injection is supported in custom constraints with the Hibernate Validator configuration.
</td>
</tr>
</table>
</div>

<h2 id="validationGroups"><a class="anchor" href="#validationGroups"></a>6.15.1 Validation Groups</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/datavalidation/validationGroups.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can enforce a subset of constraints using <a href="https://beanvalidation.org/2.0/spec/#validationapi-validatorapi-groups">validation groups</a> using <code>groups</code> on <a href="../api/io/micronaut/validation/Validated.html">Validated</a>. More information is available in the <a href="https://beanvalidation.org/2.0/spec/#constraintdeclarationvalidationprocess-groupsequence">Bean Validation specification</a></p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.validation.groups.Default;

public interface FinalValidation extends Default {} // <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import javax.validation.groups.Default

interface FinalValidation extends Default {} // <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import javax.validation.groups.Default

interface FinalValidation : Default {} // <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define a custom validation group. This one extends <code>Default</code> so any validations done with this group will include constraints in the <code>Default</code> group.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;

@Introspected
public class Email {

    @NotBlank // <b class="conum">(1)</b>
    String subject;

    @NotBlank(groups = FinalValidation.class) // <b class="conum">(2)</b>
    String recipient;

    public String getSubject() {
        return subject;
    }

    public void setSubject(String subject) {
        this.subject = subject;
    }

    public String getRecipient() {
        return recipient;
    }

    public void setRecipient(String recipient) {
        this.recipient = recipient;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Introspected

import javax.validation.constraints.NotBlank

@Introspected
class Email {

    @NotBlank // <b class="conum">(1)</b>
    String subject

    @NotBlank(groups = FinalValidation) // <b class="conum">(2)</b>
    String recipient
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.annotation.Introspected
import javax.validation.constraints.NotBlank

@Introspected
open class Email {

    @NotBlank // <b class="conum">(1)</b>
    var subject: String? = null

    @NotBlank(groups = [FinalValidation::class]) // <b class="conum">(2)</b>
    var recipient: String? = null
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify a constraint using the Default validation group. This constraint will only be enforced when <code>Default</code> is active.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify a constraint using the custom <code>FinalValidation</code> validation group. This constraint will only be enforced when <code>FinalValidation</code> is active.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Annotate your controller with <a href="../api/io/micronaut/validation/Validated.html">Validated</a>, specifying the validation groups that will be active or letting it default to <code>Default</code>. Also annotate the binding POJO with <code>@Valid</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;

import javax.validation.Valid;
import java.util.Collections;

@Validated // <b class="conum">(1)</b>
@Controller("/email")
public class EmailController {

    @Post("/createDraft")
    public HttpResponse createDraft(@Body @Valid Email email) { // <b class="conum">(2)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));
    }

    @Post("/send")
    @Validated(groups = FinalValidation.class) // <b class="conum">(3)</b>
    public HttpResponse send(@Body @Valid Email email) { // <b class="conum">(4)</b>
        return HttpResponse.ok(Collections.singletonMap("msg", "OK"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated

import javax.validation.Valid

@Validated // <b class="conum">(1)</b>
@Controller("/email")
class EmailController {

    @Post("/createDraft")
    HttpResponse createDraft(@Body @Valid Email email) { // <b class="conum">(2)</b>
        HttpResponse.ok(msg: "OK")
    }

    @Post("/send")
    @Validated(groups = [FinalValidation]) // <b class="conum">(3)</b>
    HttpResponse send(@Body @Valid Email email) { // <b class="conum">(4)</b>
        HttpResponse.ok(msg: "OK")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import javax.validation.Valid

@Validated // <b class="conum">(1)</b>
@Controller("/email")
open class EmailController {

    @Post("/createDraft")
    open fun createDraft(@Body @Valid email: Email): HttpResponse&lt;*&gt; { // <b class="conum">(2)</b>
        return HttpResponse.ok(mapOf("msg" to "OK"))
    }

    @Post("/send")
    @Validated(groups = [FinalValidation::class]) // <b class="conum">(3)</b>
    open fun send(@Body @Valid email: Email): HttpResponse&lt;*&gt; { // <b class="conum">(4)</b>
        return HttpResponse.ok(mapOf("msg" to "OK"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotating with <a href="../api/io/micronaut/validation/Validated.html">Validated</a> without specifying groups means that the <code>Default</code> group will be active. Since this is defined on the class, it will apply to all methods.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constraints in the <code>Default</code> validation group will be enforced, inheriting from the class. The effect is that <code>@NotBlank</code> on <code>email.recipient</code> will not be enforced when this method is called.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specifying <code>groups</code> means that these validation groups will be enforced when this method is called.  Note that <code>FinalValidation</code> extends <code>Default</code> so constraints from both groups will be enforced.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Constraints in the <code>Default</code> and <code>FinalValidation</code> validation groups will be enforced, since <code>FinalValidation</code> extends <code>Default</code>. The effect is that both <code>@NotBlank</code> constraints in <code>email</code> will be enforced when this method is called.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Validation of POJOs using the default validation group is shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testPojoValidation_defaultGroup() {
    HttpClientResponseException e = assertThrows(HttpClientResponseException.class, () -&gt; {
        Email email = new Email();
        email.subject = "";
        email.recipient = "";
        client.toBlocking().exchange(HttpRequest.POST("/email/createDraft", email));
    });
    HttpResponse&lt;?&gt; response = e.getResponse();

    assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

    Email email = new Email();
    email.subject = "Hi";
    email.recipient = "";
    response = client.toBlocking().exchange(HttpRequest.POST("/email/createDraft", email));

    assertEquals(HttpStatus.OK, response.getStatus());
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def "invoking /email/createDraft parse parameters in a POJO and validates using default validation groups"() {
    when:
    Email email = new Email(subject: '', recipient: '')
    client.toBlocking().exchange(HttpRequest.POST('/email/createDraft', email))

    then:
    def e = thrown(HttpClientResponseException)
    def response = e.response
    response.status == HttpStatus.BAD_REQUEST

    when:
    email = new Email(subject: 'Hi', recipient: '')
    response = client.toBlocking().exchange(HttpRequest.POST('/email/createDraft', email))

    then:
    response.status == HttpStatus.OK
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">"test pojo validation using default validation groups" {
    val e = shouldThrow&lt;HttpClientResponseException&gt; {
        val email = Email()
        email.subject = ""
        email.recipient = ""
        client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/createDraft", email))
    }
    var response = e.response

    response.status shouldBe HttpStatus.BAD_REQUEST

    val email = Email()
    email.subject = "Hi"
    email.recipient = ""
    response = client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/createDraft", email))

    response.status shouldBe HttpStatus.OK
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Validation of POJOs using the custom <code>FinalValidation</code> validation group is shown in the following test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testPojoValidation_finalValidationGroup() {
    HttpClientResponseException e = assertThrows(HttpClientResponseException.class, () -&gt; {
        Email email = new Email();
        email.subject = "Hi";
        email.recipient = "";
        client.toBlocking().exchange(HttpRequest.POST("/email/send", email));
    });
    HttpResponse&lt;?&gt; response = e.getResponse();

    assertEquals(HttpStatus.BAD_REQUEST, response.getStatus());

    Email email = new Email();
    email.subject = "Hi";
    email.recipient = "me@micronaut.example";
    response = client.toBlocking().exchange(HttpRequest.POST("/email/send", email));

    assertEquals(HttpStatus.OK, response.getStatus());
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def "invoking /email/send parse parameters in a POJO and validates using FinalValidation validation group"() {
    when:
    Email email = new Email(subject: 'Hi', recipient: '')
    client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

    then:
    def e = thrown(HttpClientResponseException)
    def response = e.response
    response.status == HttpStatus.BAD_REQUEST

    when:
    email = new Email(subject: 'Hi', recipient: 'me@micronaut.example')
    response = client.toBlocking().exchange(HttpRequest.POST('/email/send', email))

    then:
    response.status == HttpStatus.OK
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">"test pojo validation using FinalValidation validation group" {
    val e = shouldThrow&lt;HttpClientResponseException&gt; {
        val email = Email()
        email.subject = "Hi"
        email.recipient = ""
        client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))
    }
    var response = e.response

    response.status shouldBe HttpStatus.BAD_REQUEST

    val email = Email()
    email.subject = "Hi"
    email.recipient = "me@micronaut.example"
    response = client.toBlocking().exchange&lt;Email, Any&gt;(HttpRequest.POST("/email/send", email))

    response.status shouldBe HttpStatus.OK
}</code></pre>
</div>
</div>

<h2 id="staticResources"><a class="anchor" href="#staticResources"></a>6.16 Serving Static Resources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/staticResources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Static resource resolution is enabled by default. Micronaut supports resolving resources from the classpath or the file system.</p>
</div>
<div class="paragraph">
<p>See the information below for available configuration options:</p>
</div>
<a id="io.micronaut.web.router.resource.StaticResourceConfiguration" href="#io.micronaut.web.router.resource.StaticResourceConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/web/router/resource/StaticResourceConfiguration.html">StaticResourceConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether this specific mapping is enabled. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.paths</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of paths either starting with <code>classpath:</code> or <code>file:</code>. You can serve files from anywhere on disk or the classpath. For example to serve static resources from <code>src/main/resources/public</code>, you would use <code>classpath:public</code> as the path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.router.static-resources.*.mapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path resources should be served from. Uses ant path matching. Default value ("/**").</p></td>
</tr>
</tbody>
</table>

<h2 id="errorHandling"><a class="anchor" href="#errorHandling"></a>6.17 Error Handling</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Sometimes with distributed applications, bad things happen. Having a good way to handle errors is important.</p>
</div>

<h2 id="statusHandlers"><a class="anchor" href="#statusHandlers"></a>6.17.1 Status Handlers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling/statusHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Error.html">@Error</a> annotation supports defining either an exception class or an HTTP status. Methods annotated with <a href="../api/io/micronaut/http/annotation/Error.html">@Error</a> must be defined with in a class annotated with <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a>. The annotation also supports the notion of global and local, local being the default.</p>
</div>
<div class="paragraph">
<p>Local error handlers only respond to exceptions thrown as a result of the route being matched to another method in the same controller. Global error handlers can be invoked as a result of any thrown exception. A local error handler is always searched for first when resolving which handler to execute.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When defining an error handler for an exception, you can specify the exception instance as an argument to the method and omit the exception property of the annotation.
</td>
</tr>
</table>
</div>

<h2 id="localErrorHandling"><a class="anchor" href="#localErrorHandling"></a>6.17.2 Local Error Handling</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling/localErrorHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For example, the following method handles JSON parse exceptions from Jackson for the scope of the declaring controller:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Error
public HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException e) { // <b class="conum">(1)</b>
    JsonError error = new JsonError("Invalid JSON: " + e.getMessage()) // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.getUri()));

    return HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, "Fix Your JSON")
            .body(error); // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Error
HttpResponse&lt;JsonError&gt; jsonError(HttpRequest request, JsonParseException e) { // <b class="conum">(1)</b>
    JsonError error = new JsonError("Invalid JSON: " + e.message) // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    HttpResponse.&lt;JsonError&gt;status(HttpStatus.BAD_REQUEST, "Fix Your JSON")
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local exception handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Error
fun jsonError(request: HttpRequest&lt;*&gt;, e: JsonParseException): HttpResponse&lt;JsonError&gt; { // <b class="conum">(1)</b>
    val error = JsonError("Invalid JSON: ${e.message}") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    return HttpResponse.status&lt;JsonError&gt;(HttpStatus.BAD_REQUEST, "Fix Your JSON")
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method that explicitly handles <code>JsonParseException</code> is declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An instance of <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A custom response is returned to handle the error</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Error(status = HttpStatus.NOT_FOUND)
public HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { // <b class="conum">(1)</b>
    JsonError error = new JsonError("Person Not Found") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.getUri()));

    return HttpResponse.&lt;JsonError&gt;notFound()
            .body(error); // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Error(status = HttpStatus.NOT_FOUND)
HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { // <b class="conum">(1)</b>
    JsonError error = new JsonError("Person Not Found") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    HttpResponse.&lt;JsonError&gt;notFound()
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Local status handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Error(status = HttpStatus.NOT_FOUND)
fun notFound(request: HttpRequest&lt;*&gt;): HttpResponse&lt;JsonError&gt; { // <b class="conum">(1)</b>
    val error = JsonError("Person Not Found") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    return HttpResponse.notFound&lt;JsonError&gt;()
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">Error</a> declares which <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> error code to handle (in this case 404)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all 404 responses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#NOT_FOUND">NOT_FOUND</a> response is returned</td>
</tr>
</table>
</div>

<h2 id="globalErrorHandling"><a class="anchor" href="#globalErrorHandling"></a>6.17.3 Global Error Handling</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling/globalErrorHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Error(global = true) // <b class="conum">(1)</b>
public HttpResponse&lt;JsonError&gt; error(HttpRequest request, Throwable e) {
    JsonError error = new JsonError("Bad Things Happened: " + e.getMessage()) // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.getUri()));

    return HttpResponse.&lt;JsonError&gt;serverError()
            .body(error); // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Error(global = true) // <b class="conum">(1)</b>
HttpResponse&lt;JsonError&gt; error(HttpRequest request, Throwable e) {
    JsonError error = new JsonError("Bad Things Happened: " + e.message) // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    HttpResponse.&lt;JsonError&gt;serverError()
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global error handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Error(global = true) // <b class="conum">(1)</b>
fun error(request: HttpRequest&lt;*&gt;, e: Throwable): HttpResponse&lt;JsonError&gt; {
    val error = JsonError("Bad Things Happened: ${e.message}") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    return HttpResponse.serverError&lt;JsonError&gt;()
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">@Error</a> declares the method a global error handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all errors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#INTERNAL_SERVER_ERROR">INTERNAL_SERVER_ERROR</a> response is returned</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Error(status = HttpStatus.NOT_FOUND)
public HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { // <b class="conum">(1)</b>
    JsonError error = new JsonError("Person Not Found") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.getUri()));

    return HttpResponse.&lt;JsonError&gt;notFound()
            .body(error); // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Error(status = HttpStatus.NOT_FOUND)
HttpResponse&lt;JsonError&gt; notFound(HttpRequest request) { // <b class="conum">(1)</b>
    JsonError error = new JsonError("Person Not Found") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    HttpResponse.&lt;JsonError&gt;notFound()
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Global status handler</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Error(status = HttpStatus.NOT_FOUND)
fun notFound(request: HttpRequest&lt;*&gt;): HttpResponse&lt;JsonError&gt; { // <b class="conum">(1)</b>
    val error = JsonError("Person Not Found") // <b class="conum">(2)</b>
            .link(Link.SELF, Link.of(request.uri))

    return HttpResponse.notFound&lt;JsonError&gt;()
            .body(error) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Error.html">@Error</a> declares which <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> error code to handle (in this case 404)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="../api/io/micronaut/http/hateoas/JsonError.html">JsonError</a> instance is returned for all 404 responses</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An <a href="../api/io/micronaut/http/HttpStatus.html#NOT_FOUND">NOT_FOUND</a> response is returned</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A few things to note about the <a href="../api/io/micronaut/http/annotation/Error.html">@Error</a> annotation. You cannot declare identical global <code>@Error</code> annotations. Identical non-global <code>@Error</code> annotations cannot be declared in the same controller. If an <code>@Error</code> annotation with the same parameter exists as global and another as local, the local one takes precedence.
</td>
</tr>
</table>
</div>

<h2 id="exceptionHandler"><a class="anchor" href="#exceptionHandler"></a>6.17.4 ExceptionHandler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling/exceptionHandler.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Alternatively, you can implement an <a href="../api/io/micronaut/http/server/exceptions/ExceptionHandler.html">ExceptionHandler</a>, a generic hook for handling exceptions that occur during execution of an HTTP request.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
An <code>@Error</code> annotation capturing an exception has precedence over an implementation of <code>ExceptionHandler</code> capturing the same exception.
</td>
</tr>
</table>
</div>

<h2 id="builtInExceptionHandlers"><a class="anchor" href="#builtInExceptionHandlers"></a>6.17.4.1 Built-In Exception Handlers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling/exceptionHandler/builtInExceptionHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut ships with several built-in handlers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.validation.ConstraintViolationException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/validation/exceptions/ConstraintExceptionHandler.html">ConstraintExceptionHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/exceptions/ContentLengthExceededException.html">ContentLengthExceededException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/ContentLengthExceededHandler.html">ContentLengthExceededHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/convert/exceptions/ConversionErrorException.html">ConversionErrorException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/ConversionErrorHandler.html">ConversionErrorHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/web/router/exceptions/DuplicateRouteException.html">DuplicateRouteException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/DuplicateRouteHandler.html">DuplicateRouteHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/exceptions/HttpStatusException.html">HttpStatusException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/HttpStatusHandler.html">HttpStatusHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.fasterxml.jackson.core.JsonProcessingException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/JsonExceptionHandler.html">JsonExceptionHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.net.URISyntaxException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/URISyntaxHandler.html">URISyntaxHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/bind/exceptions/UnsatisfiedArgumentException.html">UnsatisfiedArgumentException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/UnsatisfiedArgumentHandler.html">UnsatisfiedArgumentHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/web/router/exceptions/UnsatisfiedRouteException.html">UnsatisfiedRouteException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/exceptions/UnsatisfiedRouteHandler.html">UnsatisfiedRouteHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.mapping.validation.ValidationException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://micronaut-projects.github.io/micronaut-groovy/latest/api/io/micronaut/configuration/gorm/validation/ValidationExceptionHandler.html">ValidationExceptionHandler</a></p></td>
</tr>
</tbody>
</table>

<h2 id="customExceptionHandler"><a class="anchor" href="#customExceptionHandler"></a>6.17.4.2 Custom Exception Handler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling/exceptionHandler/customExceptionHandler.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Imagine your e-commerce app throws an <code>OutOfStockException</code> when a book is out of stock:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class OutOfStockException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class OutOfStockException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class OutOfStockException : RuntimeException()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with <code>BookController</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/books")
public class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    Integer stock(String isbn) {
        throw new OutOfStockException();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/books")
class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    Integer stock(String isbn) {
        throw new OutOfStockException()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/books")
class BookController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    internal fun stock(isbn: String): Int? {
        throw OutOfStockException()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server returns a 500 (Internal Server Error) status code if you don&#8217;t handle the exception.</p>
</div>
<div class="paragraph">
<p>To respond with 400 Bad Request as the response when the <code>OutOfStockException</code> is thrown, you can register a <code>ExceptionHandler</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Produces
@Singleton
@Requires(classes = {OutOfStockException.class, ExceptionHandler.class})
public class OutOfStockExceptionHandler implements ExceptionHandler&lt;OutOfStockException, HttpResponse&gt; {

    private final ErrorResponseProcessor&lt;?&gt; errorResponseProcessor;

    public OutOfStockExceptionHandler(ErrorResponseProcessor&lt;?&gt; errorResponseProcessor) {
        this.errorResponseProcessor = errorResponseProcessor;
    }

    @Override
    public HttpResponse handle(HttpRequest request, OutOfStockException e) {
        return errorResponseProcessor.processResponse(ErrorContext.builder(request)
                .cause(e)
                .errorMessage("No stock available")
                .build(), HttpResponse.badRequest()); // <b class="conum">(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Produces
@Singleton
@Requires(classes = [OutOfStockException, ExceptionHandler])
class OutOfStockExceptionHandler implements ExceptionHandler&lt;OutOfStockException, HttpResponse&gt; {

    private final ErrorResponseProcessor&lt;?&gt; errorResponseProcessor

    OutOfStockExceptionHandler(ErrorResponseProcessor&lt;?&gt; errorResponseProcessor) {
        this.errorResponseProcessor = errorResponseProcessor
    }

    @Override
    HttpResponse handle(HttpRequest request, OutOfStockException e) {
        errorResponseProcessor.processResponse(ErrorContext.builder(request)
                .cause(e)
                .errorMessage("No stock available")
                .build(), HttpResponse.badRequest()) // <b class="conum">(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Produces
@Singleton
@Requirements(
    Requires(classes = [OutOfStockException::class, ExceptionHandler::class])
)
class OutOfStockExceptionHandler(private val errorResponseProcessor: ErrorResponseProcessor&lt;Any&gt;) :
    ExceptionHandler&lt;OutOfStockException, HttpResponse&lt;*&gt;&gt; {

    override fun handle(request: HttpRequest&lt;*&gt;, exception: OutOfStockException): HttpResponse&lt;*&gt; {
        return errorResponseProcessor.processResponse(
                ErrorContext.builder(request)
                    .cause(exception)
                    .errorMessage("No stock available")
                    .build(), HttpResponse.badRequest&lt;Any&gt;()) // <b class="conum">(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default <a href="../api/io/micronaut/http/server/exceptions/response/ErrorResponseProcessor.html">ErrorResponseProcessor</a> is used to create the body of the response</td>
</tr>
</table>
</div>

<h2 id="errorFormatting"><a class="anchor" href="#errorFormatting"></a>6.17.5 Error Formatting</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/errorHandling/errorFormatting.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut produces error response bodies via beans of type <a href="../api/io/micronaut/http/server/exceptions/response/ErrorResponseProcessor.html">ErrorResponseProcessor</a>.</p>
</div>
<div class="paragraph">
<p>The default response body is <a href="https://github.com/blongden/vnd.error">vnd.error</a>, however you can create your own implementation of type <a href="../api/io/micronaut/http/server/exceptions/response/ErrorResponseProcessor.html">ErrorResponseProcessor</a> to control the responses.</p>
</div>
<div class="paragraph">
<p>If customization of the response other than items related to the errors is desired, the exception handler that is handling the exception needs to be overridden.</p>
</div>

<h2 id="apiVersioning"><a class="anchor" href="#apiVersioning"></a>6.18 API Versioning</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/apiVersioning.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.1.x, Micronaut supports API versioning via a dedicated <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> annotation.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to version an API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.version.annotation.Version;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/versioned")
class VersionedController {

    @Version("1") // <b class="conum">(1)</b>
    @Get("/hello")
    String helloV1() {
        return "helloV1";
    }

    @Version("2") // <b class="conum">(2)</b>
    @Get("/hello")
    String helloV2() {
        return "helloV2";
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/versioned")
class VersionedController {

    @Version("1") // <b class="conum">(1)</b>
    @Get("/hello")
    String helloV1() {
        "helloV1"
    }

    @Version("2") // <b class="conum">(2)</b>
    @Get("/hello")
    String helloV2() {
        "helloV2"
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Versioning an API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/versioned")
internal class VersionedController {

    @Version("1") // <b class="conum">(1)</b>
    @Get("/hello")
    fun helloV1(): String {
        return "helloV1"
    }

    @Version("2") // <b class="conum">(2)</b>
    @Get("/hello")
    fun helloV2(): String {
        return "helloV2"
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>helloV1</code> method is declared as version <code>1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>helloV2</code> method is declared as version <code>2</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then enable versioning by setting <code>micronaut.router.versioning.enabled</code> to <code>true</code> in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Enabling Versioning</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.router.versioning.enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  router:
    versioning:
      enabled: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.router]
    [micronaut.router.versioning]
      enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  router {
    versioning {
      enabled = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    router {
      versioning {
        enabled = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "router": {
      "versioning": {
        "enabled": true
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut has two strategies for resolving the version based on an HTTP header named <code>X-API-VERSION</code> or a request parameter named <code>api-version</code>, however this is configurable. A full configuration example can be seen below:</p>
</div>
<div class="openblock">
<div class="title">Configuring Versioning</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.router.versioning.enabled=true
micronaut.router.versioning.parameter.enabled=false
micronaut.router.versioning.parameter.names=v,api-version
micronaut.router.versioning.header.enabled=true
micronaut.router.versioning.header.names[0]=X-API-VERSION
micronaut.router.versioning.header.names[1]=Accept-Version</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  router:
    versioning:
      enabled: true
      parameter:
        enabled: false
        names: 'v,api-version'
      header:
        enabled: true
        names:
          - 'X-API-VERSION'
          - 'Accept-Version'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.router]
    [micronaut.router.versioning]
      enabled=true
      [micronaut.router.versioning.parameter]
        enabled=false
        names="v,api-version"
      [micronaut.router.versioning.header]
        enabled=true
        names=[
          "X-API-VERSION",
          "Accept-Version"
        ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  router {
    versioning {
      enabled = true
      parameter {
        enabled = false
        names = "v,api-version"
      }
      header {
        enabled = true
        names = ["X-API-VERSION", "Accept-Version"]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    router {
      versioning {
        enabled = true
        parameter {
          enabled = false
          names = "v,api-version"
        }
        header {
          enabled = true
          names = ["X-API-VERSION", "Accept-Version"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "router": {
      "versioning": {
        "enabled": true,
        "parameter": {
          "enabled": false,
          "names": "v,api-version"
        },
        "header": {
          "enabled": true,
          "names": ["X-API-VERSION", "Accept-Version"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This example enables versioning</p>
</li>
<li>
<p><code>parameter.enabled</code> enables or disables parameter-based versioning</p>
</li>
<li>
<p><code>parameter.names</code> specifies the parameter names as a comma-separated list</p>
</li>
<li>
<p><code>header.enabled</code> enables or disables header-based versioning</p>
</li>
<li>
<p><code>header.names</code> specifies the header names as a list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this is not enough you can also implement the <a href="../api/io/micronaut/web/router/version/resolution/RequestVersionResolver.html">RequestVersionResolver</a> interface which receives the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and can implement any strategy you choose.</p>
</div>
<div class="sect2">
<h3 id="_default_version">Default Version</h3>
<div class="paragraph">
<p>It is possible to supply a default version through configuration.</p>
</div>
<div class="openblock">
<div class="title">Configuring Default Version</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.router.versioning.enabled=true
micronaut.router.versioning.default-version=3</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  router:
    versioning:
      enabled: true
      default-version: 3</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.router]
    [micronaut.router.versioning]
      enabled=true
      default-version=3</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  router {
    versioning {
      enabled = true
      defaultVersion = 3
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    router {
      versioning {
        enabled = true
        default-version = 3
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "router": {
      "versioning": {
        "enabled": true,
        "default-version": 3
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This example enables versioning and sets the default version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A route is <strong>not</strong> matched if the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default version is configured</p>
</li>
<li>
<p>No version is found in the request</p>
</li>
<li>
<p>The route defines a version</p>
</li>
<li>
<p>The route version does not match the default version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the incoming request specifies a version, the default version has no effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="_versioning_client_requests">Versioning Client Requests</h3>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="#clientAnnotation">Declarative HTTP client</a> also supports automatic versioning of outgoing requests via the <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> annotation.</p>
</div>
<div class="paragraph">
<p>By default, if you annotate a client interface with <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a>, the value supplied to the annotation is included using the <code>X-API-VERSION</code> header.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.version.annotation.Version;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import org.reactivestreams.Publisher;
import io.micronaut.core.async.annotation.SingleResult;

@Client("/hello")
@Version("1") // <b class="conum">(1)</b>
public interface HelloClient {

    @Get("/greeting/{name}")
    String sayHello(String name);

    @Version("2")
    @Get("/greeting/{name}")
    @SingleResult
    Publisher&lt;String&gt; sayHelloTwo(String name); // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import reactor.core.publisher.Mono


@Client("/hello")
@Version("1") // <b class="conum">(1)</b>
interface HelloClient {

    @Get("/greeting/{name}")
    String sayHello(String name)

    @Version("2")
    @Get("/greeting/{name}")
    Mono&lt;String&gt; sayHelloTwo(String name) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.version.annotation.Version
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import reactor.core.publisher.Mono

@Client("/hello")
@Version("1") // <b class="conum">(1)</b>
interface HelloClient {

    @Get("/greeting/{name}")
    fun sayHello(name : String) : String

    @Version("2")
    @Get("/greeting/{name}")
    fun sayHelloTwo(name : String) : Mono&lt;String&gt;  // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a> annotation can be used at the type level to specify the version to use for all methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When defined at the method level it is used only for that method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default behaviour for how the version is sent for each call can be configured with <a href="../api/io/micronaut/http/client/interceptor/configuration/DefaultClientVersioningConfiguration.html">DefaultClientVersioningConfiguration</a>:</p>
</div>
<a id="io.micronaut.http.client.interceptor.configuration.DefaultClientVersioningConfiguration" href="#io.micronaut.http.client.interceptor.configuration.DefaultClientVersioningConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/client/interceptor/configuration/DefaultClientVersioningConfiguration.html">DefaultClientVersioningConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.http.client.versioning.default.headers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of request header names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.http.client.versioning.default.parameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of request query parameter names.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example to use <code>Accept-Version</code> as the header name:</p>
</div>
<div class="openblock">
<div class="title">Configuring Client Versioning</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.versioning.default.headers[0]=Accept-Version
micronaut.http.client.versioning.default.headers[1]=X-API-VERSION</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      versioning:
        default:
          headers:
            - 'Accept-Version'
            - 'X-API-VERSION'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      [micronaut.http.client.versioning]
        [micronaut.http.client.versioning.default]
          headers=[
            "Accept-Version",
            "X-API-VERSION"
          ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      versioning {
        'default' {
          headers = ["Accept-Version", "X-API-VERSION"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        versioning {
          default {
            headers = ["Accept-Version", "X-API-VERSION"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "versioning": {
          "default": {
            "headers": ["Accept-Version", "X-API-VERSION"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>default</code> key refers to the default configuration. You can specify client-specific configuration by using the value passed to <code>@Client</code> (typically the service ID). For example:</p>
</div>
<div class="openblock">
<div class="title">Configuring Versioning</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.versioning.greeting-service.headers[0]=Accept-Version
micronaut.http.client.versioning.greeting-service.headers[1]=X-API-VERSION</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      versioning:
        greeting-service:
          headers:
            - 'Accept-Version'
            - 'X-API-VERSION'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      [micronaut.http.client.versioning]
        [micronaut.http.client.versioning.greeting-service]
          headers=[
            "Accept-Version",
            "X-API-VERSION"
          ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      versioning {
        greetingService {
          headers = ["Accept-Version", "X-API-VERSION"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        versioning {
          greeting-service {
            headers = ["Accept-Version", "X-API-VERSION"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "versioning": {
          "greeting-service": {
            "headers": ["Accept-Version", "X-API-VERSION"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above uses a key named <code>greeting-service</code> which can be used to configure a client annotated with <code>@Client('greeting-service')</code>.</p>
</div>
</div>

<h2 id="formData"><a class="anchor" href="#formData"></a>6.19 Handling Form Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/formData.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To make data binding model customizations consistent between form data and JSON, Micronaut uses Jackson to implement binding data from form submissions.</p>
</div>
<div class="paragraph">
<p>The advantage of this approach is that the same Jackson annotations used for customizing JSON binding can be used for form submissions.</p>
</div>
<div class="paragraph">
<p>In practice this means that to bind regular form data, the only change required to the previous JSON binding code is updating the <a href="../api/io/micronaut/http/MediaType.html">MediaType</a> consumed:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

@Post
public HttpResponse&lt;Person&gt; save(@Body Person person) {
    inMemoryDatastore.put(person.getFirstName(), person);
    return HttpResponse.created(person);
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/people")
class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;()

@Post
HttpResponse&lt;Person&gt; save(@Body Person person) {
    inMemoryDatastore.put(person.getFirstName(), person)
    HttpResponse.created(person)
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to POJOs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

@Post
fun save(@Body person: Person): HttpResponse&lt;Person&gt; {
    inMemoryDatastore[person.firstName] = person
    return HttpResponse.created(person)
}

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To avoid denial of service attacks, collection types and arrays created during binding are limited by the setting <code>jackson.arraySizeThreshold</code> in your configuration file (e.g <code>application.yml</code>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, instead of using a POJO you can bind form data directly to method parameters (which works with JSON too!):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/people")
public class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;();

@Post("/saveWithArgs")
public HttpResponse&lt;Person&gt; save(String firstName, String lastName, Optional&lt;Integer&gt; age) {
    Person p = new Person(firstName, lastName);
    age.ifPresent(p::setAge);
    inMemoryDatastore.put(p.getFirstName(), p);
    return HttpResponse.created(p);
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/people")
class PersonController {

    Map&lt;String, Person&gt; inMemoryDatastore = new ConcurrentHashMap&lt;&gt;()

@Post("/saveWithArgs")
HttpResponse&lt;Person&gt; save(String firstName, String lastName, Optional&lt;Integer&gt; age) {
    Person p = new Person(firstName, lastName)
    age.ifPresent({ a -&gt; p.setAge(a)})
    inMemoryDatastore.put(p.getFirstName(), p)
    HttpResponse.created(p)
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding Form Data to Parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/people")
class PersonController {

    internal var inMemoryDatastore: MutableMap&lt;String, Person&gt; = ConcurrentHashMap()

@Post("/saveWithArgs")
fun save(firstName: String, lastName: String, age: Optional&lt;Int&gt;): HttpResponse&lt;Person&gt; {
    val p = Person(firstName, lastName)
    age.ifPresent { p.age = it }
    inMemoryDatastore[p.firstName] = p
    return HttpResponse.created(p)
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example above, this approach lets you use features such as support for <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a> types and restrict the parameters to be bound. When using POJOs you must be careful to use Jackson annotations to exclude properties that should not be bound.</p>
</div>

<h2 id="serverIO"><a class="anchor" href="#serverIO"></a>6.20 Writing Response Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverIO.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_reactively_writing_response_data">Reactively Writing Response Data</h3>
<div class="paragraph">
<p>Micronaut&#8217;s HTTP server supports writing chunks of response data by returning a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits objects that can be encoded to the HTTP response.</p>
</div>
<div class="paragraph">
<p>The following table summarizes example return type signatures and the behaviour the server exhibits to handle them:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Publisher&lt;String&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits each chunk of content as a String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;byte[]&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> that emits each chunk of content as a <code>byte[]</code> without blocking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;ByteBuf&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Reactor <code>Flux</code> that emits each chunk as a Netty <code>ByteBuf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When emitting a POJO, each emitted object is encoded as JSON by default without blocking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;byte[]&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> that emits each chunk of content as a <code>byte[]</code> without blocking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;ByteBuf&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Reactor <code>Flux</code> that emits each chunk as a Netty <code>ByteBuf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flowable&lt;Book&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When emitting a POJO, each emitted object is encoded as JSON by default without blocking</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When returning a reactive type, the server uses a <code>Transfer-Encoding</code> of <code>chunked</code> and keeps writing data until the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> <code>onComplete</code> method is called.</p>
</div>
<div class="paragraph">
<p>The server requests a single item from the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>, writes it, and requests the next, controlling back pressure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is up to the implementation of the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> to schedule any blocking I/O work that may be done as a result of subscribing to the publisher.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use <a href="https://projectreactor.io">Project Reactor</a>'s <code>Flux</code> or <code>Mono</code> you need to add the Micronaut Reactor dependency to your project to include the necessary converters.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use <a href="https://github.com/ReactiveX/RxJava">RxJava</a>'s <code>Flowable</code>, <code>Single</code> or <code>Maybe</code> you need to add the Micronaut RxJava dependency to your project to include the necessary converters.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_performing_blocking_io">Performing Blocking I/O</h3>
<div class="paragraph">
<p>In some cases you may wish to integrate a library that does not support non-blocking I/O.</p>
</div>
<div class="sect3">
<h4 id="_writable">Writable</h4>
<div class="paragraph">
<p>In this case you can return a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> object from any controller method. The <a href="../api/io/micronaut/core/io/Writable.html">Writable</a> interface has various signatures that allow writing to traditional blocking streams like <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Writer.html">Writer</a> or <a href="https://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html">OutputStream</a>.</p>
</div>
<div class="paragraph">
<p>When returning a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a>, the blocking I/O operation is shifted to the I/O thread pool so the Netty event loop is not blocked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the section on configuring <a href="#threadPools">Server Thread Pools</a> for details on how to configure the I/O thread pool to meet your application requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example demonstrates how to use this API with Groovy&#8217;s <code>SimpleTemplateEngine</code> to write a server side template:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With Writable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import groovy.text.SimpleTemplateEngine;
import groovy.text.Template;
import io.micronaut.core.io.Writable;
import io.micronaut.core.util.CollectionUtils;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.server.exceptions.HttpServerException;

@Controller("/template")
public class TemplateController {

    private final SimpleTemplateEngine templateEngine = new SimpleTemplateEngine();
    private final Template template = initTemplate(); // <b class="conum">(1)</b>

    @Get(value = "/welcome", produces = MediaType.TEXT_PLAIN)
    Writable render() { // <b class="conum">(2)</b>
        return writer -&gt; template.make( // <b class="conum">(3)</b>
            CollectionUtils.mapOf(
                    "firstName", "Fred",
                    "lastName", "Flintstone"
            )
        ).writeTo(writer);
    }

    private Template initTemplate() {
        try {
            return templateEngine.createTemplate(
                    "Dear $firstName $lastName. Nice to meet you."
            );
        } catch (Exception e) {
            throw new HttpServerException("Cannot create template");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With Writable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.text.SimpleTemplateEngine
import groovy.text.Template
import io.micronaut.core.io.Writable
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.server.exceptions.HttpServerException

@Controller("/template")
class TemplateController {

    private final SimpleTemplateEngine templateEngine = new SimpleTemplateEngine()
    private final Template template = initTemplate() // <b class="conum">(1)</b>

    @Get(value = "/welcome", produces = MediaType.TEXT_PLAIN)
    Writable render() { // <b class="conum">(2)</b>
        { writer -&gt;
            template.make( // <b class="conum">(3)</b>
                    firstName: "Fred",
                    lastName: "Flintstone"
            ).writeTo(writer)
        }
    }

    private Template initTemplate() {
        try {
            return templateEngine.createTemplate(
                    'Dear $firstName $lastName. Nice to meet you.'
            )
        } catch (Exception e) {
            throw new HttpServerException("Cannot create template")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With Writable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import groovy.text.SimpleTemplateEngine
import groovy.text.Template
import io.micronaut.core.io.Writable
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.server.exceptions.HttpServerException
import java.io.Writer

@Controller("/template")
class TemplateController {

    private val templateEngine = SimpleTemplateEngine()
    private val template = initTemplate() // <b class="conum">(1)</b>

    @Get(value = "/welcome", produces = [MediaType.TEXT_PLAIN])
    internal fun render(): Writable { // <b class="conum">(2)</b>
        return { writer: Writer -&gt;
            template.make( // <b class="conum">(3)</b>
                    mapOf(
                        "firstName" to "Fred",
                        "lastName" to "Flintstone"
                    )
            ).writeTo(writer)
        } as Writable
    }

    private fun initTemplate(): Template {
        return try {
            templateEngine.createTemplate(
                "Dear \$firstName \$lastName. Nice to meet you."
            )
        } catch (e: Exception) {
            throw HttpServerException("Cannot create template")
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller creates a simple template</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The controller method returns a <a href="../api/io/micronaut/core/io/Writable.html">Writable</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The returned function receives a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Writer.html">Writer</a> and calls <code>writeTo</code> on the template.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_inputstream">InputStream</h4>
<div class="paragraph">
<p>Another option is to return an input stream. This is useful for many scenarios that interact with other APIs that expose a stream.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With InputStream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get(value = "/write", produces = MediaType.TEXT_PLAIN)
InputStream write() {
    byte[] bytes = "test".getBytes(StandardCharsets.UTF_8);
    return new ByteArrayInputStream(bytes); // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With InputStream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get(value = "/write", produces = MediaType.TEXT_PLAIN)
InputStream write() {
    byte[] bytes = "test".getBytes(StandardCharsets.UTF_8);
    new ByteArrayInputStream(bytes) // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Performing Blocking I/O With InputStream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get(value = "/write", produces = [MediaType.TEXT_PLAIN])
fun write(): InputStream {
    val bytes = "test".toByteArray(StandardCharsets.UTF_8)
    return ByteArrayInputStream(bytes) // <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The input stream is returned and its contents will be the response body</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The reading of the stream will be offloaded to the IO thread pool if the controller method is executed on the event loop.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_404_responses">404 Responses</h3>
<div class="paragraph">
<p>Often, you want to respond 404 (Not Found) when you don&#8217;t find an item in your persistence layer or in similar scenarios.</p>
</div>
<div class="paragraph">
<p>See the following example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/books")
public class BooksController {

    @Get("/stock/{isbn}")
    public Map stock(String isbn) {
        return null; //<b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    @SingleResult
    public Publisher&lt;Map&gt; maybestock(String isbn) {
        return Mono.empty(); //<b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/books")
class BooksController {

    @Get("/stock/{isbn}")
    Map stock(String isbn) {
        null //<b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    Mono&lt;Map&gt; maybestock(String isbn) {
        Mono.empty() //<b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/books")
class BooksController {

    @Get("/stock/{isbn}")
    fun stock(isbn: String): Map&lt;*, *&gt;? {
        return null //<b class="conum">(1)</b>
    }

    @Get("/maybestock/{isbn}")
    fun maybestock(isbn: String): Mono&lt;Map&lt;*, *&gt;&gt; {
        return Mono.empty() //<b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Returning <code>null</code> triggers a 404 (Not Found) response.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returning an empty <code>Mono</code> triggers a 404 (Not Found) response.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Responding with an empty <code>Publisher</code> or <code>Flux</code> results in an empty array being returned if the content type is JSON.
</td>
</tr>
</table>
</div>
</div>

<h2 id="uploads"><a class="anchor" href="#uploads"></a>6.21 File Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/uploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Handling of file uploads has special treatment in Micronaut. Support is provided for streaming of uploads in a non-blocking manner through streaming uploads or completed uploads.</p>
</div>
<div class="paragraph">
<p>To receive data from a multipart request, set the <code>consumes</code> argument of the method annotation to <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post(consumes = MediaType.MULTIPART_FORM_DATA)
HttpResponse upload( ... )</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_route_arguments">Route Arguments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Method argument types determine how files are received. Data can be received a chunk at a time or when an upload is completed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the route argument name cannot or should not match the name of the part in the request, add the <a href="../api/io/micronaut/http/annotation/Part.html">Part</a> annotation to the argument and specify the expected name in the request.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_chunk_data_types">Chunk Data Types</h3>
<div class="paragraph">
<p><a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> represents a chunk of data received in a multipart request. <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> interface methods convert the data to a <code>byte[]</code>, <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html">InputStream</a>, or a <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html">ByteBuffer</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Data can only be retrieved from a <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a> once. The underlying buffer is released, causing further attempts to fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Route arguments of type <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> are treated as intended to receive a single file, and each chunk of the received file will be sent downstream. If the generic type is other than <a href="../api/io/micronaut/http/multipart/PartData.html">PartData</a>, conversion will be attempted using Micronaut&#8217;s conversion service. Conversions to <code>String</code> and <code>byte[]</code> are supported by default.</p>
</div>
<div class="paragraph">
<p>If you need knowledge about the metadata of an uploaded file, the <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a> class is a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that also has file information such as the content type and file name.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.StreamingFileUpload;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;
import io.micronaut.core.async.annotation.SingleResult;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.IOException;
import java.io.OutputStream;

import static io.micronaut.http.HttpStatus.CONFLICT;
import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA;
import static io.micronaut.http.MediaType.TEXT_PLAIN;

@Controller("/upload")
public class UploadController {
// end:class[]

    @Post(value = "/", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    @SingleResult
    public Publisher&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { // <b class="conum">(2)</b>

        File tempFile;
        try {
            tempFile = File.createTempFile(file.getFilename(), "temp");
        } catch (IOException e) {
            return Mono.error(e);
        }
        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile); // <b class="conum">(3)</b>

        return Mono.from(uploadPublisher)  // <b class="conum">(4)</b>
            .map(success -&gt; {
                if (success) {
                    return HttpResponse.ok("Uploaded");
                } else {
                    return HttpResponse.&lt;String&gt;status(CONFLICT)
                                       .body("Upload Failed");
                }
            });
    }

    @Post(value = "/outputStream", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    @SingleResult
    public Mono&lt;HttpResponse&lt;String&gt;&gt; uploadOutputStream(StreamingFileUpload file) { // <b class="conum">(2)</b>

        OutputStream outputStream = new ByteArrayOutputStream(); // <b class="conum">(3)</b>

        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(outputStream); // <b class="conum">(4)</b>

        return Mono.from(uploadPublisher)  // <b class="conum">(5)</b>
                .map(success -&gt; {
                    if (success) {
                        return HttpResponse.ok("Uploaded");
                    } else {
                        return HttpResponse.&lt;String&gt;status(CONFLICT)
                                .body("Upload Failed");
                    }
                });
    }

}

@Post(value = "/", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
@SingleResult
public Publisher&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { // <b class="conum">(2)</b>

    File tempFile;
    try {
        tempFile = File.createTempFile(file.getFilename(), "temp");
    } catch (IOException e) {
        return Mono.error(e);
    }
    Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile); // <b class="conum">(3)</b>

    return Mono.from(uploadPublisher)  // <b class="conum">(4)</b>
        .map(success -&gt; {
            if (success) {
                return HttpResponse.ok("Uploaded");
            } else {
                return HttpResponse.&lt;String&gt;status(CONFLICT)
                                   .body("Upload Failed");
            }
        });
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono

import static io.micronaut.http.HttpStatus.CONFLICT
import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import static io.micronaut.http.MediaType.TEXT_PLAIN

@Controller("/upload")
class UploadController {

@Post(value = "/", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
Mono&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { // <b class="conum">(2)</b>

    File tempFile = File.createTempFile(file.filename, "temp")
    Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile) // <b class="conum">(3)</b>

    Mono.from(uploadPublisher)  // <b class="conum">(4)</b>
        .map({ success -&gt;
            if (success) {
                HttpResponse.ok("Uploaded")
            } else {
                HttpResponse.&lt;String&gt;status(CONFLICT)
                        .body("Upload Failed")
            }
        })
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.async.annotation.SingleResult
import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus.CONFLICT
import io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import io.micronaut.http.MediaType.TEXT_PLAIN
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono
import java.io.ByteArrayOutputStream
import java.io.File
import java.io.OutputStream

@Controller("/upload")
class UploadController {

@Post(value = "/", consumes = [MULTIPART_FORM_DATA], produces = [TEXT_PLAIN]) // <b class="conum">(1)</b>
fun upload(file: StreamingFileUpload): Mono&lt;HttpResponse&lt;String&gt;&gt; { // <b class="conum">(2)</b>

    val tempFile = File.createTempFile(file.filename, "temp")
    val uploadPublisher = file.transferTo(tempFile) // <b class="conum">(3)</b>

    return Mono.from(uploadPublisher)  // <b class="conum">(4)</b>
        .map { success -&gt;
            if (success) {
                HttpResponse.ok("Uploaded")
            } else {
                HttpResponse.status&lt;String&gt;(CONFLICT)
                    .body("Upload Failed")
            }
        }
}

}
// end::endclass]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method consumes <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html#transferTo-File-">StreamingFileUpload.transferTo(File)</a> method transfers the file to the server. The method returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The returned <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> subscribes to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and outputs a response once the upload is complete, without blocking.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to pass an output stream with the <code>transferTo</code> method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The reading of the file or stream will be offloaded to the IO thread pool to prevent the possibility of blocking the event loop.
</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.StreamingFileUpload;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;
import io.micronaut.core.async.annotation.SingleResult;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.IOException;
import java.io.OutputStream;

import static io.micronaut.http.HttpStatus.CONFLICT;
import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA;
import static io.micronaut.http.MediaType.TEXT_PLAIN;

@Controller("/upload")
public class UploadController {
// end:class[]

    @Post(value = "/", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    @SingleResult
    public Publisher&lt;HttpResponse&lt;String&gt;&gt; upload(StreamingFileUpload file) { // <b class="conum">(2)</b>

        File tempFile;
        try {
            tempFile = File.createTempFile(file.getFilename(), "temp");
        } catch (IOException e) {
            return Mono.error(e);
        }
        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(tempFile); // <b class="conum">(3)</b>

        return Mono.from(uploadPublisher)  // <b class="conum">(4)</b>
            .map(success -&gt; {
                if (success) {
                    return HttpResponse.ok("Uploaded");
                } else {
                    return HttpResponse.&lt;String&gt;status(CONFLICT)
                                       .body("Upload Failed");
                }
            });
    }

    @Post(value = "/outputStream", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    @SingleResult
    public Mono&lt;HttpResponse&lt;String&gt;&gt; uploadOutputStream(StreamingFileUpload file) { // <b class="conum">(2)</b>

        OutputStream outputStream = new ByteArrayOutputStream(); // <b class="conum">(3)</b>

        Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(outputStream); // <b class="conum">(4)</b>

        return Mono.from(uploadPublisher)  // <b class="conum">(5)</b>
                .map(success -&gt; {
                    if (success) {
                        return HttpResponse.ok("Uploaded");
                    } else {
                        return HttpResponse.&lt;String&gt;status(CONFLICT)
                                .body("Upload Failed");
                    }
                });
    }

}

@Post(value = "/outputStream", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
@SingleResult
public Mono&lt;HttpResponse&lt;String&gt;&gt; uploadOutputStream(StreamingFileUpload file) { // <b class="conum">(2)</b>

    OutputStream outputStream = new ByteArrayOutputStream(); // <b class="conum">(3)</b>

    Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(outputStream); // <b class="conum">(4)</b>

    return Mono.from(uploadPublisher)  // <b class="conum">(5)</b>
            .map(success -&gt; {
                if (success) {
                    return HttpResponse.ok("Uploaded");
                } else {
                    return HttpResponse.&lt;String&gt;status(CONFLICT)
                            .body("Upload Failed");
                }
            });
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono

import static io.micronaut.http.HttpStatus.CONFLICT
import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import static io.micronaut.http.MediaType.TEXT_PLAIN

@Controller("/upload")
class UploadController {

@Post(value = "/outputStream", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
@SingleResult
Mono&lt;HttpResponse&lt;String&gt;&gt; uploadOutputStream(StreamingFileUpload file) { // <b class="conum">(2)</b>

    OutputStream outputStream = new ByteArrayOutputStream() // <b class="conum">(3)</b>

    Publisher&lt;Boolean&gt; uploadPublisher = file.transferTo(outputStream) // <b class="conum">(4)</b>

    Mono.from(uploadPublisher)  // <b class="conum">(5)</b>
            .map({ success -&gt;
                if (success) {
                    HttpResponse.ok("Uploaded")
                } else {
                    HttpResponse.&lt;String&gt;status(CONFLICT)
                            .body("Upload Failed")
                }
            })
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming file upload</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.async.annotation.SingleResult
import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus.CONFLICT
import io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import io.micronaut.http.MediaType.TEXT_PLAIN
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.StreamingFileUpload
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono
import java.io.ByteArrayOutputStream
import java.io.File
import java.io.OutputStream

@Controller("/upload")
class UploadController {

@Post(value = "/outputStream", consumes = [MULTIPART_FORM_DATA], produces = [TEXT_PLAIN]) // <b class="conum">(1)</b>
@SingleResult
fun uploadOutputStream(file: StreamingFileUpload): Mono&lt;HttpResponse&lt;String&gt;&gt; { // <b class="conum">(2)</b>
    val outputStream  = ByteArrayOutputStream() // <b class="conum">(3)</b>
    val uploadPublisher = file.transferTo(outputStream) // <b class="conum">(4)</b>

    return Mono.from(uploadPublisher) // <b class="conum">(5)</b>
        .map { success: Boolean -&gt;
            return@map if (success) {
                HttpResponse.ok("Uploaded")
            } else {
                HttpResponse.status&lt;String&gt;(CONFLICT)
                    .body("Upload Failed")
            }
        }
}

}
// end::endclass]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method consumes <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A stream is created to output the data to. In real world scenarios this would come from some other source.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html#transferTo-OutputStream-">StreamingFileUpload.transferTo(OutputStream)</a> method transfers the file to the server. The method returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The returned <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> subscribes to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and outputs a response once the upload is complete, without blocking.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_whole_data_types">Whole Data Types</h3>
<div class="paragraph">
<p>Route arguments that are not publishers cause route execution to be delayed until the upload has finished. The received data will attempt to be converted to the requested type. Conversions to a <code>String</code> or <code>byte[]</code> are supported by default. In addition, the file can be converted to a POJO if a media type codec is registered that supports the media type of the file. A media type codec is included by default that allows conversion of JSON files to POJOs.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA;
import static io.micronaut.http.MediaType.TEXT_PLAIN;

@Controller("/upload")
public class BytesUploadController {

    @Post(value = "/bytes", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; uploadBytes(byte[] file, String fileName) { // <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(fileName, "temp");
            Path path = Paths.get(tempFile.getAbsolutePath());
            Files.write(path, file); // <b class="conum">(3)</b>
            return HttpResponse.ok("Uploaded");
        } catch (IOException e) {
            return HttpResponse.badRequest("Upload Failed");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post

import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import static io.micronaut.http.MediaType.TEXT_PLAIN

@Controller("/upload")
class BytesUploadController {

    @Post(value = "/bytes", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; uploadBytes(byte[] file, String fileName) { // <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(fileName, "temp")
            Path path = Paths.get(tempFile.absolutePath)
            Files.write(path, file) // <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (IOException e) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving a byte array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType
import io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import io.micronaut.http.MediaType.TEXT_PLAIN
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import java.io.File
import java.io.IOException
import java.nio.file.Files
import java.nio.file.Paths

@Controller("/upload")
class BytesUploadController {

    @Post(value = "/bytes", consumes = [MULTIPART_FORM_DATA], produces = [TEXT_PLAIN]) // <b class="conum">(1)</b>
    fun uploadBytes(file: ByteArray, fileName: String): HttpResponse&lt;String&gt; { // <b class="conum">(2)</b>
        return try {
            val tempFile = File.createTempFile(fileName, "temp")
            val path = Paths.get(tempFile.absolutePath)
            Files.write(path, file) // <b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (e: IOException) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need knowledge about the metadata of an uploaded file, the <a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a> class has methods to retrieve the data of the file, and also file information such as the content type and file name.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.CompletedFileUpload;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA;
import static io.micronaut.http.MediaType.TEXT_PLAIN;

@Controller("/upload")
public class CompletedUploadController {

    @Post(value = "/completed", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    public HttpResponse&lt;String&gt; uploadCompleted(CompletedFileUpload file) { // <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(file.getFilename(), "temp"); //<b class="conum">(3)</b>
            Path path = Paths.get(tempFile.getAbsolutePath());
            Files.write(path, file.getBytes()); //<b class="conum">(3)</b>
            return HttpResponse.ok("Uploaded");
        } catch (IOException e) {
            return HttpResponse.badRequest("Upload Failed");
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload

import java.nio.file.Files
import java.nio.file.Path
import java.nio.file.Paths

import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import static io.micronaut.http.MediaType.TEXT_PLAIN

@Controller("/upload")
class CompletedUploadController {

    @Post(value = "/completed", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    HttpResponse&lt;String&gt; uploadCompleted(CompletedFileUpload file) { // <b class="conum">(2)</b>
        try {
            File tempFile = File.createTempFile(file.filename, "temp") //<b class="conum">(3)</b>
            Path path = Paths.get(tempFile.absolutePath)
            Files.write(path, file.bytes) //<b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (IOException e) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">File upload with metadata</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import io.micronaut.http.MediaType.TEXT_PLAIN
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload
import java.io.File
import java.io.IOException
import java.nio.file.Files
import java.nio.file.Paths

@Controller("/upload")
class CompletedUploadController {

    @Post(value = "/completed", consumes = [MULTIPART_FORM_DATA], produces = [TEXT_PLAIN]) // <b class="conum">(1)</b>
    fun uploadCompleted(file: CompletedFileUpload): HttpResponse&lt;String&gt; { // <b class="conum">(2)</b>
        return try {
            val tempFile = File.createTempFile(file.filename, "temp") //<b class="conum">(3)</b>
            val path = Paths.get(tempFile.absolutePath)
            Files.write(path, file.bytes) //<b class="conum">(3)</b>
            HttpResponse.ok("Uploaded")
        } catch (e: IOException) {
            HttpResponse.badRequest("Upload Failed")
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The method consumes <a href="../api/io/micronaut/http/MediaType.html#MULTIPART_FORM_DATA">MULTIPART_FORM_DATA</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method parameters match form attribute names. In this case the <code>file</code> will match for example an <code>&lt;input type="file" name="file"&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>CompletedFileUpload</code> instance gives access to metadata about the upload as well as access to the file contents.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If a file will not be read, the <code>discard</code> method on the file object <strong>must</strong> be called to prevent memory leaks.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_uploads">Multiple Uploads</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_different_names">Different Names</h3>
<div class="paragraph">
<p>If a multipart request has multiple uploads that have different part names, create an argument to your route that receives each part. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpResponse upload(String title, String name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A route method signature like the above expects two different parts, one named "title" and the other "name".</p>
</div>
</div>
<div class="sect2">
<h3 id="_same_name">Same Name</h3>
<div class="paragraph">
<p>To receive multiple parts with the same part name, the argument must be a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>. When used in one of the following ways, the publisher emits one item per part found with the specified name. The publisher must accept one of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/http/multipart/StreamingFileUpload.html">StreamingFileUpload</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/http/multipart/CompletedFileUpload.html">CompletedFileUpload</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/http/multipart/CompletedPart.html">CompletedPart</a> for attributes</p>
</li>
<li>
<p>Any POJO, assuming a media codec that supports the content type exists</p>
</li>
<li>
<p>Another <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that accepts one of the chunked data types described above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpResponse upload(Publisher&lt;StreamingFileUpload&gt; files)
HttpResponse upload(Publisher&lt;CompletedFileUpload&gt; files)
HttpResponse upload(Publisher&lt;MyObject&gt; files)
HttpResponse upload(Publisher&lt;Publisher&lt;PartData&gt;&gt; files)
HttpResponse upload(Publisher&lt;CompletedPart&gt; attributes)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whole_body_binding">Whole Body Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When request part names aren&#8217;t known ahead of time, or to read the entire body, a special type can be used to indicate the entire body is desired.</p>
</div>
<div class="paragraph">
<p>If a route has an argument of type <a href="../api/io/micronaut/http/server/multipart/MultipartBody.html">MultipartBody</a> (not to be confused with the class for the client) annotated with <a href="../api/io/micronaut/http/annotation/Body.html">@Body</a>, each part of the request will be emitted through the argument. A <a href="../api/io/micronaut/http/server/multipart/MultipartBody.html">MultipartBody</a> is a publisher of <a href="../api/io/micronaut/http/multipart/CompletedPart.html">CompletedPart</a> instances.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.multipart.CompletedFileUpload;
import io.micronaut.http.multipart.CompletedPart;
import io.micronaut.http.server.multipart.MultipartBody;
import org.reactivestreams.Publisher;
import org.reactivestreams.Subscriber;
import org.reactivestreams.Subscription;
import reactor.core.publisher.Mono;
import io.micronaut.core.async.annotation.SingleResult;
import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA;
import static io.micronaut.http.MediaType.TEXT_PLAIN;

@Controller("/upload")
public class WholeBodyUploadController {

    @Post(value = "/whole-body", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    @SingleResult
    public Publisher&lt;String&gt; uploadBytes(@Body MultipartBody body) { // <b class="conum">(2)</b>

        return Mono.create(emitter -&gt; {
            body.subscribe(new Subscriber&lt;CompletedPart&gt;() {
                private Subscription s;

                @Override
                public void onSubscribe(Subscription s) {
                    this.s = s;
                    s.request(1);
                }

                @Override
                public void onNext(CompletedPart completedPart) {
                    String partName = completedPart.getName();
                    if (completedPart instanceof CompletedFileUpload) {
                        String originalFileName = ((CompletedFileUpload) completedPart).getFilename();
                    }
                }

                @Override
                public void onError(Throwable t) {
                    emitter.error(t);
                }

                @Override
                public void onComplete() {
                    emitter.success("Uploaded");
                }
            });
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.CompletedPart
import io.micronaut.http.server.multipart.MultipartBody
import org.reactivestreams.Subscriber
import org.reactivestreams.Subscription
import reactor.core.publisher.Mono

import static io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import static io.micronaut.http.MediaType.TEXT_PLAIN

@Controller("/upload")
class WholeBodyUploadController {

    @Post(value = "/whole-body", consumes = MULTIPART_FORM_DATA, produces = TEXT_PLAIN) // <b class="conum">(1)</b>
    Mono&lt;String&gt; uploadBytes(@Body MultipartBody body) { // <b class="conum">(2)</b>

        Mono.&lt;String&gt;create({ emitter -&gt;
            body.subscribe(new Subscriber&lt;CompletedPart&gt;() {
                private Subscription s

                @Override
                void onSubscribe(Subscription s) {
                    this.s = s
                    s.request(1)
                }

                @Override
                void onNext(CompletedPart completedPart) {
                    String partName = completedPart.name
                    if (completedPart instanceof CompletedFileUpload) {
                        String originalFileName = completedPart.filename
                    }
                }

                @Override
                void onError(Throwable t) {
                    emitter.error(t)
                }

                @Override
                void onComplete() {
                    emitter.success("Uploaded")
                }
            })
        })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Binding to the entire multipart body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType.MULTIPART_FORM_DATA
import io.micronaut.http.MediaType.TEXT_PLAIN
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Post
import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.CompletedPart
import io.micronaut.http.server.multipart.MultipartBody
import org.reactivestreams.Subscriber
import org.reactivestreams.Subscription
import reactor.core.publisher.Mono

@Controller("/upload")
class WholeBodyUploadController {

    @Post(value = "/whole-body", consumes = [MULTIPART_FORM_DATA], produces = [TEXT_PLAIN]) // <b class="conum">(1)</b>
    fun uploadBytes(@Body body: MultipartBody): Mono&lt;String&gt; { // <b class="conum">(2)</b>
        return Mono.create { emitter -&gt;
            body.subscribe(object : Subscriber&lt;CompletedPart&gt; {
                private var s: Subscription? = null

                override fun onSubscribe(s: Subscription) {
                    this.s = s
                    s.request(1)
                }

                override fun onNext(completedPart: CompletedPart) {
                    val partName = completedPart.name
                    if (completedPart is CompletedFileUpload) {
                        val originalFileName = completedPart.filename
                    }
                }

                override fun onError(t: Throwable) {
                    emitter.error(t)
                }

                override fun onComplete() {
                    emitter.success("Uploaded")
                }
            })
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="transfers"><a class="anchor" href="#transfers"></a>6.22 File Transfers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/transfers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports sending files to the client in a couple of easy ways.</p>
</div>
<div class="sect1">
<h2 id="_sending_file_objects">Sending File Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to return a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html">File</a> object from your controller method, and the data will be returned to the client. The <code>Content-Type</code> header of file responses is calculated based on the name of the file.</p>
</div>
<div class="paragraph">
<p>To control either the media type of the file being sent, or to set the file to be downloaded (i.e. using the <code>Content-Disposition</code> header), instead construct a <a href="../api/io/micronaut/http/server/types/files/SystemFile.html">SystemFile</a> with the file to use. For example:</p>
</div>
<div class="listingblock">
<div class="title">Sending a SystemFile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get
public SystemFile download() {
    File file = ...
    return new SystemFile(file).attach("myfile.txt");
    // or new SystemFile(file, MediaType.TEXT_HTML_TYPE)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_an_inputstream">Sending an InputStream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For cases where a reference to a <code>File</code> object is not possible (for example resources in JAR files), Micronaut supports transferring input streams. To return a stream of data from the controller method, construct a <a href="../api/io/micronaut/http/server/types/files/StreamedFile.html">StreamedFile</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The constructor for <code>StreamedFile</code> also accepts a <code>java.net.URL</code> for your convenience.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Sending a StreamedFile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get
public StreamedFile download() {
    InputStream inputStream = ...
    return new StreamedFile(inputStream, MediaType.TEXT_PLAIN_TYPE)
    // An attach(String filename) method is also available to set the Content-Disposition
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server supports returning <code>304</code> (Not Modified) responses if the files being transferred have not changed, and the request contains the appropriate header. In addition, if the client accepts encoded responses, Micronaut encodes the file if appropriate. Encoding happens if the file is text-based and larger than 1KB by default. The threshold at which data is encoded is configurable. See the server configuration reference for details.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To use a custom data source to send data through an input stream, construct a <a href="https://docs.oracle.com/javase/8/docs/api/java/io/PipedInputStream.html">PipedInputStream</a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/io/PipedOutputStream.html">PipedOutputStream</a> to write data from the output stream to the input. Make sure to do the work on a separate thread so the file can be returned immediately.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cache_configuration">Cache Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, file responses include caching headers. The following options determine how the <code>Cache-Control</code> header is built.</p>
</div>
<a id="io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration" href="#io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/types/files/FileTypeHandlerConfiguration.html">FileTypeHandlerConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netty.responses.file.cache-seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache Seconds. Default value (60).</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration.CacheControlConfiguration" href="#io.micronaut.http.server.netty.types.files.FileTypeHandlerConfiguration.CacheControlConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/types/files/FileTypeHandlerConfiguration.CacheControlConfiguration.html">CacheControlConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netty.responses.file.cache-control</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/netty/types/files/FileTypeHandlerConfiguration.CacheControlConfiguration.html">FileTypeHandlerConfiguration$CacheControlConfiguration</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the cache control configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netty.responses.file.cache-control.public</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the cache control is public. Default value (false)</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<h2 id="filters"><a class="anchor" href="#filters"></a>6.23 HTTP Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/filters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports applying filters to request/response processing in a similar (but reactive) way to Servlet filters in traditional Java applications.</p>
</div>
<div class="paragraph">
<p>Filters support the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decoration of the incoming <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a></p>
</li>
<li>
<p>Modification of the outgoing <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p>
</li>
<li>
<p>Implementation of cross-cutting concerns such as security, tracing, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a server application, the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface <code>doFilter</code> method can be implemented.</p>
</div>
<div class="paragraph">
<p>The <code>doFilter</code> method accepts the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> and an instance of <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a>.</p>
</div>
<div class="paragraph">
<p>The <code>ServerFilterChain</code> interface contains a resolved chain of filters where the final entry in the chain is the matched route. The <a href="../api/io/micronaut/http/filter/ServerFilterChain.html#proceed-io.micronaut.http.HttpRequest-">ServerFilterChain.proceed(io.micronaut.http.HttpRequest)</a> method resumes processing of the request.</p>
</div>
<div class="paragraph">
<p>The <code>proceed(..)</code> method returns a Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits the response to be returned to the client. Implementors of filters can subscribe to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and mutate the emitted <a href="../api/io/micronaut/http/MutableHttpResponse.html">MutableHttpResponse</a> to modify the response prior to returning the response to the client.</p>
</div>
<div class="paragraph">
<p>To put these concepts into practice lets look at an example.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Filters execute in the event loop, so blocking operations must be offloaded to another thread pool.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_writing_a_filter">Writing a Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose you wish to trace each request to the Micronaut "Hello World" example using some external system. This system could be a database or a distributed tracing service, and may require I/O operations.</p>
</div>
<div class="paragraph">
<p>You should not block the underlying Netty event loop in your filter; instead the filter should proceed with execution once any I/O is complete.</p>
</div>
<div class="paragraph">
<p>As an example, consider this <code>TraceService</code> that uses <a href="https://projectreactor.io">Project Reactor</a> to compose an I/O operation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using Reactive Streams</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import org.reactivestreams.Publisher;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import jakarta.inject.Singleton;
import reactor.core.publisher.Mono;
import reactor.core.scheduler.Schedulers;

@Singleton
public class TraceService {

    private static final Logger LOG = LoggerFactory.getLogger(TraceService.class);

    Publisher&lt;Boolean&gt; trace(HttpRequest&lt;?&gt; request) {
        return Mono.fromCallable(() -&gt; { // <b class="conum">(1)</b>
            LOG.debug("Tracing request: {}", request.getUri());
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            return true;
        }).subscribeOn(Schedulers.boundedElastic()) // <b class="conum">(3)</b>
                .flux();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using Reactive Streams</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import org.slf4j.Logger
import org.slf4j.LoggerFactory

import jakarta.inject.Singleton
import reactor.core.publisher.Flux
import reactor.core.publisher.Mono
import reactor.core.scheduler.Schedulers

import java.util.concurrent.Callable


@Singleton
class TraceService {

    private static final Logger LOG = LoggerFactory.getLogger(TraceService.class)

    Flux&lt;Boolean&gt; trace(HttpRequest&lt;?&gt; request) {
        Mono.fromCallable(() -&gt;  {  // <b class="conum">(1)</b>
            LOG.debug('Tracing request: {}', request.uri)
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            return true
        }).flux().subscribeOn(Schedulers.boundedElastic()) // <b class="conum">(3)</b>

    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">A TraceService Example using Reactive Streams</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpRequest
import org.slf4j.LoggerFactory
import jakarta.inject.Singleton
import reactor.core.publisher.Flux
import reactor.core.publisher.Mono
import reactor.core.scheduler.Schedulers


@Singleton
class TraceService {

    private val LOG = LoggerFactory.getLogger(TraceService::class.java)

    internal fun trace(request: HttpRequest&lt;*&gt;): Flux&lt;Boolean&gt; {
        return Mono.fromCallable {
            // <b class="conum">(1)</b>
            LOG.debug("Tracing request: {}", request.uri)
            // trace logic here, potentially performing I/O <b class="conum">(2)</b>
            true
        }.subscribeOn(Schedulers.boundedElastic()) // <b class="conum">(3)</b>
            .flux()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> type creates logic that executes potentially blocking operations to write the trace data from the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since this is just an example, the logic does nothing yet</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>Schedulers.boundedElastic</code> executes the logic</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then inject this implementation into your filter definition:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.http.MutableHttpResponse;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.filter.HttpServerFilter;
import io.micronaut.http.filter.ServerFilterChain;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;

@Filter("/hello/**") // <b class="conum">(1)</b>
public class TraceFilter implements HttpServerFilter { // <b class="conum">(2)</b>

    private final TraceService traceService;

    public TraceFilter(TraceService traceService) { // <b class="conum">(3)</b>
        this.traceService = traceService;
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher

@Filter("/hello/**") // <b class="conum">(1)</b>
class TraceFilter implements HttpServerFilter { // <b class="conum">(2)</b>

    private final TraceService traceService

    TraceFilter(TraceService traceService) { // <b class="conum">(3)</b>
        this.traceService = traceService
    }

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">An Example HttpServerFilter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher

@Filter("/hello/**") // <b class="conum">(1)</b>
class TraceFilter(// <b class="conum">(2)</b>
    private val traceService: TraceService)// <b class="conum">(3)</b>
    : HttpServerFilter {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/annotation/Filter.html">Filter</a> annotation defines the URI pattern(s) the filter matches</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The class implements the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The previously defined <code>TraceService</code> is injected via constructor</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The final step is to write the <code>doFilter</code> implementation of the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request,
                                                  ServerFilterChain chain) {
    return Flux.from(traceService
            .trace(request)) // <b class="conum">(1)</b>
            .switchMap(aBoolean -&gt; chain.proceed(request)) // <b class="conum">(2)</b>
            .doOnNext(res -&gt;
                res.getHeaders().add("X-Trace-Enabled", "true") // <b class="conum">(3)</b>
            );
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Override
Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request,
                                           ServerFilterChain chain) {
    traceService
            .trace(request) // <b class="conum">(1)</b>
            .switchMap({ aBoolean -&gt; chain.proceed(request) }) // <b class="conum">(2)</b>
            .doOnNext({ res -&gt;
                res.headers.add("X-Trace-Enabled", "true") // <b class="conum">(3)</b>
            })
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">The doFilter implementation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">override fun doFilter(request: HttpRequest&lt;*&gt;,
                      chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
    return traceService.trace(request) // <b class="conum">(1)</b>
        .switchMap { aBoolean -&gt; chain.proceed(request) } // <b class="conum">(2)</b>
        .doOnNext { res -&gt;
            res.headers.add("X-Trace-Enabled", "true") // <b class="conum">(3)</b>
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>TraceService</code> is invoked to trace the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the call succeeds, the filter resumes request processing using <a href="https://projectreactor.io">Project Reactor</a>'s <code>switchMap</code> method, which invokes the <code>proceed</code> method of the <a href="../api/io/micronaut/http/filter/ServerFilterChain.html">ServerFilterChain</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Finally, the <a href="https://projectreactor.io">Project Reactor</a>'s <code>doOnNext</code> method adds a <code>X-Trace-Enabled</code> header to the response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous example demonstrates some key concepts such as executing logic in a non-blocking manner before proceeding with the request and modifying the outgoing response.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The examples use <a href="https://projectreactor.io">Project Reactor</a>, however you can use any reactive framework that supports the Reactive streams specifications
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Filter.html">Filter</a> can use different styles of pattern for path matching by setting <code>patternStyle</code>. By default, it uses <a href="../api/io/micronaut/core/util/AntPathMatcher.html">AntPathMatcher</a> for path matching. When using Ant, the mapping matches URLs using the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>? matches one character</p>
</li>
<li>
<p>* matches zero or more characters</p>
</li>
<li>
<p>** matches zero or more subdirectories in a path</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. @Filter Annotation Path Matching Examples</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pattern</th>
<th class="tableblock halign-left valign-top">Example Matched Paths</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>customer/j?y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">customer/joy, customer/jay</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>customer/*/id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">customer/adam/id, com/amy/id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>customer/**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">customer/adam, customer/adam/id, customer/adam/name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>customer/<strong>*/</strong>.html</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">customer/index.html, customer/adam/profile.html, customer/adam/job/description.html</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The other option is regular expression based matching. To use regular expressions, set <code>patternStyle = FilterPatternStyle.REGEX</code>. The <code>pattern</code> attribute is expected to contain a regular expression which will be expected to match the provided URLs exactly (using <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#matches--">Matcher#matches</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>FilterPatternStyle.ANT</code> is preferred as the pattern matching is more performant than using regular expressions. <code>FilterPatternStyle.REGEX</code> should be used when your pattern cannot be written properly using Ant.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_states">Error States</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The publisher returned from <code>chain.proceed</code> should never emit an error. In the cases where an upstream filter emitted an error or the route itself threw an exception, the error response should be emitted instead of the exception. In some cases it may be desirable to know the cause of the error response and for this purpose an attribute exists on the response if it was created as a result of an exception being emitted or thrown. The original cause is stored as the attribute <a href="../api/io/micronaut/http/HttpAttributes.html#EXCEPTION">EXCEPTION</a>.</p>
</div>
</div>
</div>

<h2 id="sessions"><a class="anchor" href="#sessions"></a>6.24 HTTP Sessions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/sessions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default Micronaut is a stateless HTTP server, however depending on your application requirements you may need the notion of HTTP sessions.</p>
</div>
<div class="paragraph">
<p>Micronaut includes a <code>session</code> module inspired by <a href="https://projects.spring.io/spring-session/">Spring Session</a> that enables this which currently has two implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In-Memory sessions - which you should combine with an a sticky session proxy if you plan to run multiple instances.</p>
</li>
<li>
<p>Redis sessions - In this case <a href="https://redis.io">Redis</a> stores sessions, and non-blocking I/O is used to read/write sessions to Redis.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_enabling_sessions">Enabling Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable support for in-memory sessions you just need the <code>session</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-session")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-session&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="sect2">
<h3 id="_redis_sessions">Redis Sessions</h3>
<div class="paragraph">
<p>To store <a href="../api/io/micronaut/session/Session.html">Session</a> instances in Redis, use the <a href="https://micronaut-projects.github.io/micronaut-redis/latest/guide/#sessions">Micronaut Redis</a> module which includes detailed instructions.</p>
</div>
<div class="paragraph">
<p>To quickly get up and running with Redis sessions you must also have the <code>redis-lettuce</code> dependency in your build:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut:micronaut-session"
compile "io.micronaut.redis:micronaut-redis-lettuce"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And enable Redis sessions via configuration in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Enabling Redis Sessions</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">redis.uri=redis://localhost:6379
micronaut.session.http.redis.enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">redis:
  uri: redis://localhost:6379
micronaut:
  session:
    http:
      redis:
        enabled: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[redis]
  uri="redis://localhost:6379"
[micronaut]
  [micronaut.session]
    [micronaut.session.http]
      [micronaut.session.http.redis]
        enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">redis {
  uri = "redis://localhost:6379"
}
micronaut {
  session {
    http {
      redis {
        enabled = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  redis {
    uri = "redis://localhost:6379"
  }
  micronaut {
    session {
      http {
        redis {
          enabled = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "redis": {
    "uri": "redis://localhost:6379"
  },
  "micronaut": {
    "session": {
      "http": {
        "redis": {
          "enabled": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_session_resolution">Configuring Session Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="../api/io/micronaut/session/Session.html">Session</a> resolution can be configured with <a href="../api/io/micronaut/session/http/HttpSessionConfiguration.html">HttpSessionConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>By default, sessions are resolved using an <a href="../api/io/micronaut/session/http/HttpSessionFilter.html">HttpSessionFilter</a> that looks for session identifiers via either an HTTP header (using the <code>Authorization-Info</code> or <code>X-Auth-Token</code> headers) or via a Cookie named <code>SESSION</code>.</p>
</div>
<div class="paragraph">
<p>You can disable either header resolution or cookie resolution via configuration in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Disabling Cookie Resolution</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.session.http.cookie=false
micronaut.session.http.header=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  session:
    http:
      cookie: false
      header: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.session]
    [micronaut.session.http]
      cookie=false
      header=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  session {
    http {
      cookie = false
      header = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    session {
      http {
        cookie = false
        header = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "session": {
      "http": {
        "cookie": false,
        "header": true
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above configuration enables header resolution, but disables cookie resolution. You can also configure header and cookie names.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_sessions">Working with Sessions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <a href="../api/io/micronaut/session/Session.html">Session</a> can be retrieved with a parameter of type <a href="../api/io/micronaut/session/Session.html">Session</a> in a controller method. For example consider the following controller:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.session.Session;
import io.micronaut.session.annotation.SessionValue;
import io.micronaut.core.annotation.Nullable;

import javax.validation.constraints.NotBlank;

@Controller("/shopping")
public class ShoppingController {
    private static final String ATTR_CART = "cart"; // <b class="conum">(1)</b>

@Post("/cart/{name}")
Cart addItem(Session session, @NotBlank String name) { // <b class="conum">(2)</b>
    Cart cart = session.get(ATTR_CART, Cart.class).orElseGet(() -&gt; { // <b class="conum">(3)</b>
        Cart newCart = new Cart();
        session.put(ATTR_CART, newCart); // <b class="conum">(4)</b>
        return newCart;
    });
    cart.getItems().add(name);
    return cart;
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.session.Session
import io.micronaut.session.annotation.SessionValue

import javax.annotation.Nullable
import javax.validation.constraints.NotBlank

@Controller("/shopping")
class ShoppingController {
    private static final String ATTR_CART = "cart" // <b class="conum">(1)</b>

@Post("/cart/{name}")
Cart addItem(Session session, @NotBlank String name) { // <b class="conum">(2)</b>
    Cart cart = session.get(ATTR_CART, Cart).orElseGet({ -&gt; // <b class="conum">(3)</b>
        Cart newCart = new Cart()
        session.put(ATTR_CART, newCart) // <b class="conum">(4)</b>
        newCart
    })
    cart.items &lt;&lt; name
    cart
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.session.Session
import io.micronaut.session.annotation.SessionValue

@Controller("/shopping")
class ShoppingController {

    companion object {
        private const val ATTR_CART = "cart" // <b class="conum">(1)</b>
    }

@Post("/cart/{name}")
internal fun addItem(session: Session, name: String): Cart { // <b class="conum">(2)</b>
    require(name.isNotBlank()) { "Name cannot be blank" }
    val cart = session.get(ATTR_CART, Cart::class.java).orElseGet { // <b class="conum">(3)</b>
        val newCart = Cart()
        session.put(ATTR_CART, newCart) // <b class="conum">(4)</b>
        newCart
    }
    cart.items.add(name)
    return cart
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>ShoppingController</code> declares a <a href="../api/io/micronaut/session/Session.html">Session</a> attribute named <code>cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a method parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>cart</code> attribute is retrieved</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Otherwise a new <code>Cart</code> instance is created and stored in the session</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that because the <a href="../api/io/micronaut/session/Session.html">Session</a> is declared as a required parameter, to execute the controller action a <a href="../api/io/micronaut/session/Session.html">Session</a> will be created and saved to the <a href="../api/io/micronaut/session/SessionStore.html">SessionStore</a>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t want to create unnecessary sessions, declare the <a href="../api/io/micronaut/session/Session.html">Session</a> as <code>@Nullable</code> in which case a session will not be created and saved unnecessarily. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post("/cart/clear")
void clearCart(@Nullable Session session) {
    if (session != null) {
        session.remove(ATTR_CART);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Post("/cart/clear")
void clearCart(@Nullable Session session) {
    session?.remove(ATTR_CART)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @Nullable with Sessions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Post("/cart/clear")
internal fun clearCart(session: Session?) {
    session?.remove(ATTR_CART)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method only injects a new <a href="../api/io/micronaut/session/Session.html">Session</a> if one already exists.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_clients">Session Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the client is a web browser, sessions should work if cookies are enabled. However, for programmatic HTTP clients you need to propagate the session ID between HTTP calls.</p>
</div>
<div class="paragraph">
<p>For example, when invoking the <code>viewCart</code> method of the <code>StoreController</code> in the previous example, the HTTP client receives by default a <code>AUTHORIZATION_INFO</code> header. The following example, using a Spock test, demonstrates this:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Retrieving the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpResponse&lt;Cart&gt; response = Flux.from(client.exchange(HttpRequest.GET("/shopping/cart"), Cart.class)) // <b class="conum">(1)</b>
                                    .blockFirst();
Cart cart = response.body();

assertNotNull(response.header(HttpHeaders.AUTHORIZATION_INFO)); // <b class="conum">(2)</b>
assertNotNull(cart);
assertTrue(cart.getItems().isEmpty());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Retrieving the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when: "The shopping cart is retrieved"
HttpResponse&lt;Cart&gt; response = client.exchange(HttpRequest.GET('/shopping/cart'), Cart) // <b class="conum">(1)</b>
                                        .blockFirst()
Cart cart = response.body()

then: "The shopping cart is present as well as a session id header"
response.header(HttpHeaders.AUTHORIZATION_INFO) != null // <b class="conum">(2)</b>
cart != null
cart.items.isEmpty()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Retrieving the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">var response = Flux.from(client.exchange(HttpRequest.GET&lt;Cart&gt;("/shopping/cart"), Cart::class.java)) // <b class="conum">(1)</b>
                     .blockFirst()
var cart = response.body()

assertNotNull(response.header(HttpHeaders.AUTHORIZATION_INFO)) // <b class="conum">(2)</b>
assertNotNull(cart)
cart.items.isEmpty()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A request is made to <code>/shopping/cart</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>AUTHORIZATION_INFO</code> header is present in the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then pass this <code>AUTHORIZATION_INFO</code> in subsequent requests to reuse the existing <a href="../api/io/micronaut/session/Session.html">Session</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO); // <b class="conum">(1)</b>

response = Flux.from(client.exchange(HttpRequest.POST("/shopping/cart/Apple", "")
                 .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart.class)) // <b class="conum">(2)</b>
                 .blockFirst();
cart = response.body();</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">String sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO) // <b class="conum">(1)</b>

response = client.exchange(HttpRequest.POST('/shopping/cart/Apple', "")
                 .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart) // <b class="conum">(2)</b>
                 .blockFirst()
cart = response.body()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending the AUTHORIZATION_INFO header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val sessionId = response.header(HttpHeaders.AUTHORIZATION_INFO) // <b class="conum">(1)</b>

response = Flux.from(client.exchange(HttpRequest.POST("/shopping/cart/Apple", "")
                 .header(HttpHeaders.AUTHORIZATION_INFO, sessionId), Cart::class.java)) // <b class="conum">(2)</b>
                 .blockFirst()
cart = response.body()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>AUTHORIZATION_INFO</code> is retrieved from the response</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And then sent as a header in the subsequent request</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_sessionvalue">Using @SessionValue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rather than explicitly injecting the <a href="../api/io/micronaut/session/Session.html">Session</a> into a controller method, you can instead use <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/cart")
@SessionValue(ATTR_CART) // <b class="conum">(1)</b>
Cart viewCart(@SessionValue @Nullable Cart cart) { // <b class="conum">(2)</b>
    if (cart == null) {
        cart = new Cart();
    }
    return cart;
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/cart")
@SessionValue("cart") // <b class="conum">(1)</b>
Cart viewCart(@SessionValue @Nullable Cart cart) { // <b class="conum">(2)</b>
    cart ?: new Cart()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using @SessionValue</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/cart")
@SessionValue(ATTR_CART) // <b class="conum">(1)</b>
internal fun viewCart(@SessionValue cart: Cart?): Cart { // <b class="conum">(2)</b>
    return cart ?: Cart()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is declared on the method resulting in the return value being stored in the <a href="../api/io/micronaut/session/Session.html">Session</a>. Note that you must specify the attribute name when used on a return value</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> is used on a <code>@Nullable</code> parameter which results in looking up the value from the <a href="../api/io/micronaut/session/Session.html">Session</a> in a non-blocking way and supplying it if present. In the case a value is not specified to <a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a> resulting in the parameter name being used to lookup the attribute.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_events">Session Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> beans to listen for <a href="../api/io/micronaut/session/Session.html">Session</a> related events located in the <a href="../api/io/micronaut/session/event/package-summary.html">io.micronaut.session.event</a> package.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the events:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Session Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionCreatedEvent.html">SessionCreatedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is created</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDeletedEvent.html">SessionDeletedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> is deleted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionExpiredEvent.html">SessionExpiredEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fired when a <a href="../api/io/micronaut/session/Session.html">Session</a> expires</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/event/SessionDestroyedEvent.html">SessionDestroyedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parent of both <code>SessionDeletedEvent</code> and <code>SessionExpiredEvent</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>

<h2 id="sse"><a class="anchor" href="#sse"></a>6.25 Server Sent Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/sse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server supports emitting <a href="https://en.wikipedia.org/wiki/Server-sent_events">Server Sent Events (SSE)</a> using the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> API.</p>
</div>
<div class="paragraph">
<p>To emit events from the server, return a Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> itself could publish events from a background task, via an event system, etc.</p>
</div>
<div class="paragraph">
<p>Imagine for an example a event stream of news headlines; you may define a data class as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Headline {

    private String title;
    private String description;

    public Headline() {}

    public Headline(String title, String description) {
        this.title = title;
        this.description = description;
    }

    public String getTitle() {
        return title;
    }

    public String getDescription() {
        return description;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public void setDescription(String description) {
        this.description = description;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class Headline {

    String title
    String description

    Headline() {}

    Headline(String title, String description) {
        this.title = title;
        this.description = description;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Headline</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class Headline {

    var title: String? = null
    var description: String? = null

    constructor()

    constructor(title: String, description: String) {
        this.title = title
        this.description = description
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To emit news headline events, write a controller that returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a> instances using whichever Reactive library you prefer. The example below uses <a href="https://projectreactor.io">Project Reactor</a>'s <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> via the <code>generate</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.sse.Event;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;

@Controller("/headlines")
public class HeadlineController {

    @ExecuteOn(TaskExecutors.IO)
    @Get(produces = MediaType.TEXT_EVENT_STREAM)
    public Publisher&lt;Event&lt;Headline&gt;&gt; index() { // <b class="conum">(1)</b>
        String[] versions = {"1.0", "2.0"}; // <b class="conum">(2)</b>
        return Flux.generate(() -&gt; 0, (i, emitter) -&gt; { // <b class="conum">(3)</b>
            if (i &lt; versions.length) {
                emitter.next( // <b class="conum">(4)</b>
                    Event.of(new Headline("Micronaut " + versions[i] + " Released", "Come and get it"))
                );
            } else {
                emitter.complete(); // <b class="conum">(5)</b>
            }
            return ++i;
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.sse.Event
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux

@Controller("/headlines")
class HeadlineController {

    @ExecuteOn(TaskExecutors.IO)
    @Get(produces = MediaType.TEXT_EVENT_STREAM)
    Publisher&lt;Event&lt;Headline&gt;&gt; index() { // <b class="conum">(1)</b>
        String[] versions = ["1.0", "2.0"] // <b class="conum">(2)</b>
        Flux.generate(() -&gt; 0, (i, emitter) -&gt; {
            if (i &lt; versions.length) {
                emitter.next( // <b class="conum">(4)</b>
                        Event.of(new Headline("Micronaut ${versions[i]} Released", "Come and get it"))
                )
            } else {
                emitter.complete() // <b class="conum">(5)</b>
            }
            return i + 1
        })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Publishing Server Sent Events from a Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.sse.Event
import io.micronaut.scheduling.TaskExecutors
import io.micronaut.scheduling.annotation.ExecuteOn
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux
import reactor.core.publisher.SynchronousSink
import java.util.concurrent.Callable
import java.util.function.BiFunction


@Controller("/headlines")
class HeadlineController {

    @ExecuteOn(TaskExecutors.IO)
    @Get(produces = [MediaType.TEXT_EVENT_STREAM])
    fun index(): Publisher&lt;Event&lt;Headline&gt;&gt; { // <b class="conum">(1)</b>
        val versions = arrayOf("1.0", "2.0") // <b class="conum">(2)</b>
        return Flux.generate(
            { 0 },
            BiFunction { i: Int, emitter: SynchronousSink&lt;Event&lt;Headline&gt;&gt; -&gt;  // <b class="conum">(3)</b>
                if (i &lt; versions.size) {
                    emitter.next( // <b class="conum">(4)</b>
                        Event.of(
                            Headline(
                                "Micronaut " + versions[i] + " Released", "Come and get it"
                            )
                        )
                    )
                } else {
                    emitter.complete() // <b class="conum">(5)</b>
                }
                return@BiFunction i + 1
            })
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller method returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> of <a href="../api/io/micronaut/http/sse/Event.html">Event</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A headline is emitted for each version of Micronaut</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> type&#8217;s <code>generate</code> method generates a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>. The <code>generate</code> method accepts an initial value and a lambda that accepts the value and a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a>. Note that this example executes on the same thread as the controller action, but you could use <code>subscribeOn</code> or map an existing "hot" <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface <code>onNext</code> method emits objects of type <a href="../api/io/micronaut/http/sse/Event.html">Event</a>. The <a href="../api/io/micronaut/http/sse/Event.html#of-ET-">Event.of(ET)</a> factory method constructs the event.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Emitter.html">Emitter</a> interface <code>onComplete</code> method indicates when to finish sending server sent events.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You typically want to schedule SSE event streams on a separate executor. The previous example uses <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> to execute the stream on the I/O executor.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example sends back a response of type <code>text/event-stream</code> and for each <a href="../api/io/micronaut/http/sse/Event.html">Event</a> emitted the <code>Headline</code> type previously will be converted to JSON resulting in responses such as:</p>
</div>
<div class="listingblock">
<div class="title">Server Sent Event Response Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"> data: {"title":"Micronaut 1.0 Released","description":"Come and get it"}
 data: {"title":"Micronaut 2.0 Released","description":"Come and get it"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the methods of the <a href="../api/io/micronaut/http/sse/Event.html">Event</a> interface to customize the Server Sent Event data sent back, including associating event ids, comments, retry timeouts, etc.</p>
</div>

<h2 id="websocket"><a class="anchor" href="#websocket"></a>6.26 WebSocket Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/websocket.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features dedicated support for creating WebSocket clients and servers. The <a href="../api/io/micronaut/websocket/annotation/package-summary.html">io.micronaut.websocket.annotation</a> package includes annotations for defining both clients and servers.</p>
</div>

<h2 id="websocketServer"><a class="anchor" href="#websocketServer"></a>6.26.1 Using @ServerWebSocket</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/websocket/websocketServer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">@ServerWebSocket</a> annotation can be applied to any class that should map to a WebSocket URI. The following example is a simple chat WebSocket implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.websocket.WebSocketBroadcaster;
import io.micronaut.websocket.WebSocketSession;
import io.micronaut.websocket.annotation.OnClose;
import io.micronaut.websocket.annotation.OnMessage;
import io.micronaut.websocket.annotation.OnOpen;
import io.micronaut.websocket.annotation.ServerWebSocket;

import java.util.function.Predicate;

@ServerWebSocket("/chat/{topic}/{username}") // <b class="conum">(1)</b>
public class ChatServerWebSocket {

    private final WebSocketBroadcaster broadcaster;

    public ChatServerWebSocket(WebSocketBroadcaster broadcaster) {
        this.broadcaster = broadcaster;
    }

    @OnOpen // <b class="conum">(2)</b>
    public void onOpen(String topic, String username, WebSocketSession session) {
        String msg = "[" + username + "] Joined!";
        broadcaster.broadcastSync(msg, isValid(topic, session));
    }

    @OnMessage // <b class="conum">(3)</b>
    public void onMessage(String topic, String username,
                          String message, WebSocketSession session) {
        String msg = "[" + username + "] " + message;
        broadcaster.broadcastSync(msg, isValid(topic, session)); // <b class="conum">(4)</b>
    }

    @OnClose // <b class="conum">(5)</b>
    public void onClose(String topic, String username, WebSocketSession session) {
        String msg = "[" + username + "] Disconnected!";
        broadcaster.broadcastSync(msg, isValid(topic, session));
    }

    private Predicate&lt;WebSocketSession&gt; isValid(String topic, WebSocketSession session) {
        return s -&gt; s != session &amp;&amp;
                topic.equalsIgnoreCase(s.getUriVariables().get("topic", String.class, null));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.websocket.WebSocketBroadcaster
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.OnClose
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.micronaut.websocket.annotation.ServerWebSocket

import java.util.function.Predicate

@ServerWebSocket("/chat/{topic}/{username}") // <b class="conum">(1)</b>
class ChatServerWebSocket {

    private final WebSocketBroadcaster broadcaster

    ChatServerWebSocket(WebSocketBroadcaster broadcaster) {
        this.broadcaster = broadcaster
    }

    @OnOpen // <b class="conum">(2)</b>
    void onOpen(String topic, String username, WebSocketSession session) {
        String msg = "[$username] Joined!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    @OnMessage // <b class="conum">(3)</b>
    void onMessage(String topic, String username,
                   String message, WebSocketSession session) {
        String msg = "[$username] $message"
        broadcaster.broadcastSync(msg, isValid(topic, session)) // <b class="conum">(4)</b>
    }

    @OnClose // <b class="conum">(5)</b>
    void onClose(String topic, String username, WebSocketSession session) {
        String msg = "[$username] Disconnected!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    private Predicate&lt;WebSocketSession&gt; isValid(String topic, WebSocketSession session) {
        return { s -&gt; s != session &amp;&amp; topic.equalsIgnoreCase(s.uriVariables.get("topic", String, null)) }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.websocket.WebSocketBroadcaster
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.OnClose
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import io.micronaut.websocket.annotation.ServerWebSocket

import java.util.function.Predicate

@ServerWebSocket("/chat/{topic}/{username}") // <b class="conum">(1)</b>
class ChatServerWebSocket(private val broadcaster: WebSocketBroadcaster) {

    @OnOpen // <b class="conum">(2)</b>
    fun onOpen(topic: String, username: String, session: WebSocketSession) {
        val msg = "[$username] Joined!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    @OnMessage // <b class="conum">(3)</b>
    fun onMessage(topic: String, username: String,
                  message: String, session: WebSocketSession) {
        val msg = "[$username] $message"
        broadcaster.broadcastSync(msg, isValid(topic, session)) // <b class="conum">(4)</b>
    }

    @OnClose // <b class="conum">(5)</b>
    fun onClose(topic: String, username: String, session: WebSocketSession) {
        val msg = "[$username] Disconnected!"
        broadcaster.broadcastSync(msg, isValid(topic, session))
    }

    private fun isValid(topic: String, session: WebSocketSession): Predicate&lt;WebSocketSession&gt; {
        return Predicate&lt;WebSocketSession&gt; {
            (it !== session &amp;&amp; topic.equals(it.uriVariables.get("topic", String::class.java, null), ignoreCase = true))
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">@ServerWebSocket</a> annotation defines the path the WebSocket is mapped under. The URI can be a URI template.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnOpen.html">@OnOpen</a> annotation declares the method to invoke when the WebSocket is opened.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a> annotation declares the method to invoke when a message is received.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can use a <a href="../api/io/micronaut/websocket/WebSocketBroadcaster.html">WebSocketBroadcaster</a> to broadcast messages to every WebSocket session. You can filter which sessions to send to with a <code>Predicate</code>. Also, you could use the <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> instance to send a message to it with <code>WebSocketSession::send</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="../api/io/micronaut/websocket/annotation/OnClose.html">@OnClose</a> annotation declares the method to invoke when the WebSocket is closed.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A working example of WebSockets in action can be found at <a href="https://guides.micronaut.io/latest/micronaut-websocket.html">Micronaut Guides</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For binding, method arguments to each WebSocket method can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A variable from the URI template (in the above example <code>topic</code> and <code>username</code> are URI template variables)</p>
</li>
<li>
<p>An instance of <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_the_onclose_method">The @OnClose Method</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/OnClose.html">@OnClose</a> method can optionally receive a <a href="../api/io/micronaut/websocket/CloseReason.html">CloseReason</a>. The <code>@OnClose</code> method is invoked prior to the session closing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_onmessage_method">The @OnMessage Method</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a> method can define a parameter for the message body. The parameter can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Netty <code>WebSocketFrame</code></p>
</li>
<li>
<p>Any Java primitive or simple type (such as <code>String</code>). In fact, any type that can be converted from <code>ByteBuf</code> (you can register additional <a href="../api/io/micronaut/core/convert/TypeConverter.html">TypeConverter</a> beans to support a custom type).</p>
</li>
<li>
<p>A <code>byte[]</code>, a <code>ByteBuf</code> or a Java NIO <code>ByteBuffer</code>.</p>
</li>
<li>
<p>A POJO. In this case, it will be decoded by default as JSON using <a href="../api/io/micronaut/jackson/codec/JsonMediaTypeCodec.html">JsonMediaTypeCodec</a>. You can register a custom codec and define the content type of the handler using the <a href="../api/io/micronaut/http/annotation/Consumes.html">@Consumes</a> annotation.</p>
</li>
<li>
<p>A <a href="../api/io/micronaut/websocket/WebSocketPongMessage.html">WebSocketPongMessage</a>. This is a special case: The method will not receive regular messages, but instead handle WebSocket pongs that arrive as a reply to a ping sent to the client.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_onerror_method">The @OnError Method</h3>
<div class="paragraph">
<p>A method annotated with <a href="../api/io/micronaut/websocket/annotation/OnError.html">@OnError</a> can be added to implement custom error handling. The <code>@OnError</code> method can define a parameter that receives the exception type to be handled. If no <code>@OnError</code> handling is present and an unrecoverable exception occurs, the WebSocket is automatically closed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_blocking_message_handling">Non-Blocking Message Handling</h3>
<div class="paragraph">
<p>The previous example uses the <code>broadcastSync</code> method of the <a href="../api/io/micronaut/websocket/WebSocketBroadcaster.html">WebSocketBroadcaster</a> interface which blocks until the broadcast is complete. A similar <code>sendSync</code> method exists in <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> to send a message to a single receiver in a blocking manner. You can however implement non-blocking WebSocket servers by instead returning a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> or a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html">Future</a> from each WebSocket handler method. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@OnMessage
public Publisher&lt;Message&gt; onMessage(String topic, String username,
                                    Message message, WebSocketSession session) {
    String text = "[" + username + "] " + message.getText();
    Message newMessage = new Message(text);
    return broadcaster.broadcast(newMessage, isValid(topic, session));
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@OnMessage
Publisher&lt;Message&gt; onMessage(String topic, String username,
                             Message message, WebSocketSession session) {
    String text = "[$username] $message.text"
    Message newMessage = new Message(text)
    broadcaster.broadcast(newMessage, isValid(topic, session))
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@OnMessage
fun onMessage(topic: String, username: String,
              message: Message, session: WebSocketSession): Publisher&lt;Message&gt; {
    val text = "[" + username + "] " + message.text
    val newMessage = Message(text)
    return broadcaster.broadcast(newMessage, isValid(topic, session))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above uses <code>broadcast</code>, which creates an instance of <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> and returns the value to Micronaut. Micronaut sends the message asynchronously based on the Publisher interface. The similar <code>send</code> method sends a single message asynchronously via Micronaut return value.</p>
</div>
<div class="paragraph">
<p>For sending messages asynchronously outside Micronaut annotated handler methods, you can use <code>broadcastAsync</code> and <code>sendAsync</code> methods in their respective <a href="../api/io/micronaut/websocket/WebSocketBroadcaster.html">WebSocketBroadcaster</a> and <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> interfaces. For blocking sends, the <code>broadcastSync</code> and <code>sendSync</code> methods can be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serverwebsocket_and_scopes">@ServerWebSocket and Scopes</h3>
<div class="paragraph">
<p>By default, the <code>@ServerWebSocket</code> instance is shared for all WebSocket connections. Extra care must be taken to synchronize local state to avoid thread safety issues.</p>
</div>
<div class="paragraph">
<p>If you prefer to have an instance for each connection, annotate the class with <a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a>. This lets you retrieve the <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> from the <code>@OnOpen</code> handler and assign it to a field of the <code>@ServerWebSocket</code> instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sharing_sessions_with_the_http_session">Sharing Sessions with the HTTP Session</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/WebSocketSession.html">WebSocketSession</a> is by default backed by an in-memory map. If you add the <code>session</code> module you can however share <a href="#sessions">sessions</a> between the HTTP server and the WebSocket server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When sessions are backed by a persistent store such as Redis, after each message is processed the session is updated to the backing store.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you created your project using Application Type <code>Micronaut Application</code>, you can use the <code>create-websocket-server</code> command with the Micronaut CLI to create a class annotated with <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">ServerWebSocket</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-websocket-server MyChat
| Rendered template WebsocketServer.java to destination src/main/java/example/MyChatServer.java</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_connection_timeouts">Connection Timeouts</h3>
<div class="paragraph">
<p>By default, Micronaut times out idle connections with no activity after five minutes. Normally this is not a problem as browsers automatically reconnect WebSocket sessions, however you can control this behaviour by setting the <code>micronaut.server.idle-timeout</code> setting (a negative value results in no timeout):</p>
</div>
<div class="openblock">
<div class="title">Setting the Connection Timeout for the Server</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.idle-timeout=30m</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    idle-timeout: 30m</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    idle-timeout="30m"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    idleTimeout = "30m"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      idle-timeout = "30m"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "idle-timeout": "30m"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you use Micronaut&#8217;s WebSocket client you may also wish to set the timeout on the client:</p>
</div>
<div class="openblock">
<div class="title">Setting the Connection Timeout for the Client</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.read-idle-timeout=30m</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      read-idle-timeout: 30m</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      read-idle-timeout="30m"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      readIdleTimeout = "30m"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        read-idle-timeout = "30m"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "read-idle-timeout": "30m"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>

<h2 id="websocketClient"><a class="anchor" href="#websocketClient"></a>6.26.2 Using @ClientWebSocket</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/websocket/websocketClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a> annotation can be used with the <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> interface to define WebSocket clients.</p>
</div>
<div class="paragraph">
<p>You can inject a reference to a <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> using the <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Client("http://localhost:8080")
WebSocketClient webSocketClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This lets you use the same service discovery and load balancing features for WebSocket clients.</p>
</div>
<div class="paragraph">
<p>Once you have a reference to the <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> interface you can use the <code>connect</code> method to obtain a connected instance of a bean annotated with <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a>.</p>
</div>
<div class="paragraph">
<p>For example consider the following implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpRequest;
import io.micronaut.websocket.WebSocketSession;
import io.micronaut.websocket.annotation.ClientWebSocket;
import io.micronaut.websocket.annotation.OnMessage;
import io.micronaut.websocket.annotation.OnOpen;
import org.reactivestreams.Publisher;
import io.micronaut.core.async.annotation.SingleResult;
import java.util.Collection;
import java.util.concurrent.ConcurrentLinkedQueue;
import java.util.concurrent.Future;

@ClientWebSocket("/chat/{topic}/{username}") // <b class="conum">(1)</b>
public abstract class ChatClientWebSocket implements AutoCloseable { // <b class="conum">(2)</b>

    private WebSocketSession session;
    private HttpRequest request;
    private String topic;
    private String username;
    private Collection&lt;String&gt; replies = new ConcurrentLinkedQueue&lt;&gt;();

    @OnOpen
    public void onOpen(String topic, String username,
                       WebSocketSession session, HttpRequest request) { // <b class="conum">(3)</b>
        this.topic = topic;
        this.username = username;
        this.session = session;
        this.request = request;
    }

    public String getTopic() {
        return topic;
    }

    public String getUsername() {
        return username;
    }

    public Collection&lt;String&gt; getReplies() {
        return replies;
    }

    public WebSocketSession getSession() {
        return session;
    }

    public HttpRequest getRequest() {
        return request;
    }

    @OnMessage
    public void onMessage(String message) {
        replies.add(message); // <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpRequest
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.ClientWebSocket
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono
import java.util.concurrent.ConcurrentLinkedQueue
import java.util.concurrent.Future
import io.micronaut.core.async.annotation.SingleResult

@ClientWebSocket("/chat/{topic}/{username}") // <b class="conum">(1)</b>
abstract class ChatClientWebSocket implements AutoCloseable { // <b class="conum">(2)</b>

    private WebSocketSession session
    private HttpRequest request
    private String topic
    private String username
    private Collection&lt;String&gt; replies = new ConcurrentLinkedQueue&lt;&gt;()

    @OnOpen
    void onOpen(String topic, String username,
                WebSocketSession session, HttpRequest request) { // <b class="conum">(3)</b>
        this.topic = topic
        this.username = username
        this.session = session
        this.request = request
    }

    String getTopic() {
        topic
    }

    String getUsername() {
        username
    }

    Collection&lt;String&gt; getReplies() {
        replies
    }

    WebSocketSession getSession() {
        session
    }

    HttpRequest getRequest() {
        request
    }

    @OnMessage
    void onMessage(String message) {
        replies &lt;&lt; message // <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">WebSocket Chat Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpRequest
import io.micronaut.websocket.WebSocketSession
import io.micronaut.websocket.annotation.ClientWebSocket
import io.micronaut.websocket.annotation.OnMessage
import io.micronaut.websocket.annotation.OnOpen
import reactor.core.publisher.Mono
import java.util.concurrent.ConcurrentLinkedQueue
import java.util.concurrent.Future

@ClientWebSocket("/chat/{topic}/{username}") // <b class="conum">(1)</b>
abstract class ChatClientWebSocket : AutoCloseable { // <b class="conum">(2)</b>

    var session: WebSocketSession? = null
        private set
    var request: HttpRequest&lt;*&gt;? = null
        private set
    var topic: String? = null
        private set
    var username: String? = null
        private set
    private val replies = ConcurrentLinkedQueue&lt;String&gt;()

    @OnOpen
    fun onOpen(topic: String, username: String,
               session: WebSocketSession, request: HttpRequest&lt;*&gt;) { // <b class="conum">(3)</b>
        this.topic = topic
        this.username = username
        this.session = session
        this.request = request
    }

    fun getReplies(): Collection&lt;String&gt; {
        return replies
    }

    @OnMessage
    fun onMessage(message: String) {
        replies.add(message) // <b class="conum">(4)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is abstract (more on that later) and is annotated with <a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The client must implement <code>AutoCloseable</code> and you should ensure that the connection is closed at some point.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use the same annotations as on the server, in this case <code>@OnOpen</code> to obtain a reference to the underlying session.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@OnMessage</code> annotation defines the method that receives responses from the server.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also define abstract methods that start with either <code>send</code> or <code>broadcast</code> and these methods will be implemented for you at compile time. For example:</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract void send(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note by returning <code>void</code> this tells Micronaut that the method is a blocking send. You can instead define methods that return either futures or a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a>:</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract reactor.core.publisher.Mono&lt;String&gt; send(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a send method that returns a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a>.</p>
</div>
<div class="listingblock">
<div class="title">WebSocket Send Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract java.util.concurrent.Future&lt;String&gt; sendAsync(String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a send method that executes asynchronously and returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html">Future</a> to access the results.</p>
</div>
<div class="paragraph">
<p>Once you have defined a client class you can connect to the client socket and start sending messages:</p>
</div>
<div class="listingblock">
<div class="title">Connecting a Client WebSocket</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ChatClientWebSocket chatClient = webSocketClient
    .connect(ChatClientWebSocket.class, "/chat/football/fred")
    .blockFirst();
chatClient.send("Hello World!");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For illustration purposes we use <code>blockFirst()</code> to obtain the client. It is however possible to combine <code>connect</code> (which returns a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a>) to perform non-blocking interaction via WebSocket.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you created your project using the Micronaut CLI and the default (<code>service</code>) profile, you can use the <code>create-websocket-client</code> command to create an abstract class with <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-websocket-client MyChat
| Rendered template WebsocketClient.java to destination src/main/java/example/MyChatClient.java</pre>
</div>
</div>
</td>
</tr>
</table>
</div>

<h2 id="http2Server"><a class="anchor" href="#http2Server"></a>6.27 HTTP/2 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/http2Server.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since Micronaut 2.x, Micronaut&#8217;s Netty-based HTTP server can be configured to support HTTP/2.</p>
</div>
<div class="sect3">
<h4 id="_configuring_the_server_for_http2">Configuring the Server for HTTP/2</h4>
<div class="paragraph">
<p>The first step is to set the supported HTTP version in the server configuration:</p>
</div>
<div class="openblock">
<div class="title">Enabling HTTP/2 Support</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.http-version=2.0</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    http-version: 2.0</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    http-version=2.0</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    httpVersion = 2.0
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      http-version = 2.0
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "http-version": 2.0
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With this configuration, Micronaut enables support for the <code>h2c</code> protocol (see <a href="https://httpwg.org/specs/rfc7540.html#discover-http">HTTP/2 over cleartext</a>) which is fine for development.</p>
</div>
<div class="paragraph">
<p>Since browsers don&#8217;t support <code>h2c</code> and in general <a href="https://httpwg.org/specs/rfc7540.html#discover-https">HTTP/2 over TLS</a> (the <code>h2</code> protocol), it is recommended for production that you enable <a href="#https">HTTPS support</a>. For development this can be done with:</p>
</div>
<div class="openblock">
<div class="title">Enabling <code>h2</code> Protocol Support</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.http-version=2.0
micronaut.server.ssl.enabled=true
micronaut.server.ssl.buildSelfSigned=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    http-version: 2.0
    ssl:
      enabled: true
      buildSelfSigned: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    http-version=2.0
    [micronaut.server.ssl]
      enabled=true
      buildSelfSigned=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    httpVersion = 2.0
    ssl {
      enabled = true
      buildSelfSigned = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      http-version = 2.0
      ssl {
        enabled = true
        buildSelfSigned = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "http-version": 2.0,
      "ssl": {
        "enabled": true,
        "buildSelfSigned": true
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For production, see the <a href="#https">configuring HTTPS</a> section of the documentation.</p>
</div>
<div class="paragraph">
<p>Note that if your deployment environment uses JDK 8, or for improved support for OpenSSL, define the following dependencies on Netty Tomcat Native:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-tcnative:2.0.58.Final")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-tcnative&lt;/artifactId&gt;
    &lt;version&gt;2.0.58.Final&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-tcnative-boringssl-static:2.0.58.Final")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-tcnative-boringssl-static&lt;/artifactId&gt;
    &lt;version&gt;2.0.58.Final&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>In addition to a dependency on the appropriate native library for your architecture. For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Tomcat Native</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">runtimeOnly "io.netty:netty-tcnative-boringssl-static:2.0.58.Final:${Os.isFamily(Os.FAMILY_MAC) ? (Os.isArch("aarch64") ? "osx-aarch_64" : "osx-x86_64") : 'linux-x86_64'}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the documentation on <a href="https://netty.io/wiki/forked-tomcat-native.html">Tomcat Native</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_http2_server_push_support">HTTP/2 Server Push Support</h4>
<div class="paragraph">
<p>Support for server push has been added in Micronaut framework 3.2. Server push allows for a single request to trigger multiple responses. This is most often used in the case of browser based resources. The goal is to improve latency for the client, because they do not have to request that resource manually anymore, and can save a round trip.</p>
</div>
<div class="paragraph">
<p>A new interface, <a href="../api/io/micronaut/http/PushCapableHttpRequest.html">PushCapableHttpRequest</a>, has been created to support the feature. Simply add a <a href="../api/io/micronaut/http/PushCapableHttpRequest.html">PushCapableHttpRequest</a> parameter to a controller method and use its API to trigger additional requests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="../api/io/micronaut/http/PushCapableHttpRequest.html">PushCapableHttpRequest</a> extends <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> so its not necessary to have both as arguments in a controller method.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before triggering additional requests, the <code>isServerPushSupported()</code> method should be called to ensure the feature is available. Once it&#8217;s known the feature is supported, use the <code>serverPush(HttpRequest)</code> method to trigger additional requests. For example: <code>request.serverPush(HttpRequest.GET("/static/style.css"))</code>).</p>
</div>
</div>

<h2 id="serverEvents"><a class="anchor" href="#serverEvents"></a>6.28 Server Events</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server emits a number of <a href="#events">Bean Events</a>, defined in the <a href="../api/io/micronaut/runtime/server/event/package-summary.html">io.micronaut.runtime.server.event</a> package, that you can write listeners for. The following table summarizes these:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Server Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server completes startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted when the server shuts down</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> listeners have been invoked and exposes the <a href="../api/io/micronaut/discovery/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/discovery/event/ServiceStoppedEvent.html">ServiceStoppedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emitted after all <a href="../api/io/micronaut/runtime/server/event/ServerShutdownEvent.html">ServerShutdownEvent</a> listeners have been invoked and exposes the <a href="../api/io/micronaut/discovery/EmbeddedServerInstance.html">EmbeddedServerInstance</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Doing significant work within a listener for a <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> will increase startup time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example defines a <a href="../api/io/micronaut/context/event/ApplicationEventListener.html">ApplicationEventListener</a> that listens for <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a>:</p>
</div>
<div class="listingblock">
<div class="title">Listening for Server Startup Events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.event.ApplicationEventListener;
...
@Singleton
public class StartupListener implements ApplicationEventListener&lt;ServerStartupEvent&gt; {
    @Override
    public void onApplicationEvent(ServerStartupEvent event) {
        // logic here
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can also use the <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation on a method of any bean that accepts <code>ServerStartupEvent</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@EventListener</code> with <code>ServerStartupEvent</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.runtime.event.annotation.EventListener;
import io.micronaut.runtime.server.event.ServerStartupEvent;
import javax.inject.Singleton;
...
@Singleton
public class MyBean {

    @EventListener
    public void onStartup(ServerStartupEvent event) {
        // logic here
        ...
    }
}</code></pre>
</div>
</div>

<h2 id="serverConfiguration"><a class="anchor" href="#serverConfiguration"></a>6.29 Configuring the HTTP Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server features a number of configuration options. They are defined in the <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a> configuration class, which extends <a href="../api/io/micronaut/http/server/HttpServerConfiguration.html">HttpServerConfiguration</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to tweak configuration options for the server via your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Configuring HTTP server settings</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.maxRequestSize=1MB
micronaut.server.host=localhost
micronaut.server.netty.maxHeaderSize=500KB
micronaut.server.netty.worker.threads=8
micronaut.server.netty.childOptions.autoRead=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    maxRequestSize: 1MB
    host: localhost
    netty:
      maxHeaderSize: 500KB
      worker:
        threads: 8
      childOptions:
        autoRead: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    maxRequestSize="1MB"
    host="localhost"
    [micronaut.server.netty]
      maxHeaderSize="500KB"
      [micronaut.server.netty.worker]
        threads=8
      [micronaut.server.netty.childOptions]
        autoRead=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    maxRequestSize = "1MB"
    host = "localhost"
    netty {
      maxHeaderSize = "500KB"
      worker {
        threads = 8
      }
      childOptions {
        autoRead = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      maxRequestSize = "1MB"
      host = "localhost"
      netty {
        maxHeaderSize = "500KB"
        worker {
          threads = 8
        }
        childOptions {
          autoRead = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "maxRequestSize": "1MB",
      "host": "localhost",
      "netty": {
        "maxHeaderSize": "500KB",
        "worker": {
          "threads": 8
        },
        "childOptions": {
          "autoRead": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>By default Micronaut binds to all network interfaces. Use <code>localhost</code> to bind only to loopback network interface</p>
</li>
<li>
<p><code>maxHeaderSize</code> sets the maximum size for headers</p>
</li>
<li>
<p><code>worker.threads</code> specifies the number of Netty worker threads</p>
</li>
<li>
<p><code>autoRead</code> enables request body auto read</p>
</li>
</ul>
</div>
<a id="io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration" href="#io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.child-options</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Netty child worker options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.options</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the channel options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-initial-line-length</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum initial line length for the HTTP request. Default value (4096).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-header-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size of any one header. Default value (8192).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-chunk-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size of any single request chunk. Default value (8192).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.max-h2c-upgrade-request-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum size of the body of the HTTP1.1 request used to upgrade a connection to HTTP2 clear-text (h2c).
 This initial request cannot be streamed and is instead buffered in full, so the default value
 (8192) is relatively small. &lt;i&gt;If this value is too small for your use case,
 instead consider using an empty initial "upgrade request" (e.g. {@code OPTIONS /}), or switch to normal
 HTTP2.&lt;/i&gt;
 &lt;p&gt;
 &lt;i&gt;Does not affect normal HTTP2 (TLS).&lt;/i&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.chunked-supported</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether chunked transfer encoding is supported. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.validate-headers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to validate incoming headers. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.initial-buffer-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the initial buffer size. Default value (128).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.log-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.netty.handler.logging.LogLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the Netty log level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.compression-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the minimum size of a request body must be in order to be compressed. Default value (1024).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.compression-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the compression level (0-9). Default value (6).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.use-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether to use netty&#8217;s native transport (epoll or kqueue) if available . Default value (false).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.fallback-protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the fallback protocol to use when negotiating via ALPN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.keep-alive-on-server-error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to send connection keep alive on internal server errors. Default value ({@value DEFAULT_KEEP_ALIVE_ON_SERVER_ERROR}).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.pcap-logging-path-pattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path pattern to use for logging incoming connections to pcap. This is an unsupported option: Behavior may
 change, or it may disappear entirely, without notice!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.listeners</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the explicit netty listener configurations, or {@code null} if they should be implicit.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_using_native_transports">Using Native Transports</h3>
<div class="paragraph">
<p>The native Netty transports add features specific to a particular platform, generate less garbage, and generally improve performance when compared to the NIO-based transport.</p>
</div>
<div class="paragraph">
<p>To enable native transports, first add a dependency:</p>
</div>
<div class="paragraph">
<p>For macOS on x86:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-transport-native-kqueue::osx-x86_64")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-kqueue&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;osx-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For macOS on M1:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-transport-native-kqueue::osx-aarch_64")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-kqueue&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;osx-aarch_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For Linux on x86:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-transport-native-epoll::linux-x86_64")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-epoll&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;linux-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For Linux on ARM64:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.netty:netty-transport-native-epoll::linux-aarch_64")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-epoll&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;classifier&gt;linux-aarch_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Then configure the default event loop group to prefer native transports:</p>
</div>
<div class="openblock">
<div class="title">Configuring The Default Event Loop to Prefer Native Transports</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.netty.event-loops.default.prefer-native-transport=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  netty:
    event-loops:
      default:
        prefer-native-transport: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.netty]
    [micronaut.netty.event-loops]
      [micronaut.netty.event-loops.default]
        prefer-native-transport=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  netty {
    eventLoops {
      'default' {
        preferNativeTransport = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    netty {
      event-loops {
        default {
          prefer-native-transport = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "netty": {
      "event-loops": {
        "default": {
          "prefer-native-transport": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Netty enables simplistic sampling resource leak detection which reports there is a leak or not, at the cost of small overhead. You can disable it or enable more advanced detection by setting property <code>netty.resource-leak-detector-level</code> to one of: <code>SIMPLE</code> (default), <code>DISABLED</code>, <code>PARANOID</code> or <code>ADVANCED</code>.
</td>
</tr>
</table>
</div>
</div>

<h2 id="threadPools"><a class="anchor" href="#threadPools"></a>6.29.1 Configuring Server Thread Pools</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/threadPools.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The HTTP server is built on <a href="https://netty.io">Netty</a> which is designed as a non-blocking I/O toolkit in an event loop model.</p>
</div>
<div class="paragraph">
<p>The Netty worker event loop uses the "default" named event loop group. This can be configured through <code>micronaut.netty.event-loops.default</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The event loop configuration under <code>micronaut.server.netty.worker</code> is only used if the <code>event-loop-group</code> is set to a name which doesn&#8217;t correspond to any <code>micronaut.netty.event-loops</code> configuration. This behavior is deprecated and will be removed in a future version. Use <code>micronaut.netty.event-loops.*</code> for any event loop group configuration beyond setting the name through <code>event-loop-group</code>. This does not apply to the parent event loop configuration (<code>micronaut.server.netty.parent</code>).
</td>
</tr>
</table>
</div>
<a id="io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration.Worker" href="#io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration.Worker">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.Worker.html">Worker</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.Worker.html">NettyHttpServerConfiguration$Worker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the worker event loop configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.event-loop-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name to use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of threads for the event loop group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.io-ratio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the I/O ratio.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.executor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the executor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.prefer-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set whether to prefer the native transport if available</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.shutdown-quiet-period</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the shutdown quiet period</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.server.netty.worker.shutdown-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the shutdown timeout (must be &gt;= shutdownQuietPeriod)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The parent event loop can be configured with <code>micronaut.server.netty.parent</code> with the same configuration options.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The server can also be configured to use a different named worker event loop:</p>
</div>
<div class="openblock">
<div class="title">Using a different event loop for the server</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.netty.worker.event-loop-group=other
micronaut.netty.event-loops.other.num-threads=10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    netty:
      worker:
        event-loop-group: other
  netty:
    event-loops:
      other:
        num-threads: 10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.netty]
      [micronaut.server.netty.worker]
        event-loop-group="other"
  [micronaut.netty]
    [micronaut.netty.event-loops]
      [micronaut.netty.event-loops.other]
        num-threads=10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    netty {
      worker {
        eventLoopGroup = "other"
      }
    }
  }
  netty {
    eventLoops {
      other {
        numThreads = 10
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      netty {
        worker {
          event-loop-group = "other"
        }
      }
    }
    netty {
      event-loops {
        other {
          num-threads = 10
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "netty": {
        "worker": {
          "event-loop-group": "other"
        }
      }
    },
    "netty": {
      "event-loops": {
        "other": {
          "num-threads": 10
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default value for the number of threads is the value of the system property <code>io.netty.eventLoopThreads</code>, or if not specified, the available processors x 2.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the following table for configuring event loops:</p>
</div>
<a id="io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration" href="#io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/http/netty/channel/DefaultEventLoopGroupConfiguration.html">DefaultEventLoopGroupConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.num-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.io-ratio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.prefer-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.executor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.shutdown-quiet-period</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.shutdown-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>

<h2 id="blockingOperations"><a class="anchor" href="#blockingOperations"></a>6.29.1.1 Blocking Operations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/threadPools/blockingOperations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When dealing with blocking operations, Micronaut shifts the blocking operations to an unbound, caching I/O thread pool by default. You can configure the I/O thread pool using the <a href="../api/io/micronaut/scheduling/executor/ExecutorConfiguration.html">ExecutorConfiguration</a> named <code>io</code>. For example:</p>
</div>
<div class="openblock">
<div class="title">Configuring the Server I/O Thread Pool</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.executors.io.type=fixed
micronaut.executors.io.nThreads=75</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  executors:
    io:
      type: fixed
      nThreads: 75</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.executors]
    [micronaut.executors.io]
      type="fixed"
      nThreads=75</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  executors {
    io {
      type = "fixed"
      nThreads = 75
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    executors {
      io {
        type = "fixed"
        nThreads = 75
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "executors": {
      "io": {
        "type": "fixed",
        "nThreads": 75
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above configuration creates a fixed thread pool with 75 threads.</p>
</div>

<h2 id="atBlocking"><a class="anchor" href="#atBlocking"></a>6.29.1.2 @Blocking</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/threadPools/atBlocking.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can use the <a href="../api/io/micronaut/core/annotation/Blocking.html">@Blocking</a> annotation to mark methods as blocking.</p>
</div>
<div class="paragraph">
<p>If you set <code>micronaut.server.thread-selection</code> to <code>AUTO</code>, The Micronaut Framework offloads the execution of methods annotated with <code>@Blocking</code> to the IO thread pool (See: <a href="../api/io/micronaut/scheduling/TaskExecutors.html">TaskExecutors</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>@Blocking</code> only works if you are using <code>AUTO</code> thread selection. Micronaut Framework defaults to <code>MANUAL</code> thread selection since Micronaut 2.0. We recommend the usage of <a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a> annotation to execute the blocking operations on a different thread pool. <code>@ExecutesOn</code> works for both <code>MANUAL</code> and <code>AUTO</code> thread selection.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are some places where the Micronaut framework uses <a href="../api/io/micronaut/core/annotation/Blocking.html">@Blocking</a> internally:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Blocking Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/BlockingHttpClient.html">BlockingHttpClient</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intended for testing, provides blocking versions for a subset of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.micronaut.io/latest/api/io/micronaut/core/io/IOUtils.html">IOUtils</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads the contents of a <code>BufferedReader</code> in a blocking manner, and returns that as a <code>String</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.micronaut.io/latest/api/io/micronaut/context/env/BootstrapPropertySourceLocator.html">BootstrapPropertySourceLocator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolves either remote or local <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances for the current <code>Environment</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/">Micronaut Data</a> also utilizes <code>@Blocking</code> internally for some transaction operations, CRUD interceptors, and repositories.
</td>
</tr>
</table>
</div>

<h2 id="nettyClientPipeline"><a class="anchor" href="#nettyClientPipeline"></a>6.29.2 Configuring the Netty Client Pipeline</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/nettyClientPipeline.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can customize the Netty client pipeline by writing a <a href="#events">Bean Event Listener</a> that listens for the creation of a <a href="../api/io/micronaut/http/client/netty/NettyClientCustomizer.Registry.html">Registry</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/netty/channel/ChannelPipelineCustomizer.html">ChannelPipelineCustomizer</a> interface defines constants for the names of the various handlers Micronaut registers.</p>
</div>
<div class="paragraph">
<p>As an example the following code sample demonstrates registering the <a href="https://github.com/zalando/logbook">Logbook</a> library which includes additional Netty handlers to perform request and response logging:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty server pipeline for Logbook</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.context.event.BeanCreatedEvent;
import io.micronaut.context.event.BeanCreatedEventListener;
import io.micronaut.http.client.netty.NettyClientCustomizer;
import io.micronaut.http.netty.channel.ChannelPipelineCustomizer;
import io.netty.channel.Channel;
import io.netty.channel.ChannelPipeline;
import jakarta.inject.Singleton;
import org.zalando.logbook.Logbook;
import org.zalando.logbook.netty.LogbookClientHandler;

@Requires(beans = Logbook.class)
@Singleton
public class LogbookNettyClientCustomizer
    implements BeanCreatedEventListener&lt;NettyClientCustomizer.Registry&gt; { // <b class="conum">(1)</b>
    private final Logbook logbook;

    public LogbookNettyClientCustomizer(Logbook logbook) {
        this.logbook = logbook;
    }

    @Override
    public NettyClientCustomizer.Registry onCreated(
        BeanCreatedEvent&lt;NettyClientCustomizer.Registry&gt; event) {

        NettyClientCustomizer.Registry registry = event.getBean();
        registry.register(new Customizer(null)); // <b class="conum">(2)</b>
        return registry;
    }

    private class Customizer implements NettyClientCustomizer { // <b class="conum">(3)</b>
        private final Channel channel;

        Customizer(Channel channel) {
            this.channel = channel;
        }

        @Override
        public NettyClientCustomizer specializeForChannel(Channel channel, ChannelRole role) {
            return new Customizer(channel); // <b class="conum">(4)</b>
        }

        @Override
        public void onStreamPipelineBuilt() {
            channel.pipeline().addLast( // <b class="conum">(5)</b>
                "logbook",
                new LogbookClientHandler(logbook)
            );
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty server pipeline for Logbook</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.event.BeanCreatedEvent
import io.micronaut.context.event.BeanCreatedEventListener
import io.micronaut.http.client.netty.NettyClientCustomizer
import io.netty.channel.Channel
import jakarta.inject.Singleton
import org.zalando.logbook.Logbook
import org.zalando.logbook.netty.LogbookClientHandler


@Requires(beans = Logbook.class)
@Singleton
class LogbookNettyClientCustomizer
        implements BeanCreatedEventListener&lt;NettyClientCustomizer.Registry&gt; { // <b class="conum">(1)</b>
    private final Logbook logbook;

    LogbookNettyClientCustomizer(Logbook logbook) {
        this.logbook = logbook
    }

    @Override
    NettyClientCustomizer.Registry onCreated(
            BeanCreatedEvent&lt;NettyClientCustomizer.Registry&gt; event) {

        NettyClientCustomizer.Registry registry = event.getBean()
        registry.register(new Customizer(null)) // <b class="conum">(2)</b>
        return registry
    }

    private class Customizer implements NettyClientCustomizer { // <b class="conum">(3)</b>
        private final Channel channel

        Customizer(Channel channel) {
            this.channel = channel
        }

        @Override
        NettyClientCustomizer specializeForChannel(Channel channel, ChannelRole role) {
            return new Customizer(channel) // <b class="conum">(4)</b>
        }

        @Override
        void onStreamPipelineBuilt() {
            channel.pipeline().addLast( // <b class="conum">(5)</b>
                    "logbook",
                    new LogbookClientHandler(logbook)
            )
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty server pipeline for Logbook</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.context.event.BeanCreatedEvent
import io.micronaut.context.event.BeanCreatedEventListener
import io.micronaut.http.client.netty.NettyClientCustomizer
import io.micronaut.http.client.netty.NettyClientCustomizer.ChannelRole
import io.netty.channel.Channel
import jakarta.inject.Singleton
import org.zalando.logbook.Logbook
import org.zalando.logbook.netty.LogbookClientHandler

@Requires(beans = [Logbook::class])
@Singleton
class LogbookNettyClientCustomizer(private val logbook: Logbook) :
    BeanCreatedEventListener&lt;NettyClientCustomizer.Registry&gt; { // <b class="conum">(1)</b>

    override fun onCreated(event: BeanCreatedEvent&lt;NettyClientCustomizer.Registry&gt;): NettyClientCustomizer.Registry {
        val registry = event.bean
        registry.register(Customizer(null)) // <b class="conum">(2)</b>
        return registry
    }

    private inner class Customizer constructor(private val channel: Channel?) :
        NettyClientCustomizer { // <b class="conum">(3)</b>

        override fun specializeForChannel(channel: Channel, role: ChannelRole) = Customizer(channel) // <b class="conum">(4)</b>

        override fun onStreamPipelineBuilt() {
            channel!!.pipeline().addLast( // <b class="conum">(5)</b>
                "logbook",
                LogbookClientHandler(logbook)
            )
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>LogbookNettyClientCustomizer</code> listens for a <a href="../api/io/micronaut/http/client/netty/NettyClientCustomizer.Registry.html">Registry</a> and requires the definition of a <code>Logbook</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The root customizer is initialized without a channel and registered</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The actual customizer implements <a href="../api/io/micronaut/http/client/netty/NettyClientCustomizer.html">NettyClientCustomizer</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When a new channel is created, a new, specialized customizer is created for that channel</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When the client signals that the stream pipeline has been fully constructed, the logbook handler is registered</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Logbook has a <a href="https://github.com/zalando/logbook/issues/1216">major bug</a> that limits its usefulness with netty.
</td>
</tr>
</table>
</div>

<h2 id="nettyServerPipeline"><a class="anchor" href="#nettyServerPipeline"></a>6.29.3 Configuring the Netty Server Pipeline</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/nettyServerPipeline.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can customize the Netty server pipeline by writing a <a href="#events">Bean Event Listener</a> that listens for the creation of <a href="../api/io/micronaut/http/server/netty/NettyServerCustomizer.Registry.html">Registry</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/netty/channel/ChannelPipelineCustomizer.html">ChannelPipelineCustomizer</a> interface defines constants for the names of the various handlers Micronaut registers.</p>
</div>
<div class="paragraph">
<p>As an example the following code sample demonstrates registering the <a href="https://github.com/zalando/logbook">Logbook</a> library which includes additional Netty handlers to perform request and response logging:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty server pipeline for Logbook</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.context.event.BeanCreatedEvent;
import io.micronaut.context.event.BeanCreatedEventListener;
import io.micronaut.http.netty.channel.ChannelPipelineCustomizer;
import io.micronaut.http.server.netty.NettyServerCustomizer;
import io.netty.channel.Channel;
import org.zalando.logbook.Logbook;
import org.zalando.logbook.netty.LogbookServerHandler;

import jakarta.inject.Singleton;

@Requires(beans = Logbook.class)
@Singleton
public class LogbookNettyServerCustomizer
    implements BeanCreatedEventListener&lt;NettyServerCustomizer.Registry&gt; { // <b class="conum">(1)</b>
    private final Logbook logbook;

    public LogbookNettyServerCustomizer(Logbook logbook) {
        this.logbook = logbook;
    }

    @Override
    public NettyServerCustomizer.Registry onCreated(
        BeanCreatedEvent&lt;NettyServerCustomizer.Registry&gt; event) {

        NettyServerCustomizer.Registry registry = event.getBean();
        registry.register(new Customizer(null)); // <b class="conum">(2)</b>
        return registry;
    }

    private class Customizer implements NettyServerCustomizer { // <b class="conum">(3)</b>
        private final Channel channel;

        Customizer(Channel channel) {
            this.channel = channel;
        }

        @Override
        public NettyServerCustomizer specializeForChannel(Channel channel, ChannelRole role) {
            return new Customizer(channel); // <b class="conum">(4)</b>
        }

        @Override
        public void onStreamPipelineBuilt() {
            channel.pipeline().addBefore( // <b class="conum">(5)</b>
                ChannelPipelineCustomizer.HANDLER_HTTP_STREAM,
                "logbook",
                new LogbookServerHandler(logbook)
            );
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty server pipeline for Logbook</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.context.event.BeanCreatedEvent
import io.micronaut.context.event.BeanCreatedEventListener
import io.micronaut.http.netty.channel.ChannelPipelineCustomizer
import io.micronaut.http.server.netty.NettyServerCustomizer
import io.netty.channel.Channel
import org.zalando.logbook.Logbook
import org.zalando.logbook.netty.LogbookServerHandler

import jakarta.inject.Singleton

@Requires(beans = Logbook.class)
@Singleton
class LogbookNettyServerCustomizer
        implements BeanCreatedEventListener&lt;NettyServerCustomizer.Registry&gt; { // <b class="conum">(1)</b>
    private final Logbook logbook;

    LogbookNettyServerCustomizer(Logbook logbook) {
        this.logbook = logbook
    }

    @Override
    NettyServerCustomizer.Registry onCreated(
            BeanCreatedEvent&lt;NettyServerCustomizer.Registry&gt; event) {

        NettyServerCustomizer.Registry registry = event.getBean()
        registry.register(new Customizer(null)) // <b class="conum">(2)</b>
        return registry
    }

    private class Customizer implements NettyServerCustomizer { // <b class="conum">(3)</b>
        private final Channel channel

        Customizer(Channel channel) {
            this.channel = channel
        }

        @Override
        NettyServerCustomizer specializeForChannel(Channel channel, ChannelRole role) {
            return new Customizer(channel) // <b class="conum">(4)</b>
        }

        @Override
        void onStreamPipelineBuilt() {
            channel.pipeline().addBefore( // <b class="conum">(5)</b>
                    ChannelPipelineCustomizer.HANDLER_HTTP_STREAM,
                    "logbook",
                    new LogbookServerHandler(logbook)
            )
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Customizing the Netty server pipeline for Logbook</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.context.event.BeanCreatedEvent
import io.micronaut.context.event.BeanCreatedEventListener
import io.micronaut.http.netty.channel.ChannelPipelineCustomizer
import io.micronaut.http.server.netty.NettyServerCustomizer
import io.micronaut.http.server.netty.NettyServerCustomizer.ChannelRole
import io.netty.channel.Channel
import jakarta.inject.Singleton
import org.zalando.logbook.Logbook
import org.zalando.logbook.netty.LogbookServerHandler

@Requires(beans = [Logbook::class])
@Singleton
class LogbookNettyServerCustomizer(private val logbook: Logbook) :
    BeanCreatedEventListener&lt;NettyServerCustomizer.Registry&gt; { // <b class="conum">(1)</b>

    override fun onCreated(event: BeanCreatedEvent&lt;NettyServerCustomizer.Registry&gt;): NettyServerCustomizer.Registry {
        val registry = event.bean
        registry.register(Customizer(null)) // <b class="conum">(2)</b>
        return registry
    }

    private inner class Customizer constructor(private val channel: Channel?) :
        NettyServerCustomizer { // <b class="conum">(3)</b>

        override fun specializeForChannel(channel: Channel, role: ChannelRole) = Customizer(channel) // <b class="conum">(4)</b>

        override fun onStreamPipelineBuilt() {
            channel!!.pipeline().addBefore( // <b class="conum">(5)</b>
                ChannelPipelineCustomizer.HANDLER_HTTP_STREAM,
                "logbook",
                LogbookServerHandler(logbook)
            )
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>LogbookNettyServerCustomizer</code> listens for a <a href="../api/io/micronaut/http/server/netty/NettyServerCustomizer.Registry.html">Registry</a> and requires the definition of a <code>Logbook</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The root customizer is initialized without a channel and registered</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The actual customizer implements <a href="../api/io/micronaut/http/server/netty/NettyServerCustomizer.html">NettyServerCustomizer</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>When a new channel is created, a new, specialized customizer is created for that channel</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When the server signals that the stream pipeline has been fully constructed, the logbook handler is registered</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Logbook has a <a href="https://github.com/zalando/logbook/issues/1216">major bug</a> that limits its usefulness with netty.
</td>
</tr>
</table>
</div>

<h2 id="listener"><a class="anchor" href="#listener"></a>6.29.4 Advanced Listener Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/listener.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Instead of configuring a single port, you can also specify each listener manually.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.netty.listeners.httpListener.host=127.0.0.1
micronaut.server.netty.listeners.httpListener.port=8086
micronaut.server.netty.listeners.httpListener.ssl=false
micronaut.server.netty.listeners.httpsListener.port=8087
micronaut.server.netty.listeners.httpsListener.ssl=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    netty:
      listeners:
        httpListener:
          host: 127.0.0.1
          port: 8086
          ssl: false
        httpsListener:
          port: 8087
          ssl: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.netty]
      [micronaut.server.netty.listeners]
        [micronaut.server.netty.listeners.httpListener]
          host="127.0.0.1"
          port=8086
          ssl=false
        [micronaut.server.netty.listeners.httpsListener]
          port=8087
          ssl=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    netty {
      listeners {
        httpListener {
          host = "127.0.0.1"
          port = 8086
          ssl = false
        }
        httpsListener {
          port = 8087
          ssl = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      netty {
        listeners {
          httpListener {
            host = "127.0.0.1"
            port = 8086
            ssl = false
          }
          httpsListener {
            port = 8087
            ssl = true
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "netty": {
        "listeners": {
          "httpListener": {
            "host": "127.0.0.1",
            "port": 8086,
            "ssl": false
          },
          "httpsListener": {
            "port": 8087,
            "ssl": true
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>httpListener</code> is a listener name, and can be an arbitrary value</p>
</li>
<li>
<p><code>host</code> is optional, and by default binds to all interfaces</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you specify listeners manually, other configuration such as <code>micronaut.server.port</code> will be ignored.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>SSL can be enabled or disabled for each listener individually. When enabled, the SSL will be configured <a href="#https">as described above</a>.</p>
</div>
<div class="paragraph">
<p>The embedded server also supports binding to unix domain sockets using netty. This requires the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.netty:netty-transport-native-unix-common")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.netty&lt;/groupId&gt;
    &lt;artifactId&gt;netty-transport-native-unix-common&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>The server must also be configured to <a href="#serverConfiguration">use native transport</a> (epoll or kqueue).</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.netty.listeners.unixListener.family=UNIX
micronaut.server.netty.listeners.unixListener.path=/run/micronaut.socket
micronaut.server.netty.listeners.unixListener.ssl=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    netty:
      listeners:
        unixListener:
          family: UNIX
          path: /run/micronaut.socket
          ssl: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.netty]
      [micronaut.server.netty.listeners]
        [micronaut.server.netty.listeners.unixListener]
          family="UNIX"
          path="/run/micronaut.socket"
          ssl=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    netty {
      listeners {
        unixListener {
          family = "UNIX"
          path = "/run/micronaut.socket"
          ssl = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      netty {
        listeners {
          unixListener {
            family = "UNIX"
            path = "/run/micronaut.socket"
            ssl = true
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "netty": {
        "listeners": {
          "unixListener": {
            "family": "UNIX",
            "path": "/run/micronaut.socket",
            "ssl": true
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>unixListener</code> is a listener name, and can be an arbitrary value</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use an abstract domain socket instead of a normal one, prefix the path with a NUL character, like <code>"\0/run/micronaut.socket"</code>
</td>
</tr>
</table>
</div>

<h2 id="cors"><a class="anchor" href="#cors"></a>6.29.5 Configuring CORS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports CORS (<a href="https://www.w3.org/TR/cors/">Cross Origin Resource Sharing</a>) out of the box. By default, CORS requests are rejected.</p>
</div>

<h2 id="annotationBasedCors"><a class="anchor" href="#annotationBasedCors"></a>6.29.5.1 Annotation-based CORS Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/annotationBasedCors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut CORS configuration applies by default to all endpoints in the running application.</p>
</div>
<div class="paragraph">
<p>As an alternative, <a href="#corsConfiguration">CORS configuration</a> can be applied in a more fine-grained manner to specific routes using the
<a href="../api/io/micronaut/http/server/cors/CrossOrigin.html">@CrossOrigin</a> annotation. This is applied to <code>@Controller</code> to apply the CORS configuration to all endpoints in the controller. Alternatively, the annotation can be applied to specific endpoints on a controller, for even more fine-grained control.</p>
</div>
<div class="paragraph">
<p>The <code>@CrossOrigin</code> annotation maps with a one-to-one correspondence to application-wide <a href="../api/io/micronaut/http/server/cors/CorsOriginConfiguration.html">CorsOriginConfiguration</a> configuration properties. To specify just an allowed origin, use <code>@CrossOrigin("https://foo.com")</code>. To specify additional configuration details, use  a combination of annotation attributes the same as you would for specifying global <code>CorsOriginConfiguration</code> properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CrossOrigin(
	allowedOrigins = { "http://foo.com" },
	allowedOriginsRegex = "^http(|s):\\/\\/www\\.google\\.com$",
	allowedMethods = { HttpMethod.POST, HttpMethod.PUT },
	allowedHeaders = { HttpHeaders.CONTENT_TYPE, HttpHeaders.AUTHORIZATION },
	exposedHeaders = { HttpHeaders.CONTENT_TYPE, HttpHeaders.AUTHORIZATION },
	allowCredentials = false,
	maxAge = 3600
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example demonstrates how the annotation might be applied to a specific endpoint. To enable CORS for all endpoints in the controller, move the annotation to the class level and configure it appropriately.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@CrossOrigin Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Produces;
import io.micronaut.http.server.cors.CrossOrigin;

@Controller("/hello")
public class CorsController {
    @CrossOrigin("https://myui.com") // <b class="conum">(1)</b>
    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    public String cors() {
        return "Welcome to the worlds of CORS";
    }

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/nocors") // <b class="conum">(3)</b>
    public String nocorstoday() {
        return "No more CORS for you";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@CrossOrigin Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces
import io.micronaut.http.server.cors.CrossOrigin

@Controller("/hello")
class CorsController {
    @CrossOrigin("https://myui.com") // <b class="conum">(1)</b>
    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    String cors() {
        return "Welcome to the worlds of CORS"
    }

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/nocors") // <b class="conum">(3)</b>
    String nocorstoday() {
        return "No more CORS for you"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@CrossOrigin Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Produces
import io.micronaut.http.server.cors.CrossOrigin

@Controller("/hello")
class CorsController {
    @CrossOrigin("https://myui.com") // <b class="conum">(1)</b>
    @Get(produces = [MediaType.TEXT_PLAIN]) // <b class="conum">(2)</b>
    fun cors(): String {
        return "Welcome to the worlds of CORS"
    }

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/nocors") // <b class="conum">(3)</b>
    fun nocorstoday(): String {
        return "No more CORS for you"
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/server/cors/CrossOrigin.html">@CrossOrigin</a> annotation is applied to a specific endpoint, making the CORS configuration fine-grained.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>GET /hello</code> endpoint has "https://myui.com" as an allowed cross origin endpoint</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>GET /hello/nocors</code> endpoint cannot use "https://myui.com" as an origin, since it doesn&#8217;t have a CORS configuration that allows it.</td>
</tr>
</table>
</div>

<h2 id="corsConfiguration"><a class="anchor" href="#corsConfiguration"></a>6.29.5.2 CORS via Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To enable processing of CORS requests, modify your configuration in the application configuration file:</p>
</div>
<div class="openblock">
<div class="title">CORS Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By only enabling CORS processing, a "wide open" strategy is adopted that allows requests from any origin.</p>
</div>
<div class="paragraph">
<p>To change the settings for all origins or a specific origin, change the configuration to provide one or more "configurations". By providing any configuration, the default "wide open" configuration is not configured.</p>
</div>
<div class="openblock">
<div class="title">CORS Configurations</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true
micronaut.server.cors.configurations.all=...
micronaut.server.cors.configurations.web=...
micronaut.server.cors.configurations.mobile=...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true
      configurations:
        all:
          ...
        web:
          ...
        mobile:
          ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true
      [micronaut.server.cors.configurations]
        all="..."
        web="..."
        mobile="..."</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
      configurations {
        all = "..."
        web = "..."
        mobile = "..."
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
        configurations {
          all = "..."
          web = "..."
          mobile = "..."
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true,
        "configurations": {
          "all": "...",
          "web": "...",
          "mobile": "..."
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example, three configurations are provided. Their names (<code>all</code>, <code>web</code>, <code>mobile</code>) are not important and have no significance inside Micronaut. They are there purely to be able to easily recognize the intended user of the configuration.</p>
</div>
<div class="paragraph">
<p>The same configuration properties can be applied to each configuration. See <a href="../api/io/micronaut/http/server/cors/CorsOriginConfiguration.html">CorsOriginConfiguration</a> for properties that can be defined. The values of each configuration supplied will default to the default values of the corresponding fields.</p>
</div>
<div class="paragraph">
<p>When a CORS request is made, configurations are searched for allowed origins that match exactly or match the request origin through a regular expression.</p>
</div>

<h2 id="corsAllowedOrigins"><a class="anchor" href="#corsAllowedOrigins"></a>6.29.5.3 Allowed Origins</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsAllowedOrigins.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Don&#8217;t define <code>allowed-origins</code> or <code>allowed-origins-regex</code> to allow any origin for a given configuration.</p>
</div>
<div class="paragraph">
<p>For multiple valid origins, set the <code>allowed-origins</code> key of the configuration to a list of strings.</p>
</div>
<div class="paragraph">
<p>You can also define via <code>allowed-origins-regex</code> a regular expression (<code>^http(|s)://www\.google\.com$</code>). The Regular expression is passed to <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#compile-java.lang.String-">Pattern#compile</a> and compared to the request origin with <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#matches--">Matcher#matches</a>.</p>
</div>
<div class="openblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true
micronaut.server.cors.configurations.web.allowed-origins-regex=^http(|s):\/\/www\.google\.com$
micronaut.server.cors.configurations.web.allowed-origins[0]=http://foo.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true
      configurations:
        web:
          allowed-origins-regex: '^http(|s):\/\/www\.google\.com$'
          allowed-origins:
            - http://foo.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true
      [micronaut.server.cors.configurations]
        [micronaut.server.cors.configurations.web]
          allowed-origins-regex="^http(|s):\\/\\/www\\.google\\.com$"
          allowed-origins=[
            "http://foo.com"
          ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
      configurations {
        web {
          allowedOriginsRegex = "^http(|s):\\/\\/www\\.google\\.com$"
          allowedOrigins = ["http://foo.com"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
        configurations {
          web {
            allowed-origins-regex = "^http(|s):\\/\\/www\\.google\\.com$"
            allowed-origins = ["http://foo.com"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true,
        "configurations": {
          "web": {
            "allowed-origins-regex": "^http(|s):\\/\\/www\\.google\\.com$",
            "allowed-origins": ["http://foo.com"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Use the <code>allowed-origins-regex</code> configuration judiciously. You may accidentally make an insecure configuration which could be targeted by an attacker registering domains targeting the regular expression.
</td>
</tr>
</table>
</div>

<h2 id="corsAllowedMethods"><a class="anchor" href="#corsAllowedMethods"></a>6.29.5.4 Allowed Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsAllowedMethods.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To allow any request method for a given configuration, don&#8217;t include the <code>allowed-methods</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>For multiple allowed methods, set the <code>allowed-methods</code> key of the configuration to a list of strings.</p>
</div>
<div class="openblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true
micronaut.server.cors.configurations.web.allowed-methods[0]=POST
micronaut.server.cors.configurations.web.allowed-methods[1]=PUT</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true
      configurations:
        web:
          allowed-methods:
            - POST
            - PUT</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true
      [micronaut.server.cors.configurations]
        [micronaut.server.cors.configurations.web]
          allowed-methods=[
            "POST",
            "PUT"
          ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
      configurations {
        web {
          allowedMethods = ["POST", "PUT"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
        configurations {
          web {
            allowed-methods = ["POST", "PUT"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true,
        "configurations": {
          "web": {
            "allowed-methods": ["POST", "PUT"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="corsAllowedHeaders"><a class="anchor" href="#corsAllowedHeaders"></a>6.29.5.5 Allowed Headers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsAllowedHeaders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To allow any request header for a given configuration, don&#8217;t include the <code>allowed-headers</code> key in your configuration.</p>
</div>
<div class="paragraph">
<p>For multiple allowed headers, set the <code>allowed-headers</code> key of the configuration to a list of strings.</p>
</div>
<div class="openblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true
micronaut.server.cors.configurations.web.allowed-headers[0]=Content-Type
micronaut.server.cors.configurations.web.allowed-headers[1]=Authorization</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true
      configurations:
        web:
          allowed-headers:
            - Content-Type
            - Authorization</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true
      [micronaut.server.cors.configurations]
        [micronaut.server.cors.configurations.web]
          allowed-headers=[
            "Content-Type",
            "Authorization"
          ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
      configurations {
        web {
          allowedHeaders = ["Content-Type", "Authorization"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
        configurations {
          web {
            allowed-headers = ["Content-Type", "Authorization"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true,
        "configurations": {
          "web": {
            "allowed-headers": ["Content-Type", "Authorization"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="corsExposedHeaders"><a class="anchor" href="#corsExposedHeaders"></a>6.29.5.6 Exposed Headers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsExposedHeaders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure the headers that are sent in the response to a CORS request through the <code>Access-Control-Expose-Headers</code> header, include a list of strings for the <code>exposed-headers</code> key in your configuration. None are exposed by default.</p>
</div>
<div class="openblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true
micronaut.server.cors.configurations.web.exposed-headers[0]=Content-Type
micronaut.server.cors.configurations.web.exposed-headers[1]=Authorization</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true
      configurations:
        web:
          exposed-headers:
            - Content-Type
            - Authorization</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true
      [micronaut.server.cors.configurations]
        [micronaut.server.cors.configurations.web]
          exposed-headers=[
            "Content-Type",
            "Authorization"
          ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
      configurations {
        web {
          exposedHeaders = ["Content-Type", "Authorization"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
        configurations {
          web {
            exposed-headers = ["Content-Type", "Authorization"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true,
        "configurations": {
          "web": {
            "exposed-headers": ["Content-Type", "Authorization"]
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="corsAllowCredentials"><a class="anchor" href="#corsAllowCredentials"></a>6.29.5.7 Allow Credentials</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsAllowCredentials.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Credentials are allowed by default for CORS requests. To disallow credentials, set the <code>allow-credentials</code> option to <code>false</code>.</p>
</div>
<div class="openblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true
micronaut.server.cors.configurations.web.allow-credentials=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true
      configurations:
        web:
          allow-credentials: false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true
      [micronaut.server.cors.configurations]
        [micronaut.server.cors.configurations.web]
          allow-credentials=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
      configurations {
        web {
          allowCredentials = false
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
        configurations {
          web {
            allow-credentials = false
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true,
        "configurations": {
          "web": {
            "allow-credentials": false
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="corsMaxAge"><a class="anchor" href="#corsMaxAge"></a>6.29.5.8 Max Age</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsMaxAge.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The default maximum age that preflight requests can be cached is 30 minutes. To change that behavior, specify a value in seconds.</p>
</div>
<div class="openblock">
<div class="title">Example CORS Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.enabled=true
micronaut.server.cors.configurations.web.max-age=3600</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      enabled: true
      configurations:
        web:
          max-age: 3600 # 1 hour</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      enabled=true
      [micronaut.server.cors.configurations]
        [micronaut.server.cors.configurations.web]
          max-age=3600</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      enabled = true
      configurations {
        web {
          maxAge = 3600
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        enabled = true
        configurations {
          web {
            max-age = 3600
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "enabled": true,
        "configurations": {
          "web": {
            "max-age": 3600
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="corsMultipleHeaderValues"><a class="anchor" href="#corsMultipleHeaderValues"></a>6.29.5.9 Multiple Header Values</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/cors/corsMultipleHeaderValues.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default, when a header has multiple values, multiple headers are sent, each with a single value. It is possible to change the behavior to send a single header with a comma-separated list of values by setting a configuration option.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.cors.single-header=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    cors:
      single-header: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.cors]
      single-header=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    cors {
      singleHeader = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      cors {
        single-header = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "cors": {
        "single-header": true
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="https"><a class="anchor" href="#https"></a>6.29.6 Securing the Server with HTTPS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/https.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports HTTPS out of the box. By default HTTPS is disabled and all requests are served using HTTP. To enable HTTPS support, modify your configuration. For example:</p>
</div>
<div class="openblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.ssl.enabled=true
micronaut.server.ssl.buildSelfSigned=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    ssl:
      enabled: true
      buildSelfSigned: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.ssl]
      enabled=true
      buildSelfSigned=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    ssl {
      enabled = true
      buildSelfSigned = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      ssl {
        enabled = true
        buildSelfSigned = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "ssl": {
        "enabled": true,
        "buildSelfSigned": true
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Micronaut will create a self-signed certificate.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default, Micronaut with HTTPS support starts on port <code>8443</code> but you can change the port with the property <code>micronaut.server.ssl.port</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For generating self-signed certificates, the Micronaut HTTP server will use netty. Netty uses one of two approaches to generate the certificate.</p>
</div>
<div class="paragraph">
<p>If you use a pre-generated certificate (as you should, for security), these steps are not necessary.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Netty can use the JDK-internal <code>sun.security.x509</code> package. On newer JDK versions, this package is restricted and may not work. You may need to add <code>--add-exports=java.base/sun.security.x509=ALL-UNNAMED</code> as a VM parameter.</p>
</li>
<li>
<p>Alternatively, netty will use the Bouncy Castle BCPKIX API. This needs an additional dependency:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"org.bouncycastle:bcpkix-jdk15on")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;
    &lt;artifactId&gt;bcpkix-jdk15on&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This configuration will generate a warning in the browser.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/https-warning.jpg" alt="https warning">
</div>
</div>
<div class="sect1">
<h2 id="_using_a_valid_x509_certificate">Using a valid x509 certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to configure Micronaut to use an existing valid x509 certificate, for example one created with <a href="https://letsencrypt.org/">Let&#8217;s Encrypt</a>. You will need the <code>server.crt</code> and <code>server.key</code> files and to convert them to a PKCS #12 file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ openssl pkcs12 -export \
                 -in server.crt \ <i class="conum" data-value="1"></i><b>(1)</b>
                 -inkey server.key \ <i class="conum" data-value="2"></i><b>(2)</b>
                 -out server.p12 \ <i class="conum" data-value="3"></i><b>(3)</b>
                 -name someAlias \ <i class="conum" data-value="4"></i><b>(4)</b>
                 -chain -CAfile ca.crt -caname root</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The original <code>server.crt</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The original <code>server.key</code> file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>server.p12</code> file to create</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias for the certificate</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During the creation of the <code>server.p12</code> file it is necessary to define a password that will be required later when using the certificate in Micronaut.</p>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="openblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.ssl.enabled=true
micronaut.ssl.key-store.path=classpath:server.p12
micronaut.ssl.key-store.password=mypassword
micronaut.ssl.key-store.type=PKCS12</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  ssl:
    enabled: true
    key-store:
      path: classpath:server.p12
      password: mypassword
      type: PKCS12</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.ssl]
    enabled=true
    [micronaut.ssl.key-store]
      path="classpath:server.p12"
      password="mypassword"
      type="PKCS12"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  ssl {
    enabled = true
    keyStore {
      path = "classpath:server.p12"
      password = "mypassword"
      type = "PKCS12"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    ssl {
      enabled = true
      key-store {
        path = "classpath:server.p12"
        password = "mypassword"
        type = "PKCS12"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "ssl": {
      "enabled": true,
      "key-store": {
        "path": "classpath:server.p12",
        "password": "mypassword",
        "type": "PKCS12"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <code>p12</code> file path. It can also be referenced as <code>file:/path/to/the/file</code></p>
</li>
<li>
<p>Also provide the <code>password</code> defined during the export</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this configuration, if we start Micronaut and connect to <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> we still see the warning in the browser, but if we inspect the certificate we can check that it is the one generated by Let&#8217;s Encrypt.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/https-certificate.jpg" alt="https certificate">
</div>
</div>
<div class="paragraph">
<p>Finally, we can test that the certificate is valid for the browser by adding an alias to the domain in <code>/etc/hosts</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cat /etc/hosts
...
127.0.0.1   my-domain.org
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can connect to <code><a href="https://my-domain.org:8443" class="bare">https://my-domain.org:8443</a></code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/https-valid-certificate.jpg" alt="https valid certificate">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_java_keystore_jks">Using Java Keystore (JKS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using this type of certificate is not recommended because the format is proprietary - PKCS12 format is preferred. Regardless, Micronaut also supports it.</p>
</div>
<div class="paragraph">
<p>Convert the <code>p12</code> certificate to a JKS one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ keytool -importkeystore \
          -deststorepass newPassword -destkeypass newPassword \ <i class="conum" data-value="1"></i><b>(1)</b>
          -destkeystore server.keystore \ <i class="conum" data-value="2"></i><b>(2)</b>
          -srckeystore server.p12 -srcstoretype PKCS12 -srcstorepass mypassword \ <i class="conum" data-value="3"></i><b>(3)</b>
          -alias someAlias <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is necessary to define the password for the keystore</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The file to create</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The PKCS12 file created previously, and the password defined during the creation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias used before</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If either <code>srcstorepass</code> or <code>alias</code> are not the same as defined in the <code>p12</code> file, the conversion will fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now modify your configuration:</p>
</div>
<div class="openblock">
<div class="title">HTTPS Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.ssl.enabled=true
micronaut.ssl.key-store.path=classpath:server.keystore
micronaut.ssl.key-store.password=newPassword
micronaut.ssl.key-store.type=JKS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  ssl:
    enabled: true
    key-store:
      path: classpath:server.keystore
      password: newPassword
      type: JKS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.ssl]
    enabled=true
    [micronaut.ssl.key-store]
      path="classpath:server.keystore"
      password="newPassword"
      type="JKS"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  ssl {
    enabled = true
    keyStore {
      path = "classpath:server.keystore"
      password = "newPassword"
      type = "JKS"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    ssl {
      enabled = true
      key-store {
        path = "classpath:server.keystore"
        password = "newPassword"
        type = "JKS"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "ssl": {
      "enabled": true,
      "key-store": {
        "path": "classpath:server.keystore",
        "password": "newPassword",
        "type": "JKS"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Start Micronaut, and the application will run on <code><a href="https://localhost:8443" class="bare">https://localhost:8443</a></code> using the certificate in the keystore.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_refreshingreloading_https_certificates">Refreshing/Reloading HTTPS Certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Keeping HTTPS certificates up-to-date after expiry can be a challenge. A great solution to this is <a href="https://en.wikipedia.org/wiki/Automated_Certificate_Management_Environment">Automated Certificate Management Environment</a> (ACME) and the <a href="https://micronaut-projects.github.io/micronaut-acme/latest/guide/index.html">Micronaut ACME Module</a> which provides support for automatically refreshing certificates from a certificate authority.</p>
</div>
<div class="paragraph">
<p>If the use of a certificate authority is not possible and you need to manually update certificates from disk then you should fire a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> using Micronaut&#8217;s support for <a href="#events">Application Events</a> containing the keys where your HTTPS configuration is defined and Micronaut will reload the certificates from disk and apply the new configuration to the server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use the <a href="#refreshEndpoint">Refresh Management Endpoint</a>, however this will only apply if the physical location of certificate on disk has changed
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example the following will reload the previously listed HTTPS configuration from disk and apply it to new incoming requests (this code could run for a <a href="#scheduling">scheduled job</a> that polled certificates for changes for example):</p>
</div>
<div class="listingblock">
<div class="title">Manually Refreshing HTTPS configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Inject;
import io.micronaut.context.event.ApplicationEventPublisher;
import io.micronaut.runtime.context.scope.refresh.RefreshEvent;
import java.util.Collections;
...

@Inject ApplicationEventPublisher&lt;RefreshEvent&gt; eventPublisher;

...

eventPublisher.publishEvent(new RefreshEvent(
    Collections.singletonMap("micronaut.ssl", "*")
));</code></pre>
</div>
</div>
</div>
</div>

<h2 id="dualProtocol"><a class="anchor" href="#dualProtocol"></a>6.29.7 Enabling HTTP and HTTPS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/dualProtocol.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports binding both HTTP and HTTPS. To enable dual protocol support, modify your configuration. For example:</p>
</div>
<div class="openblock">
<div class="title">Dual Protocol Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.ssl.enabled=true
micronaut.server.ssl.build-self-signed=true
micronaut.server.dual-protocol=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    ssl:
      enabled: true
      build-self-signed: true
    dual-protocol : true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.ssl]
      enabled=true
      build-self-signed=true
    dual-protocol=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    ssl {
      enabled = true
      buildSelfSigned = true
    }
    dualProtocol = true
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      ssl {
        enabled = true
        build-self-signed = true
      }
      dual-protocol = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "ssl": {
        "enabled": true,
        "build-self-signed": true
      },
      "dual-protocol": true
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You must configure SSL for HTTPS to work. In this example we are just using a self-signed certificate with <code>build-self-signed</code>, but see <a href="#https">Securing the Server with HTTPS</a> for other configurations</p>
</li>
<li>
<p><code>dual-protocol</code> enables both HTTP and HTTPS is an opt-in feature - setting the <code>dualProtocol</code> flag enables it. By default Micronaut only enables one</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to redirect automatically all HTTP request to HTTPS. Besides the previous configuration, you need to enable this option. For example:</p>
</div>
<div class="openblock">
<div class="title">Enable HTTP to HTTPS Redirects</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.ssl.enabled=true
micronaut.server.ssl.build-self-signed=true
micronaut.server.dual-protocol=true
micronaut.server.http-to-https-redirect=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    ssl:
      enabled: true
      build-self-signed: true
    dual-protocol : true
    http-to-https-redirect: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.ssl]
      enabled=true
      build-self-signed=true
    dual-protocol=true
    http-to-https-redirect=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    ssl {
      enabled = true
      buildSelfSigned = true
    }
    dualProtocol = true
    httpToHttpsRedirect = true
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      ssl {
        enabled = true
        build-self-signed = true
      }
      dual-protocol = true
      http-to-https-redirect = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "ssl": {
        "enabled": true,
        "build-self-signed": true
      },
      "dual-protocol": true,
      "http-to-https-redirect": true
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>http-to-https-redirect</code> enables HTTP to HTTPS redirects</p>
</li>
</ul>
</div>

<h2 id="accessLogger"><a class="anchor" href="#accessLogger"></a>6.29.8 Enabling Access Logger</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/accessLogger.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In the spirit of <a href="https://httpd.apache.org/docs/current/mod/mod_log_config.html">apache mod_log_config</a> and <a href="https://tomcat.apache.org/tomcat-10.0-doc/config/valve.html#Access_Logging">Tomcat Access Log Valve</a>, it is possible to enable an access logger for the HTTP server (this works for both HTTP/1 and HTTP/2).</p>
</div>
<div class="paragraph">
<p>To enable and configure the access logger, in your configuration file (e.g <code>application.yml</code>) set:</p>
</div>
<div class="openblock">
<div class="title">Enabling the access logger</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.netty.access-logger.enabled=true
micronaut.server.netty.access-logger.logger-name=my-access-logger
micronaut.server.netty.access-logger.log-format=common</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    netty:
      access-logger:
        enabled: true
        logger-name: my-access-logger
        log-format: common</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.netty]
      [micronaut.server.netty.access-logger]
        enabled=true
        logger-name="my-access-logger"
        log-format="common"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    netty {
      accessLogger {
        enabled = true
        loggerName = "my-access-logger"
        logFormat = "common"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      netty {
        access-logger {
          enabled = true
          logger-name = "my-access-logger"
          log-format = "common"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "netty": {
        "access-logger": {
          "enabled": true,
          "logger-name": "my-access-logger",
          "log-format": "common"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> Enables the access logger</p>
</li>
<li>
<p>optionally specify a <code>logger-name</code>, which defaults to <code>HTTP_ACCESS_LOGGER</code></p>
</li>
<li>
<p>optionally specify a <code>log-format</code>, which defaults to the Common Log Format</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_filtering_access_logs">Filtering access logs</h4>
<div class="paragraph">
<p>If you wish to not log access to certain paths, you can specify regular expression filters in the configuration:</p>
</div>
<div class="openblock">
<div class="title">Filtering the access logs</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.server.netty.access-logger.enabled=true
micronaut.server.netty.access-logger.logger-name=my-access-logger
micronaut.server.netty.access-logger.log-format=common
micronaut.server.netty.access-logger.exclusions[0]=/health
micronaut.server.netty.access-logger.exclusions[1]=/path/.+</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  server:
    netty:
      access-logger:
        enabled: true
        logger-name: my-access-logger
        log-format: common
        exclusions:
          - /health
          - /path/.+</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.server]
    [micronaut.server.netty]
      [micronaut.server.netty.access-logger]
        enabled=true
        logger-name="my-access-logger"
        log-format="common"
        exclusions=[
          "/health",
          "/path/.+"
        ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  server {
    netty {
      accessLogger {
        enabled = true
        loggerName = "my-access-logger"
        logFormat = "common"
        exclusions = ["/health", "/path/.+"]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    server {
      netty {
        access-logger {
          enabled = true
          logger-name = "my-access-logger"
          log-format = "common"
          exclusions = ["/health", "/path/.+"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "server": {
      "netty": {
        "access-logger": {
          "enabled": true,
          "logger-name": "my-access-logger",
          "log-format": "common",
          "exclusions": ["/health", "/path/.+"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code> Enables the access logger</p>
</li>
<li>
<p>optionally specify a <code>logger-name</code>, which defaults to <code>HTTP_ACCESS_LOGGER</code></p>
</li>
<li>
<p>optionally specify a <code>log-format</code>, which defaults to the Common Log Format</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_logback_configuration">Logback Configuration</h4>
<div class="paragraph">
<p>In addition to enabling the access logger, you must add a logger for the specified or default logger name. For instance using the default logger name for logback:</p>
</div>
<div class="listingblock">
<div class="title">Logback configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;appender
    name="httpAccessLogAppender"
    class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
    &lt;append&gt;true&lt;/append&gt;
    &lt;file&gt;log/http-access.log&lt;/file&gt;
    &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
        &lt;!-- daily rollover --&gt;
        &lt;fileNamePattern&gt;log/http-access-%d{yyyy-MM-dd}.log
        &lt;/fileNamePattern&gt;
        &lt;maxHistory&gt;7&lt;/maxHistory&gt;
    &lt;/rollingPolicy&gt;
    &lt;encoder&gt;
        &lt;charset&gt;UTF-8&lt;/charset&gt;
        &lt;pattern&gt;%msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
    &lt;immediateFlush&gt;true&lt;/immediateFlush&gt;
&lt;/appender&gt;

&lt;logger name="HTTP_ACCESS_LOGGER" additivity="false" level="info"&gt;
    &lt;appender-ref ref="httpAccessLogAppender" /&gt;
&lt;/logger&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The pattern should only have the message marker, as other elements will be processed by the access logger.</p>
</div>
</div>
<div class="sect3">
<h4 id="_log_format">Log Format</h4>
<div class="paragraph">
<p>The syntax is based on <a href="https://httpd.apache.org/docs/current/mod/mod_log_config.html">Apache httpd log format</a>.</p>
</div>
<div class="paragraph">
<p>These are the supported markers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>%a</strong> - Remote IP address</p>
</li>
<li>
<p><strong>%A</strong> - Local IP address</p>
</li>
<li>
<p><strong>%b</strong> - Bytes sent, excluding HTTP headers, or '-' if no bytes were sent</p>
</li>
<li>
<p><strong>%B</strong> - Bytes sent, excluding HTTP headers</p>
</li>
<li>
<p><strong>%h</strong> - Remote host name</p>
</li>
<li>
<p><strong>%H</strong> - Request protocol</p>
</li>
<li>
<p><strong>%{&lt;header&gt;}i</strong> - Request header. If the argument is omitted (<strong>%i</strong>) all headers are printed</p>
</li>
<li>
<p><strong>%{&lt;header&gt;}o</strong> - Response header. If the argument is omitted (<strong>%o</strong>) all headers are printed</p>
</li>
<li>
<p><strong>%{&lt;cookie&gt;}C</strong> - Request cookie (COOKIE). If the argument is omitted (<strong>%C</strong>) all cookies are printed</p>
</li>
<li>
<p><strong>%{&lt;cookie&gt;}c</strong> - Response cookie (SET_COOKIE). If the argument is omitted (<strong>%c</strong>) all cookies are printed</p>
</li>
<li>
<p><strong>%l</strong> - Remote logical username from identd (always returns '-')</p>
</li>
<li>
<p><strong>%m</strong> - Request method</p>
</li>
<li>
<p><strong>%p</strong> - Local port</p>
</li>
<li>
<p><strong>%q</strong> - Query string (excluding the '?' character)</p>
</li>
<li>
<p><strong>%r</strong> - First line of the request</p>
</li>
<li>
<p><strong>%s</strong> - HTTP status code of the response</p>
</li>
<li>
<p><strong>%{&lt;format&gt;}t</strong> - Date and time. If the argument is omitted, Common Log Format is used ("'['dd/MMM/yyyy:HH:mm:ss Z']'").</p>
<div class="ulist">
<ul>
<li>
<p>If the format starts with begin: (default) the time is taken at the beginning of the request processing. If it starts with end: it is the time when the log entry gets written, close to the end of the request processing.</p>
</li>
<li>
<p>The format should follow <code>DateTimeFormatter</code> syntax.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>%{property}u</strong> - Remote authenticated user. When <strong>micronaut-session</strong> is on the classpath, returns the session id if the argument is omitted, or the specified property otherwise prints '-'</p>
</li>
<li>
<p><strong>%U</strong> - Requested URI</p>
</li>
<li>
<p><strong>%v</strong> - Local server name</p>
</li>
<li>
<p><strong>%D</strong> - Time taken to process the request, in milliseconds</p>
</li>
<li>
<p><strong>%T</strong> - Time taken to process the request, in seconds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, you can use the following aliases for common patterns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>common</strong> - <code>%h %l %u %t "%r" %s %b</code> for <a href="https://httpd.apache.org/docs/2.4/logs.html#common">Common Log Format</a> (CLF)</p>
</li>
<li>
<p><strong>combined</strong> - <code>%h %l %u %t "%r" %s %b "%{Referer}i" "%{User-Agent}i"</code> for <a href="https://httpd.apache.org/docs/2.4/logs.html#combined">Combined Log Format</a></p>
</li>
</ul>
</div>
</div>

<h2 id="secondaryServers"><a class="anchor" href="#secondaryServers"></a>6.29.9 Starting Secondary Servers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/serverConfiguration/secondaryServers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports the programmatic creation of additional Netty servers through the <a href="../api/io/micronaut/http/server/netty/NettyEmbeddedServerFactory.html">NettyEmbeddedServerFactory</a> interface.</p>
</div>
<div class="paragraph">
<p>This is useful in cases where you, for example, need to expose distinct servers over different ports with potentially differing configurations (HTTPS, thread resources etc.).</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to define a <a href="#factories">Factory Bean</a> that starts an additional server using a programmatically created configuration:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Programmatically creating Secondary servers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Collections;
import io.micronaut.context.annotation.Bean;
import io.micronaut.context.annotation.Context;
import io.micronaut.context.annotation.Factory;
import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.micronaut.core.util.StringUtils;
import io.micronaut.discovery.ServiceInstanceList;
import io.micronaut.discovery.StaticServiceInstanceList;
import io.micronaut.http.server.netty.NettyEmbeddedServer;
import io.micronaut.http.server.netty.NettyEmbeddedServerFactory;
import io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration;
import io.micronaut.http.ssl.ServerSslConfiguration;
import jakarta.inject.Named;

@Factory
public class SecondaryNettyServer {
    public static final String SERVER_ID = "another"; // <b class="conum">(1)</b>

    @Named(SERVER_ID)
    @Context
    @Bean(preDestroy = "close") // <b class="conum">(2)</b>
    @Requires(beans = Environment.class)
    NettyEmbeddedServer nettyEmbeddedServer(NettyEmbeddedServerFactory serverFactory) { // <b class="conum">(3)</b>
        // configure server programmatically
        final NettyHttpServerConfiguration configuration =
                new NettyHttpServerConfiguration(); // <b class="conum">(4)</b>
        final ServerSslConfiguration sslConfiguration = new ServerSslConfiguration(); // <b class="conum">(5)</b>
        sslConfiguration.setBuildSelfSigned(true);
        sslConfiguration.setEnabled(true);
        sslConfiguration.setPort(-1); // random port
        final NettyEmbeddedServer embeddedServer = serverFactory.build(configuration, sslConfiguration); // <b class="conum">(6)</b>
        embeddedServer.start(); // <b class="conum">(7)</b>
        return embeddedServer; // <b class="conum">(8)</b>
    }

    @Bean
    ServiceInstanceList serviceInstanceList( // <b class="conum">(9)</b>
            @Named(SERVER_ID) NettyEmbeddedServer nettyEmbeddedServer) {
        return new StaticServiceInstanceList(
                SERVER_ID,
                Collections.singleton(nettyEmbeddedServer.getURI())
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Programmatically creating Secondary servers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Context
import io.micronaut.context.annotation.Factory
import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.core.util.StringUtils
import io.micronaut.discovery.ServiceInstanceList
import io.micronaut.discovery.StaticServiceInstanceList
import io.micronaut.http.server.netty.NettyEmbeddedServer
import io.micronaut.http.server.netty.NettyEmbeddedServerFactory
import io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration
import io.micronaut.http.ssl.ServerSslConfiguration
import jakarta.inject.Named

@Factory
class SecondaryNettyServer {
    static final String SERVER_ID = "another" // <b class="conum">(1)</b>

    @Named(SERVER_ID)
    @Context
    @Bean(preDestroy = "stop") // <b class="conum">(2)</b>
    @Requires(beans = Environment.class)
    NettyEmbeddedServer nettyEmbeddedServer(NettyEmbeddedServerFactory serverFactory) { // <b class="conum">(3)</b>
        def configuration =
                new NettyHttpServerConfiguration() // <b class="conum">(4)</b>
        def sslConfiguration = new ServerSslConfiguration() // <b class="conum">(5)</b>
        sslConfiguration.setBuildSelfSigned(true)
        sslConfiguration.enabled = true
        sslConfiguration.port = -1 // random port
        // configure server programmatically
        final NettyEmbeddedServer embeddedServer = serverFactory.build(configuration, sslConfiguration) // <b class="conum">(5)</b>
        embeddedServer.start() // <b class="conum">(6)</b>
        return embeddedServer // <b class="conum">(7)</b>
    }

    @Bean
    ServiceInstanceList serviceInstanceList( // <b class="conum">(8)</b>
                                             @Named(SERVER_ID) NettyEmbeddedServer nettyEmbeddedServer) {
        return new StaticServiceInstanceList(
                SERVER_ID,
                [ nettyEmbeddedServer.URI ]
        )
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Programmatically creating Secondary servers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Bean
import io.micronaut.context.annotation.Context
import io.micronaut.context.annotation.Factory
import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.core.util.StringUtils
import io.micronaut.discovery.ServiceInstanceList
import io.micronaut.discovery.StaticServiceInstanceList
import io.micronaut.http.server.netty.NettyEmbeddedServer
import io.micronaut.http.server.netty.NettyEmbeddedServerFactory
import io.micronaut.http.server.netty.configuration.NettyHttpServerConfiguration
import io.micronaut.http.ssl.ServerSslConfiguration
import jakarta.inject.Named

@Factory
class SecondaryNettyServer {
    companion object {
        const val SERVER_ID = "another" // <b class="conum">(1)</b>
    }

    @Named(SERVER_ID)
    @Context
    @Bean(preDestroy = "close") // <b class="conum">(2)</b>
    @Requires(beans = [Environment::class])
    fun nettyEmbeddedServer(
        serverFactory: NettyEmbeddedServerFactory // <b class="conum">(3)</b>
    ) : NettyEmbeddedServer {
        val configuration = NettyHttpServerConfiguration() // <b class="conum">(4)</b>
        val sslConfiguration = ServerSslConfiguration() // <b class="conum">(5)</b>

        sslConfiguration.setBuildSelfSigned(true)
        sslConfiguration.isEnabled = true
        sslConfiguration.port = -1 // random port

        // configure server programmatically
        val embeddedServer = serverFactory.build(configuration, sslConfiguration) // <b class="conum">(6)</b>
        embeddedServer.start() // <b class="conum">(7)</b>
        return embeddedServer // <b class="conum">(8)</b>
    }

    @Bean
    fun serviceInstanceList( // <b class="conum">(9)</b>
        @Named(SERVER_ID) nettyEmbeddedServer: NettyEmbeddedServer
    ): ServiceInstanceList {
        return StaticServiceInstanceList(
            SERVER_ID, setOf(nettyEmbeddedServer.uri)
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define a unique name for the server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> scoped bean using the server name and including <code>preDestroy="close"</code> to ensure the server is shutdown when the context is closed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the <a href="../api/io/micronaut/http/server/netty/NettyEmbeddedServerFactory.html">NettyEmbeddedServerFactory</a> into a <a href="#factories">Factory Bean</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Programmatically create the <a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optionally create the <a href="../api/io/micronaut/http/ssl/ServerSslConfiguration.html">ServerSslConfiguration</a></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use the <code>build</code> method to build the server instance</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Start the server with the <code>start</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Return the server instance as a managed bean</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Optionally define an instance of <a href="../api/io/micronaut/discovery/ServiceInstanceList.html">ServiceInstanceList</a> if you wish to inject <a href="#httpClient">HTTP Clients</a> by the server name</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this class in place when the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> starts the server will also be started with the appropriate configuration.</p>
</div>
<div class="paragraph">
<p>Thanks to the definition of the <a href="../api/io/micronaut/discovery/ServiceInstanceList.html">ServiceInstanceList</a> in step 8, you can then inject a client into your tests to test the secondary server:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Injecting the server or client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(path = "/", id = SecondaryNettyServer.SERVER_ID)
@Inject
HttpClient httpClient; // <b class="conum">(1)</b>

@Named(SecondaryNettyServer.SERVER_ID)
EmbeddedServer embeddedServer; // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Injecting the server or client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Client(path = "/", id = SecondaryNettyServer.SERVER_ID)
@Inject
HttpClient httpClient // <b class="conum">(1)</b>

@Named(SecondaryNettyServer.SERVER_ID)
EmbeddedServer embeddedServer // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Injecting the server or client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Inject
@field:Client(path = "/", id = SecondaryNettyServer.SERVER_ID)
lateinit var httpClient : HttpClient // <b class="conum">(1)</b>

@Inject
@field:Named(SecondaryNettyServer.SERVER_ID)
lateinit var embeddedServer : EmbeddedServer // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use the server name to inject a client by ID</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>@Named</code> annotation as a qualifier to inject the embedded server instance</td>
</tr>
</table>
</div>

<h2 id="views"><a class="anchor" href="#views"></a>6.30 Server Side View Rendering</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/views.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports Server Side View Rendering.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-views/latest/guide">Micronaut Views</a> for more information.</p>
</div>

<h2 id="openapi"><a class="anchor" href="#openapi"></a>6.31 OpenAPI / Swagger Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/openapi.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure Micronaut integration with <a href="https://swagger.io/docs/specification/about/">OpenAPI/Swagger</a>, please follow
<a href="https://micronaut-projects.github.io/micronaut-openapi/latest/guide/index.html">these instructions</a></p>
</div>

<h2 id="graphql"><a class="anchor" href="#graphql"></a>6.32 GraphQL Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpServer/graphql.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://graphql.org/">GraphQL</a> is a query language for building APIs that provides an intuitive and flexible syntax and a system for describing data requirements and interactions.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-graphql/latest/guide">Micronaut GraphQL</a> for more information on how to build GraphQL applications with Micronaut.</p>
</div>

<h1 id="httpClient"><a class="anchor" href="#httpClient"></a>7 The HTTP Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, the <code>http-client</code> dependency is included by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Client communication between Microservices is a critical component of any Microservice architecture. With that in mind, Micronaut includes an HTTP client that has both a low-level API and a higher-level AOP-driven API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Regardless whether you choose to use Micronaut&#8217;s HTTP server, you may wish to use the Micronaut HTTP client in your application since it is a feature-rich client implementation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the HTTP client, add the <code>http-client</code> dependency to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Since the higher level API is built on the low-level HTTP client, we first introduce the low-level client.</p>
</div>

<h2 id="lowLevelHttpClient"><a class="anchor" href="#lowLevelHttpClient"></a>7.1 Using the Low-Level HTTP Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface forms the basis for the low-level API. This interfaces declares methods to help ease executing HTTP requests and receiving responses.</p>
</div>
<div class="paragraph">
<p>The majority of the methods in the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface return Reactive Streams <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> instances, which is not always the most useful interface to work against.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s Reactor HTTP Client dependency ships with a sub-interface named <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/api/io/micronaut/reactor/http/client/ReactorHttpClient.html">ReactorHttpClient</a>. It provides a variation of the <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> interface that returns <a href="https://projectreactor.io">Project Reactor</a> <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> types.</p>
</div>

<h2 id="clientBasics"><a class="anchor" href="#clientBasics"></a>7.1.1 Sending your first HTTP request</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientBasics.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_obtaining_a_httpclient">Obtaining a HttpClient</h4>
<div class="paragraph">
<p>There are a few ways to obtain a reference to an <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>. The most common is to use the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("https://api.twitter.com/1.1") @Inject HttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example injects a client that targets the Twitter API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@field:Client("\${myapp.api.twitter.url}") @Inject lateinit var httpClient: HttpClient</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above Kotlin example injects a client that targets the Twitter API using a configuration path. Note the required escaping (backslash) on <code>"\${path.to.config}"</code> which is necessary due to Kotlin string interpolation.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is also a custom scope that manages the creation of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> instances and ensures they are stopped when the application shuts down.</p>
</div>
<div class="paragraph">
<p>The value you pass to the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An absolute URI, e.g. <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the targeted server will be the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Another way to create an <code>HttpClient</code> is with the static <code>create</code> method of <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a>, however this approach is not recommended as you must ensure you manually shutdown the client, and of course no dependency injection will occur for the created client.</p>
</div>
</div>
<div class="sect3">
<h4 id="_performing_an_http_get">Performing an HTTP GET</h4>
<div class="paragraph">
<p>Generally there are two methods of interest when working with the <code>HttpClient</code>. The first is <code>retrieve</code>, which executes an HTTP request and returns the body in whichever type you request (by default a <code>String</code>) as <code>Publisher</code>.</p>
</div>
<div class="paragraph">
<p>The <code>retrieve</code> method accepts an <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> or a <code>String</code> URI to the endpoint you wish to request.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>retrieve</code> to execute an HTTP <code>GET</code> and receive the response body as a <code>String</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String uri = UriBuilder.of("/hello/{name}")
                       .expand(Collections.singletonMap("name", "John"))
                       .toString();
assertEquals("/hello/John", uri);

String result = client.toBlocking().retrieve(uri);

assertEquals("Hello John", result);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
String uri = UriBuilder.of("/hello/{name}")
                       .expand(name: "John")
then:
"/hello/John" == uri

when:
String result = client.toBlocking().retrieve(uri)

then:
"Hello John" == result</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using retrieve</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val uri = UriBuilder.of("/hello/{name}")
                    .expand(Collections.singletonMap("name", "John"))
                    .toString()
uri shouldBe "/hello/John"

val result = client.toBlocking().retrieve(uri)

result shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this example, for illustration purposes we call <code>toBlocking()</code> to return a blocking version of the client. However, in production code you should not do this and instead rely on the non-blocking nature of the Micronaut HTTP server.</p>
</div>
<div class="paragraph">
<p>For example the following <code>@Controller</code> method calls another endpoint in a non-blocking manner:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.annotation.Status;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.client.annotation.Client;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;
import io.micronaut.core.async.annotation.SingleResult;
import static io.micronaut.http.HttpRequest.GET;
import static io.micronaut.http.HttpStatus.CREATED;
import static io.micronaut.http.MediaType.TEXT_PLAIN;

@Get("/hello/{name}")
@SingleResult
Publisher&lt;String&gt; hello(String name) { // <b class="conum">(1)</b>
    return Mono.from(httpClient.retrieve(GET("/hello/" + name))); // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.http.annotation.Status
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher
import io.micronaut.core.async.annotation.SingleResult
import reactor.core.publisher.Mono
import static io.micronaut.http.HttpRequest.GET
import static io.micronaut.http.HttpStatus.CREATED
import static io.micronaut.http.MediaType.TEXT_PLAIN

@Get("/hello/{name}")
@SingleResult
Publisher&lt;String&gt; hello(String name) { // <b class="conum">(1)</b>
    Mono.from(httpClient.retrieve( GET("/hello/" + name))) // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Using the HTTP client without blocking</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpRequest.GET
import io.micronaut.http.HttpStatus.CREATED
import io.micronaut.http.MediaType.TEXT_PLAIN
import io.micronaut.http.annotation.Body
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Post
import io.micronaut.http.annotation.Status
import io.micronaut.http.client.HttpClient
import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux
import io.micronaut.core.async.annotation.SingleResult

@Get("/hello/{name}")
@SingleResult
internal fun hello(name: String): Publisher&lt;String&gt; { // <b class="conum">(1)</b>
    return Flux.from(httpClient.retrieve(GET&lt;Any&gt;("/hello/$name")))
                     .next() // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>hello</code> method returns a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a> which may or may not emit an item. If an item is not emitted, a 404 is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>retrieve</code> method is called which returns a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a>. This has a <code>firstElement</code> method that returns the first emitted item or nothing</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using Reactor (or RxJava if you prefer) you can easily and efficiently compose multiple HTTP client calls without blocking (which limits the throughput and scalability of your application).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_tracing_the_http_client">Debugging / Tracing the HTTP Client</h4>
<div class="paragraph">
<p>To debug requests being sent and received from the HTTP client you can enable tracing logging via your <code>logback.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="io.micronaut.http.client" level="TRACE"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client_specific_debugging_tracing">Client Specific Debugging / Tracing</h4>
<div class="paragraph">
<p>To enable client-specific logging you can configure the default logger for all HTTP clients. You can also configure different loggers for different clients using <a href="#_client_specific_configuration">Client-Specific Configuration</a>. For example, in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.logger-name=mylogger
micronaut.http.services.otherClient.logger-name=other.client</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      logger-name: mylogger
    services:
      otherClient:
        logger-name: other.client</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      logger-name="mylogger"
    [micronaut.http.services]
      [micronaut.http.services.otherClient]
        logger-name="other.client"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      loggerName = "mylogger"
    }
    services {
      otherClient {
        loggerName = "other.client"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        logger-name = "mylogger"
      }
      services {
        otherClient {
          logger-name = "other.client"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "logger-name": "mylogger"
      },
      "services": {
        "otherClient": {
          "logger-name": "other.client"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Then enable logging in <code>logback.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;logger name="mylogger" level="DEBUG"/&gt;
&lt;logger name="other.client" level="TRACE"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_http_request">Customizing the HTTP Request</h4>
<div class="paragraph">
<p>The previous example demonstrates using the static methods of the <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface to construct a <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> instance. Like the name suggests, a <code>MutableHttpRequest</code> can be mutated, including the ability to add headers, customize the request body, etc. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;String&gt; response = Flux.from(client.retrieve(
        GET("/hello/John")
        .header("X-My-Header", "SomeValue")
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Flux&lt;String&gt; response = Flux.from(client.retrieve(
        GET("/hello/John")
        .header("X-My-Header", "SomeValue")
))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Passing an HttpRequest to retrieve</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val response = client.retrieve(
        GET&lt;Any&gt;("/hello/John")
                .header("X-My-Header", "SomeValue")
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example adds a header (<code>X-My-Header</code>) to the response before it is sent. The <a href="../api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> interface has more convenience methods that make it easy to modify the request in common ways.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading_json_responses">Reading JSON Responses</h4>
<div class="paragraph">
<p>Microservices typically use a message encoding format such as JSON. Micronaut&#8217;s HTTP client leverages Jackson for JSON parsing, hence any type Jackson can decode can be passed as a second argument to <code>retrieve</code>.</p>
</div>
<div class="paragraph">
<p>For example consider the following <code>@Controller</code> method that returns a JSON response:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get("/greet/{name}")
Message greet(String name) {
    return new Message("Hello " + name);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get("/greet/{name}")
Message greet(String name) {
    new Message("Hello $name")
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Returning JSON from a controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/greet/{name}")
internal fun greet(name: String): Message {
    return Message("Hello $name")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method above returns a POJO of type <code>Message</code> which looks like:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonProperty;

public class Message {

    private final String text;

    @JsonCreator
    public Message(@JsonProperty("text") String text) {
        this.text = text;
    }

    public String getText() {
        return text;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.fasterxml.jackson.annotation.JsonCreator
import com.fasterxml.jackson.annotation.JsonProperty

class Message {

    final String text

    @JsonCreator
    Message(@JsonProperty("text") String text) {
        this.text = text
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Message POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import com.fasterxml.jackson.annotation.JsonCreator
import com.fasterxml.jackson.annotation.JsonProperty

class Message @JsonCreator
constructor(@param:JsonProperty("text") val text: String)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jackson annotations are used to map the constructor
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the client you can call this endpoint and decode the JSON into a map using the <code>retrieve</code> method as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;Map&gt; response = Flux.from(client.retrieve(
        GET("/greet/John"), Map.class
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Flux&lt;Map&gt; response = Flux.from(client.retrieve(
        GET("/greet/John"), Map
))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">var response: Flux&lt;Map&lt;*, *&gt;&gt; = Flux.from(client.retrieve(
        GET&lt;Any&gt;("/greet/John"), Map::class.java
))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example decodes the response into a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html">Map</a> representing the JSON. You can use the <code>Argument.of(..)</code> method to customize the type of the key and value:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">response = Flux.from(client.retrieve(
        GET("/greet/John"),
        Argument.of(Map.class, String.class, String.class) // <b class="conum">(1)</b>
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">response = Flux.from(client.retrieve(
        GET("/greet/John"),
        Argument.of(Map, String, String) // <b class="conum">(1)</b>
))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a Map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">response = Flux.from(client.retrieve(
        GET&lt;Any&gt;("/greet/John"),
        Argument.of(Map::class.java, String::class.java, String::class.java) // <b class="conum">(1)</b>
))</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Argument.of</code> method returns a <code>Map</code> where the key and value types are <code>String</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whilst retrieving JSON as a map can be desirable, typically you want to decode objects into POJOs. To do that, pass the type instead:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;Message&gt; response = Flux.from(client.retrieve(
        GET("/greet/John"), Message.class
));

assertEquals("Hello John", response.blockFirst().getText());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
Flux&lt;Message&gt; response = Flux.from(client.retrieve(
        GET("/greet/John"), Message
))

then:
"Hello John" == response.blockFirst().getText()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Decoding the response body to a POJO</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val response = Flux.from(client.retrieve(
        GET&lt;Any&gt;("/greet/John"), Message::class.java
))

response.blockFirst().text shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how you can use the same Java type on both the client and the server. The implication of this is that typically you define a common API project where you define the interfaces and types that define your API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_decoding_other_content_types">Decoding Other Content Types</h4>
<div class="paragraph">
<p>If the server you communicate with uses a custom content type that is not JSON, by default Micronaut&#8217;s HTTP client will not know how to decode this type.</p>
</div>
<div class="paragraph">
<p>To resolve this, register <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> as a bean, and it will be automatically picked up and used to decode (or encode) messages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_receiving_the_full_http_response">Receiving the Full HTTP Response</h4>
<div class="paragraph">
<p>Sometimes receiving just the body of the response is not enough, and you need other information from the response such as headers, cookies, etc. In this case, instead of <code>retrieve</code> use the <code>exchange</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving the Full HTTP Response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;HttpResponse&lt;Message&gt;&gt; call = Flux.from(client.exchange(
        GET("/greet/John"), Message.class // <b class="conum">(1)</b>
));

HttpResponse&lt;Message&gt; response = call.blockFirst();
Optional&lt;Message&gt; message = response.getBody(Message.class); // <b class="conum">(2)</b>
// check the status
assertEquals(HttpStatus.OK, response.getStatus()); // <b class="conum">(3)</b>
// check the body
assertTrue(message.isPresent());
assertEquals("Hello John", message.get().getText());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving the Full HTTP Response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">when:
Flux&lt;HttpResponse&lt;Message&gt;&gt; call = Flux.from(client.exchange(
        GET("/greet/John"), Message // <b class="conum">(1)</b>
))

HttpResponse&lt;Message&gt; response = call.blockFirst();
Optional&lt;Message&gt; message = response.getBody(Message) // <b class="conum">(2)</b>
// check the status
then:
HttpStatus.OK == response.getStatus() // <b class="conum">(3)</b>
// check the body
message.isPresent()
"Hello John" == message.get().getText()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Receiving the Full HTTP Response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val call = client.exchange(
        GET&lt;Any&gt;("/greet/John"), Message::class.java // <b class="conum">(1)</b>
)

val response = Flux.from(call).blockFirst()
val message = response.getBody(Message::class.java) // <b class="conum">(2)</b>
// check the status
response.status shouldBe HttpStatus.OK // <b class="conum">(3)</b>
// check the body
message.isPresent shouldBe true
message.get().text shouldBe "Hello John"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>exchange</code> method receives the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The body is retrieved using the <code>getBody(..)</code> method of the response</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Other aspects of the response such as the <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> can be checked</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example receives the full <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> from which you can obtain headers and other useful information.</p>
</div>
</div>

<h2 id="clientPostRequests"><a class="anchor" href="#clientPostRequests"></a>7.1.2 Posting a Request Body</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientPostRequests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>All the examples so far have used the same HTTP method i.e <code>GET</code>. The <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> interface has factory methods for all the different HTTP methods. The following table summarizes them:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. HttpRequest Factory Methods</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Allows Body</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#GET-java.lang.String-">HttpRequest.GET(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>GET</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#OPTIONS-java.lang.String-">HttpRequest.OPTIONS(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>OPTIONS</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#HEAD-java.lang.String-">HttpRequest.HEAD(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>HEAD</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#POST-java.lang.String-T-">HttpRequest.POST(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>POST</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PUT-java.lang.String-T-">HttpRequest.PUT(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PUT</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#PATCH-java.lang.String-T-">HttpRequest.PATCH(java.lang.String,T)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>PATCH</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpRequest.html#DELETE-java.lang.String-">HttpRequest.DELETE(java.lang.String)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constructs an HTTP <code>DELETE</code> request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <code>create</code> method also exists to construct a request for any <a href="../api/io/micronaut/http/HttpMethod.html">HttpMethod</a> type. Since the <code>POST</code>, <code>PUT</code> and <code>PATCH</code> methods require a body, a second argument which is the body object is required.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to send a simple <code>String</code> body:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;HttpResponse&lt;String&gt;&gt; call = Flux.from(client.exchange(
        POST("/hello", "Hello John") // <b class="conum">(1)</b>
            .contentType(MediaType.TEXT_PLAIN_TYPE)
            .accept(MediaType.TEXT_PLAIN_TYPE), // <b class="conum">(2)</b>
        String.class // <b class="conum">(3)</b>
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Flux&lt;HttpResponse&lt;String&gt;&gt; call = Flux.from(client.exchange(
        POST("/hello", "Hello John") // <b class="conum">(1)</b>
            .contentType(MediaType.TEXT_PLAIN_TYPE)
            .accept(MediaType.TEXT_PLAIN_TYPE), // <b class="conum">(2)</b>
        String // <b class="conum">(3)</b>
))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a <code>String</code> body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val call = client.exchange(
        POST("/hello", "Hello John") // <b class="conum">(1)</b>
                .contentType(MediaType.TEXT_PLAIN_TYPE)
                .accept(MediaType.TEXT_PLAIN_TYPE), String::class.java // <b class="conum">(3)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>POST</code> method is used; the first argument is the URI and the second is the body</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The content type and accepted type are set to <code>text/plain</code> (the default is <code>application/json</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The expected response type is a <code>String</code></td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_sending_json">Sending JSON</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous example sends plain text. To send JSON, pass the object to encode to JSON (whether that be a Map or a POJO) as long as Jackson is able to encode it.</p>
</div>
<div class="paragraph">
<p>For example, you can create a <code>Message</code> from the previous section and pass it to the <code>POST</code> method:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;HttpResponse&lt;Message&gt;&gt; call = Flux.from(client.exchange(
        POST("/greet", new Message("Hello John")), // <b class="conum">(1)</b>
        Message.class // <b class="conum">(2)</b>
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Flux&lt;HttpResponse&lt;Message&gt;&gt; call = Flux.from(client.exchange(
        POST("/greet", new Message("Hello John")), // <b class="conum">(1)</b>
        Message // <b class="conum">(2)</b>
))</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val call = client.exchange(
        POST("/greet", Message("Hello John")), Message::class.java // <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An instance of <code>Message</code> is created and passed to the <code>POST</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The same class decodes the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the above example the following JSON is sent as the body of the request:</p>
</div>
<div class="listingblock">
<div class="title">Resulting JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"text":"Hello John"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON can be customized using <a href="https://github.com/FasterXML/jackson-annotations">Jackson Annotations</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_uri_template">Using a URI Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If include some properties of the object in the URI, you can use a URI template.</p>
</div>
<div class="paragraph">
<p>For example imagine you have a <code>Book</code> class with a <code>title</code> property. You can include the <code>title</code> in the URI template and then populate it from an instance of <code>Book</code>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;HttpResponse&lt;Book&gt;&gt; call = Flux.from(client.exchange(
        POST("/amazon/book/{title}", new Book("The Stand")),
        Book.class
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Flux&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
        POST("/amazon/book/{title}", new Book("The Stand")),
        Book
);</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a JSON body with a URI template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val call = client.exchange(
        POST("/amazon/book/{title}", Book("The Stand")),
        Book::class.java
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case the <code>title</code> property is included in the URI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_form_data">Sending Form Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also encode a POJO or a map as form data instead of JSON. Just set the content type to <code>application/x-www-form-urlencoded</code> on the post request:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;HttpResponse&lt;Book&gt;&gt; call = Flux.from(client.exchange(
        POST("/amazon/book/{title}", new Book("The Stand"))
        .contentType(MediaType.APPLICATION_FORM_URLENCODED),
        Book.class
));</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Flux&lt;HttpResponse&lt;Book&gt;&gt; call = client.exchange(
        POST("/amazon/book/{title}", new Book("The Stand"))
        .contentType(MediaType.APPLICATION_FORM_URLENCODED),
        Book
)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Sending a Form Data</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val call = client.exchange(
        POST("/amazon/book/{title}", Book("The Stand"))
                .contentType(MediaType.APPLICATION_FORM_URLENCODED),
        Book::class.java
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Jackson can bind form data too, so to customize the binding process use <a href="https://github.com/FasterXML/jackson-annotations">Jackson annotations</a>.</p>
</div>
</div>
</div>

<h2 id="clientUploads"><a class="anchor" href="#clientUploads"></a>7.1.3 Multipart Client Uploads</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientUploads.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP Client supports multipart requests. To build a multipart request, set the content type to <code>multipart/form-data</code> and set the body to an instance of <a href="../api/io/micronaut/http/client/multipart/MultipartBody.html">MultipartBody</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.client.multipart.MultipartBody;

String toWrite = "test file";
File file = File.createTempFile("data", ".txt");
FileWriter writer = new FileWriter(file);
writer.write(toWrite);
writer.close();

MultipartBody requestBody = MultipartBody.builder()     // <b class="conum">(1)</b>
        .addPart(                                       // <b class="conum">(2)</b>
            "data",
            file.getName(),
            MediaType.TEXT_PLAIN_TYPE,
            file
        ).build();                                      // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.multipart.CompletedFileUpload
import io.micronaut.http.multipart.StreamingFileUpload
import io.micronaut.http.client.multipart.MultipartBody
import org.reactivestreams.Publisher

File file = new File(uploadDir, "data.txt")
file.text = "test file"
file.createNewFile()


MultipartBody requestBody = MultipartBody.builder()     // <b class="conum">(1)</b>
        .addPart(                                       // <b class="conum">(2)</b>
            "data",
            file.name,
            MediaType.TEXT_PLAIN_TYPE,
            file
        ).build()                                       // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating the body</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.client.multipart.MultipartBody

val toWrite = "test file"
val file = File.createTempFile("data", ".txt")
val writer = FileWriter(file)
writer.write(toWrite)
writer.close()

val requestBody = MultipartBody.builder()     // <b class="conum">(1)</b>
        .addPart(                             // <b class="conum">(2)</b>
                "data",
                file.name,
                MediaType.TEXT_PLAIN_TYPE,
                file
        ).build()                             // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a MultipartBody builder for adding parts to the body.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add a part to the body, in this case a file. There are different variations of this method in <a href="../api/io/micronaut/http/client/multipart/MultipartBody.Builder.html" target="_blank" rel="noopener">MultipartBody.Builder</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The build method assembles all parts from the builder into a MultipartBody. At least one part is required.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HttpRequest.POST("/multipart/upload", requestBody)    // <b class="conum">(1)</b>
           .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">HttpRequest.POST("/multipart/upload", requestBody)      // <b class="conum">(1)</b>
           .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Creating a request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">HttpRequest.POST("/multipart/upload", requestBody)    // <b class="conum">(1)</b>
           .contentType(MediaType.MULTIPART_FORM_DATA_TYPE) // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The multipart request body with different types of data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the content-type header of the request to <code>multipart/form-data</code>.</td>
</tr>
</table>
</div>

<h2 id="clientStreaming"><a class="anchor" href="#clientStreaming"></a>7.1.4 Streaming JSON over HTTP</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientStreaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s HTTP client includes support for streaming data over HTTP via the <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/api/io/micronaut/reactor/http/client/ReactorStreamingHttpClient.html">ReactorStreamingHttpClient</a> interface which includes methods specific to streaming including:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. HTTP Streaming Methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a stream of data as a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exchangeStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> wrapping a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> of <a href="../api/io/micronaut/core/io/buffer/ByteBuffer.html">ByteBuffer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsonStream(HttpRequest&lt;I&gt; request)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a non-blocking stream of JSON objects</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To use JSON streaming, declare a controller method on the server that returns a <code>application/x-json-stream</code> of JSON objects. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;
import java.time.Duration;
import java.time.ZonedDateTime;
import java.time.temporal.ChronoUnit;

@Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) // <b class="conum">(1)</b>
Publisher&lt;Headline&gt; streamHeadlines() {
    return Mono.fromCallable(() -&gt; {  // <b class="conum">(2)</b>
        Headline headline = new Headline();
        headline.setText("Latest Headline at " + ZonedDateTime.now());
        return headline;
    }).repeat(100) // <b class="conum">(3)</b>
      .delayElements(Duration.of(1, ChronoUnit.SECONDS)); // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import reactor.core.publisher.Flux
import reactor.core.publisher.Mono

import java.time.Duration
import java.time.ZonedDateTime
import java.time.temporal.ChronoUnit
import java.util.concurrent.TimeUnit

@Get(value = "/headlines", processes = MediaType.APPLICATION_JSON_STREAM) // <b class="conum">(1)</b>
Flux&lt;Headline&gt; streamHeadlines() {
    Mono.fromCallable({ // <b class="conum">(2)</b>
        new Headline(text: "Latest Headline at ${ZonedDateTime.now()}")
    }).repeat(100) // <b class="conum">(3)</b>
            .delayElements(Duration.of(1, ChronoUnit.SECONDS)) // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType.APPLICATION_JSON_STREAM
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import reactor.core.publisher.Flux
import reactor.core.publisher.Mono
import java.time.Duration
import java.time.ZonedDateTime
import java.time.temporal.ChronoUnit
import java.util.concurrent.TimeUnit.SECONDS

@Get(value = "/headlines", processes = [APPLICATION_JSON_STREAM]) // <b class="conum">(1)</b>
internal fun streamHeadlines(): Flux&lt;Headline&gt; {
    return Mono.fromCallable { // <b class="conum">(2)</b>
        val headline = Headline()
        headline.text = "Latest Headline at ${ZonedDateTime.now()}"
        headline
    }.repeat(100) // <b class="conum">(3)</b>
     .delayElements(Duration.of(1, ChronoUnit.SECONDS)) // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>streamHeadlines</code> method produces <code>application/x-json-stream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> is created from a <code>Callable</code> function (note no blocking occurs within the function, so this is ok, otherwise you should <code>subscribeOn</code> an I/O thread pool).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> repeats 100 times</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> emits items with a delay of one second between each</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The server does not have to be written in Micronaut, any server that supports JSON streaming will do.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then on the client, subscribe to the stream using <code>jsonStream</code> and every time the server emits a JSON object the client will decode and consume it:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Flux&lt;Headline&gt; headlineStream = Flux.from(client.jsonStream(
        GET("/streaming/headlines"), Headline.class)); // <b class="conum">(1)</b>
CompletableFuture&lt;Headline&gt; future = new CompletableFuture&lt;&gt;(); // <b class="conum">(2)</b>
headlineStream.subscribe(new Subscriber&lt;Headline&gt;() {
    @Override
    public void onSubscribe(Subscription s) {
        s.request(1); // <b class="conum">(3)</b>
    }

    @Override
    public void onNext(Headline headline) {
        System.out.println("Received Headline = " + headline.getText());
        future.complete(headline); // <b class="conum">(4)</b>
    }

    @Override
    public void onError(Throwable t) {
        future.completeExceptionally(t); // <b class="conum">(5)</b>
    }

    @Override
    public void onComplete() {
        // no-op // <b class="conum">(6)</b>
    }
});</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Flux&lt;Headline&gt; headlineStream = Flux.from(client.jsonStream(
        GET("/streaming/headlines"), Headline)) // <b class="conum">(1)</b>
CompletableFuture&lt;Headline&gt; future = new CompletableFuture&lt;&gt;() // <b class="conum">(2)</b>
headlineStream.subscribe(new Subscriber&lt;Headline&gt;() {
    @Override
    void onSubscribe(Subscription s) {
        s.request(1) // <b class="conum">(3)</b>
    }

    @Override
    void onNext(Headline headline) {
        println "Received Headline = $headline.text"
        future.complete(headline) // <b class="conum">(4)</b>
    }

    @Override
    void onError(Throwable t) {
        future.completeExceptionally(t) // <b class="conum">(5)</b>
    }

    @Override
    void onComplete() {
        // no-op // <b class="conum">(6)</b>
    }
})</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val headlineStream = client.jsonStream(
    GET&lt;Any&gt;("/streaming/headlines"), Headline::class.java) // <b class="conum">(1)</b>
val future = CompletableFuture&lt;Headline&gt;() // <b class="conum">(2)</b>
headlineStream.subscribe(object : Subscriber&lt;Headline&gt; {
    override fun onSubscribe(s: Subscription) {
        s.request(1) // <b class="conum">(3)</b>
    }

    override fun onNext(headline: Headline) {
        println("Received Headline = ${headline.text!!}")
        future.complete(headline) // <b class="conum">(4)</b>
    }

    override fun onError(t: Throwable) {
        future.completeExceptionally(t) // <b class="conum">(5)</b>
    }

    override fun onComplete() {
        // no-op // <b class="conum">(6)</b>
    }
})</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>jsonStream</code> method returns a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>CompletableFuture</code> is used to receive a value, but what you do with each emitted item is application-specific</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Subscription.html">Subscription</a> requests a single item. You can use the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Subscription.html">Subscription</a> to regulate back pressure and demand.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>onNext</code> method is called when an item is emitted</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>onError</code> method is called when an error occurs</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>onComplete</code> method is called when all <code>Headline</code> instances have been emitted</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note neither the server nor the client in the example above perform any blocking I/O.</p>
</div>

<h2 id="clientConfiguration"><a class="anchor" href="#clientConfiguration"></a>7.1.5 Configuring HTTP clients</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient/clientConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_global_configuration_for_all_clients">Global Configuration for All Clients</h3>
<div class="paragraph">
<p>The default HTTP client configuration is a <a href="#configurationProperties">Configuration Properties</a> named <a href="../api/io/micronaut/http/client/DefaultHttpClientConfiguration.html">DefaultHttpClientConfiguration</a> that allows configuring the default behaviour for all HTTP clients. For example, in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Altering default HTTP client configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.read-timeout=5s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      read-timeout: 5s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      read-timeout="5s"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      readTimeout = "5s"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        read-timeout = "5s"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "read-timeout": "5s"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example sets the <code>readTimeout</code> property of the <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_client_specific_configuration">Client Specific Configuration</h3>
<div class="paragraph">
<p>To have separate configuration per-client, there are a couple of options. You can configure <a href="#serviceDiscoveryManual">Service Discovery</a> manually in your configuration file (e.g <code>application.yml</code>) and apply per-client configuration:</p>
</div>
<div class="openblock">
<div class="title">Manually configuring HTTP services</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.services.foo.urls[0]=http://foo1
micronaut.http.services.foo.urls[1]=http://foo2
micronaut.http.services.foo.read-timeout=5s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    services:
      foo:
        urls:
          - http://foo1
          - http://foo2
        read-timeout: 5s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.services]
      [micronaut.http.services.foo]
        urls=[
          "http://foo1",
          "http://foo2"
        ]
        read-timeout="5s"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    services {
      foo {
        urls = ["http://foo1", "http://foo2"]
        readTimeout = "5s"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      services {
        foo {
          urls = ["http://foo1", "http://foo2"]
          read-timeout = "5s"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "services": {
        "foo": {
          "urls": ["http://foo1", "http://foo2"],
          "read-timeout": "5s"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>read-timeout</code> is applied to the <code>foo</code> client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WARN: This client configuration can be used in conjunction with the <code>@Client</code> annotation, either by injecting an <code>HttpClient</code> directly or use on a client interface. In any case, all other attributes on the annotation <strong>will be ignored</strong> except the service id.</p>
</div>
<div class="paragraph">
<p>Then, inject the named client configuration:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("foo") @Inject ReactorHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define a bean that extends from <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> and ensure that the <code>javax.inject.Named</code> annotation names it appropriately:</p>
</div>
<div class="listingblock">
<div class="title">Defining an HTTP client configuration bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("twitter")
@Singleton
class TwitterHttpClientConfiguration extends HttpClientConfiguration {
   public TwitterHttpClientConfiguration(ApplicationConfiguration configuration) {
        super(configuration);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration will be picked up if you inject a service named <code>twitter</code> with <code>@Client</code> using <a href="#serviceDiscovery">Service Discovery</a>:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("twitter") @Inject ReactorHttpClient httpClient;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you don&#8217;t use service discovery you can use the <code>configuration</code> member of <code>@Client</code> to refer to a specific type:</p>
</div>
<div class="listingblock">
<div class="title">Injecting an HTTP client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(value = "https://api.twitter.com/1.1",
        configuration = TwitterHttpClientConfiguration.class)
@Inject
ReactorHttpClient httpClient;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_http_client_connection_pooling">Using HTTP Client Connection Pooling</h3>
<div class="paragraph">
<p>A client that handles a significant number of requests will benefit from enabling HTTP client connection pooling. The following configuration enables pooling for the <code>foo</code> client:</p>
</div>
<div class="openblock">
<div class="title">Manually configuring HTTP services</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.services.foo.urls[0]=http://foo1
micronaut.http.services.foo.urls[1]=http://foo2
micronaut.http.services.foo.pool.enabled=true
micronaut.http.services.foo.pool.max-connections=50</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    services:
      foo:
        urls:
          - http://foo1
          - http://foo2
        pool:
          enabled: true
          max-connections: 50</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.services]
      [micronaut.http.services.foo]
        urls=[
          "http://foo1",
          "http://foo2"
        ]
        [micronaut.http.services.foo.pool]
          enabled=true
          max-connections=50</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    services {
      foo {
        urls = ["http://foo1", "http://foo2"]
        pool {
          enabled = true
          maxConnections = 50
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      services {
        foo {
          urls = ["http://foo1", "http://foo2"]
          pool {
            enabled = true
            max-connections = 50
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "services": {
        "foo": {
          "urls": ["http://foo1", "http://foo2"],
          "pool": {
            "enabled": true,
            "max-connections": 50
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pool</code> enables the pool and sets the maximum number of connections for it</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the API for <a href="../api/io/micronaut/http/client/HttpClientConfiguration.ConnectionPoolConfiguration.html">ConnectionPoolConfiguration</a> for details on available pool configuration options.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_event_loop_groups">Configuring Event Loop Groups</h3>
<div class="paragraph">
<p>By default, Micronaut shares a common Netty <code>EventLoopGroup</code> for worker threads and all HTTP client threads.</p>
</div>
<div class="paragraph">
<p>This <code>EventLoopGroup</code> can be configured via the <code>micronaut.netty.event-loops.default</code> property:</p>
</div>
<div class="openblock">
<div class="title">Configuring The Default Event Loop</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.netty.event-loops.default.num-threads=10
micronaut.netty.event-loops.default.prefer-native-transport=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  netty:
    event-loops:
      default:
        num-threads: 10
        prefer-native-transport: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.netty]
    [micronaut.netty.event-loops]
      [micronaut.netty.event-loops.default]
        num-threads=10
        prefer-native-transport=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  netty {
    eventLoops {
      'default' {
        numThreads = 10
        preferNativeTransport = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    netty {
      event-loops {
        default {
          num-threads = 10
          prefer-native-transport = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "netty": {
      "event-loops": {
        "default": {
          "num-threads": 10,
          "prefer-native-transport": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>micronaut.netty.event-loops</code> setting to configure one or more additional event loops. The following table summarizes the properties:</p>
</div>
<a id="io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration" href="#io.micronaut.http.netty.channel.DefaultEventLoopGroupConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/http/netty/channel/DefaultEventLoopGroupConfiguration.html">DefaultEventLoopGroupConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.num-threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.io-ratio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.prefer-native-transport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.executor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.shutdown-quiet-period</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.netty.event-loops.*.shutdown-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, if your interactions with an HTTP client involve CPU-intensive work, it may be worthwhile configuring a separate <code>EventLoopGroup</code> for one or all clients.</p>
</div>
<div class="paragraph">
<p>The following example configures an additional event loop group called "other" with 10 threads:</p>
</div>
<div class="openblock">
<div class="title">Configuring Additional Event Loops</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.netty.event-loops.other.num-threads=10
micronaut.netty.event-loops.other.prefer-native-transport=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  netty:
    event-loops:
      other:
        num-threads: 10
        prefer-native-transport: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.netty]
    [micronaut.netty.event-loops]
      [micronaut.netty.event-loops.other]
        num-threads=10
        prefer-native-transport=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  netty {
    eventLoops {
      other {
        numThreads = 10
        preferNativeTransport = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    netty {
      event-loops {
        other {
          num-threads = 10
          prefer-native-transport = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "netty": {
      "event-loops": {
        "other": {
          "num-threads": 10,
          "prefer-native-transport": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once an additional event loop has been configured you can alter the HTTP client configuration to use it:</p>
</div>
<div class="openblock">
<div class="title">Altering the Event Loop Group used by Clients</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.event-loop-group=other</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      event-loop-group: other</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      event-loop-group="other"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      eventLoopGroup = "other"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        event-loop-group = "other"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "event-loop-group": "other"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>

<h2 id="lowLevelClientError"><a class="anchor" href="#lowLevelClientError"></a>7.1.6 Error Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient/lowLevelClientError.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If an HTTP response is returned with a code of 400 or higher, an <a href="../api/io/micronaut/http/client/exceptions/HttpClientResponseException.html">HttpClientResponseException</a> is created. The exception contains the original response. How that exception gets thrown depends on the return type of the method.</p>
</div>
<div class="paragraph">
<p>For blocking clients, the exception is thrown and should be caught and handled by the caller. For reactive clients, the exception is passed through the publisher as an error.</p>
</div>

<h2 id="bindErrors"><a class="anchor" href="#bindErrors"></a>7.1.7 Bind Errors</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/lowLevelHttpClient/bindErrors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often you want to consume an endpoint and bind to a POJO if the request is successful and bind to a different POJO if an error occurs. The following example shows how to invoke <code>exchange</code> with a success and error type.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/books")
public class BooksController {

    @Get("/{isbn}")
    public HttpResponse find(String isbn) {
        if (isbn.equals("1680502395")) {
            Map&lt;String, Object&gt; m = new HashMap&lt;&gt;();
            m.put("status", 401);
            m.put("error", "Unauthorized");
            m.put("message", "No message available");
            m.put("path", "/books/" + isbn);
            return HttpResponse.status(HttpStatus.UNAUTHORIZED).body(m);
        }

        return HttpResponse.ok(new Book("1491950358", "Building Microservices"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/books")
class BooksController {

    @Get("/{isbn}")
    HttpResponse find(String isbn) {
        if (isbn == "1680502395") {
            Map&lt;String, Object&gt; m = [
                    status : 401,
                    error  : "Unauthorized",
                    message: "No message available",
                    path   : "/books/" + isbn]
            return HttpResponse.status(HttpStatus.UNAUTHORIZED).body(m)
        }

        return HttpResponse.ok(new Book("1491950358", "Building Microservices"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/books")
class BooksController {

    @Get("/{isbn}")
    fun find(isbn: String): HttpResponse&lt;*&gt; {
        if (isbn == "1680502395") {
            val m = mapOf(
                "status" to 401,
                "error" to "Unauthorized",
                "message" to "No message available",
                "path" to "/books/$isbn"
            )
            return HttpResponse.status&lt;Any&gt;(HttpStatus.UNAUTHORIZED).body(m)
        }

        return HttpResponse.ok(Book("1491950358", "Building Microservices"))
    }
}</code></pre>
</div>
</div>
<hr>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void afterAnHttpClientExceptionTheResponseBodyCanBeBoundToAPOJO() {
    try {
        client.toBlocking().exchange(HttpRequest.GET("/books/1680502395"),
                Argument.of(Book.class), // <b class="conum">(1)</b>
                Argument.of(CustomError.class)); // <b class="conum">(2)</b>
    } catch (HttpClientResponseException e) {
        assertEquals(HttpStatus.UNAUTHORIZED, e.getResponse().getStatus());
        Optional&lt;CustomError&gt; jsonError = e.getResponse().getBody(CustomError.class);
        assertTrue(jsonError.isPresent());
        assertEquals(401, jsonError.get().status);
        assertEquals("Unauthorized", jsonError.get().error);
        assertEquals("No message available", jsonError.get().message);
        assertEquals("/books/1680502395", jsonError.get().path);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def "after an HttpClientException the response body can be bound to a POJO"() {
    when:
    client.toBlocking().exchange(HttpRequest.GET("/books/1680502395"),
            Argument.of(Book), // <b class="conum">(1)</b>
            Argument.of(CustomError)) // <b class="conum">(2)</b>

    then:
    def e = thrown(HttpClientResponseException)
    e.response.status == HttpStatus.UNAUTHORIZED

    when:
    Optional&lt;CustomError&gt; jsonError = e.response.getBody(CustomError)

    then:
    jsonError.isPresent()
    jsonError.get().status == 401
    jsonError.get().error == 'Unauthorized'
    jsonError.get().message == 'No message available'
    jsonError.get().path == '/books/1680502395'
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">"after an httpclient exception the response body can be bound to a POJO" {
    try {
        client.toBlocking().exchange(HttpRequest.GET&lt;Any&gt;("/books/1680502395"),
                Argument.of(Book::class.java), // <b class="conum">(1)</b>
                Argument.of(CustomError::class.java)) // <b class="conum">(2)</b>
    } catch (e: HttpClientResponseException) {
        e.response.status shouldBe HttpStatus.UNAUTHORIZED
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Success Type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Error Type</td>
</tr>
</table>
</div>

<h2 id="proxyClient"><a class="anchor" href="#proxyClient"></a>7.2 Proxying Requests with ProxyHttpClient</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/proxyClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A common requirement in Microservice environments is to proxy requests in a Gateway Microservice to other backend Microservices.</p>
</div>
<div class="paragraph">
<p>The regular <a href="../api/io/micronaut/http/client/HttpClient.html">HttpClient</a> API is designed around simplifying message exchange and is not designed for proxying requests. For this case, use the <a href="../api/io/micronaut/http/client/ProxyHttpClient.html">ProxyHttpClient</a>, which can be used from a <a href="#filters">HTTP Server Filter</a> to proxy requests to backend Microservices.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates rewriting requests under the URI <code>/proxy</code> to the URI <code>/real</code> onto the same server (although in a real environment you generally proxy to another server):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Proxy filter that rewrites original requests</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.async.publisher.Publishers;
import io.micronaut.core.util.StringUtils;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.MutableHttpResponse;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.client.ProxyHttpClient;
import io.micronaut.http.filter.HttpServerFilter;
import io.micronaut.http.filter.ServerFilterChain;
import io.micronaut.runtime.server.EmbeddedServer;
import org.reactivestreams.Publisher;

@Filter("/proxy/**")
public class ProxyFilter implements HttpServerFilter { // <b class="conum">(1)</b>

    private final ProxyHttpClient client;
    private final EmbeddedServer embeddedServer;

    public ProxyFilter(ProxyHttpClient client,
                       EmbeddedServer embeddedServer) { // <b class="conum">(2)</b>
        this.client = client;
        this.embeddedServer = embeddedServer;
    }

    @Override
    public Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request,
                                                      ServerFilterChain chain) {
        return Publishers.map(client.proxy( // <b class="conum">(3)</b>
                request.mutate() // <b class="conum">(4)</b>
                        .uri(b -&gt; b // <b class="conum">(5)</b>
                                .scheme("http")
                                .host(embeddedServer.getHost())
                                .port(embeddedServer.getPort())
                                .replacePath(StringUtils.prependUri(
                                        "/real",
                                        request.getPath().substring("/proxy".length())
                                ))
                        )
                        .header("X-My-Request-Header", "XXX") // <b class="conum">(6)</b>
        ), response -&gt; response.header("X-My-Response-Header", "YYY"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Proxy filter that rewrites original requests</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.async.publisher.Publishers
import io.micronaut.core.util.StringUtils
import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.ProxyHttpClient
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import io.micronaut.http.uri.UriBuilder
import io.micronaut.runtime.server.EmbeddedServer
import org.reactivestreams.Publisher

@Filter("/proxy/**")
class ProxyFilter implements HttpServerFilter { // <b class="conum">(1)</b>

    private final ProxyHttpClient client
    private final EmbeddedServer embeddedServer

    ProxyFilter(ProxyHttpClient client,
                EmbeddedServer embeddedServer) { // <b class="conum">(2)</b>
        this.client = client
        this.embeddedServer = embeddedServer
    }

    @Override
    Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request,
                                               ServerFilterChain chain) {
        Publishers.map(client.proxy( // <b class="conum">(3)</b>
                request.mutate() // <b class="conum">(4)</b>
                        .uri { UriBuilder b -&gt; // <b class="conum">(5)</b>
                            b.with {
                                scheme("http")
                                host(embeddedServer.host)
                                port(embeddedServer.port)
                                replacePath(StringUtils.prependUri(
                                        "/real",
                                        request.path.substring("/proxy".length())
                                ))
                            }
                        }
                        .header("X-My-Request-Header", "XXX") // <b class="conum">(6)</b>
        ), { it.header("X-My-Response-Header", "YYY") })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Proxy filter that rewrites original requests</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.async.publisher.Publishers
import io.micronaut.core.util.StringUtils
import io.micronaut.http.HttpRequest
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.ProxyHttpClient
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import io.micronaut.http.uri.UriBuilder
import io.micronaut.runtime.server.EmbeddedServer
import org.reactivestreams.Publisher

@Filter("/proxy/**")
class ProxyFilter(
    private val client: ProxyHttpClient, // <b class="conum">(2)</b>
    private val embeddedServer: EmbeddedServer
) : HttpServerFilter { // <b class="conum">(1)</b>

    override fun doFilter(request: HttpRequest&lt;*&gt;,
                          chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
        return Publishers.map(client.proxy( // <b class="conum">(3)</b>
            request.mutate() // <b class="conum">(4)</b>
                .uri { b: UriBuilder -&gt; // <b class="conum">(5)</b>
                    b.apply {
                        scheme("http")
                        host(embeddedServer.host)
                        port(embeddedServer.port)
                        replacePath(StringUtils.prependUri(
                            "/real",
                            request.path.substring("/proxy".length))
                        )
                    }
                }
                .header("X-My-Request-Header", "XXX") // <b class="conum">(6)</b>
        ), { response: MutableHttpResponse&lt;*&gt; -&gt; response.header("X-My-Response-Header", "YYY") })
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The filter extends <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/http/client/ProxyHttpClient.html">ProxyHttpClient</a> is injected into the constructor.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>proxy</code> method proxies the request</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The request is mutated to modify the URI and include an additional header</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="../api/io/micronaut/http/uri/UriBuilder.html">UriBuilder</a> API rewrites the URI</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Additional request and response headers are included</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/http/client/ProxyHttpClient.html">ProxyHttpClient</a> API is a low-level API that can be used to build a higher-level abstraction such as an API Gateway.
</td>
</tr>
</table>
</div>

<h2 id="clientAnnotation"><a class="anchor" href="#clientAnnotation"></a>7.3 Declarative HTTP Clients with @Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that you have an understanding of the workings of the lower-level HTTP client, let&#8217;s take a look at Micronaut&#8217;s support for declarative clients via the <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation.</p>
</div>
<div class="paragraph">
<p>Essentially, the <code>@Client</code> annotation can be declared on any interface or abstract class, and through the use of <a href="#introductionAdvice">Introduction Advice</a> the abstract methods are implemented for you at compile time, greatly simplifying the creation of HTTP clients.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a simple example. Given the following class:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Pet {
    private String name;
    private int age;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class Pet {
    String name
    int age
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Pet.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class Pet {
    var name: String? = null
    var age: Int = 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define a common interface for saving new <code>Pet</code> instances:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Post;
import io.micronaut.validation.Validated;
import org.reactivestreams.Publisher;
import io.micronaut.core.async.annotation.SingleResult;
import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@Validated
public interface PetOperations {
    @Post
    @SingleResult
    Publisher&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import org.reactivestreams.Publisher
import io.micronaut.core.async.annotation.SingleResult
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@Validated
interface PetOperations {
    @Post
    @SingleResult
    Publisher&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.Post
import io.micronaut.validation.Validated
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank
import io.micronaut.core.async.annotation.SingleResult
import org.reactivestreams.Publisher

@Validated
interface PetOperations {
    @Post
    @SingleResult
    fun save(@NotBlank name: String, @Min(1L) age: Int): Publisher&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the interface uses Micronaut&#8217;s HTTP annotations which are usable on both the server and client side. You can also use <code>javax.validation</code> constraints to validate arguments.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Be aware that some annotations, such as <a href="../api/io/micronaut/http/annotation/Produces.html">Produces</a> and <a href="../api/io/micronaut/http/annotation/Consumes.html">Consumes</a>, have different semantics between server and client side usage. For example, <code>@Produces</code> on a controller method (server side) indicates how the method&#8217;s <strong>return value</strong> is formatted, while <code>@Produces</code> on a client indicates how the method&#8217;s <strong>parameters</strong> are formatted when sent to the server. While this may seem a little confusing, it is logical considering the different semantics between a server producing/consuming vs a client: a server consumes an argument and <strong>returns</strong> a response to the client, whereas a client consumes an argument and <strong>sends</strong> output to a server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Additionally, to use the <code>javax.validation</code> features, add the <code>validation</code> module to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>On the server-side of Micronaut you can implement the <code>PetOperations</code> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Controller;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;
import io.micronaut.core.async.annotation.SingleResult;

@Controller("/pets")
public class PetController implements PetOperations {

    @Override
    @SingleResult
    public Publisher&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet();
        pet.setName(name);
        pet.setAge(age);
        // save to database or something
        return Mono.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Controller
import org.reactivestreams.Publisher
import io.micronaut.core.async.annotation.SingleResult
import reactor.core.publisher.Mono

@Controller("/pets")
class PetController implements PetOperations {

    @Override
    @SingleResult
    Publisher&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet(name: name, age: age)
        // save to database or something
        return Mono.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.Controller
import reactor.core.publisher.Mono
import io.micronaut.core.async.annotation.SingleResult
import org.reactivestreams.Publisher

@Controller("/pets")
open class PetController : PetOperations {

    @SingleResult
    override fun save(name: String, age: Int): Publisher&lt;Pet&gt; {
        val pet = Pet()
        pet.name = name
        pet.age = age
        // save to database or something
        return Mono.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then define a declarative client in <code>src/test/java</code> that uses <code>@Client</code> to automatically implement a client at compile time:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.client.annotation.Client;
import org.reactivestreams.Publisher;
import io.micronaut.core.async.annotation.SingleResult;
import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;

@Client("/pets") // <b class="conum">(1)</b>
public interface PetClient extends PetOperations { // <b class="conum">(2)</b>

    @Override
    @SingleResult
    Publisher&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age); // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher
import io.micronaut.core.async.annotation.SingleResult

@Client("/pets") // <b class="conum">(1)</b>
interface PetClient extends PetOperations { // <b class="conum">(2)</b>

    @Override
    @SingleResult
    Publisher&lt;Pet&gt; save(String name, int age) // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">PetClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.client.annotation.Client
import io.micronaut.core.async.annotation.SingleResult
import org.reactivestreams.Publisher

@Client("/pets") // <b class="conum">(1)</b>
interface PetClient : PetOperations { // <b class="conum">(2)</b>

    @SingleResult
    override fun save(name: String, age: Int): Publisher&lt;Pet&gt; // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> annotation is used with a value relative to the current server, in this case <code>/pets</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The interface extends from <code>PetOperations</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>save</code> method is overridden. See the warning below.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Notice in the above example we override the <code>save</code> method. This is necessary if you compile without the <code>-parameters</code> option since Java does not retain parameters names in bytecode otherwise. Overriding is not necessary if you compile with <code>-parameters</code>. In addition, when overriding methods you should ensure any validation annotations are declared again since these are not <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a> annotations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have defined a client you can <code>@Inject</code> it wherever you need it.</p>
</div>
<div class="paragraph">
<p>Recall that the value of <code>@Client</code> can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An absolute URI, e.g. <code><a href="https://api.twitter.com/1.1" class="bare">https://api.twitter.com/1.1</a></code></p>
</li>
<li>
<p>A relative URI, in which case the server targeted is the current server (useful for testing)</p>
</li>
<li>
<p>A service identifier. See the section on <a href="#serviceDiscovery">Service Discovery</a> for more information on this topic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In production you typically use a service ID and <a href="#serviceDiscovery">Service Discovery</a> to discover services automatically.</p>
</div>
<div class="paragraph">
<p>Another important thing to notice regarding the <code>save</code> method in the example above is that it returns a <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Single.html">Single</a> type.</p>
</div>
<div class="paragraph">
<p>This is a non-blocking reactive type - typically you want your HTTP clients to not block. There are cases where you may want an HTTP client that does block (such as in unit tests), but this is rare.</p>
</div>
<div class="paragraph">
<p>The following table illustrates common return types usable with <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Micronaut Response Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type that implements the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Flux&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a> and optional response body type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;HttpResponse&lt;String&gt;&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> implementation that emits a POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mono&lt;Book&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Java <code>CompletableFuture</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;String&gt; hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html">CharSequence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A blocking native type. Such as <code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String hello()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any simple POJO type.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Book show()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Generally, any reactive type that can be converted to the <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> interface is supported as a return type, including (but not limited to) the reactive types defined by RxJava 1.x, RxJava 2.x, and Reactor 3.x.</p>
</div>
<div class="paragraph">
<p>Returning <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html">CompletableFuture</a> instances is also supported. Note that returning any other type <em>results in a blocking request</em> and is not recommended other than for testing.</p>
</div>

<h2 id="clientParameters"><a class="anchor" href="#clientParameters"></a>7.3.1 Customizing Parameter Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/clientParameters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The previous example presented a simple example using method parameters to represent the body of a <code>POST</code> request:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post
@SingleResult
Publisher&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>save</code> method performs an HTTP <code>POST</code> with the following JSON by default:</p>
</div>
<div class="listingblock">
<div class="title">Example Produced JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"name":"Dino", "age":10}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may however want to customize what is sent as the body, the parameters, URI variables, etc. The <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation is very flexible in this regard and supports the same <a href="../api/io/micronaut/http/annotation/package-summary.html">io.micronaut.http.annotation</a> as Micronaut&#8217;s HTTP server.</p>
</div>
<div class="paragraph">
<p>For example, the following defines a URI template, and the <code>name</code> parameter is used as part of the URI template, whilst <a href="../api/io/micronaut/http/annotation/Body.html">@Body</a> declares that the contents to send to the server are represented by the <code>Pet</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">PetOperations.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Post("/{name}")
Mono&lt;Pet&gt; save(
    @NotBlank String name, <i class="conum" data-value="1"></i><b>(1)</b>
    @Body @Valid Pet pet) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name parameter, included as part of the URI, and declared <code>@NotBlank</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>pet</code> parameter, used to encode the body and declared <code>@Valid</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table summarizes the parameter annotations and their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Parameter Binding Annotations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the parameter for the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Body String body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies parameters to be sent as cookies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieValue String myCookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies parameters to be sent as HTTP headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Header String requestId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Customizes the name of the URI parameter to bind from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryValue("userAge") Integer age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/PathVariable.html">@PathVariable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binds a parameter exclusively from a <a href="#routing">Path Variable</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathVariable Long id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@RequestAttribute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies parameters to be set as request attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestAttribute Integer locationId</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Always use <a href="../api/io/micronaut/http/annotation/Produces.html">@Produces</a> or <a href="../api/io/micronaut/http/annotation/Consumes.html">@Consumes</a> instead of supplying a header for <code>Content-Type</code> or <code>Accept</code>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_query_values_formatting">Query values formatting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/convert/format/Format.html">Format</a> annotation can be used together with <code>@QueryValue</code> annotation to format query values.</p>
</div>
<div class="paragraph">
<p>The supported values are: <code>"csv"</code>, <code>"ssv"</code>, <code>"pipes"</code>, <code>"multi"</code> and <code>"deep-object"</code>, where the meaning is similar to <a href="https://swagger.io/docs/specification/serialization/">Open API v3</a> query parameter&#8217;s <code>style</code> attribute.</p>
</div>
<div class="paragraph">
<p>The format can only be applied to <code>java.lang.Iterable</code>, <code>java.util.Map</code> or POJO with <a href="../api/io/micronaut/core/annotation/Introspected.html">Introspected</a> annotation. Examples of how different values will be formatted are given in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Iterable example</th>
<th class="tableblock halign-left valign-top">Map or POJO example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Original value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>["Mike", "Adam", "Kate"]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"name": "Mike", "age": 30"}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"CSV"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param=Mike,Adam,Kate"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param=name,Mike,age,30"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"SSV"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param=Mike Adam Kate"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param=name Mike age 30"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"PIPES"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param=Mike|Adam|Kate"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param=name|Mike|age|30"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"MULTI"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param=Mike&amp;param=Adam&amp;param=Kate"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"name=Mike&amp;age=30"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"DEEP_OBJECT"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param[0]=Mike&amp;param[1]=Adam&amp;param[2]=Kate"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"param[name]=Mike&amp;param[age]=30"</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_type_based_binding_parameters">Type-Based Binding Parameters</h4>
<div class="paragraph">
<p>Some parameters are recognized by their type instead of their annotation. The following table summarizes these parameter types and their purpose, and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/BasicAuth.html">BasicAuth</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the <code>Authorization</code> header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuth basicAuth</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpHeaders.html">HttpHeaders</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds multiple headers to the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpHeaders headers</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/Cookies.html">Cookies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds multiple cookies to the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cookies cookies</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/Cookie.html">Cookie</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a cookie to the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cookie cookie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html">Locale</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the <code>Accept-Language</code> header. Annotate with <a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a> or <a href="../api/io/micronaut/http/annotation/PathVariable.html">@PathVariable</a> to populate a URI variable.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Locale locale</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_custom_binding">Custom Binding</h4>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/bind/ClientArgumentRequestBinder.html">ClientArgumentRequestBinder</a> API binds client arguments to the request. Custom binder classes registered as beans are automatically used during the binding process. Annotation-based binders are searched for first, with type-based binders being searched if a binder was not found.</p>
</div>
<div class="sect4">
<h5 id="_binding_by_annotation">Binding By Annotation</h5>
<div class="paragraph">
<p>To control how an argument is bound to the request based on an annotation on the argument, create a bean of type <a href="../api/io/micronaut/http/client/bind/AnnotatedClientArgumentRequestBinder.html">AnnotatedClientArgumentRequestBinder</a>. Any custom annotations must be annotated with <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a>.</p>
</div>
<div class="paragraph">
<p>In this example, see the following client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With @Metadata Argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("/")
public interface MetadataClient {

    @Get("/client/bind")
    String get(@Metadata Map&lt;String, Object&gt; metadata);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With @Metadata Argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Client("/")
interface MetadataClient {

    @Get("/client/bind")
    String get(@Metadata Map metadata)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With @Metadata Argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Client("/")
interface MetadataClient {

    @Get("/client/bind")
    operator fun get(@Metadata metadata: Map&lt;String, Any&gt;): String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The argument is annotated with the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Metadata Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.bind.annotation.Bindable;

import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.PARAMETER;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Retention(RUNTIME)
@Target(PARAMETER)
@Bindable
public @interface Metadata {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Metadata Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.bind.annotation.Bindable

import java.lang.annotation.Documented
import java.lang.annotation.Retention
import java.lang.annotation.Target

import static java.lang.annotation.ElementType.PARAMETER
import static java.lang.annotation.RetentionPolicy.RUNTIME

@Documented
@Retention(RUNTIME)
@Target(PARAMETER)
@Bindable
@interface Metadata {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@Metadata Annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.bind.annotation.Bindable
import kotlin.annotation.AnnotationRetention.RUNTIME
import kotlin.annotation.AnnotationTarget.VALUE_PARAMETER

@MustBeDocumented
@Retention(RUNTIME)
@Target(VALUE_PARAMETER)
@Bindable
annotation class Metadata</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without any additional code, the client attempts to convert the metadata to a string and append it as a query parameter. In this case that isn&#8217;t the desired effect, so a custom binder is needed.</p>
</div>
<div class="paragraph">
<p>The following binder handles arguments passed to clients that are annotated with the <code>@Metadata</code> annotation, and mutate the request to contain the desired headers. The implementation could be modified to accept more types of data other than <code>Map</code>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Argument Binder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.NonNull;
import io.micronaut.core.convert.ArgumentConversionContext;
import io.micronaut.core.naming.NameUtils;
import io.micronaut.core.util.StringUtils;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.client.bind.AnnotatedClientArgumentRequestBinder;
import io.micronaut.http.client.bind.ClientRequestUriContext;

import jakarta.inject.Singleton;
import java.util.Map;

@Singleton
public class MetadataClientArgumentBinder implements AnnotatedClientArgumentRequestBinder&lt;Metadata&gt; {

    @NonNull
    @Override
    public Class&lt;Metadata&gt; getAnnotationType() {
        return Metadata.class;
    }

    @Override
    public void bind(@NonNull ArgumentConversionContext&lt;Object&gt; context,
                     @NonNull ClientRequestUriContext uriContext,
                     @NonNull Object value,
                     @NonNull MutableHttpRequest&lt;?&gt; request) {
        if (value instanceof Map) {
            for (Map.Entry&lt;?, ?&gt; entry: ((Map&lt;?, ?&gt;) value).entrySet()) {
                String key = NameUtils.hyphenate(StringUtils.capitalize(entry.getKey().toString()), false);
                request.header("X-Metadata-" + key, entry.getValue().toString());
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Argument Binder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.NonNull
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.naming.NameUtils
import io.micronaut.core.util.StringUtils
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.AnnotatedClientArgumentRequestBinder
import io.micronaut.http.client.bind.ClientRequestUriContext

import jakarta.inject.Singleton

@Singleton
class MetadataClientArgumentBinder implements AnnotatedClientArgumentRequestBinder&lt;Metadata&gt; {

    final Class&lt;Metadata&gt; annotationType = Metadata

    @Override
    void bind(@NonNull ArgumentConversionContext&lt;Object&gt; context,
              @NonNull ClientRequestUriContext uriContext,
              @NonNull Object value,
              @NonNull MutableHttpRequest&lt;?&gt; request) {
        if (value instanceof Map) {
            for (entry in value.entrySet()) {
                String key = NameUtils.hyphenate(StringUtils.capitalize(entry.key as String), false)
                request.header("X-Metadata-$key", entry.value as String)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Argument Binder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.naming.NameUtils
import io.micronaut.core.util.StringUtils
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.AnnotatedClientArgumentRequestBinder
import io.micronaut.http.client.bind.ClientRequestUriContext
import jakarta.inject.Singleton

@Singleton
class MetadataClientArgumentBinder : AnnotatedClientArgumentRequestBinder&lt;Metadata&gt; {

    override fun getAnnotationType(): Class&lt;Metadata&gt; {
        return Metadata::class.java
    }

    override fun bind(context: ArgumentConversionContext&lt;Any&gt;,
                      uriContext: ClientRequestUriContext,
                      value: Any,
                      request: MutableHttpRequest&lt;*&gt;) {
        if (value is Map&lt;*, *&gt;) {
            for ((key1, value1) in value) {
                val key = NameUtils.hyphenate(StringUtils.capitalize(key1.toString()), false)
                request.header("X-Metadata-$key", value1.toString())
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_binding_by_type">Binding By Type</h5>
<div class="paragraph">
<p>To bind to the request based on the type of the argument, create a bean of type <a href="../api/io/micronaut/http/client/bind/TypedClientArgumentRequestBinder.html">TypedClientArgumentRequestBinder</a>.</p>
</div>
<div class="paragraph">
<p>In this example, see the following client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Metadata Argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("/")
public interface MetadataClient {

    @Get("/client/bind")
    String get(Metadata metadata);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Metadata Argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Client("/")
interface MetadataClient {

    @Get("/client/bind")
    String get(Metadata metadata)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Metadata Argument</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Client("/")
interface MetadataClient {

    @Get("/client/bind")
    operator fun get(metadata: Metadata?): String?
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without any additional code, the client attempts to convert the metadata to a string and append it as a query parameter. In this case that isn&#8217;t the desired effect, so a custom binder is needed.</p>
</div>
<div class="paragraph">
<p>The following binder handles arguments passed to clients of type <code>Metadata</code> and mutate the request to contain the desired headers.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Typed Argument Binder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.NonNull;
import io.micronaut.core.convert.ArgumentConversionContext;
import io.micronaut.core.type.Argument;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.client.bind.ClientRequestUriContext;
import io.micronaut.http.client.bind.TypedClientArgumentRequestBinder;

import jakarta.inject.Singleton;

@Singleton
public class MetadataClientArgumentBinder implements TypedClientArgumentRequestBinder&lt;Metadata&gt; {

    @Override
    @NonNull
    public Argument&lt;Metadata&gt; argumentType() {
        return Argument.of(Metadata.class);
    }

    @Override
    public void bind(@NonNull ArgumentConversionContext&lt;Metadata&gt; context,
                     @NonNull ClientRequestUriContext uriContext,
                     @NonNull Metadata value,
                     @NonNull MutableHttpRequest&lt;?&gt; request) {
        request.header("X-Metadata-Version", value.getVersion().toString());
        request.header("X-Metadata-Deployment-Id", value.getDeploymentId().toString());
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Typed Argument Binder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.NonNull
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.ClientRequestUriContext
import io.micronaut.http.client.bind.TypedClientArgumentRequestBinder

import jakarta.inject.Singleton

@Singleton
class MetadataClientArgumentBinder implements TypedClientArgumentRequestBinder&lt;Metadata&gt; {

    @Override
    @NonNull
    Argument&lt;Metadata&gt; argumentType() {
        Argument.of(Metadata)
    }

    @Override
    void bind(@NonNull ArgumentConversionContext&lt;Metadata&gt; context,
              @NonNull ClientRequestUriContext uriContext,
              @NonNull Metadata value,
              @NonNull MutableHttpRequest&lt;?&gt; request) {
        request.header("X-Metadata-Version", value.version.toString())
        request.header("X-Metadata-Deployment-Id", value.deploymentId.toString())
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Typed Argument Binder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.client.bind.ClientRequestUriContext
import io.micronaut.http.client.bind.TypedClientArgumentRequestBinder
import jakarta.inject.Singleton

@Singleton
class MetadataClientArgumentBinder : TypedClientArgumentRequestBinder&lt;Metadata&gt; {

    override fun argumentType(): Argument&lt;Metadata&gt; {
        return Argument.of(Metadata::class.java)
    }

    override fun bind(
        context: ArgumentConversionContext&lt;Metadata&gt;,
        uriContext: ClientRequestUriContext,
        value: Metadata,
        request: MutableHttpRequest&lt;*&gt;
    ) {
        request.header("X-Metadata-Version", value.version.toString())
        request.header("X-Metadata-Deployment-Id", value.deploymentId.toString())
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_binding_on_method">Binding On Method</h3>
<div class="paragraph">
<p>It is also possible to create a binder, that would change the request with an annotation on the method. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Annotated Method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("/")
public interface NameAuthorizedClient {

    @Get("/client/authorized-resource")
    @NameAuthorization(name="Bob") // <b class="conum">(1)</b>
    String get();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Annotated Method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Client("/")
public interface NameAuthorizedClient {

    @Get("/client/authorized-resource")
    @NameAuthorization(name="Bob") // <b class="conum">(1)</b>
    String get()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Client With Annotated Method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Client("/")
public interface NameAuthorizedClient {

    @Get("/client/authorized-resource")
    @NameAuthorization(name="Bob") // <b class="conum">(1)</b>
    fun get(): String
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@NameAuthorization</code> is annotating a method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The annotation is defined as:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Documented
@Retention(RUNTIME)
@Target(METHOD) // <b class="conum">(1)</b>
@Bindable
public @interface NameAuthorization {
    @AliasFor(member = "name")
    String value() default "";

    @AliasFor(member = "value")
    String name() default "";
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Documented
@Retention(RUNTIME)
@Target(METHOD) // <b class="conum">(1)</b>
@Bindable
@interface NameAuthorization {
    @AliasFor(member = "name")
    String value() default ""

    @AliasFor(member = "value")
    String name() default ""
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@MustBeDocumented
@Retention(RUNTIME)
@Target(FUNCTION) // <b class="conum">(1)</b>
@Bindable
annotation class NameAuthorization(val name: String = "")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is defined to be used on methods</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following binder specifies the behaviour:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton // <b class="conum">(1)</b>
public class NameAuthorizationBinder implements AnnotatedClientRequestBinder&lt;NameAuthorization&gt; { // <b class="conum">(2)</b>
    @NonNull
    @Override
    public Class&lt;NameAuthorization&gt; getAnnotationType() {
        return NameAuthorization.class;
    }

    @Override
    public void bind( // <b class="conum">(3)</b>
            @NonNull MethodInvocationContext&lt;Object, Object&gt; context,
            @NonNull ClientRequestUriContext uriContext,
            @NonNull MutableHttpRequest&lt;?&gt; request
    ) {
        context.getValue(NameAuthorization.class)
                .ifPresent(name -&gt; uriContext.addQueryParameter("name", String.valueOf(name)));

    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton // <b class="conum">(1)</b>
public class NameAuthorizationBinder implements AnnotatedClientRequestBinder&lt;NameAuthorization&gt; { // <b class="conum">(2)</b>
    @NonNull
    @Override
    Class&lt;NameAuthorization&gt; getAnnotationType() {
        return NameAuthorization.class
    }

    @Override
    void bind( // <b class="conum">(3)</b>
            @NonNull MethodInvocationContext&lt;Object, Object&gt; context,
            @NonNull ClientRequestUriContext uriContext,
            @NonNull MutableHttpRequest&lt;?&gt; request
    ) {
        context.getValue(NameAuthorization.class)
                .ifPresent(name -&gt; uriContext.addQueryParameter("name", String.valueOf(name)))

    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Annotation Definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.client.bind.AnnotatedClientRequestBinder

@Singleton // <b class="conum">(1)</b>
class NameAuthorizationBinder: AnnotatedClientRequestBinder&lt;NameAuthorization&gt; { // <b class="conum">(2)</b>
    @NonNull
    override fun getAnnotationType(): Class&lt;NameAuthorization&gt; {
        return NameAuthorization::class.java
    }

    override fun bind( // <b class="conum">(3)</b>
            @NonNull context: MethodInvocationContext&lt;Any, Any&gt;,
            @NonNull uriContext: ClientRequestUriContext,
            @NonNull request: MutableHttpRequest&lt;*&gt;
    ) {
        context.getValue(NameAuthorization::class.java, "name")
                .ifPresent { name -&gt; uriContext.addQueryParameter("name", name.toString()) }

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Singleton</code> annotation registers it in Micronaut context</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It implements the <code>AnnotatedClientRequestBinder&lt;NameAuthorization&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The custom <code>bind</code> method is used to implement the behaviour of the binder</td>
</tr>
</table>
</div>
</div>
</div>
</div>

<h2 id="clientAnnotationStreaming"><a class="anchor" href="#clientAnnotationStreaming"></a>7.3.2 Streaming with @Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/clientAnnotationStreaming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation can also handle streaming HTTP responses.</p>
</div>
<div class="sect2">
<h3 id="_streaming_json_with_client">Streaming JSON with @Client</h3>
<div class="paragraph">
<p>For example, to write a client that streams data from the controller defined in the <a href="#clientStreaming">JSON Streaming</a> section of the documentation, you can define a client that returns an unbound <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> such as Reactor&#8217;s <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> or a RxJava&#8217;s <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;
import static io.micronaut.http.MediaType.APPLICATION_JSON_STREAM;

@Client("/streaming")
public interface HeadlineClient {

    @Get(value = "/headlines", processes = APPLICATION_JSON_STREAM) // <b class="conum">(1)</b>
    Publisher&lt;Headline&gt; streamHeadlines(); // <b class="conum">(2)</b>

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher

import static io.micronaut.http.MediaType.APPLICATION_JSON_STREAM

@Client("/streaming")
interface HeadlineClient {

    @Get(value = "/headlines", processes = APPLICATION_JSON_STREAM) // <b class="conum">(1)</b>
    Publisher&lt;Headline&gt; streamHeadlines() // <b class="conum">(2)</b>

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">HeadlineClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType.APPLICATION_JSON_STREAM
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import reactor.core.publisher.Flux


@Client("/streaming")
interface HeadlineClient {

    @Get(value = "/headlines", processes = [APPLICATION_JSON_STREAM]) // <b class="conum">(1)</b>
    fun streamHeadlines(): Flux&lt;Headline&gt;  // <b class="conum">(2)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Get</code> method processes responses of type <code>APPLICATION_JSON_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The return type is <code>Publisher</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how the previously defined <code>HeadlineClient</code> can be invoked from a test:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testClientAnnotationStreaming() {
    try(EmbeddedServer embeddedServer = ApplicationContext.run(EmbeddedServer.class)) {
        HeadlineClient headlineClient = embeddedServer
                                            .getApplicationContext()
                                            .getBean(HeadlineClient.class); // <b class="conum">(1)</b>

        Mono&lt;Headline&gt; firstHeadline = Mono.from(headlineClient.streamHeadlines()); // <b class="conum">(2)</b>

        Headline headline = firstHeadline.block(); // <b class="conum">(3)</b>

        assertNotNull(headline);
        assertTrue(headline.getText().startsWith("Latest Headline"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">void "test client annotation streaming"() throws Exception {
    when:
    def headlineClient = embeddedServer.applicationContext
                                       .getBean(HeadlineClient) // <b class="conum">(1)</b>

    Mono&lt;Headline&gt; firstHeadline = Mono.from(headlineClient.streamHeadlines()) // <b class="conum">(2)</b>

    Headline headline = firstHeadline.block() // <b class="conum">(3)</b>

    then:
    headline
    headline.text.startsWith("Latest Headline")
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming HeadlineClient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">"test client annotation streaming" {
    val headlineClient = embeddedServer
            .applicationContext
            .getBean(HeadlineClient::class.java) // <b class="conum">(1)</b>

    val firstHeadline = headlineClient.streamHeadlines().next() // <b class="conum">(2)</b>

    val headline = firstHeadline.block() // <b class="conum">(3)</b>

    headline shouldNotBe null
    headline.text shouldStartWith "Latest Headline"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The client is retrieved from the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>next</code> method emits the first element emmited by the <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> into a <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html">Mono</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>block()</code> method retrieves the result in the test.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_clients_and_response_types">Streaming Clients and Response Types</h3>
<div class="paragraph">
<p>The example defined in the previous section expects the server to respond with a stream of JSON objects, and the content type to be <code>application/x-json-stream</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">A JSON Stream</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"title":"The Stand"}
{"title":"The Shining"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason for this is simple; a sequence of JSON object is not, in fact, valid JSON and hence the response content type cannot be <code>application/json</code>. For the JSON to be valid it would have to return an array:</p>
</div>
<div class="listingblock">
<div class="title">A JSON Array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {"title":"The Stand"},
    {"title":"The Shining"}
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s client does however support streaming of both individual JSON objects via <code>application/x-json-stream</code> and also JSON arrays defined with <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>If the server returns <code>application/json</code> and a non-single <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> is returned (such as a Reactor&#8217;s <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> or a RxJava&#8217;s <a href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowable</a>), the client streams the array elements as they become available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_clients_and_read_timeout">Streaming Clients and Read Timeout</h3>
<div class="paragraph">
<p>When streaming responses from servers, the underlying HTTP client will not apply the default <code>readTimeout</code> setting (which defaults to 10 seconds) of the <a href="../api/io/micronaut/http/client/HttpClientConfiguration.html">HttpClientConfiguration</a> since the delay between reads for streaming responses may differ from normal reads.</p>
</div>
<div class="paragraph">
<p>Instead, the <code>read-idle-timeout</code> setting (which defaults to 5 minutes) dictates when to close a connection after it becomes idle.</p>
</div>
<div class="paragraph">
<p>If you stream data from a server that defines a longer delay than 5 minutes between items, you should adjust <code>readIdleTimeout</code>. The following configuration in your configuration file (e.g <code>application.yml</code>) demonstrates how:</p>
</div>
<div class="openblock">
<div class="title">Adjusting the readIdleTimeout</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.read-idle-timeout=10m</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      read-idle-timeout: 10m</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      read-idle-timeout="10m"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      readIdleTimeout = "10m"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        read-idle-timeout = "10m"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "read-idle-timeout": "10m"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example sets the <code>readIdleTimeout</code> to ten minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_server_sent_events">Streaming Server Sent Events</h3>
<div class="paragraph">
<p>Micronaut features a native client for Server Sent Events (SSE) defined by the interface <a href="../api/io/micronaut/http/client/sse/SseClient.html">SseClient</a>.</p>
</div>
<div class="paragraph">
<p>You can use this client to stream SSE events from any server that emits them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although SSE streams are typically consumed by a browser <code>EventSource</code>, there are cases where you may wish to consume an SSE stream via <a href="../api/io/micronaut/http/client/sse/SseClient.html">SseClient</a>, such as in unit tests or when a Micronaut service acts as a gateway for another service.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> annotation also supports consuming SSE streams. For example, consider the following controller method that produces a stream of SSE events:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM) // <b class="conum">(1)</b>
Publisher&lt;Event&lt;Headline&gt;&gt; streamHeadlines() {
    return Flux.&lt;Event&lt;Headline&gt;&gt;create((emitter) -&gt; {  // <b class="conum">(2)</b>
        Headline headline = new Headline();
        headline.setText("Latest Headline at " + ZonedDateTime.now());
        emitter.next(Event.of(headline));
        emitter.complete();
    }, FluxSink.OverflowStrategy.BUFFER)
            .repeat(100) // <b class="conum">(3)</b>
            .delayElements(Duration.of(1, ChronoUnit.SECONDS)); // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Get(value = "/headlines", processes = MediaType.TEXT_EVENT_STREAM) // <b class="conum">(1)</b>
Flux&lt;Event&lt;Headline&gt;&gt; streamHeadlines() {
    Flux.&lt;Event&lt;Headline&gt;&gt;create( { emitter -&gt; // <b class="conum">(2)</b>
        Headline headline = new Headline(text: "Latest Headline at ${ZonedDateTime.now()}")
        emitter.next(Event.of(headline))
        emitter.complete()
    }, FluxSink.OverflowStrategy.BUFFER)
            .repeat(100) // <b class="conum">(3)</b>
            .delayElements(Duration.of(1, ChronoUnit.SECONDS)) // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get(value = "/headlines", processes = [TEXT_EVENT_STREAM]) // <b class="conum">(1)</b>
internal fun streamHeadlines(): Flux&lt;Event&lt;Headline&gt;&gt; {
    return Flux.create&lt;Event&lt;Headline&gt;&gt;( { emitter -&gt; // <b class="conum">(2)</b>
        val headline = Headline()
        headline.text = "Latest Headline at ${ZonedDateTime.now()}"
        emitter.next(Event.of(headline))
        emitter.complete()
    }, FluxSink.OverflowStrategy.BUFFER)
        .repeat(100) // <b class="conum">(3)</b>
        .delayElements(Duration.of(1, ChronoUnit.SECONDS)) // <b class="conum">(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The controller defines a <a href="../api/io/micronaut/http/annotation/Get.html">@Get</a> annotation that produces a <code>MediaType.TEXT_EVENT_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The method uses Reactor to emit a <code>Headline</code> object</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>repeat</code> method repeats the emission 100 times</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>With a delay of one second between each</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that the return type of the controller is also <a href="../api/io/micronaut/http/sse/Event.html">Event</a> and that the <code>Event.of</code> method creates events to stream to the client.</p>
</div>
<div class="paragraph">
<p>To define a client that consumes the events, define a method that processes <code>MediaType.TEXT_EVENT_STREAM</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("/streaming/sse")
public interface HeadlineClient {

    @Get(value = "/headlines", processes = TEXT_EVENT_STREAM)
    Publisher&lt;Event&lt;Headline&gt;&gt; streamHeadlines();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Client("/streaming/sse")
interface HeadlineClient {

    @Get(value = "/headlines", processes = TEXT_EVENT_STREAM)
    Publisher&lt;Event&lt;Headline&gt;&gt; streamHeadlines()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">SSE Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Client("/streaming/sse")
interface HeadlineClient {

    @Get(value = "/headlines", processes = [TEXT_EVENT_STREAM])
    fun streamHeadlines(): Flux&lt;Event&lt;Headline&gt;&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic type of the <code>Flux</code> can be either an <a href="../api/io/micronaut/http/sse/Event.html">Event</a>, in which case you will receive the full event object, or a POJO, in which case you will receive only the data contained within the event converted from JSON.</p>
</div>
</div>

<h2 id="clientError"><a class="anchor" href="#clientError"></a>7.3.3 Error Responses</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/clientError.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If an HTTP response is returned with a code of 400 or higher, an <a href="../api/io/micronaut/http/client/exceptions/HttpClientResponseException.html">HttpClientResponseException</a> is created. The exception contains the original response. How that exception is thrown depends on the method return type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For reactive response types, the exception is passed through the publisher as an error.</p>
</li>
<li>
<p>For blocking response types, the exception is thrown and should be caught and handled by the caller.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The one exception to this rule is HTTP Not Found (404) responses. This exception only applies to the declarative client.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HTTP Not Found (404) responses for blocking return types is <strong>not</strong> considered an error condition and the client exception will <strong>not</strong> be thrown. That behavior includes methods that return <code>void</code>.</p>
</div>
<div class="paragraph">
<p>If the method returns an <code>HttpResponse</code>, the original response is returned. If the return type is <code>Optional</code>, an empty optional is returned. For all other types, <code>null</code> is returned.</p>
</div>

<h2 id="clientHeaders"><a class="anchor" href="#clientHeaders"></a>7.3.4 Customizing Request Headers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/clientHeaders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Customizing the request headers deserves special mention as there are several ways that can be accomplished.</p>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_configuration">Populating Headers Using Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation can be declared at the type level and is repeatable such that it is possible to drive the request headers sent via configuration using annotation metadata.</p>
</div>
<div class="paragraph">
<p>The following example serves to illustrate this:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("/pets")
@Header(name="X-Pet-Client", value="${pet.client.id}")
public interface PetClient extends PetOperations {

    @Override
    @SingleResult
    Publisher&lt;Pet&gt; save(String name, int age);

    @Get("/{name}")
    @SingleResult
    Publisher&lt;Pet&gt; get(String name);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Client("/pets")
@Header(name="X-Pet-Client", value='${pet.client.id}')
interface PetClient extends PetOperations {

    @Override
    @SingleResult
    Publisher&lt;Pet&gt; save(@NotBlank String name, @Min(1L) int age)

    @Get("/{name}")
    @SingleResult
    Publisher&lt;Pet&gt; get(String name)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining Headers via Configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Client("/pets")
@Header(name = "X-Pet-Client", value = "\${pet.client.id}")
interface PetClient : PetOperations {

    @SingleResult
    override fun save(name: String, age: Int): Publisher&lt;Pet&gt;

    @Get("/{name}")
    @SingleResult
    operator fun get(name: String): Publisher&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a <a href="../api/io/micronaut/http/annotation/Header.html">@Header</a> annotation on the <code>PetClient</code> interface that reads the <code>pet.client.id</code> property using property placeholder configuration.</p>
</div>
<div class="paragraph">
<p>Then set the following in your configuration file (e.g <code>application.yml</code>) to populate the value:</p>
</div>
<div class="openblock">
<div class="title">Configuring Headers</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">pet.client.id=foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">pet:
  client:
    id: foo</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[pet]
  [pet.client]
    id="foo"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">pet {
  client {
    id = "foo"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  pet {
    client {
      id = "foo"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "pet": {
    "client": {
      "id": "foo"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can supply a <code>PET_CLIENT_ID</code> environment variable and the value will be populated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_populating_headers_using_a_client_filter">Populating Headers using a Client Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alternatively, to dynamically populate headers, another option is to use a <a href="#clientFilter">Client Filter</a>.</p>
</div>
<div class="paragraph">
<p>For more information on writing client filters see the <a href="#clientFilter">Client Filters</a> section of the guide.</p>
</div>
</div>
</div>

<h2 id="clientJackson"><a class="anchor" href="#clientJackson"></a>7.3.5 Customizing Jackson Settings</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/clientJackson.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As mentioned previously, Jackson is used for message encoding to JSON. A default Jackson <code>ObjectMapper</code> is configured and used by Micronaut HTTP clients.</p>
</div>
<div class="paragraph">
<p>You can override the settings used to construct the <code>ObjectMapper</code> with properties defined by the <a href="../api/io/micronaut/jackson/JacksonConfiguration.html">JacksonConfiguration</a> class in your configuration file (e.g <code>application.yml</code>).</p>
</div>
<div class="paragraph">
<p>For example, the following configuration enables indented output for Jackson:</p>
</div>
<div class="openblock">
<div class="title">Example Jackson Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jackson.serialization.indentOutput=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jackson:
  serialization:
    indentOutput: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jackson]
  [jackson.serialization]
    indentOutput=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jackson {
  serialization {
    indentOutput = true
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jackson {
    serialization {
      indentOutput = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jackson": {
    "serialization": {
      "indentOutput": true
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, these settings apply globally and impact both how the HTTP server renders JSON and how JSON is sent from the HTTP client. Given that, sometimes it is useful to provide client-specific Jackson settings. You can do this with the <a href="../api/io/micronaut/jackson/annotation/JacksonFeatures.html">@JacksonFeatures</a> annotation on a client:</p>
</div>
<div class="paragraph">
<p>As an example, the following snippet is taken from Micronaut&#8217;s native Eureka client (which of course uses Micronaut&#8217;s HTTP client):</p>
</div>
<div class="listingblock">
<div class="title">Example of JacksonFeatures</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client(id = EurekaClient.SERVICE_ID,
        path = "/eureka",
        configuration = EurekaConfiguration.class)
@JacksonFeatures(
    enabledSerializationFeatures = WRAP_ROOT_VALUE,
    disabledSerializationFeatures = WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED,
    enabledDeserializationFeatures = {UNWRAP_ROOT_VALUE, ACCEPT_SINGLE_VALUE_AS_ARRAY}
)
public interface EurekaClient {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Eureka serialization format for JSON uses the <code>WRAP_ROOT_VALUE</code> serialization feature of Jackson, hence it is enabled just for that client.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the customization offered by <code>JacksonFeatures</code> is not enough, you can also write a <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> for the <code>ObjectMapper</code> and add whatever customizations you need.
</td>
</tr>
</table>
</div>

<h2 id="clientRetry"><a class="anchor" href="#clientRetry"></a>7.3.6 Retry and Circuit Breaker</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/clientRetry.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Recovering from failure is critical for HTTP clients, and that is where Micronaut&#8217;s integrated <a href="#retry">Retry Advice</a> comes in handy.</p>
</div>
<div class="paragraph">
<p>You can declare the <a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a> or <a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">@CircuitBreaker</a> annotations on any <a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a> interface and the retry policy will be applied, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Client("/pets")
@Retryable
public interface PetClient extends PetOperations {

    @Override
    @SingleResult
    Publisher&lt;Pet&gt; save(String name, int age);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Client("/pets")
@Retryable
interface PetClient extends PetOperations {

    @Override
    Mono&lt;Pet&gt; save(String name, int age)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Declaring @Retryable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Client("/pets")
@Retryable
interface PetClient : PetOperations {

    override fun save(name: String, age: Int): Mono&lt;Pet&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on customizing retry, see the section on <a href="#retry">Retry Advice</a>.</p>
</div>

<h2 id="clientFallback"><a class="anchor" href="#clientFallback"></a>7.3.7 Client Fallbacks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/clientFallback.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In distributed systems, failure happens and it is best to be prepared for it and handle it gracefully.</p>
</div>
<div class="paragraph">
<p>In addition, when developing Microservices it is quite common to work on a single Microservice without other Microservices the project requires being available.</p>
</div>
<div class="paragraph">
<p>With that in mind, Micronaut features a native fallback mechanism that is integrated into <a href="#retry">Retry Advice</a> that allows falling back to another implementation in the case of failure.</p>
</div>
<div class="paragraph">
<p>Using the <a href="../api/io/micronaut/retry/annotation/Fallback.html">@Fallback</a> annotation, you can declare a fallback implementation of a client to be used when all possible retries have been exhausted.</p>
</div>
<div class="paragraph">
<p>In fact the mechanism is not strictly linked to Retry; you can declare any class as <a href="../api/io/micronaut/retry/annotation/Recoverable.html">@Recoverable</a>, and if a method call fails (or, in the case of reactive types, an error is emitted) a class annotated with <code>@Fallback</code> will be searched for.</p>
</div>
<div class="paragraph">
<p>To illustrate this, consider again the <code>PetOperations</code> interface declared earlier. You can define a <code>PetFallback</code> class that will be called in the case of failure:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Fallback
public class PetFallback implements PetOperations {
    @Override
    @SingleResult
    public Publisher&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet();
        pet.setAge(age);
        pet.setName(name);
        return Mono.just(pet);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Fallback
class PetFallback implements PetOperations {
    @Override
    Mono&lt;Pet&gt; save(String name, int age) {
        Pet pet = new Pet(age: age, name: name)
        return Mono.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Defining a Fallback</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Fallback
open class PetFallback : PetOperations {
    override fun save(name: String, age: Int): Mono&lt;Pet&gt; {
        val pet = Pet()
        pet.age = age
        pet.name = name
        return Mono.just(pet)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you only need fallbacks to help with testing against external Microservices, you can define fallbacks in the <code>src/test/java</code> directory so they are not included in production code. You will have to specify <code>@Recoverable(api = PetOperations.class)</code> on the declarative client if you are using fallbacks without hystrix.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see the fallback does not perform any network operations and is quite simple, hence will provide a successful result in the case of an external system being down.</p>
</div>
<div class="paragraph">
<p>Of course, the actual behaviour of the fallback is up to you. You can for example implement a fallback that pulls data from a local cache when real data is not available, and sends alert emails or other notifications to operations about downtime.</p>
</div>

<h2 id="netflixHystrix"><a class="anchor" href="#netflixHystrix"></a>7.3.8 Netflix Hystrix Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientAnnotation/netflixHystrix.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>netflix-hystrix</code> feature to configure Hystrix in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features netflix-hystrix</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/Netflix/Hystrix">Netflix Hystrix</a> is a fault tolerance library developed by the Netflix team and is designed to improve resilience of interprocess communication.</p>
</div>
<div class="paragraph">
<p>Micronaut integrates with Hystrix through the <code>netflix-hystrix</code> module, which you can add to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.netflix:micronaut-netflix-hystrix")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.netflix&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-netflix-hystrix&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="sect1">
<h2 id="_using_the_hystrixcommand_annotation">Using the @HystrixCommand Annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the above dependency declared you can annotate any method (including methods defined on <code>@Client</code> interfaces) with the <a href="https://micronaut-projects.github.io/micronaut-netflix/latest/api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">HystrixCommand</a> annotation, and method&#8217;s execution will be wrapped in a Hystrix command. For example:</p>
</div>
<div class="listingblock">
<div class="title">Using @HystrixCommand</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@HystrixCommand
String hello(String name) {
    return "Hello $name"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This works for reactive return types such as <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a>, and the reactive type will be wrapped in a <code>HystrixObservableCommand</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <a href="https://micronaut-projects.github.io/micronaut-netflix/latest/api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">HystrixCommand</a> annotation also integrates with Micronaut&#8217;s support for <a href="#retry">Retry Advice</a> and <a href="#clientFallback">Fallbacks</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For information on how to customize the Hystrix thread pool, group, and properties, see the Javadoc for <a href="https://micronaut-projects.github.io/micronaut-netflix/latest/api/io/micronaut/configuration/hystrix/annotation/HystrixCommand.html">HystrixCommand</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_hystrix_stream_and_dashboard">Enabling Hystrix Stream and Dashboard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can enable a Server Sent Event stream to feed into the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> by setting the <code>hystrix.stream.enabled</code> setting to <code>true</code> in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Enabling Hystrix Stream</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">hystrix.stream.enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hystrix:
  stream:
    enabled: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[hystrix]
  [hystrix.stream]
    enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">hystrix {
  stream {
    enabled = true
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  hystrix {
    stream {
      enabled = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "hystrix": {
    "stream": {
      "enabled": true
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This exposes a <code>/hystrix.stream</code> endpoint with the format the <a href="https://github.com/Netflix-Skunkworks/hystrix-dashboard">Hystrix Dashboard</a> expects.</p>
</div>
</div>
</div>

<h2 id="clientFilter"><a class="anchor" href="#clientFilter"></a>7.4 HTTP Client Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientFilter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when calling another Microservice.</p>
</div>
<div class="paragraph">
<p>To simplify this, you can define <a href="../api/io/micronaut/http/filter/HttpClientFilter.html">HttpClientFilter</a> classes that are applied to all matching HTTP client requests.</p>
</div>
<div class="paragraph">
<p>As an example, say you want to build a client to communicate with the <a href="https://bintray.com/docs/api/">Bintray REST API</a>. It would be tedious to specify authentication for every single HTTP call.</p>
</div>
<div class="paragraph">
<p>To resolve this you can define a filter. The following is an example <code>BintrayService</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
class BintrayService {
    final HttpClient client;
    final String org;

    BintrayService(
            @Client(BintrayApi.URL) HttpClient client,           // <b class="conum">(1)</b>
            @Value("${bintray.organization}") String org ) {
        this.client = client;
        this.org = org;
    }

    Flux&lt;HttpResponse&lt;String&gt;&gt; fetchRepositories() {
        return Flux.from(client.exchange(HttpRequest.GET(
                "/repos/" + org), String.class)); // <b class="conum">(2)</b>
    }

    Flux&lt;HttpResponse&lt;String&gt;&gt; fetchPackages(String repo) {
        return Flux.from(client.exchange(HttpRequest.GET(
                "/repos/" + org + "/" + repo + "/packages"), String.class)); // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
class BintrayService {
    final HttpClient client
    final String org

    BintrayService(
            @Client(BintrayApi.URL) HttpClient client, // <b class="conum">(1)</b>
            @Value('${bintray.organization}') String org ) {
        this.client = client
        this.org = org
    }

    Flux&lt;HttpResponse&lt;String&gt;&gt; fetchRepositories() {
        client.exchange(HttpRequest.GET("/repos/$org"), String) // <b class="conum">(2)</b>
    }

    Flux&lt;HttpResponse&lt;String&gt;&gt; fetchPackages(String repo) {
        client.exchange(HttpRequest.GET("/repos/${org}/${repo}/packages"), String) // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class BintrayApi {
    public static final String URL = 'https://api.bintray.com'
}

@Singleton
internal class BintrayService(
    @param:Client(BintrayApi.URL) val client: HttpClient, // <b class="conum">(1)</b>
    @param:Value("\${bintray.organization}") val org: String) {

    fun fetchRepositories(): Flux&lt;HttpResponse&lt;String&gt;&gt; {
        return Flux.from(client.exchange(HttpRequest.GET&lt;Any&gt;("/repos/$org"), String::class.java)) // <b class="conum">(2)</b>
    }

    fun fetchPackages(repo: String): Flux&lt;HttpResponse&lt;String&gt;&gt; {
        return Flux.from(client.exchange(HttpRequest.GET&lt;Any&gt;("/repos/$org/$repo/packages"), String::class.java)) // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/api/io/micronaut/reactor/http/client/ReactorHttpClient.html">ReactorHttpClient</a> is injected for the Bintray API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The organization is configurable via configuration</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Bintray API is secured. To authenticate you add an <code>Authorization</code> header for every request. You can modify <code>fetchRepositories</code> and <code>fetchPackages</code> methods to include the necessary HTTP Header for each request, but using a filter is much simpler:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Filter("/repos/**") // <b class="conum">(1)</b>
class BintrayFilter implements HttpClientFilter {

    final String username;
    final String token;

    BintrayFilter(
            @Value("${bintray.username}") String username, // <b class="conum">(2)</b>
            @Value("${bintray.token}") String token ) { // <b class="conum">(2)</b>
        this.username = username;
        this.token = token;
    }

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request,
                                                         ClientFilterChain chain) {
        return chain.proceed(
                request.basicAuth(username, token) // <b class="conum">(3)</b>
        );
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Filter('/repos/**') // <b class="conum">(1)</b>
class BintrayFilter implements HttpClientFilter {

    final String username
    final String token

    BintrayFilter(
            @Value('${bintray.username}') String username, // <b class="conum">(2)</b>
            @Value('${bintray.token}') String token ) { // <b class="conum">(2)</b>
        this.username = username
        this.token = token
    }

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request,
                                                  ClientFilterChain chain) {
        chain.proceed(
                request.basicAuth(username, token) // <b class="conum">(3)</b>
        )
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Filter("/repos/**") // <b class="conum">(1)</b>
internal class BintrayFilter(
        @param:Value("\${bintray.username}") val username: String, // <b class="conum">(2)</b>
        @param:Value("\${bintray.token}") val token: String)// <b class="conum">(2)</b>
    : HttpClientFilter {

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;&gt; {
        return chain.proceed(
            request.basicAuth(username, token) // <b class="conum">(3)</b>
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can match only a subset of paths with a Client filter.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>username</code> and <code>token</code> are injected via configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>basicAuth</code> method includes HTTP Basic credentials</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now when you invoke the <code>bintrayService.fetchRepositories()</code> method, the <code>Authorization</code> HTTP header is included in the request.</p>
</div>
<div class="sect2">
<h3 id="_injecting_another_client_into_a_httpclientfilter">Injecting Another Client into a HttpClientFilter</h3>
<div class="paragraph">
<p>To create an <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/api/io/micronaut/reactor/http/client/ReactorHttpClient.html">ReactorHttpClient</a>, Micronaut needs to resolve all <code>HttpClientFilter</code> instances, which creates a circular dependency when injecting another <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/api/io/micronaut/reactor/http/client/ReactorHttpClient.html">ReactorHttpClient</a> or a <code>@Client</code> bean into an instance of a <code>HttpClientFilter</code>.</p>
</div>
<div class="paragraph">
<p>To resolve this issue, use the <a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a> interface to inject another <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/api/io/micronaut/reactor/http/client/ReactorHttpClient.html">ReactorHttpClient</a> or a <code>@Client</code> bean into an instance of <code>HttpClientFilter</code>.</p>
</div>
<div class="paragraph">
<p>The following example which implements a filter allowing <a href="https://cloud.google.com/run/docs/authenticating/service-to-service">authentication between services on Google Cloud Run</a> demonstrates how to use <a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a> to inject another client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.BeanProvider;
import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.client.HttpClient;
import io.micronaut.http.filter.ClientFilterChain;
import io.micronaut.http.filter.HttpClientFilter;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;

import java.io.UnsupportedEncodingException;
import java.net.URI;
import java.net.URLEncoder;

@Requires(env = Environment.GOOGLE_COMPUTE)
@Filter(patterns = "/google-auth/api/**")
public class GoogleAuthFilter implements HttpClientFilter {

    private final BeanProvider&lt;HttpClient&gt; authClientProvider;

    public GoogleAuthFilter(BeanProvider&lt;HttpClient&gt; httpClientProvider) { // <b class="conum">(1)</b>
        this.authClientProvider = httpClientProvider;
    }

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request,
                                                         ClientFilterChain chain) {
        return Mono.fromCallable(() -&gt; encodeURI(request))
                .flux()
                .flatMap(uri -&gt; authClientProvider.get().retrieve(HttpRequest.GET(uri) // <b class="conum">(2)</b>
                        .header("Metadata-Flavor", "Google")))
                .flatMap(t -&gt; chain.proceed(request.bearerAuth(t)));
    }

    private String encodeURI(MutableHttpRequest&lt;?&gt; request) throws UnsupportedEncodingException {
        URI fullURI = request.getUri();
        String receivingURI = fullURI.getScheme() + "://" + fullURI.getHost();
        return "http://metadata/computeMetadata/v1/instance/service-accounts/default/identity?audience=" +
                URLEncoder.encode(receivingURI, "UTF-8");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.context.BeanProvider
import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.HttpClient
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux
import reactor.core.publisher.Mono

import static io.micronaut.http.HttpRequest.GET

@Requires(env = Environment.GOOGLE_COMPUTE)
@Filter(patterns = "/google-auth/api/**")
class GoogleAuthFilter implements HttpClientFilter {

    private final BeanProvider&lt;HttpClient&gt; authClientProvider

    GoogleAuthFilter(BeanProvider&lt;HttpClient&gt; httpClientProvider) { // <b class="conum">(1)</b>
        this.authClientProvider = httpClientProvider
    }

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request,
                                                  ClientFilterChain chain) {
        Flux&lt;String&gt; token = Mono.fromCallable(() -&gt; encodeURI(request))
                .flatMap(authURI -&gt; authClientProvider.get().retrieve(GET(authURI).header( // <b class="conum">(2)</b>
                        "Metadata-Flavor", "Google"
                )))

        return token.flatMap(t -&gt; chain.proceed(request.bearerAuth(t)))
    }

    private static String encodeURI(MutableHttpRequest&lt;?&gt; request) {
        String receivingURI = "$request.uri.scheme://$request.uri.host"
        "http://metadata/computeMetadata/v1/instance/service-accounts/default/identity?audience=" +
                URLEncoder.encode(receivingURI, "UTF-8")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.BeanProvider
import io.micronaut.context.annotation.Requires
import io.micronaut.context.env.Environment
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.annotation.Filter
import io.micronaut.http.client.HttpClient
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono
import java.net.URLEncoder

@Requires(env = [Environment.GOOGLE_COMPUTE])
@Filter(patterns = ["/google-auth/api/**"])
class GoogleAuthFilter (
    private val authClientProvider: BeanProvider&lt;HttpClient&gt;) : HttpClientFilter { // <b class="conum">(1)</b>

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;,
                          chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;?&gt; {
        return Mono.fromCallable { encodeURI(request) }
            .flux()
            .map { authURI: String -&gt;
                authClientProvider.get().retrieve(HttpRequest.GET&lt;Any&gt;(authURI)
                    .header("Metadata-Flavor", "Google") // <b class="conum">(2)</b>
                )
            }.flatMap { t -&gt; chain.proceed(request.bearerAuth(t.toString())) }
    }

    private fun encodeURI(request: MutableHttpRequest&lt;*&gt;): String {
        val receivingURI = "${request.uri.scheme}://${request.uri.host}"
        return "http://metadata/computeMetadata/v1/instance/service-accounts/default/identity?audience=" +
                URLEncoder.encode(receivingURI, "UTF-8")
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a> interface is used to inject another client, avoiding a circular reference</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>get()</code> method of the <code>Provider</code> interface is used to obtain the client instance.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_filter_matching_by_annotation">Filter Matching By Annotation</h3>
<div class="paragraph">
<p>For cases where a filter should be applied to a client regardless of the URL, filters can be matched by the presence of an annotation applied to both the filter and the client. Given the following client:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;

@BasicAuth // <b class="conum">(1)</b>
@Client("/message")
public interface BasicAuthClient {

    @Get
    String getMessage();
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client

@BasicAuth // <b class="conum">(1)</b>
@Client("/message")
interface BasicAuthClient {

    @Get
    String getMessage()
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client

@BasicAuth // <b class="conum">(1)</b>
@Client("/message")
interface BasicAuthClient {

    @Get
    fun getMessage(): String
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@BasicAuth</code> annotation is applied to the client</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following filter will filter the client requests:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.HttpResponse;
import io.micronaut.http.MutableHttpRequest;
import io.micronaut.http.filter.ClientFilterChain;
import io.micronaut.http.filter.HttpClientFilter;
import org.reactivestreams.Publisher;

import jakarta.inject.Singleton;

@BasicAuth // <b class="conum">(1)</b>
@Singleton // <b class="conum">(2)</b>
public class BasicAuthClientFilter implements HttpClientFilter {

    @Override
    public Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request,
                                                         ClientFilterChain chain) {
        return chain.proceed(request.basicAuth("user", "pass"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

import jakarta.inject.Singleton

@BasicAuth // <b class="conum">(1)</b>
@Singleton // <b class="conum">(2)</b>
class BasicAuthClientFilter implements HttpClientFilter {

    @Override
    Publisher&lt;? extends HttpResponse&lt;?&gt;&gt; doFilter(MutableHttpRequest&lt;?&gt; request,
                                                  ClientFilterChain chain) {
        chain.proceed(request.basicAuth("user", "pass"))
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

import jakarta.inject.Singleton

@BasicAuth // <b class="conum">(1)</b>
@Singleton // <b class="conum">(2)</b>
class BasicAuthClientFilter : HttpClientFilter {

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;,
                          chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;&gt; {
        return chain.proceed(request.basicAuth("user", "pass"))
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The same annotation, <code>@BasicAuth</code>, is applied to the filter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Normally the <code>@Filter</code> annotation makes filters singletons by default. Because the <code>@Filter</code> annotation is not used, the desired scope must be applied</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@BasicAuth</code> annotation is just an example and can be replaced with your own.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.FilterMatcher;

import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.PARAMETER;
import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@FilterMatcher // <b class="conum">(1)</b>
@Documented
@Retention(RUNTIME)
@Target({TYPE, PARAMETER})
public @interface BasicAuth {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.FilterMatcher

import java.lang.annotation.Documented
import java.lang.annotation.Retention
import java.lang.annotation.Target

import static java.lang.annotation.ElementType.PARAMETER
import static java.lang.annotation.ElementType.TYPE
import static java.lang.annotation.RetentionPolicy.RUNTIME

@FilterMatcher // <b class="conum">(1)</b>
@Documented
@Retention(RUNTIME)
@Target([TYPE, PARAMETER])
@interface BasicAuth {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.FilterMatcher
import kotlin.annotation.AnnotationRetention.RUNTIME
import kotlin.annotation.AnnotationTarget.CLASS
import kotlin.annotation.AnnotationTarget.VALUE_PARAMETER

@FilterMatcher // <b class="conum">(1)</b>
@MustBeDocumented
@Retention(RUNTIME)
@Target(CLASS, VALUE_PARAMETER)
annotation class BasicAuth</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The only requirement for custom annotations is that the <a href="../api/io/micronaut/http/annotation/FilterMatcher.html">@FilterMatcher</a> annotation must be present</td>
</tr>
</table>
</div>
</div>

<h2 id="clientHttp2"><a class="anchor" href="#clientHttp2"></a>7.5 HTTP/2 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientHttp2.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default, Micronaut&#8217;s HTTP client is configured to support HTTP 1.1. To enable support for HTTP/2, set the supported HTTP version in configuration:</p>
</div>
<div class="openblock">
<div class="title">Enabling HTTP/2 in Clients</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.client.http-version=2.0</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    client:
      http-version: 2.0</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.client]
      http-version=2.0</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    client {
      httpVersion = 2.0
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      client {
        http-version = 2.0
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "client": {
        "http-version": 2.0
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Or by specifying the HTTP version to use when injecting the client:</p>
</div>
<div class="listingblock">
<div class="title">Injecting a HTTP/2 Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Client(httpVersion=HttpVersion.HTTP_2_0)
ReactorHttpClient client;</code></pre>
</div>
</div>

<h2 id="clientSample"><a class="anchor" href="#clientSample"></a>7.6 HTTP Client Sample</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/httpClient/clientSample.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the HTTP Client Guide (<a href="https://guides.micronaut.io/micronaut-http-client/guide/index.html">Java</a>,
<a href="https://guides.micronaut.io/micronaut-http-client-groovy/guide/index.html">Groovy</a>,
<a href="https://guides.micronaut.io/micronaut-http-client-kotlin/guide/index.html">Kotlin</a>), a step-by-step tutorial, to learn more.
</td>
</tr>
</table>
</div>

<h1 id="cloud"><a class="anchor" href="#cloud"></a>8 Cloud Native Features</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The majority of JVM frameworks in use today were designed before the rise of cloud deployments and microservice architectures. Applications built with these frameworks were intended to be deployed to traditional Java containers. As a result, cloud support in these frameworks typically comes as an add-on rather than as core design features.</p>
</div>
<div class="paragraph">
<p>Micronaut was designed from the ground up for building microservices for the cloud. As a result, many key features that typically require external libraries or services are available within your application itself. To override one of the industry&#8217;s current favorite buzzwords, Micronaut applications are "natively cloud-native".</p>
</div>
<div class="paragraph">
<p>The following are some cloud-specific features that are integrated directly into the Micronaut runtime:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributed Configuration</p>
</li>
<li>
<p>Service Discovery</p>
</li>
<li>
<p>Client-Side Load-Balancing</p>
</li>
<li>
<p>Distributed Tracing</p>
</li>
<li>
<p>Serverless Functions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Many features in Micronaut are heavily inspired by features from Spring and Grails. This is by design and helps developers who are already familiar with systems such as Spring Cloud.</p>
</div>
<div class="paragraph">
<p>The following sections cover these features and how to use them.</p>
</div>

<h2 id="cloudConfiguration"><a class="anchor" href="#cloudConfiguration"></a>8.1 Cloud Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Applications built for the Cloud often need to adapt to running in a Cloud environment, read and share configuration in a distributed manner, and externalize configuration to the environment where necessary.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="#environments">Environment</a> concept is by default Cloud platform-aware and makes a best effort to detect the underlying active environment.</p>
</div>
<div class="paragraph">
<p>You can then use the <a href="../api/io/micronaut/context/annotation/Requires.html">Requires</a> annotation to <a href="#conditionalBeans">conditionally load bean definitions</a>.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the constants in the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface and provides an example:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Micronaut Environment Detection</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Constant</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Requires Example</th>
<th class="tableblock halign-left valign-top">Environment name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#ANDROID">ANDROID</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running as an Android application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.ANDROID)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>android</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#TEST">TEST</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running within a JUnit or Spock test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.TEST)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD">CLOUD</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application is running in a Cloud environment (present for all other cloud platform types)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloud</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AMAZON_EC2">AMAZON_EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://aws.amazon.com/ec2">Amazon EC2</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AMAZON_EC2)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ec2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#GOOGLE_COMPUTE">GOOGLE_COMPUTE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://cloud.google.com/compute/">Google Compute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.GOOGLE_COMPUTE)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#KUBERNETES">KUBERNETES</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.kubernetes.io">Kubernetes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.KUBERNETES)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k8s</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#HEROKU">HEROKU</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://heroku.com">Heroku</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.HEROKU)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>heroku</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#CLOUD_FOUNDRY">CLOUD_FOUNDRY</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.cloudfoundry.org">Cloud Foundry</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.CLOUD_FOUNDRY)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pcf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#AZURE">AZURE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://azure.microsoft.com">Microsoft Azure</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.AZURE)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#IBM">IBM</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.ibm.com/cloud/">IBM Cloud</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.IBM)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ibm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#DIGITAL_OCEAN">DIGITAL_OCEAN</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://www.digitalocean.com/">Digital Ocean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.DIGITAL_OCEAN)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>digitalocean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/env/Environment.html#ORACLE_CLOUD">ORACLE_CLOUD</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running on <a href="https://cloud.oracle.com/">Oracle Cloud</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Requires(env = Environment.ORACLE_CLOUD)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oraclecloud</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that you can have multiple environments active, for example when running in Kubernetes on AWS.</p>
</div>
<div class="paragraph">
<p>In addition, using the value of the constants defined in the table above you can create environment-specific configuration files. For example if you create a <code>src/main/resources/application-gcp.yml</code> file, it is only loaded when running on Google Compute.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Any configuration property in the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> can also be set via an environment variable. For example, setting the <code>CONSUL_CLIENT_HOST</code> environment variable overrides the <code>host</code> property in <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/api/io/micronaut/discovery/consul/ConsulConfiguration.html">ConsulConfiguration</a>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_using_cloud_instance_metadata">Using Cloud Instance Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Micronaut detects it is running on a supported cloud platform, on startup it populates the interface <a href="../api/io/micronaut/discovery/cloud/ComputeInstanceMetadata.html">ComputeInstanceMetadata</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As of Micronaut 2.1.x this logic depends on the presence of the appropriate core Cloud module for Oracle Cloud, AWS, or GCP.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All this data is merged together into the <code>metadata</code> property for the running <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>To access the metadata for your application instance you can use the interface <a href="../api/io/micronaut/discovery/EmbeddedServerInstance.html">EmbeddedServerInstance</a>, and call <code>getMetadata()</code> which returns a Map of the metadata.</p>
</div>
<div class="paragraph">
<p>If you connect remotely via a client, the instance metadata can be referenced once you have retrieved a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> from either the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> or <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> APIs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Netflix Ribbon client-side load balancer can be configured to use the metadata to do zone-aware client-side load balancing. See <a href="#clientSideLoadBalancing">Client-Side Load Balancing</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To obtain metadata for a service via <a href="#serviceDiscovery">Service Discovery</a> use the <a href="../api/io/micronaut/http/client/LoadBalancerResolver.html">LoadBalancerResolver</a> interface to resolve a <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> and obtain a reference to a service by identifier:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Service instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoadBalancer loadBalancer = loadBalancerResolver.resolve("some-service");
Flux.from(
    loadBalancer.select()
).subscribe((instance) -&gt;
    ConvertibleValues&lt;String&gt; metaData = instance.getMetadata();
    ...
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/EmbeddedServerInstance.html">EmbeddedServerInstance</a> is available through event listeners that listen for the <a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a>. The <a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a> annotation makes it easy to listen for the event in your beans.</p>
</div>
<div class="paragraph">
<p>To obtain metadata for the locally running server, use an <a href="#events">EventListener</a> for the <a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a>:</p>
</div>
<div class="listingblock">
<div class="title">Obtaining Metadata for a Local Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EventListener
void onServiceStarted(ServiceReadyEvent event) {
    ServiceInstance serviceInstance = event.getSource();
    ConvertibleValues&lt;String&gt; metadata = serviceInstance.getMetadata();
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="distributedConfiguration"><a class="anchor" href="#distributedConfiguration"></a>8.1.1 Distributed Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As you can see, Micronaut features a robust system for externalizing and adapting configuration to the environment inspired by similar approaches in Grails and Spring Boot.</p>
</div>
<div class="paragraph">
<p>However, what if you want multiple microservices to share configuration? Micronaut includes APIs for distributed configuration.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> interface has a <code>getPropertySources</code> method that can be implemented to read and resolve configuration from distributed sources.</p>
</div>
<div class="paragraph">
<p>The <code>getPropertySources</code> returns a <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> that emits zero or many <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances.</p>
</div>
<div class="paragraph">
<p>The default implementation is <a href="../api/io/micronaut/discovery/config/DefaultCompositeConfigurationClient.html">DefaultCompositeConfigurationClient</a> which merges all registered <code>ConfigurationClient</code> beans into a single bean.</p>
</div>
<div class="paragraph">
<p>You can either implement your own <a href="../api/io/micronaut/discovery/config/ConfigurationClient.html">ConfigurationClient</a> or use the implementations provided by Micronaut. The following sections cover those.</p>
</div>

<h2 id="distributedConfigurationConsul"><a class="anchor" href="#distributedConfigurationConsul"></a>8.1.2 HashiCorp Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.consul.io">Consul</a> is a popular Service Discovery and Distributed Configuration server provided by HashiCorp. Micronaut features a native <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/api/io/micronaut/discovery/consul/client/v1/ConsulClient.html">ConsulClient</a> that uses Micronaut&#8217;s support for <a href="#clientAnnotation">Declarative HTTP Clients</a>.</p>
</div>
<div class="sect1">
<h2 id="_starting_consul">Starting Consul</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quickest way to start using Consul is via Docker:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Starting Consul with Docker</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.consul.io/docs/install">install and run a local Consul instance</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_distributed_configuration_with_consul">Enabling Distributed Configuration with Consul</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>config-consul</code> feature to enable Consul&#8217;s distributed configuration in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features config-consul</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable distributed configuration make sure <a href="#bootstrap">[bootstrap]</a> is enabled and create a <code>src/main/resources/bootstrap.[yml/toml/properties]</code> file with the following configuration:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.application.name=hello-world
micronaut.config-client.enabled=true
consul.client.defaultZone=${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: hello-world
  config-client:
    enabled: true
consul:
  client:
    defaultZone: "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.application]
    name="hello-world"
  [micronaut.config-client]
    enabled=true
[consul]
  [consul.client]
    defaultZone="${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  application {
    name = "hello-world"
  }
  configClient {
    enabled = true
  }
}
consul {
  client {
    defaultZone = "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    application {
      name = "hello-world"
    }
    config-client {
      enabled = true
    }
  }
  consul {
    client {
      defaultZone = "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "application": {
      "name": "hello-world"
    },
    "config-client": {
      "enabled": true
    }
  },
  "consul": {
    "client": {
      "defaultZone": "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After enabling distributed configuration, store the configuration to share in Consul&#8217;s key/value store. There are a number of ways to do that.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_keyvalue_pairs">Storing Configuration as Key/Value Pairs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One way is to store the keys and values directly in Consul. In this case by default Micronaut looks for configuration in the Consul <code>/config</code> directory.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can alter the path searched for by setting <code>consul.client.config.path</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Within the <code>/config</code> directory Micronaut searches values within the following directories in order of precedence:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application,prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for the <code>prod</code> <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-specific configuration, example <code>/config/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME],prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-specific configuration for an active <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The value of <code>APPLICATION_NAME</code> is whatever your have configured <code>micronaut.application.name</code> to be in your <code>bootstrap</code> configuration file.</p>
</div>
<div class="paragraph">
<p>To see this in action, use the following cURL command to store a property called <code>foo.bar</code> with a value of <code>myvalue</code> in the directory <code>/config/application</code>.</p>
</div>
<div class="listingblock">
<div class="title">Using cURL to Write a Value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X PUT -d @- localhost:8500/v1/kv/config/application/foo.bar &lt;&lt;&lt; myvalue</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you now define a <code>@Value("${foo.bar}")</code> or call <code>environment.getProperty(..)</code> the value <code>myvalue</code> will be resolved from Consul.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_in_yaml_json_etc">Storing Configuration in YAML, JSON etc.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some Consul users prefer storing configuration in blobs of a certain format, such as YAML. Micronaut supports this mode and supports storing configuration in either YAML, JSON, or Java properties format.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="../api/io/micronaut/discovery/config/ConfigDiscoveryConfiguration.html">ConfigDiscoveryConfiguration</a> has a number of configuration options for configuring how distributed configuration is discovered.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can set the <code>consul.client.config.format</code> option to configure the format with which properties are read.</p>
</div>
<div class="paragraph">
<p>For example, to configure JSON:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">consul.client.config.format=JSON</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">consul:
  client:
    config:
      format: JSON</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[consul]
  [consul.client]
    [consul.client.config]
      format="JSON"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">consul {
  client {
    config {
      format = "JSON"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  consul {
    client {
      config {
        format = "JSON"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "consul": {
    "client": {
      "config": {
        "format": "JSON"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now write your configuration in JSON format to Consul:</p>
</div>
<div class="listingblock">
<div class="title">Using cURL to write JSON</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X PUT  localhost:8500/v1/kv/config/application \
-d @- &lt;&lt; EOF
{ "foo": {  "bar": "myvalue" } }
EOF</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_configuration_as_file_references">Storing Configuration as File References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another popular option is <a href="https://github.com/breser/git2consul">git2consul</a> which mirrors the contents of a Git repository to Consul&#8217;s key/value store.</p>
</div>
<div class="paragraph">
<p>You can setup a Git repository that contains files like <code>application.yml</code>, <code>hello-world-test.json</code>, etc., and the contents of these files will be cloned to Consul.</p>
</div>
<div class="paragraph">
<p>In this case, each key in Consul represents a file with an extension, for example <code>/config/application.yml</code>, and you must configure the <code>FILE</code> format:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">consul.client.config.format=FILE</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">consul:
  client:
    config:
      format: FILE</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[consul]
  [consul.client]
    [consul.client.config]
      format="FILE"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">consul {
  client {
    config {
      format = "FILE"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  consul {
    client {
      config {
        format = "FILE"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "consul": {
    "client": {
      "config": {
        "format": "FILE"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>

<h2 id="distributedConfigurationVault"><a class="anchor" href="#distributedConfigurationVault"></a>8.1.3 HashiCorp Vault Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationVault.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut integrates with <a href="https://www.vaultproject.io/">HashiCorp Vault</a> as a distributed configuration source.</p>
</div>
<div class="paragraph">
<p>To enable distributed configuration make sure <a href="#bootstrap">[bootstrap]</a> is enabled and create a <code>src/main/resources/bootstrap.[yml/toml/properties]</code> file with the following configuration:</p>
</div>
<div class="openblock">
<div class="title">Integrating with HashiCorp Vault</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.application.name=hello-world
micronaut.config-client.enabled=true
vault.client.config.enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: hello-world
  config-client:
    enabled: true

vault:
  client:
    config:
      enabled: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.application]
    name="hello-world"
  [micronaut.config-client]
    enabled=true
[vault]
  [vault.client]
    [vault.client.config]
      enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  application {
    name = "hello-world"
  }
  configClient {
    enabled = true
  }
}
vault {
  client {
    config {
      enabled = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    application {
      name = "hello-world"
    }
    config-client {
      enabled = true
    }
  }
  vault {
    client {
      config {
        enabled = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "application": {
      "name": "hello-world"
    },
    "config-client": {
      "enabled": true
    }
  },
  "vault": {
    "client": {
      "config": {
        "enabled": true
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/guide/configurationreference.html#io.micronaut.discovery.vault.config.VaultClientConfiguration">configuration reference</a> for all configuration options.</p>
</div>
<div class="paragraph">
<p>Micronaut uses the configured <code>micronaut.application.name</code> to lookup property sources for the application from Vault.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-specific configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/application/[ENV_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for an active environment name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/[APPLICATION_NAME]/[ENV_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-specific configuration for an active environment name</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="https://www.vaultproject.io/api-docs/secret/kv">Documentation for HashiCorp Vault</a> for more information on how to setup the server.</p>
</div>

<h2 id="distributedConfigurationSpringCloud"><a class="anchor" href="#distributedConfigurationSpringCloud"></a>8.1.4 Spring Cloud Config Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationSpringCloud.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.1, Micronaut features a native <a href="https://spring.io/projects/spring-cloud-config">Spring Cloud Configuration</a> for those who have not switched to a dedicated more complete solution like Consul.</p>
</div>
<div class="paragraph">
<p>To enable distributed configuration make sure <a href="#bootstrap">[bootstrap]</a> is enabled and create a <code>src/main/resources/bootstrap.[yml/toml/properties]</code> file with the following configuration:</p>
</div>
<div class="openblock">
<div class="title">Integrating with Spring Cloud Configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.application.name=hello-world
micronaut.config-client.enabled=true
spring.cloud.config.enabled=true
spring.cloud.config.uri=http://localhost:8888/
spring.cloud.config.retry-attempts=4
spring.cloud.config.retry-delay=2s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: hello-world
  config-client:
    enabled: true
spring:
  cloud:
    config:
      enabled: true
      uri: http://localhost:8888/
      retry-attempts: 4
      retry-delay: 2s</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.application]
    name="hello-world"
  [micronaut.config-client]
    enabled=true
[spring]
  [spring.cloud]
    [spring.cloud.config]
      enabled=true
      uri="http://localhost:8888/"
      retry-attempts=4
      retry-delay="2s"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  application {
    name = "hello-world"
  }
  configClient {
    enabled = true
  }
}
spring {
  cloud {
    config {
      enabled = true
      uri = "http://localhost:8888/"
      retryAttempts = 4
      retryDelay = "2s"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    application {
      name = "hello-world"
    }
    config-client {
      enabled = true
    }
  }
  spring {
    cloud {
      config {
        enabled = true
        uri = "http://localhost:8888/"
        retry-attempts = 4
        retry-delay = "2s"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "application": {
      "name": "hello-world"
    },
    "config-client": {
      "enabled": true
    }
  },
  "spring": {
    "cloud": {
      "config": {
        "enabled": true,
        "uri": "http://localhost:8888/",
        "retry-attempts": 4,
        "retry-delay": "2s"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>retry-attempts</code> is optional, and specifies the number of times to retry</p>
</li>
<li>
<p><code>retry-delay</code> is optional, and specifies the delay between retries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut uses the configured <code>micronaut.application.name</code> to look up property sources for the application from Spring Cloud config server configured via <code>spring.cloud.config.uri</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://spring.io/projects/spring-cloud-config#learn">Documentation for Spring Cloud Config Server</a> for more information on how to set up the server.</p>
</div>

<h2 id="distributedConfigurationAwsParameterStore"><a class="anchor" href="#distributedConfigurationAwsParameterStore"></a>8.1.5 AWS Parameter Store Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationAwsParameterStore.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports configuration sharing via AWS System Manager Parameter Store. You need the following dependencies configured:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.aws:micronaut-aws-parameter-store")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-parameter-store&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>To enable distributed configuration, make sure <a href="https://docs.micronaut.io/latest/guide/#bootstrap">bootstrap</a> is enabled and create a <code>src/main/resources/bootstrap.yml</code> file with the following configuration:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.application.name=hello-world
micronaut.config-client.enabled=true
aws.client.system-manager.parameterstore.enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: hello-world
  config-client:
    enabled: true
aws:
  client:
    system-manager:
      parameterstore:
        enabled: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.application]
    name="hello-world"
  [micronaut.config-client]
    enabled=true
[aws]
  [aws.client]
    [aws.client.system-manager]
      [aws.client.system-manager.parameterstore]
        enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  application {
    name = "hello-world"
  }
  configClient {
    enabled = true
  }
}
aws {
  client {
    systemManager {
      parameterstore {
        enabled = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    application {
      name = "hello-world"
    }
    config-client {
      enabled = true
    }
  }
  aws {
    client {
      system-manager {
        parameterstore {
          enabled = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "application": {
      "name": "hello-world"
    },
    "config-client": {
      "enabled": true
    }
  },
  "aws": {
    "client": {
      "system-manager": {
        "parameterstore": {
          "enabled": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/configurationreference.html#io.micronaut.discovery.aws.parameterstore.AWSParameterStoreConfiguration">configuration reference</a> for all configuration options.</p>
</div>
<div class="paragraph">
<p>You can configure shared properties from the AWS Console &#8594; System Manager &#8594; Parameter Store.</p>
</div>
<div class="paragraph">
<p>Micronaut uses a hierarchy to read configuration values, and supports <code>String</code>, <code>StringList</code>, and <code>SecureString</code> types.</p>
</div>
<div class="paragraph">
<p>You can create environment-specific configurations as well by including the environment name after an underscore <code>_</code>. For example if <code>micronaut.application.name</code> is set to <code>helloworld</code>, specifying configuration values under <code>helloworld_test</code> will be applied only to the <code>test</code> environment.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Resolution Precedence</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-specific configuration, example <code>/config/hello-world</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/application_prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration shared by all applications for the <code>prod</code> <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/config/[APPLICATION_NAME]_prod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application-specific configuration for an active <a href="../api/io/micronaut/context/env/Environment.html">Environment</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, if the configuration name <code>/config/application_test/server.url</code> is configured in AWS Parameter Store, any application connecting to that parameter store can retrieve the value using <code>server.url</code>. If the application has <code>micronaut.application.name</code> configured to be <code>myapp</code>, a value with the name <code>/config/myapp_test/server.url</code> overrides the value just for that application.</p>
</div>
<div class="paragraph">
<p>Each level of the tree can be composed of key=value pairs. For multiple key/value pairs, set the type to <code>StringList</code>.</p>
</div>
<div class="paragraph">
<p>For special secure information, such as keys or passwords, use the type <code>SecureString</code>. KMS will be automatically invoked when you add and retrieve values, and will decrypt them with the default key store for your account. If you set the configuration to not use secure strings, they will be returned to you encrypted and you must manually decrypt them.</p>
</div>

<h2 id="distributedConfigurationOracleCloudVault"><a class="anchor" href="#distributedConfigurationOracleCloudVault"></a>8.1.6 Oracle Cloud Vault Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationOracleCloudVault.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-oracle-cloud/latest/guide/#vault">Secure Distributed Configuration with Oracle Cloud Vault</a> documentation.</p>
</div>

<h2 id="distributedConfigurationPubSub"><a class="anchor" href="#distributedConfigurationPubSub"></a>8.1.7 Google Cloud Pub/Sub Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationPubSub.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#distributedConfiguration" target="_blank" rel="noopener">Micronaut GCP Pub/Sub</a> documentation.</p>
</div>

<h2 id="distributedConfigurationKubernetes"><a class="anchor" href="#distributedConfigurationKubernetes"></a>8.1.8 Kubernetes Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/cloudConfiguration/distributedConfigurationKubernetes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-kubernetes/latest/guide/#config-client" target="_blank" rel="noopener">Kubernetes Configuration Client</a> documentation.</p>
</div>

<h2 id="serviceDiscovery"><a class="anchor" href="#serviceDiscovery"></a>8.2 Service Discovery</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/serviceDiscovery.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Service Discovery enables Microservices to find each other without knowing the physical location or IP address of associated services.</p>
</div>
<div class="paragraph">
<p>Micronaut integrates with multiple tools and libraries. See
<a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/guide/">Micronaut Service Discovery documentation</a>
for more details.</p>
</div>

<h2 id="serviceDiscoveryConsul"><a class="anchor" href="#serviceDiscoveryConsul"></a>8.2.1 Consul Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryConsul.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/guide/index.html#serviceDiscoveryConsul">Micronaut Consul documentation</a>.</p>
</div>

<h2 id="serviceDiscoveryEureka"><a class="anchor" href="#serviceDiscoveryEureka"></a>8.2.2 Eureka Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryEureka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-discovery-client/latest/guide/index.html#serviceDiscoveryEureka">Micronaut Eureka documentation</a>.</p>
</div>

<h2 id="serviceDiscoveryKubernetes"><a class="anchor" href="#serviceDiscoveryKubernetes"></a>8.2.3 Kubernetes Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryKubernetes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Kubernetes is a container runtime with many features including integrated Service Discovery and Distributed Configuration.</p>
</div>
<div class="paragraph">
<p>Micronaut includes first-class integration with Kubernetes. See the <a href="https://micronaut-projects.github.io/micronaut-kubernetes/latest/guide/index.html">Micronaut Kubernetes documentation</a> for more details.</p>
</div>

<h2 id="serviceDiscoveryRoute53"><a class="anchor" href="#serviceDiscoveryRoute53"></a>8.2.4 AWS Route 53 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryRoute53.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use <a href="https://aws.amazon.com/route53/">Route 53 Service Discovery</a>, you must meet the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run EC2 instances of some type</p>
</li>
<li>
<p>Have a domain name hosted in Route 53</p>
</li>
<li>
<p>Have a newer version of AWS-CLI (such as 14+)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assuming you have those things, you are ready. It is not as fancy as Consul or Eureka, but other than some initial setup with the AWS-CLI, there is no other software running to go wrong. You can even support health checks if you add a custom health check to your service. To test if your account can create and use Service Discovery, see the Integration Test section. More information is available at <a href="https://docs.aws.amazon.com/Route53/latest/APIReference/overview-service-discovery.html" class="bare">https://docs.aws.amazon.com/Route53/latest/APIReference/overview-service-discovery.html</a>.</p>
</div>
<div class="paragraph">
<p>Here are the steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use AWS-CLI to create a namespace. You can make either a public or private one depending on the IPs or subnets you use</p>
</li>
<li>
<p>Create a service with DNS Records with AWS-CLI command</p>
</li>
<li>
<p>Add health checks or custom health checks (optional)</p>
</li>
<li>
<p>Add Service ID to your application configuration file like so:</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="title">Sample application configuration</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">aws.route53.registration.enabled=true
aws.route53.registration.aws-service-id=srv-978fs98fsdf
aws.route53.registration.namespace=micronaut.io
micronaut.application.name=something</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">aws:
  route53:
    registration:
        enabled: true
        aws-service-id: srv-978fs98fsdf
        namespace: micronaut.io
micronaut:
  application:
    name: something</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[aws]
  [aws.route53]
    [aws.route53.registration]
      enabled=true
      aws-service-id="srv-978fs98fsdf"
      namespace="micronaut.io"
[micronaut]
  [micronaut.application]
    name="something"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">aws {
  route53 {
    registration {
      enabled = true
      awsServiceId = "srv-978fs98fsdf"
      namespace = "micronaut.io"
    }
  }
}
micronaut {
  application {
    name = "something"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  aws {
    route53 {
      registration {
        enabled = true
        aws-service-id = "srv-978fs98fsdf"
        namespace = "micronaut.io"
      }
    }
  }
  micronaut {
    application {
      name = "something"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "aws": {
    "route53": {
      "registration": {
        "enabled": true,
        "aws-service-id": "srv-978fs98fsdf",
        "namespace": "micronaut.io"
      }
    }
  },
  "micronaut": {
    "application": {
      "name": "something"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you have the following dependencies in your build file:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.aws:micronaut-aws-route53")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.aws&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-aws-route53&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the client side, you need the same dependencies and fewer configuration options:</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">aws.route53.discovery.client.enabled=true
aws.route53.discovery.client.aws-service-id=srv-978fs98fsdf
aws.route53.discovery.client.namespace-id=micronaut.io</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">aws:
  route53:
    discovery:
      client:
        enabled: true
        aws-service-id: srv-978fs98fsdf
        namespace-id: micronaut.io</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[aws]
  [aws.route53]
    [aws.route53.discovery]
      [aws.route53.discovery.client]
        enabled=true
        aws-service-id="srv-978fs98fsdf"
        namespace-id="micronaut.io"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">aws {
  route53 {
    discovery {
      client {
        enabled = true
        awsServiceId = "srv-978fs98fsdf"
        namespaceId = "micronaut.io"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  aws {
    route53 {
      discovery {
        client {
          enabled = true
          aws-service-id = "srv-978fs98fsdf"
          namespace-id = "micronaut.io"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "aws": {
    "route53": {
      "discovery": {
        "client": {
          "enabled": true,
          "aws-service-id": "srv-978fs98fsdf",
          "namespace-id": "micronaut.io"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can then use the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> API to find other services registered via Route 53. For example:</p>
</div>
<div class="listingblock">
<div class="title">Sample code for client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DiscoveryClient discoveryClient = embeddedServer.getApplicationContext().getBean(DiscoveryClient.class);
List&lt;String&gt; serviceIds = Flux.from(discoveryClient.getServiceIds()).blockFirst();
List&lt;ServiceInstance&gt; instances = Flux.from(discoveryClient.getInstances(serviceIds.get(0))).blockFirst();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_namespace">Creating the Namespace</h4>
<div class="paragraph">
<p>Namespaces are similar to a regular Route53 hosted zone, and they appear in the Route53 console, but the console doesn&#8217;t support modifying them. You must use the AWS-CLI at this time for any Service Discovery functionality.</p>
</div>
<div class="paragraph">
<p>First decide if you are creating a public-facing namespace or a private one, as the commands are different:</p>
</div>
<div class="listingblock">
<div class="title">Creating Namespace</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws servicediscovery create-public-dns-namespace --name micronaut.io --create-request-id create-1522767790 --description adescriptionhere

or

$ aws servicediscovery create-private-dns-namespace --name micronaut.internal.io --create-request-id create-1522767790 --description adescriptionhere --vpc yourvpcID</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run this you will get an operation ID. You can check the status with the <code>get-operation</code> CLI command:</p>
</div>
<div class="listingblock">
<div class="title">Get Operation Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws servicediscovery get-operation --operation-id asdffasdfsda</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this command to get the status of any call you make that returns an operation ID.</p>
</div>
<div class="paragraph">
<p>The result of the command will tell you the ID of the namespace. Write that down, you&#8217;ll need it for the next steps. If you get an error it will say what the error was.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_service_and_dns_records">Creating the Service and DNS Records</h4>
<div class="paragraph">
<p>The next step is creating the Service and DNS records.</p>
</div>
<div class="listingblock">
<div class="title">Create Service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ aws create-service --name yourservicename --create-request-id somenumber --description someservicedescription --dns-config NamespaceId=yournamespaceid,RoutingPolicy=WEIGHTED,DnsRecords=[{Type=A,TTL=1000},{Type=A,TTL=1000}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DnsRecord</code> type can be <code>A</code>(ipv4),<code>AAAA</code>(ipv6),<code>SRV</code>, or <code>CNAME</code>. <code>RoutingPolicy</code> can be <code>WEIGHTED</code> or <code>MULTIVALUE</code>. Keep in mind <code>CNAME</code> must use weighted routing type, <code>SRV</code> must have a valid port configured.</p>
</div>
<div class="paragraph">
<p>To add a health check, use the following syntax on the CLI:</p>
</div>
<div class="listingblock">
<div class="title">Specifying a Health Check</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Type=string,ResourcePath=string,FailureThreshold=integer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Type can be 'HTTP','HTTPS', or 'TCP'. You can only use a standard health check on a public namespace. See Custom Health Checks for private namespaces. Resource path should be a URL that returns <code>200 OK</code> if it is healthy.</p>
</div>
<div class="paragraph">
<p>For a custom health check, you only need to specify <code>--health-check-custom-config FailureThreshold=integer</code> which works on private namespaces as well.</p>
</div>
<div class="paragraph">
<p>This is also good because Micronaut sends out pulsation commands to let AWS know the instance is still healthy.</p>
</div>
<div class="paragraph">
<p>For more help run 'aws discoveryservice create-service help'.</p>
</div>
<div class="paragraph">
<p>You will get a service ID and an ARN back from this command if successful. Write that down, it is going to go into the Micronaut configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_the_configuration_in_micronaut">Setting up the configuration in Micronaut</h4>

</div>
<div class="sect3">
<h4 id="_auto_naming_registration">Auto Naming Registration</h4>
<div class="paragraph">
<p>Add the configuration to make your applications register with Route 53 Auto-discovery:</p>
</div>
<div class="openblock">
<div class="title">Registration Properties</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">aws.route53.registration.enabled=true
aws.route53.registration.aws-service-id=&lt;enter the service id you got after creation on aws cli&gt;
aws.route53.discovery.namespace-id=&lt;enter the namespace id you got after creating the namespace&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">aws:
  route53:
    registration:
      enabled: true
      aws-service-id: &lt;enter the service id you got after creation on aws cli&gt;
    discovery:
      namespace-id: &lt;enter the namespace id you got after creating the namespace&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[aws]
  [aws.route53]
    [aws.route53.registration]
      enabled=true
      aws-service-id="&lt;enter the service id you got after creation on aws cli&gt;"
    [aws.route53.discovery]
      namespace-id="&lt;enter the namespace id you got after creating the namespace&gt;"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">aws {
  route53 {
    registration {
      enabled = true
      awsServiceId = "&lt;enter the service id you got after creation on aws cli&gt;"
    }
    discovery {
      namespaceId = "&lt;enter the namespace id you got after creating the namespace&gt;"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  aws {
    route53 {
      registration {
        enabled = true
        aws-service-id = "&lt;enter the service id you got after creation on aws cli&gt;"
      }
      discovery {
        namespace-id = "&lt;enter the namespace id you got after creating the namespace&gt;"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "aws": {
    "route53": {
      "registration": {
        "enabled": true,
        "aws-service-id": "&lt;enter the service id you got after creation on aws cli&gt;"
      },
      "discovery": {
        "namespace-id": "&lt;enter the namespace id you got after creating the namespace&gt;"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discovery_client_configuration">Discovery Client Configuration</h4>
<div class="openblock">
<div class="title">Discovery Properties</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">aws.route53.discovery.client.enabled=true
aws.route53.discovery.client.aws-service-id=&lt;enter the service id you got after creation on aws cli&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">aws:
  route53:
    discovery:
      client:
        enabled: true
        aws-service-id: &lt;enter the service id you got after creation on aws cli&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[aws]
  [aws.route53]
    [aws.route53.discovery]
      [aws.route53.discovery.client]
        enabled=true
        aws-service-id="&lt;enter the service id you got after creation on aws cli&gt;"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">aws {
  route53 {
    discovery {
      client {
        enabled = true
        awsServiceId = "&lt;enter the service id you got after creation on aws cli&gt;"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  aws {
    route53 {
      discovery {
        client {
          enabled = true
          aws-service-id = "&lt;enter the service id you got after creation on aws cli&gt;"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "aws": {
    "route53": {
      "discovery": {
        "client": {
          "enabled": true,
          "aws-service-id": "&lt;enter the service id you got after creation on aws cli&gt;"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also call the following methods by getting the bean "Route53AutoNamingClient":</p>
</div>
<div class="listingblock">
<div class="title">Discovery Methods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// if serviceId is null it will use property "aws.route53.discovery.client.awsServiceId"
Publisher&lt;List&lt;ServiceInstance&gt;&gt; getInstances(String serviceId)
// reads property "aws.route53.discovery.namespaceId"
Publisher&lt;List&lt;String&gt;&gt; getServiceIds()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integration_tests">Integration Tests</h4>
<div class="paragraph">
<p>If you set the environment variable AWS_SUBNET_ID and have credentials configured in your home directory that are valid (in <code>~/.aws/credentials</code>) you can run the integration tests. You need a domain hosted on Route53 as well. This test will create a t2.nano instance, a namespace, service, and register that instance to service discovery. When the test completes it will remove/terminate all resources it spun up.</p>
</div>
</div>

<h2 id="serviceDiscoveryManual"><a class="anchor" href="#serviceDiscoveryManual"></a>8.2.5 Manual Service Discovery Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/serviceDiscovery/serviceDiscoveryManual.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you do not wish to involve a service discovery server like Consul or you interact with a third-party service that cannot register with Consul you can instead manually configure services that are available via Service discovery.</p>
</div>
<div class="paragraph">
<p>To do this, use the <code>micronaut.http.services</code> setting. For example:</p>
</div>
<div class="openblock">
<div class="title">Manually configuring services</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.services.foo.urls[0]=http://foo1
micronaut.http.services.foo.urls[1]=http://foo2</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    services:
      foo:
        urls:
          - http://foo1
          - http://foo2</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.services]
      [micronaut.http.services.foo]
        urls=[
          "http://foo1",
          "http://foo2"
        ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    services {
      foo {
        urls = ["http://foo1", "http://foo2"]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      services {
        foo {
          urls = ["http://foo1", "http://foo2"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "services": {
        "foo": {
          "urls": ["http://foo1", "http://foo2"]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can then inject a client with <code>@Client("foo")</code> and it will use the above configuration to load balance between the two configured servers.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When using <code>@Client</code> with service discovery, the service id must be specified in the annotation in kebab-case. The configuration in the example above however can be in camel case.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can override this configuration in production by specifying an environment variable such as <code>MICRONAUT_HTTP_SERVICES_FOO_URLS=http://prod1,http://prod2</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that by default no health checking will happen to assert that the referenced services are operational. You can alter that by enabling health checking and optionally specifying a health check path (the default is <code>/health</code>):</p>
</div>
<div class="openblock">
<div class="title">Enabling Health Checking</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.services.foo.health-check=true
micronaut.http.services.foo.health-check-interval=15s
micronaut.http.services.foo.health-check-uri=/health</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    services:
      foo:
        health-check: true
        health-check-interval: 15s
        health-check-uri: /health</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.services]
      [micronaut.http.services.foo]
        health-check=true
        health-check-interval="15s"
        health-check-uri="/health"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    services {
      foo {
        healthCheck = true
        healthCheckInterval = "15s"
        healthCheckUri = "/health"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      services {
        foo {
          health-check = true
          health-check-interval = "15s"
          health-check-uri = "/health"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "services": {
        "foo": {
          "health-check": true,
          "health-check-interval": "15s",
          "health-check-uri": "/health"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>health-check</code> indicates whether to health check the service</p>
</li>
<li>
<p><code>health-check-interval</code> is the interval between checks</p>
</li>
<li>
<p><code>health-check-uri</code> specifies the endpoint URI of the health check request</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Micronaut starts a background thread to check the health status of the service and if any of the configured services respond with an error code, they are removed from the list of available services.</p>
</div>

<h2 id="clientSideLoadBalancing"><a class="anchor" href="#clientSideLoadBalancing"></a>8.3 Client Side Load Balancing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/clientSideLoadBalancing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When <a href="#serviceDiscovery">discovering services</a> from Consul, Eureka, or other Service Discovery servers, the <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> emits a list of available <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut by default automatically performs Round Robin client-side load balancing using the servers in this list. This combined with <a href="#retry">Retry Advice</a> adds extra resiliency to your Microservice infrastructure.</p>
</div>
<div class="paragraph">
<p>The load balancing is handled by the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface, which has a <a href="../api/io/micronaut/http/client/LoadBalancer.html#select--">LoadBalancer.select()</a> method that returns a <code>Publisher</code> which emits a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Publisher.html">Publisher</a> is returned because the process for selecting a <a href="../api/io/micronaut/discovery/ServiceInstance.html">ServiceInstance</a> may result in a network operation depending on the <a href="#serviceDiscovery">Service Discovery</a> strategy employed.</p>
</div>
<div class="paragraph">
<p>The default implementation of the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> interface is <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientRoundRobinLoadBalancer.html">DiscoveryClientRoundRobinLoadBalancer</a>. You can replace this strategy with another implementation to customize how client side load balancing is handled in Micronaut, since there are many different ways to optimize load balancing.</p>
</div>
<div class="paragraph">
<p>For example, you may wish to load balance between services in a particular zone, or to load balance between servers that have the best overall response time.</p>
</div>
<div class="paragraph">
<p>To replace the <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a>, define a bean that <a href="#replaces">replaces</a> the <a href="../api/io/micronaut/http/client/loadbalance/DiscoveryClientLoadBalancerFactory.html">DiscoveryClientLoadBalancerFactory</a>.</p>
</div>
<div class="paragraph">
<p>In fact that is exactly what the Netflix Ribbon support does, described in the next section.</p>
</div>

<h2 id="netflixRibbon"><a class="anchor" href="#netflixRibbon"></a>8.3.1 Netflix Ribbon Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/clientSideLoadBalancing/netflixRibbon.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>netflix-ribbon</code> feature to configure Netflix Ribbon in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features netflix-ribbon</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/Netflix/ribbon">Netflix Ribbon</a> is an inter-process communication library used at Netflix with support for customizable load balancing strategies.</p>
</div>
<div class="paragraph">
<p>If you need more flexibility in how your application performs client-side load balancing, you can use Micronaut&#8217;s Netflix Ribbon support.</p>
</div>
<div class="paragraph">
<p>To add Ribbon support to your application, add the <code>netflix-ribbon</code> configuration to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.netflix:micronaut-netflix-ribbon")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.netflix&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-netflix-ribbon&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/client/LoadBalancer.html">LoadBalancer</a> implementations will now be <a href="https://micronaut-projects.github.io/micronaut-netflix/latest/api/io/micronaut/configuration/ribbon/RibbonLoadBalancer.html">RibbonLoadBalancer</a> instances.</p>
</div>
<div class="paragraph">
<p>Ribbon&#8217;s <a href="https://netflix.github.io/ribbon/ribbon-core-javadoc/com/netflix/client/config/CommonClientConfigKey.html">Configuration options</a> can be set using the <code>ribbon</code> namespace in configuration. For example in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Configuring Ribbon</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">ribbon.VipAddress=test
ribbon.ServerListRefreshInterval=2000</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ribbon:
  VipAddress: test
  ServerListRefreshInterval: 2000</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[ribbon]
  VipAddress="test"
  ServerListRefreshInterval=2000</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">ribbon {
  VipAddress = "test"
  ServerListRefreshInterval = 2000
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  ribbon {
    VipAddress = "test"
    ServerListRefreshInterval = 2000
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "ribbon": {
    "VipAddress": "test",
    "ServerListRefreshInterval": 2000
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Each discovered client can also be configured under <code>ribbon.clients</code>. For example given a <code>@Client(id = "hello-world")</code> you can configure Ribbon settings with:</p>
</div>
<div class="openblock">
<div class="title">Per Client Ribbon Settings</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">ribbon.clients.hello-world.VipAddress=test
ribbon.clients.hello-world.ServerListRefreshInterval=2000</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">ribbon:
  clients:
    hello-world:
      VipAddress: test
      ServerListRefreshInterval: 2000</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[ribbon]
  [ribbon.clients]
    [ribbon.clients.hello-world]
      VipAddress="test"
      ServerListRefreshInterval=2000</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">ribbon {
  clients {
    helloWorld {
      VipAddress = "test"
      ServerListRefreshInterval = 2000
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  ribbon {
    clients {
      hello-world {
        VipAddress = "test"
        ServerListRefreshInterval = 2000
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "ribbon": {
    "clients": {
      "hello-world": {
        "VipAddress": "test",
        "ServerListRefreshInterval": 2000
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut registers a <a href="https://micronaut-projects.github.io/micronaut-netflix/latest/api/io/micronaut/configuration/ribbon/DiscoveryClientServerList.html">DiscoveryClientServerList</a> for each client that integrates Ribbon with Micronaut&#8217;s <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a>.</p>
</div>

<h2 id="distributedTracing"><a class="anchor" href="#distributedTracing"></a>8.4 Distributed Tracing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cloud/distributedTracing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-tracing/latest/guide/">Micronaut Tracing</a> for more information adding distributed tracing to your applications.</p>
</div>

<h1 id="serverlessFunctions"><a class="anchor" href="#serverlessFunctions"></a>9 Serverless Functions</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/serverlessFunctions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Serverless architectures, where you deploy functions that are fully managed by a Cloud environment and are executed in ephemeral processes, require a unique approach.</p>
</div>
<div class="paragraph">
<p>Traditional frameworks like Grails and Spring are not really suitable since low memory consumption and fast startup time are critical, since the Function as a Service (FaaS) server typically spins up your function for a period using a cold start and then keeps it warm.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s compile-time approach, fast startup time, and low memory footprint make it a great candidate for developing functions, and Micronaut includes dedicated support for developing and deploying functions to AWS Lambda, Google Cloud Function, Azure Function, and any FaaS system that supports running functions as containers (such as OpenFaaS, Rift or Fn).</p>
</div>
<div class="paragraph">
<p>There are generally two approaches to writing functions with Micronaut:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Low-level functions written using the native API of the function platform</p>
</li>
<li>
<p>Higher-level functions where you simply define controllers as you normally do in a typical Micronaut application and deploy to the function platform.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first has marginally less startup time overhead and is typically used for non-HTTP functions such as functions that listen to an event or background functions.</p>
</div>
<div class="paragraph">
<p>The second is only for HTTP functions and is useful for users who want to take a slice of an existing application and deploy it as a serverless function. If cold start performance is a concern it is recommended that you consider building a native image with GraalVM for this option.</p>
</div>

<h2 id="awsLambda"><a class="anchor" href="#awsLambda"></a>9.1 AWS Lambda</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/serverlessFunctions/awsLambda.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Support for AWS Lambda is implemented in the <a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#whatsNew">Micronaut AWS</a> subproject.</p>
</div>
<div class="sect3">
<h4 id="_simple_functions_with_aws_lambda">Simple Functions with AWS Lambda</h4>
<div class="paragraph">
<p>You can implement AWS Request Handlers with Micronaut that directly implement the AWS Lambda SDK API. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#requestHandlers">Micronaut Request Handlers</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create an AWS Lambda Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-function-app my-app --features aws-lambda</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/create/function/example\?features\=aws-lambda -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_http_functions_with_aws_lambda">HTTP Functions with AWS Lambda</h4>
<div class="paragraph">
<p>You can deploy regular Micronaut applications that use <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a>, etc. using Micronaut&#8217;s support for AWS API Gateway. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#applicationtyperuntimedependencies">AWS Application Types, Lambda Runtimes, Dependencies</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create an AWS API Gateway Proxy application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features aws-lambda</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=aws-lambda -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>

<h2 id="gcpFunction"><a class="anchor" href="#gcpFunction"></a>9.2 Google Cloud Function</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/serverlessFunctions/gcpFunction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Support for Google Cloud Function is implemented in the <a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#cloudFunction">Micronaut GCP</a> subproject.</p>
</div>
<div class="sect3">
<h4 id="_simple_functions_with_cloud_function">Simple Functions with Cloud Function</h4>
<div class="paragraph">
<p>You can implement Cloud Functions with Micronaut that directly implement the <a href="https://github.com/GoogleCloudPlatform/functions-framework-java">Cloud Function Framework API</a>. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#simpleFunctions">Simple Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create a Google Cloud Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-function-app my-app --features google-cloud-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/create/function/example\?features\=google-cloud-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_http_functions_with_cloud_function">HTTP Functions with Cloud Function</h4>
<div class="paragraph">
<p>You can deploy regular Micronaut applications that use <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> etc. using Micronaut&#8217;s support for HTTP Functions. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#httpFunctions">Google Cloud HTTP Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create a Google Cloud HTTP Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features google-cloud-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=google-cloud-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>

<h2 id="gcpCloudRun"><a class="anchor" href="#gcpCloudRun"></a>9.3 Google Cloud Run</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/serverlessFunctions/gcpCloudRun.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy to <a href="https://cloud.google.com/run">Google Cloud Run</a> we recommend using <a href="https://github.com/GoogleContainerTools/jib">JIB</a> to containerize your application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>Creating an application with JIB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jib</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=jib -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With JIB setup to deploy your application to Google Container Registry, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew jib</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are now ready to deploy your application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ gcloud run deploy --image gcr.io/[PROJECT ID]/example --platform=managed --allow-unauthenticated</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>[PROJECT ID]</code> is your project ID. You will be asked to specify a region and will see output like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Service name: (example):
Deploying container to Cloud Run service [example] in project [PROJECT_ID] region [us-central1]

✓ Deploying... Done.
  ✓ Creating Revision...
  ✓ Routing traffic...
  ✓ Setting IAM Policy...
Done.
Service [example] revision [example-00004] has been deployed and is serving 100 percent of traffic at https://example-9487r97234-uc.a.run.app</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL is the URL of your Cloud Run application.</p>
</div>

<h2 id="azureFunction"><a class="anchor" href="#azureFunction"></a>9.4 Azure Function</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/serverlessFunctions/azureFunction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Support for Azure Function is implemented in the <a href="https://micronaut-projects.github.io/micronaut-azure/1.0.x/guide/index.html#azureFunction">Micronaut Azure</a> subproject.</p>
</div>
<div class="sect3">
<h4 id="_simple_functions_with_azure_function">Simple Functions with Azure Function</h4>
<div class="paragraph">
<p>You can implement Azure Functions with Micronaut that directly implement the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-java?tabs=consumption">Azure Function Java SDK</a>. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-azure/1.0.x/guide/index.html#azureFunction">Azure Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create an Azure Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-function-app my-app --features azure-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/create/function/example\?features\=azure-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_http_functions_with_azure_function">HTTP Functions with Azure Function</h4>
<div class="paragraph">
<p>You can deploy regular Micronaut applications that use <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> etc. using Micronaut&#8217;s support for Azure HTTP Functions. See the documentation on <a href="https://micronaut-projects.github.io/micronaut-azure/1.0.x/guide/index.html#azureFunction">Azure HTTP Functions</a> for more information.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>To create a Azure HTTP Function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features azure-function</pre>
</div>
</div>
<div class="paragraph">
<p>Or with Micronaut Launch</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl https://launch.micronaut.io/example.zip\?features\=azure-function -o example.zip
$ unzip example.zip -d example</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>

<h1 id="messaging"><a class="anchor" href="#messaging"></a>10 Message-Driven Microservices</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/messaging.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In the past, with monolithic applications, message listeners that listened to messages from messaging systems would frequently be embedded in the same application unit.</p>
</div>
<div class="paragraph">
<p>In Microservice architectures it is common to have individual Microservice applications that are driven by a message system such as RabbitMQ or Kafka.</p>
</div>
<div class="paragraph">
<p>In fact a Message-driven Microservice may not even feature an HTTP endpoint or HTTP server (although this can be valuable from a health check and visibility perspective).</p>
</div>

<h2 id="kafka"><a class="anchor" href="#kafka"></a>10.1 Kafka Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/messaging/kafka.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://kafka.apache.org">Apache Kafka</a> is a distributed stream processing platform that can be used for a range of messaging requirements in addition to stream processing and real-time data handling.</p>
</div>
<div class="paragraph">
<p>Micronaut features dedicated support for defining both Kafka <code>Producer</code> and <code>Consumer</code> instances. Micronaut applications built with Kafka can be deployed with or without the presence of an HTTP server.</p>
</div>
<div class="paragraph">
<p>With Micronaut&#8217;s efficient compile-time AOP and cloud native features, writing efficient Kafka consumer applications that use very little resources is a breeze.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-kafka/latest/guide">Micronaut Kafka</a> for more information on how to build Kafka applications with Micronaut.</p>
</div>

<h2 id="rabbitmq"><a class="anchor" href="#rabbitmq"></a>10.2 RabbitMQ Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/messaging/rabbitmq.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.rabbitmq.com">RabbitMQ</a> is the most widely deployed open source message broker.</p>
</div>
<div class="paragraph">
<p>Micronaut features dedicated support for defining both RabbitMQ publishers and consumers. Micronaut applications built with RabbitMQ can be deployed with or without an HTTP server.</p>
</div>
<div class="paragraph">
<p>With Micronaut&#8217;s efficient compile-time AOP, using RabbitMQ has never been easier. Support has been added for publisher confirms and RPC through reactive streams.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-rabbitmq/latest/guide">Micronaut RabbitMQ</a> for more information on how to build RabbitMQ applications with Micronaut.</p>
</div>

<h2 id="nats"><a class="anchor" href="#nats"></a>10.3 Nats.io Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/messaging/nats.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://nats.io/">Nats.io</a> is a simple, secure, and high-performance open source messaging system for cloud native applications, IoT messaging, and microservices architectures.</p>
</div>
<div class="paragraph">
<p>Micronaut features dedicated support for defining both Nats.io publishers and consumers. Micronaut applications built with Nats.io can be deployed with or without an HTTP server.</p>
</div>
<div class="paragraph">
<p>With Micronaut&#8217;s efficient compile-time AOP, using Nats.io has never been easier. Support has been added for publisher confirms and RPC through reactive streams.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-nats/latest/guide/">Micronaut Nats</a> for more information on how to build Nats.io applications with Micronaut.</p>
</div>

<h1 id="commandLineApps"><a class="anchor" href="#commandLineApps"></a>11 Standalone Command Line Applications</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/commandLineApps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In certain cases you may wish to create standalone command-line (CLI) applications that interact with your Microservice infrastructure.</p>
</div>
<div class="paragraph">
<p>Examples of applications like this include scheduled tasks, batch applications and general command line applications.</p>
</div>
<div class="paragraph">
<p>In this case having a robust way to parse command line options and positional parameters is important.</p>
</div>

<h2 id="picocli"><a class="anchor" href="#picocli"></a>11.1 Picocli Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/commandLineApps/picocli.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/remkop/picocli">Picocli</a> is a command line parser that supports usage help with ANSI colors, autocomplete, and nested subcommands. It has an annotations API to create command line applications with almost no code, and a programmatic API for dynamic uses like creating Domain Specific Languages.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-picocli/latest/guide/">documentation for the Picocli integration</a> for more information.</p>
</div>

<h1 id="configurations"><a class="anchor" href="#configurations"></a>12 Configurations</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features several built-in configurations that enable integration with common databases and other servers.</p>
</div>

<h2 id="reactiveConfigs"><a class="anchor" href="#reactiveConfigs"></a>12.1 Configurations for Reactive Programming</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/reactiveConfigs.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://projectreactor.io">Project Reactor</a> is used internally by Micronaut. However to use Reactor or other reactive libraries (e.g. RxJava) types in your controller and/or HTTP Client methods you need to include dependencies.</p>
</div>

<h2 id="reactor"><a class="anchor" href="#reactor"></a>12.1.1 Reactor Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/reactiveConfigs/reactor.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To add support for Reactor, add the following module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.reactor:micronaut-reactor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.reactor&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-reactor&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>To use the Reactor HTTP client, add the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.reactor:micronaut-reactor-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.reactor&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-reactor-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For more information see the documentation for <a href="https://micronaut-projects.github.io/micronaut-reactor/latest/guide/">Micronaut Reactor</a>.</p>
</div>

<h2 id="rxjava3"><a class="anchor" href="#rxjava3"></a>12.1.2 RxJava 3 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/reactiveConfigs/rxjava3.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To add support for RxJava 3, add the following module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava3:micronaut-rxjava3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava3&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava3&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>To use the RxJava 3 HTTP client, add the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava3:micronaut-rxjava3-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava3&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava3-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For more information see the documentation for <a href="https://micronaut-projects.github.io/micronaut-rxjava3/latest/guide/">Micronaut RxJava 3</a>.</p>
</div>

<h2 id="rxjava2"><a class="anchor" href="#rxjava2"></a>12.1.3 RxJava 2 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/reactiveConfigs/rxjava2.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To add support for RxJava 2, add the following module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava2:micronaut-rxjava2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava2&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava2&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>To use the RxJava 2 HTTP client, add the following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava2:micronaut-rxjava2-http-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava2&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava2-http-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For more information see the documentation for <a href="https://micronaut-projects.github.io/micronaut-rxjava2/latest/guide/">Micronaut RxJava 2</a>.</p>
</div>

<h2 id="rxjava1"><a class="anchor" href="#rxjava1"></a>12.1.4 RxJava 1 Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/reactiveConfigs/rxjava1.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Legacy support for RxJava 1 can be added with the following module:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.rxjava1:micronaut-rxjava1")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.rxjava1&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-rxjava1&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-rxjava1/latest/guide/">Micronaut RxJava1</a> documentation.</p>
</div>

<h2 id="dataAccess"><a class="anchor" href="#dataAccess"></a>12.2 Configurations for Data Access</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This table summarizes the configuration modules and dependencies to add to your build to enable them:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Data Access Configuration Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-jdbc-dbcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a>s using <a href="https://commons.apache.org/proper/commons-dbcp/">Commons DBCP</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-jdbc-hikari</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a>s using <a href="https://github.com/brettwooldridge/HikariCP">Hikari Connection Pool</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-jdbc-tomcat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures SQL <a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a>s using <a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html">Tomcat Connection Pool</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-hibernate-jpa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures Hibernate/JPA <code>EntityManagerFactory</code> beans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-hibernate-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="https://gorm.grails.org/latest/hibernate/manual">GORM for Hibernate</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.mongodb:micronaut-mongo-reactive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://mongodb.github.io/mongo-java-driver-reactivestreams">MongoDB Reactive Driver</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-mongo-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="https://gorm.grails.org/latest/mongodb/manual">GORM for MongoDB</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.neo4j:micronaut-neo4j-bolt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/neo4j/neo4j-java-driver">Bolt Java Driver</a> for <a href="https://neo4j.com">Neo4j</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-neo4j-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="https://gorm.grails.org/latest/neo4j/manual">GORM for Neo4j</a> for Groovy applications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-vertx-mysql-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/eclipse-vertx/vertx-sql-client/tree/master/vertx-mysql-client">Reactive MySQL Client</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.sql:micronaut-vertx-pg-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/eclipse-vertx/vertx-sql-client/tree/master/vertx-pg-client">Reactive Postgres Client</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.redis:micronaut-redis-lettuce</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://lettuce.io">Lettuce</a> driver for <a href="https://redis.io">Redis</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.cassandra:micronaut-cassandra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the <a href="https://github.com/datastax/java-driver">Datastax Java Driver</a> for <a href="https://cassandra.apache.org">Cassandra</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, to add support for MongoDB, add the following dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.mongodb:micronaut-mongo-reactive"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Groovy users, Micronaut provides special support for <a href="https://gorm.grails.org">GORM</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
With GORM for Hibernate you cannot have both the <code>hibernate-jpa</code> and <code>hibernate-gorm</code> dependencies.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections go into more detail about configuration options and the exposed beans for each implementation.</p>
</div>

<h2 id="sqlSupport"><a class="anchor" href="#sqlSupport"></a>12.2.1 Configuring a SQL Data Source</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/sqlSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>JDBC DataSources can be configured for one of three currently provided implementations - Apache DBCP2, Hikari, and Tomcat are supported by default.</p>
</div>
<div class="sect1">
<h2 id="_configuring_a_jdbc_datasource">Configuring a JDBC DataSource</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply one of the <code>jdbc-tomcat</code>, <code>jdbc-hikari</code>, or <code>jdbc-dbcp</code> features to preconfigure a simple JDBC connection pool in your project, along with a default H2 database driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jdbc-tomcat</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get started, add a dependency for one of the JDBC configurations that corresponds to the implementation you will use. Choose one of the following:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-tomcat")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-tomcat&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-hikari")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-hikari&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-dbcp")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-dbcp&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-ucp")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-ucp&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Also, add a JDBC driver dependency to your build. For example to add the <a href="https://www.h2database.com">H2 In-Memory Database</a>:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"com.h2database:h2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#jdbc">Configuring JDBC</a> section of the <a href="https://github.com/micronaut-projects/micronaut-sql">Micronaut SQL libraries</a> project.</p>
</div>
</div>
</div>

<h2 id="hibernateSupport"><a class="anchor" href="#hibernateSupport"></a>12.2.2 Configuring Hibernate</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/hibernateSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_a_hibernatejpa_entitymanager">Setting up a Hibernate/JPA EntityManager</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>hibernate-jpa</code> feature to include a Hibernate JPA configuration in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features hibernate-jpa</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut includes support for configuring a <a href="https://hibernate.org">Hibernate</a> / JPA <code>EntityManager</code> that builds on the <a href="#sqlSupport">SQL DataSource support</a>.</p>
</div>
<div class="paragraph">
<p>Once you have <a href="#sqlSupport">configured one or more DataSources</a> to use Hibernate, add the <code>hibernate-jpa</code> dependency to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-hibernate-jpa")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#hibernate">Configuring Hibernate</a> section of the <a href="https://github.com/micronaut-projects/micronaut-sql">Micronaut SQL libraries</a> project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_gorm_for_hibernate">Using GORM for Hibernate</h4>
<div class="paragraph">
<p>For Groovy users and users familiar with the Grails framework, special support for <a href="https://gorm.grails.org">GORM for Hibernate</a> is available. To use GORM for Hibernate <strong>do not</strong> include Micronaut&#8217;s built-in <a href="#sqlSupport">SQL Support</a> or the <code>hibernate-jpa</code> dependency since GORM itself takes responsibility for creating the <code>DataSource</code>, <code>SessionFactory</code>, etc.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>hibernate-gorm</code> feature to include GORM, a basic connection pool configuration, and a default H2 database driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features hibernate-gorm</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-groovy/latest/guide/#gorm">GORM Modules</a> section of the <a href="https://github.com/micronaut-projects/micronaut-groovy">Micronaut for Groovy </a> user guide.</p>
</div>
</div>

<h2 id="mongoSupport"><a class="anchor" href="#mongoSupport"></a>12.2.3 Configuring MongoDB</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/mongoSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_the_native_mongodb_driver">Setting up the Native MongoDB Driver</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>mongo-reactive</code> feature to configure the native MongoDB driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features mongo-reactive</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut can automatically configure the native MongoDB Java driver. To use this, add the following dependency to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.mongodb:micronaut-mongo-reactive")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.mongodb&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-mongo-reactive&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Then configure the URI of the MongoDB server in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Configuring a MongoDB server</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">mongodb.uri=mongodb://username:password@localhost:27017/databaseName</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mongodb:
  uri: mongodb://username:password@localhost:27017/databaseName</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[mongodb]
  uri="mongodb://username:password@localhost:27017/databaseName"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">mongodb {
  uri = "mongodb://username:password@localhost:27017/databaseName"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  mongodb {
    uri = "mongodb://username:password@localhost:27017/databaseName"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "mongodb": {
    "uri": "mongodb://username:password@localhost:27017/databaseName"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>mongodb.uri</code> follows the <a href="https://www.mongodb.com/docs/manual/reference/connection-string/">MongoDB Connection String</a> format.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A non-blocking Reactive Streams <a href="https://mongodb.github.io/mongo-java-driver-reactivestreams/1.8/javadoc/com/mongodb/reactivestreams/client/MongoClient.html">MongoClient</a> is then available for dependency injection.</p>
</div>
<div class="paragraph">
<p>To use the blocking driver, add a dependency to your build on the mongo-java-driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">runtimeOnly "org.mongodb:mongo-java-driver"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the blocking <a href="https://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/MongoClient.html">MongoClient</a> will be available for injection.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-mongodb/latest/guide/">Micronaut MongoDB</a> documentation for further information on configuring and using MongoDB within Micronaut.</p>
</div>
</div>

<h2 id="neo4jSupport"><a class="anchor" href="#neo4jSupport"></a>12.2.4 Configuring Neo4j</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/neo4jSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features dedicated support for automatically configuring the <a href="https://neo4j.com/docs/developer-manual/current/drivers/">Neo4j Bolt Driver</a> for the popular <a href="https://neo4j.com/">Neo4j</a> Graph Database.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>neo4j-bolt</code> feature to configure the Neo4j Bolt driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features neo4j-bolt</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Neo4j Bolt driver, first add the <code>neo4j-bolt</code> module to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-neo4j-bolt")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-neo4j-bolt&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>Then configure the URI of the Neo4j server in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Configuring <code>neo4j.uri</code></div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">neo4j.uri=bolt://localhost</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">neo4j:
  uri: bolt://localhost</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[neo4j]
  uri="bolt://localhost"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">neo4j {
  uri = "bolt://localhost"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  neo4j {
    uri = "bolt://localhost"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "neo4j": {
    "uri": "bolt://localhost"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>neo4j.uri</code> setting must be in the format as described in the <a href="https://neo4j.com/docs/developer-manual/current/drivers/client-applications/#driver-connection-uris">Connection URIs</a> section of the Neo4j documentation
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have the above configuration in place you can inject an instance of the <code>org.neo4j.driver.v1.Driver</code> bean, which features both a synchronous blocking API and a non-blocking API based on <code>CompletableFuture</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-neo4j/latest/guide/">Micronaut Neo4j</a> documentation for further information on configuring and using Neo4j within Micronaut.</p>
</div>

<h2 id="postgresSupport"><a class="anchor" href="#postgresSupport"></a>12.2.5 Configuring Postgres</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/postgresSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports a reactive and non-blocking client to connect to Postgres using <a href="https://github.com/eclipse-vertx/vertx-sql-client/tree/master/vertx-pg-client">vertx-pg-client</a>, which can handle many database connections with a single thread.</p>
</div>
<div class="sect1">
<h2 id="_configuring_the_reactive_postgres_client">Configuring the Reactive Postgres Client</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>vertx-pg-client</code> feature to configure the Reactive Postgres client in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features vertx-pg-client</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Reactive Postgres client, first add the <code>vertx-pg-client</code> module to your build:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.sql:micronaut-vertx-pg-client"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-sql/latest/guide/#pgclient">Configuring Reactive Postgres</a> section of the <a href="https://github.com/micronaut-projects/micronaut-sql">Micronaut SQL libraries</a> project.</p>
</div>
</div>
</div>

<h2 id="redisSupport"><a class="anchor" href="#redisSupport"></a>12.2.6 Configuring Redis</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/redisSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut features automatic configuration of the <a href="https://lettuce.io">Lettuce</a> driver for <a href="https://redis.io">Redis</a> via the <code>redis-lettuce</code> module.</p>
</div>
<div class="sect1">
<h2 id="_configuring_lettuce">Configuring Lettuce</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>redis-lettuce</code> feature to configure the Lettuce driver in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features redis-lettuce</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Lettuce driver, first add the <code>redis-lettuce</code> module to your build:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.redis:micronaut-redis-lettuce"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then configure the URI of the Redis server in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Configuring <code>redis.uri</code></div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">redis.uri=redis://localhost</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">redis:
  uri: redis://localhost</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[redis]
  uri="redis://localhost"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">redis {
  uri = "redis://localhost"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  redis {
    uri = "redis://localhost"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "redis": {
    "uri": "redis://localhost"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>redis.uri</code> setting must be in the format as described in the <a href="https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details">Connection URIs</a> section of the Lettuce wiki
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also specify multiple Redis URIs using <code>redis.uris</code>, in which case a <code>RedisClusterClient</code> is created instead.</p>
</div>
<div class="paragraph">
<p>For more information and further documentation see the <a href="https://micronaut-projects.github.io/micronaut-redis/latest/guide">Micronaut Redis</a> documentation.</p>
</div>
</div>
</div>

<h2 id="cassandraSupport"><a class="anchor" href="#cassandraSupport"></a>12.2.7 Configuring Cassandra</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/cassandraSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>cassandra</code> feature to include Cassandra configuration in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features cassandra</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information see the <a href="https://micronaut-projects.github.io/micronaut-cassandra/latest/guide/">Micronaut Cassandra Module</a> documentation.</p>
</div>

<h2 id="liquibaseSupport"><a class="anchor" href="#liquibaseSupport"></a>12.2.8 Configuring Liquibase</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/liquibaseSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure Micronaut integration with <a href="https://www.liquibase.org">Liquibase</a>, please follow
<a href="https://micronaut-projects.github.io/micronaut-liquibase/latest/guide/index.html">these instructions</a>.</p>
</div>

<h2 id="flywaySupport"><a class="anchor" href="#flywaySupport"></a>12.2.9 Configuring Flyway</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/configurations/dataAccess/flywaySupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure Micronaut integration with <a href="https://flywaydb.org/">Flyway</a>, please follow
<a href="https://micronaut-projects.github.io/micronaut-flyway/latest/guide/index.html">these instructions</a></p>
</div>

<h1 id="logging"><a class="anchor" href="#logging"></a>13 Logging</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/logging.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut uses <a href="https://www.slf4j.org/">Slf4j</a> to log messages. The default implementation for applications created via Micronaut Launch is <a href="https://logback.qos.ch/">Logback</a>. Any other Slf4j implementation is supported however.</p>
</div>

<h2 id="loggingMessages"><a class="anchor" href="#loggingMessages"></a>13.1 Logging Messages</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/logging/loggingMessages.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To log messages, use the Slf4j <code>LoggerFactory</code> to get a logger for your class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class LoggerExample {

    private static Logger logger = LoggerFactory.getLogger(LoggerExample.class);

    public static void main(String[] args) {
        logger.debug("Debug message");
        logger.info("Info message");
        logger.error("Error message");
    }
}</code></pre>
</div>
</div>

<h2 id="loggingConfiguration"><a class="anchor" href="#loggingConfiguration"></a>13.2 Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/logging/loggingConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Log levels can be configured via properties defined in your configuration file (e.g <code>application.yml</code>) (and environment variables) with the <code>logger.levels</code> prefix:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">logger.levels.foo.bar=ERROR</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logger:
  levels:
    foo.bar: ERROR</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[logger]
  [logger.levels]
    "foo.bar"="ERROR"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">logger {
  levels {
    foo.bar = "ERROR"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  logger {
    levels {
      "foo.bar" = "ERROR"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "logger": {
    "levels": {
      "foo.bar": "ERROR"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same configuration can be achieved by setting the environment variable <code>LOGGER_LEVELS_FOO_BAR</code>. Note that there is currently no way to set log levels for unconventional prefixes such as <code>foo.barBaz</code>.</p>
</div>
<div class="sect3">
<h4 id="_custom_logback_xml_configuration">Custom Logback XML Configuration</h4>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">logger.config=custom-logback.xml</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logger:
  config: custom-logback.xml</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[logger]
  config="custom-logback.xml"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">logger {
  config = "custom-logback.xml"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  logger {
    config = "custom-logback.xml"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "logger": {
    "config": "custom-logback.xml"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also set a custom Logback XML configuration file to be used via <code>logger.config</code>. Be aware that <strong>the referenced file should be an accessible resource on your classpath</strong>!</p>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_a_logger_with_properties">Disabling a Logger with Properties</h4>
<div class="paragraph">
<p>To disable a logger, you need to set the logger level to <code>OFF</code>:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">logger.levels.io.verbose.logger.who.CriedWolf=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">logger:
  levels:
    io.verbose.logger.who.CriedWolf: OFF</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[logger]
  [logger.levels]
    "io.verbose.logger.who.CriedWolf"=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">logger {
  levels {
    io.verbose.logger.who.CriedWolf = false
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  logger {
    levels {
      "io.verbose.logger.who.CriedWolf" = false
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "logger": {
    "levels": {
      "io.verbose.logger.who.CriedWolf": false
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This will disable ALL logging for the class <code>io.verbose.logger.who.CriedWolf</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the ability to control log levels via config is controlled via the <a href="../api/io/micronaut/logging/LoggingSystem.html">LoggingSystem</a> interface. Currently, Micronaut includes a single implementation that allows setting log levels for the Logback library. If you use another library, you should provide a bean that implements this interface.</p>
</div>
</div>

<h2 id="logback"><a class="anchor" href="#logback"></a>13.3 Logback</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/logging/logback.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use the logback library, add the following dependency to your build.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"ch.qos.logback:logback-classic")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Logback 1.3.x+ included a breaking binary change that may prevent it working with 3.8.x of the Micronaut framework. If you are using Logback 1.3.x+ and are experiencing issues, please downgrade to Logback 1.2.x.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If it does not exist yet, place a <a href="https://logback.qos.ch/manual/configuration.html">logback.xml</a> file in the resources folder and modify the content for your needs. For example:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/logback.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;

    &lt;appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender"&gt;
        &lt;withJansi&gt;true&lt;/withJansi&gt;

        &lt;encoder&gt;
            &lt;pattern&gt;%cyan(%d{HH:mm:ss.SSS}) %gray([%thread]) %highlight(%-5level) %magenta(%logger{36}) - %msg%n
            &lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;root level="info"&gt;
        &lt;appender-ref ref="STDOUT"/&gt;
    &lt;/root&gt;

&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change the log level for specific classes or package names, you can add such a logger entry to the configuration section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
    ...
    &lt;logger name="io.micronaut.context" level="TRACE"/&gt;
    ...
&lt;/configuration&gt;</code></pre>
</div>
</div>

<h2 id="loggingSystem"><a class="anchor" href="#loggingSystem"></a>13.4 Logging System</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/logging/loggingSystem.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut Framework has a notion of a logging system. In short, it is a simple API to be able to set log levels in the logging implementation at runtime. Default implementations are provided for Logback and Log4j2. The behavior of the logging system can be overridden by creating your own implementation of <a href="../api/io/micronaut/logging/LoggingSystem.html">LoggingSystem</a> and replace the implementation being used with the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation.</p>
</div>

<h1 id="languageSupport"><a class="anchor" href="#languageSupport"></a>14 Language Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports any JVM language that implements the <a href="https://docs.oracle.com/javase/8/docs/api/javax/annotation/processing/package-summary.html">Java Annotation Processor</a> API.</p>
</div>
<div class="paragraph">
<p>Although Groovy does not support this API, special support has been built using AST transformations. The current list of supported languages is: Java, Groovy, and Kotlin (via the <code>kapt</code> tool).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Theoretically any language that supports a way to analyze the AST at compile time could be supported. The <a href="../api/io/micronaut/inject/writer/package-summary.html">io.micronaut.inject.writer</a> package includes language-neutral classes that build <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> classes at compile time using the ASM tool.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections cover language-specific features and considerations for using Micronaut.</p>
</div>

<h2 id="java"><a class="anchor" href="#java"></a>14.1 Micronaut for Java</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/java.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For Java, Micronaut uses a Java <a href="../api/io/micronaut/annotation/processing/BeanDefinitionInjectProcessor.html">BeanDefinitionInjectProcessor</a> annotation processor to process classes at compile time and produce <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> classes.</p>
</div>
<div class="paragraph">
<p>The major advantage here is that you pay a slight cost at compile time, but at runtime Micronaut is largely reflection-free, fast, and consumes very little memory.</p>
</div>

<h2 id="java9"><a class="anchor" href="#java9"></a>14.1.1 Using Micronaut with Java 9+</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/java/java9.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is built with Java 8 but works fine with Java 9 and above. The classes that Micronaut generates sit alongside existing classes in the same package, hence do not violate anything regarding the Java module system.</p>
</div>
<div class="paragraph">
<p>There are some considerations when using Java 9+ with Micronaut.</p>
</div>
<div class="sect2">
<h3 id="_the_javax_annotation_package">The javax.annotation package</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, the <code>javax.annotation</code> dependency is added to your project automatically if you use Java 9+.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>javax.annotation</code>, which includes <code>@PostConstruct</code>, <code>@PreDestroy</code>, etc. has been moved from the core JDK to a module. In general annotations in this package should be avoided and instead the <code>jakarta.annotation</code> equivalents used.</p>
</div>
</div>

<h2 id="incrementalannotationgradle"><a class="anchor" href="#incrementalannotationgradle"></a>14.1.2 Incremental Annotation Processing with Gradle</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/java/incrementalannotationgradle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports <a href="https://docs.gradle.org/current/userguide/java_plugin.html#sec:incremental_annotation_processing">Gradle incremental annotation processing</a> which speeds up builds by compiling only classes that have changed, avoiding a full recompilation.</p>
</div>
<div class="paragraph">
<p>However, the support is disabled by default since Micronaut allows the definition of custom meta-annotations (to for example define <a href="#aop">custom AOP advice</a>) that need to be configured for processing.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to enable and configure incremental annotation processing for annotations you have defined under the <code>com.example</code> package:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Incremental Annotation Processing</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">tasks.withType(JavaCompile) {
    options.compilerArgs = [
        '-Amicronaut.processing.incremental=true',
        '-Amicronaut.processing.annotations=com.example.*',
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you do not enable processing for your custom annotations, they will be ignored by Micronaut, which may break your application.
</td>
</tr>
</table>
</div>

<h2 id="lombok"><a class="anchor" href="#lombok"></a>14.1.3 Using Project Lombok</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/java/lombok.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://projectlombok.org">Project Lombok</a> is a popular java library that adds a number of useful AST transformations to the Java language via annotation processors.</p>
</div>
<div class="paragraph">
<p>Since both Micronaut and Lombok use annotation processors, special care must be taken when configuring Lombok to ensure that the Lombok processor runs <strong>before</strong> Micronaut&#8217;s processor.</p>
</div>
<div class="paragraph">
<p>If you use Gradle, add the following dependencies:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Lombok in Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compileOnly 'org.projectlombok:lombok:1.18.24'
annotationProcessor "org.projectlombok:lombok:1.18.24"
...
// Micronaut processor defined after Lombok
annotationProcessor "io.micronaut:micronaut-inject-java"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if using Maven:</p>
</div>
<div class="listingblock">
<div class="title">Configuring Lombok in Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;version&gt;1.18.24&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
...
&lt;annotationProcessorPaths combine.self="override"&gt;
  &lt;path&gt;
    &lt;!-- must precede micronaut-inject-java --&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;version&gt;1.18.24&lt;/version&gt;
  &lt;/path&gt;
  &lt;path&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-inject-java&lt;/artifactId&gt;
    &lt;version&gt;${micronaut.version}&lt;/version&gt;
  &lt;/path&gt;
    &lt;path&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-validation&lt;/artifactId&gt;
    &lt;version&gt;${micronaut.version}&lt;/version&gt;
  &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In both cases (Gradle and Maven) the Micronaut processor must be configured after the Lombok processor. Reversing the order of the declared dependencies will not work.
</td>
</tr>
</table>
</div>

<h2 id="ide"><a class="anchor" href="#ide"></a>14.1.4 Configuring an IDE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/java/ide.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can use any IDE to develop Micronaut applications, if you depend on your configured build tool (Gradle or Maven) to build the application.</p>
</div>
<div class="paragraph">
<p>However, running tests within the IDE is currently possible with <a href="https://www.jetbrains.com/idea">IntelliJ IDEA</a> or Eclipse 4.9 or higher.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#ideSetup">IDE Setup</a> in the Quick start for more information on how to configure IntelliJ and Eclipse.</p>
</div>

<h2 id="retainparameternames"><a class="anchor" href="#retainparameternames"></a>14.1.5 Retaining Parameter Names</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/java/retainparameternames.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default with Java, the parameter name data for method parameters is not retained at compile time. This can be a problem for Micronaut if you do not define parameter names explicitly and depend on an external JAR that is already compiled.</p>
</div>
<div class="paragraph">
<p>Consider this interface:</p>
</div>
<div class="listingblock">
<div class="title">Client Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface HelloOperations {
    @Get("/hello/{name}")
    String hello(String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At compile time the parameter name <code>name</code> is lost and becomes <code>arg0</code> when compiled against or read via reflection later. To avoid this problem you have two options. You can either declare the parameter name explicitly:</p>
</div>
<div class="listingblock">
<div class="title">Client Interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface HelloOperations {
    @Get("/hello/{name}")
    String hello(@QueryValue("name") String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively it is recommended that you compile all bytecode with <code>-parameters</code> flag to <code>javac</code>. See <a href="https://docs.oracle.com/javase/tutorial/reflect/member/methodparameterreflection.html">Obtaining Names of Method Parameters</a>. For example in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compileJava.options.compilerArgs += '-parameters'</code></pre>
</div>
</div>

<h2 id="groovy"><a class="anchor" href="#groovy"></a>14.2 Micronaut for Groovy</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/groovy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://groovy-lang.org">Groovy</a> has first-class support in Micronaut.</p>
</div>
<div class="sect1">
<h2 id="_groovy_specific_modules">Groovy-Specific Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additional modules exist specific to Groovy that improve the overall experience. These are detailed in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Groovy-Specific Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:micronaut-inject-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes AST transformations to generate bean definitions. Should be <code>compileOnly</code> on your classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:micronaut-runtime-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds the ability to specify configuration under <code>src/main/resources</code> in Groovy format (i.e. <code>application.groovy</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut:micronaut-function-groovy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes AST transforms that make it easier to write <a href="#serverlessFunctions">Functions</a> for AWS Lambda</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The most common module you need is <code>micronaut-inject-groovy</code>, which enables DI and AOP for Groovy classes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_support_in_the_cli">Groovy Support in the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Micronaut <a href="#cli">Command Line Interface</a> includes special support for Groovy. To create a Groovy application, use the <code>groovy</code> lang option. For example:</p>
</div>
<div class="listingblock">
<div class="title">Create a Micronaut Groovy application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world --lang groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above generates a Groovy project, built with Gradle. Use the <code>-build maven</code> flag to generate a project built with Maven instead.</p>
</div>
<div class="paragraph">
<p>Once you have created an application with the <code>groovy</code> feature, commands like <code>create-controller</code>, <code>create-client</code> etc. generate Groovy files instead of Java. The following example demonstrates this when using interactive mode of the CLI:</p>
</div>
<div class="listingblock">
<div class="title">Create a bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;

create-bean          create-client        create-controller
create-job           help

mn&gt; create-bean helloBean
| Rendered template Bean.groovy to destination src/main/groovy/hello/world/HelloBean.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example demonstrates creating a Groovy bean that looks like the following:</p>
</div>
<div class="listingblock">
<div class="title">Micronaut Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package hello.world

import javax.inject.Singleton

@Singleton
class HelloBean {

}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Groovy automatically imports <code>groovy.lang.Singleton</code> which can be confusing as it conflicts with <code>javax.inject.Singleton</code>. Make sure you use <code>javax.inject.Singleton</code> when declaring a Micronaut singleton bean to avoid surprising behavior.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can also create a client - don&#8217;t forget Micronaut can act as a client or a server!</p>
</div>
<div class="listingblock">
<div class="title">Create a client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-client helloClient
| Rendered template Client.groovy to destination src/main/groovy/hello/world/HelloClient.groovy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Micronaut Client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package hello.world

import io.micronaut.http.client.annotation.Client
import io.micronaut.http.annotation.Get
import io.micronaut.http.HttpStatus

@Client("hello")
interface HelloClient {

    @Get
    HttpStatus index()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create a controller:</p>
</div>
<div class="listingblock">
<div class="title">Create a controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-controller helloController
| Rendered template Controller.groovy to destination src/main/groovy/hello/world/HelloController.groovy
| Rendered template ControllerSpec.groovy to destination src/test/groovy/hello/world/HelloControllerSpec.groovy
mn&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Micronaut Controller</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package hello.world

import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.HttpStatus

@Controller("/hello")
class HelloController {

    @Get
    HttpStatus index() {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the output from the CLI, a <a href="https://spockframework.org">Spock</a> test was also generated for you which demonstrates how to test the controller:</p>
</div>
<div class="listingblock">
<div class="title">HelloControllerSpec.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">...
    void "test index"() {
        given:
        HttpResponse response = client.toBlocking().exchange("/hello")

        expect:
        response.status == HttpStatus.OK
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how you use Micronaut both as client and as a server to test itself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programmatic_routes_with_groovyrouterbuilder">Programmatic Routes with GroovyRouterBuilder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you prefer to build your routes programmatically (similar to Grails <code>UrlMappings</code>), a special <code>io.micronaut.web.router.GroovyRouteBuilder</code> exists that has some enhancements to make the DSL better.</p>
</div>
<div class="paragraph">
<p>The following example shows <code>GroovyRouteBuilder</code> in action:</p>
</div>
<div class="listingblock">
<div class="title">Using GroovyRouteBuilder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
static class MyRoutes extends GroovyRouteBuilder {

    MyRoutes(ApplicationContext beanContext) {
        super(beanContext)
    }

    @Inject
    void bookResources(BookController bookController, AuthorController authorController) {
        GET(bookController) {
            POST("/hello{/message}", bookController.&amp;hello) <i class="conum" data-value="1"></i><b>(1)</b>
        }
        GET(bookController, ID) { <i class="conum" data-value="2"></i><b>(2)</b>
            GET(authorController)
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can use injected controllers to create routes by convention and Groovy method references to create routes to methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>ID</code> property can be used to reference include an <code>{id}</code> URI variable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example results in the following routes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/book</code> - Maps to <code>BookController.index()</code></p>
</li>
<li>
<p><code>/book/hello/{message}</code> - Maps to <code>BookController.hello(String)</code></p>
</li>
<li>
<p><code>/book/{id}</code> - Maps to <code>BookController.show(String id)</code></p>
</li>
<li>
<p><code>/book/{id}/author</code> - Maps to <code>AuthorController.index</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_gorm_in_a_groovy_application">Using GORM in a Groovy application</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://gorm.grails.org">GORM</a> is a data access toolkit originally created as part of Grails. It supports multiple database types. The following table summarizes the modules needed to use GORM, and links to documentation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. GORM Modules</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-hibernate-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="https://gorm.grails.org/latest/hibernate/manual">GORM for Hibernate</a> for Groovy applications. See the <a href="#hibernateSupport">Hibernate Support</a> docs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-mongo-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="https://gorm.grails.org/latest/mongodb/manual">GORM for MongoDB</a> for Groovy applications. See the <a href="#mongoSupport">Mongo Support</a> docs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.groovy:micronaut-neo4j-gorm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures <a href="https://gorm.grails.org/latest/neo4j/manual">GORM for Neo4j</a> for Groovy applications. See the <a href="#neo4jSupport">Neo4j Support</a> docs.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once you have configured a GORM implementation per the instructions linked in the table above you can use all features of GORM.</p>
</div>
<div class="paragraph">
<p><a href="https://gorm.grails.org/latest/hibernate/manual/index.html#dataServices">GORM Data Services</a> can also participate in dependency injection and life cycle methods:</p>
</div>
<div class="listingblock">
<div class="title">GORM Data Service VehicleService.groovy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Service(Vehicle)
abstract class VehicleService {
    @PostConstruct
    void init() {
       // do something on initialization
    }

    abstract Vehicle findVehicle(@NotBlank String name)

    abstract Vehicle saveVehicle(@NotBlank String name)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define the service as an interface instead of an abstract class to have GORM implement the methods for you.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_functions_with_groovy">Serverless Functions with Groovy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A microservice application is just one way to use Micronaut. You can also use it for serverless functions like on AWS Lambda.</p>
</div>
<div class="paragraph">
<p>With the <code>function-groovy</code> module, Micronaut features enhanced support for functions written in Groovy.</p>
</div>
<div class="paragraph">
<p>See the section on <a href="#serverlessFunctions">Serverless Functions</a> for more information.</p>
</div>
</div>
</div>

<h2 id="kotlin"><a class="anchor" href="#kotlin"></a>14.3 Micronaut for Kotlin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="#cli">Command Line Interface</a> for Micronaut includes special support for Kotlin. To create a Kotlin application use the <code>kotlin</code> lang option. For example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Create a Micronaut Kotlin application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world --lang kotlin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Support for Kotlin in Micronaut is built upon the <a href="https://kotlinlang.org/docs/reference/kapt.html">Kapt</a> compiler plugin, which includes support for Java annotation processors. To use Kotlin in your Micronaut application, add the proper dependencies to configure and run kapt on your <code>kt</code> source files. Kapt creates Java "stub" classes for your Kotlin classes, which can then be processed by Micronaut&#8217;s Java annotation processor. The stubs are not included in the final compiled application.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Learn more about kapt and its features from the <a href="https://kotlinlang.org/docs/reference/kapt.html">official documentation.</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Micronaut annotation processors are declared in the <code>kapt</code> scope when using Gradle. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion" <i class="conum" data-value="1"></i><b>(1)</b>
    compile "org.jetbrains.kotlin:kotlin-reflect:$kotlinVersion"
    kapt "io.micronaut:micronaut-inject-java" <i class="conum" data-value="2"></i><b>(2)</b>

    kaptTest "io.micronaut:micronaut-inject-java" <i class="conum" data-value="3"></i><b>(3)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the Kotlin standard libraries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add the <code>micronaut-inject-java</code> dependency under the <code>kapt</code> scope, so classes in <code>src/main</code> are processed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add the <code>micronaut-inject-java</code> dependency under the <code>kaptTest</code> scope, so classes in <code>src/test</code> are processed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With a <code>build.gradle</code> file similar to the above, you can now run your Micronaut application using the <code>run</code> task (provided by the Application plugin):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example controller written in Kotlin can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/HelloController.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package example

import io.micronaut.http.annotation.*

@Controller("/")
class HelloController {

    @Get("/hello/{name}")
    fun hello(name: String): String {
        return "Hello $name"
    }
}</code></pre>
</div>
</div>

<h2 id="kaptintellij"><a class="anchor" href="#kaptintellij"></a>14.3.1 Kotlin, Kapt and IntelliJ</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin/kaptintellij.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As of this writing, IntelliJ&#8217;s built-in compiler does not directly support Kapt and annotation processing. You must instead configure Intellij to run Gradle (or Maven) compilation as a build step before running your tests or application class.</p>
</div>
<div class="paragraph">
<p>First, edit the run configuration for tests or for the application and select "Run Gradle task" as a build step:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/kotlin-run-1.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>Then add the <code>classes</code> task as task to execute for the application or for tests the <code>testClasses</code> task:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/kotlin-run-2.png" alt="Intellij Settings" width="1024" height="768">
</div>
</div>
<div class="paragraph">
<p>Now when you run tests or start the application, Micronaut will generate classes at compile time.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can <a href="https://www.jetbrains.com/help/idea/gradle.html#delegate_build_gradle">delegate IntelliJ build/run actions to Gradle</a> completely:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/delegatetogradle.png" alt="delegatetogradle">
</div>
</div>

<h2 id="gradlekapt"><a class="anchor" href="#gradlekapt"></a>14.3.2 Incremental Annotation Processing with Gradle and Kapt</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin/gradlekapt.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To enable Gradle incremental annotation processing with Kapt, the arguments as specified in <a href="#incrementalannotationgradle">Incremental Annotation Processing with Gradle</a> must be sent to Kapt.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to enable and configure incremental annotation processing for annotations you have defined under the <code>com.example</code> and <code>io.example</code> packages:</p>
</div>
<div class="listingblock">
<div class="title">Enabling Incremental Annotation Processing in Kapt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">kapt {
    arguments {
        arg("micronaut.processing.incremental", true)
        arg("micronaut.processing.annotations", "com.example.*,io.example.*")
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you do not enable processing for your custom annotations, they will be ignored by Micronaut, which may break your application.
</td>
</tr>
</table>
</div>

<h2 id="openandaop"><a class="anchor" href="#openandaop"></a>14.3.3 Kotlin and AOP Advice</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin/openandaop.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut provides a compile-time AOP API that does not use reflection. When you use any Micronaut <a href="#aop">AOP Advice</a>, it creates a subclass at compile-time to provide the AOP behaviour. This can be a problem because Kotlin classes are final by default. If the application was created with the Micronaut CLI, the Kotlin <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#all-open-compiler-plugin">all-open</a> plugin is configured for you to automatically change your classes to <code>open</code> when an AOP annotation is used. To configure it yourself, add the <a href="../api/io/micronaut/aop/Around.html">Around</a> class to the list of supported annotations.</p>
</div>
<div class="paragraph">
<p>If you prefer not to or cannot use the <code>all-open</code> plugin, you must declare the classes that are annotated with an AOP annotation to be open:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.http.HttpStatus
import io.micronaut.validation.Validated
import javax.validation.constraints.NotBlank

@Validated
@Controller("/email")
open class EmailController { <i class="conum" data-value="1"></i><b>(1)</b>

    @Get("/send")
    fun index(@NotBlank recipient: String, <i class="conum" data-value="1"></i><b>(1)</b>
              @NotBlank subject: String): HttpStatus {
        return HttpStatus.OK
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if you use <code>@Validated</code> AOP Advice, you need to use <code>open</code> at class and method level.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>all-open</code> plugin does not handle methods. If you declare an AOP annotation on a method, you must manually declare it as open.
</td>
</tr>
</table>
</div>

<h2 id="kotlinretainparamnames"><a class="anchor" href="#kotlinretainparamnames"></a>14.3.4 Kotlin and Retaining Parameter Names</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin/kotlinretainparamnames.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Like with Java, the parameter name data for method parameters is not retained at compile time when using Kotlin. This can be a problem for Micronaut if you do not define parameter names explicitly and depend on an external JAR that is already compiled.</p>
</div>
<div class="paragraph">
<p>To enable retention of parameter name data with Kotlin, set the <code>javaParameters</code> option to <code>true</code> in your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">configuration in Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compileTestKotlin {
    kotlinOptions {
        jvmTarget = '1.8'
        javaParameters = true
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use interfaces with default methods add <code>freeCompilerArgs = ["-Xjvm-default=all"]</code> for Micronaut to recognize them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or if using Maven configure the Micronaut Maven Plugin accordingly:</p>
</div>
<div class="listingblock">
<div class="title">configuration in Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;!-- ... --&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;!-- ... --&gt;
      &lt;plugin&gt;
        &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
        &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
        &lt;configuration&gt;
            &lt;javaParameters&gt;true&lt;/javaParameters&gt;
            &lt;!-- ... --&gt;
        &lt;/configuration&gt;
        &lt;!-- ... --&gt;
      &lt;/plugin&gt;
      &lt;!-- ... --&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>

<h2 id="coroutines"><a class="anchor" href="#coroutines"></a>14.3.5 Coroutines Support</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin/coroutines.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Kotlin coroutines allow you to create asynchronous applications with imperative style code. A Micronaut controller action can be a <code>suspend</code> function:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/simple", produces = [MediaType.TEXT_PLAIN])
suspend fun simple(): String { // <b class="conum">(1)</b>
    return "Hello"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The function is marked as <code>suspend</code>, though in reality it won&#8217;t be suspended.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/delayed", produces = [MediaType.TEXT_PLAIN])
suspend fun delayed(): String { // <b class="conum">(1)</b>
    delay(1) // <b class="conum">(2)</b>
    return "Delayed"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The function is marked as <code>suspend</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>delay</code> is called to make sure that a function is suspended and the response is returned from a different thread.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Status(HttpStatus.CREATED) // <b class="conum">(1)</b>
@Get("/status")
suspend fun status() {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>suspend</code> function also works when all we want is to return a status.</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Controller suspend function example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Status(HttpStatus.CREATED)
@Get("/statusDelayed")
suspend fun statusDelayed() {
    delay(1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>Flow</code> type for streaming server and client. A streaming controller can return <code>Flow</code>, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming JSON on the Server with Flow</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get(value = "/headlinesWithFlow", processes = [MediaType.APPLICATION_JSON_STREAM])
internal fun streamHeadlinesWithFlow(): Flow&lt;Headline&gt; = // <b class="conum">(1)</b>
    flow { // <b class="conum">(2)</b>
        repeat(100) { // <b class="conum">(3)</b>
            with (Headline()) {
                text = "Latest Headline at ${ZonedDateTime.now()}"
                emit(this) // <b class="conum">(4)</b>
                delay(1_000) // <b class="conum">(5)</b>
            }
        }
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A method <code>streamHeadlinesWithFlow</code> is defined that produces <code>application/x-json-stream</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>Flow</code> is created using <code>flow</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This <code>Flow</code> emits 100 messages</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Emitting happens with <code>emit</code> <code>suspend</code> function</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>There is a one second <em>delay</em> between messages</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A streaming client can simply return a <code>Flow</code>, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Streaming client with Flow</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Get
import io.micronaut.http.client.annotation.Client
import kotlinx.coroutines.flow.Flow

@Client("/streaming")
interface HeadlineFlowClient {

    @Get(value = "/headlinesWithFlow", processes = [MediaType.APPLICATION_JSON_STREAM]) // <b class="conum">(1)</b>
    fun streamFlow(): Flow&lt;Headline&gt; // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Get</code> method is defined as processing responses of type <code>APPLICATION_JSON_STREAM</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The return type is <code>Flow</code></td>
</tr>
</table>
</div>

<h2 id="coroutineTracingContextPropagation"><a class="anchor" href="#coroutineTracingContextPropagation"></a>14.3.6 Coroutine Tracing Context Propagation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin/coroutineTracingContextPropagation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports tracing context propagation. If you use <code>suspend</code> functions all the way from your controller actions down to all your services,
you don&#8217;t have to do anything special. However, when you create coroutines within a regular function, tracing propagation won&#8217;t happen automatically.
You have to use a <code>HttpCoroutineContextFactory&lt;CoroutineTracingDispatcher&gt;</code> to create a new <code>CoroutineTracingDispatcher</code> and use it as a <code>CoroutineContext</code>.</p>
</div>
<div class="paragraph">
<p>Following example shows how this might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller
class SimpleController(
    private val coroutineTracingDispatcherFactory: HttpCoroutineContextFactory&lt;CoroutineTracingDispatcher&gt;
) {
    @Get("/runParallelly")
    fun runParallelly(): String = runBlocking {
        val a = async(Dispatchers.Default + coroutineTracingDispatcherFactory.create()) {
            val traceId = MDC.get("traceId")
            println("$traceId: Calculating sth...")
            calculateSth()
        }
        val b = async(Dispatchers.Default + coroutineTracingDispatcherFactory.create()) {
            val traceId = MDC.get("traceId")
            println("$traceId: Calculating sth else...")
            calculateSthElse()
        }

        a.await() + b.await()
    }
}</code></pre>
</div>
</div>

<h2 id="kotlinContextPropagation"><a class="anchor" href="#kotlinContextPropagation"></a>14.3.7 Reactive Context Propagation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/kotlin/kotlinContextPropagation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports context propagation from Reactor&#8217;s context to coroutine context. To enable this propagation you need to include following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"org.jetbrains.kotlinx:kotlinx-coroutines-reactor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;org.jetbrains.kotlinx&lt;/groupId&gt;
    &lt;artifactId&gt;kotlinx-coroutines-reactor&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>For more detailed information on how to use the library you can find at the official <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-reactor/kotlinx.coroutines.reactor/-reactor-context/index.html">documentation</a>.</p>
</div>
<div class="paragraph">
<p>Following example shows how to propagate Reactor context from the HTTP filter to the controller&#8217;s coroutine:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Simple filter which writes into Reactor&#8217;s context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Filter(Filter.MATCH_ALL_PATTERN)
class ReactorHttpServerFilter : HttpServerFilter {

    override fun doFilter(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
        val trackingId = request.headers["X-TrackingId"] as String
        return Mono.from(chain.proceed(request)).contextWrite {
            it.put("reactorTrackingId", trackingId)
        }
    }

    override fun getOrder(): Int = 1
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Access Reactor context by retrieving <code>ReactorContext</code> from the coroutine context:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Reading Reactor context in the coroutine</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Get("/data")
suspend fun getTracingId(request: HttpRequest&lt;*&gt;): String {
    val reactorContextView = currentCoroutineContext()[ReactorContext.Key]!!.context
    return reactorContextView.get("reactorTrackingId") as String
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s possible to use coroutines Reactor integration to create a filter using a suspended function:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Suspended function filter which writes into Reactor&#8217;s context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Filter(Filter.MATCH_ALL_PATTERN)
class SuspendHttpServerFilter : CoroutineHttpServerFilter {

    override suspend fun filter(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): MutableHttpResponse&lt;*&gt; {
        val trackingId = request.headers["X-TrackingId"] as String
        //withContext does not merge the current context so data may be lost
        return withContext(Context.of("suspendTrackingId", trackingId).asCoroutineContext()) {
            chain.next(request)
        }
    }

    override fun getOrder(): Int = 0
}

interface CoroutineHttpServerFilter : HttpServerFilter {

    suspend fun filter(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): MutableHttpResponse&lt;*&gt;

    override fun doFilter(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
        return mono {
            filter(request, chain)
        }
    }

}

suspend fun ServerFilterChain.next(request: HttpRequest&lt;*&gt;): MutableHttpResponse&lt;*&gt; {
    return this.proceed(request).asFlow().single()
}</code></pre>
</div>
</div>

<h2 id="graal"><a class="anchor" href="#graal"></a>14.4 Micronaut for GraalVM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/graal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.graalvm.org">GraalVM</a> is a new universal virtual machine from Oracle that supports a polyglot runtime environment and the ability to compile Java applications to native machine code.</p>
</div>
<div class="paragraph">
<p>Any Micronaut application can be run using the GraalVM JVM, however special support has been added to Micronaut to support running Micronaut applications using <a href="https://www.graalvm.org/reference-manual/native-image/">GraalVM&#8217;s <code>native-image</code> tool</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut currently supports GraalVM version 22.0.0.2 and the team is improving the support in every new release. Don&#8217;t hesitate to <a href="https://github.com/micronaut-projects/micronaut-core/issues">report issues</a> however if you find any problem.</p>
</div>
<div class="paragraph">
<p>Many of Micronaut&#8217;s modules and third-party libraries have been verified to work with GraalVM: HTTP server, HTTP client, Function support, Micronaut Data JDBC and JPA, Service Discovery, RabbitMQ, Views, Security, Zipkin, etc. Support for other modules is evolving and will improve over time.</p>
</div>
<div class="sect2">
<h3 id="_getting_started">Getting Started</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use of GraalVM&#8217;s <code>native-image</code> tool is only supported in Java or Kotlin projects. Groovy relies heavily on reflection which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start using GraalVM, first install the GraalVM SDK via the <a href="https://www.graalvm.org/docs/getting-started/">Getting Started</a>  instructions or using <a href="https://sdkman.io/">Sdkman!</a>.</p>
</div>
</div>

<h2 id="graalServices"><a class="anchor" href="#graalServices"></a>14.4.1 Microservices as GraalVM native images</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/graal/graalServices.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_getting_started_with_micronaut_and_graalvm">Getting Started with Micronaut and GraalVM</h3>
<div class="paragraph">
<p>Since Micronaut 2.2, any Micronaut application is ready to be built into a native image using the Micronaut Gradle or Maven plugins. To get started, create a new application:</p>
</div>
<div class="listingblock">
<div class="title">Creating a GraalVM Native Microservice</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app hello-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>--build maven</code> for a Maven build.</p>
</div>
<div class="sect3">
<h4 id="_building_a_native_image_using_docker">Building a Native Image Using Docker</h4>
<div class="paragraph">
<p>To build your native image using Gradle and Docker, run:</p>
</div>
<div class="listingblock">
<div class="title">Building a Native Image with Docker and Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew dockerBuildNative</code></pre>
</div>
</div>
<div class="paragraph">
<p>To build your native image using Maven and Docker, run:</p>
</div>
<div class="listingblock">
<div class="title">Building a Native Image with Docker and Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw package -Dpackaging=docker-native</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_a_native_image_without_using_docker">Building a Native Image Without Using Docker</h4>
<div class="paragraph">
<p>To build your native image without using Docker, install the GraalVM SDK via the <a href="https://www.graalvm.org/docs/getting-started/">Getting Started</a> instructions or using <a href="https://sdkman.io/">Sdkman!</a>:</p>
</div>
<div class="listingblock">
<div class="title">Installing GraalVM 22.0.0.2 with SDKman</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sdk install java 22.0.0.2.r11-grl
$ sdk use java 22.0.0.2.r11-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>native-image</code> tool was extracted from the base GraalVM distribution and is available as a plugin. To install it, run:</p>
</div>
<div class="listingblock">
<div class="title">Installing <code>native-image</code> tool</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can build a native image with Gradle by running the <code>nativeCompile</code> task:</p>
</div>
<div class="listingblock">
<div class="title">Creating native image with Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew nativeCompile</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native image will be built in the <code>build/native/nativeCompile</code> directory.</p>
</div>
<div class="paragraph">
<p>To create a native image with Maven and the Micronaut Maven plugin, use the <code>native-image</code> packaging format:</p>
</div>
<div class="listingblock">
<div class="title">Creating native image with Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw package -Dpackaging=native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>which builds the native image in the <code>target</code> directory.</p>
</div>
<div class="paragraph">
<p>You can then run the native image from the directory where you built it.</p>
</div>
<div class="listingblock">
<div class="title">Run native image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./hello-world</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_micronaut_and_graalvm">Understanding Micronaut and GraalVM</h3>
<div class="paragraph">
<p>Micronaut itself does not rely on reflection or dynamic classloading, so it works automatically with GraalVM native, however certain third-party libraries used by Micronaut may require additional input about uses of reflection.</p>
</div>
<div class="paragraph">
<p>Micronaut includes an annotation processor that helps to generate reflection configuration that is automatically picked up by the <code>native-image</code> tool:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-graal")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-graal&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>This processor generates additional classes that implement the <a href="../api/io/micronaut/core/graal/GraalReflectionConfigurer.html">GraalReflectionConfigurer</a> inteface and programmatically register reflection configuration.</p>
</div>
<div class="paragraph">
<p>For example the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package example;

import io.micronaut.core.annotation.ReflectiveAccess;

@ReflectiveAccess
class Test {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example results in the public methods, declared fields and declared constructors of <code>example.Test</code> being registered for reflective access.</p>
</div>
<div class="paragraph">
<p>If you have more advanced requirements and only wish to include certain fields or methods, use the annotation on any constructor, field or method to include only the specific field, constructor or method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_additional_classes_for_reflective_access">Adding Additional Classes for Reflective Access</h3>
<div class="paragraph">
<p>To inform Micronaut of additional classes to be included in the generated reflection configuration a number of annotations are available including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/core/annotation/ReflectiveAccess.html">@ReflectiveAccess</a> - An annotation that can be declared on a specific type, constructor, method or field to enable reflective access just for the annotated element.</p>
</li>
<li>
<p><a href="../api/io/micronaut/core/annotation/TypeHint.html">@TypeHint</a> - An annotation that allows to bulk configuration of reflective access to one or many types</p>
</li>
<li>
<p><a href="../api/io/micronaut/core/annotation/ReflectionConfig.html">@ReflectionConfig</a> - A repeatable annotation that directly models the <a href="https://www.graalvm.org/22.0/reference-manual/native-image/Reflection/#manual-configuration">GraalVM reflection config JSON format</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@ReflectiveAccess</code> annotation is typically used on a particular type, constructor, method or field whilst the latter two are typically used on a module or <code>Application</code> class to include classes that are needed reflectively. For example, the following is from Micronaut&#8217;s Jackson module with <code>@TypeHint</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using the <code>@TypeHint</code> annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TypeHint(
    value = { <i class="conum" data-value="1"></i><b>(1)</b>
        PropertyNamingStrategy.UpperCamelCaseStrategy.class,
        ArrayList.class,
        LinkedHashMap.class,
        HashSet.class
    },
    accessType = TypeHint.AccessType.ALL_DECLARED_CONSTRUCTORS <i class="conum" data-value="2"></i><b>(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>value</code> member specifies which classes require reflection.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>accessType</code> member specifies if only classloading access is needed or whether full reflection on all public members is needed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or alternatively with the <code>@ReflectionConfig</code> annotation which is repeatable and allows distinct configuration per type:</p>
</div>
<div class="listingblock">
<div class="title">Using the <code>@ReflectionConfig</code> annotation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ReflectionConfig(
    type = PropertyNamingStrategy.UpperCamelCaseStrategy.class,
    accessType = TypeHint.AccessType.ALL_DECLARED_CONSTRUCTORS
)
@ReflectionConfig(
    type = ArrayList.class,
    accessType = TypeHint.AccessType.ALL_DECLARED_CONSTRUCTORS
)
@ReflectionConfig(
    type = LinkedHashMap.class,
    accessType = TypeHint.AccessType.ALL_DECLARED_CONSTRUCTORS
)
@ReflectionConfig(
    type = HashSet.class,
    accessType = TypeHint.AccessType.ALL_DECLARED_CONSTRUCTORS
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generating_native_images">Generating Native Images</h3>
<div class="paragraph">
<p>GraalVM&#8217;s <code>native-image</code> command generates native images. You can use this command manually to generate your native image. For example:</p>
</div>
<div class="listingblock">
<div class="title">The <code>native-image</code> command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">native-image --class-path build/libs/hello-world-0.1-all.jar <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>class-path</code> argument refers to the Micronaut shaded JAR</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the image is built, run the application using the native image name:</p>
</div>
<div class="listingblock">
<div class="title">Running the Native Application</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./hello-world
15:15:15.153 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 14ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the native image startup completes in milliseconds, and memory consumption does not include the overhead of the JVM (a native Micronaut application runs with just 20mb of memory).</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_file_generation">Resource file generation</h3>
<div class="paragraph">
<p>Starting in Micronaut 3.0 the automatic generation of the <code>resource-config.json</code> file is now part of the <a href="https://github.com/micronaut-projects/micronaut-gradle-plugin">Gradle</a> and <a href="https://github.com/micronaut-projects/micronaut-maven-plugin">Maven</a> plugins.</p>
</div>
</div>

<h2 id="graalFAQ"><a class="anchor" href="#graalFAQ"></a>14.4.2 GraalVM and Micronaut FAQ</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/languageSupport/graal/graalFAQ.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_how_does_micronaut_manage_to_run_on_graalvm">How does Micronaut manage to run on GraalVM?</h4>
<div class="paragraph">
<p>Micronaut features a Dependency Injection and Aspect-Oriented Programming runtime that uses no reflection. This makes it easier for Micronaut applications to run on GraalVM since there are <a href="https://github.com/oracle/graal/blob/master/docs/reference-manual/native-image/Compatibility.md">compatibility</a> concerns particularly around <a href="https://github.com/oracle/graal/blob/master/docs/reference-manual/native-image/Reflection.md">reflection</a> in Native Images.</p>
</div>
</div>
<div class="sect3">
<h4 id="_how_can_i_make_a_micronaut_application_that_uses_picocli_run_on_graalvm">How can I make a Micronaut application that uses picocli run on GraalVM?</h4>
<div class="paragraph">
<p>Picocli provides a <code>picocli-codegen</code> module with a tool for generating a GraalVM reflection configuration file. The tool can be run <a href="https://picocli.info/picocli-on-graalvm.html">manually</a> or automatically as part of the build. The module&#8217;s <a href="https://github.com/remkop/picocli/tree/master/picocli-codegen">README</a> has usage instructions with code snippets for configuring Gradle and Maven to generate a <code>cli-reflect.json</code> file automatically as part of the build. Add the generated file to the <code>-H:ReflectionConfigurationFiles</code> option when running the <code>native-image</code> tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_about_other_third_party_libraries">What about other Third-Party Libraries?</h4>
<div class="paragraph">
<p>Micronaut cannot guarantee that third-party libraries work on GraalVM SubstrateVM, that is down to each individual library to implement support.</p>
</div>
</div>
<div class="sect3">
<h4 id="_i_get_a_class_xxx_is_instantiated_reflectively_exception_what_do_i_do">I Get a "Class XXX is instantiated reflectively&#8230;&#8203;" Exception. What do I do?</h4>
<div class="paragraph">
<p>If you get an error such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Class myclass.Foo[] is instantiated reflectively but was never registered. Register the class by using org.graalvm.nativeimage.RuntimeReflection</pre>
</div>
</div>
<div class="paragraph">
<p>You may need to manually tweak the generated <code>reflect.json</code> file. For regular classes you need to add an entry into the array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        "name" : "myclass.Foo",
        "allDeclaredConstructors" : true
    },
    ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For arrays this must use the Java JVM internal array representation. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        "name" : "[Lmyclass.Foo;",
        "allDeclaredConstructors" : true
    },
    ...
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_what_if_i_want_to_set_the_heaps_maximum_size_with_xmx_but_i_get_an_outofmemoryerror">What if I want to set the heap&#8217;s maximum size with <code>-Xmx</code>, but I get an <code>OutOfMemoryError</code>?</h4>
<div class="paragraph">
<p>If you set the maximum heap size in the Dockerfile that you use to build your native image, you will probably get a runtime error like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.OutOfMemoryError: Direct buffer memory</pre>
</div>
</div>
<div class="paragraph">
<p>The problem is that Netty tries to allocate 16MB of memory per chunk with its default settings for <code>io.netty.allocator.pageSize</code> and <code>io.netty.allocator.maxOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">int defaultChunkSize = DEFAULT_PAGE_SIZE &lt;&lt; DEFAULT_MAX_ORDER; // 8192 &lt;&lt; 11 = 16MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>The simplest solution is to specify <code>io.netty.allocator.maxOrder</code> explicitly in your Dockerfile&#8217;s entrypoint. A working example with <code>-Xmx64m</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">ENTRYPOINT ["/app/application", "-Xmx64m", "-Dio.netty.allocator.maxOrder=8"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To go further, you can also experiment with <code>io.netty.allocator.numHeapArenas</code> or <code>io.netty.allocator.numDirectArenas</code>. You can find more information about Netty&#8217;s <code>PooledByteBufAllocator</code> in the <a href="https://netty.io/4.1/api/io/netty/buffer/PooledByteBufAllocator.html">official documentation</a>.</p>
</div>
</div>

<h1 id="management"><a class="anchor" href="#management"></a>15 Management & Monitoring</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>management</code> feature to configure the management endpoints in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features management</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Inspired by Spring Boot and Grails, the Micronaut <code>management</code> dependency adds support for monitoring of your application via <strong>endpoints</strong>: special URIs that return details about the health and state of your application. The <code>management</code> endpoints are also integrated with Micronaut&#8217;s <code>security</code> dependency, allowing for sensitive data to be restricted to authenticated users in your security system (see <a href="https://micronaut-projects.github.io/micronaut-security/3.11.1/guide/#builtInEndpointsAccess">Built-in Endpoints Access</a> in the Security section).</p>
</div>
<div class="paragraph">
<p>To use the <code>management</code> features described in this section, add this dependency to your build:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-management")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-management&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>

<h2 id="buildingEndpoints"><a class="anchor" href="#buildingEndpoints"></a>15.1 Creating Endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/buildingEndpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to the <a href="#providedEndpoints">Built-In Endpoints</a>, the <code>management</code> dependency also provides support for creating custom endpoints. These can be enabled and configured like the built-in endpoints, and can be used to retrieve and return any metrics or other application data.</p>
</div>

<h2 id="endpointAnnotation"><a class="anchor" href="#endpointAnnotation"></a>15.1.1 The Endpoint Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/buildingEndpoints/endpointAnnotation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>An Endpoint can be created by annotating a class with the <a href="../api/io/micronaut/management/endpoint/annotation/Endpoint.html">Endpoint</a> annotation, and supplying it with (at minimum) an endpoint id.</p>
</div>
<div class="listingblock">
<div class="title">FooEndpoint.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Endpoint("foo")
class FooEndpoint {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a single <code>String</code> argument is supplied to the annotation, it is used as the endpoint id.</p>
</div>
<div class="paragraph">
<p>It is possible to supply additional (named) arguments to the annotation. Other possible arguments to <code>@Endpoint</code> are described in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Endpoint Arguments</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Endpoint Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint id (or name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(id = "foo")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix used for configuring the endpoint (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(prefix = "foo")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean defaultEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the endpoint is enabled when no configuration is set (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(defaultEnabled = false)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean defaultSensitive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the endpoint is sensitive if no configuration is set (see <a href="#endpointConfiguration">Endpoint Configuration</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Endpoint(defaultSensitive = false)</code></p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_example_of_custom_endpoint">Example of custom Endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following example <code>Endpoint</code> class creates an endpoint accessible at <code>/date</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
public class CurrentDateEndpoint {

//.. endpoint methods

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
class CurrentDateEndpoint {

//.. endpoint methods

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

//.. endpoint methods

}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="endpointMethod"><a class="anchor" href="#endpointMethod"></a>15.1.2 Endpoint Methods</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/buildingEndpoints/endpointMethod.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoints respond to <code>GET</code> ("read"), <code>POST</code> ("write") and <code>DELETE</code> ("delete") requests. To return a response from an endpoint, annotate its public method(s) with one of the following annotations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Endpoint Method Annotations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Read.html">Read</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>GET</code> requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Write.html">Write</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>POST</code> requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Delete.html">Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responds to <code>DELETE</code> requests</p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_read_methods">Read Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/annotation/Read.html">Read</a> annotation causes it to respond to <code>GET</code> requests.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Read;

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
public class CurrentDateEndpoint {

private Date currentDate;

@Read
public Date currentDate() {
    return currentDate;
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
class CurrentDateEndpoint {

private Date currentDate

@Read
Date currentDate() {
    currentDate
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

private var currentDate: Date? = null

@Read
fun currentDate(): Date? {
    return currentDate
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X GET localhost:55838/date

1526085903689</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/annotation/Read.html">Read</a> annotation accepts an optional <code>produces</code> argument, which sets the media type returned from the method (default is <code>application/json</code>):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Read;

import io.micronaut.http.MediaType;
import io.micronaut.management.endpoint.annotation.Selector;

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
public class CurrentDateEndpoint {

private Date currentDate;

@Read(produces = MediaType.TEXT_PLAIN) //<b class="conum">(1)</b>
public String currentDatePrefix(@Selector String prefix) {
    return prefix + ": " + currentDate;
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
class CurrentDateEndpoint {

private Date currentDate

@Read(produces = MediaType.TEXT_PLAIN) //<b class="conum">(1)</b>
String currentDatePrefix(@Selector String prefix) {
    "$prefix: $currentDate"
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Read

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector

@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

private var currentDate: Date? = null

@Read(produces = [MediaType.TEXT_PLAIN]) //<b class="conum">(1)</b>
fun currentDatePrefix(@Selector prefix: String): String {
    return "$prefix: $currentDate"
}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Supported media types are represented by <a href="../api/io/micronaut/http/MediaType.html">MediaType</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X GET localhost:8080/date/the_date_is

the_date_is: Fri May 11 19:24:21 CDT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_write_methods">Write Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/annotation/Write.html">Write</a> annotation causes it to respond to <code>POST</code> requests.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Write;

import io.micronaut.http.MediaType;
import io.micronaut.management.endpoint.annotation.Selector;

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
public class CurrentDateEndpoint {

private Date currentDate;

@Write
public String reset() {
    currentDate = new Date();

    return "Current date reset";
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector

@Endpoint(id = "date",
          prefix = "custom",
          defaultEnabled = true,
          defaultSensitive = false)
class CurrentDateEndpoint {

private Date currentDate

@Write
String reset() {
    currentDate = new Date()

    return "Current date reset"
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">CurrentDateEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Selector

@Endpoint(id = "date", prefix = "custom", defaultEnabled = true, defaultSensitive = false)
class CurrentDateEndpoint {

private var currentDate: Date? = null

@Write
fun reset(): String {
    currentDate = Date()

    return "Current date reset"
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:39357/date

Current date reset</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/annotation/Write.html">Write</a> annotation accepts an optional <code>consumes</code> argument, which sets the media type accepted by the method (default is <code>application/json</code>):</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Write;

import io.micronaut.http.MediaType;

@Endpoint(id = "message", defaultSensitive = false)
public class MessageEndpoint {

String message;

@Write(consumes = MediaType.APPLICATION_FORM_URLENCODED, produces = MediaType.TEXT_PLAIN)
public String updateMessage(String newMessage) {
    this.message = newMessage;

    return "Message updated";
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

String message

@Write(consumes = MediaType.APPLICATION_FORM_URLENCODED, produces = MediaType.TEXT_PLAIN)
String updateMessage(String newMessage) {  //<b class="conum">(1)</b>
    message = newMessage

    return "Message updated"
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Write

import io.micronaut.http.MediaType

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

internal var message: String? = null

@Write(consumes = [MediaType.APPLICATION_FORM_URLENCODED], produces = [MediaType.TEXT_PLAIN])
fun updateMessage(newMessage: String): String {  //<b class="conum">(1)</b>
    this.message = newMessage

    return "Message updated"
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:65013/message -H 'Content-Type: application/x-www-form-urlencoded' -d $'newMessage=A new message'

Message updated</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delete_methods">Delete Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Annotating a method with the <a href="../api/io/micronaut/management/endpoint/annotation/Delete.html">Delete</a> annotation causes it to respond to <code>DELETE</code> requests.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.management.endpoint.annotation.Endpoint;

import io.micronaut.management.endpoint.annotation.Delete;

@Endpoint(id = "message", defaultSensitive = false)
public class MessageEndpoint {

String message;

@Delete
public String deleteMessage() {
    this.message = null;

    return "Message deleted";
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Delete

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

String message

@Delete
String deleteMessage() {
    message = null

    return "Message deleted"
}

}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.management.endpoint.annotation.Endpoint

import io.micronaut.management.endpoint.annotation.Delete

@Endpoint(id = "message", defaultSensitive = false)
class MessageEndpoint {

internal var message: String? = null

@Delete
fun deleteMessage(): String {
    this.message = null

    return "Message deleted"
}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method responds to the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X DELETE http://localhost:65013/message

Message deleted</code></pre>
</div>
</div>
</div>
</div>

<h2 id="endpointSensitivity"><a class="anchor" href="#endpointSensitivity"></a>15.1.3 Endpoint Sensitivity</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/buildingEndpoints/endpointSensitivity.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoint sensitivity can be controlled for the entire endpoint through the endpoint annotation and configuration. Individual methods can be configured independently from the endpoint as a whole, however. The <a href="../api/io/micronaut/management/endpoint/annotation/Sensitive.html">@Sensitive</a> annotation can be applied to methods to control their sensitivity.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AlertsEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.management.endpoint.annotation.Delete;
import io.micronaut.management.endpoint.annotation.Endpoint;
import io.micronaut.management.endpoint.annotation.Read;
import io.micronaut.management.endpoint.annotation.Sensitive;
import io.micronaut.management.endpoint.annotation.Write;

import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

@Endpoint(id = "alerts", defaultSensitive = false) // <b class="conum">(1)</b>
public class AlertsEndpoint {

    private final List&lt;String&gt; alerts = new CopyOnWriteArrayList&lt;&gt;();

    @Read
    List&lt;String&gt; getAlerts() {
        return alerts;
    }

    @Delete
    @Sensitive(true)  // <b class="conum">(2)</b>
    void clearAlerts() {
        alerts.clear();
    }

    @Write(consumes = MediaType.TEXT_PLAIN)
    @Sensitive(property = "add.sensitive", defaultValue = true) // <b class="conum">(3)</b>
    void addAlert(String alert) {
        alerts.add(alert);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AlertsEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Delete
import io.micronaut.management.endpoint.annotation.Endpoint
import io.micronaut.management.endpoint.annotation.Read
import io.micronaut.management.endpoint.annotation.Sensitive
import io.micronaut.management.endpoint.annotation.Write

import java.util.concurrent.CopyOnWriteArrayList

@Endpoint(id = "alerts", defaultSensitive = false) // <b class="conum">(1)</b>
class AlertsEndpoint {

    private final List&lt;String&gt; alerts = new CopyOnWriteArrayList&lt;&gt;();

    @Read
    List&lt;String&gt; getAlerts() {
        alerts
    }

    @Delete
    @Sensitive(true) // <b class="conum">(2)</b>
    void clearAlerts() {
        alerts.clear()
    }

    @Write(consumes = MediaType.TEXT_PLAIN)
    @Sensitive(property = "add.sensitive", defaultValue = true) // <b class="conum">(3)</b>
    void addAlert(String alert) {
        alerts &lt;&lt; alert
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">AlertsEndpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.management.endpoint.annotation.Delete
import io.micronaut.management.endpoint.annotation.Endpoint
import io.micronaut.management.endpoint.annotation.Read
import io.micronaut.management.endpoint.annotation.Sensitive
import io.micronaut.management.endpoint.annotation.Write
import java.util.concurrent.CopyOnWriteArrayList

@Endpoint(id = "alerts", defaultSensitive = false) // <b class="conum">(1)</b>
class AlertsEndpoint {

    private val alerts: MutableList&lt;String&gt; = CopyOnWriteArrayList()

    @Read
    fun getAlerts(): List&lt;String&gt; {
        return alerts
    }

    @Delete
    @Sensitive(true)  // <b class="conum">(2)</b>
    fun clearAlerts() {
        alerts.clear()
    }

    @Write(consumes = [MediaType.TEXT_PLAIN])
    @Sensitive(property = "add.sensitive", defaultValue = true)  // <b class="conum">(3)</b>
    fun addAlert(alert: String) {
        alerts.add(alert)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The endpoint is not sensitive by default, and the default prefix of <code>endpoints</code> is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method is always sensitive, regardless of any other factors</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>property</code> value is appended to the prefix and id to lookup a configuration value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the configuration key <code>endpoints.alerts.add.sensitive</code> is set, that value determines the sensitivity of the <code>addAlert</code> method.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>endpoint</code> is the first token because that is the default value for <code>prefix</code> in the endpoint annotation and is not set explicitly in this example.</p>
</li>
<li>
<p><code>alerts</code> is the next token because that is the endpoint id</p>
</li>
<li>
<p><code>add.sensitive</code> is the next token because that is the value set to the <code>property</code> member of the <a href="../api/io/micronaut/management/endpoint/annotation/Sensitive.html">@Sensitive</a> annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the configuration key is not set, the <code>defaultValue</code> is used (defaults to <code>true</code>).</p>
</div>

<h2 id="endpointConfiguration"><a class="anchor" href="#endpointConfiguration"></a>15.1.4 Endpoint Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/buildingEndpoints/endpointConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Endpoints with the <code>endpoints</code> prefix can be configured through their default endpoint id. If an endpoint exists with the id of <code>foo</code>, it can be configured through <code>endpoints.foo</code>. In addition, default values can be provided through the <code>all</code> prefix.</p>
</div>
<div class="paragraph">
<p>For example, consider the following endpoint.</p>
</div>
<div class="listingblock">
<div class="title">FooEndpoint.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Endpoint("foo")
class FooEndpoint {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the endpoint is enabled. To disable it, set <code>endpoints.foo.enabled</code> to false. If <code>endpoints.foo.enabled</code> is not set and <code>endpoints.all.enabled</code> is <code>false</code>, the endpoint will be disabled.</p>
</div>
<div class="paragraph">
<p>The configuration values for the endpoint override those for <code>all</code>. If <code>endpoints.foo.enabled</code> is <code>true</code> and <code>endpoints.all.enabled</code> is <code>false</code>, the endpoint will be enabled.</p>
</div>
<div class="paragraph">
<p>For all endpoints, the following configuration values can be set.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.&lt;any endpoint id&gt;.enabled=Boolean
endpoints.&lt;any endpoint id&gt;.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  &lt;any endpoint id&gt;:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  &lt;any endpoint id&gt; {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    &lt;any endpoint id&gt; {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "&lt;any endpoint id&gt;": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The base path for all endpoints is <code>/</code> by default. If you prefer the endpoints to be available under a different base path, configure <code>endpoints.all.path</code>. For example, if the value is set to <code>/endpoints/</code>, the foo endpoint will be accessible at <code>/endpoints/foo</code>, relative to the context path. Note that the leading and trailing <code>/</code> are required for <code>endpoints.all.path</code> unless <code>micronaut.server.context-path</code> is set, in which case the leading <code>/</code> isn&#8217;t necessary.
</td>
</tr>
</table>
</div>

<h2 id="providedEndpoints"><a class="anchor" href="#providedEndpoints"></a>15.2 Built-In Endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the <code>management</code> dependency is added to your project, the following built-in endpoints are enabled by default:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Default Endpoints</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/beans/BeansEndpoint.html">BeansEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/beans</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the loaded bean definitions in the application (see <a href="#beansEndpoint">BeansEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/health/HealthEndpoint.html">HealthEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the "health" of the application (see <a href="#healthEndpoint">HealthEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/info/InfoEndpoint.html">InfoEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns static information from the state of the application (see <a href="#infoEndpoint">InfoEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/loggers/LoggersEndpoint.html">LoggersEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/loggers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about available loggers and permits changing the configured log level (see <a href="#loggersEndpoint">LoggersEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#metricsEndpoint">MetricsEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the <a href="#metricsEndpoint">application metrics</a>. Requires the <code>micrometer-core</code> configuration on the classpath.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/refresh/RefreshEndpoint.html">RefreshEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/refresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refreshes the application state (see <a href="#refreshEndpoint">RefreshEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/routes/RoutesEndpoint.html">RoutesEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/routes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about URIs available to be called for your application (see <a href="#routesEndpoint">RoutesEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/threads/ThreadDumpEndpoint.html">ThreadDumpEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/threaddump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the current threads in the application.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, the following built-in endpoint(s) are provided by the <code>management</code> dependency but are not enabled by default:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Disabled Endpoints</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/env/EnvironmentEndpoint.html">EnvironmentEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/env</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the environment and its property sources (see <a href="#environmentEndpoint">EnvironmentEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#cachesEndpoint">CachesEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/caches</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns information about the caches and permits invalidating them (see <a href="#cachesEndpoint">CachesEndpoint</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/stop/ServerStopEndpoint.html">ServerStopEndpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shuts down the application server (see <a href="#stopEndpoint">ServerStopEndpoint</a>)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is possible to open all endpoints for unauthenticated access defining <code>endpoints.all.sensitive: false</code> but
this should be used with care because private and sensitive information will be exposed.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_management_port">Management Port</h3>
<div class="paragraph">
<p>By default, all management endpoints are exposed over the same port as the application. You can alter this behaviour by specifying the <code>endpoints.all.port</code> setting:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.all.port=8085</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  all:
    port: 8085</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.all]
    port=8085</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  all {
    port = 8085
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    all {
      port = 8085
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "all": {
      "port": 8085
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example the management endpoints are exposed only over port 8085.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jmx">JMX</h3>
<div class="paragraph">
<p>Micronaut provides functionality to register endpoints with JMX. See the section on <a href="#jmx">JMX</a> to get started.</p>
</div>
</div>

<h2 id="beansEndpoint"><a class="anchor" href="#beansEndpoint"></a>15.2.1 The Beans Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/beansEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The beans endpoint returns information about the loaded bean definitions in the application. The bean data returned by default is an object where the key is the bean definition class name and the value is an object of properties about the bean.</p>
</div>
<div class="paragraph">
<p>To execute the beans endpoint, send a GET request to /beans.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the beans endpoint, supply configuration through <code>endpoints.beans</code>.</p>
</div>
<div class="openblock">
<div class="title">Beans Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.beans.enabled=Boolean
endpoints.beans.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  beans:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.beans]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  beans {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    beans {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "beans": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The beans endpoint is composed of a bean definition data collector and a bean data implementation. The bean definition data collector (<a href="../api/io/micronaut/management/endpoint/beans/BeanDefinitionDataCollector.html">BeanDefinitionDataCollector</a>) is responsible for returning a publisher that returns the data used in the response. The bean definition data (<a href="../api/io/micronaut/management/endpoint/beans/BeanDefinitionData.html">BeanDefinitionData</a>) is responsible for returning data about an individual bean definition.</p>
</div>
<div class="paragraph">
<p>To override the default behavior for either of the helper classes, either extend the default implementations (<a href="../api/io/micronaut/management/endpoint/beans/impl/DefaultBeanDefinitionDataCollector.html">DefaultBeanDefinitionDataCollector</a>, <a href="../api/io/micronaut/management/endpoint/beans/impl/DefaultBeanDefinitionData.html">DefaultBeanDefinitionData</a>), or implement the relevant interface directly. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the default implementation.</p>
</div>
</div>
</div>

<h2 id="infoEndpoint"><a class="anchor" href="#infoEndpoint"></a>15.2.2 The Info Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/infoEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The info endpoint returns static information from the state of the application. The info exposed can be provided by any number of "info sources".</p>
</div>
<div class="paragraph">
<p>To execute the info endpoint, send a GET request to /info.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the info endpoint, supply configuration through <code>endpoints.info</code>.</p>
</div>
<div class="openblock">
<div class="title">Info Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.info.enabled=Boolean
endpoints.info.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  info:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.info]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  info {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    info {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "info": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The info endpoint consists of an info aggregator and any number of info sources. To add an info source, create a bean class that implements <a href="../api/io/micronaut/management/endpoint/info/InfoSource.html">InfoSource</a>. If your info source needs to retrieve data from Java properties files, extend the <a href="../api/io/micronaut/management/endpoint/info/source/PropertiesInfoSource.html">PropertiesInfoSource</a> interface which provides a helper method for this purpose.</p>
</div>
<div class="paragraph">
<p>All info source beans are collected together with the info aggregator. To provide your own implementation of the info aggregator, create a class that implements <a href="../api/io/micronaut/management/endpoint/info/InfoAggregator.html">InfoAggregator</a> and register it as a bean. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the <a href="../api/io/micronaut/management/endpoint/info/impl/ReactiveInfoAggregator.html">default implementation</a>.</p>
</div>
<div class="paragraph">
<p>The default info aggregator returns a map containing the combined properties returned by all the info sources. This map is returned as JSON from the /info endpoint.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provided_info_sources">Provided Info Sources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configuration_info_source">Configuration Info Source</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/info/source/ConfigurationInfoSource.html">ConfigurationInfoSource</a> returns configuration properties under the <code>info</code> key. In addition to string, integer and boolean values, more complex properties can be exposed as maps in the JSON output (if the configuration format supports it).</p>
</div>
<div class="listingblock">
<div class="title">Info Source Example (<code>application.groovy</code>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">info.demo.string = "demo string"
info.demo.number = 123
info.demo.map = [key: 'value', other_key: 123]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above config results in the following JSON response from the info endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "demo": {
    "string": "demo string",
    "number": 123,
    "map": {
      "key": "value",
      "other_key": 123
    }
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2">Configuration</h4>
<div class="paragraph">
<p>The configuration info source can be disabled using the <code>endpoints.info.config.enabled</code> property.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_git_info_source">Git Info Source</h3>
<div class="paragraph">
<p>If a <code>git.properties</code> file is available on the classpath, the <a href="../api/io/micronaut/management/endpoint/info/source/GitInfoSource.html">GitInfoSource</a> exposes the values in that file under the <code>git</code> key. Generating of a <code>git.properties</code> file must be configured as part of your build. One easy option for Gradle users is the <a href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties">Gradle Git Properties Plugin</a>. Maven users can use the <a href="https://github.com/git-commit-id/maven-git-commit-id-plugin">Maven Git Commit ID Plugin</a>.</p>
</div>
<div class="sect3">
<h4 id="_configuration_3">Configuration</h4>
<div class="paragraph">
<p>To specify an alternate path or name of the properties file, supply a custom value in the <code>endpoints.info.git.location</code> property.</p>
</div>
<div class="paragraph">
<p>The git info source can be disabled using the <code>endpoints.info.git.enabled</code> property.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_info_source">Build Info Source</h3>
<div class="paragraph">
<p>If a <code>META-INF/build-info.properties</code> file is available on the classpath, the <a href="../api/io/micronaut/management/endpoint/info/source/BuildInfoSource.html">BuildInfoSource</a> exposes the values in that file under the <code>build</code> key. Generating a <code>build-info.properties</code> file must be configured as part of your build. One easy option for Gradle users is the <a href="https://plugins.gradle.org/plugin/com.pasam.gradle.buildinfo">Gradle Build Info Plugin</a>. An option for Maven users is the <a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-build-info">Spring Boot Maven Plugin</a></p>
</div>
<div class="sect3">
<h4 id="_configuration_4">Configuration</h4>
<div class="paragraph">
<p>To specify an alternate path/name of the properties file, supply a custom value in the <code>endpoints.info.build.location</code> property.</p>
</div>
<div class="paragraph">
<p>The build info source can be disabled using the <code>endpoints.info.build.enabled</code> property.</p>
</div>
</div>
</div>
</div>
</div>

<h2 id="healthEndpoint"><a class="anchor" href="#healthEndpoint"></a>15.2.3 The Health Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/healthEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The health endpoint returns information about the "health" of the application, which is determined by any number of "health indicators".</p>
</div>
<div class="paragraph">
<p>To execute the health endpoint, send a GET request to /health. Additionally the health endpoint exposes /health/liveness and /health/readiness health indicators.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the health endpoint, supply configuration through <code>endpoints.health</code>.</p>
</div>
<div class="openblock">
<div class="title">Health Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.health.enabled=Boolean
endpoints.health.sensitive=Boolean
endpoints.health.details-visible=String
endpoints.health.status.http-mapping=Map&lt;String, HttpStatus&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  health:
    enabled: Boolean
    sensitive: Boolean
    details-visible: String
    status:
      http-mapping: Map&lt;String, HttpStatus&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.health]
    enabled="Boolean"
    sensitive="Boolean"
    details-visible="String"
    [endpoints.health.status]
      http-mapping="Map&lt;String, HttpStatus&gt;"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  health {
    enabled = "Boolean"
    sensitive = "Boolean"
    detailsVisible = "String"
    status {
      httpMapping = "Map&lt;String, HttpStatus&gt;"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    health {
      enabled = "Boolean"
      sensitive = "Boolean"
      details-visible = "String"
      status {
        http-mapping = "Map&lt;String, HttpStatus&gt;"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "health": {
      "enabled": "Boolean",
      "sensitive": "Boolean",
      "details-visible": "String",
      "status": {
        "http-mapping": "Map&lt;String, HttpStatus&gt;"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>details-visible</code> is one of <a href="../api/io/micronaut/management/endpoint/health/DetailsVisibility.html">DetailsVisibility</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>details-visible</code> setting controls whether health detail will be exposed to users who are not authenticated.</p>
</div>
<div class="paragraph">
<p>For example, setting:</p>
</div>
<div class="openblock">
<div class="title">Using <code>details-visible</code></div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.health.details-visible=ANONYMOUS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  health:
    details-visible: ANONYMOUS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.health]
    details-visible="ANONYMOUS"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  health {
    detailsVisible = "ANONYMOUS"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    health {
      details-visible = "ANONYMOUS"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "health": {
      "details-visible": "ANONYMOUS"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>exposes detailed information from the various health indicators about the health status of the application to anonymous unauthenticated users.</p>
</div>
<div class="paragraph">
<p>The <code>endpoints.health.status.http-mapping</code> setting controls which status codes to return for each health status. The defaults are described in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">HTTP Code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/health/HealthStatus.html#UP">UP</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpStatus.html#OK">OK</a> (200)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/health/HealthStatus.html#UNKNOWN">UNKNOWN</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpStatus.html#OK">OK</a> (200)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/health/HealthStatus.html#DOWN">DOWN</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/HttpStatus.html#SERVICE_UNAVAILABLE">SERVICE_UNAVAILABLE</a> (503)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can provide custom mappings in your configuration file (e.g <code>application.yml</code>):</p>
</div>
<div class="openblock">
<div class="title">Custom Health Status Codes</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.health.status.http-mapping.DOWN=200</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  health:
    status:
      http-mapping:
        DOWN: 200</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.health]
    [endpoints.health.status]
      [endpoints.health.status.http-mapping]
        DOWN=200</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  health {
    status {
      httpMapping {
        DOWN = 200
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    health {
      status {
        http-mapping {
          DOWN = 200
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "health": {
      "status": {
        "http-mapping": {
          "DOWN": 200
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above returns <a href="../api/io/micronaut/http/HttpStatus.html#OK">OK</a> (200) even when the <a href="../api/io/micronaut/health/HealthStatus.html">HealthStatus</a> is <a href="../api/io/micronaut/health/HealthStatus.html#DOWN">DOWN</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The health endpoint consists of a health aggregator and any number of health indicators. To add a health indicator, create a bean class that implements <a href="../api/io/micronaut/management/health/indicator/HealthIndicator.html">HealthIndicator</a>. It is recommended to also use either <a href="../api/io/micronaut/management/health/indicator/annotation/Liveness.html">@Liveness</a> or <a href="../api/io/micronaut/management/health/indicator/annotation/Readiness.html">@Readiness</a> qualifier. If no qualifier is used, the health indicator will be part of /health and /health/readiness endpoints. A base class <a href="../api/io/micronaut/management/health/indicator/AbstractHealthIndicator.html">AbstractHealthIndicator</a> is available to subclass to make the process easier.</p>
</div>
<div class="paragraph">
<p>All health indicator beans are collected together with the health aggregator. To provide your own implementation of the health aggregator, create a class that implements <a href="../api/io/micronaut/management/health/aggregator/HealthAggregator.html">HealthAggregator</a> and register it as a bean. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the default implementation <a href="../api/io/micronaut/management/health/aggregator/DefaultHealthAggregator.html">DefaultHealthAggregator</a>.</p>
</div>
<div class="paragraph">
<p>The default health aggregator returns an overall status calculated based on the health statuses of the indicators. A <a href="../api/io/micronaut/health/HealthStatus.html">health status</a> consists of several pieces of information.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the functionality the indicator represents is functional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How severe the status is. A higher number is more severe</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The "worst" status is returned as the overall status. A non-operational status is selected over an operational status. A higher severity is selected over a lower severity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provided_indicators">Provided Indicators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All Micronaut provided health indicators are exposed on /health and /health/readiness endpoints.</p>
</div>
<div class="sect2">
<h3 id="_disk_space">Disk Space</h3>
<div class="paragraph">
<p>A health indicator is provided that determines the health of the application based on the amount of free disk space. Configuration for the disk space health indicator can be provided under the <code>endpoints.health.disk-space</code> key.</p>
</div>
<div class="openblock">
<div class="title">Disk Space Indicator Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.health.disk-space.enabled=Boolean
endpoints.health.disk-space.path=String
endpoints.health.disk-space.threshold=String | Long</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  health:
    disk-space:
      enabled: Boolean
      path: String
      threshold: String | Long</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.health]
    [endpoints.health.disk-space]
      enabled="Boolean"
      path="String"
      threshold="String | Long"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  health {
    diskSpace {
      enabled = "Boolean"
      path = "String"
      threshold = "String | Long"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    health {
      disk-space {
        enabled = "Boolean"
        path = "String"
        threshold = "String | Long"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "health": {
      "disk-space": {
        "enabled": "Boolean",
        "path": "String",
        "threshold": "String | Long"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>path</code> specifies the path used to determine the disk space</p>
</li>
<li>
<p><code>threshold</code> specifies the minimum amount of free space</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The threshold can be provided as a string like "10MB" or "200KB", or the number of bytes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jdbc">JDBC</h3>
<div class="paragraph">
<p>The JDBC health indicator determines the health of your application based on the ability to successfully create connections to datasources in the application context. The only configuration option supported is to enable or disable the indicator by the <code>endpoints.health.jdbc.enabled</code> key.</p>
</div>
</div>
<div class="sect2">
<h3 id="_discovery_client">Discovery Client</h3>
<div class="paragraph">
<p>If your application uses service discovery, a health indicator is included to monitor the health of the discovery client. The data returned can include a list of the services available.</p>
</div>
</div>
</div>
</div>

<h2 id="metricsEndpoint"><a class="anchor" href="#metricsEndpoint"></a>15.2.4 The Metrics Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/metricsEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut can expose application metrics via integration with <a href="https://micrometer.io">Micrometer</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply one of the micrometer features to enable metrics and preconfigure the selected registry in your project. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features micrometer-atlas</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The metrics endpoint returns information about the "metrics" of the application. To execute the metrics endpoint, send a GET request to <code>/metrics</code>. This returns a list of available metric names.</p>
</div>
<div class="paragraph">
<p>You can get specific metrics by using <code>/metrics/[name]</code> such as <code>/metrics/jvm.memory.used</code>.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-micrometer/latest/guide/">Micronaut Micrometer</a> for a list of registries and information on how to configure, expose and customize metrics output.</p>
</div>

<h2 id="refreshEndpoint"><a class="anchor" href="#refreshEndpoint"></a>15.2.5 The Refresh Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/refreshEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The refresh endpoint refreshes the application state, causing all <a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">Refreshable</a> beans in the context to be destroyed and reinstantiated upon further requests. This is accomplished by publishing a <a href="../api/io/micronaut/runtime/context/scope/refresh/RefreshEvent.html">RefreshEvent</a> in the Application Context.</p>
</div>
<div class="paragraph">
<p>To execute the refresh endpoint, send a POST request to /refresh.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:8080/refresh</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executed without a body, the endpoint first refreshes the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> and performs a diff to detect any changes, and then only performs the refresh if changes are detected. To skip this check and refresh all <code>@Refreshable</code> beans regardless of environment changes (e.g., to force refresh of cached responses from third-party services), add a <code>force</code> parameter in the POST request body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -X POST http://localhost:8080/refresh -H 'Content-Type: application/json' -d '{"force": true}'</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the refresh endpoint, supply configuration through <code>endpoints.refresh</code>.</p>
</div>
<div class="openblock">
<div class="title">Beans Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.refresh.enabled=Boolean
endpoints.refresh.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  refresh:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.refresh]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  refresh {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    refresh {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "refresh": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>

<h2 id="routesEndpoint"><a class="anchor" href="#routesEndpoint"></a>15.2.6 The Routes Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/routesEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The routes endpoint returns information about URIs available to be called for your application. By default the data returned includes the URI, allowed method, content types produced, and information about the method that would be executed.</p>
</div>
<div class="paragraph">
<p>To execute the routes endpoint, send a GET request to /routes.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the routes endpoint, supply configuration through <code>endpoints.routes</code>.</p>
</div>
<div class="openblock">
<div class="title">Routes Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.routes.enabled=Boolean
endpoints.routes.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  routes:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.routes]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  routes {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    routes {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "routes": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The routes endpoint is composed of a route data collector and a route data implementation. The route data collector (<a href="../api/io/micronaut/management/endpoint/routes/RouteDataCollector.html">RouteDataCollector</a>) is responsible for returning a publisher that returns the data used in the response. The route data (<a href="../api/io/micronaut/management/endpoint/routes/RouteData.html">RouteData</a>) is responsible for returning data about an individual route.</p>
</div>
<div class="paragraph">
<p>To override the default behavior for either of the helper classes, either extend the default implementations (<a href="../api/io/micronaut/management/endpoint/routes/impl/DefaultRouteDataCollector.html">DefaultRouteDataCollector</a>, <a href="../api/io/micronaut/management/endpoint/routes/impl/DefaultRouteData.html">DefaultRouteData</a>), or implement the relevant interface directly. To ensure your implementation is used instead of the default, add the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation to your class with the value being the default implementation.</p>
</div>
</div>
</div>

<h2 id="loggersEndpoint"><a class="anchor" href="#loggersEndpoint"></a>15.2.7 The Loggers Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/loggersEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The loggers endpoint returns information about the available loggers in the application and permits configuring their log level.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The loggers endpoint is disabled by default and must be explicitly enabled with the setting <code>endpoints.loggers.enabled=true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get a collection of all loggers by name with their configured and effective log levels, send a GET request to /loggers. This also provides a list of the available log levels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:8080/loggers

{
    "levels": [
        "ALL", "TRACE", "DEBUG", "INFO", "WARN", "ERROR", "OFF", "NOT_SPECIFIED"
    ],
    "loggers": {
        "ROOT": {
            "configuredLevel": "INFO",
            "effectiveLevel": "INFO"
        },
        "io": {
            "configuredLevel": "NOT_SPECIFIED",
            "effectiveLevel": "INFO"
        },
        "io.micronaut": {
            "configuredLevel": "NOT_SPECIFIED",
            "effectiveLevel": "INFO"
        },
        // etc...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the log levels of a particular logger, include the logger name in your GET request. For example, to access the log levels of the logger 'io.micronaut.http':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:8080/loggers/io.micronaut.http

{
    "configuredLevel": "NOT_SPECIFIED",
    "effectiveLevel": "INFO"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the named logger does not exist, it is created with an unspecified (i.e. <code>NOT_SPECIFIED</code>) configured log level (its effective log level is usually that of the root logger).</p>
</div>
<div class="paragraph">
<p>To update the log level of a single logger, send a POST request to the named logger URL and include a body providing the log level to configure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -i -X POST \
       -H "Content-Type: application/json" \
       -d '{ "configuredLevel": "ERROR" }' \
       http://localhost:8080/loggers/ROOT

HTTP/1.1 200 OK

$ curl http://localhost:8080/loggers/ROOT

{
    "configuredLevel": "ERROR",
    "effectiveLevel": "ERROR"
}</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the loggers endpoint, supply configuration through <code>endpoints.loggers</code>.</p>
</div>
<div class="openblock">
<div class="title">Loggers Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.loggers.enabled=Boolean
endpoints.loggers.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  loggers:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.loggers]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  loggers {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    loggers {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "loggers": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the endpoint doesn&#8217;t allow changing the log level by unauthorized users (even if <code>sensitive</code> is set to <code>false</code>). To allow this you must set <code>endpoints.loggers.write-sensitive</code> to <code>false</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The loggers endpoint is composed of two customizable parts: a <a href="../api/io/micronaut/management/endpoint/loggers/LoggersManager.html">LoggersManager</a> and a <a href="../api/io/micronaut/logging/LoggingSystem.html">LoggingSystem</a>. See the <a href="#logging">logging section of the documentation</a> for information on customizing the logging system.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/management/endpoint/loggers/LoggersManager.html">LoggersManager</a> is responsible for retrieving and setting log levels. If the default implementation is not sufficient for your use case, simply provide your own implementation and replace the <a href="../api/io/micronaut/management/endpoint/loggers/impl/DefaultLoggersManager.html">DefaultLoggersManager</a> with the <a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a> annotation.</p>
</div>
</div>
</div>

<h2 id="cachesEndpoint"><a class="anchor" href="#cachesEndpoint"></a>15.2.8 The Caches Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/cachesEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The caches endpoint documentation is available at the <a href="https://micronaut-projects.github.io/micronaut-cache/latest/guide/index.html#endpoint">micronaut-cache project</a>.</p>
</div>

<h2 id="stopEndpoint"><a class="anchor" href="#stopEndpoint"></a>15.2.9 The Server Stop Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/stopEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The stop endpoint shuts down the application server.</p>
</div>
<div class="paragraph">
<p>To execute the stop endpoint, send a POST request to /stop.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the stop endpoint, supply configuration through <code>endpoints.stop</code>.</p>
</div>
<div class="openblock">
<div class="title">Stop Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.stop.enabled=Boolean
endpoints.stop.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  stop:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.stop]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  stop {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    stop {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "stop": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, the stop endpoint is disabled and must be explicitly enabled to be used.
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="environmentEndpoint"><a class="anchor" href="#environmentEndpoint"></a>15.2.10 The Environment Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/environmentEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The environment endpoint returns information about the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> and its <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a>s.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable and configure the environment endpoint, supply configuration through <code>endpoints.env</code>.</p>
</div>
<div class="openblock">
<div class="title">Environment Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.env.enabled=Boolean
endpoints.env.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  env:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.env]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  env {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    env {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "env": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>defaults are false for <code>enabled</code> and true for <code>sensitive</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default the endpoint will mask all values.
To customize this masking you need to supply a Bean that implements <a href="../api/io/micronaut/management/endpoint/env/EnvironmentEndpointFilter.html">EnvironmentEndpointFilter</a>.</p>
</div>
<div class="paragraph">
<p>This first example will mask all values except for those that are prefixed by <code>safe</code></p>
</div>
<div class="listingblock">
<div class="title">First example of environment masking</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class OnlySafePrefixedEnvFilter implements EnvironmentEndpointFilter {
    private static final Pattern SAFE_PREFIX_PATTERN = Pattern.compile("safe.*", Pattern.CASE_INSENSITIVE);

    @Override
    public void specifyFiltering(@NotNull EnvironmentFilterSpecification specification) {
        specification
                .maskAll() // All values will be masked apart from the supplied patterns
                .exclude(SAFE_PREFIX_PATTERN);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to allow all values in plain text using <a href="../api/io/micronaut/management/endpoint/env/EnvironmentFilterSpecification.html#maskNone--">maskNone--</a>, and then specify name patterns that will be masked, ie:</p>
</div>
<div class="listingblock">
<div class="title">Deny instead of allow</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class AllPlainExceptSecretOrMatchEnvFilter implements EnvironmentEndpointFilter {
    // Mask anything starting with `sekrt`
    private static final Pattern SECRET_PREFIX_PATTERN = Pattern.compile("sekrt.*", Pattern.CASE_INSENSITIVE);

    // Mask anything exactly matching `exact-match`
    private static final String EXACT_MATCH = "exact-match";

    // Mask anything that starts with `private.`
    private static final Predicate&lt;String&gt; PREDICATE_MATCH = name -&gt; name.startsWith("private.");

    @Override
    public void specifyFiltering(@NotNull EnvironmentFilterSpecification specification) {
        specification
                .maskNone() // All values will be in plain-text apart from the supplied patterns
                .exclude(SECRET_PREFIX_PATTERN)
                .exclude(EXACT_MATCH)
                .exclude(PREDICATE_MATCH);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sensible defaults can be applied by calling the <a href="../api/io/micronaut/management/endpoint/env/EnvironmentFilterSpecification.html#legacyMasking--">legacyMasking--</a> method.
This will show all values apart from those that contain the words <code>password</code>, <code>credential</code>, <code>certificate</code>, <code>key</code>, <code>secret</code> or <code>token</code> anywhere in their name.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_information_about_the_environment">Getting information about the environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To execute the endpoint, send a <code>GET</code> request to <code>/env</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_information_about_a_particular_propertysource">Getting information about a particular <code>PropertySource</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To execute the endpoint, send a <code>GET</code> request to <code>/env/{propertySourceName}</code>.</p>
</div>
</div>
</div>

<h2 id="threadDumpEndpoint"><a class="anchor" href="#threadDumpEndpoint"></a>15.2.11 The ThreadDump Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/management/providedEndpoints/threadDumpEndpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The threaddump endpoint returns information about the threads running in your application.</p>
</div>
<div class="paragraph">
<p>To execute the threaddump endpoint, send a GET request to /threaddump.</p>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure the threaddump endpoint, supply configuration through <code>endpoints.threaddump</code>.</p>
</div>
<div class="openblock">
<div class="title">Threaddump Endpoint Configuration Example</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.threaddump.enabled=Boolean
endpoints.threaddump.sensitive=Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  threaddump:
    enabled: Boolean
    sensitive: Boolean</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.threaddump]
    enabled="Boolean"
    sensitive="Boolean"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  threaddump {
    enabled = "Boolean"
    sensitive = "Boolean"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    threaddump {
      enabled = "Boolean"
      sensitive = "Boolean"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "threaddump": {
      "enabled": "Boolean",
      "sensitive": "Boolean"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customization">Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The thread dump endpoint delegates to a <a href="../api/io/micronaut/management/endpoint/threads/ThreadInfoMapper.html">ThreadInfoMapper</a>) that is responsible for transforming the <code>java.lang.management.ThreadInfo</code> objects into any other to be sent for serialization.</p>
</div>
</div>
</div>

<h1 id="security"><a class="anchor" href="#security"></a>16 Security</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/security.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut has a full-featured security solution for all of the common security patterns.</p>
</div>
<div class="paragraph">
<p>See the documentation for <a href="https://micronaut-projects.github.io/micronaut-security/latest/guide/">Micronaut Security</a> for more information on how to secure your applications.</p>
</div>

<h1 id="multitenancy"><a class="anchor" href="#multitenancy"></a>17 Multi-Tenancy</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/multitenancy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>See the <a href="https://micronaut-projects.github.io/micronaut-multitenancy/latest/guide">Micronaut Multitenancy documentation</a> to learn about Micronaut&#8217;s support for common tasks such as tenant resolution for multi-tenancy-aware Micronaut applications.</p>
</div>

<h1 id="cli"><a class="anchor" href="#cli"></a>18 Micronaut CLI</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut CLI is the recommended way to create new Micronaut projects. The CLI includes commands for generating specific categories of projects, allowing you to choose between build tools, test frameworks, and even pick the language to use in your application. The CLI also provides commands for generating artifacts such as controllers, client interfaces, and serverless functions.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We have a website that can be used to generate projects instead of the CLI. Check out <a href="https://micronaut.io/launch/">Micronaut Launch</a> to get started!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <a href="#buildCLI">Micronaut is installed on your computer</a>, you can call the CLI with the <code>mn</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Micronaut CLI project can be identified by the <code>micronaut-cli.yml</code> file, which is included at the project root if it was generated via the CLI. This file will include the project&#8217;s profile, default package, and other variables. The project&#8217;s default package is evaluated based on the project name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the default package being <code>my.demo.app</code>.</p>
</div>
<div class="paragraph">
<p>You can supply your own default package when creating the application by prefixing the application name with the package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app example.my-demo-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the default package being <code>example</code>.</p>
</div>
<div class="sect1">
<h2 id="_interactive_mode">Interactive Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you run <code>mn</code> without any arguments, the Micronaut CLI launches in interactive mode. This is a shell-like mode which lets you run multiple CLI commands without re-initializing the CLI runtime, and is especially suitable when you use code-generation commands (such as <code>create-controller</code>), create multiple projects, or are just exploring CLI features. Tab-completion is enabled, enabling you to hit the <code>TAB</code> key to see possible options for a given command or flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn
| Starting interactive mode...
| Enter a command name to run. Use TAB for completion:
mn&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_help_and_info">Help and Info</h2>
<div class="sectionbody">
<div class="paragraph">
<p>General usage information can be viewed using the <code>help</code> flag on a command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-app -h
Usage: mn create-app [-hivVx] [--list-features] [-b=BUILD-TOOL] [--jdk=&lt;javaVersion&gt;] [-l=LANG]
                     [-t=TEST] [-f=FEATURE[,FEATURE...]]... [NAME]
Creates an application
      [NAME]               The name of the application to create.
  -b, --build=BUILD-TOOL   Which build tool to configure. Possible values: gradle, gradle_kotlin,
                             maven.
  -f, --features=FEATURE[,FEATURE...]
  -h, --help               Show this help message and exit.
  -i, --inplace            Create a service using the current directory
      --jdk, --java-version=&lt;javaVersion&gt;
                           The JDK version the project should target
  -l, --lang=LANG          Which language to use. Possible values: java, groovy, kotlin.
      --list-features      Output the available features and their descriptions
  -t, --test=TEST          Which test framework to use. Possible values: junit, spock, kotest.</code></pre>
</div>
</div>
<div class="paragraph">
<p>A list of available features can be viewed using the <code>--list-features</code> flag on any of the create commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn&gt; create-app --list-features
Available Features
(+) denotes the feature is included by default
  Name                             Description
  -------------------------------  ---------------
  Cache
  cache-caffeine                   Adds support for cache using Caffeine (https://github.com/ben-manes/caffeine)
  cache-ehcache                    Adds support for cache using EHCache (https://www.ehcache.org/)
  cache-hazelcast                  Adds support for cache using Hazelcast (https://hazelcast.org/)
  cache-infinispan                 Adds support for cache using Infinispan (https://infinispan.org/)</code></pre>
</div>
</div>
</div>
</div>

<h2 id="createProject"><a class="anchor" href="#createProject"></a>18.1 Creating a Project</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/createProject.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Creating a project is the primary usage of the CLI. The primary command for creating a new project is <code>create-app</code>, which creates a standard server application that communicates over HTTP. For other types of application, see the documentation below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Micronaut CLI Project Creation Commands</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a basic Micronaut application.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-app my-project --features
 mongo-reactive,security-jwt --build maven</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-cli-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a command-line Micronaut application.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-cli-app my-project --features
 http-client,jdbc-hikari --build maven
 --lang kotlin --test kotest</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-function-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut serverless function, using AWS by default.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-function-app my-lambda-function
 --lang groovy --test spock</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-messaging-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut application that only communicates via a messaging protocol. Uses Kafka by default but can be switched to RabbitMQ with <code>--features rabbitmq</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-messaging-app my-broker
 --lang groovy --test spock</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create-grpc-app</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a Micronaut application that uses gRPC.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>-l</code>, <code>--lang</code></p>
</li>
<li>
<p><code>-t</code>, <code>--test</code></p>
</li>
<li>
<p><code>-b</code>, <code>--build</code></p>
</li>
<li>
<p><code>-f</code>, <code>--features</code></p>
</li>
<li>
<p><code>-i</code>, <code>--inplace</code></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mn create-grpc-app my-grpc-app
 --lang groovy --test spock</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_create_command_flags">Create Command Flags</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The create-* commands generate a basic Micronaut project, with optional flags to specify features, language, test framework, and build tool. All projects except functions include a default <code>Application</code> class for starting the application.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Flags</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 37.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language to use for the project (one of <code>java</code>, <code>groovy</code>, <code>kotlin</code> - default is <code>java</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code>, <code>--test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test framework to use for the project (one of <code>junit</code>, <code>spock</code> - default is <code>junit</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--test spock</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-b</code>, <code>--build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build tool (one of <code>gradle</code>, <code>gradle_kotlin</code>, <code>maven</code> - default is <code>gradle</code> for the languages <code>java</code> and <code>groovy</code>; default is <code>gradle_kotlin</code> for language <code>kotlin</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--build maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--features</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features to use for the project, comma-separated</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--features security-jwt,mongo-gorm</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-f security-jwt -f mongo-gorm</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code>, <code>--inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, generates the project in the current directory (project name is optional if this flag is set)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--inplace</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once created, the application can be started using the <code>Application</code> class, or the appropriate build tool task.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Gradle project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Starting a Maven project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_languagetest_features">Language/Test Features</h3>
<div class="paragraph">
<p>By default, the create commands generate a Java application, with JUnit configured as the test framework. All the options chosen and features applied are stored as properties in the <code>micronaut-cli.yml</code> file, as shown below:</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">applicationType: default
defaultPackage: com.example
testFramework: junit
sourceLanguage: java
buildTool: gradle
features: [annotation-api, app-name, application, gradle, http-client, java, junit, logback, netty-server, shade, yaml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some commands rely on the data in this file to determine if they should be executable. For example, the <code>create-kafka-listener</code> command requires <code>kafka</code> to be one of the features in the list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The values in <code>micronaut-cli.yml</code> are used by the CLI for code generation. After a project is generated, you can edit these values to change the project defaults, however you must supply the required dependencies and/or configuration to use your chosen language/framework. For example, you could change the <code>testFramework</code> property to <code>spock</code> to cause the CLI to generate Spock tests when running commands (such as <code>create-controller</code>), but you need to add the Spock dependency to your build.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_groovy">Groovy</h4>
<div class="paragraph">
<p>To create an app with Groovy support (which uses Spock by default), supply the appropriate language via the <code>lang</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-groovy-app --lang groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>This includes the Groovy and Spock dependencies in your project, and writes the appropriates values in <code>micronaut-cli.yml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kotlin">Kotlin</h4>
<div class="paragraph">
<p>To create an app with Kotlin support (which uses Kotest by default), supply the appropriate language via the <code>lang</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-kotlin-app --lang kotlin</code></pre>
</div>
</div>
<div class="paragraph">
<p>This includes the Kotlin and Kotest dependencies in your project, and writes the appropriates values in <code>micronaut-cli.yml</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_tool">Build Tool</h3>
<div class="paragraph">
<p>By default, <code>create-app</code> creates a Gradle project, with a <code>build.gradle</code> file in the project root directory. To create an app using the Maven build tool, supply the appropriate option via the <code>build</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-maven-app --build maven</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_cli_app">Create-Cli-App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-cli-app</code> command generates a <a href="#commandLineApps">Micronaut command line application</a> project, with optional flags to specify language, test framework, features, profile, and build tool. By default, the project includes the <code>picocli</code> feature to support command line option parsing. The project will include a <code>*Command</code> class (based on the project name, e.g. <code>hello-world</code> generates <code>HelloWorldCommand</code>), and an associated test which instantiates the command and verifies that it can parse command line options.</p>
</div>
<div class="paragraph">
<p>Once created, the application can be started using the <code>*Command</code> class, or the appropriate build tool task.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Gradle project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Starting a Maven project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_function_app">Create Function App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>create-function-app</code> command generates a <a href="#serverlessFunctions">Micronaut function</a> project, optimized for serverless environments, with optional flags to specify language, test framework, features, and build tool. The project will include a <code>*Function</code> class (based on the project name, e.g. <code>hello-world</code> generates <code>HelloWorldFunction</code>), and an associated test which instantiates the function and verifies that it can receive requests.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Currently, AWS Lambda, Micronaut Azure, and Google Cloud are the supported cloud providers for Micronaut functions. To use other providers, add one in the features: <code>--features azure-function</code> or <code>--features google-cloud-function</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contribute">Contribute</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CLI source code is at <a href="https://github.com/micronaut-projects/micronaut-starter" class="bare">https://github.com/micronaut-projects/micronaut-starter</a>. Information about how to contribute and other resources are there.</p>
</div>
</div>
</div>

<h2 id="comparingVersions"><a class="anchor" href="#comparingVersions"></a>18.1.1 Comparing Versions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/createProject/comparingVersions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The easiest way to see version dependency updates and other changes for a new version of Micronaut is to produce one clean application using the older version and another using the newer version of the <code>mn</code> CLI, and then comparing those directories.</p>
</div>

<h2 id="features"><a class="anchor" href="#features"></a>18.2 Features</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/features.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Features consist of additional dependencies and configuration to enable specific functionality in your application. Micronaut profiles define a large number of features, including features for many of the configurations provided by Micronaut, such as the <a href="#dataAccess">Data Access Configurations</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app my-demo-app --features mongo-reactive</code></pre>
</div>
</div>
<div class="paragraph">
<p>This adds the necessary dependencies and configuration for the <a href="https://mongodb.github.io/mongo-java-driver-reactivestreams">MongoDB Reactive Driver</a> in your application. You can view the available features using the <code>--list-features</code> flag for whichever create command you use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app --list-features # Output will be supported features for the create-app command
$ mn create-function-app --list-features # Output will be supported features for the create-function-app command, different from above.</code></pre>
</div>
</div>

<h2 id="commands"><a class="anchor" href="#commands"></a>18.3 Commands</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/commands.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can view a full list of available commands using the help flag, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn -h
Usage: mn [-hvVx] [COMMAND]
Micronaut CLI command line interface for generating projects and services.
Application generation commands are: <i class="conum" data-value="1"></i><b>(1)</b>

*  create-app NAME
*  create-cli-app NAME
*  create-function-app NAME
*  create-grpc-app NAME
*  create-messaging-app NAME

Options:
  -h, --help         Show this help message and exit.
  -v, --verbose      Create verbose output.
  -V, --version      Print version information and exit.
  -x, --stacktrace   Show full stack trace when exceptions occur.

Commands: <i class="conum" data-value="2"></i><b>(2)</b>
  create-app               Creates an application
  create-cli-app           Creates a CLI application
  create-function-app      Creates a Cloud Function
  create-grpc-app          Creates a gRPC application
  create-messaging-app     Creates a messaging application
  create-job               Creates a job with scheduled method
  create-bean              Creates a singleton bean
  create-websocket-client  Creates a Websocket client
  create-client            Creates a client interface
  create-controller        Creates a controller and associated test
  feature-diff             Produces the diff of an original project with an original project with
                             additional features.
  create-websocket-server  Creates a Websocket server
  create-test              Creates a simple test for the project's testing framework</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here you can see the project generation commands lists</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>All commands available in the current directory are listed here</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><strong>Note:</strong> the things listed after the project creation commands (always available) depend on the current directory context</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All the code-generation commands honor the values written in <code>micronaut-cli.yml</code>. For example, assume the following <code>micronaut-cli.yml</code> file.</p>
</div>
<div class="listingblock">
<div class="title">micronaut-cli.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">defaultPackage: example
---
testFramework: spock
sourceLanguage: java</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above settings, the <code>create-bean</code> command (by default) generates a Java class with an associated Spock test, in the <code>example</code> package. Commands accept arguments and these defaults can be overridden on a per-command basis.</p>
</div>
<div class="sect1">
<h2 id="_base_commands">Base Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These commands are always available within the context of a micronaut project.</p>
</div>
<div class="sect2">
<h3 id="_create_bean">Create-Bean</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Create-Bean Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the bean class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-bean</code> command generates a simple <a href="https://docs.oracle.com/javaee/6/api/javax/inject/Singleton.html">Singleton</a> class. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-bean EmailService
| Rendered template Bean.java to destination src/main/java/example/EmailService.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_job">Create-Job</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Create-Job Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the job class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-job</code> command generates a simple <a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">Scheduled</a> class. It follows a <code>*Job</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-job UpdateFeeds --lang groovy
| Rendered template Job.groovy to destination src/main/groovy/example/UpdateFeedsJob.groovy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_related_commands">HTTP-Related Commands</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_controller">Create-Controller</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Create-Controller Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-controller</code> command generates a <a href="../api/io/micronaut/http/annotation/Controller.html">Controller</a> class. It follows a <code>*Controller</code> convention for generating the class name. It creates an associated test that runs the application and instantiates an HTTP client, which can make requests against the controller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-controller Book
| Rendered template Controller.java to destination src/main/java/example/BookController.java
| Rendered template ControllerTest.java to destination src/test/java/example/BookControllerTest.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_client">Create-Client</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Create-Client Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-client</code> command generates a simple <a href="../api/io/micronaut/http/client/annotation/Client.html">Client</a> interface. It follows a <code>*Client</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-client Book
| Rendered template Client.java to destination src/main/java/example/BookClient.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_websocket_server">Create-Websocket-Server</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Create-Websocket-Server Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-websocket-server</code> command generates a simple <a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">ServerWebSocket</a> class. It follows a <code>*Server</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-websocket-server MyChat
| Rendered template WebsocketServer.java to destination src/main/java/example/MyChatServer.java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_websocket_client">Create-Websocket-Client</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Create-Websocket-Client Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-websocket-client</code> command generates a simple <a href="../api/io/micronaut/websocket/WebSocketClient.html">WebSocketClient</a> abstract class. It follows a <code>*Client</code> convention for generating the class name. It does not create an associated test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-websocket-client MyChat
| Rendered template WebsocketClient.java to destination src/main/java/example/MyChatClient.java</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cli_project_commands">CLI Project Commands</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_command">Create-Command</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Create-Command Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code>, <code>--lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language used for the command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--lang groovy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code>, <code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite existing files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>create-command</code> command generates a standalone application that can be executed as a
<a href="https://picocli.info">picocli</a> <a href="https://picocli.info/apidocs/picocli/CommandLine.Command.html">Command</a>. It follows a <code>*Command</code> convention for generating the class name. It creates an associated test that runs the application and verifies that a command line option was set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-command print
| Rendered template Command.java to destination src/main/java/example/PrintCommand.java
| Rendered template CommandTest.java to destination src/test/java/example/PrintCommandTest.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>This list is just a small subset of the code generation commands in the Micronaut CLI. To see all context-sensitive commands the CLI has available (and under what circumstances they apply), check out the <a href="https://github.com/micronaut-projects/micronaut-starter">micronaut-starter</a> project and find the classes that extend <code>CodeGenCommand</code>. The <code>applies</code> method dictates whether a command is available or not.</p>
</div>
</div>
</div>
</div>

<h2 id="reloading"><a class="anchor" href="#reloading"></a>18.4 Reloading</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/reloading.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Reloading (or "hot-loading") refers to the framework reinitializing classes (and parts of the application) when changes to the source files are detected.</p>
</div>
<div class="paragraph">
<p>Since Micronaut prioritizes startup time and most Micronaut apps can start up within seconds, a productive workflow can often be had by restarting the application as changes are made; for example, by running a test class within an IDE.</p>
</div>
<div class="paragraph">
<p>However, to have your changes automatically reloaded, Micronaut supports automatic restart and the use of third-party reloading agents.</p>
</div>

<h2 id="automaticRestart"><a class="anchor" href="#automaticRestart"></a>18.4.1 Automatic Restart</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/reloading/automaticRestart.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are various ways to achieve reloading of classes on the JVM, and all have their advantages and disadvantages. The following are possible ways to achieve reloading without restarting the JVM:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>JVM Agents</strong> - A JVM agent like JRebel can be used, however these can produce unusual errors, may not support all JDK versions, and can result in cached or stale classes.</p>
</li>
<li>
<p><strong>ClassLoader Reloading</strong> - ClassLoader-based reloading is a popular solution used by most JVM frameworks; however it once again can lead to cached or stale classes, memory leaks, and weird errors if the incorrect classloader is used.</p>
</li>
<li>
<p><strong>Debugger HotSwap</strong> - The Java debugger supports hotswapping of changes at runtime, but only supports a few use cases.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given the problems with existing solutions and a lack of a way built into the JVM to reload changes, the safest and best solution to reloading, and the one recommended by the Micronaut team, is to use automatic application restart via a third-party tool.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s startup time is fast and automatic restart leads to a clean slate without potential hard to debug problems or memory leaks  cropping up.</p>
</div>
<div class="sect2">
<h3 id="_maven_restart">Maven Restart</h3>
<div class="paragraph">
<p>To have automatic application restarts with Maven, use the Micronaut Maven plugin (included by default when creating new Maven projects) and run the following command:</p>
</div>
<div class="listingblock">
<div class="title">Using the Micronaut Maven Plugin</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw mn:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every time you change a class, the plugin automatically restarts the server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gradle_restart">Gradle Restart</h3>
<div class="paragraph">
<p>Gradle automatic restart can be activated when using the Micronaut Gradle plugin by activating Gradle&#8217;s support for continuous builds via the <code>-t</code> flag:</p>
</div>
<div class="listingblock">
<div class="title">Using Gradle for Automatic Restart</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew run -t</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every time you make a change to class or resources, Gradle recompiles and restarts the application.</p>
</div>
</div>

<h2 id="jrebel"><a class="anchor" href="#jrebel"></a>18.4.2 JRebel</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/reloading/jrebel.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.jrebel.com/products/jrebel">JRebel</a> is a proprietary reloading solution that involves an agent library, as well as sophisticated IDE support. The JRebel documentation includes detailed steps for IDE integration and usage. In this section, we show how to install and configure the agent for Maven and Gradle projects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you create your project using the Micronaut CLI, supply the <code>jrebel</code> feature to preconfigure JRebel reloading in your project. Note that you need to install JRebel and supply the correct path to the agent in the <code>gradle.properties</code> file (for Gradle) or <code>pom.xml</code> (for Maven). The necessary steps are described below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jrebel</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_installconfigure_jrebel_agent">Install/configure JRebel Agent</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The simplest way to install JRebel is to download the "standalone" installation package from the <a href="https://www.jrebel.com/products/jrebel/download">JRebel download page</a>. Unzip the downloaded file to a convenient location, for example <code>~/bin/jrebel</code></p>
</div>
<div class="paragraph">
<p>The installation directory contains a <code>lib</code> directory with the agent files. For the appropriate agent based on your operating system, see the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. JRebel Agent</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">Agent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows 64-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]\lib\jrebel64.dll</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows 32-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]\lib\jrebel32.dll</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mac OS X 64-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel64.dylib</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mac OS X 32-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel32.dylib</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux 64-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel64.so</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux 32-bit JDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[jrebel directory]/lib/libjrebel32.so</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note the path to the appropriate agent, and add the value to your project build.</p>
</div>
<div class="sect2">
<h3 id="_gradle">Gradle</h3>
<div class="paragraph">
<p>Add the path to <code>gradle.properties</code> (create the file if necessary), as the <code>rebelAgent</code> property.</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">#Assuming installation path of ~/bin/jrebel/
rebelAgent= -agentpath:~/bin/jrebel/lib/libjrebel64.dylib</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the appropriate JVM arg to <code>build.gradle</code> (not necessary if using the CLI feature)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">run.dependsOn(generateRebel)
if (project.hasProperty('rebelAgent')) {
    run.jvmArgs += rebelAgent
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can start the application with <code>./gradlew run</code>, and it will include the agent. See the section on <a href="#gradleReload">Gradle Reloading</a> or <a href="#ideReload">IDE Reloading</a> to set up the recompilation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maven">Maven</h3>
<div class="paragraph">
<p>Configure the Micronaut Maven Plugin accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;!-- ... --&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;!-- ... --&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;io.micronaut.build&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-maven-plugin&lt;/artifactId&gt;
          &lt;configuration&gt;
            &lt;jvmArguments&gt;
              &lt;jvmArgument&gt;-agentpath:~/bin/jrebel/lib/jrebel6/lib/libjrebel64.dylib&lt;/jvmArgument&gt;
            &lt;/jvmArguments&gt;
          &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.zeroturnaround&lt;/groupId&gt;
        &lt;artifactId&gt;jrebel-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.1.10&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;generate-rebel-xml&lt;/id&gt;
            &lt;phase&gt;process-resources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;generate&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      &lt;!-- ... --&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>

<h2 id="gradleReload"><a class="anchor" href="#gradleReload"></a>18.4.3 Recompiling with Gradle</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/reloading/gradleReload.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Gradle supports <a href="https://docs.gradle.org/current/userguide/command_line_interface.html#sec:continuous_build">continuous builds</a>, letting you run a task that will be rerun whenever source files change. To use this with a reloading agent (configured as described above), run the application normally (with the agent), and then run a recompilation task in a separate terminal with continuous mode enabled.</p>
</div>
<div class="listingblock">
<div class="title">Run the app</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run the recompilation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew -t classes</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>classes</code> task will be rerun every time a source file is modified, allowing the reloading agent to pick up the change.</p>
</div>

<h2 id="ideReload"><a class="anchor" href="#ideReload"></a>18.4.4 Recompiling with an IDE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/reloading/ideReload.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you use a build tool such as Maven which does not support automatic recompilation on file changes, you may use your IDE to recompile classes in combination with a reloading agent (as configured in the above sections).</p>
</div>
<div class="sect2">
<h3 id="_intellij">IntelliJ</h3>
<div class="paragraph">
<p>IntelliJ unfortunately does not have an automatic rebuild option that works for a running application. However, you can trigger a "rebuild" of the project with <code>CMD-F9</code> (Mac) or <code>CTRL-F9</code> (Windows/Linux).</p>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse">Eclipse</h3>
<div class="paragraph">
<p>Under the <code>Project</code> menu, check the <code>Build Automatically</code> option. This will trigger a recompilation of the project whenever file changes are saved to disk.</p>
</div>
</div>

<h2 id="proxy"><a class="anchor" href="#proxy"></a>18.5 Proxy Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/cli/proxy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To configure the CLI to use an HTTP proxy there are two steps. Configuration options can be passed to the cli through the <code>MN_OPTS</code> environment variable.</p>
</div>
<div class="paragraph">
<p>For example on *nix systems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export MN_OPTS="-Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=3128 -Dhttp.proxyUser=test -Dhttp.proxyPassword=test"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The profile dependencies are resolved over HTTPS so the proxy port and host are configured with <code>https.</code>, however the user and password are specified with <code>http.</code>.</p>
</div>
<div class="paragraph">
<p>For Windows systems the environment variable can be configured under <code>My Computer/Advanced/Environment Variables</code>.</p>
</div>

<h1 id="i18n"><a class="anchor" href="#i18n"></a>19 Internationalization</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/i18n.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="bundle"><a class="anchor" href="#bundle"></a>19.1 Resource Bundles</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/i18n/bundle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A resource bundle is a Java .properties file that contains locale-specific data.</p>
</div>
<div class="paragraph">
<p>Given this Resource Bundle:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/io/micronaut/docs/i18n/messages_en.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">hello=Hello
hello.name=Hello {0}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/resources/io/micronaut/docs/i18n/messages_es.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">hello=Hola
hello.name=Hola {0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <a href="../api/io/micronaut/context/i18n/ResourceBundleMessageSource.html">ResourceBundleMessageSource</a>, an implementation of <a href="../api/io/micronaut/context/MessageSource.html">MessageSource</a> which eases accessing <a href="https://docs.oracle.com/javase/8/docs/api//java/util/ResourceBundle.html">Resource Bundles</a> and provides cache functionality, to access the previous messages.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not instantiate a new <code>ResourceBundleMessageSource</code> each time you retrieve a message. Instantiate it once, for example in a factory.
</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageSource Factory Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.MessageSource;
import io.micronaut.context.annotation.Factory;
import io.micronaut.context.i18n.ResourceBundleMessageSource;
import jakarta.inject.Singleton;

@Factory
class MessageSourceFactory {
    @Singleton
    MessageSource createMessageSource() {
        return new ResourceBundleMessageSource("io.micronaut.docs.i18n.messages");
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageSource Factory Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.MessageSource
import io.micronaut.context.annotation.Factory
import io.micronaut.context.i18n.ResourceBundleMessageSource
import jakarta.inject.Singleton

@Factory
class MessageSourceFactory {
    @Singleton
    MessageSource createMessageSource() {
        new ResourceBundleMessageSource("io.micronaut.docs.i18n.messages")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">MessageSource Factory Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.MessageSource
import io.micronaut.context.annotation.Factory
import io.micronaut.context.i18n.ResourceBundleMessageSource
import jakarta.inject.Singleton

@Factory
internal class MessageSourceFactory {
    @Singleton
    fun createMessageSource(): MessageSource = ResourceBundleMessageSource("io.micronaut.docs.i18n.messages")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can retrieve the messages supplying the locale:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ResourceBundleMessageSource Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">assertEquals("Hola", messageSource.getMessage("hello", MessageContext.of(new Locale("es"))).get());
assertEquals("Hello", messageSource.getMessage("hello", MessageContext.of(Locale.ENGLISH)).get());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ResourceBundleMessageSource Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">expect:
messageSource.getMessage("hello", MessageContext.of(new Locale("es"))).get() == 'Hola'

and:
messageSource.getMessage("hello", MessageContext.of(Locale.ENGLISH)).get() == 'Hello'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">ResourceBundleMessageSource Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">Assertions.assertEquals("Hola", messageSource.getMessage("hello", MessageSource.MessageContext.of(Locale("es"))).get())
Assertions.assertEquals("Hello", messageSource.getMessage("hello", MessageSource.MessageContext.of(Locale.ENGLISH)).get())</code></pre>
</div>
</div>

<h2 id="localizedMessageSource"><a class="anchor" href="#localizedMessageSource"></a>19.2 Localized Message Source</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/i18n/localizedMessageSource.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="../api/io/micronaut/context/LocalizedMessageSource.html">LocalizedMessageSource</a> is a <code>@RequestScope</code> bean which you can inject in your Controllers and which uses <a href="#localeResolution">Micronaut Locale Resolution</a> to resolve the localized message for the current HTTP request.</p>
</div>

<h1 id="appendix"><a class="anchor" href="#appendix"></a>20 Appendices</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="architecture"><a class="anchor" href="#architecture"></a>20.1 Micronaut Architecture</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following documentation describes Micronaut&#8217;s architecture and is designed for those who are looking for information on the internal workings of Micronaut and how it is architected. This is not intended as end-user developer documentation, but for those interested in the inner workings of Micronaut.</p>
</div>
<div class="paragraph">
<p>This documentation is divided into sections that describe the compiler, introspections, application container, dependency injection and so on.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Since this documentation covers the internal workings of Micronaut, many APIs referenced and described are regarded as internal, non-public API and are annotated as such with the <a href="../api/io/micronaut/core/annotation/Internal.html">@Internal</a>. Internal APIs can change between patch releases of Micronaut and are not covered by Micronaut&#8217;s semantic versioning release policy.
</td>
</tr>
</table>
</div>

<h2 id="compilerArch"><a class="anchor" href="#compilerArch"></a>20.1.1 Compiler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture/compilerArch.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut Compiler is a set of extensions to existing language compilers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java - the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.compiler/javax/annotation/processing/package-summary.html">Java Annotation Processing (APT) API</a> is used for Java &amp; Kotlin code (a future version of Micronaut will support KSP for Kotlin)</p>
</li>
<li>
<p>Groovy - Groovy <a href="https://docs.groovy-lang.org/latest/html/api/org/codehaus/groovy/transform/ASTTransformation.html">AST Transformations</a> are used participate in the compilation of Groovy code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To keep this documentation simple, the remaining sections will describe the interaction with the Java compiler.</p>
</div>
<div class="paragraph">
<p>The Micronaut Compiler visits end user code and generates additional bytecode that sits alongside the user code in the same package structure.</p>
</div>
<div class="paragraph">
<p>The AST of user source is visited using implementations of <a href="../api/io/micronaut/inject/visitor/TypeElementVisitor.html">TypeElementVisitor</a> which are loaded via the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/ServiceLoader.html">standard Java service loader mechanism</a>.</p>
</div>
<div class="paragraph">
<p>Each <a href="../api/io/micronaut/inject/visitor/TypeElementVisitor.html">TypeElementVisitor</a> implementation can override one or more of the <code>visit*</code> methods which receive an instance of <a href="../api/io/micronaut/inject/ast/Element.html">Element</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/inject/ast/package-summary.html">Element API</a> provides a language-neutral abstraction over the AST and computation of the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> for a given element (class, method, field etc.).</p>
</div>

<h2 id="annotationArch"><a class="anchor" href="#annotationArch"></a>20.1.2 Annotation Metadata</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture/annotationArch.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is an implementation of an annotation-based programming model. That is to say annotations form a fundamental part of the API design of the framework.</p>
</div>
<div class="paragraph">
<p>Given this design decision, a compilation-time model was formulated to address the challenges of evaluating annotations at runtime.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> API is a construct that is used both a compilation time and at runtime by framework components. <code>AnnotationMetadata</code> represents the computed fusion of annotation information for a particular type, field, constructor, method or bean property and may include both annotations declared in the source code, but also synthetic meta-annotations that can be used at runtime to implement framework logic.</p>
</div>
<div class="paragraph">
<p>When visiting source code within the <a href="#compilerArch">Micronaut Compiler</a> using the <a href="https://docs.micronaut.io/latest/api/io/micronaut/inject/ast/package-summary.html">Element API</a> for each <a href="../api/io/micronaut/inject/ast/ClassElement.html">ClassElement</a>, <a href="../api/io/micronaut/inject/ast/FieldElement.html">FieldElement</a>, <a href="../api/io/micronaut/inject/ast/MethodElement.html">MethodElement</a>, <a href="../api/io/micronaut/inject/ast/ConstructorElement.html">ConstructorElement</a> and <a href="../api/io/micronaut/inject/ast/PropertyElement.html">PropertyElement</a> an instance of <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> is computed.</p>
</div>
<div class="paragraph">
<p>The <code>AnnotationMetadata</code> API tries to address the following challenges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotations can be inherited from types and interfaces into implementations. To avoid the need to traverse the class/interface hierarchy at runtime Micronaut will at build time compute inherited annotations and deal with member overriding rules</p>
</li>
<li>
<p>Annotations can be annotated with other annotations. These annotations are often referred to as meta-annotations or stereotypes. The <code>AnnotationMetadata</code> API provides methods to understand whether a particular annotation is declared as meta-annotation and to find out what annotations are meta-annotated with other annotations</p>
</li>
<li>
<p>It is often necessary to fuse annotation metadata together from different sources. For example, for JavaBean properties you want to combine the metadata from the private field, public getter and public setters into a single view otherwise you have to run logic to runtime to somehow combine this metadata from 3 distinct sources.</p>
</li>
<li>
<p>Repeatable annotations are combined and normalized. If inherited the annotations are combined from parent interfaces or classes providing a single API to evaluate repeatable annotations instead of requiring runtime logic to perform normalization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the source for a type is visited an instance of <a href="../api/io/micronaut/inject/ast/ClassElement.html">ClassElement</a> is constructed via the <a href="../api/io/micronaut/inject/ast/ElementFactory.html">ElementFactory</a> API.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/inject/ast/ElementFactory.html">ElementFactory</a> uses an instance of <a href="../api/io/micronaut/inject/annotation/AbstractAnnotationMetadataBuilder.html">AbstractAnnotationMetadataBuilder</a> which contains language specific implementations to construct <code>AnnotationMedata</code> for the underlying native type in the AST. In the case of Java this would be a <code>javax.model.element.TypeElement</code>.</p>
</div>
<div class="paragraph">
<p>The basic flow is visualized below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/annotationmetadata.png" alt="annotationmetadata">
</div>
</div>
<div class="paragraph">
<p>Additionally, the <a href="../api/io/micronaut/inject/annotation/AbstractAnnotationMetadataBuilder.html">AbstractAnnotationMetadataBuilder</a> will load via the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/ServiceLoader.html">standard Java service loader mechanism</a> one or more instances of the following types that allow manipulating how an annotation is represented in the <code>AnnotationMetadata</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/inject/annotation/AnnotationMapper.html">AnnotationMapper</a> - A type that can map the value of one annotation to another, retaining the original annotation in the <code>AnnotationMetadata</code></p>
</li>
<li>
<p><a href="../api/io/micronaut/inject/annotation/AnnotationTransformer.html">AnnotationTransformer</a> - A type that can transform the value of one annotation to another, eliminating the original annotation from the <code>AnnotationMetadata</code></p>
</li>
<li>
<p><a href="../api/io/micronaut/inject/annotation/AnnotationRemapper.html">AnnotationRemapper</a> - A type that can transform the values of all annotations in a given package, eliminating the original annotations from the <code>AnnotationMetadata</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that at compilation time the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> is mutable and can be further altered by implementations of <a href="../api/io/micronaut/inject/visitor/TypeElementVisitor.html">TypeElementVisitor</a> by invoking the <code>annotate(..)</code> method of the <a href="../api/io/micronaut/inject/ast/Element.html">Element</a> API. However, at runtime the <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> is immutable and fixed. The purpose of this design to allow the compiler to be extended and for Micronaut to be able to interpret different source-level annotation-based programming models.</p>
</div>
<div class="paragraph">
<p>In practice this effectively allows decoupling the source code level annotation model from what is used at runtime such that different annotations can be used to represent the same annotation.</p>
</div>
<div class="paragraph">
<p>For example <code>jakarata.inject.Inject</code> or Spring&#8217;s <code>@Autowired</code> are supported as synonyms for <code>javax.inject.Inject</code> by transforming the source level annotation to <code>javax.inject.Inject</code> which is the only annotation represented at runtime.</p>
</div>
<div class="paragraph">
<p>Finally, annotations in Java also allow the definition of default values. These defaults are not retained in individual instances of <code>AnnotationMetadata</code> but instead stored in a shared, static application-wide map for later retrieval for annotations known to be used by the application.</p>
</div>

<h2 id="introspectionArch"><a class="anchor" href="#introspectionArch"></a>20.1.3 Bean Introspections</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture/introspectionArch.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The goal of <a href="#introspection">Bean Introspections</a> is to provide an alternative to reflection and the JDK&#8217;s <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.desktop/java/beans/Introspector.html">Introspector API</a> that is coupled to the <code>java.desktop</code> module in recent versions of Java.</p>
</div>
<div class="paragraph">
<p>Many libraries in Java need to programmatically discover what methods represent properties of a class in some way and whilst the <a href="https://en.wikipedia.org/wiki/JavaBeans">JavaBeans specification</a> tried to establish a standard convention, the language itself has evolved to include other constructs like Records that represent properties as components.</p>
</div>
<div class="paragraph">
<p>In addition, other languages like Kotlin and Groovy have native support for class properties that need to be supported at the framework level.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/inject/beans/visitor/IntrospectedTypeElementVisitor.html">IntrospectedTypeElementVisitor</a> visits declarations of the <a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a> annotation on types and generates at compilation time implementations of <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> that are associated with each annotated type:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/introspections.png" alt="introspections">
</div>
</div>
<div class="paragraph">
<p>This generation happens via the <code>io.micronaut.inject.beans.visitor.BeanIntrospectionWriter</code>, an internal class that uses the ASM bytecode generation library to generate two additional classes.</p>
</div>
<div class="paragraph">
<p>For example, given a class called <code>example.Person</code> the classes generated are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>example.$Person$IntrospectionRef</code> - an implementation of <a href="../api/io/micronaut/core/beans/BeanIntrospectionReference.html">BeanIntrospectionReference</a> that allows the application to soft load the introspection without loading all of the metadata or the class itself (in the case where the introspected class is itself not on the classpath). Since references are loaded via <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html">ServiceLoader</a> an entry in a generated <code>META-INF/services/io.micronaut.core.beans.BeanIntrospectionReference</code> referring to this type is also generated at compilation time.</p>
</li>
<li>
<p><code>example.$Person$Introspection</code> - an implementation of <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> which contains the actual runtime introspection information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example demonstrates usage of the <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> API:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final BeanIntrospection&lt;Person&gt; introspection = BeanIntrospection.getIntrospection(Person.class); // <b class="conum">(1)</b>
Person person = introspection.instantiate("John"); // <b class="conum">(2)</b>
System.out.println("Hello " + person.getName());

final BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String.class); // <b class="conum">(3)</b>
property.set(person, "Fred"); // <b class="conum">(4)</b>
String name = property.get(person); // <b class="conum">(5)</b>
System.out.println("Hello " + person.getName());</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def introspection = BeanIntrospection.getIntrospection(Person) // <b class="conum">(1)</b>
Person person = introspection.instantiate("John") // <b class="conum">(2)</b>
println("Hello $person.name")

BeanProperty&lt;Person, String&gt; property = introspection.getRequiredProperty("name", String) // <b class="conum">(3)</b>
property.set(person, "Fred") // <b class="conum">(4)</b>
String name = property.get(person) // <b class="conum">(5)</b>
println("Hello $person.name")</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">val introspection = BeanIntrospection.getIntrospection(Person::class.java) // <b class="conum">(1)</b>
val person : Person = introspection.instantiate("John") // <b class="conum">(2)</b>
print("Hello ${person.name}")

val property : BeanProperty&lt;Person, String&gt; = introspection.getRequiredProperty("name", String::class.java) // <b class="conum">(3)</b>
property.set(person, "Fred") // <b class="conum">(4)</b>
val name = property.get(person) // <b class="conum">(5)</b>
print("Hello ${person.name}")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> is looked up by type. When this occurs the introspection will be searched for amongst the <a href="../api/io/micronaut/core/beans/BeanIntrospectionReference.html">BeanIntrospectionReference</a> instances loaded via <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html">ServiceLoader</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>instantiate</code> method allows creating instances</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Properties for bean can be loaded via one of the available methods, in this case <code>getRequiredProperty</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The referenced <a href="../api/io/micronaut/core/beans/BeanProperty.html">BeanProperty</a> can be used to write mutable properties</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>And read readable properties</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>Person</code> class is only initialized when the <code>getBeanType()</code> method is called. If the class is not present on the classpath then a <code>NoClassDefFoundError</code> will occur, to prevent this the developer can call the <code>isPresent()</code> method on the <a href="../api/io/micronaut/core/beans/BeanIntrospectionReference.html">BeanIntrospectionReference</a> prior to trying to obtain the type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An implementation of <a href="../api/io/micronaut/core/beans/BeanIntrospection.html">BeanIntrospection</a> performs two critical functions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The introspection holds Bean metadata about the properties and constructor arguments for a particular type that is abstracted away from the actual implementation (JavaBean property, Java 17+ Record, Kotlin data classes, Groovy properties etc.) and which also provide access to <a href="../api/io/micronaut/core/annotation/AnnotationMetadata.html">AnnotationMetadata</a> without needing to use reflection to load the annotations themselves.</p>
</li>
<li>
<p>The introspection enables the ability to instantiate and read/write bean properties without the use of Java reflection, based purely on the subset of build-time generated information.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Optimized reflection-free method dispatch is generated by overriding the <code>dispatchOne</code> method of <a href="../api/io/micronaut/inject/beans/AbstractInitializableBeanIntrospection.html">AbstractInitializableBeanIntrospection</a>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected final Object dispatchOne(int propertyIndex, Object bean, Object value
) {
    switch(propertyIndex) { <i class="conum" data-value="1"></i><b>(1)</b>
    case 0:
        return ((Person) bean).getName(); <i class="conum" data-value="2"></i><b>(2)</b>
    case 1:
        ((Person) bean).setName((String) value); <i class="conum" data-value="3"></i><b>(3)</b>
        return null;
    default:
        throw this.unknownDispatchAtIndexException(propertyIndex); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each read or write method is assigned an index</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The index is used in read methods to obtain the value directly without relying on reflection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The index is used for write methods to set a property without using reflection</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If no property exists at the index an exception is thrown, though this is implementation detail and the codepath should never arrive to this point.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The approach to use a dispatch method with an index was used to avoid the need to generate a class per method (which would consume more memory) or introduce the overhead of lambdas.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to enable type instantiation the <code>io.micronaut.inject.beans.visitor.BeanIntrospectionWriter</code> will also generate an implementation of the <code>instantiateInternal</code> method which contains the reflection-free code to instantiate a given type based on known valid argument types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Object instantiateInternal(Object[] args) {
    return new Person(
        (String)args[0],
        (Integer)args[1]
    );
}</code></pre>
</div>
</div>

<h2 id="iocArch"><a class="anchor" href="#iocArch"></a>20.1.4 Bean Definitions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture/iocArch.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is an implementation of the JSR-330 specification for Dependency Injection.</p>
</div>
<div class="paragraph">
<p>Dependency Injection (or Inversion of Control) is a widely adopted and common pattern in Java that allows loosely decoupling components to allow applications to be easily extended and tested.</p>
</div>
<div class="paragraph">
<p>The way in which objects are wired together is decoupled from the objects themselves in this model by a separate programming model. In the case of Micronaut this model is based on annotations defined within the JSR-330 specification plus an extended set of annotations located within the <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/package-summary.html">io.micronaut.context.annotation</a> package.</p>
</div>
<div class="paragraph">
<p>These annotations are visited by the <a href="#compilerArch">Micronaut Compiler</a> which traverses the source code language AST and builds a model used to wire objects together at runtime.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to note that the actual object wiring is deferred until runtime.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Java code <a href="../api/io/micronaut/annotation/processing/BeanDefinitionInjectProcessor.html">BeanDefinitionInjectProcessor</a> (which is a Java Annotation <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.compiler/javax/annotation/processing/Processor.html">Processor</a>) is invoked from the Java compiler for each class annotated with a bean definition annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
What constitutes a bean defining annotation is complex as it takes into account meta-annotations, but in general it is any annotation annotated with a JSR-330 bean <code>@Scope</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>BeanDefinitionInjectProcessor</code> will visit each bean in the user code source and generate additional byte code using the ASM byte code generation library that sits along side the annotated class in the same package.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For historic reasons the dependency injection processor does not use the <a href="../api/io/micronaut/inject/visitor/TypeElementVisitor.html">TypeElementVisitor</a> API but will likely do so in the future
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Byte code generation is implemented in the <a href="../api/io/micronaut/inject/writer/BeanDefinitionWriter.html">BeanDefinitionWriter</a> which contains methods to "visit" different aspects of the way is bean is defined (the <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a>).</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/beanwriter.png" alt="beanwriter">
</div>
</div>
<div class="paragraph">
<p>For example given the following type:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class Vehicle {
    private final Engine engine;

    public Vehicle(Engine engine) {// <b class="conum">(3)</b>
        this.engine = engine;
    }

    public String start() {
        return engine.start();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class Vehicle {
    final Engine engine

    Vehicle(Engine engine) { // <b class="conum">(3)</b>
        this.engine = engine
    }

    String start() {
        engine.start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class Vehicle(private val engine: Engine) { // <b class="conum">(3)</b>
    fun start(): String {
        return engine.start()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is generated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>example.$Vehicle$Definition$Reference</code> class that implements the <a href="../api/io/micronaut/inject/BeanDefinitionReference.html">BeanDefinitionReference</a> interface that allows the application to soft load the bean definition without loading all of the metadata or the class itself (in the case where the introspected class is itself not on the classpath). Since references are loaded via <a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html">ServiceLoader</a> an entry in a generated <code>META-INF/services/io.micronaut.inject.BeanDefinitionReference</code> referring to this type is also generated at compilation time.</p>
</li>
<li>
<p>A <code>example.$Vehicle$Definition</code> which contains the actual <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> is a type that holds metadata about the particular type including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Class level <a href="#annotationArch">AnnotationMetadata</a></p>
</li>
<li>
<p>The computed JSR-330 <code>@Scope</code> and <code>@Qualifier</code></p>
</li>
<li>
<p>Knowledge of the available <a href="../api/io/micronaut/inject/InjectionPoint.html">InjectionPoint</a> instances</p>
</li>
<li>
<p>References to any <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a> defined</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition the <code>BeanDefinition</code> contains logic which knows how the bean is wired together, including how the type is constructed and fields and/or methods injected.</p>
</div>
<div class="paragraph">
<p>During compilation the ASM byte code library is used to fill out the details of the <code>BeanDefinition</code>, including a <code>build</code> method that, for the previous example, looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Vehicle build(
    BeanResolutionContext resolution, <i class="conum" data-value="1"></i><b>(1)</b>
    BeanContext context,
    BeanDefinition definition) {
    Vehicle bean = new Vehicle(
        (Engine) super.getBeanForConstructorArgument( <i class="conum" data-value="2"></i><b>(2)</b>
            resolution,
            context,
            0, <i class="conum" data-value="3"></i><b>(3)</b>
            (Qualifier)null)
    );
    return bean;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>BeanResolutionContext</code> is passed around to track circular bean references and improve error reporting.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The type is instantiated and each constructor argument looked up by calling methods of <a href="../api/io/micronaut/context/AbstractInitializableBeanDefinition.html">AbstractInitializableBeanDefinition</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In this case the index of the constructor argument is tracked</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Special handling is required when a Java field or method has <code>private</code> access. In this case Micronaut has no option but to fallback to using Java reflection to perform dependency injection.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_properties_handling">Configuration Properties Handling</h3>
<div class="paragraph">
<p>The <a href="#compilerArch">Micronaut Compiler</a> handles beans declared with the meta-annotation <a href="../api/io/micronaut/context/annotation/ConfigurationReader.html">@ConfigurationReader</a> such as <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> and <a href="../api/io/micronaut/context/annotation/EachProperty.html">@EachProperty</a> distinctly to other beans.</p>
</div>
<div class="paragraph">
<p>In order to support binding <a href="#config">Application Configuration</a> to types annotated with one of the aforementioned annotations each discovered mutable bean property is dynamically annotated with the <a href="../api/io/micronaut/context/annotation/Property.html">@Property</a> annotation with the computed and normalized property name.</p>
</div>
<div class="paragraph">
<p>For example given the below type:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.ConfigurationProperties;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotBlank;
import java.util.Optional;

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
public class EngineConfig {

    public String getManufacturer() {
        return manufacturer;
    }

    public void setManufacturer(String manufacturer) {
        this.manufacturer = manufacturer;
    }

    public int getCylinders() {
        return cylinders;
    }

    public void setCylinders(int cylinders) {
        this.cylinders = cylinders;
    }

    public CrankShaft getCrankShaft() {
        return crankShaft;
    }

    public void setCrankShaft(CrankShaft crankShaft) {
        this.crankShaft = crankShaft;
    }

    @NotBlank // <b class="conum">(2)</b>
    private String manufacturer = "Ford"; // <b class="conum">(3)</b>

    @Min(1L)
    private int cylinders;

    private CrankShaft crankShaft = new CrankShaft();

    @ConfigurationProperties("crank-shaft")
    public static class CrankShaft { // <b class="conum">(4)</b>

        private Optional&lt;Double&gt; rodLength = Optional.empty(); // <b class="conum">(5)</b>

        public Optional&lt;Double&gt; getRodLength() {
            return rodLength;
        }

        public void setRodLength(Optional&lt;Double&gt; rodLength) {
            this.rodLength = rodLength;
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.ConfigurationProperties

import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties('my.engine') // <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank // <b class="conum">(2)</b>
    String manufacturer = "Ford" // <b class="conum">(3)</b>

    @Min(1L)
    int cylinders

    CrankShaft crankShaft = new CrankShaft()

    @ConfigurationProperties('crank-shaft')
    static class CrankShaft { // <b class="conum">(4)</b>
        Optional&lt;Double&gt; rodLength = Optional.empty() // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">@ConfigurationProperties Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.ConfigurationProperties
import java.util.Optional
import javax.validation.constraints.Min
import javax.validation.constraints.NotBlank

@ConfigurationProperties("my.engine") // <b class="conum">(1)</b>
class EngineConfig {

    @NotBlank // <b class="conum">(2)</b>
    var manufacturer = "Ford" // <b class="conum">(3)</b>

    @Min(1L)
    var cylinders: Int = 0

    var crankShaft = CrankShaft()

    @ConfigurationProperties("crank-shaft")
    class CrankShaft { // <b class="conum">(4)</b>
        var rodLength: Optional&lt;Double&gt; = Optional.empty() // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>setManufacturer(String)</code> method will be annotated with <code>@Property(name="my.engine.manufacturer")</code> the value of which will be resolved from the configured <a href="#environments">Environment</a>.</p>
</div>
<div class="paragraph">
<p>The <code>injectBean</code> method of <a href="../api/io/micronaut/context/AbstractInitializableBeanDefinition.html">AbstractInitializableBeanDefinition</a> is subsequently overridden with logic to handle looking up the normalized property name <code>my.engine.manufacturer</code> from the current <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> and inject the value if it is present in a reflection-free manner.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Property names are normalized into kebab case (lower case hyphen separated) which is the format used to store their values.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Configuration Properties Injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Generated
protected Object injectBean(
    BeanResolutionContext resolution,
    BeanContext context,
    Object bean) {
    if (this.containsProperties(resolution, context)) { <i class="conum" data-value="1"></i><b>(1)</b>
        EngineConfig engineConfig = (EngineConfig) bean;
        if (this.containsPropertyValue(resolution, context, "my.engine.manufacturer")) { <i class="conum" data-value="2"></i><b>(2)</b>
            String value = (String) super.getPropertyValueForSetter( <i class="conum" data-value="3"></i><b>(3)</b>
                resolution,
                context,
                "setManufacturer",
                Argument.of(String.class, "manufacturer"), <i class="conum" data-value="4"></i><b>(4)</b>
                "my.engine.manufacturer", <i class="conum" data-value="5"></i><b>(5)</b>
                (String)null <i class="conum" data-value="6"></i><b>(6)</b>
            )
            engineConfig.setManufacturer(value);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A top level check to see if any properties exist with the prefix defined in the <a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a> annotation is added.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A check is performed to see if the property actually exists</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If it does the value is looked up by calling the <code>getPropertyValueForSetter</code> method of <a href="../api/io/micronaut/context/AbstractInitializableBeanDefinition.html">AbstractInitializableBeanDefinition</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>An instance of <a href="../api/io/micronaut/core/type/Argument.html">Argument</a> is created which is used for conversion to the target type (in this case <code>String</code>). The <a href="../api/io/micronaut/core/type/Argument.html">Argument</a> may also contain generics information.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The computed and normalized path to the property</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The default value if the <a href="../api/io/micronaut/core/bind/annotation/Bindable.html">Bindable</a> annotation is used to specify a default.</td>
</tr>
</table>
</div>
</div>

<h2 id="aopArch"><a class="anchor" href="#aopArch"></a>20.1.5 AOP Proxies</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture/aopArch.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports annotation-based <a href="#aop">Aspect Oriented Programming</a> (AOP) which allows decorating or introducing type behaviour through the use of interceptors defined in user code.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The use of the <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP terminogy</a> originates from AspectJ and historical use in Spring.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any annotation defined by the framework can be meta-annotated with the <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> annotation which supports different kinds of interception including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AROUND</code> - A annotation can be used to decorate an existing method invocation</p>
</li>
<li>
<p><code>AROUND_CONSTRUCT</code> - An annotation can be used to intercept the construction of any type</p>
</li>
<li>
<p><code>INTRODUCTION</code> - An annotation can be used to "introduce" new behaviour to abstract or interface types</p>
</li>
<li>
<p><code>POST_CONSTRUCT</code> - An annotation can be used to intercept <code>@PostConstruct</code> calls which are invoked after the object is instantiated.</p>
</li>
<li>
<p><code>PRE_DESTROY</code> - An annotation can be used to intercept <code>@PreDestroy</code> calls which are invoked after the object is about to be disposed of.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One or many instances of <a href="../api/io/micronaut/aop/Interceptor.html">Interceptor</a> can be associated with an <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> allowing the user to implement behaviour that applies cross cutting concerns.</p>
</div>
<div class="paragraph">
<p>At an implementation level, the <a href="#compilerArch">Micronaut Compiler</a> will visit types that are meta-annotated with <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> and construct a new instance of <a href="../api/io/micronaut/aop/writer/AopProxyWriter.html">AopProxyWriter</a> which uses the ASM bytecode generation library to generate a subclass (or an implementation in the case of interfaces) of the annotated type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut at no point modifies existing user byte code, the use of build-time generated proxies allows Micronaut to generate additional code that sits along side user code and enhances behaviour. This approach does have limitations however, for example it is required that annotated types are non-final and AOP advice cannot be applied to final or effectively final types such as Java 17 Records.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example given the following annotation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.aop.Around;
import java.lang.annotation.*;
import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Retention(RUNTIME) // <b class="conum">(1)</b>
@Target({TYPE, METHOD}) // <b class="conum">(2)</b>
@Around // <b class="conum">(3)</b>
public @interface NotNull {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.aop.Around
import java.lang.annotation.*
import static java.lang.annotation.ElementType.*
import static java.lang.annotation.RetentionPolicy.RUNTIME

@Documented
@Retention(RUNTIME) // <b class="conum">(1)</b>
@Target([TYPE, METHOD]) // <b class="conum">(2)</b>
@Around // <b class="conum">(3)</b>
@interface NotNull {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Annotation Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.aop.Around
import kotlin.annotation.AnnotationRetention.RUNTIME
import kotlin.annotation.AnnotationTarget.CLASS
import kotlin.annotation.AnnotationTarget.FILE
import kotlin.annotation.AnnotationTarget.FUNCTION
import kotlin.annotation.AnnotationTarget.PROPERTY_GETTER
import kotlin.annotation.AnnotationTarget.PROPERTY_SETTER

@MustBeDocumented
@Retention(RUNTIME) // <b class="conum">(1)</b>
@Target(CLASS, FILE, FUNCTION, PROPERTY_GETTER, PROPERTY_SETTER) // <b class="conum">(2)</b>
@Around // <b class="conum">(3)</b>
annotation class NotNull</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The retention policy of the annotation must be <code>RUNTIME</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generally you want to be able to apply advice at the class or method level so the target types are <code>TYPE</code> and <code>METHOD</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/aop/Around.html">@Around</a> annotation is used here which itself is annotated with <code>@InterceptorBinding(kind=AROUND)</code> and can be thought of as a simple shortcut for defining an <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> for <code>AROUND</code> advice.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When this annotation is used on a type or method, for example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import jakarta.inject.Singleton;

@Singleton
public class NotNullExample {

    @NotNull
    void doWork(String taskName) {
        System.out.println("Doing job: " + taskName);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import jakarta.inject.Singleton

@Singleton
class NotNullExample {

    @NotNull
    void doWork(String taskName) {
        println "Doing job: $taskName"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">Around Advice Usage Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import jakarta.inject.Singleton

@Singleton
open class NotNullExample {

    @NotNull
    open fun doWork(taskName: String?) {
        println("Doing job: $taskName")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The compiler will visit the type and the <a href="../api/io/micronaut/aop/writer/AopProxyWriter.html">AopProxyWriter</a> will generate additional bytecode using the ASM bytecode generation library.</p>
</div>
<div class="paragraph">
<p>During compilation the <a href="../api/io/micronaut/aop/writer/AopProxyWriter.html">AopProxyWriter</a> instance essentially proxies the <code>BeanDefinitionWriter</code> (see <a href="#iocArch">Bean Definitions</a>), decorating the existing bytecode generation with additional behaviour. This is illustrated with the below diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/aop.png" alt="aop">
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/inject/writer/BeanDefinitionWriter.html">BeanDefinitionWriter</a> will generate the regular classes generated for every bean including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$NotNullExample$Definition.class</code> - The original undecorated bean definition (see <a href="#iocArch">Bean Definitions</a>)</p>
</li>
<li>
<p><code>$NotNullExample$Definition$Exec.class</code> - An implementation of <a href="../api/io/micronaut/inject/ExecutableMethodsDefinition.html">ExecutableMethodsDefinition</a> containing logic that allows dispatching to each intercepted method without using reflection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And the <a href="../api/io/micronaut/aop/writer/AopProxyWriter.html">AopProxyWriter</a> will decorate this behaviour and generate 3 additional classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$NotNullExample$Definition$Intercepted.class</code> - A subclass of the decorated class that holds references to applied <a href="../api/io/micronaut/aop/MethodInterceptor.html">MethodInterceptor</a> instances and overrides all the intercepted methods, constructing the <a href="../api/io/micronaut/aop/chain/MethodInterceptorChain.html">MethodInterceptorChain</a> instance and invoking the applied interceptors</p>
</li>
<li>
<p><code>$NotNullExample$Definition$Intercepted$Definition.class</code> - A <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> that subclasses the original undecorated bean definition. (see <a href="#iocArch">Bean Definitions</a>)</p>
</li>
<li>
<p><code>$NotNullExample$Definition$Intercepted$Definition$Reference.class</code> - A <a href="../api/io/micronaut/inject/BeanDefinitionReference.html">BeanDefinitionReference</a> that is capable of soft loading the intercepted <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a>. (see (see <a href="#iocArch">Bean Definitions</a>))</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The majority of the classes generated are metadata for loading and resolving the <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a>. The actual build time proxy is the class that ends with <code>$Intercepted</code>. This class implements the <a href="../api/io/micronaut/aop/Intercepted.html">Intercepted</a> interface and subclasses the proxied type, overriding any non-final and non-private methods to invoke the <a href="../api/io/micronaut/aop/chain/MethodInterceptorChain.html">MethodInterceptorChain</a>.</p>
</div>
<div class="paragraph">
<p>An implementation will create a constructor which is used to wire in the dependencies on the intercepted type that looks like:</p>
</div>
<div class="listingblock">
<div class="title">An intercepted type constructor</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Generated
class $NotNullExample$Definition$Intercepted
extends NotNullExample implements Intercepted { <i class="conum" data-value="1"></i><b>(1)</b>
    private final Interceptor[][] $interceptors = new Interceptor[1][];
    private final ExecutableMethod[] $proxyMethods = new ExecutableMethod[1];

    public $NotNullExample$Definition$Intercepted(
        BeanResolutionContext resolution,
        BeanContext context,
        Qualifier qualifier,
        List&lt;Interceptor&gt; interceptors) {
        Exec executableMethods = new Exec(true); <i class="conum" data-value="2"></i><b>(2)</b>
        this.$proxyMethods[0] = executableMethods.getExecutableMethodByIndex(0); <i class="conum" data-value="3"></i><b>(3)</b>
        this.$interceptors[0] = InterceptorChain
            .resolveAroundInterceptors(
                context,
                this.$proxyMethods[0],
                interceptors
        );  <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Generated</code> subclass extends from the decorated type and implements the <a href="../api/io/micronaut/aop/Intercepted.html">Intercepted</a> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An instance of <a href="../api/io/micronaut/inject/ExecutableMethodsDefinition.html">ExecutableMethodsDefinition</a> is constructed to resolve reflection-free dispatchers to the original method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>An internal array called <code>$proxyMethods</code> holds a reference for to each <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a> instance used to proxy the invocation.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>An internal array called <code>$interceptors</code> holds references to which <a href="../api/io/micronaut/aop/Interceptor.html">Interceptor</a> instances apply to each method since an <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> can be type or method level these may differ for each method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each non-final and non-private method of the proxied type that has an <a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a> associated with it (either type level or method level) is overridden with logic that proxies the original method, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Overrides
public void doWork(String taskName) {
    ExecutableMethod method = this.$proxyMethods[0];
    Interceptor[] interceptors = this.$interceptors[0]; <i class="conum" data-value="1"></i><b>(1)</b>
    MethodInterceptorChain chain = new MethodInterceptorChain( <i class="conum" data-value="2"></i><b>(2)</b>
        interceptors,
        this,
        method,
        new Object[]{taskName}
    );
    chain.proceed(); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a> and array of <a href="../api/io/micronaut/aop/Interceptor.html">Interceptor</a> instances for the method is located.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A new <a href="../api/io/micronaut/aop/chain/MethodInterceptorChain.html">MethodInterceptorChain</a> is constructed with the interceptors, a reference to the intercepted instance, the method and the arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>proceed()</code> method is invoked on the <a href="../api/io/micronaut/aop/chain/MethodInterceptorChain.html">MethodInterceptorChain</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the default behaviour of the <a href="../api/io/micronaut/aop/Around.html">@Around</a> annotation is to invoke the original overridden method of the target type by calling the super implementation via a generated synthetic bridge method that allows access to the super implementation (in the above case <code>NotNullExample</code>).</p>
</div>
<div class="paragraph">
<p>In this arrangement the proxy and the proxy target are the same object, with interceptors being invoked and the call to <code>proceed()</code> invoke the original implementation via a call to <code>super.doWork()</code> in the case above.</p>
</div>
<div class="paragraph">
<p>However, this behaviour can be customized using the <a href="../api/io/micronaut/aop/Around.html">@Around</a> annotation.</p>
</div>
<div class="paragraph">
<p>By setting <code>@Around(proxyTarget=true)</code> the generated code will also implement the <a href="../api/io/micronaut/aop/InterceptedProxy.html">InterceptedProxy</a> interface which defines a single method called <code>interceptedTarget()</code> that resolves the target object the proxy should delegate method calls to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default behaviour (<code>proxyTarget=false</code>) is more efficient memory wise as only a single <a href="../api/io/micronaut/inject/BeanDefinition.html">BeanDefinition</a> is required and a single instance of the proxied type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The evaluation of the proxy target is eager and done when the proxy is first created, however it can be made lazy by setting <code>@Around(lazy=true, proxyTarget=true)</code> in which case the proxy will only be retrieved when a proxied method is invoked.</p>
</div>
<div class="paragraph">
<p>The difference in behaviour between proxying the target with <code>proxyTarget=true</code> is illustrated in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/aop-proxies.png" alt="aop proxies">
</div>
</div>
<div class="paragraph">
<p>The sequence on the left hand side of the diagram (<code>proxyTarget=false</code>) invokes the proxied method via a call to <code>super</code> whilst the sequence on the right looks up an proxy target from the <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> and invokes the method on the target.</p>
</div>
<div class="paragraph">
<p>One final customization option is <code>@Around(hotswap=true)</code> which triggers the compiler to produce a compile-time proxy that implements <a href="../api/io/micronaut/aop/HotSwappableInterceptedProxy.html">HotSwappableInterceptedProxy</a> which defines a single method called <code>swap(..)</code> that allows swapping out the target of the proxy with a new instance (to allow this to be thread safe the generated code uses a <code>ReentrantReadWriteLock</code>).</p>
</div>
<div class="sect2">
<h3 id="_security_considerations">Security Considerations</h3>
<div class="paragraph">
<p>Method interception via <code>AROUND</code> advice is typically used to define logic that addresses cross cutting concerns, one of which is security.</p>
</div>
<div class="paragraph">
<p>When multiple <a href="../api/io/micronaut/aop/Interceptor.html">Interceptor</a> instances apply to a single method it may be important from a security perspective that these interceptors execute in a specific order.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/aop/Interceptor.html">Interceptor</a> interface extends the <a href="../api/io/micronaut/core/order/Ordered.html">Ordered</a> interface to enable the developer to control interceptor ordering by overriding the <code>getOrder()</code> method.</p>
</div>
<div class="paragraph">
<p>When the <a href="../api/io/micronaut/aop/chain/MethodInterceptorChain.html">MethodInterceptorChain</a> is constructed and multiple interceptors are present they are ordered with <code>HIGHEST</code> priority interceptors executed first.</p>
</div>
<div class="paragraph">
<p>To aid the developer who defines their own <a href="#aroundAdvice">Around Advice</a> the <a href="../api/io/micronaut/aop/InterceptPhase.html">InterceptPhase</a> enumeration defines various constants that can be used to correctly declare the value of <code>getOrder()</code> (for example security typically falls within the <code>VALIDATE</code> phase).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Trace level logging can be enabled for the <code>io.micronaut.aop.chain</code> package to debug resolved interceptor order.
</td>
</tr>
</table>
</div>
</div>

<h2 id="containerArch"><a class="anchor" href="#containerArch"></a>20.1.6 Application Context</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture/containerArch.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Once the job of the <a href="#compilerArch">Micronaut Compiler</a> is complete and the required classes generated, it is up to the <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> to load the classes for runtime execution.</p>
</div>
<div class="paragraph">
<p>Whilst the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/ServiceLoader.html">standard Java service loader mechanism</a> is used to define instances of <a href="../api/io/micronaut/inject/BeanDefinitionReference.html">BeanDefinitionReference</a>, the instances themselves are instead loaded with <a href="../api/io/micronaut/core/io/service/SoftServiceLoader.html">SoftServiceLoader</a> which is a more lenient implementation that allows checking if the service is actually present before loading and also allows parallel loading of services.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> performs the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Soft load all <a href="../api/io/micronaut/inject/BeanDefinitionReference.html">BeanDefinitionReference</a> instances in parallel</p>
</li>
<li>
<p>Instantiate all beans annotated with <a href="../api/io/micronaut/context/annotation/Context.html">@Context</a> (beans scoped to the whole context)</p>
</li>
<li>
<p>Run each <a href="../api/io/micronaut/context/processor/ExecutableMethodProcessor.html">ExecutableMethodProcessor</a> for each discovered processed <a href="../api/io/micronaut/inject/ExecutableMethod.html">ExecutableMethod</a>. A method is regarded as "processed" if it is meta-annotated with <code>@Executable(processOnStartup = true)</code></p>
</li>
<li>
<p>Publish an event on type <a href="../api/io/micronaut/context/event/StartupEvent.html">StartupEvent</a> for when the context is started.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The basic flow is illustrated below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/beancontext.png" alt="beancontext">
</div>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is a specialized version of the <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> that adds the notion of one or more active environments (encapsulated by <a href="../api/io/micronaut/context/env/Environment.html">Environment</a>) and <a href="#conditionalBeans">conditional bean loading</a> based on this environment.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> is loaded from one or more defined <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> instances that are discovered via the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/ServiceLoader.html">standard Java service loader mechanism</a> by loading instances of <a href="../api/io/micronaut/context/env/PropertySourceLoader.html">PropertySourceLoader</a>.</p>
</div>
<div class="paragraph">
<p>A developer can extend Micronaut to load a <a href="../api/io/micronaut/context/env/PropertySource.html">PropertySource</a> through an entirely custom mechanism by adding an additional implementation and the associated <code>META-INF/services/io.micronaut.context.env.PropertySourceLoader</code> file referencing this class.</p>
</div>
<div class="paragraph">
<p>A high level different between a <a href="../api/io/micronaut/context/BeanContext.html">BeanContext</a> and an <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> is illustrated below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/applicationcontext.png" alt="applicationcontext">
</div>
</div>
<div class="paragraph">
<p>As seen above the <a href="../api/io/micronaut/context/ApplicationContext.html">ApplicationContext</a> loads the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> which is used for multiple purposes including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enabling and disabling beans through <a href="#conditionalBeans">Bean Requirements</a></p>
</li>
<li>
<p>Allowing dependency injection of configuration via <a href="#valueAnnotation">@Value</a> or <a href="../api/io/micronaut/context/annotation/Property.html">@Property</a></p>
</li>
<li>
<p>Allowing binding of <a href="#configurationProperties">Configuration Properties</a></p>
</li>
</ul>
</div>

<h2 id="httpServerArch"><a class="anchor" href="#httpServerArch"></a>20.1.7 HTTP Server</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/architecture/httpServerArch.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Micronaut HTTP server can be considered a Micronaut Module - that is a component of Micronaut that builds on the fundamental building blocks including <a href="#iocArch">Dependency Injection</a> and the lifecycle of the <a href="#containerArch">ApplicationContext</a>.</p>
</div>
<div class="paragraph">
<p>The HTTP server includes a set of abstract interfaces and common code contained with the <code>micronaut-http</code> and <code>micronaut-http-server</code> modules respectively (the former includes HTTP primitives shared across the client and the server).</p>
</div>
<div class="paragraph">
<p>A default implementation of these interfaces is provided based on the <a href="https://netty.io/">Netty I/O toolkit</a> the architecture of which is described in the image below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://netty.io/images/components.png" alt="components">
</div>
</div>
<div class="paragraph">
<p>The Netty API is in general a very low-level I/O networking API designed for integrators to use to build clients and servers that present a higher abstraction layer. The Micronaut HTTP server is one such abstraction layer.</p>
</div>
<div class="paragraph">
<p>An architecture diagram of the Micronaut HTTP server and the components used in its implementation is described below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/httpserver.png" alt="httpserver">
</div>
</div>
<div class="paragraph">
<p>The main entry point for running the server is the <a href="../api/io/micronaut/runtime/Micronaut.html">Micronaut</a> class which implements <a href="../api/io/micronaut/context/ApplicationContextBuilder.html">ApplicationContextBuilder</a>. Typically the developer places the following call into the <code>main</code> entry point of their application:</p>
</div>
<div class="listingblock">
<div class="title">Defining a <code>main</code> entry point</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static void main(String[] args) {
    Micronaut.run(Application.class, args);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The passed arguments a transformed into a <a href="../api/io/micronaut/context/env/CommandLinePropertySource.html">CommandLinePropertySource</a> and available for dependency injection via <a href="#valueAnnotation">@Value</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Executing <code>run</code> will start the Micronaut <a href="#containerArch">ApplicationContext</a> with the default settings and then search for a bean of type <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> which is an interface that exposes information about a runnable server including host and port information. This design decouples Micronaut from the actual server implementation and whilst the default server is Netty (described above), other servers can be implemented by third-parties simply by providing an implementation of <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a>.</p>
</div>
<div class="paragraph">
<p>A sequence diagram for how the server is started is illustrated below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/embeddedserver.png" alt="embeddedserver">
</div>
</div>
<div class="paragraph">
<p>In the case of the Netty implementation the <a href="../api/io/micronaut/runtime/server/EmbeddedServer.html">EmbeddedServer</a> interface is implemented by <a href="../api/io/micronaut/http/server/netty/NettyHttpServer.html">NettyHttpServer</a>.</p>
</div>
<div class="sect2">
<h3 id="_server_configuration">Server Configuration</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/server/netty/NettyHttpServer.html">NettyHttpServer</a> reads the <a href="#serverConfiguration">Server Configuration</a> including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/http/server/netty/configuration/NettyHttpServerConfiguration.html">NettyHttpServerConfiguration</a> - An extended version of <a href="../api/io/micronaut/http/server/HttpServerConfiguration.html">HttpServerConfiguration</a> which defines Netty-specific configuration options beyond the host, port etc.</p>
</li>
<li>
<p><a href="../api/io/micronaut/http/netty/channel/EventLoopGroupConfiguration.html">EventLoopGroupConfiguration</a> - configures one or more Netty <a href="https://netty.io/4.1/api/io/netty/channel/EventLoopGroup.html">EventLoopGroup</a> that can be configured to be either unique to the server or shared with one or more HTTP clients.</p>
</li>
<li>
<p><a href="../api/io/micronaut/http/ssl/ServerSslConfiguration.html">ServerSslConfiguration</a> - Provides configuration for the <a href="../api/io/micronaut/http/server/netty/ssl/ServerSslBuilder.html">ServerSslBuilder</a> for to configure the Netty <a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslContext.html">SslContext</a> to use for HTTPS.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_server_configuration_security_considerations">Server Configuration Security Considerations</h3>
<div class="paragraph">
<p>Netty&#8217;s <a href="https://netty.io/4.1/api/io/netty/handler/ssl/SslContext.html">SslContext</a> provides an abstraction which allows using either the JDK-provided <code>javax.net.ssl.SSLContext</code> or an <a href="https://netty.io/4.1/api/io/netty/handler/ssl/OpenSslEngine.html">OpenSslEngine</a> that requires the developer to additionally add <a href="https://netty.io/wiki/forked-tomcat-native.html">netty-tcnative</a> as a dependency (<code>netty-tcnative</code> is a fork of <a href="https://tomcat.apache.org/native-doc/">Tomcat&#8217;s OpenSSL binding</a>).</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/ssl/ServerSslConfiguration.html">ServerSslConfiguration</a> allows configuring the application to a secure, readable location on disk where valid certificates exist to correctly configure the <code>javax.net.ssl.TrustManagerFactory</code> and <code>javax.net.ssl.KeyManagerFactory</code> by loading the configurtion from disk.</p>
</div>
</div>
<div class="sect2">
<h3 id="_netty_server_initialization">Netty Server Initialization</h3>
<div class="paragraph">
<p>When the <a href="../api/io/micronaut/http/server/netty/NettyHttpServer.html">NettyHttpServer</a> executes the <code>start()</code> sequence, it will perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read the <a href="../api/io/micronaut/http/netty/channel/EventLoopGroupConfiguration.html">EventLoopGroupConfiguration</a> and create the parent and worker <a href="https://netty.io/4.1/api/io/netty/channel/EventLoopGroup.html">EventLoopGroup</a> instances required to start a Netty server.</p>
</li>
<li>
<p>Compute a platform specific <a href="https://netty.io/4.1/api/io/netty/channel/socket/ServerSocketChannel.html">ServerSocketChannel</a> to use (depending on Operating System this could either be Epoll or KQueue, falling back to Java NIO if no native binding is possible)</p>
</li>
<li>
<p>Creates the instance of <a href="https://netty.io/4.1/api/io/netty/bootstrap/ServerBootstrap.html">ServerBootstrap</a> used to initialze the <a href="https://netty.io/4.1/api/io/netty/channel/socket/SocketChannel.html">SocketChannel</a> (the connection between client and server).</p>
</li>
<li>
<p>The <code>SocketChannel</code> is initialized by a Netty <a href="https://netty.io/4.1/api/io/netty/channel/ChannelInitializer.html">ChannelInitializer</a> that creates the customized Netty <a href="https://netty.io/4.1/api/io/netty/channel/ChannelPipeline.html">ChannelPipeline</a> used to Micronaut to server HTTP/1.1 or HTTP/2 requests depending on configuration.</p>
</li>
<li>
<p>The Netty <a href="https://netty.io/4.1/api/io/netty/bootstrap/ServerBootstrap.html">ServerBootstrap</a> is bound to one or more configured ports, effectively making the server available to receive requests.</p>
</li>
<li>
<p>Two <a href="#events">Bean Events</a> are fired, first <a href="../api/io/micronaut/runtime/server/event/ServerStartupEvent.html">ServerStartupEvent</a> to indicate the server has started, then finally once all these events are processed a <a href="../api/io/micronaut/discovery/event/ServiceReadyEvent.html">ServiceReadyEvent</a> only if the property <code>micronaut.application.name</code> is set.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This startup sequence is illustrated below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/nettybootstrap.png" alt="nettybootstrap">
</div>
</div>
<div class="paragraph">
<p>A <code>NettyHttpServerInitializer</code> class is used to initialize the <a href="https://netty.io/4.1/api/io/netty/channel/ChannelPipeline.html">ChannelPipeline</a> that handles incoming HTTP/1.1 or HTTP/2 requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_channelpipeline_security_considerations">ChannelPipeline Security Considerations</h3>
<div class="paragraph">
<p>The <code>ChannelPipeline</code> can be customized by the user by implementing a bean that implements the <a href="../api/io/micronaut/http/netty/channel/ChannelPipelineCustomizer.html">ChannelPipelineCustomizer</a> interface and adding a new Netty <a href="https://netty.io/4.1/api/io/netty/channel/ChannelHandler.html">ChannelHandler</a> to the pipeline.</p>
</div>
<div class="paragraph">
<p>Adding a <code>ChannelHandler</code> allows performing tasks such as wire-level logging of incoming and outgoing data packets and may be used when wire-level security requirements are required such as validating the bytes of the incoming request body or outgoing response body.</p>
</div>
</div>
<div class="sect2">
<h3 id="_netty_server_routing">Netty Server Routing</h3>
<div class="paragraph">
<p>Micronaut defines a set of <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/package-summary.html">HTTP annotations</a> that that allow binding user code to incoming <a href="../api/io/micronaut/http/HttpRequest.html">HttpRequest</a> instances and customizing the resulting <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a>.</p>
</div>
<div class="paragraph">
<p>One or many configured <a href="../api/io/micronaut/web/router/RouteBuilder.html">RouteBuilder</a> implementations construct instances of <a href="../api/io/micronaut/web/router/UriRoute.html">UriRoute</a> which is used by the <a href="../api/io/micronaut/web/router/Router.html">Router</a> components to route incoming requests methods of annotated classes such as:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;

@Controller("/hello") // <b class="conum">(1)</b>
public class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    public String index() {
        return "Hello World"; // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller('/hello') // <b class="conum">(1)</b>
class HelloController {

    @Get(produces = MediaType.TEXT_PLAIN) // <b class="conum">(2)</b>
    String index() {
        'Hello World' // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get

@Controller("/hello") // <b class="conum">(1)</b>
class HelloController {

    @Get(produces = [MediaType.TEXT_PLAIN]) // <b class="conum">(2)</b>
    fun index(): String {
        return "Hello World" // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#binding">Request binding annotations</a> can be used to bind method parameters to the HTTP body, headers, parameters etc. and the framework will automatically deal with correctly escaping the data before it passed to the receiving method.</p>
</div>
<div class="paragraph">
<p>An incoming request is received by Netty and a <code>ChannelPipeline</code> initialized by <code>NettyHttpServerInitializer</code>. The incoming raw packets are transformed into a Netty <a href="https://netty.io/4.1/api/io/netty/handler/codec/http/HttpRequest.html">HttpRequest</a> which is subsequently wrapped in a Micronaut <a href="../api/io/micronaut/http/server/netty/NettyHttpRequest.html">NettyHttpRequest</a> which abstracts over the underlying Netty request.</p>
</div>
<div class="paragraph">
<p>The <code>NettyHttpRequest</code> is passed through the chain of Netty <a href="https://netty.io/4.1/api/io/netty/channel/ChannelHandler.html">ChannelHandler</a> instances until it arrives at <code>RoutingInBoundHandler</code> which uses the aforementioned <a href="../api/io/micronaut/web/router/Router.html">Router</a> to match the request a method of an annotated <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> type.</p>
</div>
<div class="paragraph">
<p>The <code>RoutingInBoundHandler</code> delegates to <a href="../api/io/micronaut/http/server/RouteExecutor.html">RouteExecutor</a> for actual execution of the route, which deals with all the logic to dispatch to a method of an annotated <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> type.</p>
</div>
<div class="paragraph">
<p>Once executed, if the return value is not <code>null</code> an appropriate <a href="../api/io/micronaut/http/codec/MediaTypeCodec.html">MediaTypeCodec</a> is looked up from the <a href="../api/io/micronaut/http/codec/MediaTypeCodecRegistry.html">MediaTypeCodecRegistry</a> for the response <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type">Content-Type</a> (defaulting to <code>application/json</code>). The <code>MediaTypeCodec</code> is used to encode the return value into a <code>byte[]</code> and include it as the body of the resulting <a href="../api/io/micronaut/http/HttpResponse.html">HttpResponse</a>.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates this flow for an incoming request:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/arch/http-server-requestflow.png" alt="http server requestflow">
</div>
</div>
<div class="paragraph">
<p>The <code>RouteExecutor</code> will construct a <a href="../api/io/micronaut/http/filter/FilterChain.html">FilterChain</a> to execute one or many <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> prior executing the target method of an annotated <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a> type.</p>
</div>
<div class="paragraph">
<p>Once all of the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> instances have been executed the <a href="../api/io/micronaut/http/server/RouteExecutor.html">RouteExecutor</a> will attempt to satisfy the requirements of the target method&#8217;s parameters, including any <a href="#binding">Request binding annotations</a>. If the parameters cannot be satisfied then a <code>HTTP 400 - Bad Request</code> <a href="../api/io/micronaut/http/HttpStatus.html">HttpStatus</a> response is returned to the calling client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_netty_server_routing_security_considerations">Netty Server Routing Security Considerations</h3>
<div class="paragraph">
<p>A <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> instance can be used by the developer to control access to server resources. By not proceeding with the <a href="../api/io/micronaut/http/filter/FilterChain.html">FilterChain</a> an alternative response (such as a <code>403 - Forbidden</code>) can be returned to the client barring access to sensitive resources.</p>
</div>
<div class="paragraph">
<p>Note that the <a href="../api/io/micronaut/http/filter/HttpServerFilter.html">HttpServerFilter</a> interface extends from the <a href="../api/io/micronaut/core/order/Ordered.html">Ordered</a> interface since it is frequently the case that multiple filters exist within a <a href="../api/io/micronaut/http/filter/FilterChain.html">FilterChain</a>. By implementing the <code>getOrder()</code> method the developer can return an appropriate priority to control ordering. In addition, the <a href="../api/io/micronaut/http/filter/ServerFilterPhase.html">ServerFilterPhase</a> enum provides a set of constants developers can use to correctly position a filter, including a <code>SECURITY</code> phase where security rules are commonly placed.</p>
</div>
</div>

<h2 id="faq"><a class="anchor" href="#faq"></a>20.2 Frequently Asked Questions (FAQ)</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/faq.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following section covers frequently asked questions that you may find yourself asking while considering to use or using Micronaut.</p>
</div>
<div class="sect3">
<h4 id="_does_micronaut_modify_my_bytecode">Does Micronaut modify my bytecode?</h4>
<div class="paragraph">
<p>No. Your classes are your classes. Micronaut does not transform classes or modify the bytecode generated from the code you write. Micronaut produces additional classes at compile time in the same package as your original unmodified classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_doesnt_micronaut_use_spring">Why Doesn&#8217;t Micronaut use Spring?</h4>
<div class="paragraph">
<p>When asking why Micronaut doesn&#8217;t use Spring, it is typically in reference to the Spring Dependency Injection container.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Spring ecosystem is very broad and there are many Spring libraries you can use directly in Micronaut without requiring the Spring container.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reason Micronaut features its own native <a href="https://www.jcp.org/en/jsr/detail?id=330">JSR-330</a> compliant dependency injection is that the cost of these features in Spring (and any reflection-based DI/AOP container) is too great in terms of memory consumption and the impact on startup time. To support dependency injection at runtime, Spring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-projects/spring-framework/tree/master/spring-core/src/main/java/org/springframework/core/type/classreading">Reads the bytecode</a> of every bean it finds at runtime.</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-framework/blob/a691065d05741a4f1ca17925c8a5deec0f378c8b/spring-core/src/main/java/org/springframework/core/annotation/AnnotationUtils.java#L1465">Synthesizes new annotations</a> for each annotation on each bean method, constructor, field etc. to support Annotation metadata.</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-beans/src/main/java/org/springframework/beans/CachedIntrospectionResults.java">Builds Reflective Metadata</a> for each bean for every method, constructor, field, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The result is a progressive degradation of startup time and memory consumption as your application incorporates more features.</p>
</div>
<div class="paragraph">
<p>For Microservices and Serverless functions where it is critical that startup time and memory consumption remain low, the above behaviour is an undesirable reality of using the Spring container, hence the designers of Micronaut chose not to use Spring.</p>
</div>
</div>
<div class="sect3">
<h4 id="_does_micronaut_support_scala">Does Micronaut support Scala?</h4>
<div class="paragraph">
<p>Micronaut supports any JVM language that supports the Annotation Processor API. Scala currently does not support this API. However, Groovy also doesn&#8217;t support this API and special support has been built that processes the Groovy AST. It may be technically possible to support Scala in the future if a module similar to <code>inject-groovy</code> is built, but as of this writing Scala is not supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="_can_micronaut_be_used_for_purposes_other_than_microservices">Can Micronaut be used for purposes other than Microservices?</h4>
<div class="paragraph">
<p>Yes. Micronaut is very modular and you can choose to use just the Dependency Injection and AOP implementation by including the <code>micronaut-inject-java</code> (or <code>micronaut-inject-groovy</code> for Groovy) dependency in your application.</p>
</div>
<div class="paragraph">
<p>In fact Micronaut&#8217;s support for <a href="#serverlessFunctions">Serverless Computing</a> uses this exact approach.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_are_the_advantages_of_micronauts_dependency_injection_and_aop_implementation">What are the advantages of Micronaut&#8217;s Dependency Injection and AOP implementation?</h4>
<div class="paragraph">
<p>Micronaut processes your classes and produces all metadata at compile time. This eliminates the need for reflection, cached reflective metadata, and the requirement to analyze your classes at runtime, all of which lead to slower startup performance and greater memory consumption.</p>
</div>
<div class="paragraph">
<p>In addition, Micronaut builds reflection-free AOP proxies at compile time, which improves performance, reduces stack trace sizes, and reduces memory consumption.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_does_micronaut_have_its_own_consul_and_eureka_client_implementations">Why does Micronaut have its own Consul and Eureka client implementations?</h4>
<div class="paragraph">
<p>The majority of Consul and Eureka clients that exist are blocking and include many external dependencies that inflate your JAR files.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s <a href="../api/io/micronaut/discovery/DiscoveryClient.html">DiscoveryClient</a> uses Micronaut&#8217;s native HTTP client, greatly reducing the need for external dependencies and providing a reactive API onto both discovery servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_am_i_encountering_a_nosuchmethoderror_occurs_loading_my_beans_groovy">Why am I encountering a NoSuchMethodError occurs loading my beans (Groovy)?</h4>
<div class="paragraph">
<p>Groovy by default imports classes in the <code>groovy.lang</code> package, including one named <code>@Singleton</code>, an AST transformation class that makes your class a singleton by adding a private constructor and static retrieval method. This annotation is easily confused with the <code>javax.inject.Singleton</code> annotation used to define singleton beans in Micronaut. Make sure you use the correct annotation in your Groovy classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_is_it_taking_much_longer_than_it_should_to_start_the_application">Why is it taking much longer than it should to start the application</h4>
<div class="paragraph">
<p>Micronaut&#8217;s startup time is typically very fast. At the application level however, it is possible to affect startup time. If you are seeing slow startup, review any application startup listeners or <code>@Context</code> scope beans that are slowing startup.</p>
</div>
<div class="paragraph">
<p>Some network issues can also cause slow startup. On the Mac for example, misconfiguration of your <code>/etc/hosts</code> file can cause issues. See the following <a href="https://stackoverflow.com/a/39698914/1264846">stackoverflow answer</a>.</p>
</div>
</div>

<h2 id="usingsnapshots"><a class="anchor" href="#usingsnapshots"></a>20.3 Using Snapshots</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/usingsnapshots.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut milestone and stable releases are distributed to Maven Central.</p>
</div>
<div class="paragraph">
<p>The following snippet shows how to use Micronaut <code>SNAPSHOT</code> versions with Gradle. The latest snapshot will always be the next patch version plus 1 with <code>-SNAPSHOT</code> appended. For example if the latest release is "1.0.1", the current snapshot would be "1.0.2-SNAPSHOT".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ext {
    micronautVersion = '2.4.0-SNAPSHOT'
}
repositories {
    mavenCentral() <i class="conum" data-value="1"></i><b>(1)</b>
    maven { url "https://s01.oss.sonatype.org/content/repositories/snapshots/" } <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Micronaut releases are available on Maven Central</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Micronaut snapshots are available on Sonatype OSS Snapshots</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the case of Maven, edit <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
  ...

  &lt;parent&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-parent&lt;/artifactId&gt;
    &lt;version&gt;2.4.0-SNAPSHOT&lt;/version&gt;
  &lt;/parent&gt;

  &lt;properties&gt;
    &lt;micronaut.version&gt;2.4.0-SNAPSHOT&lt;/micronaut.version&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    ...
  &lt;/properties&gt;

  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;sonatype-snapshots&lt;/id&gt;
      &lt;url&gt;https://s01.oss.sonatype.org/content/repositories/snapshots/&lt;/url&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/repository&gt;
  &lt;/repositories&gt;

  ...
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the snapshot version.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Micronaut snapshots are available on Sonatype OSS Snapshots</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Previously snapshots were published to Bintray, however due to JFrog shutting the service down, snapshots are now being published to Sonatype.
</td>
</tr>
</table>
</div>

<h2 id="problems"><a class="anchor" href="#problems"></a>20.4 Common Problems</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/problems.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following section covers common problems developers encounter when using Micronaut.</p>
</div>
<div class="sect3">
<h4 id="_dependency_injection_is_not_working">Dependency injection is not working</h4>
<div class="paragraph">
<p>The most common causes of Dependency Injection failing to work are not having the appropriate annotation processor configured, or an incorrectly configured IDE. See the section on <a href="#languageSupport">Language Support</a> for how to get setup in your language.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_nosuchmethoderror_occurs_loading_beans_groovy">A NoSuchMethodError occurs loading beans (Groovy)</h4>
<div class="paragraph">
<p>By default, Groovy imports classes in the <code>groovy.lang</code> package which includes a class called <code>Singleton</code>. This is an AST transformation annotation that makes your class a singleton by adding a private constructor and static retrieval method. This annotation is easily confused with the <code>javax.inject.Singleton</code> annotation used to define singleton beans in Micronaut. Make sure you use the correct annotation in your Groovy classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_it_is_taking_much_longer_to_start_my_application_than_it_should_nix_os">It is taking much longer to start my application than it should (*nix OS)</h4>
<div class="paragraph">
<p>This is likely due to a bug related to <code>java.net.InetAddress.getLocalHost()</code> calls causing a long delay. The solution is to edit your <code>/etc/hosts</code> file to add an entry containing your host name. To find your host name, run <code>hostname</code> in a terminal. Then edit your <code>/etc/hosts</code> file to add or change entries like the example below, replacing <code>&lt;hostname&gt;</code> with your host name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>127.0.0.1       localhost &lt;hostname&gt;
::1             localhost &lt;hostname&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about this issue, see this <a href="https://stackoverflow.com/a/39698914/1264846">stackoverflow answer</a></p>
</div>
</div>

<h2 id="breaks"><a class="anchor" href="#breaks"></a>20.5 Breaking Changes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-core/edit/3.9.x/src/main/docs/guide/appendix/breaks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This section documents breaking changes between Micronaut versions</p>
</div>
<div class="sect1">
<h2 id="_3_9_0">3.9.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Micronaut Framework 3.9.0, CORS <code>allowed-origins</code> configuration does not support regular expressions to prevent accidentally exposing your API. You can use <code>allowed-origins-regex</code>, if you wish to support a regular expression.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_8_7">3.8.7</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut Framework 3.8.7 updates to <a href="https://bitbucket.org/snakeyaml/snakeyaml/wiki/Changes">SnakeYAML 2.0</a> which addresses <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-1471">CVE-2022-1471</a>. Many organizations' policies forbid their teams to use Micronaut Framework if the framework depends on a vulnerable dependency, even if the framework is unaffected. Micronaut Framework is not affected by <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-1471">CVE-2022-1471</a>.
Micronaut Framework uses SnakeYAML to load configuration in Micronaut applications. There is only one instance of <a href="https://github.com/micronaut-projects/micronaut-core/blob/3.7.x/inject/src/main/java/io/micronaut/context/env/yaml/YamlPropertySourceLoader.java#L56">SnakeYAML instantiation</a> which uses the <a href="https://github.com/micronaut-projects/micronaut-core/blob/3.8.x/inject/src/main/java/io/micronaut/context/env/yaml/CustomSafeConstructor.java">Safe Constructor</a>. Using SnakeYaml&#8217;s SafeConstructor which is the recommended way to prevent this issue:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>We recommend using SnakeYaml&#8217;s SafeConsturctor when parsing untrusted content to restrict deserialization.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_3_0">3.3.0</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The <a href="#environmentEndpoint">environmental endpoint</a> is now disabled by default. To enable it, you must update your endpoint config:</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.env.enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  env:
    enabled: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.env]
    enabled=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  env {
    enabled = true
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    env {
      enabled = true
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "env": {
      "enabled": true
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This will then be available, but mask all values.  To restore the previous functionality, you can add a bean that implements <a href="../api/io/micronaut/management/endpoint/env/EnvironmentEndpointFilter.html">EnvironmentEndpointFilter</a>:</p>
</div>
<div class="listingblock">
<div class="title">Legacy Environment Filtering Bean</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class LegacyEnvEndpointFilter implements EnvironmentEndpointFilter {
    @Override
    public void specifyFiltering(@NotNull EnvironmentFilterSpecification specification) {
        specification.legacyMasking();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#environmentEndpoint">documentation</a> for more filtering options.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_2_4">3.2.4</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The <a href="../api/io/micronaut/http/client/ProxyHttpClient.html">ProxyHttpClient</a> now sends the Host header of the proxied service <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23">as per the RFC</a>, instead of the originating service.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_2_0">3.2.0</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The HTTP client now does SSL certificate verification by default. The old insecure behavior can be re-enabled by setting the <code>micronaut.http.client.ssl.insecureTrustAllCertificates</code> property to <code>true</code>, but consider using a trust store instead if you&#8217;re using self-signed certificates.</p>
</li>
<li>
<p>Maven GraalVM Native Image plugin has new GAV coordinates. If you have declared it in your <code>pom.xml</code> please update the coordinates to:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.graalvm.buildtools&lt;/groupId&gt;
    &lt;artifactId&gt;native-maven-plugin&lt;/artifactId&gt;
...
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebSocketClient.create</code> has been modified to accept a <code>URI</code> parameter instead of <code>URL</code>. The old <code>URL</code> methods still exist, but when called with <code>null</code> like <code>WebSocketClient.create(null)</code>, the method call is now ambiguous. Please insert a cast to <code>URI</code>: <code>WebSocketClient.create((URI) null)</code>.
The same applies for the <code>create</code> method that accepts an additional <code>HttpClientConfiguration</code> parameter.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_1_0">3.1.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Retrieving the port from the Netty embedded server is no longer supported if the server is configured to bind to a random port and the server has not been started.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_0_0">3.0.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_core_changes">Core Changes</h3>
<div class="sect3">
<h4 id="_annotation_inheritance">Annotation Inheritance</h4>
<div class="paragraph">
<p>Possibly the most important change in Micronaut 3.0 is how annotations are inherited from parent classes, methods and interfaces.</p>
</div>
<div class="paragraph">
<p>Micronaut 2.x did not respect the rules defined in the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AnnotatedElement.html">AnnotatedElement</a>, and inherited all annotations from parent interfaces and types regardless of the presence of the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a> annotation.</p>
</div>
<div class="paragraph">
<p>With Micronaut 3.x and above only annotations that are explicitly meta-annotated with <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html">Inherited</a> are now inherited from parent classes and interfaces.
This applies to types in the case where one extends another, and methods in the case where one overrides another.</p>
</div>
<div class="paragraph">
<p>Many of Micronaut&#8217;s core annotations have been annotated with <code>@Inherited</code>, so no change will be required, but some annotations that are either outside Micronaut or defined by user code will need changes to code or the annotation.</p>
</div>
<div class="paragraph">
<p>In general, behaviour which you wish to override is not inherited by default in Micronaut 3.x and above including <a href="#scopes">Bean Scopes</a>, <a href="#qualifiers">Bean Qualifiers</a>, <a href="#conditionalBeans">Bean Conditions</a>, <a href="#validation">Validation Rules</a> and so on.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the core Micronaut annotations and which are inherited and which are not:</p>
</div>
<table class="tableblock frame-ends grid-all" style="width: 80%;">
<caption class="title">Table 1. Annotation Inheritance in Micronaut 3.x and above</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Inherited</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/aop/Adapter.html">@Adapter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/aop/Around.html">@Around</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/aop/AroundConstruct.html">@AroundConstruct</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/aop/InterceptorBean.html">@InterceptorBean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/aop/InterceptorBinding.html">@InterceptorBinding</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/aop/Introduction.html">@Introduction</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Blocking.html">@Blocking</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Creator.html">@Creator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/EntryPoint.html">@EntryPoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Experimental.html">@Experimental</a> (source level)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Indexes.html">@Indexes</a> &amp; <a href="../api/io/micronaut/core/annotation/Indexed.html">@Indexed</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Internal.html">@Internal</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Introspected.html">@Introspected</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/NonBlocking.html">@NonBlocking</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Nullable.html">@Nullable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/NonNull.html">@NonNull</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/Order.html">@Order</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/ReflectiveAccess.html">@ReflectiveAccess</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/annotation/TypeHint.html">@TypeHint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/async/annotation/SingleResult.html">@SingleResult</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/bind/annotation/Bindable.html">@Bindable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/convert/format/Format.html">@Format</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/convert/format/MapFormat.html">@MapFormat</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/convert/format/ReadableBytes.html">@ReadableBytes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/core/version/annotation/Version.html">@Version</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/AliasFor.html">@AliasFor</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Any.html">@Any</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Bean.html">@Bean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/BootstrapContextCompatible.html">@BootstrapContextCompatible</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/ConfigurationBuilder.html">@ConfigurationBuilder</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/ConfigurationInject.html">@ConfigurationInject</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/ConfigurationProperties.html">@ConfigurationProperties</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/ConfigurationReader.html">@ConfigurationReader</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Context.html">@Context</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/DefaultImplementation.html">@DefaultImplementation</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/DefaultScope.html">@DefaultScope</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/EachBean.html">@EachBean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Executable.html">@Executable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/NonBinding.html">@NonBinding</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Parallel.html">@Parallel</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Parameter.html">@Parameter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Primary.html">@Primary</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Property.html">@Property</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/PropertySource.html">@PropertySource</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Prototype.html">@Prototype</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Replaces.html">@Replaces</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Requirements.html">@Requirements</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Requires.html">@Requires</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Secondary.html">@Secondary</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Type.html">@Type</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/context/annotation/Value.html">@Value</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Body.html">@Body</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Consumes.html">@Consumes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CookieValue.html">@CookieValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/CustomHttpMethod.html">@CustomHttpMethod</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Delete.html">@Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Error.html">@Error</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Filter.html">@Filter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/FilterMatcher.html">@FilterMatcher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Get.html">@Get</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Head.html">@Head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Header.html">@Header</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Headers.html">@Headers</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/HttpMethodMapping.html">@HttpMethodMapping</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Options.html">@Options</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Part.html">@Part</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Patch.html">@Patch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/PathVariable.html">@PathVariable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Post.html">@Post</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Produces.html">@Produces</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Put.html">@Put</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/QueryValue.html">@QueryValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttribute.html">@RequestAttribute</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestAttributes.html">@RequestAttributes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/RequestBean.html">@RequestBean</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Status.html">@Status</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/Trace.html">@Trace</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/annotation/UriMapping.html">@UriMapping</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/client/annotation/Client.html">@Client</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/jackson/annotation/JacksonFeatures.html">@JacksonFeatures</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Delete.html">@Delete</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Endpoint.html">@Endpoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Read.html">@Read</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Sensitive.html">@Sensitive</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Selector.html">@Selector</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/endpoint/annotation/Write.html">@Write</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/health/indicator/annotation/Liveness.html">@Liveness</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/management/health/indicator/annotation/Readiness.html">@Readiness</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/messaging/annotation/MessageBody.html">@MessageBody</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/messaging/annotation/MessageHeader.html">@MessageHeader</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/messaging/annotation/MessageHeaders.html">@MessageHeaders</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/messaging/annotation/MessageListener.html">@MessageListener</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/messaging/annotation/MessageMapping.html">@MessageMapping</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/messaging/annotation/MessageProducer.html">@MessageProducer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/messaging/annotation/SendTo.html">@SendTo</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/retry/annotation/CircuitBreaker.html">@CircuitBreaker</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/retry/annotation/Fallback.html">@Fallback</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/retry/annotation/Recoverable.html">@Recoverable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/retry/annotation/Retryable.html">@Retryable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/Refreshable.html">@Refreshable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/ScopedProxy.html">@ScopedProxy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/context/scope/ThreadLocal.html">@ThreadLocal</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/event/annotation/EventListener.html">@EventListener</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/runtime/http/scope/RequestScope.html">@RequestScope</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/scheduling/annotation/Async.html">@Async</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/scheduling/annotation/ExecuteOn.html">@ExecuteOn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/scheduling/annotation/Scheduled.html">@Scheduled</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/session/annotation/SessionValue.html">@SessionValue</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/api/io/micronaut/tracing/annotation/ContinueSpan.html">@ContinueSpan</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/api/io/micronaut/tracing/annotation/NewSpan.html">@NewSpan</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/api/io/micronaut/tracing/annotation/SpanTag.html">@SpanTag</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/validation/Validated.html">@Validated</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/ClientWebSocket.html">@ClientWebSocket</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/OnClose.html">@OnClose</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/OnError.html">@OnError</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/OnMessage.html">@OnMessage</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/OnOpen.html">@OnOpen</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/ServerWebSocket.html">@ServerWebSocket</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/WebSocketComponent.html">@WebSocketComponent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">❌</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/websocket/annotation/WebSocketMapping.html">@WebSocketMapping</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When upgrading an application you may need to take action if you implement an interface or subclass a superclass and override a method.</p>
</div>
<div class="paragraph">
<p>For example the annotations defined in <code>javax.validation</code> are not inherited by default, so they must be defined again in any overridden or implemented methods.</p>
</div>
<div class="paragraph">
<p>This behaviour grants more flexibility if you need to redefine the validation rules. Note that it is still possible to inherit validation rules through meta-annotations. See the section on <a href="#annotationMetadata">Annotation Inheritance</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_error_response_format">Error Response Format</h4>
<div class="paragraph">
<p>The default value of <code>jackson.always-serialize-errors-as-list</code> is now true. That means by default the Hateoas JSON errors will always be a list. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example error response</div>
<div class="content">
<pre>{
  ...
  "_embedded": {
    "errors": [
      {
        "message": "Person.name: must not be blank"
      }
    ]
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>To revert to the previous behavior where a singular error was populated in the message field instead of including <code>_embedded.errors</code>, set the configuration setting to false.</p>
</div>
</div>
<div class="sect3">
<h4 id="_runtime_classpath_scanning_removed">Runtime Classpath Scanning Removed</h4>
<div class="paragraph">
<p>It is no longer possible to scan the classpath at runtime using the <code>scan</code> method of the <a href="../api/io/micronaut/context/env/Environment.html">Environment</a> interface.</p>
</div>
<div class="paragraph">
<p>This functionality has not been needed for some time as scanning is implemented at build time through <a href="#introspection">Bean Introspections</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_inject_annotations">Inject Annotations</h4>
<div class="paragraph">
<p>Micronaut now provides the <code>jakarta.inject</code> annotations as a transitive dependency instead of the <code>javax.inject</code> annotations.
To continue using the old annotations, add the following dependency.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"javax.inject:javax.inject:1")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;javax.inject&lt;/groupId&gt;
    &lt;artifactId&gt;javax.inject&lt;/artifactId&gt;
    &lt;version&gt;1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
</div>
<div class="sect3">
<h4 id="_nullable_annotations">Nullable Annotations</h4>
<div class="paragraph">
<p>Micronaut no longer exports any third party dependency for nullability annotations.
Micronaut now provides its own annotations for this purpose (<a href="../api/io/micronaut/core/annotation/Nullable.html">Nullable</a> and <a href="../api/io/micronaut/core/annotation/NonNull.html">NonNull</a>) that are used for our APIs.
To continue using other nullability annotations, simply add the relevant dependency.</p>
</div>
<div class="paragraph">
<p>Internally, Micronaut makes use of a third party annotation that may manifest as a warning in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">warning: unknown enum constant When.MAYBE
  reason: class file for javax.annotation.meta.When not found</code></pre>
</div>
</div>
<div class="paragraph">
<p>This warning is harmless and can be ignored. To eliminate this warning, add the following dependency to your project&#8217;s compile only classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">compileOnly(<span class="hljs-string">"com.google.code.findbugs:jsr305")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;com.google.code.findbugs&lt;/groupId&gt;
    &lt;artifactId&gt;jsr305&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
</div>
<div class="sect3">
<h4 id="_server_filter_behavior">Server Filter Behavior</h4>
<div class="paragraph">
<p>In Micronaut 2 server filters could have been called multiple times in the case of an exception being thrown, or sometimes not at all if the error resulted before route execution.
This also allowed for filters to handle exceptions thrown from routes.
Filters have changed in Micronaut 3 to always be called exactly once for each request, under all conditions.
Exceptions are no longer propagated to filters and instead the resulting error response is passed through the reactive stream.</p>
</div>
<div class="paragraph">
<p>In the case of a response being created as a result of an exception, the original cause is now stored as a response attribute (<a href="../api/io/micronaut/http/HttpAttributes.html#EXCEPTION">EXCEPTION</a>).
That attribute can be read by filters to have context for the error HTTP response.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/http/filter/OncePerRequestHttpServerFilter.html">OncePerRequestHttpServerFilter</a> class is now deprecated and will be removed in the next major release.
The <a href="../api/io/micronaut/http/filter/OncePerRequestHttpServerFilter.html">OncePerRequestHttpServerFilter</a> stores a request attribute when the filter is executed and some functionality may rely on that attribute existing.
The class will still create the attribute but it is recommended to instead create a custom attribute in your filter class and use that instead of the one created by <a href="../api/io/micronaut/http/filter/OncePerRequestHttpServerFilter.html">OncePerRequestHttpServerFilter</a>.</p>
</div>
<div class="paragraph">
<p>There is also a minor behavior change in when the response gets written.
Any modifications to the response after the underlying <code>onNext</code> call is made will not have any effect as the response has already been written.</p>
</div>
</div>
<div class="sect3">
<h4 id="_http_compile_time_validation">HTTP Compile Time Validation</h4>
<div class="paragraph">
<p>Compile time validation of HTTP related classes has been moved to its own module. To continue validating controllers, websocket server classes add <code>http-validation</code> to the annotation processor classpath.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut:micronaut-http-validation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-http-validation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
</div>
<div class="sect3">
<h4 id="_decapitalization_strategy">Decapitalization Strategy</h4>
<div class="paragraph">
<p>For many cases, one common one being introspections, getter names like <code>getXForwarded()</code> would result in the bean property being <code>XForwarded</code>.
The name will now be <code>xForwarded</code>.
This can affect many areas of the framework where names like <code>XForwarded</code> are used.</p>
</div>
</div>
<div class="sect3">
<h4 id="_order_default">@Order default</h4>
<div class="paragraph">
<p>Previously the default order value for the <code>@Order</code> annotation was the lowest precedence.
It is now 0.</p>
</div>
</div>
<div class="sect3">
<h4 id="_classes_renaming">Classes Renaming</h4>
<div class="ulist">
<ul>
<li>
<p><code>RxJavaRouteDataCollector</code> has been renamed to <code>DefaultRouteDataCollector</code>.</p>
</li>
<li>
<p><code>RxJavaBeanDefinitionDataCollector.html</code> has been renamed to <code>DefaultBeanDefinitionDataCollector</code>.</p>
</li>
<li>
<p><code>RxJavaHealthAggregator</code> has been renamed to <code>DefaultHealthAggregator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_deprecation_removal">Deprecation Removal</h4>
<div class="paragraph">
<p>Classes, constructors, etc. that have been deprecated in previous versions of Micronaut have been removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reflective_bean_map">Reflective Bean Map</h4>
<div class="paragraph">
<p>In several places in Micronaut, it is required to get a map representation of your object.
In previous versions, a reflection based strategy was used to retrieve that information if the class was not annotated with <code>@Introspected</code>.
That functionality has been removed and it is now required to annotate classes with <code>@Introspected</code> that are being used in this way.
Any class may be affected if it is passed as an argument or returned from any controller or client, among other use cases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cookie_secure_configuration">Cookie Secure Configuration</h4>
<div class="paragraph">
<p>Previously the <code>secure</code> configuration for cookies was only respected if the request was determined to be sent over https.
Due to a number of factors including proxies, HTTPS requests can be presented to the server as if they are HTTP.
In those cases the setting was not having any effect.
The setting is now respected regardless of the status of the request.
If the setting is not set, cookies will be secure if the request is determined to be HTTPS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_server_error_route_priority">Server Error Route Priority</h4>
<div class="paragraph">
<p>Previously if a route could not be satisfied, or an <code>HttpStatusException</code> was thrown, routes for the relevant HTTP status was searched before routes that handled the specific exception.
In Micronaut 3 routes that handle the exception will be searched first, then routes that handle the HTTP status.</p>
</div>
</div>
<div class="sect3">
<h4 id="_status_route_default_response_status">Status Route Default Response Status</h4>
<div class="paragraph">
<p>Status error routes will now default to produce responses with the same HTTP status as specified in the <code>@Error</code> annotation.
In previous versions a 200 OK response was created.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">@Error(status = HttpStatus.UNSUPPORTED_MEDIA_TYPE)
String unsupportedMediaTypeHandler() {
    return "not supported";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above method will result in a response of HTTP status 415 with a body of "not supported".
Previously it would have been a response of HTTP status 200 with a body of "not supported".
To specify the desired response status, either annotate the method with <code>@Status</code> or return an <code>HttpResponse</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_no_longer_possible_to_inject_a_list_of_provider">No Longer Possible to Inject a <code>List</code> of <code>Provider</code></h4>
<div class="paragraph">
<p>In Micronaut 2.x it was possible to inject a <code>List&lt;javax.inject.Provider&gt;</code>, although this was undocumented behaviour.
In Micronaut 3.x injecting a list of <code>Provider</code> instances is no longer possible and you should instead use the <a href="../api/io/micronaut/context/BeanProvider.html">BeanProvider</a> API which provides <code>stream()</code> and <code>iterator()</code> methods to provide the same functionality.</p>
</div>
</div>
<div class="sect3">
<h4 id="_injecting_executorservice">Injecting ExecutorService</h4>
<div class="paragraph">
<p>In previous versions of Micronaut it was possible to inject an <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html">ExecutorService</a> without any qualifiers and the default Netty event loop group would be injected.
Because the event loop should not be used for general purpose use cases, the injection will now fail by default with a non unique bean exception.
The injection point should be qualified for which executor service is desired.</p>
</div>
</div>
<div class="sect3">
<h4 id="_subclasses_returned_from_factories_not_injectable">Subclasses Returned From Factories Not Injectable</h4>
<div class="paragraph">
<p>It is no longer possible to inject the internal implementation type from beans produced via factories. The type returned from the factory or any of its super types are able to be injected.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.concurrent.ForkJoinPool;
import java.util.concurrent.ExecutorService;
import javax.inject.Singleton;

public class ExecutorFactory {
    @Singleton
    public ExecutorService executorService() {
        return ForkJoinPool.commonPool();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case, if the <code>ExecutorService</code> had been already been retrieved from the context in previous logic, a call to <code>context.getBean(ForkJoinPool.class)</code> would locate the already created bean.
This behaviour was inconsistent because if the bean had not yet been created then this lookup would not work.
In Micronaut 3 for consistency this is no longer possible.</p>
</div>
<div class="paragraph">
<p>You can however restore the behaviour by changing the factory to return the implementation type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.concurrent.ForkJoinPool;
import java.util.concurrent.ExecutorService;
import javax.inject.Singleton;
public class ExecutorFactory {

    @Singleton
    public ForkJoinPool executorService() {
        return ForkJoinPool.commonPool();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_no_longer_possible_to_define_aop_advice_on_a_bean_produced_from_a_factory_with_constructor_arguments">No Longer Possible to Define AOP Advice on a Bean Produced from a Factory with Constructor arguments</h4>
<div class="paragraph">
<p>In previous versions of Micronaut it was possible to define AOP advice to a factory method that returned a class that featured constructor arguments.
This could lead to undefined behaviour since the argument of the generated proxy which would be dependency injected by the framework may be different from manually constructed proxy target.</p>
</div>
<div class="paragraph">
<p>The following definition is now invalid in Micronaut 3 and above and will lead to a compilation error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.*;
import io.micronaut.runtime.context.scope.*;

@Factory
class ExampleFactory {

    @ThreadLocal
    Test test() {
        return new Test("foo");
    }
}

class Test {
    // illegally defines constructor arguments
    Test(String name) {}
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementations_of_javax_inject_provider_no_longer_generate_factories">Implementations of <code>javax.inject.Provider</code> No Longer Generate Factories</h4>
<div class="paragraph">
<p>In Micronaut 2.x if you defined a bean that implemented the <code>javax.inject.Provider</code> interface then the return type of the <code>get</code> method also automatically became a bean.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.inject.Provider;
import javax.inject.Singleton;

@Singleton
public class AProvider implements Provider&lt;A&gt; {
    @Override
    public A get() {
        return new AImpl();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example a bean of type <code>A</code> would automatically be exposed by Micronaut.
This behaviour is no longer supported and instead the <a href="../api/io/micronaut/context/annotation/Factory.html">@Factory</a> annotation should be used to express the same behaviour.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Factory;
import javax.inject.Provider;
import javax.inject.Singleton;

@Factory
public class AProvider implements Provider&lt;A&gt; {
    @Override
    @Singleton
    public A get() {
        return new AImpl();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fewer_executable_methods_generated_for_controllers_and_message_listeners">Fewer Executable Methods Generated for Controllers and Message Listeners</h4>
<div class="paragraph">
<p>Previous versions of Micronaut specified the <a href="../api/io/micronaut/context/annotation/Executable.html">@Executable</a> annotation as a meta-annotation on the <a href="../api/io/micronaut/http/annotation/Controller.html">@Controller</a>, <a href="../api/io/micronaut/http/annotation/Filter.html">@Filter</a> and <a href="../api/io/micronaut/messaging/annotation/MessageListener.html">@MessageListener</a> annotations.
This resulted in generating executable method all non-private methods of classes annotated with these annotations.</p>
</div>
<div class="paragraph">
<p>In Micronaut 3.x and above the <a href="../api/io/micronaut/context/annotation/Executable.html">@Executable</a> has been moved to a meta-annotation of <a href="../api/io/micronaut/http/annotation/HttpMethodMapping.html">@HttpMethodMapping</a> and <a href="../api/io/micronaut/messaging/annotation/MessageMapping.html">@MessageMapping</a> instead to reduce memory consumption and improve efficiency.</p>
</div>
<div class="paragraph">
<p>If you were relying on the presence of these executable methods you must explicitly annotate methods in your classes with <a href="../api/io/micronaut/context/annotation/Executable.html">@Executable</a> to restore this behaviour.</p>
</div>
</div>
<div class="sect3">
<h4 id="_graalvm_changes">GraalVM changes</h4>
<div class="paragraph">
<p>In previous versions of Micronaut annotating a class with <code>@Introspected</code> automatically added it to the GraalVM <code>reflect-config.json</code> file.
The original intended usage of the annotation is to generate <a href="#introspection">Bean Introspection Metadata</a> so Micronaut can instantiate the class and call getters and setters without using reflection.</p>
</div>
<div class="paragraph">
<p>Starting in Micronaut 3.x the <code>@Introspected</code> annotation doesn&#8217;t add the class to the GraalVM <code>reflect-config.json</code> file anymore, because in most of the cases is not really necessary.
If you need to declare a class to be accessed by reflection, use the <code>@ReflectiveAccess</code> annotation instead.</p>
</div>
<div class="paragraph">
<p>Another change is regarding the GraalVM resources created at compile-time. In previous versions of Micronaut adding a dependency on <code>io.micronaut:micronaut-graal</code> triggered the generation of the GraalVM <code>resource-config.json</code> that included all the resources in <code>src/main/resources</code> so they were included in the native image. Starting in Micronaut 3.x that is done in either the Gradle or Maven plugins.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exception_handler_moves">Exception Handler Moves</h3>
<div class="paragraph">
<p>Two exception handlers that were in <code>micronaut-server-netty</code> have now been moved to <code>micronaut-server</code> since they were not specific to Netty. Their package has also changed as a result.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Package changes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old</th>
<th class="tableblock halign-left valign-top">New</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-server-netty/src/main/java/io/micronaut/http/server/netty/converters/DuplicateRouteHandler.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-server/src/main/java/io/micronaut/http/server/exceptions/DuplicateRouteHandler.java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-server-netty/src/main/java/io/micronaut/http/server/netty/converters/UnsatisfiedRouteHandler.java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http-server/src/main/java/io/micronaut/http/server/exceptions/UnsatisfiedRouteHandler.java</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_module_changes">Module Changes</h3>
<div class="sect3">
<h4 id="_new_package_for_micronaut_cassandra">New package for Micronaut Cassandra</h4>
<div class="paragraph">
<p>The classes in Micronaut Cassandra have been moved from <code>io.micronaut.configuration.cassandra</code> to <code>io.micronaut.cassandra</code> package.</p>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_security">Micronaut Security</h4>
<div class="paragraph">
<p>Many of the APIs in the Micronaut Security module have undergone changes. Please see the <a href="https://micronaut-projects.github.io/micronaut-security/3.11.1/guide">Micronaut Security</a> documentation for the details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groovy_changes">Groovy changes</h4>
<div class="paragraph">
<p>In previous version the missing property wouldn&#8217;t set the field value to <code>null</code> as it would do for the Java code, in the version 3 it should behave in the same way.</p>
</div>
<div class="paragraph">
<p>Please refactor to use the default value in the <code>@Value</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Nullable
@Value('${greeting}')
protected String before = "Default greeting"

@Nullable
@Value('${greeting:Default greeting}')
protected String after</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>